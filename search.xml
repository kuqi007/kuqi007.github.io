<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ç›ˆç«‹è¯åˆ¸-é¦™æ¸¯-2025å¼€æˆ·ä¸å…¥é‡‘æ•™ç¨‹-3æœˆæœ€é«˜å¯äº«180USDæ–°æˆ·å¥–åŠ±</title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p><strong>ç›ˆç«‹è¯åˆ¸æ˜¯é¦™æ¸¯ã€æ–°åŠ å¡æŒç‰Œåˆ¸å•†ï¼Œæˆç«‹äº2018å¹´ï¼Œ</strong>uSMART APP<strong>æ˜¯ä¼ä¸šæ——ä¸‹æŒ‡å®šå®˜æ–¹ç¾ã€æ¸¯è‚¡æ™ºèƒ½æŠ•èµ„äº¤æ˜“è½¯ä»¶ã€‚ <strong>æœ¬æ–‡ä¸»è¦ä»‹ç»ç›ˆç«‹é¦™æ¸¯-å¼€æˆ·ï¼Œ</strong>ï¼Œå¹¶ä¸”åŒä¸€èº«ä»½åªèƒ½é¢†å–ä¸€æ¬¡æ–°æˆ·å¥–åŠ±ã€‚</strong> **ç›ˆç«‹è¯åˆ¸å‡ ä¹æ²¡æœ‰å¼€æˆ·é—¨æ§›ï¼Œåªè¦æœ‰æ–°åŠ å¡ã€é¦™æ¸¯é“¶è¡Œè´¦æˆ·å³å¯ï¼Œå¯ä»¥ç›´æ¥ä¹°å–æ¸¯ç¾è‚¡ã€BTC ETFç›¸å…³äº§å“ï¼Œäº¤æ˜“æ‰‹ç»­è´¹ä¹Ÿè¾ƒä½ï¼Œæœ‰è¿™æ–¹é¢éœ€æ±‚çš„å¯ä»¥è€ƒè™‘ä½¿ç”¨ã€‚</p><p>ğŸ“Œ</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2025/20250309215852304.png" alt="image-20250309215852179"></p><p><strong>é€šè¿‡ä¸‹é¢çš„é“¾æ¥æ³¨å†Œï¼Œ3æœˆæœ€é«˜å¯äº«HK$460USDæ–°æˆ·å¥–åŠ±</strong></p><p><a href="https://m.usmart66.com/webapp/marketing/jump-register.html?register-ct=ic&register-cid=4546&ICode=264140#/register">https://m.usmart66.com/webapp/marketing/jump-register.html?register-ct=ic&amp;register-cid=4546&amp;ICode=264140#/register</a></p><p><strong>ï¼ˆå»ºè®®ç›´æ¥é€šè¿‡ä¸Šé¢é“¾æ¥æ³¨å†Œï¼Œæ— éœ€å¡«å†™é‚€è¯·ç ï¼‰</strong> <strong>é‚€è¯·ç ï¼š264140</strong></p><p><strong>æˆ–è€…æ‰«äºŒç»´ç æ³¨å†Œï¼š</strong></p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2025/20250309220339580.png" alt="img"></p><p><strong>æ´»åŠ¨ä¼šæŒç»­æ›´æ–°ï¼Œå¯ä»¥æŒç»­å…³æ³¨</strong></p><p>ğŸ“Œ</p><p><strong>2025å¹´3æœˆæ–°äººç¤¼ï¼ˆä»…é€šè¿‡é“¾æ¥æ³¨å†Œå¯äº«ï¼‰ï¼š</strong></p><ul><li><p><strong>1ã€æ³¨å†Œå¥–åŠ±ï¼š</strong></p><ul><li>å…è´¹ç¾è‚¡ã€æ¸¯è‚¡å®æ—¶è¡Œæƒ…</li></ul><p><strong>2ã€å¼€æˆ·å¥–åŠ±ï¼š</strong></p><ul><li><strong>HK$160</strong> ç°é‡‘åˆ¸</li></ul><p><strong>3ã€å…¥é‡‘å¥–åŠ±ï¼š</strong></p><ul><li>â‘  <strong>HK$300</strong> ç°é‡‘åˆ¸ï¼šè‡ªé¦–æ¬¡å…¥é‡‘èµ·æœˆå‡ä½™é¢ <strong>10000 HKD</strong> å¹¶ç»´æŒ 6 ä¸ªæœˆï¼Œæ¯æœˆå®Œæˆ 1 ç¬”äº¤æ˜“ï¼Œå³å¯é€æœˆæ¿€æ´» 1 å¼  50 HKD ç°é‡‘åˆ¸</li><li>â‘¡ ç¾è‚¡ 0 ä½£é‡‘ + å¹³å°è´¹æœ€é«˜ $0.99&#x2F;ç¬”</li><li>â‘¢ ç¾è‚¡æœŸæƒ 0 ä½£é‡‘ä¸”æ— æœ€ä½æ”¶è´¹</li><li>â‘£ 100 åªæ¸¯è‚¡ ETF å…ä½£é‡‘</li></ul></li></ul><h3 id="å¼€æˆ·æ¡ä»¶"><a href="#å¼€æˆ·æ¡ä»¶" class="headerlink" title="å¼€æˆ·æ¡ä»¶"></a>å¼€æˆ·æ¡ä»¶</h3><ul><li><p><strong>èº«ä»½è¯</strong></p></li><li><p><strong>é¦™æ¸¯æˆ–è€…æ–°åŠ å¡é“¶è¡Œè´¦æˆ·ï¼ˆå…¥é‡‘ç”¨ï¼‰</strong></p></li></ul><h3 id="å¼€æˆ·æµç¨‹"><a href="#å¼€æˆ·æµç¨‹" class="headerlink" title="å¼€æˆ·æµç¨‹"></a><strong>å¼€æˆ·æµç¨‹</strong></h3><p><strong>å…ˆç›´æ¥æ³¨å†Œé“¾æ¥ï¼ˆé€šè¿‡æ­¤é“¾æ¥æ³¨å†Œæ‰èƒ½äº«å—æ–°æˆ·å¥–åŠ±ï¼‰ï¼š</strong></p><p><a href="https://m.usmart66.com/webapp/marketing/jump-register.html?register-ct=ic&register-cid=4546&ICode=264140#/register">https://m.usmart66.com/webapp/marketing/jump-register.html?register-ct=ic&amp;register-cid=4546&amp;ICode=264140#/register</a></p><p>å…ˆåœ¨ç½‘é¡µç«¯æ³¨å†Œè´¦å·ä¿¡æ¯</p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F330e1136-d4f7-47d9-9cd9-b39fed78d6bf%2FUntitled.png?table=block&id=5db0d873-6f99-40b2-8ea8-353323c29206&t=5db0d873-6f99-40b2-8ea8-353323c29206&width=560&cache=v2" alt="notion image"></p><p><strong>æ³¨å†Œå®Œæˆåï¼Œä¸‹è½½APP</strong></p><p><strong>AppStoreï¼š</strong></p><p><a href="https://apps.apple.com/hk/app/%E9%A6%99%E6%B8%AF%E7%9B%88%E7%AB%8B%E8%AD%89%E5%88%B8-%E9%A0%98%E5%85%88%E7%A7%91%E6%8A%80%E6%B8%AF%E8%B3%87%E5%88%B8%E5%95%86/id1463024118">https://apps.apple.com/hk/app/%E9%A6%99%E6%B8%AF%E7%9B%88%E7%AB%8B%E8%AD%89%E5%88%B8-%E9%A0%98%E5%85%88%E7%A7%91%E6%8A%80%E6%B8%AF%E8%B3%87%E5%88%B8%E5%95%86/id1463024118</a></p><p><strong>GooglePlayï¼š</strong></p><p><a href="https://play.google.com/store/apps/details?id=com.usmart.sg.stock">https://play.google.com/store/apps/details?id=com.usmart.sg.stock</a></p><p>ç™»å½•åˆšåˆšæ³¨å†Œçš„è´¦æˆ·</p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F021d7083-4ccd-4d96-8602-1b3eb36538b6%2F1.png?table=block&id=b8541b1d-e0b8-42e3-8134-3cdb2a9c2e49&t=b8541b1d-e0b8-42e3-8134-3cdb2a9c2e49&width=331.984375&cache=v2" alt="notion image"></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F18d88cce-9b58-407e-9ba5-f063aa915a84%2F2.png?table=block&id=d836dba1-1c72-4939-aea1-efc95d4af2da&t=d836dba1-1c72-4939-aea1-efc95d4af2da&width=331.984375&cache=v2" alt="notion image"></p><p>è¡¥å……é‚®ç®±ä¿¡æ¯</p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2Fe924cd4b-4771-40c8-8609-2bfa68a1a56a%2F3.png?table=block&id=61d6675e-c4bd-4576-83db-a3c75634380e&t=61d6675e-c4bd-4576-83db-a3c75634380e&width=590&cache=v2" alt="notion image"></p><p>è¿™é‡Œé€‰æ‹©å¼€ç«‹ä¸ªäººè´¦æˆ·</p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F2c757b93-93aa-44a5-bca2-9ee46536d771%2F5.png?table=block&id=d066c614-78d1-4ef1-bb73-3c3b6ddfd380&t=d066c614-78d1-4ef1-bb73-3c3b6ddfd380&width=590&cache=v2" alt="notion image"></p><p>é€‰æ‹©å…¶ä»–å›½ç±</p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F96d26a52-c850-4de1-b1c7-d3ca22d3e21d%2F6.png?table=block&id=b9dbf942-3551-4d73-97f6-ad244b10fa2e&t=b9dbf942-3551-4d73-97f6-ad244b10fa2e&width=590&cache=v2" alt="notion image"></p><p>å¡«å†™èº«ä»½è¯ä¿¡æ¯</p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F28b926aa-bf98-4a51-8d61-370196ad8fba%2F7.png?table=block&id=e7940aea-ca82-4ce5-8649-d8e0d475e9d9&t=e7940aea-ca82-4ce5-8649-d8e0d475e9d9&width=590&cache=v2" alt="notion image"></p><p>å¡«å†™å…¶ä»–èŒä¸šç¨åŠ¡ä¿¡æ¯ç­‰</p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F39b9356f-53c5-400a-8c1c-0fb0134c2bea%2F8.png?table=block&id=508ddf2e-04b4-4afa-a5d7-1d089875b979&t=508ddf2e-04b4-4afa-a5d7-1d089875b979&width=331.984375&cache=v2" alt="notion image"></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2Fc2059bf4-bba2-4808-9482-993e0b815ab9%2F9.png?table=block&id=719e62c5-2d46-4e97-8fe8-752f97311af2&t=719e62c5-2d46-4e97-8fe8-752f97311af2&width=331&cache=v2" alt="notion image"></p><p>éœ€è¦ä¸Šä¼ èº«ä»½è¯ä»¶</p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F7d73665f-0a64-477c-a333-ba147cedf4ed%2F10.png?table=block&id=6e6dd056-af65-4d3e-b780-412aeb9901c2&t=6e6dd056-af65-4d3e-b780-412aeb9901c2&width=590&cache=v2" alt="notion image"></p><p><strong>å¯¹äºä½å€å¦‚æœå’Œèº«ä»½è¯åœ°å€ä¸ä¸€è‡´ï¼Œè¿˜éœ€è¦æäº¤ä½å€è¯æ˜</strong></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2Fd81da8c2-7d89-49b4-bcc2-9f3a6862f11b%2F11.png?table=block&id=71989052-9fcf-4026-a452-14a08b7ad732&t=71989052-9fcf-4026-a452-14a08b7ad732&width=590&cache=v2" alt="notion image"></p><p>å…¶ä»–ä¸€äº›ä¸ªäººåŸºæœ¬æƒ…å†µ</p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2Fc0335ca8-a0ff-4c90-98f6-724eb9450d0c%2F12.png?table=block&id=49b24196-03cb-43ee-b861-eb1515adf309&t=49b24196-03cb-43ee-b861-eb1515adf309&width=331&cache=v2" alt="notion image"></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F968b0124-3d3c-46a7-98a2-de438244eb7c%2F13.png?table=block&id=f0210706-1036-4810-a0d4-c6793d8698ba&t=f0210706-1036-4810-a0d4-c6793d8698ba&width=331&cache=v2" alt="notion image"></p><p>æœ€åéœ€è¦åšä¸€ä¸‹äººè„¸éªŒè¯</p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F6f31fcc0-ef27-48d6-a697-d30e9c12ff00%2F14.png?table=block&id=582f6d9d-e792-4ff1-9f28-20a045fc65e4&t=582f6d9d-e792-4ff1-9f28-20a045fc65e4&width=331.984375&cache=v2" alt="notion image"></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2Ffc411ac2-510b-4043-be9b-9dc6e6d7766f%2F15.png?table=block&id=83dc9035-bffd-4ee1-85de-537b3720b7f2&t=83dc9035-bffd-4ee1-85de-537b3720b7f2&width=331.984375&cache=v2" alt="notion image"></p><p>ç¡®è®¤ä¸€äº›èµ„æ–™</p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F7f707c71-fc0c-4904-b96e-ffe64809e769%2F16.png?table=block&id=a3add167-f289-48aa-ac63-205cd77d55ad&t=a3add167-f289-48aa-ac63-205cd77d55ad&width=331&cache=v2" alt="notion image"></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F953d99d8-6074-4444-a959-68a360e4cc10%2F17.png?table=block&id=f001c98c-56b0-44b7-a881-3b4f3b8148da&t=f001c98c-56b0-44b7-a881-3b4f3b8148da&width=331.984375&cache=v2" alt="notion image"></p><p><strong>è¿™é‡Œå»ºè®®å¼€æ ‡å‡†è´¦æˆ·ï¼šäº¤æ˜“ä½£é‡‘ä½ï¼</strong></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F8ce279a6-4d85-4ee4-95d4-6ff4c203f01d%2F18.png?table=block&id=b64df52f-7646-4707-8fe3-8047d585c2e3&t=b64df52f-7646-4707-8fe3-8047d585c2e3&width=590&cache=v2" alt="notion image"></p><p>æœ€åç­‰å¾…èµ„æ–™å®¡æ ¸å³å¯</p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2Fbf24596a-6c52-4a35-99c1-489d58f0622c%2F19.png?table=block&id=edec7d3e-25f5-4a2a-89be-4f692f0d4f89&t=edec7d3e-25f5-4a2a-89be-4f692f0d4f89&width=590&cache=v2" alt="notion image"></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F2bab7bec-1c3b-454e-804f-9cf040265a00%2F20.png?table=block&id=50cb1767-51da-44dc-b88a-16f8dd31cb15&t=50cb1767-51da-44dc-b88a-16f8dd31cb15&width=708&cache=v2" alt="notion image"></p><h2 id="å…¥é‡‘"><a href="#å…¥é‡‘" class="headerlink" title="å…¥é‡‘"></a><strong>å…¥é‡‘</strong></h2><p><strong>å…¥é‡‘å¯ä»¥é€‰æ‹©é¦™æ¸¯é“¶è¡Œã€æ–°åŠ å¡é“¶è¡Œå…¥é‡‘ï¼ˆwiseä¹Ÿå¯ä»¥å¦‚ä»Šï¼‰</strong></p><p><strong>æˆ‘è¿™é‡Œæ¼”ç¤ºä¸€ä¸‹é¦™æ¸¯é“¶è¡Œå…¥é‡‘æ¸¯å¸</strong></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F1942f663-3331-4929-bb14-5842b52a3449%2F21.png?table=block&id=1b2e6712-61d1-407d-899b-46f23b34725d&t=1b2e6712-61d1-407d-899b-46f23b34725d&width=331&cache=v2" alt="notion image"></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F3935e151-5634-4690-b143-4ee6c981f310%2F22.png?table=block&id=9a52c542-e2e7-4c02-8651-18ea086f85d6&t=9a52c542-e2e7-4c02-8651-18ea086f85d6&width=332&cache=v2" alt="notion image"></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F012e28e4-c553-42cb-9df1-2af81d44d998%2F23.png?table=block&id=44289f58-b60a-4abc-9a6b-826459bad0a3&t=44289f58-b60a-4abc-9a6b-826459bad0a3&width=332&cache=v2" alt="notion image"></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F5ed00e9e-096f-4119-ae6a-b498c4a31844%2F24.png?table=block&id=66127bb6-9d33-4e44-90e5-e003074865f5&t=66127bb6-9d33-4e44-90e5-e003074865f5&width=332&cache=v2" alt="notion image"></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2Ff37ae521-dc56-4ed0-b13b-fb36cb23a3a6%2F25.png?table=block&id=2a43af99-af06-4848-832b-12fdbe9d896b&t=2a43af99-af06-4848-832b-12fdbe9d896b&width=709.984375&cache=v2" alt="notion image"></p><p><strong>å®Œæˆå…¥é‡‘åéœ€è¦é€‰æ‹©å¥–åŠ±ï¼Œå¦‚æœé€¾æœŸæœªé€‰æ‹©ä¼šè‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€æ¡£</strong></p><p><strong>è¯·æ ¹æ®è‡ªå·±æ‰“ç®—çš„å…¥é‡‘æƒ…å†µé€‰æ‹©</strong></p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2025/20250309215343080.png" alt="notion image"></p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2025/20250309215358087.png" alt="notion image"></p><h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><p><strong>ç›ˆç«‹è¯åˆ¸æ²¡æœ‰ç±»ä¼¼å…¶ä»–åˆ¸å•†çš„ç°é‡‘å®ä¹‹ç±»çš„è´§å¸åŸºé‡‘å¯ä»¥è´­ä¹°ï¼Œåªèƒ½è´­ä¹°è‚¡ç¥¨ã€ETFï¼Œå¦‚æœæ‚¨å¯¹è‚¡å¸‚ä¸ç†Ÿæ‚‰å¹¶ä¸”åªæ˜¯æƒ³ä¸ºäº†æ‹¿æ–°æˆ·å¥–åŠ±çš„è¯ï¼Œæ¨èä¸‹é¢å‡ æ”¯ç¨³å®šçš„ETFè‚¡ç¥¨è´­ä¹°ã€‚</strong></p><p><strong>æˆ‘è¿™é‡Œæ¸¯ç¾è‚¡å‡æ¨èä¸€æ”¯è´§å¸åŸºé‡‘è‚¡ç¥¨ï¼š</strong></p><ul><li><p><strong>æ¸¯è‚¡</strong> <strong>Aå—æ–¹æ¸¯å…ƒï¼Œæ¸¯è‚¡ä»£ç ï¼š03053</strong></p></li><li><p><strong>ç¾è‚¡</strong></p><ul><li><strong>ç¾å›½å›½å€º1-3æœˆETFï¼Œç¾è‚¡ä»£ç ï¼šBIL</strong></li></ul></li></ul><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F3986a61f-3d36-4980-a7b7-a562578ce0c3%2F28(1).png?table=block&id=95344a44-1282-4aad-a76f-90594cbeaa3e&t=95344a44-1282-4aad-a76f-90594cbeaa3e&width=332&cache=v2" alt="notion image"></p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2025/20250309215404858.png" alt="notion image"></p>]]></content>
      
      
      <categories>
          
          <category> æ¸¯ç¾è‚¡åˆ¸å•† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç›ˆç«‹è¯åˆ¸ </tag>
            
            <tag> ç¾è‚¡å¼€æˆ· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç›ˆé€è¯åˆ¸IBKR-æ— å…¥é‡‘é—¨æ§›æ— ç®¡ç†è´¹ï¼Œæœ€é«˜å¯äº«1000$å¥–åŠ±ï¼Œ2025å¼€æˆ·æ•™ç¨‹</title>
      <link href="/posts/76e4bf48.html"/>
      <url>/posts/76e4bf48.html</url>
      
        <content type="html"><![CDATA[<hr><h1 id="ç›ˆé€è¯åˆ¸IBKR-æ— å…¥é‡‘é—¨æ§›æ— ç®¡ç†è´¹ï¼Œæœ€é«˜å¯äº«1000-å¥–åŠ±ï¼Œ2025å¼€æˆ·æ•™ç¨‹"><a href="#ç›ˆé€è¯åˆ¸IBKR-æ— å…¥é‡‘é—¨æ§›æ— ç®¡ç†è´¹ï¼Œæœ€é«˜å¯äº«1000-å¥–åŠ±ï¼Œ2025å¼€æˆ·æ•™ç¨‹" class="headerlink" title="ç›ˆé€è¯åˆ¸IBKR-æ— å…¥é‡‘é—¨æ§›æ— ç®¡ç†è´¹ï¼Œæœ€é«˜å¯äº«1000$å¥–åŠ±ï¼Œ2025å¼€æˆ·æ•™ç¨‹"></a>ç›ˆé€è¯åˆ¸IBKR-æ— å…¥é‡‘é—¨æ§›æ— ç®¡ç†è´¹ï¼Œæœ€é«˜å¯äº«1000$å¥–åŠ±ï¼Œ2025å¼€æˆ·æ•™ç¨‹</h1><p><strong>IBç°åœ¨åº”è¯¥æ˜¯æœ€å¿«å°±èƒ½å®¡æ ¸ä¸‹æˆ·çš„åˆ¸å•†äº†å§ï¼Œæ”¯æŒwiseå…¥é‡‘æ¿€æ´»ï¼Œæœ‰å…¶ä»–å¢ƒå¤–é“¶è¡Œçš„ä¹Ÿå¯ç›´æ¥å…¥é‡‘ï¼Œä¸æ”¯æŒç¬¬ä¸‰æ–¹å…¥é‡‘ï¼Œæ— æœ€ä½å…¥é‡‘é—¨æ§›ã€‚</strong> <strong>å¯ä½œä¸ºå…¶ä»–ç­‰åˆ¸å•†ï¼Œæ¯”å¦‚å¯Œé€”ï¼Œå­˜é‡ç”¨æˆ·å¼€æˆ·è¯æ˜å§</strong></p><p><strong>å¦‚æœä½ è¦ç©ç¾è‚¡ï¼Œæˆ–è€…å…¨çƒæŠ•èµ„ï¼Œé‚£ä¹ˆIBç›ˆé€è¯åˆ¸æ˜¯ä½ å¿…é¡»æ‹¥æœ‰çš„ä¸€ä¸ªè´¦æˆ·ã€‚</strong></p><p>ä½œä¸ºç¾å›½äº¤æ˜“é‡æ’ç¬¬ä¸€çš„äº’è”ç½‘åˆ¸å•†ï¼Œåªè¦æ˜¯ä½ æƒ³äº¤æ˜“çš„é‡‘èèµ„äº§ï¼Œç›ˆé€è¯åˆ¸éƒ½å¯ä»¥æ»¡è¶³ä½ ã€‚</p><p>åƒæˆ‘ä»¬æ¯”è¾ƒç†ŸçŸ¥çš„é›ªç›ˆã€è€è™è¯åˆ¸åº•å±‚éƒ½æ˜¯ç”¨çš„ç›ˆé€çš„APIã€‚</p><p><strong>å¹³å°ç‰¹ç‚¹ï¼š</strong></p><ul><li><p><strong>ç›ˆé€è¯åˆ¸ä¸ºå…¨çƒ 33 ä¸ªå›½å®¶çš„135 ä¸ªå¸‚åœºï¼Œæä¾›æ¯å‘¨ 6 å¤©ã€æ¯å¤© 24 å°æ—¶æ•°æ®è®¿é—®å’ŒæŠ•èµ„äº¤æ˜“</strong></p></li><li><p><strong>æ— ç®¡ç†è´¹ã€æ— æœ€ä½å…¥é‡‘é—¨æ§›è¦æ±‚ï¼Œæ”¯æŒç¢è‚¡äº¤æ˜“</strong></p></li><li><p><strong>æä½çš„è´§å¸æ¢æ±‡è´¹ç”¨ï¼Œä¸”æ¯æœˆé¦–ç¬”ç”µæ±‡è´¹ç”¨å…è´¹</strong></p></li><li><p><strong>ä¸­æ–‡æ”¯æŒå‹å¥½</strong></p></li></ul><h2 id="å‡†å¤‡èµ„æ–™"><a href="#å‡†å¤‡èµ„æ–™" class="headerlink" title="å‡†å¤‡èµ„æ–™"></a>å‡†å¤‡èµ„æ–™</h2><ul><li><p><strong>æŠ¤ç…§</strong>ï¼ˆ<strong>å›½å¤–çš„è´¦æˆ·èƒ½æŠ¤ç…§çš„ä¼˜å…ˆç”¨æŠ¤ç…§å¼€æˆ·</strong>ï¼‰</p></li><li><p><strong>èº«ä»½è¯ï¼ˆä¹Ÿå¯å¼€æˆ·ï¼‰</strong></p></li></ul><h2 id="æ³¨å†Œè´¦å·"><a href="#æ³¨å†Œè´¦å·" class="headerlink" title="æ³¨å†Œè´¦å·"></a>æ³¨å†Œè´¦å·</h2><p><strong>ç‚¹å‡»ä¸‹æ–¹é“¾æ¥æ³¨å†Œï¼Œï¼ï¼ä¸ç”¨æ¢¯å­ï¼ï¼ï¼ˆæ–°ç”¨æˆ·æ³¨å†Œæœ€é«˜å¯è·å¾—1000$çš„IBKRè‚¡ç¥¨ï¼‰ï¼š</strong></p><p><a href="https://ibkr.com.cn/referral/qiqi219">https://ibkr.com.cn/referral/qiqi219</a></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F846d705d-e300-4610-be45-382126317e0f%2FUntitled.png?table=block&id=6713e5be-76cd-470d-b387-c8701226f5e1&t=6713e5be-76cd-470d-b387-c8701226f5e1&width=1614&cache=v2" alt="notion image"></p><p><strong>æ­¤æ—¶ä¼šæ”¶åˆ°é‚®ä»¶ï¼Œéœ€è¦éªŒè¯ä¸€ä¸‹é‚®ç®±</strong></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2Fc026a1cb-e16b-4ba6-9c66-ffbf0a275bd6%2FUntitled.png?table=block&id=8ab553ea-0c84-4e7d-a4a9-b8498335e2dd&t=8ab553ea-0c84-4e7d-a4a9-b8498335e2dd&width=808&cache=v2" alt="notion image"></p><p><strong>æ¥ä¸‹æ¥æˆ‘ä»¬é€‰æ‹©å¼€é€šä¸ªäººè´¦æˆ·ï¼Œç”¨ä¸­æ–‡è¾“å…¥èµ„æ–™</strong></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F3ade26a9-b474-46b6-9138-bff3c1aeed1e%2FUntitled.png?table=block&id=6fcd8be7-acf2-4f85-9c7a-903e1d4bc20c&t=6fcd8be7-acf2-4f85-9c7a-903e1d4bc20c&width=1443&cache=v2" alt="notion image"></p><p><strong>å¡«å†™ä¸ªäººä¿¡æ¯ï¼Œæ³¨æ„è¿™é‡Œç°åœ¨æ— éœ€ä¸Šä¼ åœ°å€è¯æ˜äº†ï¼Œå¡«å†™äº†æŠ¤ç…§å·ç å°±èƒ½å¼€æˆ·</strong></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F053e9ec9-4418-40e2-89d7-709b64e0886b%2FUntitled.png?table=block&id=13c636ac-bd59-4cac-b3c7-d9fc74b88e70&t=13c636ac-bd59-4cac-b3c7-d9fc74b88e70&width=1432&cache=v2" alt="notion image"></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F0c24f31a-984f-43b8-a42b-12a827440a11%2FUntitled.png?table=block&id=81ba6003-857a-489b-8b63-d109ff913d2d&t=81ba6003-857a-489b-8b63-d109ff913d2d&width=1298&cache=v2" alt="notion image"></p><p><strong>å¡«å†™é›‡ä½£ä¿¡æ¯</strong></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2Ff112ee74-8198-4f5e-8c70-f459a4161a3c%2FUntitled.png?table=block&id=193d1ab5-abe4-42f1-8a4f-e220fa88644b&t=193d1ab5-abe4-42f1-8a4f-e220fa88644b&width=1390&cache=v2" alt="notion image"></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2Ffce8a1c5-11c0-4e0a-85ab-817942bdbe25%2FUntitled.png?table=block&id=51031b54-5609-4041-9a66-564fced15549&t=51031b54-5609-4041-9a66-564fced15549&width=1051&cache=v2" alt="notion image"></p><p>çŸ­ä¿¡æ¥ç éªŒè¯</p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2Fa09e4136-5ce0-4bea-8caf-b6e13d552c6c%2FUntitled.png?table=block&id=e6fcbb95-46d3-4ee4-880b-db095e951ccb&t=e6fcbb95-46d3-4ee4-880b-db095e951ccb&width=1446&cache=v2" alt="notion image"></p><p>è´¦æˆ·è®¾ç½®</p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F456be6ca-6136-4957-ad1d-2359ff91ce0a%2FUntitled.png?table=block&id=69a98cca-0105-4ce8-bc89-45d68c8906d3&t=69a98cca-0105-4ce8-bc89-45d68c8906d3&width=1232&cache=v2" alt="notion image"></p><p><strong>äº¤æ˜“ç»éªŒä¸è®¸å¯å°½é‡ç”³è¯·æ—¶å…¨éƒ¨å‹¾é€‰ï¼ˆæ ¹æ®è‡ªå·±å®é™…æƒ…å†µæ¥å°±å¥½ï¼Œè¿™ä¸ªåé¢ä¹Ÿå¯ä»¥å¦å¤–å¼€é€šï¼Œéœ€è¦ä½ å¡«å†™çš„æ”¶å…¥å’Œè¦å¼€çš„æœåŠ¡é¡¹ç›®ç¬¦åˆæ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥ï¼‰</strong></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2Fdfbd30f3-cdcc-410b-a123-bc5faefe3bed%2FUntitled.png?table=block&id=be3aa092-9b69-4119-8a40-ebe192672ee0&t=be3aa092-9b69-4119-8a40-ebe192672ee0&width=913&cache=v2" alt="notion image"></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F0f6d0894-0a28-4e78-bcf6-6c171387d371%2FUntitled.png?table=block&id=86b7e755-017e-4727-a75d-dbfd686f58ba&t=86b7e755-017e-4727-a75d-dbfd686f58ba&width=993&cache=v2" alt="notion image"></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F9a4497a8-ee0b-4f24-9600-42db61a0844f%2FUntitled.png?table=block&id=c644562f-bda8-40f4-ab40-1f71983287c8&t=c644562f-bda8-40f4-ab40-1f71983287c8&width=1006&cache=v2" alt="notion image"></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F2df1d900-dca2-4ab4-935d-7249cc3df224%2FUntitled.png?table=block&id=559c4ac3-4b9e-4a3b-a3e8-624f61d96fc0&t=559c4ac3-4b9e-4a3b-a3e8-624f61d96fc0&width=1054&cache=v2" alt="notion image"></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F1beb6f9f-3ab1-47d2-8268-9cd4dbab6f97%2FUntitled.png?table=block&id=b73742e2-d164-4018-9689-ad6433660685&t=b73742e2-d164-4018-9689-ad6433660685&width=1033&cache=v2" alt="notion image"></p><p><strong>ç¡®è®¤ç¨åŠ¡ç›¸å…³å†…å®¹</strong></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F518a45a3-6733-491f-9288-79c7ede3aac2%2FUntitled.png?table=block&id=99ef60ca-1e3e-4acc-9788-02450264a0cf&t=99ef60ca-1e3e-4acc-9788-02450264a0cf&width=1306&cache=v2" alt="notion image"></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F3eeadd29-992d-4c03-8ef0-25789f704088%2FUntitled.png?table=block&id=3ad38ab5-9e2f-450b-af95-7f13bfd383bc&t=3ad38ab5-9e2f-450b-af95-7f13bfd383bc&width=1383&cache=v2" alt="notion image"></p><p><strong>åŒæ„æ‰€æœ‰ç›¸å…³åè®®</strong></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F12b41270-38ec-4da8-88fb-631b2d877a5b%2FUntitled.png?table=block&id=1fa847f3-e7b3-4eb5-8c28-446cfb77e3e6&t=1fa847f3-e7b3-4eb5-8c28-446cfb77e3e6&width=1383&cache=v2" alt="notion image"></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F44727c41-05ee-40bf-861e-2d6becb1ba5a%2FUntitled.png?table=block&id=fba1f754-582d-4d7e-984d-db8d663c825f&t=fba1f754-582d-4d7e-984d-db8d663c825f&width=1112&cache=v2" alt="notion image"></p><p><strong>éœ€è¦å…¥é‡‘å®Œæˆæœ€åçš„æ¿€æ´»ï¼ˆåªæ¥å—åŒåè´¦æˆ·å…¥é‡‘ï¼‰</strong></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F3456040a-9ba4-49a4-8f3a-202190ecac00%2FUntitled.png?table=block&id=1ef82988-e50f-4dbe-9194-996a14a8d32f&t=1ef82988-e50f-4dbe-9194-996a14a8d32f&width=1101&cache=v2" alt="notion image"></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2Fd5d919e6-2839-4585-a86c-0938bf9e209e%2FUntitled.png?table=block&id=51d9a7a1-6500-4af7-a05d-582c79ff83d8&t=51d9a7a1-6500-4af7-a05d-582c79ff83d8&width=1259&cache=v2" alt="notion image"></p><p><strong>æˆ‘è¿™é‡Œä½¿ç”¨æ±‡ä¸°é“¶è¡Œè½¬è´¦å…¥é‡‘ï¼ˆFPSçš„è¯ï¼Œçœ‹è¯´æ˜æœ€ä½æ˜¯éœ€è¦10000HKDï¼‰</strong></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2Fe3964a3d-8112-4c5b-8c96-9f379e1d5ba9%2FUntitled.png?table=block&id=9ae50542-0f74-49d6-8d21-1ee68194a95f&t=9ae50542-0f74-49d6-8d21-1ee68194a95f&width=1380&cache=v2" alt="notion image"></p><p><strong>é“¶è¡Œè½¬è´¦æ—¶</strong> <strong>è½¬åˆ°006 èŠ±æ——é“¶è¡Œï¼Œå¡«å†™é“¶è¡Œè´¦å·ä»¥åŠç”¨æˆ·å Interactive Brokers LLC æ³¨æ„å¡«å†™è½¬è´¦é™„è¨€</strong></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F688854b5-64e8-4dbd-ab7b-fcfdfc9352d4%2FUntitled.png?table=block&id=2fda77a0-d330-4d38-bba5-cd22f916e60c&t=2fda77a0-d330-4d38-bba5-cd22f916e60c&width=1143&cache=v2" alt="notion image"></p><p>å‰©ä¸‹çš„å°±æ˜¯ç­‰å¾…å®¡æ ¸å®Œæˆå³å¯</p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F7d3f89a1-c1f1-4566-8104-6d04bc234359%2FUntitled.png?table=block&id=ffd55940-5e3f-4957-95cc-32c84961106c&t=ffd55940-5e3f-4957-95cc-32c84961106c&width=1197&cache=v2" alt="notion image"></p><p><strong>æ³¨æ„</strong> è´¦æˆ·å¼€é€šåæ˜¯ä¼šæ”¶åˆ°é‚®ä»¶é€šçŸ¥çš„ï¼Œåœ¨å®¡æŸ¥æœŸé—´å¯ä»¥ç™»å½•APPï¼Œä½†æ˜¯åªèƒ½çœ‹æ¨¡æ‹Ÿè´¦æˆ· <strong>äº¤æ˜“è´¦æˆ·éœ€è¦å®¡æ ¸é€šè¿‡åæ‰èƒ½æ‰“å¼€</strong></p><h2 id="APPä¸äºŒæ­¥éªŒè¯"><a href="#APPä¸äºŒæ­¥éªŒè¯" class="headerlink" title="APPä¸äºŒæ­¥éªŒè¯"></a>APPä¸äºŒæ­¥éªŒè¯</h2><p><strong>ä¸‹è½½APP</strong></p><p><strong>GooglePlayï¼š</strong></p><p>IBKR Mobile - Apps on Google Play</p><p>Trade stocks, options, futures, forex, and more worldwide, at your fingertips.</p><p><a href="https://play.google.com/store/apps/details?id=atws.app">https://play.google.com/store/apps/details?id=atws.app</a></p><p><strong>AppStoreï¼š</strong></p><p>â€IBKR Mobile - Invest Worldwide</p><p>â€An intuitive, ergonomic mobile trading platform. Monitor market activity and trade with real-time quotes, charts, and market scanners. Both standard order types and complex option spreads are supported. Thinking about opening an account at IBKR? Take our mobile platform for a test drive: no registrâ€¦</p><p><a href="https://apps.apple.com/us/app/ibkr-mobile-invest-worldwide/id454558592">https://apps.apple.com/us/app/ibkr-mobile-invest-worldwide/id454558592</a></p><p>å¦‚æœè¿˜æ²¡æœ‰å®¡æ ¸é€šè¿‡çš„è¯ï¼Œæ­¤æ—¶æ˜¯å¯ä»¥ç™»å½•APPçš„ï¼Œä¼šè¿›å…¥æ¨¡æ‹Ÿç›˜</p><p><strong>ç™»é™†åä¼šæç¤ºæ˜¯å¦å¼€å¯IB KeyéªŒè¯ï¼Œå»ºè®®å¼€å¯ï¼Œåç»­ç½‘é¡µç™»é™†åªéœ€è¦æ‰‹æœºç‚¹ä¸€ä¸‹æˆæƒå³å¯</strong></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F62991997-e90c-4ab8-be9d-0e318db56448%2FUntitled.png?table=block&id=fdcdf7b8-fd6d-4fad-bcbf-f22752821759&t=fdcdf7b8-fd6d-4fad-bcbf-f22752821759&width=1242&cache=v2" alt="notion image"></p><h2 id="å¼€æˆ·æˆåŠŸå"><a href="#å¼€æˆ·æˆåŠŸå" class="headerlink" title="å¼€æˆ·æˆåŠŸå"></a>å¼€æˆ·æˆåŠŸå</h2><p><strong>å­˜æ¬¾å…¥è´¦æ›´æ–°</strong></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F0052740f-baac-46f4-80e9-245e13915300%2FUntitled.png?table=block&id=9a1561b6-0edd-4745-a7b0-2e583c92d6f8&t=9a1561b6-0edd-4745-a7b0-2e583c92d6f8&width=736&cache=v2" alt="notion image"></p><p><strong>è´¦æˆ·å®¡æ ¸é€šè¿‡</strong></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2Fabf086c7-a96e-42c0-89c3-0dc54fae78bc%2FUntitled.png?table=block&id=56bc8fd5-ce78-4370-a36d-674b149e4b16&t=56bc8fd5-ce78-4370-a36d-674b149e4b16&width=743&cache=v2" alt="notion image"></p><p><strong>æ³¨æ„æ­¤æ—¶è¿˜ä¸èƒ½ç™»å½•ç§»åŠ¨æ‰‹æœºï¼Œå› ä¸ºéœ€è¦1-2ä¸ªå·¥ä½œæ—¥åˆå§‹åŒ–è´¦æˆ·</strong></p><p>æ­¤æ—¶å¦‚æœä½ ç™»å½•æ‰‹æœºåº”ç”¨ä¼šæŠ¥é”™</p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F505f477d-4047-4a31-b974-6324761085c5%2FUntitled.png?table=block&id=8b77ed97-c316-4bee-b2fb-d3eeeac8e0d9&t=8b77ed97-c316-4bee-b2fb-d3eeeac8e0d9&width=1242&cache=v2" alt="notion image"></p><h2 id="å…³äºè·å–å¼€æˆ·è¯æ˜"><a href="#å…³äºè·å–å¼€æˆ·è¯æ˜" class="headerlink" title="å…³äºè·å–å¼€æˆ·è¯æ˜"></a>å…³äºè·å–å¼€æˆ·è¯æ˜</h2><p>ç™»å½•ç½‘é¡µç‰ˆï¼Œ<strong>ä¸šç»©ä¸æŠ¥å‘Šâ†’å…¶ä»–æŠ¥å‘Šâ†’è´¦æˆ·ç¡®è®¤ä¹¦</strong></p><p>Your Session Has Expired.</p><p><a href="https://www.ibkr.com.cn/AccountManagement/AmAuthentication?action=OtherReports">https://www.ibkr.com.cn/AccountManagement/AmAuthentication?action=OtherReports</a></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F0ac58bd8-2e0f-41dc-8508-1516100e4eb4%2FUntitled.png?table=block&id=60780f5c-6f5b-41fb-a4e1-18481614e7c6&t=60780f5c-6f5b-41fb-a4e1-18481614e7c6&width=1238&cache=v2" alt="notion image"></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F27662947-e012-41e1-b8f3-d45a6ad9c7be%2FUntitled.png?table=block&id=07da2e81-1cfa-4afd-bf6c-eb6ffb1ebbc2&t=07da2e81-1cfa-4afd-bf6c-eb6ffb1ebbc2&width=1459&cache=v2" alt="notion image"></p><p>ä¸€å¤©å³å¯ä¸‹æˆ·</p><h2 id="å…³äºè·å–ç»“å•"><a href="#å…³äºè·å–ç»“å•" class="headerlink" title="å…³äºè·å–ç»“å•"></a>å…³äºè·å–ç»“å•</h2><p>ç™»å½•ç½‘é¡µç‰ˆï¼Œ<strong>ä¸šç»©ä¸æŠ¥å‘Šâ†’æŠ¥è¡¨â†’æ´»åŠ¨</strong></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2Fa9f5b028-a5ba-4340-8870-047d89f54195%2FUntitled.png?table=block&id=6624b70d-c87c-4f32-9808-375de02be195&t=6624b70d-c87c-4f32-9808-375de02be195&width=1236&cache=v2" alt="notion image"></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2F2cff39f3-cdeb-4148-985a-67f9978ff804%2FUntitled.png?table=block&id=b0d40e7d-9090-4f57-aad1-b65123bb9fbf&t=b0d40e7d-9090-4f57-aad1-b65123bb9fbf&width=1034&cache=v2" alt="notion image"></p><h2 id="æ´»æœŸè´¦æˆ·åˆ©ç‡"><a href="#æ´»æœŸè´¦æˆ·åˆ©ç‡" class="headerlink" title="æ´»æœŸè´¦æˆ·åˆ©ç‡"></a>æ´»æœŸè´¦æˆ·åˆ©ç‡</h2><p>ä»¥ç¾å…ƒè´¦æˆ·ä¸ºä¾‹ï¼š <strong>1wç¾å…ƒä¸€ä¸‹ä¸º0% 1wç¾å…ƒä»¥ä¸Šçš„éƒ¨åˆ†å¯äº«å— 4.83%çš„æ´»æœŸå¹´åŒ–åˆ©ç‡</strong></p><p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fe63edc06-9ce7-4877-990b-2efe658d9c01%2Fa4522e14-4db8-4026-b529-9a410494f938%2FUntitled.png?table=block&id=80b5610b-f3e0-48be-b6a8-e255f4d1d9c3&t=80b5610b-f3e0-48be-b6a8-e255f4d1d9c3&width=1325&cache=v2" alt="notion image"></p>]]></content>
      
      
      
        <tags>
            
            <tag> ç›ˆé€å¼€æˆ· </tag>
            
            <tag> ç¾è‚¡åˆ¸å•† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Why you should stop apologising for your poor English (and what to do instead)</title>
      <link href="/posts/5dff8a92.html"/>
      <url>/posts/5dff8a92.html</url>
      
        <content type="html"><![CDATA[<hr><h1 id="Why-you-should-stop-apologising-for-your-poor-English-and-what-to-do-instead"><a href="#Why-you-should-stop-apologising-for-your-poor-English-and-what-to-do-instead" class="headerlink" title="Why you should stop apologising for your poor English (and what to do instead)."></a>Why you should stop apologising for your poor English (and what to do instead).</h1><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2022/202206301528723.jpeg" alt="img"></p><p><a href="https://unsplash.com/photos/meAZ6fJZ9eg">Photo by Zachary Spears in Unsplash</a></p><p>Have you ever apologised for your â€˜badâ€™ English?</p><p>You know, those situations where:</p><ul><li>Youâ€™ve written an email to a supplier requesting information and you end the email with â€œSorry for my English. I hope you can understand my email.â€</li><li>Youâ€™re on the telephone to a client and they ask you â€œwhat do you meanâ€ and you respond by apologising first â€œ Sorry, my English is not very good. What I mean isâ€¦â€</li><li>Youâ€™re in a meeting and youâ€™ve just given a brief update on a project your teamâ€™s working on. One of your colleagues asks you a question that you donâ€™t understand. You automatically assume itâ€™s because of your â€˜badâ€™ English skills and reply: â€œIâ€™m sorry, but my English is not very good. Can you repeat that?â€</li></ul><p>Why did you apologise? Let me guess.</p><ul><li>You were so conscious of making mistakes in English that you thought by blaming your â€˜badâ€™ English for those mistakes, the other person would understand better why youâ€™re making those mistakes and have more sympathy for you.</li><li>You so badly wanted to make a positive impression on your audience that you thought if you apologised for your â€˜poorâ€™ English, they would treat you more leniently and give you a chance.</li><li>You thought if you apologised beforehand for your English, any lack of clarity would be blamed on your language mistakes and NOT on your message. This, you think, would be more acceptable.</li></ul><span id="more"></span><h1 id="Why-â€œritual-apologiesâ€-donâ€™t-bring-forgiveness"><a href="#Why-â€œritual-apologiesâ€-donâ€™t-bring-forgiveness" class="headerlink" title="Why â€œritual apologiesâ€ donâ€™t bring forgiveness."></a><strong>Why â€œritual apologiesâ€ donâ€™t bring forgiveness.</strong></h1><p>We all have a deep need to be approved by our peers, and one way we seek their approval is by apologising for our weaknesses in the hope that they (our weaknesses) and, in turn, we will be accepted.</p><p>The problem with, what some people call, â€œritual apologiesâ€ is that they end up making us look <strong>weak</strong>, <strong>less confident</strong> and, worse still, <strong>annoy our listener</strong>. Letâ€™s face it, no one wants to hear whiny excuses, especially in the corporate world.</p><p>Furthermore, by apologising for your English, youâ€™re placing the spotlight on something they may NOT have noticed in the first place.</p><p>But now youâ€™ve highlighted your â€˜badâ€™ English, the spotlight will stay there and NOT on <strong>your true message</strong>. Every grammar, pronunciation or word mistake will be scrutinised and picked out like a shining beacon for the world to see!</p><p>The very thing you didnâ€™t want to happen has happened. Youâ€™re being judged not for your professional expertise, but for your â€˜badâ€™ English.</p><p>In this post, Iâ€™m going to share:</p><ul><li>how my business clients define their â€˜badâ€™ English,</li><li>why speaking mistake-free English will not help you achieve your professional goals: negotiate deals, get the promotion youâ€™re seeking, make an impact at presentations.</li><li>what you should focus on instead to make you a valuable and key player in your career.</li></ul><h1 id="Whatâ€™s-Bad-English-Anyway"><a href="#Whatâ€™s-Bad-English-Anyway" class="headerlink" title="Whatâ€™s Bad English, Anyway?"></a><strong>Whatâ€™s Bad English, Anyway?</strong></h1><p>Many of my business clients define their â€˜badâ€™ English as:</p><ul><li>â€œUsing the wrong English tenses when Iâ€™m speaking.â€</li><li>â€œNot having enough sophisticated vocabulary to impress my audience.â€</li><li>â€œNot knowing when to use the present perfect tense in my meeting.â€</li><li>â€œAlways using the same, simple words.â€</li><li>â€œGetting prepositions confused.â€</li><li>â€œNot being able to pronounce certain words.â€</li><li>â€œHaving a heavy accent.â€</li></ul><p>In essence, the reasons they give as to why theyâ€™re not able to get that promotion; negotiate that important deal; impress their audience with their presentation or win over their bosses with that business proposal is <strong>because</strong> of their poor English grammar, pronunciation and vocabulary.</p><p>Because, of course, knowing how to use the past perfect tense would clinch that deal for them, wouldnâ€™t it?</p><p>Or creating that complex sentence with impressive words and perfect grammar would persuade their client that theyâ€™re the one for the job.</p><p><em>They</em> believe it would, so what they do is â€˜self-medicateâ€™.</p><p>They:</p><ul><li>buy grammar and vocabulary courses;</li><li>memorise long lists of phrasal verbs or new vocabulary;</li><li>watch lots of films in English;</li><li>look for shortcuts</li></ul><p>They do all this in the hope it will magically turn them into a confident, mistake-free English speaker when what they should be focusing on is <strong>learning how to communicate.</strong></p><p>*<strong>â€œTo speak or to communicate: that is the question.â€*</strong></p><p>What does it mean, to communicate? Surely if youâ€™re a confident speaker, youâ€™re an effective communicator? The terms are interchangeable, arenâ€™t they?</p><p>Well, not exactly.</p><p><a href="https://www.etymonline.com/word/communicate">Etymonline</a> has a wonderful definition of â€˜communicateâ€™&#x3D;&#x3D; to make common.</p><p>In other words, to make accessible.</p><p>So, when you try and use sophisticated words or jargon and people donâ€™t understand or follow you, youâ€™ve forgotten to â€˜make things commonâ€™. In other words, youâ€™re not communicating. You need to break things down, simplify your message, help others understand you.</p><p>Hereâ€™s how you know that you <strong>communicate effectively</strong> (when your grammar or pronunciation ceases to exist):</p><ul><li>When you clearly identify the <strong>outcome</strong> you wish to accomplish before doing anything. All business communication is goal oriented. <em>For example, getting that promotion, getting your clients to agree the deal, getting an agreement on a contract, getting your managing director to accept your proposal for more investment.</em></li><li>When you give your thoughts and ideas <strong>a structure</strong> that will help you achieve your outcome, including the words you want your listeners to hear, the order in which you want them to hear your ideas (cohesion + clarity).</li><li>When you put yourself in your <strong>listenerâ€™s shoes</strong>. Imagine what information they need&#x2F;would want to hear from you to take the action you want them to take, and what information to leave out. (content + conciseness)</li><li>When you <strong>actively listen</strong> to the responses â€” cutting out the excess noise and <strong>allowing silences</strong> to fill in the space instead of more talk. (mutual respect)</li><li>When you <strong>summarise</strong> what the other person has said to demonstrate you were listening and reassure them you have understood.</li><li>When youâ€™re not sure youâ€™ve understood correctly, you <strong>formulate</strong> (and offer them) a <strong>hypothesis</strong> allowing them to correct you. (checking understanding)</li></ul><p>These are the qualities that demonstrate youâ€™re an effective business communicator in English, <strong>not</strong> perfect grammar, sophisticated vocabulary or accentless pronunciation.</p><p>And in each case, not a whiff of an apology for your â€˜badâ€™ English is required.</p><p>By contrast, this is what happens if you <strong>focus only on speaking</strong> and not on communicating</p><ul><li><strong>You donâ€™t pay attention</strong> â€” youâ€™re so focused on talking that you forget to stop to check if the person is still listening to you. Are they still interested? Are they following what youâ€™re saying or have you lost them?</li><li><strong>Your message is not heard</strong> â€” Youâ€™re so intent on speaking â€˜fluentlyâ€™ you forget to check if the other person has heard your message correctly or in the way you want it to be heard.</li><li><strong>You ignore the other person</strong>- because youâ€™re already thinking about what (and how) youâ€™re going to say next <em>while</em> the other person is talking. Thatâ€™s infuriating for the other person and shows a lack of respect, even if thatâ€™s <strong>not</strong> your intention.</li><li><strong>You end up rambling</strong> â€” Youâ€™re so focused on getting your grammar right, on finding the perfect word, on speaking â€˜fluentlyâ€™ that you lose sight of what your goal is for talking in the first place and end up rambling (talking with no purpose). No one likes a rambler because theyâ€™re time wasters, confusing and a barrier to good communication.</li></ul><p><em>â€œ</em><a href="https://www.grbj.com/articles/78105-the-big-difference-between-conversation-and-communication"><em>Talk is cheap</em></a><em>. Itâ€™s intended to fill time and space with words â€” nothing else.â€</em></p><h1 id="Hereâ€™s-What-Iâ€™d-Like-You-To-Do-Instead"><a href="#Hereâ€™s-What-Iâ€™d-Like-You-To-Do-Instead" class="headerlink" title="Hereâ€™s What Iâ€™d Like You To Do Instead"></a><strong>Hereâ€™s What Iâ€™d Like You To Do Instead</strong></h1><p><strong>Stop apologising</strong> for your â€˜badâ€™ English. Your apologies wonâ€™t bring you forgiveness but will make you look weak, less confident and annoy your listener.</p><p><strong>Stop blaming</strong> your â€˜badâ€™ English for that failed deal or being turned down for that promotion.</p><p><strong>Stop thinking</strong> that if you <strong>learn to speak more, mistake-free and grammar-perfect English</strong>, you will make more of an impact as a presenter.</p><p><strong>Start focusing on learning how to communicate</strong>, not on speaking more. The sooner you start doing this, the more confident and valued youâ€™ll become.</p><p>As Plato says: <em>â€œWise men speak because they have something to say; Fools because they have to say something.â€</em></p><p><em>Originally published in</em> <a href="https://englishwithatwist.com/2018/09/06/stop-apologising/"><em>English with a Twist</em></a></p>]]></content>
      
      
      
        <tags>
            
            <tag> enligsh learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¿«é€Ÿå¤ä¹ æŒ‡å—</title>
      <link href="/posts/b44a5d7a.html"/>
      <url>/posts/b44a5d7a.html</url>
      
        <content type="html"><![CDATA[<hr><h2 id="è®¡ç®—æœºåŸºç¡€"><a href="#è®¡ç®—æœºåŸºç¡€" class="headerlink" title="è®¡ç®—æœºåŸºç¡€"></a>è®¡ç®—æœºåŸºç¡€</h2><h3 id="ç½‘ç»œ"><a href="#ç½‘ç»œ" class="headerlink" title="ç½‘ç»œ"></a>ç½‘ç»œ</h3><h2 id="æ“ä½œç³»ç»Ÿ"><a href="#æ“ä½œç³»ç»Ÿ" class="headerlink" title="æ“ä½œç³»ç»Ÿ"></a>æ“ä½œç³»ç»Ÿ</h2><ul><li><a href="https://blog.elfred.top/2021/01/30/interview/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/">æ“ä½œç³»ç»Ÿé¢è¯•é¢˜</a></li></ul><h2 id="JAVAåŸºç¡€"><a href="#JAVAåŸºç¡€" class="headerlink" title="JAVAåŸºç¡€"></a>JAVAåŸºç¡€</h2><h3 id="å¤šçº¿ç¨‹"><a href="#å¤šçº¿ç¨‹" class="headerlink" title="å¤šçº¿ç¨‹"></a>å¤šçº¿ç¨‹</h3><ul><li><a href="https://blog.elfred.top/2021/01/23/interview/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E9%9D%A2%E8%AF%95%E9%A2%98/">å¤šçº¿ç¨‹é¢è¯•é¢˜</a></li></ul><h3 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h3><ul><li><a href="https://blog.elfred.top/2021/01/23/interview/JVM%E9%9D%A2%E8%AF%95%E9%A2%98/">JVMé¢è¯•é¢˜</a></li></ul><h2 id="ä¸­é—´ä»¶"><a href="#ä¸­é—´ä»¶" class="headerlink" title="ä¸­é—´ä»¶"></a>ä¸­é—´ä»¶</h2><h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><h4 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h4><ul><li><a href="https://blog.elfred.top/2021/01/23/interview/Redis%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98/">rediså¸¸è§é¢è¯•é¢˜</a></li><li><a href="https://mp.weixin.qq.com/s/O1W2CJ9T-bVj0t-E5gihRA">å¦ˆå¦ˆå†ä¹Ÿä¸æ‹…å¿ƒæˆ‘é¢è¯•è¢«Redisé—®å¾—è„¸éƒ½ç»¿äº†</a></li></ul><h4 id="è¿›é˜¶"><a href="#è¿›é˜¶" class="headerlink" title="è¿›é˜¶"></a>è¿›é˜¶</h4><ul><li><a href="https://blog.elfred.top/2022/05/24/internet/redis%E9%9B%86%E7%BE%A4%E7%9A%84%E6%9E%B6%E6%9E%84%E3%80%81%E9%97%AE%E9%A2%98/">redisé›†ç¾¤åŠæ¶æ„</a></li></ul><h3 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h3><h4 id="åŸºç¡€-1"><a href="#åŸºç¡€-1" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h4><ul><li><a href="https://blog.elfred.top/2021/04/27/interview/MySQL%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98/">MySQLå¸¸è§é¢è¯•é¢˜</a></li></ul><h4 id="è¿›é˜¶-1"><a href="#è¿›é˜¶-1" class="headerlink" title="è¿›é˜¶"></a>è¿›é˜¶</h4><ul><li><a href="https://mp.weixin.qq.com/s/YQFHclmKQGlZtvBkSINpsw">InnoDBè§£å†³å¹»è¯»çš„æ–¹æ¡ˆâ€“LBCC&amp;MVCC</a></li></ul><h4 id="åˆ†åº“åˆ†è¡¨æœ€ä½³å®è·µ"><a href="#åˆ†åº“åˆ†è¡¨æœ€ä½³å®è·µ" class="headerlink" title="åˆ†åº“åˆ†è¡¨æœ€ä½³å®è·µ"></a>åˆ†åº“åˆ†è¡¨æœ€ä½³å®è·µ</h4><p>TODO</p><h2 id="ç³»ç»Ÿæ¶æ„è®¾è®¡"><a href="#ç³»ç»Ÿæ¶æ„è®¾è®¡" class="headerlink" title="ç³»ç»Ÿæ¶æ„è®¾è®¡"></a>ç³»ç»Ÿæ¶æ„è®¾è®¡</h2><ul><li><a href="https://blog.elfred.top/2021/01/30/interview/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/">ç³»ç»Ÿæ¶æ„è®¾è®¡é¢è¯•é¢˜</a></li></ul><h3 id="åœºæ™¯è®¾è®¡é¢˜"><a href="#åœºæ™¯è®¾è®¡é¢˜" class="headerlink" title="åœºæ™¯è®¾è®¡é¢˜"></a>åœºæ™¯è®¾è®¡é¢˜</h3><ul><li><a href="https://zq99299.github.io/note-architect/hc/07/03.html#%E8%AE%BE%E8%AE%A1%E4%BF%A1%E6%81%AF%E6%B5%81%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%85%B3%E6%B3%A8%E7%82%B9%E6%9C%89%E5%93%AA%E4%BA%9B">å¦‚ä½•è®¾è®¡å¾®åšfeedsæµ</a></li></ul><h2 id="ç®—æ³•"><a href="#ç®—æ³•" class="headerlink" title="ç®—æ³•"></a>ç®—æ³•</h2><h3 id="åˆ·é¢˜ç½‘ç«™"><a href="#åˆ·é¢˜ç½‘ç«™" class="headerlink" title="åˆ·é¢˜ç½‘ç«™"></a>åˆ·é¢˜ç½‘ç«™</h3><ul><li><a href="https://codetop.cc/home">codetop</a></li><li><a href="https://www.programmercarl.com/">ä»£ç éšæƒ³å½•</a></li><li><a href="http://www.cyc2018.xyz/%E7%AE%97%E6%B3%95/%E5%89%91%E6%8C%87%20Offer%20%E9%A2%98%E8%A7%A3/%E5%89%91%E6%8C%87%20Offer%20%E9%A2%98%E8%A7%A3%20-%20%E7%9B%AE%E5%BD%95.html">CS-Notes å‰‘æŒ‡ Offer é¢˜è§£</a></li><li><a href="http://www.cyc2018.xyz/%E7%AE%97%E6%B3%95/%E5%89%91%E6%8C%87%20Offer%20%E9%A2%98%E8%A7%A3/%E5%89%91%E6%8C%87%20Offer%20%E9%A2%98%E8%A7%A3%20-%20%E7%9B%AE%E5%BD%95.html">CS-Notes Leetcode é¢˜è§£</a></li></ul><h2 id="ç»¼åˆé¢ç»"><a href="#ç»¼åˆé¢ç»" class="headerlink" title="ç»¼åˆé¢ç»"></a>ç»¼åˆé¢ç»</h2><ul><li><a href="https://blog.elfred.top/2021/01/20/interview/2021%E9%9D%A2%E7%BB%8F/">2021é¢ç»</a></li><li><a href="https://blog.elfred.top/2021/05/09/interview/2021%E9%9D%A2%E7%BB%8F%E7%AC%AC%E4%BA%8C%E6%B3%A2/">2021é¢ç»ç¬¬äºŒæ³¢</a></li><li><a href="https://mp.weixin.qq.com/s/cciIzLMXVs28vBHaapdvfw">20+äº’è”ç½‘å…¬å¸é¢è¯•æ€»ç»“</a></li></ul><h2 id="å¿«é€Ÿæ£€ç´¢ï¼š"><a href="#å¿«é€Ÿæ£€ç´¢ï¼š" class="headerlink" title="å¿«é€Ÿæ£€ç´¢ï¼š"></a>å¿«é€Ÿæ£€ç´¢ï¼š</h2><ul><li><a href="https://blog.elfred.top/2022/05/21/internet/JAVA/">é‚£äº›å¹´æˆ‘ä»¬èƒŒè¿‡çš„JAVAé¢è¯•é¢˜</a></li><li><a href="https://blog.elfred.top/2022/05/21/internet/DESIGN/">ç³»ç»Ÿè®¾è®¡é¢è¯•é¢˜</a></li><li><a href="https://snailclimb.gitee.io/javaguide/#/">JavaGuide</a></li><li><a href="http://www.cyc2018.xyz/">CS-Notes</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> å¿«é€Ÿå¤ä¹ æŒ‡å— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>redisé›†ç¾¤çš„æ¶æ„ã€é—®é¢˜ï¼Œé™„è„‘æ´</title>
      <link href="/posts/a2aadf50.html"/>
      <url>/posts/a2aadf50.html</url>
      
        <content type="html"><![CDATA[<hr><h1 id="redisé›†ç¾¤çš„æ¶æ„ã€é—®é¢˜ï¼Œé™„è„‘æ´"><a href="#redisé›†ç¾¤çš„æ¶æ„ã€é—®é¢˜ï¼Œé™„è„‘æ´" class="headerlink" title="redisé›†ç¾¤çš„æ¶æ„ã€é—®é¢˜ï¼Œé™„è„‘æ´"></a><strong>redisé›†ç¾¤çš„æ¶æ„ã€é—®é¢˜ï¼Œé™„è„‘æ´</strong></h1><p>Redis æ˜¯ä¸€ç§å¼€æºï¼ˆBSD è®¸å¯ï¼‰ã€æ•°æ®ç»“æ„å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ç³»ç»Ÿï¼Œç”¨ä½œæ•°æ®åº“ã€ç¼“å­˜å’Œæ¶ˆæ¯é˜Ÿåˆ—ã€‚Redis æä¾›äº†è¯¸å¦‚å­—ç¬¦ä¸²ã€æ•£åˆ—ã€åˆ—è¡¨ã€é›†åˆã€å¸¦èŒƒå›´æŸ¥è¯¢çš„æ’åºé›†åˆã€ä½å›¾ã€è¶…çº§æ—¥å¿—ã€åœ°ç†ç©ºé—´ç´¢å¼•å’Œæµç­‰æ•°æ®ç»“æ„ã€‚Redis å†…ç½®å¤åˆ¶ã€Lua è„šæœ¬ã€LRU é©±é€ã€äº‹åŠ¡å’Œä¸åŒçº§åˆ«çš„ç£ç›˜æŒä¹…åŒ–ï¼Œå¹¶é€šè¿‡ Redis Sentinel å’Œ Redis Cluster è‡ªåŠ¨åˆ†åŒºæä¾›é«˜å¯ç”¨æ€§ã€‚</p><h2 id="1-é›†ç¾¤çš„ä¼˜åŠ¿"><a href="#1-é›†ç¾¤çš„ä¼˜åŠ¿" class="headerlink" title="1 é›†ç¾¤çš„ä¼˜åŠ¿"></a>1 é›†ç¾¤çš„ä¼˜åŠ¿</h2><p>ä¸‹é¢æ˜¯redisé›†ç¾¤çš„å‡ ä¸ªæ˜æ˜¾ä¼˜åŠ¿ã€‚</p><h3 id="1-1-ä¼¸ç¼©æ€§ï¼Œæ•°æ®è§„æ¨¡ä¸æ–­å¢å¤§çš„æ—¶å€™ï¼Œå®¹æ˜“æ‰©å®¹"><a href="#1-1-ä¼¸ç¼©æ€§ï¼Œæ•°æ®è§„æ¨¡ä¸æ–­å¢å¤§çš„æ—¶å€™ï¼Œå®¹æ˜“æ‰©å®¹" class="headerlink" title="1.1 ä¼¸ç¼©æ€§ï¼Œæ•°æ®è§„æ¨¡ä¸æ–­å¢å¤§çš„æ—¶å€™ï¼Œå®¹æ˜“æ‰©å®¹"></a>1.1 ä¼¸ç¼©æ€§ï¼Œæ•°æ®è§„æ¨¡ä¸æ–­å¢å¤§çš„æ—¶å€™ï¼Œå®¹æ˜“æ‰©å®¹</h3><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021618d28640001ba3d07320377.jpg"></p><p>å•å®ä¾‹æ¨¡å¼ï¼šåªèƒ½å‚ç›´æ‰©å±•ï¼Œå¢å¤§æœºå™¨å†…å­˜çš„å®¹é‡ï¼›</p><p>é›†ç¾¤æ¨¡å¼ï¼šæ”¯æŒå‚ç›´æ‰©å±•ï¼Œä¹Ÿæ”¯æŒæ°´å¹³æ‰©å±•ï¼Œæœ‰æ›´å¥½çš„çµæ´»æ€§ï¼Œä¹Ÿå¯ä»¥æ”¯æŒæ›´å¤§çš„å®¹é‡ï¼›</p><span id="more"></span><h3 id="1-2-é«˜å¯ç”¨ï¼ŒæœåŠ¡æ•…éšœçš„æƒ…å†µï¼Œå½±å“èŒƒå›´å°"><a href="#1-2-é«˜å¯ç”¨ï¼ŒæœåŠ¡æ•…éšœçš„æƒ…å†µï¼Œå½±å“èŒƒå›´å°" class="headerlink" title="1. 2 é«˜å¯ç”¨ï¼ŒæœåŠ¡æ•…éšœçš„æƒ…å†µï¼Œå½±å“èŒƒå›´å°"></a>1. 2 é«˜å¯ç”¨ï¼ŒæœåŠ¡æ•…éšœçš„æƒ…å†µï¼Œå½±å“èŒƒå›´å°</h3><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021618d28940001004e04560316.jpg"></p><p>å•å®ä¾‹æ¨¡å¼ï¼šæ•…éšœè½¬ç§»å‰100%ä¸å¯ç”¨(slaveè½¬æ¢ä¸ºmasterä¹‹å‰)ï¼›</p><p>é›†ç¾¤æ¨¡å¼ï¼šæ•…éšœè½¬ç§»å‰éƒ¨åˆ†ä¸å¯ç”¨(é›†ç¾¤è§„æ¨¡è¶Šå¤§ï¼Œæ•…éšœå½±å“è¶Šå°); </p><h3 id="1-3-é«˜æ€§èƒ½ï¼ŒæŸ¥è¯¢å’Œå†™å…¥çš„æ€§èƒ½"><a href="#1-3-é«˜æ€§èƒ½ï¼ŒæŸ¥è¯¢å’Œå†™å…¥çš„æ€§èƒ½" class="headerlink" title="1. 3 é«˜æ€§èƒ½ï¼ŒæŸ¥è¯¢å’Œå†™å…¥çš„æ€§èƒ½"></a>1. 3 é«˜æ€§èƒ½ï¼ŒæŸ¥è¯¢å’Œå†™å…¥çš„æ€§èƒ½</h3><p>å•å®ä¾‹æ¨¡å¼ï¼šæŸ¥è¯¢å¯ä»¥åˆ†æ•£åœ¨å¤šä¸ªslaveï¼Œå†™å…¥å´åªæœ‰ä¸€ä¸ªmasterï¼›</p><p>é›†ç¾¤æ¨¡å¼ï¼šæŸ¥è¯¢æœ‰å¤šä¸ªmasterå’Œå¤šä¸ªslaveï¼Œå†™å…¥ä¹Ÿæœ‰å¤šä¸ªmasterï¼›</p><h2 id="2-æ•°æ®åˆ†ç‰‡ï¼Œä¸€è‡´æ€§hash"><a href="#2-æ•°æ®åˆ†ç‰‡ï¼Œä¸€è‡´æ€§hash" class="headerlink" title="2 æ•°æ®åˆ†ç‰‡ï¼Œä¸€è‡´æ€§hash"></a>2 æ•°æ®åˆ†ç‰‡ï¼Œä¸€è‡´æ€§hash</h2><p>å®ç°redisé›†ç¾¤çš„æ ¸å¿ƒç‚¹ï¼Œæ˜¯é’ˆå¯¹æ•°æ®çš„åˆ†ç‰‡ï¼Œè¿™é‡Œçš„ä¸€è‡´æ€§hashç®—æ³•å°±éå¸¸å…³é”®ã€‚</p><h3 id="2-1-æ™®é€šçš„hash-ç®—æ³•"><a href="#2-1-æ™®é€šçš„hash-ç®—æ³•" class="headerlink" title="2.1 æ™®é€šçš„hash ç®—æ³•"></a>2.1 æ™®é€šçš„hash ç®—æ³•</h3><p><strong>node&#x3D;hash(key)%number</strong></p><p>æ•°é‡å˜åŒ–å’Œnodeé¡ºåºå˜åŒ–ï¼Œå¯¼è‡´nodeé€‰æ‹©çš„å·®å¼‚æ€§å·¨å¤§ï¼Œé€ æˆå·¨å¤§çš„ç¼“å­˜å¤±æ•ˆã€‚</p><h3 id="2-2-ä¸€è‡´æ€§hash"><a href="#2-2-ä¸€è‡´æ€§hash" class="headerlink" title="2.2 ä¸€è‡´æ€§hash"></a>2.2 ä¸€è‡´æ€§hash</h3><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021618d28b100011c7a06470481.jpg"></p><p>hash(node) å½¢æˆè™šæ‹ŸèŠ‚ç‚¹ç¯,hash(key)è½åœ¨è™šæ‹ŸèŠ‚ç‚¹ç¯ï¼Œæ‰¾åˆ°å¯¹åº”çš„nodeã€‚</p><p>ç”±äºhash(node)çš„ç¨³å®šæ€§ï¼Œä¸nodeé¡ºåºæ— å…³ã€‚nodeå˜æ›´åªå½±å“ä¸€å°éƒ¨åˆ†æ•°æ®ã€‚</p><h3 id="2-3-redis-clusterçš„hash-slotç®—æ³•"><a href="#2-3-redis-clusterçš„hash-slotç®—æ³•" class="headerlink" title="2.3 redis clusterçš„hash slotç®—æ³•"></a>2.3 redis clusterçš„hash slotç®—æ³•</h3><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021618d28d90001c3c507320566.jpg"></p><p>å…³ç³»: cluster &gt; node &gt; slot &gt; key</p><p>Redis Clusteråœ¨è®¾è®¡ä¸­æ²¡æœ‰ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œï¼ˆConsistency Hashingï¼‰ï¼Œè€Œæ˜¯ä½¿ç”¨æ•°æ®åˆ†ç‰‡å¼•å…¥å“ˆå¸Œæ§½ï¼ˆhash slotï¼‰æ¥å®ç°ã€‚</p><p>ä¸€ä¸ª Redis ClusteråŒ…å«16384ï¼ˆ0~16383ï¼‰ä¸ªå“ˆå¸Œæ§½ï¼Œå­˜å‚¨åœ¨Redis Clusterä¸­çš„æ‰€æœ‰é”®éƒ½ä¼šè¢«æ˜ å°„åˆ°è¿™äº›slotä¸­ã€‚</p><p>é›†ç¾¤ä¸­çš„æ¯ä¸ªé”®éƒ½å±äºè¿™16384ä¸ªå“ˆå¸Œæ§½ä¸­çš„ä¸€ä¸ªï¼Œé›†ç¾¤ä½¿ç”¨å…¬å¼slot&#x3D;CRC16ï¼ˆkeyï¼‰&#x2F;16384æ¥è®¡ç®—keyå±äºå“ªä¸ªæ§½ï¼Œå…¶ä¸­CRC16(key)è¯­å¥ç”¨äºè®¡ç®—keyçš„CRC16 æ ¡éªŒå’Œã€‚</p><p>æŒ‰ç…§æ§½æ¥è¿›è¡Œåˆ†ç‰‡ï¼Œé€šè¿‡ä¸ºæ¯ä¸ªèŠ‚ç‚¹æŒ‡æ´¾ä¸åŒæ•°é‡çš„æ§½ï¼Œå¯ä»¥æ§åˆ¶ä¸åŒèŠ‚ç‚¹è´Ÿè´£çš„æ•°æ®é‡å’Œè¯·æ±‚æ•°ã€‚</p><h2 id="3-é›†ç¾¤å…ƒæ•°æ®çš„ä¸€è‡´æ€§"><a href="#3-é›†ç¾¤å…ƒæ•°æ®çš„ä¸€è‡´æ€§" class="headerlink" title="3 é›†ç¾¤å…ƒæ•°æ®çš„ä¸€è‡´æ€§"></a>3 é›†ç¾¤å…ƒæ•°æ®çš„ä¸€è‡´æ€§</h2><h3 id="3-1-å¯¹æ¯”ï¼šé›†ä¸­å¼å­˜å‚¨å…ƒæ•°æ®"><a href="#3-1-å¯¹æ¯”ï¼šé›†ä¸­å¼å­˜å‚¨å…ƒæ•°æ®" class="headerlink" title="3.1 å¯¹æ¯”ï¼šé›†ä¸­å¼å­˜å‚¨å…ƒæ•°æ®"></a>3.1 å¯¹æ¯”ï¼šé›†ä¸­å¼å­˜å‚¨å…ƒæ•°æ®</h3><p><img src="https://img3.sycdn.imooc.com/618d28f90001dd9205030256.jpg" alt="https://img3.sycdn.imooc.com/618d28f90001dd9205030256.jpg"></p><p>ä¾èµ–å¤–éƒ¨çš„é›†ä¸­å¼å­˜å‚¨æœåŠ¡ï¼Œæ¯”å¦‚ï¼šzookeeper, etcdç­‰ï¼Œä¼šå¢åŠ è¿ç»´è´Ÿæ‹…å’Œç³»ç»Ÿå¤æ‚åº¦ã€‚</p><p>é›†ä¸­å¼çš„å¥½å¤„åœ¨äºï¼Œå…ƒæ•°æ®çš„è¯»å–å’Œæ›´æ–°ï¼Œæ—¶æ•ˆæ€§éå¸¸å¥½ï¼Œä¸€æ—¦å…ƒæ•°æ®å‡ºç°äº†å˜æ›´ï¼Œå°±ç«‹å³æ›´æ–°åˆ°é›†ä¸­å¼çš„å­˜å‚¨ä¸­ï¼Œå…¶å®ƒèŠ‚ç‚¹è¯»å–çš„æ—¶å€™å°±å¯ä»¥æ„ŸçŸ¥åˆ°ï¼›ä¸å¥½åœ¨äºï¼Œæ‰€æœ‰çš„å…ƒæ•°æ®çš„æ›´æ–°å‹åŠ›å…¨éƒ¨é›†ä¸­åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´å…ƒæ•°æ®çš„å­˜å‚¨æœ‰å‹åŠ›ã€‚</p><h3 id="3-2-gossip-åè®®æ¥å¹¿æ’­è‡ªå·±çš„çŠ¶æ€ä»¥åŠè‡ªå·±å¯¹æ•´ä¸ªé›†ç¾¤è®¤çŸ¥çš„æ”¹å˜"><a href="#3-2-gossip-åè®®æ¥å¹¿æ’­è‡ªå·±çš„çŠ¶æ€ä»¥åŠè‡ªå·±å¯¹æ•´ä¸ªé›†ç¾¤è®¤çŸ¥çš„æ”¹å˜" class="headerlink" title="3.2 gossip åè®®æ¥å¹¿æ’­è‡ªå·±çš„çŠ¶æ€ä»¥åŠè‡ªå·±å¯¹æ•´ä¸ªé›†ç¾¤è®¤çŸ¥çš„æ”¹å˜"></a>3.2 gossip åè®®æ¥å¹¿æ’­è‡ªå·±çš„çŠ¶æ€ä»¥åŠè‡ªå·±å¯¹æ•´ä¸ªé›†ç¾¤è®¤çŸ¥çš„æ”¹å˜</h3><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021618d29440001b49909960994.jpg"></p><p>ping &#x2F; pong æ¶ˆæ¯æ¥ç¡®è®¤èŠ‚ç‚¹çš„å­˜æ´»å’ŒåŒæ­¥å…¨éƒ¨çš„é›†ç¾¤å…ƒæ•°æ®ã€‚</p><p>é›†ç¾¤å…ƒæ•°æ®ï¼ŒåŒ…æ‹¬ï¼šmaster&#x2F;slave nodeåˆ—è¡¨å’ŒçŠ¶æ€, slotä¸nodeå…³ç³»ã€‚</p><p>æ¯ä¸ªmaster nodeæ¯ç§’ä¼šæ‰§è¡Œ 10 æ¬¡ pingï¼Œæ¯æ¬¡ä¼šé€‰æ‹© 5 ä¸ªæœ€ä¹…æ²¡æœ‰é€šä¿¡çš„å…¶å®ƒèŠ‚ç‚¹ã€‚</p><p>å®šæ—¶æ£€æŸ¥å…¨éƒ¨èŠ‚ç‚¹ï¼Œå¦‚æœå‘ç°æŸä¸ªèŠ‚ç‚¹é€šä¿¡å»¶æ—¶è¾¾åˆ°äº† cluster_node_timeout &#x2F; 2ï¼Œé‚£ä¹ˆç«‹å³å‘é€ pingï¼Œé¿å…æ•°æ®äº¤æ¢å»¶æ—¶è¿‡é•¿ã€‚</p><h3 id="3-3-å¢åŠ æ–°èŠ‚ç‚¹"><a href="#3-3-å¢åŠ æ–°èŠ‚ç‚¹" class="headerlink" title="3.3 å¢åŠ æ–°èŠ‚ç‚¹"></a>3.3 å¢åŠ æ–°èŠ‚ç‚¹</h3><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021618d297100012b8303820732.jpg"></p><p>å‘½ä»¤ <code>CLUSTER MEET &lt;ip&gt; &lt;port&gt; </code></p><p>å‘ä¸€ä¸ªèŠ‚ç‚¹ node å‘é€ CLUSTER MEET å‘½ä»¤ï¼Œå¯ä»¥è®© node èŠ‚ç‚¹ä¸ ip å’Œ port æ‰€æŒ‡å®šçš„èŠ‚ç‚¹è¿›è¡Œæ¡æ‰‹ï¼ˆhandshakeï¼‰ï¼Œå½“æ¡æ‰‹æˆåŠŸæ—¶ï¼Œnode èŠ‚ç‚¹å°±ä¼šå°† ip å’Œ port æ‰€æŒ‡å®šçš„èŠ‚ç‚¹æ·»åŠ åˆ° node èŠ‚ç‚¹å½“å‰æ‰€åœ¨çš„é›†ç¾¤ä¸­ã€‚</p><p>æŒ‰ç…§gossipåè®®ï¼Œå¹¿æ’­meetæ¶ˆæ¯ï¼Œå…¨éƒ¨èŠ‚ç‚¹æ¥æ”¶æ–°èŠ‚ç‚¹ã€‚</p><p>é‡æ–°hash(node)ï¼Œåˆ†é…å’Œè½¬ç§»ç›¸åº”çš„slotç»™åˆ°æ–°èŠ‚ç‚¹ã€‚</p><h2 id="4-å®¢æˆ·ç«¯å¦‚ä½•è°ƒç”¨"><a href="#4-å®¢æˆ·ç«¯å¦‚ä½•è°ƒç”¨" class="headerlink" title="4 å®¢æˆ·ç«¯å¦‚ä½•è°ƒç”¨"></a>4 å®¢æˆ·ç«¯å¦‚ä½•è°ƒç”¨</h2><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021618d299700012be907320478.jpg"></p><h3 id="4-1-hash-slot-ä¿¡æ¯"><a href="#4-1-hash-slot-ä¿¡æ¯" class="headerlink" title="4.1 hash slot ä¿¡æ¯"></a>4.1 hash slot ä¿¡æ¯</h3><p>å½“å®¢æˆ·ç«¯è¿æ¥ä»»ä½•ä¸€ä¸ªå®ä¾‹ï¼Œå®ä¾‹å°±å°†å“ˆå¸Œæ§½ä¸å®ä¾‹çš„æ˜ å°„å…³ç³»å“åº”ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å°±ä¼šå°†å“ˆå¸Œæ§½ä¸å®ä¾‹æ˜ å°„ä¿¡æ¯ç¼“å­˜åœ¨æœ¬åœ°ã€‚</p><h3 id="4-2-è¯·æ±‚æ•°æ®"><a href="#4-2-è¯·æ±‚æ•°æ®" class="headerlink" title="4.2 è¯·æ±‚æ•°æ®"></a>4.2 è¯·æ±‚æ•°æ®</h3><p>å½“å®¢æˆ·ç«¯è¯·æ±‚æ—¶ï¼Œä¼šè®¡ç®—å‡ºé”®æ‰€å¯¹åº”çš„å“ˆå¸Œæ§½ï¼Œåœ¨é€šè¿‡æœ¬åœ°ç¼“å­˜çš„å“ˆå¸Œæ§½å®ä¾‹æ˜ å°„ä¿¡æ¯å®šä½åˆ°æ•°æ®æ‰€åœ¨å®ä¾‹ä¸Šï¼Œå†å°†è¯·æ±‚å‘é€ç»™å¯¹åº”çš„å®ä¾‹ã€‚ </p><h3 id="4-3-é‡å®šå‘æœºåˆ¶"><a href="#4-3-é‡å®šå‘æœºåˆ¶" class="headerlink" title="4.3 é‡å®šå‘æœºåˆ¶"></a>4.3 é‡å®šå‘æœºåˆ¶</h3><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021618d29b7000197ca07320599.jpg"></p><p>å®¢æˆ·ç«¯å°†è¯·æ±‚å‘é€åˆ°å®ä¾‹ä¸Šï¼Œè¿™ä¸ªå®ä¾‹æ²¡æœ‰ç›¸åº”çš„æ•°æ®ï¼Œè¯¥ Redis å®ä¾‹ä¼šå‘Šè¯‰å®¢æˆ·ç«¯æ›´æ–°æœ¬åœ°çš„å“ˆå¸Œæ§½ä¸æ˜ å°„ä¿¡æ¯çš„ç¼“å­˜ï¼Œå°†è¯·æ±‚å‘é€åˆ°å…¶ä»–çš„å®ä¾‹ä¸Šã€‚</p><h2 id="5-æ–°çš„èŠ‚ç‚¹åŠ å…¥é›†ç¾¤-æ‰©å®¹"><a href="#5-æ–°çš„èŠ‚ç‚¹åŠ å…¥é›†ç¾¤-æ‰©å®¹" class="headerlink" title="5 æ–°çš„èŠ‚ç‚¹åŠ å…¥é›†ç¾¤(æ‰©å®¹)"></a>5 æ–°çš„èŠ‚ç‚¹åŠ å…¥é›†ç¾¤(æ‰©å®¹)</h2><p>åŒ3.3 å¢åŠ æ–°èŠ‚ç‚¹çš„å‰åºæ­¥éª¤æ˜¯ä¸€æ ·çš„ã€‚</p><p>è¿™é‡Œè¯¦ç»†äº†è§£ä¸‹é‡æ–°æ‰©å®¹æ—¶slotè¿ç§»å’Œæ•°æ®ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021618d29e4000181d407940754.jpg"></p><h3 id="5-1-æ¯ä¸ªslotçš„è¿ç§»è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š"><a href="#5-1-æ¯ä¸ªslotçš„è¿ç§»è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š" class="headerlink" title="5.1 æ¯ä¸ªslotçš„è¿ç§»è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š"></a>5.1 æ¯ä¸ªslotçš„è¿ç§»è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</h3><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/20212021618d29fe0001b5fc04100474.jpg"></p><ul><li>å¯¹ç›®æ ‡èŠ‚ç‚¹å‘é€cluster setslot {slot_id} importing {sourceNodeId}å‘½ä»¤ï¼Œç›®æ ‡èŠ‚ç‚¹çš„çŠ¶æ€è¢«æ ‡è®°ä¸ºâ€importingâ€ï¼Œå‡†å¤‡å¯¼å…¥è¿™ä¸ªslotçš„æ•°æ®ã€‚</li><li>å¯¹æºèŠ‚ç‚¹å‘é€cluster setslot {slot_id} migrating {targetNodeID}å‘½ä»¤ï¼ŒæºèŠ‚ç‚¹çš„çŠ¶æ€è¢«æ ‡è®°ä¸ºâ€migratingâ€ï¼Œå‡†å¤‡è¿å‡ºslotçš„æ•°æ®ã€‚</li><li>æºèŠ‚ç‚¹æ‰§è¡Œcluster getkeysinslot {slot_id} {count}å‘½ä»¤ï¼Œè·å–è¿™ä¸ªslotçš„æ‰€æœ‰çš„keyåˆ—è¡¨(åˆ†æ‰¹è·å–ï¼ŒcountæŒ‡å®šä¸€æ¬¡è·å–çš„ä¸ªæ•°)ï¼Œç„¶åé’ˆå¯¹æ¯ä¸ªkeyè¿›è¡Œè¿ç§»ã€‚</li><li>åœ¨æºèŠ‚ç‚¹æ‰§è¡Œmigrate {targetIp} {targetPort} â€œâ€ 0 {timeout} keys {keys}å‘½ä»¤ï¼ŒæŠŠä¸€æ‰¹æ‰¹keyè¿ç§»åˆ°ç›®æ ‡èŠ‚ç‚¹(redis-3.0.6ä¹‹å‰ä¸€æ¬¡åªèƒ½è¿ç§»ä¸€ä¸ªkey)ï¼Œå…·ä½“æ¥è¯´ï¼ŒæºèŠ‚ç‚¹å¯¹è¿ç§»çš„keyæ‰§è¡ŒdumpæŒ‡ä»¤å¾—åˆ°åºåˆ—åŒ–å†…å®¹ï¼Œç„¶åé€šè¿‡å®¢æˆ·ç«¯å‘ç›®æ ‡èŠ‚ç‚¹å‘é€æºå¸¦ç€åºåˆ—åŒ–å†…å®¹çš„restoreæŒ‡ä»¤ï¼Œç›®æ ‡èŠ‚ç‚¹è¿›è¡Œååºåˆ—åŒ–åå°†æ¥æ”¶åˆ°çš„å†…å®¹å­˜å…¥è‡ªå·±çš„å†…å­˜ä¸­ï¼Œç›®æ ‡èŠ‚ç‚¹ç»™å®¢æˆ·ç«¯è¿”å›â€OKâ€ï¼Œç„¶åæºèŠ‚ç‚¹åˆ é™¤è¿™ä¸ªkeyï¼Œè¿™æ ·ï¼Œä¸€ä¸ªkeyçš„è¿ç§»è¿‡ç¨‹å°±ç»“æŸäº†ã€‚</li><li>æ‰€æœ‰çš„keyéƒ½è¿ç§»å®Œæˆåï¼Œä¸€ä¸ªslotçš„è¿ç§»å°±ç»“æŸäº†ã€‚</li><li>è¿ç§»æ‰€æœ‰çš„slot(åº”è¯¥è¢«è¿ç§»çš„é‚£äº›)ï¼Œæ‰€æœ‰çš„slotè¿ç§»å®Œæˆåï¼Œæ–°çš„é›†ç¾¤çš„slotå°±é‡æ–°åˆ†é…å®Œæˆäº†ï¼Œå‘é›†ç¾¤å†…æ‰€æœ‰masterå‘é€cluster setslot {slot_id} node {targetNodeId}å‘½ä»¤ï¼Œé€šçŸ¥ä»–ä»¬å“ªäº›æ§½è¢«è¿ç§»åˆ°äº†å“ªäº›masterä¸Šï¼Œè®©å®ƒä»¬æ›´æ–°è‡ªå·±çš„ä¿¡æ¯ã€‚</li></ul><h3 id="5-2-slotè¿ç§»çš„å…¶ä»–è¯´æ˜"><a href="#5-2-slotè¿ç§»çš„å…¶ä»–è¯´æ˜" class="headerlink" title="5.2 slotè¿ç§»çš„å…¶ä»–è¯´æ˜"></a>5.2 slotè¿ç§»çš„å…¶ä»–è¯´æ˜</h3><ul><li>è¿ç§»è¿‡ç¨‹æ˜¯åŒæ­¥çš„ï¼Œåœ¨ç›®æ ‡èŠ‚ç‚¹æ‰§è¡ŒrestoreæŒ‡ä»¤åˆ°åŸèŠ‚ç‚¹åˆ é™¤keyä¹‹é—´ï¼ŒåŸèŠ‚ç‚¹çš„ä¸»çº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€ï¼Œç›´åˆ°keyè¢«åˆ é™¤æˆåŠŸã€‚</li><li>å¦‚æœè¿ç§»è¿‡ç¨‹çªç„¶å‡ºç°ç½‘è·¯æ•…éšœï¼Œæ•´ä¸ªslotè¿ç§»åªè¿›è¡Œäº†ä¸€åŠï¼Œè¿™æ—¶ä¸¤ä¸ªèŠ‚ç‚¹ä»ç„¶ä¼šè¢«æ ‡è®°ä¸ºä¸­é—´è¿‡æ»¤çŠ¶æ€ï¼Œå³â€migratingâ€å’Œâ€importingâ€ï¼Œä¸‹æ¬¡è¿ç§»å·¥å…·è¿æ¥ä¸Šä¹‹åï¼Œä¼šç»§ç»­è¿›è¡Œè¿ç§»ã€‚</li><li>åœ¨è¿ç§»è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ¯ä¸ªkeyçš„å†…å®¹éƒ½å¾ˆå°ï¼Œé‚£ä¹ˆè¿ç§»è¿‡ç¨‹å¾ˆå¿«ï¼Œä¸ä¼šå½±å“åˆ°å®¢æˆ·ç«¯çš„æ­£å¸¸è®¿é—®ã€‚</li><li>å¦‚æœkeyçš„å†…å®¹å¾ˆå¤§ï¼Œç”±äºè¿ç§»ä¸€ä¸ªkeyçš„è¿ç§»è¿‡ç¨‹æ˜¯é˜»å¡çš„ï¼Œå°±ä¼šåŒæ—¶å¯¼è‡´åŸèŠ‚ç‚¹å’Œç›®æ ‡èŠ‚ç‚¹çš„å¡é¡¿ï¼Œå½±å“é›†ç¾¤çš„ç¨³å®šæ€§ï¼Œæ‰€ä»¥ï¼Œé›†ç¾¤ç¯å¢ƒä¸‹ï¼Œä¸šåŠ¡é€»è¾‘è¦å°½å¯èƒ½çš„é¿å…å¤§keyçš„äº§ç”Ÿ ã€‚</li></ul><h3 id="5-3-slotç¼–å·"><a href="#5-3-slotç¼–å·" class="headerlink" title="5.3 slotç¼–å·"></a>5.3 slotç¼–å·</h3><p>æ— éœ€è¦æ±‚æ¯ä¸ªmasterçš„slotç¼–å·æ˜¯è¿ç»­çš„ï¼Œåªè¦æ¯ä¸ªmasterç®¡ç†çš„slotçš„æ•°é‡å‡è¡¡å°±å¯ä»¥ã€‚</p><h3 id="5-4-å‡å°‘èŠ‚ç‚¹-ç¼©å®¹"><a href="#5-4-å‡å°‘èŠ‚ç‚¹-ç¼©å®¹" class="headerlink" title="5.4 å‡å°‘èŠ‚ç‚¹(ç¼©å®¹)"></a>5.4 å‡å°‘èŠ‚ç‚¹(ç¼©å®¹)</h3><p>ç¼©å®¹çš„è¿‡ç¨‹ä¸æ‰©å®¹ç±»ä¼¼ï¼Œåªæ˜¯slotå’Œæ•°æ®ä»ä¸‹çº¿çš„èŠ‚ç‚¹å†…è½¬ç§»åˆ°å…¶ä»–çš„èŠ‚ç‚¹ä¸Šã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021618d2a440001f7e408040754.jpg"></p><h2 id="6-é›†ç¾¤ä¸­æœºå™¨å‡ºç°æ•…éšœ"><a href="#6-é›†ç¾¤ä¸­æœºå™¨å‡ºç°æ•…éšœ" class="headerlink" title="6 é›†ç¾¤ä¸­æœºå™¨å‡ºç°æ•…éšœ"></a>6 é›†ç¾¤ä¸­æœºå™¨å‡ºç°æ•…éšœ</h2><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021618d2a620001c82915881552.jpg"></p><h3 id="6-1-æ•…éšœæ£€æµ‹ï¼ŒèŠ‚ç‚¹å¤±æ•ˆ"><a href="#6-1-æ•…éšœæ£€æµ‹ï¼ŒèŠ‚ç‚¹å¤±æ•ˆ" class="headerlink" title="6.1 æ•…éšœæ£€æµ‹ï¼ŒèŠ‚ç‚¹å¤±æ•ˆ"></a>6.1 æ•…éšœæ£€æµ‹ï¼ŒèŠ‚ç‚¹å¤±æ•ˆ</h3><p>å¦‚æœä¸€ä¸ªèŠ‚ç‚¹è®¤ä¸ºå¦å¤–ä¸€ä¸ªèŠ‚ç‚¹å®•æœºï¼Œé‚£ä¹ˆå°±æ˜¯ pfailï¼Œä¸»è§‚å®•æœºï¼›</p><p>å¦‚æœè¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹éƒ½è®¤ä¸ºå¦å¤–ä¸€ä¸ªèŠ‚ç‚¹å®•æœºäº†ï¼Œé‚£ä¹ˆå°±æ˜¯ failï¼Œå®¢è§‚å®•æœºï¼›</p><h3 id="6-2-æ•…éšœè½¬ç§»ï¼ŒèŠ‚ç‚¹é€‰ä¸¾"><a href="#6-2-æ•…éšœè½¬ç§»ï¼ŒèŠ‚ç‚¹é€‰ä¸¾" class="headerlink" title="6.2 æ•…éšœè½¬ç§»ï¼ŒèŠ‚ç‚¹é€‰ä¸¾"></a>6.2 æ•…éšœè½¬ç§»ï¼ŒèŠ‚ç‚¹é€‰ä¸¾</h3><p>æ¯ä¸ªslaveèŠ‚ç‚¹ï¼Œéƒ½æ ¹æ®è‡ªå·±å¯¹ master å¤åˆ¶æ•°æ®çš„ offsetï¼Œæ¥è®¾ç½®ä¸€ä¸ªé€‰ä¸¾æ—¶é—´ï¼Œoffset è¶Šå¤§ï¼ˆå¤åˆ¶æ•°æ®è¶Šå¤šï¼‰çš„ä»èŠ‚ç‚¹ï¼Œé€‰ä¸¾æ—¶é—´è¶Šé å‰ï¼Œä¼˜å…ˆè¿›è¡Œé€‰ä¸¾ã€‚</p><p>æ‰€æœ‰çš„ master node å¼€å§‹ slave é€‰ä¸¾æŠ•ç¥¨ï¼Œç»™è¦è¿›è¡Œé€‰ä¸¾çš„ slave è¿›è¡ŒæŠ•ç¥¨ï¼Œå¦‚æœå¤§éƒ¨åˆ† master nodeï¼ˆN&#x2F;2 + 1ï¼‰éƒ½æŠ•ç¥¨ç»™äº†æŸä¸ªä»èŠ‚ç‚¹ï¼Œé‚£ä¹ˆé€‰ä¸¾é€šè¿‡ï¼Œé‚£ä¸ªä»èŠ‚ç‚¹å¯ä»¥åˆ‡æ¢æˆ masterã€‚</p><p>ä»èŠ‚ç‚¹æ‰§è¡Œä¸»å¤‡åˆ‡æ¢ï¼Œä»èŠ‚ç‚¹åˆ‡æ¢ä¸ºä¸»èŠ‚ç‚¹ã€‚</p><h2 id="7-ä¸»ä»åŒæ­¥ä»¥åŠé«˜å¯ç”¨"><a href="#7-ä¸»ä»åŒæ­¥ä»¥åŠé«˜å¯ç”¨" class="headerlink" title="7 ä¸»ä»åŒæ­¥ä»¥åŠé«˜å¯ç”¨"></a>7 ä¸»ä»åŒæ­¥ä»¥åŠé«˜å¯ç”¨</h2><p>redisçš„ä¸»ä»åŒæ­¥åœ¨clusterç‰ˆæœ¬ä¹‹å‰å°±å­˜åœ¨äº†ï¼Œæ—¢å¯ä»¥æä¾›æ›´é«˜çš„æŸ¥è¯¢æ•ˆç‡(å¤šslaveå¯ä»¥æŸ¥è¯¢)ï¼Œåˆå¯ä»¥å¢åŠ æœåŠ¡çš„å¯ç”¨æ€§(masteræŒ‚æœºåå¯ä»¥å¯ç”¨slaveæˆä¸ºmaster)ã€‚</p><h3 id="7-1-ä½¿ç”¨ä¸»ä»æ¶æ„æ—¶"><a href="#7-1-ä½¿ç”¨ä¸»ä»æ¶æ„æ—¶" class="headerlink" title="7.1 ä½¿ç”¨ä¸»ä»æ¶æ„æ—¶"></a>7.1 ä½¿ç”¨ä¸»ä»æ¶æ„æ—¶</h3><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021618d2a7f00014f8907000367.jpg"></p><p>å°†åªæœ‰ä¸€ä¸ª Master å’Œå¤šä¸ªä»å±ç”¨äºå¤åˆ¶ã€‚</p><p>æ‰€æœ‰å†™å…¥éƒ½è½¬åˆ°ä¸»èŠ‚ç‚¹ï¼Œè¿™ä¼šåœ¨ä¸»èŠ‚ç‚¹ä¸Šäº§ç”Ÿæ›´å¤šè´Ÿè½½ã€‚</p><p>å¦‚æœMasterå®•æœºï¼Œæ•´ä¸ªæ¶æ„å®¹æ˜“å‡ºç°SPOFï¼ˆå•ç‚¹æ•…éšœï¼‰ã€‚</p><p>å½“æ‚¨çš„ç”¨æˆ·ç¾¤å¢é•¿æ—¶ï¼ŒMS æ¶æ„æ— åŠ©äºæ‰©å±•ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªè¿›ç¨‹æ¥åœ¨å‘ç”Ÿæ•…éšœæˆ–å…³é—­çš„æƒ…å†µä¸‹ç›‘æ§ Masterï¼Œé‚£å°±æ˜¯ Sentinelã€‚</p><h3 id="7-2-Rediså“¨å…µ"><a href="#7-2-Rediså“¨å…µ" class="headerlink" title="7.2 Rediså“¨å…µ"></a>7.2 Rediså“¨å…µ</h3><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021618d2aac000172c310240561.jpg"></p><p><strong>æ•…éšœè½¬ç§»å¤„ç†</strong></p><p><strong><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021618d2acc0001dd0307000388.jpg"></strong></p><h2 id="8-ä¸»ä»åŒæ­¥ä¸æ•°æ®ä¸€è‡´æ€§"><a href="#8-ä¸»ä»åŒæ­¥ä¸æ•°æ®ä¸€è‡´æ€§" class="headerlink" title="8 ä¸»ä»åŒæ­¥ä¸æ•°æ®ä¸€è‡´æ€§"></a>8 ä¸»ä»åŒæ­¥ä¸æ•°æ®ä¸€è‡´æ€§</h2><h3 id="8-1-ä¸»ä»åŒæ­¥çš„å®ç°è¿‡ç¨‹"><a href="#8-1-ä¸»ä»åŒæ­¥çš„å®ç°è¿‡ç¨‹" class="headerlink" title="8.1 ä¸»ä»åŒæ­¥çš„å®ç°è¿‡ç¨‹"></a>8.1 ä¸»ä»åŒæ­¥çš„å®ç°è¿‡ç¨‹</h3><p>ä¸»ä»åŒæ­¥åˆ†ä¸º 2 ä¸ªæ­¥éª¤ï¼šåŒæ­¥å’Œå‘½ä»¤ä¼ æ’­ã€‚</p><p>æ•°æ®åŒæ­¥æœ‰syncå’Œpsyncã€‚</p><p>syncå…¨é‡åŒæ­¥ï¼Œæ€§èƒ½æ¯”è¾ƒå·®ï¼›psyncå¢é‡åŒæ­¥ï¼Œé€Ÿåº¦å’Œå®æ—¶æ€§å¥½å¾ˆå¤šã€‚</p><h3 id="8-2-å…¨é‡åŒæ­¥-sync"><a href="#8-2-å…¨é‡åŒæ­¥-sync" class="headerlink" title="8.2 å…¨é‡åŒæ­¥ sync"></a>8.2 å…¨é‡åŒæ­¥ sync</h3><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021618d2ae90001d7d505120257.jpg"></p><p>ä»æœåŠ¡å™¨å¯¹ä¸»æœåŠ¡çš„åŒæ­¥æ“ä½œï¼Œéœ€è¦é€šè¿‡ sync å‘½ä»¤æ¥å®ç°ï¼Œä»¥ä¸‹æ˜¯ sync å‘½ä»¤çš„æ‰§è¡Œæ­¥éª¤ï¼š</p><ul><li>ä»æœåŠ¡å™¨å‘ä¸»æœåŠ¡å™¨å‘é€ sync å‘½ä»¤</li><li>æ”¶åˆ° sync å‘½ä»¤åï¼Œä¸»æœåŠ¡å™¨æ‰§è¡Œ bgsave å‘½ä»¤ï¼Œç”¨æ¥ç”Ÿæˆ rdb æ–‡ä»¶ï¼Œå¹¶åœ¨ä¸€ä¸ªç¼“å†²åŒºä¸­è®°å½•ä»ç°åœ¨å¼€å§‹æ‰§è¡Œçš„å†™å‘½ä»¤ã€‚</li><li>bgsave æ‰§è¡Œå®Œæˆåï¼Œå°†ç”Ÿæˆçš„ rdb æ–‡ä»¶å‘é€ç»™ä»æœåŠ¡å™¨ï¼Œç”¨æ¥ç»™ä»æœåŠ¡å™¨æ›´æ–°æ•°æ®</li><li>ä¸»æœåŠ¡å™¨å†å°†ç¼“å†²åŒºè®°å½•çš„å†™å‘½ä»¤å‘é€ç»™ä»æœåŠ¡å™¨ï¼Œä»æœåŠ¡å™¨æ‰§è¡Œå®Œè¿™äº›å†™å‘½ä»¤åï¼Œæ­¤æ—¶çš„æ•°æ®åº“çŠ¶æ€ä¾¿å’Œä¸»æœåŠ¡å™¨ä¸€è‡´äº†ã€‚</li></ul><h3 id="8-3-éƒ¨åˆ†é‡åŒæ­¥-psync"><a href="#8-3-éƒ¨åˆ†é‡åŒæ­¥-psync" class="headerlink" title="8.3 éƒ¨åˆ†é‡åŒæ­¥ psync"></a>8.3 éƒ¨åˆ†é‡åŒæ­¥ psync</h3><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021618d2afc00015a1808000549.jpg"></p><p>éƒ¨åˆ†é‡åŒæ­¥åŠŸèƒ½ç”±ä»¥ä¸‹ 3 éƒ¨åˆ†ç»„æˆï¼š</p><ul><li>ä¸»ä»æœåŠ¡å™¨çš„å¤åˆ¶åç§»é‡</li><li>ä¸»æœåŠ¡å™¨çš„å¤åˆ¶ç§¯å‹ç¼“å†²åŒº</li><li>æœåŠ¡å™¨çš„è¿è¡Œ idï¼ˆrun idï¼‰</li></ul><h3 id="8-4-å¿ƒè·³æ£€æµ‹"><a href="#8-4-å¿ƒè·³æ£€æµ‹" class="headerlink" title="8.4 å¿ƒè·³æ£€æµ‹"></a>8.4 å¿ƒè·³æ£€æµ‹</h3><p>å½“å®Œæˆäº†åŒæ­¥ä¹‹åï¼Œä¸»ä»æœåŠ¡å™¨å°±ä¼šè¿›å…¥å‘½ä»¤ä¼ æ’­é˜¶æ®µï¼Œæ­¤æ—¶ä»æœåŠ¡å™¨ä¼šä»¥æ¯ç§’ 1 æ¬¡çš„é¢‘ç‡ï¼Œå‘ä¸»æœåŠ¡å™¨å‘é€å‘½ä»¤ï¼šREPLCONF ACK <replication_offset> å…¶ä¸­ replication_offset æ˜¯ä»æœåŠ¡å™¨å½“å‰çš„å¤åˆ¶åç§»é‡</p><p><strong>å‘é€è¿™ä¸ªå‘½ä»¤ä¸»è¦æœ‰ä¸‰ä¸ªä½œç”¨ï¼š</strong></p><ul><li>æ£€æµ‹ä¸»ä»æœåŠ¡å™¨çš„ç½‘ç»œçŠ¶æ€</li><li>è¾…åŠ©å®ç° min-slaves é€‰é¡¹</li><li>æ£€æµ‹å‘½ä»¤ä¸¢å¤±ï¼ˆè‹¥ä¸¢å¤±ï¼Œä¸»æœåŠ¡å™¨ä¼šå°†ä¸¢å¤±çš„å†™å‘½ä»¤é‡æ–°å‘ç»™ä»æœåŠ¡å™¨ï¼‰</li></ul><h3 id="8-5-ä¸»ä»åŒæ­¥æ€»ç»“"><a href="#8-5-ä¸»ä»åŒæ­¥æ€»ç»“" class="headerlink" title="8.5 ä¸»ä»åŒæ­¥æ€»ç»“"></a>8.5 ä¸»ä»åŒæ­¥æ€»ç»“</h3><p>å‘é€ SLAVEOF å‘½ä»¤å¯ä»¥è¿›è¡Œä¸»ä»åŒæ­¥ï¼Œæ¯”å¦‚ï¼šSLAVEOF 127.0.0.1 6379</p><p><strong>ä¸»ä»åŒæ­¥æœ‰åŒæ­¥å’Œå‘½ä»¤ä¼ æ’­ 2 ä¸ªæ­¥éª¤</strong></p><ul><li>åŒæ­¥ï¼šå°†ä»æœåŠ¡å™¨çš„æ•°æ®åº“çŠ¶æ€æ›´æ–°æˆä¸»æœåŠ¡å™¨å½“å‰çš„æ•°æ®åº“çŠ¶æ€ï¼ˆä¸€ä¸ªæ¶ˆè€—èµ„æºçš„æ“ä½œï¼‰</li><li>å‘½ä»¤ä¼ æ’­ï¼šå½“ä¸»æœåŠ¡å™¨æ•°æ®åº“çŠ¶æ€è¢«ä¿®æ”¹åï¼Œå¯¼è‡´ä¸»ä»æœåŠ¡å™¨æ•°æ®åº“çŠ¶æ€ä¸ä¸€è‡´ï¼Œæ­¤æ—¶éœ€è¦è®©ä¸»ä»æ•°æ®åŒæ­¥åˆ°ä¸€è‡´çš„è¿‡ç¨‹</li></ul><p><strong>ä¸»ä»åŒæ­¥åˆ†åˆæ¬¡å¤åˆ¶å’Œæ–­çº¿åé‡å¤åˆ¶ä¸¤ç§æƒ…å†µ</strong></p><ul><li>ä» 2.8 ç‰ˆæœ¬å¼€å§‹ï¼Œåœ¨å‡ºç°æ–­çº¿åé‡å¤åˆ¶æƒ…å†µæ—¶ï¼Œä¸»æœåŠ¡å™¨ä¼šæ ¹æ®å¤åˆ¶åç§»é‡ã€å¤åˆ¶ç§¯å‹ç¼“å†²åŒºå’Œ run idï¼Œæ¥ç¡®å®šæ‰§è¡Œå®Œæ•´é‡åŒæ­¥è¿˜æ˜¯éƒ¨åˆ†é‡åŒæ­¥</li><li>2.8 ç‰ˆæœ¬ä½¿ç”¨ psync å‘½ä»¤æ¥ä»£æ›¿ sync å‘½ä»¤å»æ‰§è¡ŒåŒæ­¥æ“ä½œã€‚ç›®çš„æ˜¯ä¸ºäº†è§£å†³åŒæ­¥ï¼ˆsync å‘½ä»¤ï¼‰çš„ä½æ•ˆæ“ä½œ</li></ul><h2 id="é—®é¢˜1ï¼šé›†ç¾¤çš„è§„æ¨¡èƒ½å¦æ— é™å¤§ï¼Œæ¯”å¦‚ï¼š1wå°æœºå™¨ï¼Ÿ"><a href="#é—®é¢˜1ï¼šé›†ç¾¤çš„è§„æ¨¡èƒ½å¦æ— é™å¤§ï¼Œæ¯”å¦‚ï¼š1wå°æœºå™¨ï¼Ÿ" class="headerlink" title="é—®é¢˜1ï¼šé›†ç¾¤çš„è§„æ¨¡èƒ½å¦æ— é™å¤§ï¼Œæ¯”å¦‚ï¼š1wå°æœºå™¨ï¼Ÿ"></a>é—®é¢˜1ï¼šé›†ç¾¤çš„è§„æ¨¡èƒ½å¦æ— é™å¤§ï¼Œæ¯”å¦‚ï¼š1wå°æœºå™¨ï¼Ÿ</h2><p>ç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œredis å®˜æ–¹ç»™çš„ Redis Cluster çš„è§„æ¨¡ä¸Šé™æ˜¯ 1000 ä¸ªå®ä¾‹ã€‚</p><p>é™åˆ¶çš„åŸå› ï¼Œå…³é”®åœ¨äºå®ä¾‹é—´çš„é€šä¿¡å¼€é”€ï¼Œé›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¿å­˜æ‰€æœ‰å“ˆå¸Œæ§½ä¸èŠ‚ç‚¹å¯¹åº”å…³ç³»ä¿¡æ¯ï¼ˆSlot æ˜ å°„åˆ°èŠ‚ç‚¹çš„è¡¨ï¼‰ï¼Œä»¥åŠè‡ªèº«çš„çŠ¶æ€ä¿¡æ¯ã€‚</p><p>å‚ç…§3.2gossipåè®®å¹¿æ’­æ–¹å¼ï¼ŒèŠ‚ç‚¹è¶Šå¤šï¼Œå¹¿æ’­é£æš´å¯¹äºç½‘ç»œä»¥åŠæœåŠ¡å™¨å‹åŠ›ä¹Ÿå°±è¶Šå¤§ã€‚</p><p>è™½ç„¶å¯ä»¥è®¾ç½®å¹¿æ’­æ¶ˆæ¯åŒæ­¥çš„è¶…æ—¶æ—¶é—´ï¼Œä½†æ˜¯èŠ‚ç‚¹å¢å¤šã€è¶…æ—¶æ—¶é—´å˜é•¿ä¹‹åï¼Œæ•°æ®ä¸€è‡´æ€§çš„æ¶ˆæ¯åŒæ­¥å»¶æ—¶ä¹Ÿä¼šæ›´å¤§ï¼Œå‡ºç°å…ƒæ•°æ®ä¸ä¸€è‡´çš„å¯èƒ½æ€§ä¹Ÿä¼šå¢åŠ ã€‚</p><h2 id="é—®é¢˜2ï¼šä»åº“çš„ä½¿ç”¨ï¼Œä»¥åŠå¦‚ä½•æƒè¡¡ï¼Ÿ"><a href="#é—®é¢˜2ï¼šä»åº“çš„ä½¿ç”¨ï¼Œä»¥åŠå¦‚ä½•æƒè¡¡ï¼Ÿ" class="headerlink" title="é—®é¢˜2ï¼šä»åº“çš„ä½¿ç”¨ï¼Œä»¥åŠå¦‚ä½•æƒè¡¡ï¼Ÿ"></a>é—®é¢˜2ï¼šä»åº“çš„ä½¿ç”¨ï¼Œä»¥åŠå¦‚ä½•æƒè¡¡ï¼Ÿ</h2><p>ä»åº“çš„ä½œç”¨ï¼Œä¸€æ˜¯æé«˜å¯ç”¨æ€§ï¼Œå½“ä¸»åº“å®•æœºä¹‹åï¼Œå¯ä»¥ç«‹å³å¯ç”¨ä»åº“ä½œä¸ºä¸»åº“æä¾›æœåŠ¡ï¼›ä¸€æ˜¯æé«˜ä¼¸ç¼©æ€§ï¼Œæé«˜äº†æ•°æ®æŸ¥è¯¢å¹¶å‘èƒ½åŠ›ï¼Œä»åº“æä¾›æŸ¥è¯¢æœåŠ¡å°±å¢åŠ äº†æœåŠ¡èµ„æºï¼Œæ›´å¤šçš„èŠ‚ç‚¹æ¥æ”¯æŒæŸ¥è¯¢ã€‚</p><p>ç”±äºä¸»ä»åŒæ­¥å­˜åœ¨æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨ä»åº“çš„è¿‡ç¨‹ä¸­ï¼Œç›¸åº”çš„ä¹Ÿå°±ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ã€‚</p><p>æ¯”å¦‚ï¼šå› ä¸ºä»åº“æ•°æ®åŒæ­¥æ…¢äº†ï¼Œè¿™æ—¶å€™ä¸»åº“å®•æœºäº†ï¼Œæ•°æ®ä¸å®Œæ•´çš„ä»åº“ä½œä¸ºä¸»åº“ï¼Œå°±ä¼šå‡ºç°æ•°æ®ä¸¢å¤±çš„æƒ…å†µã€‚ä»åº“ç”¨æ¥æŸ¥è¯¢ä¹Ÿæœ‰ç±»ä¼¼é—®é¢˜ï¼Œå®æ—¶å†™å…¥çš„æ–°æ•°æ®ï¼ŒåŒæ­¥åˆ°ä»åº“å¯èƒ½ä¼šæœ‰å»¶æ—¶ï¼Œåœ¨æ•°æ®æ²¡æœ‰åŒæ­¥åˆ°ä»åº“çš„æ—¶å€™æŸ¥è¯¢ä»åº“ï¼Œä¹Ÿä¼šå‡ºç°æŸ¥è¯¢æ— æ•°æ®çš„æƒ…å†µã€‚</p><p>æ‰€ä»¥åœ¨ä½¿ç”¨ä»åº“çš„æƒ…å†µä¸‹ï¼Œéœ€è¦è€ƒè™‘åˆ°ä¸Šé¢çš„é—®é¢˜ã€‚</p><p>é¢å¯¹å®•æœºçš„æ—¶å€™ï¼Œæ•°æ®ä¸¢å¤±çš„é—®é¢˜ï¼Œå†…å­˜å‹æ•°æ®åº“éƒ½ä¼šå­˜åœ¨çš„é£é™©ï¼Œä½¿ç”¨rediséƒ½éœ€è¦é¢å¯¹è¿™ä¸ªé£é™©ï¼Œå¦åˆ™å°±è¦ç‰ºç‰²æ€§èƒ½é«˜æ­£æ•°æ®ä¸€è‡´æ€§ï¼Œredisæ•°æ®å…ˆæŒä¹…åŒ–å†æä¾›æœåŠ¡ï¼Œè¿™æ ·æ€§èƒ½å°±ä¼šä¸‹é™éå¸¸æ˜æ˜¾äº†ï¼Œæ²¡æ³•æ»¡è¶³å†…å­˜æ€§æ•°æ®åº“çš„ä¼˜åŠ¿äº†ã€‚</p><p>å¯ç”¨ä»åº“æŸ¥è¯¢ï¼Œå¯ä»¥é’ˆå¯¹ä¸€äº›æ•°æ®æ›´æ–°çš„å®æ—¶æ€§è¾ƒä½ï¼Œå¯¹äºè„æ•°æ®ä¸é‚£ä¹ˆæ•æ„Ÿçš„ä¸šåŠ¡ï¼Œæˆ–è€…æŸ¥è¯¢é‡å®åœ¨å¤ªå¤§è€Œå¯ä»¥å¿½ç•¥éƒ¨åˆ†æ•°æ®å»¶æ—¶çš„å½±å“ã€‚</p><h2 id="é—®é¢˜3ï¼šredisé›†ç¾¤åŒ–ä¹‹åï¼Œä»£ç†çš„å¿…è¦æ€§ï¼Ÿ"><a href="#é—®é¢˜3ï¼šredisé›†ç¾¤åŒ–ä¹‹åï¼Œä»£ç†çš„å¿…è¦æ€§ï¼Ÿ" class="headerlink" title="é—®é¢˜3ï¼šredisé›†ç¾¤åŒ–ä¹‹åï¼Œä»£ç†çš„å¿…è¦æ€§ï¼Ÿ"></a>é—®é¢˜3ï¼šredisé›†ç¾¤åŒ–ä¹‹åï¼Œä»£ç†çš„å¿…è¦æ€§ï¼Ÿ</h2><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021618d2b1e0001dedc09140761.jpg"></p><p>ä»£ç†çš„æ€§èƒ½å’Œç¨³å®šæ€§åŒæ ·æ˜¯é—®é¢˜æ‰€åœ¨ã€‚</p><p>äº§å“çš„è¿ç»´éš¾åº¦ä»¥åŠæŒç»­çš„ç»´æŠ¤ï¼Œè¿˜æ˜¯å®˜æ–¹çš„redis clusteræ›´åŠ å¯é ã€‚</p><p>æœ‰æ¡ä»¶çš„å›¢é˜Ÿï¼Œé’ˆå¯¹redis clusterçš„ä¸è¶³ï¼Œè¿˜ä¼šæœ‰æ›´æ·±å…¥çš„ä¼˜åŒ–ï¼Œæ¯”å¦‚å’±ä»¬è‡ªå·±ç ”å‘çš„tendisã€‚</p><h2 id="é—®é¢˜4ï¼šå•keyçš„ç™¾ä¸‡qpsé™é¢‘é—®é¢˜ï¼Ÿï¼ˆå¾…è§£ï¼‰"><a href="#é—®é¢˜4ï¼šå•keyçš„ç™¾ä¸‡qpsé™é¢‘é—®é¢˜ï¼Ÿï¼ˆå¾…è§£ï¼‰" class="headerlink" title="é—®é¢˜4ï¼šå•keyçš„ç™¾ä¸‡qpsé™é¢‘é—®é¢˜ï¼Ÿï¼ˆå¾…è§£ï¼‰"></a>é—®é¢˜4ï¼šå•keyçš„ç™¾ä¸‡qpsé™é¢‘é—®é¢˜ï¼Ÿï¼ˆå¾…è§£ï¼‰</h2><p>å•keyçš„é¢‘ç¹æ›´æ–°ï¼Œç”±äºå•ä¸ªkeyæœ‰ä¸”åªèƒ½è½åœ°åˆ°ä¸€ä¸ªmasterèŠ‚ç‚¹çš„ä¸€ä¸ªslotä¸Šé¢ï¼Œæ— æ³•é€šè¿‡å¢åŠ èŠ‚ç‚¹å¢åŠ slaveçš„æ–¹æ³•æ‰©å®¹ï¼Œæ€§èƒ½ç“¶é¢ˆå°±ä¼šå—é™äºæœºå™¨çš„CPU&#x2F;å†…å­˜çš„è¯»å†™èƒ½åŠ›äº†ã€‚</p><p>å‡è®¾å•æœºæœ€é«˜10wçš„å†™å¦‚é€Ÿåº¦ï¼Œé‚£ä¹ˆï¼Œè¦å®ç°æ¥å£çš„100wçš„qpsé™é¢‘åŠŸèƒ½ï¼Œè¦æ€ä¹ˆå®ç°å‘¢ï¼Ÿ</p><p><strong>è¯·è¾“å‡ºä½ çš„è§£ç­”ã€‚ã€‚ã€‚</strong></p><h2 id="é™„-è„‘æ´ï¼šä¸‰ä½“äººæ¥åˆ°åœ°çƒï¼Œè¦æ¶ˆç­è¿‘åŠçš„åœ°çƒäººï¼ˆå¾…è§£ï¼‰"><a href="#é™„-è„‘æ´ï¼šä¸‰ä½“äººæ¥åˆ°åœ°çƒï¼Œè¦æ¶ˆç­è¿‘åŠçš„åœ°çƒäººï¼ˆå¾…è§£ï¼‰" class="headerlink" title="é™„-è„‘æ´ï¼šä¸‰ä½“äººæ¥åˆ°åœ°çƒï¼Œè¦æ¶ˆç­è¿‘åŠçš„åœ°çƒäººï¼ˆå¾…è§£ï¼‰"></a>é™„-è„‘æ´ï¼šä¸‰ä½“äººæ¥åˆ°åœ°çƒï¼Œè¦æ¶ˆç­è¿‘åŠçš„åœ°çƒäººï¼ˆå¾…è§£ï¼‰</h2><p>ä¸‰ä½“äººä¸åƒç­éœ¸ï¼Œç›´æ¥ç”¨æ‰‹å¥—ç®€å•ç²—æš´çš„ä¸€ä¸ªå“æŒ‡å°±æ¯ç­ä¸€åŠç”Ÿçµï¼Œè€Œæ˜¯ç»™æ¯ä¸ªäººä¸€ä¸ªé€‰æ‹©ï¼Œé€‰æ‹©å¯¹çš„äººå°±æœ‰æœºä¼šç”Ÿå­˜ä¸‹æ¥ã€‚</p><p>è¿™ä¸ªé€‰æ‹©çš„æ–¹æ³•ä¹Ÿç‰¹åˆ«ç®€å•ï¼Œä½†æ˜¯éœ€è¦å¼€å‘ä¸€å¥—ç³»ç»Ÿæ¥æ”¯æŒã€‚</p><p>é‚£ä¹ˆè¿™å¥—ç³»ç»Ÿçš„å¼€å‘å·¥ä½œå°±è½åœ¨äº†åœ°çƒäººæœ€èªæ˜çš„ç¨‹åºå‘˜ä½ çš„å¤´ä¸Šã€‚</p><p>å¼€å‘å¥½äº†å¯ä»¥è®©è‡ªå·±ä»¥åŠå®¶äººè·å¾—è±å…æƒè€Œç”Ÿå­˜ä¸‹æ¥ï¼Œå¼€å‘çš„ä¸å¥½ï¼Œç›´æ¥å’”åš“ã€‚</p><h3 id="è¿™ä¸ªé€‰æ‹©çš„æè¿°å¦‚ä¸‹"><a href="#è¿™ä¸ªé€‰æ‹©çš„æè¿°å¦‚ä¸‹" class="headerlink" title="è¿™ä¸ªé€‰æ‹©çš„æè¿°å¦‚ä¸‹"></a>è¿™ä¸ªé€‰æ‹©çš„æè¿°å¦‚ä¸‹</h3><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021618d2f7100013d8503780236.jpg" alt="https://img3.sycdn.imooc.com/618d2f7100013d8503780236.jpg"></p><p>å…¨çƒæœ‰ä¸€ä¸ªä¸‰ä½“äººçš„ç¯çƒï¼Œé»˜è®¤æ˜¯ç†„ç­çŠ¶æ€ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021618d2f8200019e2805120246.jpg" alt="https://img3.sycdn.imooc.com/618d2f8200019e2805120246.jpg"></p><p>æ¯ä¸ªäººä¼šæœ‰ä¸€ä¸ªä¸‰ä½“äººçš„å¼€å…³ï¼Œä¸Šé¢ä¼šæ˜¾ç¤ºå½“å‰ç¯çƒçš„çŠ¶æ€(ç†„ç­æˆ–è€…äº®èµ·)ï¼Œæœ‰ä¸¤ä¸ªæ“ä½œæŒ‰é’®ï¼Œåˆ†åˆ«æ˜¯æ§åˆ¶ç¯çƒçš„ç†„ç­å’Œäº®èµ·ã€‚æ¯ä¸ªäººåªæœ‰ä¸€æ¬¡é€‰æ‹©æœºä¼šï¼Œä¸¤ä¸ªæŒ‰é’®åªèƒ½é€‰æ‹©ä¸€ä¸ªæŒ‰é’®ï¼ŒæŒ‰ä¸€æ¬¡ã€‚å¦‚æœä¸€ä¸ªæŒ‰é’®éƒ½ä¸é€‰æ‹©ï¼Œä¸æŒ‰çš„è¯ï¼Œæ— è®ºç¯çƒæœ€ç»ˆçŠ¶æ€å¦‚ä½•ï¼Œéƒ½æ˜¯è¦è¢«æ¶ˆç­ã€‚å°å­©å­æˆ–è€…è€äººã€æ®‹ç–¾äººï¼Œå¯ä»¥ç”±ç›‘æŠ¤äººæ¥è¾…åŠ©å…¶å®Œæˆé€‰æ‹©ã€‚</p><h3 id="ç³»ç»Ÿå®ç°çš„å‰ææ¡ä»¶å’Œéœ€æ±‚"><a href="#ç³»ç»Ÿå®ç°çš„å‰ææ¡ä»¶å’Œéœ€æ±‚" class="headerlink" title="ç³»ç»Ÿå®ç°çš„å‰ææ¡ä»¶å’Œéœ€æ±‚"></a>ç³»ç»Ÿå®ç°çš„å‰ææ¡ä»¶å’Œéœ€æ±‚</h3><p><strong>å‰ææ¡ä»¶è¯´æ˜</strong></p><p>1 å…¨çƒ80äº¿äººå£ï¼Œå¿…é¡»åŒæ—¶åœ¨1åˆ†é’Ÿæ—¶é—´å†…å®Œæˆé€‰æ‹©ï¼ˆä¸‰ä½“äººçš„å¼€å…³ï¼Œå…¨çƒå®æ—¶çŠ¶æ€åŒæ­¥ï¼Œæ— æ—¶é—´åå·®ï¼Œæ— æ—¶å»¶ï¼‰ï¼Œè§„å®šæ—¶é—´èŒƒå›´ä¹‹å¤–æ— æ³•æ“ä½œï¼›</p><p>2 ä¸‰ä½“äººæä¾›1000å°128æ ¸256Gå†…å­˜1Tç£ç›˜çš„æœåŠ¡å™¨ï¼Œä¸‰ä½“äººçš„å¼€å…³ä¸æœåŠ¡å™¨çš„ç½‘ç»œæ˜¯ç›´è¿çš„ï¼Œæ²¡æœ‰æ—¶å»¶ï¼Œæ²¡æœ‰ç½‘ç»œå¼€é”€ï¼›</p><p>3 å…¨çƒ80äº¿äººï¼Œæ¯ä¸ªäººéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ä»0å¼€å§‹è‡ªå¢çš„æ•°å­—IDï¼Œä¸ä¸‰ä½“äººçš„å¼€å…³ä¹Ÿæ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼›</p><p>4 æ¯ä¸ªäººçš„ID%1000æŒ‡å‘ç‰¹å®šæœåŠ¡å™¨ï¼Œè¯·æ±‚ç³»ç»Ÿæä¾›çš„æ¥å£ &#x2F;vote</p><p><strong>ç³»ç»Ÿéœ€æ±‚</strong></p><p>åŠŸèƒ½ï¼Œå¼€å‘è¿™ä¸ªæŠ•ç¥¨æ¥å£(æ‰€æœ‰è¯·æ±‚åªä¼šåœ¨è¿™1åˆ†é’Ÿå†…è¯·æ±‚)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/vote?uid=1111&amp;click=1&amp;t=1234143134134134134</span><br></pre></td></tr></table></figure><p><strong>å‚æ•°</strong> </p><p>uid é•¿æ•´å‹ï¼Œæ¯ä¸ªäººçš„å”¯ä¸€ID</p><p>click æšä¸¾å€¼ï¼ŒæŒ‰é’®é€‰æ‹©ï¼Œ0 ç†„ç­ï¼Œ1 äº®èµ·</p><p>t é•¿æ•´å‹ï¼Œæ“ä½œæ—¶é—´ï¼Œå•ä½çº³ç§’</p><p><strong>å¤„ç†</strong></p><p>1 åœ¨åŒä¸€ä¸ªæ—¶åˆ»(åŒä¸€çº³ç§’)ï¼Œå¦‚æœæœ‰å¤šä¸ªäººæ“ä½œï¼Œé€‰æ‹©æ¬¡æ•°å¤šçš„ç”Ÿæ•ˆï¼Œå¦‚æœ2ä¸ªé€‰æ‹©æ¬¡æ•°ç›¸åŒï¼ŒçŠ¶æ€ä¸å˜ã€‚å¦‚ï¼šç†„ç­2æ¬¡ï¼Œäº®èµ·3æ¬¡ï¼Œè¿™ä¸ªæ—¶åˆ»çš„çŠ¶æ€æ˜¯äº®èµ·ã€‚</p><p><strong>ç»“æœæ•°æ®</strong></p><p>1 æœ€ç»ˆç¯çƒçš„çŠ¶æ€ï¼Œæ˜¯ç†„ç­ï¼Œè¿˜æ˜¯äº®èµ·ï¼›</p><p>2 é€‰æ‹©æ­£ç¡®çš„äºº(IDé›†åˆ);</p><p>3 é€‰æ‹©é”™è¯¯çš„äºº(IDé›†åˆ);</p><p>4 æ²¡æœ‰åšå‡ºé€‰æ‹©çš„äºº(IDé›†åˆ)ï¼›</p><p><strong>æœ€ç»ˆæ‰§è¡Œ</strong></p><p>è°ƒç”¨ä¸‰ä½“äººåœ¨æœåŠ¡å™¨ä¸Šå®‰è£…çš„ç³»ç»Ÿç¨‹åº ï¼Œå®Œæˆåœ°çƒäººæ¶ˆç­è®¡åˆ’ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill uid</span><br></pre></td></tr></table></figure><p>è°ƒç”¨ä¸‰ä½“äººçš„ç³»ç»Ÿç¨‹åºæ— å»¶æ—¶ï¼Œç­‰åŒäºå†…å­˜è¯»å–çš„æ•ˆç‡ã€‚</p><p>è¦æ±‚åœ¨1åˆ†é’Ÿæ—¶é—´å†…ï¼ŒæŠŠé€‰æ‹©é”™è¯¯çš„äººå’Œæ²¡æœ‰åšå‡ºé€‰æ‹©çš„äººæ¶ˆç­æ‰ã€‚</p><p><strong>æ¨¡æ‹Ÿæµ‹è¯•</strong></p><p>1 ä¸‰ä½“äººåœ¨1åˆ†é’Ÿå†…å¯¼å…¥æµ‹è¯•ç”¨ä¾‹ï¼Œå®Œæˆ80äº¿äººçš„é€‰æ‹©ã€‚</p><p>2 1åˆ†é’Ÿæ­£ç¡®æ‰§è¡Œå®Œæˆ kill è°ƒç”¨ã€‚</p><p>å¦‚æœæ— æ³•å®ç°ä¸Šè¿°å·¥ä½œï¼Œå¤±è´¥ã€‚</p><p><strong>è¯·è¾“å‡ºä½ çš„è§£ç­”ã€‚ã€‚ã€‚</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> é¢ç» </tag>
            
            <tag> redis </tag>
            
            <tag> redisé›†ç¾¤ </tag>
            
            <tag> æ¶æ„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springå¸¸è§é¢è¯•é¢˜</title>
      <link href="/posts/5dd00982.html"/>
      <url>/posts/5dd00982.html</url>
      
        <content type="html"><![CDATA[<hr><span id="more"></span><h2 id="åŸºæœ¬æ€æƒ³"><a href="#åŸºæœ¬æ€æƒ³" class="headerlink" title="åŸºæœ¬æ€æƒ³"></a>åŸºæœ¬æ€æƒ³</h2><h3 id="IOCæ§åˆ¶åè½¬"><a href="#IOCæ§åˆ¶åè½¬" class="headerlink" title="IOCæ§åˆ¶åè½¬"></a>IOCæ§åˆ¶åè½¬</h3><h3 id="AOPåŠ¨æ€ä»£ç†"><a href="#AOPåŠ¨æ€ä»£ç†" class="headerlink" title="AOPåŠ¨æ€ä»£ç†"></a>AOPåŠ¨æ€ä»£ç†</h3><h4 id="AOPçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#AOPçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="AOPçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"></a>AOPçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</h4><h4 id="JDKåŠ¨æ€ä»£ç†å’ŒCGLIBåŠ¨æ€ä»£ç†åœ¨å®ç°ä¸Šæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå„æœ‰ä»€ä¹ˆä¼˜åŠ£"><a href="#JDKåŠ¨æ€ä»£ç†å’ŒCGLIBåŠ¨æ€ä»£ç†åœ¨å®ç°ä¸Šæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå„æœ‰ä»€ä¹ˆä¼˜åŠ£" class="headerlink" title="JDKåŠ¨æ€ä»£ç†å’ŒCGLIBåŠ¨æ€ä»£ç†åœ¨å®ç°ä¸Šæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå„æœ‰ä»€ä¹ˆä¼˜åŠ£"></a>JDKåŠ¨æ€ä»£ç†å’ŒCGLIBåŠ¨æ€ä»£ç†åœ¨å®ç°ä¸Šæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå„æœ‰ä»€ä¹ˆä¼˜åŠ£</h4><h2 id="æµç¨‹ä»¥åŠBeanç”Ÿå‘½å‘¨æœŸ"><a href="#æµç¨‹ä»¥åŠBeanç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="æµç¨‹ä»¥åŠBeanç”Ÿå‘½å‘¨æœŸ"></a>æµç¨‹ä»¥åŠBeanç”Ÿå‘½å‘¨æœŸ</h2><h3 id="å·¥ä½œæµç¨‹"><a href="#å·¥ä½œæµç¨‹" class="headerlink" title="å·¥ä½œæµç¨‹"></a>å·¥ä½œæµç¨‹</h3><h4 id="SpringMVCå·¥ä½œæµç¨‹"><a href="#SpringMVCå·¥ä½œæµç¨‹" class="headerlink" title="SpringMVCå·¥ä½œæµç¨‹"></a>SpringMVCå·¥ä½œæµç¨‹</h4><ol><li>ç”¨æˆ·å‘æœåŠ¡ç«¯å‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚ä¼šå…ˆåˆ°å‰ç«¯æ§åˆ¶å™¨DispatcherServlet(ä¹Ÿå«ä¸­å¤®æ§åˆ¶å™¨)ã€‚</li><li>DispatcherServletæ¥æ”¶åˆ°è¯·æ±‚åä¼šè°ƒç”¨HandlerMappingå¤„ç†å™¨æ˜ å°„å™¨ã€‚ç”±æ­¤å¾—çŸ¥ï¼Œè¯¥è¯·æ±‚è¯¥ç”±å“ªä¸ªControlleræ¥å¤„ç†ï¼ˆå¹¶æœªè°ƒç”¨Controllerï¼Œåªæ˜¯å¾—çŸ¥ï¼‰</li><li>DispatcherServletè°ƒç”¨HandlerAdapterå¤„ç†å™¨é€‚é…å™¨ï¼Œå‘Šè¯‰å¤„ç†å™¨é€‚é…å™¨åº”è¯¥è¦å»æ‰§è¡Œå“ªä¸ªController</li><li>HandlerAdapterå¤„ç†å™¨é€‚é…å™¨å»æ‰§è¡ŒControllerå¹¶å¾—åˆ°ModelAndView(æ•°æ®å’Œè§†å›¾)ï¼Œå¹¶å±‚å±‚è¿”å›ç»™DispatcherServlet</li><li>DispatcherServletå°†ModelAndViewäº¤ç»™ViewResloverè§†å›¾è§£æå™¨è§£æï¼Œç„¶åè¿”å›çœŸæ­£çš„è§†å›¾ã€‚</li><li>DispatcherServletå°†æ¨¡å‹æ•°æ®å¡«å……åˆ°è§†å›¾ä¸­</li><li>DispatcherServletå°†ç»“æœå“åº”ç»™ç”¨æˆ·</li></ol><h3 id="Beanç”Ÿå‘½å‘¨æœŸ"><a href="#Beanç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Beanç”Ÿå‘½å‘¨æœŸ"></a>Beanç”Ÿå‘½å‘¨æœŸ</h3><h4 id="Spring-Bean-çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ"><a href="#Spring-Bean-çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Spring Bean çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ"></a>Spring Bean çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ</h4><ol><li>Beanå®¹å™¨&#x2F;BeanFactory é€šè¿‡å¯¹è±¡çš„æ„é€ å™¨æˆ–å·¥å‚æ–¹æ³•å…ˆå®ä¾‹åŒ– Beanï¼›</li><li>å†æ ¹æ® Resource ä¸­çš„ä¿¡æ¯å†é€šè¿‡è®¾å®šå¥½çš„æ–¹æ³•ï¼ˆå…¸å‹çš„æœ‰setterï¼Œç»Ÿç§°ä¸ºBeanWrapperï¼‰å¯¹ Bean è®¾ç½®å±æ€§å€¼ï¼Œå¾—åˆ° BeanDefintion å¯¹è±¡ï¼Œç„¶å put åˆ° beanDefinitionMap ä¸­ï¼Œè°ƒç”¨ getBean çš„æ—¶å€™ï¼Œä»  beanDefinitionMap é‡Œï¼Œæ‹¿å‡º Class å¯¹è±¡è¿›è¡Œæ³¨å…¥ï¼ŒåŒæ—¶ï¼Œå¦‚æœæœ‰ä¾èµ–å…³ç³»ï¼Œå°†é€’å½’è°ƒç”¨ getBean æ–¹æ³•ï¼Œå³ä¾èµ–æ³¨å…¥çš„è¿‡ç¨‹ã€‚ </li><li>æ£€æŸ¥ xxxAware ç›¸å…³æ¥å£ï¼Œæ¯”å¦‚ BeanNameAwareï¼ŒBeanClassLoaderAwareï¼ŒApplicationContextAwareï¼ˆ BeanFactoryAwareï¼‰ç­‰ç­‰ï¼Œå¦‚æœæœ‰å°±è°ƒç”¨ç›¸åº”çš„ setxxx æ–¹æ³•æŠŠæ‰€éœ€è¦çš„xxxä¼ å…¥åˆ° Bean ä¸­ã€‚<br><strong>è¡¥å……</strong>ï¼šå…³äº Aware ï¼ŒAware å°±æ˜¯æ„ŸçŸ¥çš„æ„æ€ï¼Œ Aware çš„ç›®çš„æ˜¯ä¸ºäº†è®©Beanè·å¾—Springå®¹å™¨çš„æœåŠ¡ã€‚ å®ç°äº†è¿™ç±»æ¥å£çš„ bean ä¼šå­˜åœ¨â€œæ„è¯†æ„Ÿâ€ï¼Œä»è€Œè®©å®¹å™¨è°ƒç”¨ setxxx æ–¹æ³•æŠŠæ‰€éœ€è¦çš„ xxx ä¼ åˆ° Bean ä¸­ã€‚</li><li>æ­¤æ—¶æ£€æŸ¥æ˜¯å¦å­˜åœ¨æœ‰äº Bean å…³è”çš„ä»»ä½•  BeanPostProcessorsï¼Œ æ‰§è¡Œ postProcessBeforeInitialization() æ–¹æ³•ï¼ˆå‰ç½®å¤„ç†å™¨ï¼‰ã€‚</li><li>å¦‚æœ Bean å®ç°äº†InitializingBeanæ¥å£ï¼ˆæ­£åœ¨åˆå§‹åŒ–çš„ Beanï¼‰ï¼Œæ‰§è¡Œ afterPropertiesSet() æ–¹æ³•ã€‚</li><li>æ£€æŸ¥æ˜¯å¦é…ç½®äº†è‡ªå®šä¹‰çš„ init-method æ–¹æ³•ï¼Œå¦‚æœæœ‰å°±è°ƒç”¨ã€‚</li><li>æ­¤æ—¶æ£€æŸ¥æ˜¯å¦å­˜åœ¨æœ‰äº Bean å…³è”çš„ä»»ä½•  BeanPostProcessorsï¼Œ æ‰§è¡Œ postProcessAfterInitialization() æ–¹æ³•ï¼ˆåç½®å¤„ç†å™¨ï¼‰ã€‚è¿”å› wrapperBeanï¼ˆåŒ…è£…åçš„ Beanï¼‰ã€‚</li><li>è¿™æ—¶å°±å¯ä»¥å¼€å§‹ä½¿ç”¨ Bean äº†ï¼Œå½“å®¹å™¨å…³é—­æ—¶ï¼Œä¼šæ£€æŸ¥ Bean æ˜¯å¦å®ç°äº† DisposableBean æ¥å£ï¼Œå¦‚æœæœ‰å°±è°ƒç”¨ destory() æ–¹æ³•ã€‚</li><li>å¦‚æœ Bean é…ç½®æ–‡ä»¶ä¸­çš„å®šä¹‰åŒ…å« destroy-method å±æ€§ï¼Œæ‰§è¡ŒæŒ‡å®šçš„æ–¹æ³•ã€‚</li></ol><h4 id="Spring-æ˜¯å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–çš„"><a href="#Spring-æ˜¯å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–çš„" class="headerlink" title="Spring æ˜¯å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–çš„"></a>Spring æ˜¯å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–çš„</h4><p>ä¸‰çº§ç¼“å­˜</p><h2 id="Springæ³¨è§£"><a href="#Springæ³¨è§£" class="headerlink" title="Springæ³¨è§£"></a>Springæ³¨è§£</h2><h4 id="Resourceå’Œ-Autowiredæ³¨è§£æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#Resourceå’Œ-Autowiredæ³¨è§£æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="@Resourceå’Œ@Autowiredæ³¨è§£æœ‰ä»€ä¹ˆåŒºåˆ«"></a>@Resourceå’Œ@Autowiredæ³¨è§£æœ‰ä»€ä¹ˆåŒºåˆ«</h4><p>ä¸€ã€@Autowiredæœ‰ä¸ªrequiredå±æ€§ï¼Œå¯ä»¥é…ç½®ä¸ºfalseï¼Œè¿™ç§æƒ…å†µä¸‹å¦‚æœæ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„beanæ˜¯ä¸ä¼šæŠ›å¼‚å¸¸çš„ã€‚@Injectå’Œ@Resourceæ²¡æœ‰æä¾›å¯¹åº”çš„é…ç½®ï¼Œæ‰€ä»¥å¿…é¡»æ‰¾åˆ°å¦åˆ™ä¼šæŠ›å¼‚å¸¸ã€‚</p><p>äºŒã€ @Autowiredå’Œ@InjectåŸºæœ¬æ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºä¸¤è€…éƒ½æ˜¯ä½¿ç”¨AutowiredAnnotationBeanPostProcessoræ¥å¤„ç†ä¾èµ–æ³¨å…¥ã€‚ä½†æ˜¯@Resourceæ˜¯ä¸ªä¾‹å¤–ï¼Œå®ƒä½¿ç”¨çš„æ˜¯CommonAnnotationBeanPostProcessoræ¥å¤„ç†ä¾èµ–æ³¨å…¥ã€‚å½“ç„¶ï¼Œä¸¤è€…éƒ½æ˜¯BeanPostProcessorã€‚</p><p>@Autowiredå’Œ@Inject</p><ul><li>é»˜è®¤ autowired by type</li><li>å¯ä»¥ é€šè¿‡@Qualifier æ˜¾å¼æŒ‡å®š autowired by qualifier nameã€‚</li><li>å¦‚æœ autowired by type å¤±è´¥ï¼ˆæ‰¾ä¸åˆ°æˆ–è€…æ‰¾åˆ°å¤šä¸ªå®ç°ï¼‰ï¼Œåˆ™é€€åŒ–ä¸ºautowired by field name</li></ul><p>@Resource</p><ul><li>é»˜è®¤ autowired by field name</li><li>å¦‚æœ autowired by field nameå¤±è´¥ï¼Œä¼šé€€åŒ–ä¸º autowired by type</li><li>å¯ä»¥ é€šè¿‡@Qualifier æ˜¾å¼æŒ‡å®š autowired by qualifier name</li><li>å¦‚æœ autowired by qualifier nameå¤±è´¥ï¼Œä¼šé€€åŒ–ä¸º autowired by field nameã€‚ä½†æ˜¯è¿™æ—¶å€™å¦‚æœ autowired by field nameå¤±è´¥ï¼Œå°±ä¸ä¼šå†é€€åŒ–ä¸ºautowired by typeäº†ã€‚</li></ul><h2 id="Springç»„ä»¶"><a href="#Springç»„ä»¶" class="headerlink" title="Springç»„ä»¶"></a>Springç»„ä»¶</h2><h3 id="Filterå’ŒInterceptorçš„åŒºåˆ«"><a href="#Filterå’ŒInterceptorçš„åŒºåˆ«" class="headerlink" title="Filterå’ŒInterceptorçš„åŒºåˆ«"></a>Filterå’ŒInterceptorçš„åŒºåˆ«</h3><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2022/202207042134792.webp" alt="mvc"></p><h4 id="Interceptor"><a href="#Interceptor" class="headerlink" title="Interceptor"></a>Interceptor</h4><p>ä¸»è¦ä½œç”¨ï¼šæ‹¦æˆªç”¨æˆ·è¯·æ±‚ï¼Œè¿›è¡Œå¤„ç†ï¼Œæ¯”å¦‚åˆ¤æ–­ç”¨æˆ·ç™»å½•æƒ…å†µã€æƒé™éªŒè¯ï¼Œåªè¦é’ˆå¯¹Controllerè¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œæ˜¯é€šè¿‡<code>HandlerInterceptor</code>ã€‚</p><p>Interceptoråˆ†ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯å¯¹ä¼šè¯çš„æ‹¦æˆªï¼Œå®ç°springçš„HandlerInterceptoræ¥å£å¹¶æ³¨å†Œåˆ°mvcçš„æ‹¦æˆªé˜Ÿåˆ—ä¸­ï¼Œå…¶ä¸­<code>preHandle()</code>æ–¹æ³•åœ¨è°ƒç”¨Handlerä¹‹å‰è¿›è¡Œæ‹¦æˆª(ä¸Šå›¾æ­¥éª¤â‘¢)ï¼Œ<code>postHandle()</code>æ–¹æ³•åœ¨è§†å›¾æ¸²æŸ“ä¹‹å‰è°ƒç”¨(ä¸Šå›¾æ­¥éª¤â‘¤)ï¼Œ<code>afterCompletion()</code>æ–¹æ³•åœ¨è¿”å›ç›¸åº”ä¹‹å‰æ‰§è¡Œï¼›å¦ä¸€ç§æ˜¯å¯¹æ–¹æ³•çš„æ‹¦æˆªï¼Œéœ€è¦ä½¿ç”¨<code>@Aspect</code>æ³¨è§£ï¼Œåœ¨æ¯æ¬¡è°ƒç”¨æŒ‡å®šæ–¹æ³•çš„å‰ã€åè¿›è¡Œæ‹¦æˆªã€‚</p><h4 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h4><p>ä¸»è¦ä½œç”¨ï¼šè¿‡æ»¤å­—ç¬¦ç¼–ç ã€åšä¸€äº›ä¸šåŠ¡é€»è¾‘åˆ¤æ–­ï¼Œä¸»è¦ç”¨äºå¯¹ç”¨æˆ·è¯·æ±‚è¿›è¡Œé¢„å¤„ç†ï¼ŒåŒæ—¶ä¹Ÿå¯è¿›è¡Œé€»è¾‘åˆ¤æ–­ã€‚</p><p>Filteråœ¨è¯·æ±‚è¿›å…¥servletå®¹å™¨æ‰§è¡Œservice()æ–¹æ³•ä¹‹å‰å°±ä¼šç»è¿‡filterè¿‡æ»¤ï¼ˆä¸Šå›¾æ­¥éª¤â‘ ï¼‰ï¼Œä¸åƒIntreceptorä¸€æ ·ä¾èµ–äºSpringMVCæ¡†æ¶ï¼Œåªéœ€è¦ä¾èµ–äºservletã€‚Filterå¯åŠ¨æ˜¯éšWEBåº”ç”¨çš„å¯åŠ¨è€Œå¯åŠ¨ï¼Œåªéœ€è¦åˆå§‹åŒ–ä¸€æ¬¡ï¼Œä»¥åéƒ½å¯ä»¥è¿›è¡Œæ‹¦æˆªã€‚</p><p>Filteræœ‰å¦‚ä¸‹å‡ ä¸ªç§ç±»ï¼š</p><ul><li>ç”¨æˆ·æˆæƒFilterï¼šæ£€æŸ¥ç”¨æˆ·è¯·æ±‚ï¼Œæ ¹æ®è¯·æ±‚è¿‡æ»¤ç”¨æˆ·éæ³•è¯·æ±‚ï¼›</li><li>æ—¥å¿—Filterï¼šè®°å½•æŸäº›ç‰¹æ®Šçš„ç”¨æˆ·è¯·æ±‚ï¼›</li><li>è§£ç Filterï¼šå¯¹éæ ‡å‡†ç¼–ç çš„è¯·æ±‚è§£ç ã€‚</li></ul><h4 id="Filterå’ŒInterceptorçš„åŒºåˆ«-1"><a href="#Filterå’ŒInterceptorçš„åŒºåˆ«-1" class="headerlink" title="Filterå’ŒInterceptorçš„åŒºåˆ«"></a>Filterå’ŒInterceptorçš„åŒºåˆ«</h4><ol><li>Filteræ˜¯åŸºäºå‡½æ•°å›è°ƒï¼ˆdoFilter()æ–¹æ³•ï¼‰çš„ï¼Œè€ŒInterceptoråˆ™æ˜¯åŸºäºJavaåå°„çš„ï¼ˆAOPæ€æƒ³ï¼‰ã€‚</li><li>Filterä¾èµ–äºServletå®¹å™¨ï¼Œè€ŒInterceptorä¸ä¾èµ–äºServletå®¹å™¨ã€‚</li><li>Filterå¯¹å‡ ä¹æ‰€æœ‰çš„è¯·æ±‚èµ·ä½œç”¨ï¼Œè€ŒInterceptoråªèƒ½å¯¹actionè¯·æ±‚èµ·ä½œç”¨ã€‚</li><li>Interceptorå¯ä»¥è®¿é—®Actionçš„ä¸Šä¸‹æ–‡ï¼Œå€¼æ ˆé‡Œçš„å¯¹è±¡ï¼Œè€ŒFilterä¸èƒ½ã€‚</li><li>åœ¨actionçš„ç”Ÿå‘½å‘¨æœŸé‡Œï¼ŒInterceptorå¯ä»¥è¢«å¤šæ¬¡è°ƒç”¨ï¼Œè€ŒFilteråªèƒ½åœ¨å®¹å™¨åˆå§‹åŒ–æ—¶è°ƒç”¨ä¸€æ¬¡ã€‚</li><li>Filteråœ¨è¿‡æ»¤æ˜¯åªèƒ½å¯¹requestå’Œresponseè¿›è¡Œæ“ä½œï¼Œè€Œinterceptorå¯ä»¥å¯¹requestã€responseã€handlerã€modelAndViewã€exceptionè¿›è¡Œæ“ä½œã€‚</li></ol><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://juejin.cn/post/6844903811874553869">Filterå’ŒInterceptorçš„åŒºåˆ«</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> é¢ç» </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç³»ç»Ÿè®¾è®¡é¢è¯•é¢˜</title>
      <link href="/posts/ec3caae2.html"/>
      <url>/posts/ec3caae2.html</url>
      
        <content type="html"><![CDATA[<hr><span id="more"></span><h1 id="ä¸€ã€ESç¯‡"><a href="#ä¸€ã€ESç¯‡" class="headerlink" title="ä¸€ã€ESç¯‡"></a>ä¸€ã€ESç¯‡</h1><blockquote><p>Elasticsearchå¯ä»¥å®ç°<strong>ç§’çº§</strong>çš„æœç´¢ï¼Œclusteræ˜¯ä¸€ç§åˆ†å¸ƒå¼çš„éƒ¨ç½²ï¼Œæ<strong>æ˜“æ‰©å±•(scale )<strong>è¿™æ ·å¾ˆå®¹æ˜“ä½¿å®ƒå¤„ç†PBçº§çš„æ•°æ®åº“å®¹é‡ã€‚æœ€é‡è¦çš„æ˜¯Elasticsearchæ˜¯å®ƒæœç´¢çš„ç»“æœå¯ä»¥æŒ‰ç…§åˆ†æ•°è¿›è¡Œæ’åºï¼Œå®ƒèƒ½æä¾›æˆ‘ä»¬æœ€</strong>ç›¸å…³</strong>çš„æœç´¢ç»“æœï¼ˆ<strong>relevance</strong>) ã€‚</p></blockquote><h2 id="1ã€æ¦‚è¿°"><a href="#1ã€æ¦‚è¿°" class="headerlink" title="1ã€æ¦‚è¿°"></a>1ã€æ¦‚è¿°</h2><h3 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><ol><li><p><strong>å®‰è£…æ–¹ä¾¿</strong>ï¼šæ²¡æœ‰å…¶ä»–ä¾èµ–ï¼Œä¸‹è½½åå®‰è£…éå¸¸æ–¹ä¾¿ï¼›åªç”¨ä¿®æ”¹å‡ ä¸ªå‚æ•°å°±å¯ä»¥æ­å»ºèµ·æ¥ä¸€ä¸ªé›†ç¾¤</p></li><li><p><strong>JSON</strong>ï¼šè¾“å…¥&#x2F;è¾“å‡ºæ ¼å¼ä¸º JSONï¼Œæ„å‘³ç€ä¸éœ€è¦å®šä¹‰ Schemaï¼Œå¿«æ·æ–¹ä¾¿</p></li><li><p><strong>RESTful</strong>ï¼šåŸºæœ¬æ‰€æœ‰æ“ä½œ ( ç´¢å¼•ã€æŸ¥è¯¢ã€ç”šè‡³æ˜¯é…ç½® ) éƒ½å¯ä»¥é€šè¿‡ HTTP æ¥å£è¿›è¡Œ</p></li><li><p><strong>åˆ†å¸ƒå¼</strong>ï¼šèŠ‚ç‚¹å¯¹å¤–è¡¨ç°å¯¹ç­‰ï¼ˆæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥ç”¨æ¥åšå…¥å£ï¼‰ åŠ å…¥èŠ‚ç‚¹è‡ªåŠ¨è´Ÿè½½å‡è¡¡</p></li><li><p><strong>å¤šç§Ÿæˆ·</strong>ï¼šå¯æ ¹æ®ä¸åŒçš„ç”¨é€”åˆ†ç´¢å¼•ï¼Œå¯ä»¥åŒæ—¶æ“ä½œå¤šä¸ªç´¢å¼•</p></li><li><p><strong>æ”¯æŒè¶…å¤§æ•°æ®</strong>ï¼š å¯ä»¥æ‰©å±•åˆ° PB çº§çš„ç»“æ„åŒ–å’Œéç»“æ„åŒ–æ•°æ® æµ·é‡æ•°æ®çš„è¿‘å®æ—¶å¤„ç†</p></li></ol><h3 id="åŠŸèƒ½"><a href="#åŠŸèƒ½" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h3><ul><li><p><strong>åˆ†å¸ƒå¼çš„æœç´¢å¼•æ“</strong></p><p>åˆ†å¸ƒå¼ï¼šElasticsearchè‡ªåŠ¨å°†æµ·é‡æ•°æ®åˆ†æ•£åˆ°å¤šå°æœåŠ¡å™¨ä¸Šå»å­˜å‚¨å’Œæ£€ç´¢</p></li><li><p><strong>å…¨æ–‡æ£€ç´¢</strong></p><p>æä¾›æ¨¡ç³Šæœç´¢ç­‰è‡ªåŠ¨åº¦å¾ˆé«˜çš„æŸ¥è¯¢æ–¹å¼ï¼Œå¹¶è¿›è¡Œç›¸å…³æ€§æ’åï¼Œé«˜äº®ç­‰åŠŸèƒ½</p></li><li><p><strong>æ•°æ®åˆ†æå¼•æ“ï¼ˆåˆ†ç»„èšåˆï¼‰</strong></p><p>ç¤¾åŒºç½‘ç«™ï¼Œæœ€è¿‘ä¸€å‘¨ç”¨æˆ·ç™»å½•ã€æœ€è¿‘ä¸€ä¸ªæœˆå„åŠŸèƒ½ä½¿ç”¨æƒ…å†µ</p></li><li><p><strong>å¯¹æµ·é‡æ•°æ®è¿›è¡Œè¿‘å®æ—¶ï¼ˆç§’çº§ï¼‰çš„å¤„ç†</strong></p><p>æµ·é‡æ•°æ®çš„å¤„ç†ï¼šå› ä¸ºæ˜¯åˆ†å¸ƒå¼æ¶æ„ï¼Œå¯ä»¥é‡‡ç”¨å¤§é‡çš„æœåŠ¡å™¨å»å­˜å‚¨å’Œæ£€ç´¢æ•°æ®</p></li></ul><h3 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h3><ul><li><p><strong>æœç´¢ç±»</strong>åœºæ™¯</p><p>æ¯”å¦‚è¯´äººå‘˜æ£€ç´¢ã€è®¾å¤‡æ£€ç´¢ã€Appå†…çš„æœç´¢ã€è®¢å•æœç´¢ã€‚</p></li><li><p><strong>æ—¥å¿—åˆ†æ</strong>ç±»åœºæ™¯</p><p>ç»å…¸çš„ELKç»„åˆï¼ˆ<strong>Elasticsearch</strong>&#x2F;<strong>Logstash</strong>&#x2F;<strong>Kibana</strong>ï¼‰ï¼Œå®ç°<strong>æ—¥å¿—æ”¶é›†</strong>ï¼Œ<strong>æ—¥å¿—å­˜å‚¨</strong>ï¼Œ<strong>æ—¥å¿—åˆ†æ</strong></p></li><li><p><strong>æ•°æ®é¢„è­¦å¹³å°</strong>åŠæ•°æ®åˆ†æåœºæ™¯</p><p>ä¾‹å¦‚ç¤¾åŒºå›¢è´­æç¤ºï¼Œå½“ä¼˜æƒ çš„ä»·æ ¼ä½äºæŸä¸ªå€¼æ—¶ï¼Œè‡ªåŠ¨è§¦å‘é€šçŸ¥æ¶ˆæ¯ï¼Œé€šçŸ¥ç”¨æˆ·è´­ä¹°ã€‚</p><p>åˆ†æç«äº‰å¯¹æ‰‹å•†å“é”€é‡Top10ï¼Œä¾›è¿è¥åˆ†æç­‰ç­‰ã€‚</p></li><li><p>**å•†ä¸šBI(Business Intelligence)**ç³»ç»Ÿ</p><p>æ¯”å¦‚ç¤¾åŒºå‘¨è¾¹ï¼Œéœ€è¦åˆ†ææŸä¸€åœ°åŒºç”¨æˆ·æ¶ˆè´¹é‡‘é¢åŠå•†å“ç±»åˆ«ï¼Œè¾“å‡ºç›¸åº”çš„æŠ¥è¡¨æ•°æ®ï¼Œå¹¶é¢„æµ‹è¯¥åœ°åŒºçš„çƒ­å–å•†å“ï¼Œé€šè¿‡åŒºåŸŸå’Œäººç¾¤ç‰¹å¾åˆ’åˆ†è¿›è¡Œå®šå‘æ¨èã€‚Elasticsearchæ‰§è¡Œæ•°æ®åˆ†æå’ŒæŒ–æ˜ï¼ŒKibanaåšæ•°æ®å¯è§†åŒ–ã€‚</p></li></ul><h3 id="ç«å“åˆ†æ"><a href="#ç«å“åˆ†æ" class="headerlink" title="ç«å“åˆ†æ"></a>ç«å“åˆ†æ</h3><p><strong>Lucene</strong></p><p>Javaç¼–å†™çš„ä¿¡æ¯æœç´¢å·¥å…·åŒ…ï¼ˆJaråŒ…ï¼‰ï¼ŒLuceneåªæ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œç†Ÿç»ƒè¿ç”¨Luceneéå¸¸å¤æ‚ã€‚</p><p><strong>Solr</strong></p><p>åŸºäº<strong>Lucene</strong>çš„HTTPæ¥å£æŸ¥è¯¢æœåŠ¡å™¨ï¼Œæ˜¯ä¸€ä¸ªå°è£…äº†å¾ˆå¤šLuceneç»†èŠ‚æœç´¢å¼•æ“ç³»ç»Ÿ</p><p><strong>Elasticsearch</strong></p><p>åŸºäº<strong>Lucene</strong>åˆ†å¸ƒå¼æµ·é‡æ•°æ®è¿‘å®æ—¶æœç´¢å¼•æ“ã€‚é‡‡ç”¨çš„ç­–ç•¥æ˜¯å°†æ¯ä¸€ä¸ªå­—æ®µéƒ½ç¼–å…¥ç´¢å¼•ï¼Œä½¿å…¶å¯ä»¥è¢«æœç´¢ã€‚</p><h3 id="å¯¹æ¯”"><a href="#å¯¹æ¯”" class="headerlink" title="å¯¹æ¯”"></a>å¯¹æ¯”</h3><p>1ï¼‰Solråˆ©ç”¨Zookeeperè¿›è¡Œåˆ†å¸ƒå¼ç®¡ç†ï¼Œè€ŒElasticsearchè‡ªèº«å¸¦æœ‰åˆ†å¸ƒå¼åè°ƒç®¡ç†åŠŸèƒ½</p><p>2ï¼‰Solræ¯”Elasticsearchå®ç°æ›´åŠ å…¨é¢ï¼Œè€ŒElasticsearchæœ¬èº«æ›´æ³¨é‡äºæ ¸å¿ƒåŠŸèƒ½ï¼Œ é«˜çº§åŠŸèƒ½å¤šç”±ç¬¬ä¸‰æ–¹æ’ä»¶æä¾›</p><p>3ï¼‰Solråœ¨ä¼ ç»Ÿçš„æœç´¢åº”ç”¨ä¸­è¡¨ç°å¥½äºElasticsearchï¼Œè€ŒElasticsearchåœ¨å®æ—¶æœç´¢åº”ç”¨æ–¹é¢æ¯”Solrè¡¨ç°å¥½</p><p>ç›®å‰ä¸»æµä¾ç„¶æ˜¯<strong>Elasticsearch</strong>7.x æœ€æ–°çš„æ˜¯7.8</p><p>â€‹ä¼˜åŒ–ï¼š<strong>é»˜è®¤é›†æˆJDK</strong>ã€å‡çº§Lucene8å¤§å¹…æå‡<strong>TopKæ€§èƒ½</strong>ã€å¼•å…¥ç†”æ–­æœºåˆ¶<strong>é¿å…OOM</strong>å‘ç”Ÿ</p><h2 id="2ã€åŸºæœ¬æ¦‚å¿µ"><a href="#2ã€åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="2ã€åŸºæœ¬æ¦‚å¿µ"></a>2ã€åŸºæœ¬æ¦‚å¿µ</h2><h3 id="IKåˆ†è¯å™¨"><a href="#IKåˆ†è¯å™¨" class="headerlink" title="IKåˆ†è¯å™¨"></a>IKåˆ†è¯å™¨</h3><p>IKAnalyzeræ˜¯ä¸€ä¸ªå¼€æºçš„ï¼ŒåŸºäºjavaè¯­è¨€å¼€å‘çš„è½»é‡çº§çš„ä¸­æ–‡åˆ†è¯å·¥å…·åŒ…ã€‚æ–°ç‰ˆæœ¬çš„IKAnalyzer3.0åˆ™å‘å±•ä¸º é¢å‘Javaçš„å…¬ç”¨åˆ†è¯ç»„ä»¶ï¼Œç‹¬ç«‹äºLuceneé¡¹ç›®ï¼ŒåŒæ—¶æä¾›äº†å¯¹Luceneçš„é»˜è®¤ä¼˜åŒ–å®ç°ã€‚</p><p>IKåˆ†è¯å™¨3.0çš„ç‰¹æ€§å¦‚ä¸‹ï¼š</p><ol><li>é‡‡ç”¨äº†ç‰¹æœ‰çš„â€œæ­£å‘è¿­ä»£<strong>æœ€ç»†ç²’åº¦</strong>åˆ‡åˆ†ç®—æ³•â€œï¼Œå…·æœ‰<strong>60ä¸‡</strong>å­—&#x2F;ç§’çš„é«˜é€Ÿå¤„ç†èƒ½åŠ›ã€‚</li><li>é‡‡ç”¨äº†<strong>å¤šå­å¤„ç†å™¨</strong>åˆ†ææ¨¡å¼ï¼Œæ”¯æŒï¼šè‹±æ–‡å­—æ¯ï¼ˆIPåœ°å€ã€Emailã€URLï¼‰ã€æ•°å­—ï¼ˆæ—¥æœŸï¼Œå¸¸ç”¨ä¸­æ–‡æ•°é‡è¯ï¼Œç½—é©¬æ•°å­—ï¼Œç§‘å­¦è®¡æ•°æ³•ï¼‰ï¼Œä¸­æ–‡è¯æ±‡ï¼ˆå§“åã€åœ°åå¤„ç†ï¼‰ç­‰åˆ†è¯å¤„ç†ã€‚</li><li>æ”¯æŒ<strong>ä¸ªäººè¯æ¡çš„ä¼˜åŒ–</strong>çš„è¯å…¸å­˜å‚¨ï¼Œæ›´å°çš„å†…å­˜å ç”¨ã€‚</li><li>é’ˆå¯¹Lucene<strong>å…¨æ–‡æ£€ç´¢ä¼˜åŒ–</strong>çš„æŸ¥è¯¢åˆ†æå™¨IKQueryParserï¼›é‡‡ç”¨æ­§ä¹‰åˆ†æç®—æ³•ä¼˜åŒ–æŸ¥è¯¢å…³é”®å­—çš„æœç´¢</li><li>æ’åˆ—ç»„åˆï¼Œèƒ½æå¤§çš„æé«˜Luceneæ£€ç´¢çš„å‘½ä¸­ç‡ã€‚</li></ol><ul><li><strong>æ‰©å±•è¯å…¸</strong>ï¼šext_dict </li><li><strong>åœç”¨è¯å…¸</strong>ï¼šstop_dict</li><li><strong>åŒä¹‰è¯å…¸</strong>ï¼šsame_dict</li></ul><h3 id="ç´¢å¼•ï¼ˆç±»æ•°æ®åº“ï¼‰"><a href="#ç´¢å¼•ï¼ˆç±»æ•°æ®åº“ï¼‰" class="headerlink" title="ç´¢å¼•ï¼ˆç±»æ•°æ®åº“ï¼‰"></a>ç´¢å¼•ï¼ˆç±»æ•°æ®åº“ï¼‰</h3><p>settingsï¼šè®¾ç½®ç´¢å¼•åº“ï¼Œå®šä¹‰ç´¢å¼•åº“çš„åˆ†ç‰‡æ•°å‰¯æœ¬æ•°ç­‰</p><h3 id="æ˜ å°„ï¼ˆç±»è¡¨è®¾è®¡ï¼‰"><a href="#æ˜ å°„ï¼ˆç±»è¡¨è®¾è®¡ï¼‰" class="headerlink" title="æ˜ å°„ï¼ˆç±»è¡¨è®¾è®¡ï¼‰"></a>æ˜ å°„ï¼ˆç±»è¡¨è®¾è®¡ï¼‰</h3><ul><li>å­—æ®µçš„æ•°æ®ç±»å‹</li><li>åˆ†è¯å™¨ç±»å‹</li><li>æ˜¯å¦è¦è¿›è¡Œå­˜å‚¨æˆ–è€…åˆ›é€ ç´¢å¼•</li></ul><h3 id="æ–‡æ¡£ï¼ˆæ•°æ®ï¼‰"><a href="#æ–‡æ¡£ï¼ˆæ•°æ®ï¼‰" class="headerlink" title="æ–‡æ¡£ï¼ˆæ•°æ®ï¼‰"></a>æ–‡æ¡£ï¼ˆæ•°æ®ï¼‰</h3><ul><li>å…¨é‡æ›´æ–°ç”¨Put</li><li>å±€éƒ¨æ›´æ–°ç”¨Post</li></ul><h2 id="3ã€é«˜çº§ç‰¹æ€§"><a href="#3ã€é«˜çº§ç‰¹æ€§" class="headerlink" title="3ã€é«˜çº§ç‰¹æ€§"></a>3ã€é«˜çº§ç‰¹æ€§</h2><h3 id="æ˜ å°„é«˜çº§"><a href="#æ˜ å°„é«˜çº§" class="headerlink" title="æ˜ å°„é«˜çº§"></a>æ˜ å°„é«˜çº§</h3><h4 id="åœ°ç†åæ ‡ç‚¹æ•°æ®ç±»å‹"><a href="#åœ°ç†åæ ‡ç‚¹æ•°æ®ç±»å‹" class="headerlink" title="åœ°ç†åæ ‡ç‚¹æ•°æ®ç±»å‹"></a><strong>åœ°ç†åæ ‡ç‚¹æ•°æ®ç±»å‹</strong></h4><blockquote><p>åœ°ç†åæ ‡ç‚¹æ˜¯æŒ‡åœ°çƒè¡¨é¢å¯ä»¥ç”¨ç»çº¬åº¦æè¿°çš„ä¸€ä¸ªç‚¹ã€‚ åœ°ç†åæ ‡ç‚¹å¯ä»¥ç”¨æ¥è®¡ç®—ä¸¤ä¸ªåæ ‡é—´çš„è·ç¦»ï¼Œè¿˜å¯ä»¥åˆ¤æ–­ä¸€ä¸ªåæ ‡æ˜¯å¦åœ¨ä¸€ä¸ªåŒºåŸŸä¸­ã€‚åœ°ç†åæ ‡ç‚¹éœ€è¦æ˜¾å¼å£°æ˜å¯¹åº”å­—æ®µç±»å‹ä¸º geo_point</p></blockquote><h4 id="åŠ¨æ€æ˜ å°„"><a href="#åŠ¨æ€æ˜ å°„" class="headerlink" title="åŠ¨æ€æ˜ å°„"></a>åŠ¨æ€æ˜ å°„</h4><blockquote><p>ä½¿ç”¨dynamic mapping æ¥ç¡®å®šå­—æ®µçš„æ•°æ®ç±»å‹å¹¶è‡ªåŠ¨æŠŠæ–°çš„å­—æ®µæ·»åŠ åˆ°ç±»å‹æ˜ å°„</p></blockquote><h3 id="DSLé«˜çº§"><a href="#DSLé«˜çº§" class="headerlink" title="DSLé«˜çº§"></a>DSLé«˜çº§</h3><ul><li><p><strong>æŸ¥è¯¢æ‰€æœ‰(match_all query)</strong></p></li><li><p><strong>å…¨æ–‡æœç´¢(full-text query)</strong></p><ul><li>åŒ¹é…æœç´¢(match query)</li><li>çŸ­è¯­æœç´¢(match phrase query)</li><li>é»˜è®¤æŸ¥è¯¢(query string)</li><li>å¤šå­—æ®µåŒ¹é…æœç´¢(multi match query)</li></ul></li><li><p><strong>è¯æ¡çº§æœç´¢(term-level query)</strong></p><ul><li>ç²¾ç¡®æœç´¢term</li><li>é›†åˆæœç´¢idx</li><li>èŒƒå›´æœç´¢range</li><li>å‰ç¼€æœç´¢prefix</li><li>é€šé…ç¬¦æœç´¢wildcard</li><li>æ­£åˆ™æœç´¢regexp</li><li>æ¨¡ç³Šæœç´¢fuzzy</li></ul></li><li><p>å¤åˆæœç´¢</p></li><li><p>æ’åº<strong>sort</strong>&amp;åˆ†é¡µ<strong>size</strong>&amp;é«˜äº®<strong>highLight</strong>&amp;æ‰¹é‡<strong>bluk</strong></p></li></ul><h3 id="èšåˆåˆ†æ"><a href="#èšåˆåˆ†æ" class="headerlink" title="èšåˆåˆ†æ"></a><strong>èšåˆåˆ†æ</strong></h3><blockquote><p>èšåˆåˆ†ææ˜¯æ•°æ®åº“ä¸­é‡è¦çš„åŠŸèƒ½ç‰¹æ€§ï¼Œå®Œæˆå¯¹ä¸€ä¸ªæŸ¥è¯¢çš„æ•°æ®é›†ä¸­æ•°æ®çš„èšåˆè®¡ç®—ï¼Œå¦‚ï¼šæ‰¾å‡ºæŸå­—æ®µï¼ˆæˆ–è®¡ç®—è¡¨è¾¾å¼çš„ç»“æœï¼‰çš„æœ€å¤§å€¼ã€æœ€å°å€¼ï¼Œè®¡ç®—å’Œã€å¹³å‡å€¼ç­‰</p></blockquote><ul><li>å¯¹ä¸€ä¸ªæ•°æ®é›†æ±‚æœ€å¤§ã€æœ€å°ã€å’Œã€å¹³å‡å€¼ç­‰æŒ‡æ ‡çš„èšåˆï¼Œåœ¨ESä¸­ç§°ä¸º<strong>æŒ‡æ ‡èšåˆ</strong> <strong>metric</strong></li><li>å¯¹æŸ¥è¯¢å‡ºçš„æ•°æ®è¿›è¡Œ<strong>åˆ†æ¡¶</strong>group byï¼Œå†åœ¨<strong>æ¡¶</strong>ä¸Šè¿›è¡ŒæŒ‡æ ‡<strong>æ¡¶èšåˆ</strong> <strong>bucketing</strong></li></ul><h3 id="æ™ºèƒ½æœç´¢"><a href="#æ™ºèƒ½æœç´¢" class="headerlink" title="æ™ºèƒ½æœç´¢"></a><strong>æ™ºèƒ½æœç´¢</strong></h3><ul><li>Term Suggester</li><li>Phrase Suggester</li><li>Completion Suggester</li><li>Context Suggester</li></ul><p>å¦‚æœ<strong>Completion Suggester</strong>å·²ç»åˆ°äº†é›¶åŒ¹é…ï¼Œå¯ä»¥çŒœæµ‹ç”¨æˆ·æœ‰è¾“å…¥é”™è¯¯ï¼Œè¿™æ—¶å€™å¯ä»¥å°è¯•ä¸€ä¸‹<strong>Phrase Suggester</strong>ã€‚å¦‚æœè¿˜æ˜¯æœªåŒ¹é…åˆ™å°è¯•<strong>Term Suggester</strong>ã€‚</p><p>ç²¾å‡†ç¨‹åº¦ä¸Š(<strong>Precision</strong>)çœ‹ï¼š <strong>Completion &gt; Phrase &gt; Term</strong>ï¼Œ è€Œå¬å›ç‡ä¸Š(Recall)åˆ™åä¹‹ã€‚</p><p>ä»æ€§èƒ½ä¸Šçœ‹ï¼ŒCompletion Suggesteræ˜¯æœ€å¿«çš„ï¼Œå¦‚æœèƒ½æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ï¼Œåªç”¨Completion Suggesteråšå‰ç¼€åŒ¹é…æ˜¯æœ€ç†æƒ³çš„ã€‚ Phraseå’ŒTermç”±äºæ˜¯åšå€’æ’ç´¢å¼•çš„æœç´¢ï¼Œç›¸æ¯”è¾ƒè€Œè¨€æ€§èƒ½åº”è¯¥è¦ä½ä¸å°‘ï¼Œåº”å°½é‡æ§åˆ¶Suggesterç”¨åˆ°çš„ç´¢å¼•çš„æ•°æ®é‡ï¼Œæœ€ç†æƒ³çš„çŠ¶å†µæ˜¯ç»è¿‡ä¸€å®šæ—¶é—´é¢„çƒ­åï¼Œç´¢å¼•å¯ä»¥å…¨é‡mapåˆ°å†…å­˜ã€‚</p><h2 id="4ã€å®æˆ˜"><a href="#4ã€å®æˆ˜" class="headerlink" title="4ã€å®æˆ˜"></a>4ã€å®æˆ˜</h2><h3 id="å†™ä¼˜åŒ–"><a href="#å†™ä¼˜åŒ–" class="headerlink" title="å†™ä¼˜åŒ–"></a>å†™ä¼˜åŒ–</h3><ul><li><p><strong>å‰¯æœ¬æ•°é‡</strong>0</p><p>é¦–æ¬¡ åˆå§‹åŒ–æ•°æ®æ—¶ï¼Œå°†å‰¯æœ¬è®¾ç½®ä¸º0ï¼Œå†™å…¥å®Œæ¯•å†æ”¹å›ï¼Œé¿å…äº†å‰¯æœ¬å»ºç«‹ç´¢å¼•çš„è¿‡ç¨‹</p></li><li><p><strong>è‡ªåŠ¨ç”Ÿæˆid</strong></p><p>å¯ä»¥é¿å…å†™å‰åˆ¤æ–­æ˜¯å¦å­˜åœ¨çš„è¿‡ç¨‹</p></li><li><p><strong>åˆç†ä½¿ç”¨åˆ†è¯å™¨</strong></p><p>binaryç±»å‹ä¸é€‚ç”¨ï¼Œtitleå’Œtextä½¿ç”¨ä¸åŒçš„åˆ†è¯å™¨åŠ å¿«é€Ÿåº¦</p></li><li><p><strong>ç¦ç”¨è¯„åˆ†ï¼Œå»¶é•¿ç´¢å¼•åˆ·æ–°é—´éš”</strong></p></li><li><p><strong>å°†å¤šä¸ªç´¢å¼•æ“ä½œæ”¾å…¥åˆ°batchè¿›è¡Œå¤„ç†</strong></p></li></ul><h3 id="è¯»ä¼˜åŒ–"><a href="#è¯»ä¼˜åŒ–" class="headerlink" title="è¯»ä¼˜åŒ–"></a>è¯»ä¼˜åŒ–</h3><ul><li><p>ä½¿ç”¨<strong>Filter</strong>ä»£æ›¿Queryï¼Œå‡å°‘æ‰“åˆ†ç¼“è§£ï¼Œä½¿ç”¨<strong>bool</strong>ç»„åˆqueryå’ŒfilteræŸ¥è¯¢</p></li><li><p>å¯¹æ•°æ®è¿›è¡Œ<strong>åˆ†ç»„</strong>ï¼ŒæŒ‰ç…§æ—¥ï¼Œæœˆï¼Œå¹´ä¸åŒç»´åº¦åˆ†ç»„ï¼ŒæŸ¥è¯¢å¯é›†ä¸­åœ¨å±€éƒ¨indexä¸­</p></li></ul><h3 id="é›¶åœæœºç´¢å¼•é‡å»ºæ–¹æ¡ˆ"><a href="#é›¶åœæœºç´¢å¼•é‡å»ºæ–¹æ¡ˆ" class="headerlink" title="é›¶åœæœºç´¢å¼•é‡å»ºæ–¹æ¡ˆ"></a>é›¶åœæœºç´¢å¼•é‡å»ºæ–¹æ¡ˆ</h3><ul><li><p><strong>å¤–éƒ¨æ•°æ®å¯¼å…¥</strong></p><ul><li>é€šè¿‡MQçš„webæ§åˆ¶å°æˆ–cliå‘½ä»¤è¡Œï¼Œå‘é€æŒ‡å®šçš„MQæ¶ˆæ¯</li><li>MQæ¶ˆæ¯è¢«å¾®æœåŠ¡æ¨¡å—çš„æ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œè§¦å‘ESæ•°æ®é‡æ–°å¯¼å…¥åŠŸèƒ½</li><li>å¾®æœåŠ¡æ¨¡å—ä»æ•°æ®åº“é‡ŒæŸ¥è¯¢æ•°æ®çš„æ€»æ•°åŠåˆ†é¡µä¿¡æ¯ï¼Œå¹¶å‘é€è‡³MQ</li><li>å¾®æœåŠ¡ä»MQä¸­æ ¹æ®åˆ†é¡µä¿¡æ¯ä»æ•°æ®åº“è·å–åˆ°æ•°æ®åï¼Œæ ¹æ®ç´¢å¼•ç»“æ„çš„å®šä¹‰ï¼Œå°†æ•°æ®ç»„è£…æˆESæ”¯æŒçš„JSONæ ¼å¼ï¼Œå¹¶é€šè¿‡bulkå‘½ä»¤å°†æ•°æ®å‘é€ç»™Elasticsearché›†ç¾¤è¿›è¡Œç´¢å¼•çš„é‡å»ºå·¥ä½œã€‚</li></ul></li><li><p><strong>åŸºäºScroll+bulk+ç´¢å¼•åˆ«åçš„æ–¹æ¡ˆ</strong></p><ul><li><p>æ–°å»ºç´¢å¼•book_newï¼Œå°†mappingä¿¡æ¯ï¼Œsettingsä¿¡æ¯ç­‰æŒ‰æ–°çš„è¦æ±‚å…¨éƒ¨å®šä¹‰å¥½</p></li><li><p>ä½¿ç”¨scroll apiå°†æ•°æ®æ‰¹é‡æŸ¥è¯¢å‡ºæ¥ï¼ŒæŒ‡å®šscrollæŸ¥è¯¢æŒç»­æ—¶é—´</p></li><li><p>é‡‡ç”¨bulk apiå°†scollæŸ¥å‡ºæ¥çš„ä¸€æ‰¹æ•°æ®ï¼Œæ‰¹é‡å†™å…¥æ–°ç´¢å¼•</p></li><li><p>æŸ¥è¯¢ä¸€æ‰¹å¯¼å…¥ä¸€æ‰¹ï¼Œæ³¨æ„æ¯æ¬¡éƒ½ä½¿ç”¨ä¸Šæ¬¡ç»“æŸæ—¶çš„scoll_id</p></li><li><p>åˆ‡æ¢åˆ«åbook_aliasåˆ°æ–°çš„ç´¢å¼•book_newä¸Šé¢ï¼Œæ­¤æ—¶Javaå®¢æˆ·ç«¯ä»ç„¶ä½¿ç”¨åˆ«åè®¿é—®ï¼Œä¹Ÿä¸éœ€è¦ä¿®</p><p>æ”¹ä»»ä½•ä»£ç ï¼Œä¸éœ€è¦åœæœºã€‚éªŒè¯åˆ«åæŸ¥è¯¢çš„æ˜¯å¦ä¸ºæ–°ç´¢å¼•çš„æ•°æ®</p></li></ul></li><li><p><strong>Reindex APIæ–¹æ¡ˆ</strong></p><ul><li>Elasticsearch v6.3.1å·²ç»æ”¯æŒReindex APIï¼Œå®ƒå¯¹scrollã€bulkåšäº†ä¸€å±‚å°è£…ï¼Œèƒ½å¤Ÿ å¯¹æ–‡æ¡£é‡å»ºç´¢å¼•è€Œä¸éœ€è¦ä»»ä½•æ’ä»¶æˆ–å¤–éƒ¨å·¥å…·ã€‚</li></ul></li></ul><p><strong>å‚ä¸åº¦</strong> &amp; <strong>çµæ´»æ€§</strong>ï¼šè‡ªç ” &gt; scroll+bulk &gt; reindex</p><p><strong>ç¨³å®šæ€§</strong> &amp; <strong>å¯é æ€§</strong>ï¼šè‡ªç ” &lt; scroll+bulk &lt; reindex</p><h3 id="DeepPagingæ€§èƒ½è§£å†³æ–¹æ¡ˆ"><a href="#DeepPagingæ€§èƒ½è§£å†³æ–¹æ¡ˆ" class="headerlink" title="DeepPagingæ€§èƒ½è§£å†³æ–¹æ¡ˆ"></a>DeepPagingæ€§èƒ½è§£å†³æ–¹æ¡ˆ</h3><blockquote><p>æ¯”å¦‚è¶…çº§ç®¡ç†å‘˜ï¼Œè¦ç»™æŸä¸ªçœä»½ç”¨æˆ·å‘é€å…¬å‘Šæˆ–è€…å¹¿å‘Šï¼Œæœ€å®¹æ˜“æƒ³åˆ°çš„å°±æ˜¯åˆ©ç”¨ from + size æ¥å®ç°ï¼Œä½†è¿™æ˜¯ä¸ç°å®çš„</p></blockquote><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gne4vx9hu4j30x60gw0w5.jpg" alt="image-20210206212712493" style="zoom:60%;" /><h1 id="äºŒï¼šDocker-K8Sç¯‡"><a href="#äºŒï¼šDocker-K8Sç¯‡" class="headerlink" title="äºŒï¼šDocker&amp;K8Sç¯‡"></a>äºŒï¼šDocker&amp;K8Sç¯‡</h1><blockquote><p>chroot æ˜¯åœ¨ Unix å’Œ Linux ç³»ç»Ÿçš„ä¸€ä¸ªæ“ä½œï¼Œé’ˆå¯¹æ­£åœ¨è¿ä½œçš„è½¯ä»¶è¡Œç¨‹å’Œå®ƒçš„å­è¿›ç¨‹ï¼Œæ”¹å˜å®ƒå¤–æ˜¾çš„æ ¹ç›®å½•ã€‚ä¸€ä¸ªè¿è¡Œåœ¨è¿™ä¸ªç¯å¢ƒä¸‹ï¼Œç»ç”± chroot è®¾ç½®æ ¹ç›®å½•çš„ç¨‹åºï¼Œå®ƒä¸èƒ½å¤Ÿå¯¹è¿™ä¸ªæŒ‡å®šæ ¹ç›®å½•ä¹‹å¤–çš„æ–‡ä»¶è¿›è¡Œè®¿é—®åŠ¨ä½œï¼Œä¸èƒ½è¯»å–ï¼Œä¹Ÿä¸èƒ½æ›´æ”¹å®ƒçš„å†…å®¹ã€‚</p></blockquote><p><strong>è™šæ‹ŸåŒ–æŠ€æœ¯_VMware ã€VirtualBoxã€KVM</strong></p><p>è™šæ‹ŸåŒ–æŠ€æœ¯å°±æ˜¯åœ¨æ“ä½œç³»ç»Ÿä¸Šå¤šåŠ äº†ä¸€ä¸ªè™šæ‹ŸåŒ–å±‚ï¼ˆHypervisorï¼‰ï¼Œå¯ä»¥å°†ç‰©ç†æœºçš„CPUã€å†…å­˜ã€ç¡¬ç›˜ã€ç½‘ç»œç­‰èµ„æºè¿›è¡Œè™šæ‹ŸåŒ–ï¼Œå†é€šè¿‡è™šæ‹ŸåŒ–å‡ºæ¥çš„ç©ºé—´ä¸Šå®‰è£…æ“ä½œç³»ç»Ÿï¼Œæ„å»ºè™šæ‹Ÿçš„åº”ç”¨ç¨‹åºæ‰§è¡Œç¯å¢ƒã€‚è¿™å°±æ˜¯æˆ‘ä»¬é€šå¸¸è¯´çš„è™šæ‹Ÿæœºã€‚</p><p>è™šæ‹Ÿæœºçš„ä¼˜ç‚¹ï¼š</p><ul><li>æå‡ITæ•ˆç‡ã€é™ä½è¿ç»´æˆæœ¬</li><li>æ›´å¿«åœ°éƒ¨ç½²å·¥ä½œè´Ÿè´£</li><li>æé«˜æœåŠ¡å™¨å¯ç”¨æ€§</li></ul><p>è™šæ‹Ÿæœºçš„ç¼ºç‚¹ï¼š</p><ul><li>å ç”¨èµ„æºè¾ƒå¤šã€æ€§èƒ½è¾ƒå·®</li><li>æ‰©å±•ã€è¿ç§»èƒ½åŠ›è¾ƒå·®</li></ul><h3 id="Why-Docker"><a href="#Why-Docker" class="headerlink" title="Why Docker"></a>Why Docker</h3><p><strong>åœºæ™¯</strong></p><ul><li>å¼€å‘äººå‘˜åœ¨æœ¬åœ°ç¼–å†™ä»£ç ï¼Œå¹¶ä½¿ç”¨Dockerå®¹å™¨ä¸å…¶ä»–åŒäº‹å…±äº«åŠ³åŠ¨æˆæœã€‚</li><li>ä½¿ç”¨Dockerå°†åº”ç”¨ç¨‹åºæ¨é€åˆ°æµ‹è¯•ç¯å¢ƒä¸­ï¼Œå¹¶æ‰§è¡Œè‡ªåŠ¨å’Œæ‰‹åŠ¨æµ‹è¯•ã€‚</li><li>å¼€å‘äººå‘˜å¯ä»¥åœ¨å¼€å‘ç¯å¢ƒä¸­å¯¹å…¶è¿›è¡Œä¿®å¤ï¼Œç„¶åå°†å…¶é‡æ–°éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒä¸­ä»¥è¿›è¡Œæµ‹è¯•å’ŒéªŒè¯ã€‚</li><li>æµ‹è¯•å®Œæˆåï¼Œå°†ä¿®è¡¥ç¨‹åºæ¨é€ç»™ç”Ÿäº§ç¯å¢ƒå°±åƒå°†æ›´æ–°çš„é•œåƒæ¨é€åˆ°ç”Ÿäº§ç¯å¢ƒä¸€æ ·ç®€å•ã€‚</li></ul><p><strong>éœ€æ±‚</strong></p><blockquote><p>å¿«é€Ÿï¼Œä¸€è‡´åœ°äº¤ä»˜åº”ç”¨ç¨‹åºã€é•œåƒæ‰“åŒ…ç¯å¢ƒï¼Œé¿å…äº†ç¯å¢ƒä¸ä¸€è‡´çš„é—®é¢˜ï¼Œç®€åŒ–å¼€å‘çš„ç”Ÿå‘½å‘¨æœŸï¼Œé€‚åˆäºå¿«é€Ÿè¿­ä»£æ•æ·å¼€å‘çš„åœºæ™¯</p></blockquote><img src="https://i.loli.net/2021/02/20/7hx2RcvUPKgXpma.png" alt="image-20210220140837929" style="zoom: 50%;" /><h3 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h3><p><strong>Dockerå¼•æ“-å®ˆæŠ¤è¿›ç¨‹</strong></p><p>â€‹Dockerä½¿ç”¨C &#x2F; Sæ¶æ„ ï¼šç”¨æˆ·é€šè¿‡<strong>Dockerå®¢æˆ·ç«¯</strong>ä¸Dockerå®ˆæŠ¤è¿›ç¨‹ï¼ˆDockerå¼•æ“ï¼‰é€šè¿‡Unixå¥—æ¥å­—æˆ–è€…RESTAPIè¿›è¡Œé€šä¿¡ï¼Œ<strong>Dockerå¼•æ“</strong>å®Œæˆäº†æ„å»ºï¼Œè¿è¡Œå’Œåˆ†å‘Dockerå®¹å™¨çš„ç¹é‡å·¥ä½œ</p><p><strong>Dockeré•œåƒ-Dockerfile</strong></p><p>â€‹Dockeré•œåƒç±»ä¼¼äºè™šæ‹Ÿæœºé•œåƒï¼Œæ˜¯ä¸€ä¸ªåªè¯»çš„æ¨¡æ¿ï¼Œæ˜¯åˆ›å»ºDockerå®¹å™¨çš„åŸºç¡€</p><p>â€‹é•œåƒæ˜¯åŸºäºè”åˆï¼ˆUnionï¼‰æ–‡ä»¶ç³»ç»Ÿçš„ä¸€ç§å±‚å¼çš„ç»“æ„ï¼Œç”±ä¸€ç³»åˆ—æŒ‡ä»¤ä¸€æ­¥ä¸€æ­¥æ„å»ºå‡ºæ¥ã€‚</p><p>â€‹æ¯”å¦‚ï¼šæ‹·è´æ–‡ä»¶ã€æ‰§è¡Œå‘½ä»¤</p><p><strong>Dockerä»“åº“-Hub</strong></p><p>Dockerä»“åº“å¯ä»¥åˆ†ä¸º<strong>å…¬å¼€ä»“åº“ ï¼ˆPublicï¼‰</strong>å’Œ<strong>ç§æœ‰ä»“åº“ï¼ˆPrivateï¼‰</strong>ä¸¤ç§å½¢å¼ã€‚</p><p>æœ€å¤§çš„å…¬å¼€ä»“åº“æ˜¯å®˜æ–¹æä¾›çš„<strong>Docker Hub</strong>ï¼Œå…¶ä¸­å­˜æ”¾äº†æ•°é‡åºå¤§çš„é•œåƒä¾›ç”¨æˆ·ä¸‹è½½ã€‚</p><h3 id="åŸºæœ¬æ“ä½œ"><a href="#åŸºæœ¬æ“ä½œ" class="headerlink" title="åŸºæœ¬æ“ä½œ"></a>åŸºæœ¬æ“ä½œ</h3><p><strong>é•œåƒ</strong></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker pull mysql:5.7.30</span></span><br><span class="line"><span class="number">5.7</span>.<span class="number">30</span>: Pulling <span class="keyword">from</span> library/mysql â€¦â€¦</span><br><span class="line">[root@localhost ~]<span class="comment"># docker images </span></span><br><span class="line">REPOSITORY TAG IMAGE ID CREATED SIZE </span><br><span class="line">mysql <span class="number">5.7</span>.<span class="number">30</span> <span class="number">9</span>cfcce23593a <span class="number">6</span> weeks ago <span class="number">448</span>MB</span><br><span class="line">[root@localhost ~]<span class="comment"># docker tag mysql:5.7.30 mysql5 </span></span><br><span class="line">[root@localhost ~]<span class="comment"># docker images </span></span><br><span class="line">REPOSITORY TAG IMAGE ID CREATED SIZE </span><br><span class="line">mysql5 latest <span class="number">9</span>cfcce23593a <span class="number">6</span> weeks ago <span class="number">448</span>MB </span><br><span class="line">mysql <span class="number">5.7</span>.<span class="number">30</span> <span class="number">9</span>cfcce23593a <span class="number">6</span> weeks ago <span class="number">448</span>MB</span><br><span class="line">[root@localhost ~]<span class="comment"># docker inspect mysql:5.7.30 </span></span><br><span class="line">[&#123;æ˜¾ç¤ºdocker è¯¦ç»†ä¿¡æ¯&#125;]</span><br><span class="line">[root@localhost ~]<span class="comment"># docker search mysql</span></span><br><span class="line">[root@localhost ~]<span class="comment"># docker rmi mysql:5.7.30</span></span><br><span class="line">[root@localhost ~]<span class="comment"># docker push mysql[:TAG]</span></span><br></pre></td></tr></table></figure><p><strong>å®¹å™¨</strong></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker create -it nginx</span></span><br><span class="line">[root@localhost ~]<span class="comment"># docker start 9cfcce23593a</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹è¿è¡Œçš„å®¹å™¨ </span></span><br><span class="line">[root@localhost ~]<span class="comment"># docker ps </span></span><br><span class="line"><span class="comment">#æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ </span></span><br><span class="line">[root@localhost ~]<span class="comment"># docker ps -a</span></span><br><span class="line"><span class="comment">#æ–°å»ºå¹¶å¯åŠ¨å®¹å™¨</span></span><br><span class="line">[root@localhost ~]<span class="comment"># docker run -it --rm --network host tomcat:8.5.56-jdk8-openjdk</span></span><br></pre></td></tr></table></figure><h3 id="å®æˆ˜"><a href="#å®æˆ˜" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h3><ol><li><p>åˆ›å»ºä¸€ä¸ªå·ï¼Œå¾…åè¾¹ä½¿ç”¨</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">volume</span><span class="language-bash"> create test_volume</span></span><br></pre></td></tr></table></figure></li><li><p>åˆ†åˆ«å¯åŠ¨2ä¸ªå®¹å™¨æŒ‚åœ¨ä¸Šå·,</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">åœ¨<span class="number">2</span>ä¸ªç»ˆç«¯çª—å£å¯åŠ¨<span class="number">2</span>ä¸ªå®¹å™¨ </span><br><span class="line">docker <span class="keyword">run</span><span class="language-bash"> -it --<span class="built_in">rm</span> -v test_volume:/test nginx:latest /bin/bash</span></span><br><span class="line">docker <span class="keyword">run</span><span class="language-bash"> -it --<span class="built_in">rm</span> -v test_volume:/test nginx:latest /bin/bash </span></span><br><span class="line">cd /test; </span><br><span class="line">touch a.txt </span><br><span class="line">ls /test <span class="comment"># åœ¨ä¸¤ä¸ªå®¹å™¨ä¸­æˆ‘ä»¬å‡å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åˆ›å»ºçš„æ–‡ä»¶ï¼Œshixianåœ¨å¤šä¸ªå®¹å™¨ä¹‹é—´å®ç°æ•°æ®å…±äº«</span></span><br></pre></td></tr></table></figure></li></ol><p>æŒ‚è½½åœ¨å®¹å™¨ &#x2F;test ç›®å½•å†…åˆ›å»ºã€‚ Docker <strong>ä¸æ”¯æŒå®¹å™¨å†…å®‰è£…ç‚¹çš„ç›¸å¯¹è·¯å¾„</strong>ã€‚ å¤šä¸ªå®¹å™¨å¯ä»¥åœ¨åŒä¸€æ—¶é—´æ®µå†…ä½¿ç”¨ç›¸åŒçš„å·ã€‚å¦‚æœä¸¤ä¸ªå®¹å™¨éœ€è¦è®¿é—®å…±äº«æ•°æ®ï¼Œä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªå®¹å™¨å†™å…¥è€Œå¦ä¸€ä¸ªå®¹å™¨è¯»å–æ•°æ®ã€‚ å·å åœ¨é©±åŠ¨ç¨‹åºtestå¿…é¡»å”¯ä¸€ã€‚è¿™æ„å‘³ç€ä¸èƒ½å°†<strong>ç›¸åŒçš„å·å</strong>ä¸ä¸¤ä¸ªä¸åŒçš„é©±åŠ¨ç¨‹åºä¸€èµ·ä½¿ç”¨ã€‚ å¦‚æœæˆ‘ä»¬æŒ‡å®šäº†å½“å‰test_volumeç¨‹åºä¸Šå·²åœ¨ä½¿ç”¨çš„å·åï¼Œåˆ™Dockerä¼šå‡å®šæˆ‘ä»¬è¦é‡ç”¨ç°æœ‰å·ï¼Œå¹¶ä¸”ä¸ä¼šè¿”å›é”™è¯¯ã€‚å¦‚æœå¼€å§‹æ—  test_volume åˆ™ä¼šåˆ›å»ºè¿™ä¸ªå·å½“ç„¶é™¤äº†ä½¿ç”¨å·ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å°†å®¿ä¸»æœºçš„æ–‡ä»¶æ˜ å°„åˆ°å®¹å™¨çš„å·ï¼Œå‘½ä»¤ç±»ä¼¼ï¼Œåªä¸è¿‡ä¸ç”¨æå‰åˆ›å»ºå·ï¼Œè€Œä¸”æ•°æ®ä¼šæ˜ å°„åˆ°å®¿ä¸»æœºä¸Šæ³¨æ„å¦‚æœå®¿ä¸»æœºä¸Šçš„ç›®å½•å¯ä»¥ä¸å­˜åœ¨ï¼Œä¼šåœ¨å¯åŠ¨å®¹å™¨çš„æ—¶å€™åˆ›å»º</p><h1 id="ä¸‰ã€Nettyç¯‡"><a href="#ä¸‰ã€Nettyç¯‡" class="headerlink" title="ä¸‰ã€Nettyç¯‡"></a>ä¸‰ã€Nettyç¯‡</h1><h3 id="æ ¸å¿ƒç»„ä»¶"><a href="#æ ¸å¿ƒç»„ä»¶" class="headerlink" title="æ ¸å¿ƒç»„ä»¶"></a>æ ¸å¿ƒç»„ä»¶</h3><h4 id="1ã€æ•´ä½“ç»“æ„"><a href="#1ã€æ•´ä½“ç»“æ„" class="headerlink" title="1ã€æ•´ä½“ç»“æ„"></a>1ã€æ•´ä½“ç»“æ„</h4><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6ijej9w7j30p00doaim.jpg" alt="image-20210504171606057" style="zoom:50%;" /><p>â€‹</p><p>â€‹<strong>Core æ ¸å¿ƒå±‚</strong><br>â€‹Core æ ¸å¿ƒå±‚æ˜¯ Netty æœ€ç²¾åçš„å†…å®¹ï¼Œå®ƒæä¾›äº†åº•å±‚ç½‘ç»œé€šä¿¡çš„é€šç”¨æŠ½è±¡å’Œå®ç°ï¼ŒåŒ…æ‹¬äº‹ä»¶æ¨¡å‹ã€é€šç”¨APIã€æ”¯æŒé›¶æ‹·è´çš„ ByteBuf ç­‰ã€‚</p><p>â€‹<strong>Protocol Support åè®®æ”¯æŒå±‚</strong><br>â€‹åè®®æ”¯æŒå±‚åŸºæœ¬ä¸Šè¦†ç›–äº†ä¸»æµåè®®çš„ç¼–è§£ç å®ç°ï¼Œå¦‚ HTTPã€Protobufã€WebSocketã€äºŒè¿›åˆ¶ç­‰ä¸»æµåè®®ï¼Œæ­¤å¤– Netty è¿˜æ”¯æŒè‡ªå®šä¹‰åº”ç”¨å±‚åè®®ã€‚Netty ä¸°å¯Œçš„åè®®æ”¯æŒé™ä½äº†ç”¨æˆ·çš„å¼€å‘æˆæœ¬ï¼ŒåŸºäº Netty æˆ‘ä»¬å¯ä»¥å¿«é€Ÿå¼€å‘ HTTPã€WebSocket ç­‰æœåŠ¡ã€‚</p><p>â€‹<strong>Transport Service ä¼ è¾“æœåŠ¡å±‚</strong><br>â€‹ä¼ è¾“æœåŠ¡å±‚æä¾›äº†ç½‘ç»œä¼ è¾“èƒ½åŠ›çš„å®šä¹‰å’Œå®ç°æ–¹æ³•ã€‚å®ƒæ”¯æŒ Socketã€HTTP éš§é“ã€è™šæ‹Ÿæœºç®¡é“ç­‰ä¼ è¾“æ–¹å¼ã€‚Netty å¯¹ TCPã€UDP ç­‰æ•°æ®ä¼ è¾“åšäº†æŠ½è±¡å’Œå°è£…ï¼Œç”¨æˆ·å¯ä»¥æ›´èšç„¦åœ¨ä¸šåŠ¡é€»è¾‘å®ç°ä¸Šï¼Œè€Œä¸å¿…å…³ç³»åº•å±‚æ•°æ®ä¼ è¾“çš„ç»†èŠ‚ã€‚</p><h4 id="2ã€é€»è¾‘æ¶æ„"><a href="#2ã€é€»è¾‘æ¶æ„" class="headerlink" title="2ã€é€»è¾‘æ¶æ„"></a>2ã€é€»è¾‘æ¶æ„</h4><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6iiju6h8j30ry0o6dj0.jpg" alt="image-20210504171514089" style="zoom:50%;" /><p>â€‹</p><p>â€‹<strong>ç½‘ç»œé€šä¿¡å±‚</strong><br>â€‹ç½‘ç»œé€šä¿¡å±‚çš„èŒè´£æ˜¯æ‰§è¡Œç½‘ç»œ I&#x2F;O çš„æ“ä½œã€‚å®ƒæ”¯æŒå¤šç§ç½‘ç»œåè®®å’Œ I&#x2F;O æ¨¡å‹çš„è¿æ¥æ“ä½œã€‚å½“ç½‘ç»œæ•°æ®è¯»å–åˆ°å†…æ ¸ç¼“å†²åŒºåï¼Œä¼šè§¦å‘å„ç§ç½‘ç»œäº‹ä»¶ï¼Œè¿™äº›ç½‘ç»œäº‹ä»¶ä¼šåˆ†å‘ç»™äº‹ä»¶è°ƒåº¦å±‚è¿›è¡Œå¤„ç†ã€‚</p><p>ç½‘ç»œé€šä¿¡å±‚çš„æ ¸å¿ƒç»„ä»¶åŒ…å«<strong>BootStrapã€ServerBootStrapã€Channel</strong>ä¸‰ä¸ªç»„ä»¶ã€‚</p><p>â€‹Bootstrap æ˜¯â€œå¼•å¯¼â€çš„æ„æ€ï¼Œè´Ÿè´£ Netty <strong>å®¢æˆ·ç«¯ç¨‹åº</strong>çš„å¯åŠ¨ã€åˆå§‹åŒ–ã€æœåŠ¡å™¨è¿æ¥ç­‰è¿‡ç¨‹ï¼Œä¸²è”äº† Netty çš„å…¶ä»–æ ¸å¿ƒç»„ä»¶ã€‚</p><p>â€‹ServerBootStrap ç”¨äº<strong>æœåŠ¡ç«¯å¯åŠ¨</strong>ç»‘å®šæœ¬åœ°ç«¯å£ï¼Œä¼šç»‘å®šBoss å’Œ Workerä¸¤ä¸ª EventLoopGroupã€‚</p><p>â€‹Channel çš„æ˜¯â€œ<strong>é€šé“</strong>â€ï¼ŒNetty Channelæä¾›äº†åŸºäºNIOæ›´é«˜å±‚æ¬¡çš„æŠ½è±¡ï¼Œå¦‚ registerã€bindã€connectã€readã€writeã€flush ç­‰ã€‚</p><p>â€‹</p><p>â€‹<strong>äº‹ä»¶è°ƒåº¦å±‚</strong><br>â€‹äº‹ä»¶è°ƒåº¦å±‚çš„èŒè´£æ˜¯é€šè¿‡ Reactor çº¿ç¨‹æ¨¡å‹å¯¹å„ç±»äº‹ä»¶è¿›è¡Œèšåˆå¤„ç†ï¼Œé€šè¿‡ Selector ä¸»å¾ªç¯çº¿ç¨‹é›†æˆå¤šç§äº‹ä»¶ï¼ˆ I&#x2F;O äº‹ä»¶ã€ä¿¡å·äº‹ä»¶ã€å®šæ—¶äº‹ä»¶ç­‰ï¼‰ï¼Œå®é™…çš„ä¸šåŠ¡å¤„ç†é€»è¾‘æ˜¯äº¤ç”±æœåŠ¡ç¼–æ’å±‚ä¸­ç›¸å…³çš„ Handler å®Œæˆã€‚</p><p>äº‹ä»¶è°ƒåº¦å±‚çš„æ ¸å¿ƒç»„ä»¶åŒ…æ‹¬ <strong>EventLoopGroupã€EventLoop</strong>ã€‚</p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6ijuqesxj30ke0ekgpj.jpg" alt="image-20210504171631793" style="zoom:50%;" /><p>â€‹</p><p>â€‹<strong>EventLoop</strong> è´Ÿè´£å¤„ç† Channel ç”Ÿå‘½å‘¨æœŸå†…çš„æ‰€æœ‰ I&#x2F;O äº‹ä»¶ï¼Œå¦‚ acceptã€connectã€readã€write ç­‰ I&#x2F;O äº‹ä»¶</p><p>â€‹â‘ ä¸€ä¸ª EventLoopGroup å¾€å¾€åŒ…å«<strong>ä¸€ä¸ªæˆ–è€…å¤šä¸ª</strong> EventLoopã€‚</p><p>â€‹â‘¡EventLoop åŒä¸€æ—¶é—´ä¼šä¸ä¸€ä¸ªChannelç»‘å®šï¼Œæ¯ä¸ª EventLoop è´Ÿè´£<strong>å¤„ç†ä¸€ç§ç±»å‹ Channel</strong>ã€‚</p><p>â€‹â‘¢Channel åœ¨ç”Ÿå‘½å‘¨æœŸå†…å¯ä»¥å¯¹å’Œå¤šä¸ª EventLoop è¿›è¡Œ<strong>å¤šæ¬¡ç»‘å®šå’Œè§£ç»‘</strong>ã€‚</p><p>â€‹<strong>EventLoopGroup</strong> æ˜¯Netty çš„<strong>æ ¸å¿ƒå¤„ç†å¼•æ“</strong>ï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œä¸»è¦è´Ÿè´£æ¥æ”¶ I&#x2F;O è¯·æ±‚ï¼Œå¹¶åˆ†é…çº¿ç¨‹æ‰§è¡Œå¤„ç†è¯·æ±‚ã€‚é€šè¿‡åˆ›å»ºä¸åŒçš„ EventLoopGroup å‚æ•°é…ç½®ï¼Œå°±å¯ä»¥æ”¯æŒ Reactor çš„ä¸‰ç§çº¿ç¨‹æ¨¡å‹ï¼š</p><p>â€‹<strong>å•çº¿ç¨‹æ¨¡å‹</strong>ï¼šEventLoopGroup åªåŒ…å«ä¸€ä¸ª EventLoopï¼ŒBoss å’Œ Worker ä½¿ç”¨åŒä¸€ä¸ªEventLoopGroupï¼›</p><p>â€‹<strong>å¤šçº¿ç¨‹æ¨¡å‹</strong>ï¼šEventLoopGroup åŒ…å«å¤šä¸ª EventLoopï¼ŒBoss å’Œ Worker ä½¿ç”¨åŒä¸€ä¸ªEventLoopGroupï¼›</p><p>â€‹<strong>ä¸»ä»å¤šçº¿ç¨‹æ¨¡å‹</strong>ï¼šEventLoopGroup åŒ…å«å¤šä¸ª EventLoopï¼ŒBoss æ˜¯ä¸» Reactorï¼ŒWorker æ˜¯ä» Reactorï¼Œå®ƒä»¬åˆ†åˆ«ä½¿ç”¨ä¸åŒçš„ EventLoopGroupï¼Œä¸» Reactor è´Ÿè´£æ–°çš„ç½‘ç»œè¿æ¥ Channel åˆ›å»ºï¼Œç„¶åæŠŠ Channel æ³¨å†Œåˆ°ä» Reactorã€‚</p><p>â€‹<strong>æœåŠ¡ç¼–æ’å±‚</strong><br>â€‹æœåŠ¡ç¼–æ’å±‚çš„èŒè´£æ˜¯è´Ÿè´£ç»„è£…å„ç±»æœåŠ¡ï¼Œå®ƒæ˜¯ Netty çš„æ ¸å¿ƒå¤„ç†é“¾ï¼Œç”¨ä»¥å®ç°ç½‘ç»œäº‹ä»¶çš„åŠ¨æ€ç¼–æ’å’Œæœ‰åºä¼ æ’­ã€‚</p><p>æœåŠ¡ç¼–æ’å±‚çš„æ ¸å¿ƒç»„ä»¶åŒ…æ‹¬ <strong>ChannelPipelineã€ChannelHandlerã€ChannelHandlerContext</strong>ã€‚</p><p>â€‹<strong>ChannelPipeline</strong> æ˜¯ Netty çš„æ ¸å¿ƒç¼–æ’ç»„ä»¶ï¼Œè´Ÿè´£ç»„è£…å„ç§ ChannelHandlerï¼ŒChannelPipeline å†…éƒ¨é€šè¿‡åŒå‘é“¾è¡¨å°†ä¸åŒçš„ ChannelHandler é“¾æ¥åœ¨ä¸€èµ·ã€‚å½“ I&#x2F;O è¯»å†™äº‹ä»¶è§¦å‘æ—¶ï¼ŒPipeline ä¼šä¾æ¬¡è°ƒç”¨ Handler åˆ—è¡¨å¯¹ Channel çš„æ•°æ®è¿›è¡Œæ‹¦æˆªå’Œå¤„ç†ã€‚</p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6il759apj313s068abj.jpg" alt="image-20210504171749533" style="zoom:50%;" /><p>â€‹</p><p>â€‹å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æœ‰å„è‡ªçš„ ChannelPipelineã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¸€æ¬¡å®Œæ•´çš„è¯·æ±‚ï¼šå®¢æˆ·ç«¯å‡ºç«™ï¼ˆEncoder è¯·æ±‚æ•°æ®ï¼‰ã€æœåŠ¡ç«¯å…¥ç«™ï¼ˆDecoderæ¥æ”¶æ•°æ®å¹¶æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼‰ã€æœåŠ¡ç«¯å‡ºç«™ï¼ˆEncoderå“åº”ç»“æœï¼‰ã€‚</p><p>â€‹<strong>ChannelHandler</strong> å®Œæˆæ•°æ®çš„ç¼–è§£ç ä»¥åŠå¤„ç†å·¥ä½œã€‚</p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6ilvuhupj30ye08e0vd.jpg" alt="image-20210504171829071" style="zoom:50%;" /><p>â€‹<strong>ChannelHandlerContext</strong> ç”¨äºä¿å­˜Handler ä¸Šä¸‹æ–‡ï¼Œé€šè¿‡ HandlerContext æˆ‘ä»¬å¯ä»¥çŸ¥é“ Pipeline å’Œ Handler çš„å…³è”å…³ç³»ã€‚HandlerContext å¯ä»¥å®ç° Handler ä¹‹é—´çš„äº¤äº’ï¼ŒHandlerContext åŒ…å«äº† Handler ç”Ÿå‘½å‘¨æœŸçš„æ‰€æœ‰äº‹ä»¶ï¼Œå¦‚ connectã€bindã€readã€flushã€writeã€close ç­‰ã€‚åŒæ—¶ï¼ŒHandlerContext å®ç°äº†Handleré€šç”¨çš„é€»è¾‘çš„æ¨¡å‹æŠ½è±¡ã€‚</p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6imu2khlj31080gu0xc.jpg" alt="image-20210504171924019" style="zoom:50%;" /><h3 id="ç½‘ç»œä¼ è¾“"><a href="#ç½‘ç»œä¼ è¾“" class="headerlink" title="ç½‘ç»œä¼ è¾“"></a>ç½‘ç»œä¼ è¾“</h3><h4 id="1ã€äº”ç§IOæ¨¡å‹çš„åŒºåˆ«"><a href="#1ã€äº”ç§IOæ¨¡å‹çš„åŒºåˆ«" class="headerlink" title="1ã€äº”ç§IOæ¨¡å‹çš„åŒºåˆ«"></a><strong>1ã€äº”ç§IOæ¨¡å‹çš„åŒºåˆ«</strong></h4><p><strong>é˜»å¡I&#x2F;Oï¼šï¼ˆBIOï¼‰</strong></p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6ingki0yj30kw0d6gmr.jpg" alt="image-20210504171959821" style="zoom:50%;" /><p>â€‹</p><p>â€‹åº”ç”¨è¿›ç¨‹å‘å†…æ ¸å‘èµ· I&#x2F;O è¯·æ±‚ï¼Œå‘èµ·è°ƒç”¨çš„çº¿ç¨‹ä¸€ç›´ç­‰å¾…å†…æ ¸è¿”å›ç»“æœã€‚ä¸€æ¬¡å®Œæ•´çš„ I&#x2F;O è¯·æ±‚ç§°ä¸ºBIOï¼ˆBlocking IOï¼Œé˜»å¡ I&#x2F;Oï¼‰ï¼Œæ‰€ä»¥ BIO åœ¨å®ç°å¼‚æ­¥æ“ä½œæ—¶ï¼Œåªèƒ½ä½¿ç”¨å¤šçº¿ç¨‹æ¨¡å‹ï¼Œä¸€ä¸ªè¯·æ±‚å¯¹åº”ä¸€ä¸ªçº¿ç¨‹ã€‚ä½†æ˜¯ï¼Œ<strong>çº¿ç¨‹çš„èµ„æºæ˜¯æœ‰é™ä¸”å®è´µçš„ï¼Œåˆ›å»ºè¿‡å¤šçš„çº¿ç¨‹ä¼šå¢åŠ çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€ã€‚</strong></p><p><strong>åŒæ­¥éé˜»å¡I&#x2F;Oï¼ˆNIOï¼‰ï¼š</strong></p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6inzsk9xj30lg0cign1.jpg" alt="image-20210504172029418" style="zoom:50%;" /><p>â€‹</p><p>â€‹åº”ç”¨è¿›ç¨‹å‘å†…æ ¸å‘èµ· I&#x2F;O è¯·æ±‚åä¸å†ä¼šåŒæ­¥ç­‰å¾…ç»“æœï¼Œè€Œæ˜¯ä¼šç«‹å³è¿”å›ï¼Œé€šè¿‡è½®è¯¢çš„æ–¹å¼è·å–è¯·æ±‚ç»“æœã€‚NIO ç›¸æ¯” BIO è™½ç„¶å¤§å¹…æå‡äº†æ€§èƒ½ï¼Œä½†æ˜¯è½®è¯¢è¿‡ç¨‹ä¸­å¤§é‡çš„ç³»ç»Ÿè°ƒç”¨å¯¼è‡´ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€å¾ˆå¤§ã€‚æ‰€ä»¥ï¼Œå•ç‹¬ä½¿ç”¨éé˜»å¡ I&#x2F;O æ—¶æ•ˆç‡å¹¶ä¸é«˜ï¼Œè€Œä¸”<strong>éšç€å¹¶å‘é‡çš„æå‡ï¼Œéé˜»å¡ I&#x2F;O ä¼šå­˜åœ¨ä¸¥é‡çš„æ€§èƒ½æµªè´¹ã€‚</strong></p><p><strong>å¤šè·¯å¤ç”¨I&#x2F;Oï¼ˆselectå’Œpollï¼‰ï¼š</strong></p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6iogl9x0j30ja0cqdh7.jpg" alt="image-20210504172057237" style="zoom:50%;" /><p>â€‹</p><p>â€‹å¤šè·¯å¤ç”¨å®ç°äº†<strong>ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ª I&#x2F;O å¥æŸ„çš„æ“ä½œ</strong>ã€‚å¤šè·¯æŒ‡çš„æ˜¯å¤šä¸ªæ•°æ®é€šé“ï¼Œå¤ç”¨æŒ‡çš„æ˜¯ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªå›ºå®šçº¿ç¨‹æ¥å¤„ç†æ¯ä¸€ä¸ª Socketã€‚selectã€pollã€epoll éƒ½æ˜¯ I&#x2F;O å¤šè·¯å¤ç”¨çš„å…·ä½“å®ç°ï¼Œçº¿ç¨‹ä¸€æ¬¡ select è°ƒç”¨å¯ä»¥è·å–å†…æ ¸æ€ä¸­å¤šä¸ªæ•°æ®é€šé“çš„æ•°æ®çŠ¶æ€ã€‚å…¶ä¸­ï¼Œselectåªè´Ÿè´£ç­‰ï¼Œrecvfromåªè´Ÿè´£æ‹·è´ï¼Œé˜»å¡IOä¸­å¯ä»¥å¯¹å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦è¿›è¡Œé˜»å¡ç›‘å¬ï¼Œæ˜¯ä¸€ç§éå¸¸é«˜æ•ˆçš„ I&#x2F;O æ¨¡å‹ã€‚</p><p><strong>ä¿¡å·é©±åŠ¨I&#x2F;Oï¼ˆSIGIOï¼‰ï¼š</strong></p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6ioxthajj30ii0cemyk.jpg" alt="image-20210504172124965" style="zoom:50%;" /><p>â€‹</p><p>â€‹ä¿¡å·é©±åŠ¨IOæ¨¡å‹ï¼Œåº”ç”¨è¿›ç¨‹å‘Šè¯‰å†…æ ¸ï¼šå½“æ•°æ®æŠ¥å‡†å¤‡å¥½çš„æ—¶å€™ï¼Œç»™æˆ‘å‘é€ä¸€ä¸ªä¿¡å·ï¼Œå¯¹SIGIOä¿¡å·è¿›è¡Œæ•æ‰ï¼Œå¹¶ä¸”è°ƒç”¨æˆ‘çš„ä¿¡å·å¤„ç†å‡½æ•°æ¥è·å–æ•°æ®æŠ¥ã€‚</p><p><strong>å¼‚æ­¥I&#x2F;Oï¼ˆPosix.1çš„aio_ç³»åˆ—å‡½æ•°ï¼‰ï¼š</strong></p><p>â€‹<img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6ipcc12jj30lg0coabe.jpg" alt="image-20210504172148095" style="zoom:50%;" /></p><p>â€‹å½“åº”ç”¨ç¨‹åºè°ƒç”¨aio_readæ—¶ï¼Œå†…æ ¸ä¸€æ–¹é¢å»å–æ•°æ®æŠ¥å†…å®¹è¿”å›ï¼Œå¦ä¸€æ–¹é¢å°†ç¨‹åºæ§åˆ¶æƒè¿˜ç»™åº”ç”¨è¿›ç¨‹ï¼Œåº”ç”¨è¿›ç¨‹ç»§ç»­å¤„ç†å…¶ä»–äº‹æƒ…ï¼Œæ˜¯ä¸€ç§éé˜»å¡çš„çŠ¶æ€ã€‚å½“å†…æ ¸ä¸­æœ‰æ•°æ®æŠ¥å°±ç»ªæ—¶ï¼Œç”±å†…æ ¸å°†æ•°æ®æŠ¥æ‹·è´åˆ°åº”ç”¨ç¨‹åºä¸­ï¼Œè¿”å›aio_readä¸­å®šä¹‰å¥½çš„å‡½æ•°å¤„ç†ç¨‹åºã€‚</p><h4 id="2ã€Reactorå¤šçº¿ç¨‹æ¨¡å‹"><a href="#2ã€Reactorå¤šçº¿ç¨‹æ¨¡å‹" class="headerlink" title="2ã€Reactorå¤šçº¿ç¨‹æ¨¡å‹"></a>2ã€Reactorå¤šçº¿ç¨‹æ¨¡å‹</h4><p>â€‹Netty çš„ I&#x2F;O æ¨¡å‹æ˜¯åŸºäº<strong>éé˜»å¡ I&#x2F;O</strong> å®ç°çš„ï¼Œåº•å±‚ä¾èµ–çš„æ˜¯ NIO æ¡†æ¶çš„<strong>å¤šè·¯å¤ç”¨å™¨ Selector</strong>ã€‚é‡‡ç”¨ <strong>epoll æ¨¡å¼</strong>åï¼Œåªéœ€è¦ä¸€ä¸ªçº¿ç¨‹è´Ÿè´£ Selector çš„è½®è¯¢ã€‚å½“æœ‰æ•°æ®å¤„äºå°±ç»ªçŠ¶æ€åï¼Œéœ€è¦ä¸€ä¸ª<strong>äº‹ä»¶åˆ†å‘å™¨</strong>ï¼ˆEvent Dispatherï¼‰ï¼Œå®ƒè´Ÿè´£å°†è¯»å†™äº‹ä»¶åˆ†å‘ç»™å¯¹åº”çš„è¯»å†™<strong>äº‹ä»¶å¤„ç†å™¨</strong>ï¼ˆEvent Handlerï¼‰ã€‚äº‹ä»¶åˆ†å‘å™¨æœ‰ä¸¤ç§è®¾è®¡æ¨¡å¼ï¼š<strong>Reactor å’Œ Proactor</strong>ï¼ŒReactor é‡‡ç”¨åŒæ­¥ I&#x2F;Oï¼Œ Proactor é‡‡ç”¨å¼‚æ­¥ I&#x2F;Oã€‚</p><p>â€‹</p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6ipob6wjj30we0i4jz2.jpg" alt="image-20210504172207142" style="zoom:50%;" /><p>â€‹Reactor å®ç°ç›¸å¯¹ç®€å•ï¼Œé€‚åˆå¤„ç†è€—æ—¶çŸ­çš„åœºæ™¯ï¼Œå¯¹äºè€—æ—¶é•¿çš„ I&#x2F;O æ“ä½œå®¹æ˜“é€ æˆé˜»å¡ã€‚Proactor æ€§èƒ½æ›´é«˜ï¼Œä½†æ˜¯å®ç°é€»è¾‘éå¸¸å¤æ‚ï¼Œé€‚åˆå›¾ç‰‡æˆ–è§†é¢‘æµåˆ†ææœåŠ¡å™¨ï¼Œç›®å‰ä¸»æµçš„äº‹ä»¶é©±åŠ¨æ¨¡å‹è¿˜æ˜¯ä¾èµ– <strong>select æˆ– epoll</strong> æ¥å®ç°ã€‚</p><h4 id="3ã€æ‹†åŒ…ç²˜åŒ…é—®é¢˜"><a href="#3ã€æ‹†åŒ…ç²˜åŒ…é—®é¢˜" class="headerlink" title="3ã€æ‹†åŒ…ç²˜åŒ…é—®é¢˜"></a>3ã€æ‹†åŒ…ç²˜åŒ…é—®é¢˜</h4><p><strong>æ‹†åŒ…</strong>TCP ä¼ è¾“åè®®æ˜¯é¢å‘æµçš„ï¼Œæ²¡æœ‰æ•°æ®åŒ…ç•Œé™ã€‚<br><strong>MTUï¼ˆMaxitum Transmission Unitï¼‰</strong> æ˜¯é“¾è·¯å±‚ä¸€æ¬¡æœ€å¤§ä¼ è¾“æ•°æ®çš„å¤§å°ã€‚MTU ä¸€èˆ¬æ¥è¯´å¤§å°ä¸º 1500 byteã€‚<strong>MSSï¼ˆMaximum Segement Sizeï¼‰</strong> æ˜¯æŒ‡ TCP æœ€å¤§æŠ¥æ–‡æ®µé•¿åº¦ï¼Œå®ƒæ˜¯ä¼ è¾“å±‚ä¸€æ¬¡å‘é€æœ€å¤§æ•°æ®çš„å¤§å°ã€‚</p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6iq4xdjtj30q407egnk.jpg" alt="image-20210504172233844" style="zoom:50%;" /><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¦‚æœ MSS + TCP é¦–éƒ¨ + IP é¦–éƒ¨ &gt; MTUï¼Œé‚£ä¹ˆæ•°æ®åŒ…å°†ä¼šè¢«æ‹†åˆ†ä¸ºå¤šä¸ªå‘é€ã€‚è¿™å°±æ˜¯<strong>æ‹†åŒ…ç°è±¡</strong>ã€‚</p><p><strong>Nagle ç®—æ³•</strong><br>Nagle ç®—æ³•å¯ä»¥ç†è§£ä¸ºæ‰¹é‡å‘é€ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å¹³æ—¶ç¼–ç¨‹ä¸­ç»å¸¸ç”¨åˆ°çš„ä¼˜åŒ–æ€è·¯ï¼Œå®ƒæ˜¯åœ¨æ•°æ®æœªå¾—åˆ°ç¡®è®¤ä¹‹å‰å…ˆå†™å…¥ç¼“å†²åŒºï¼Œç­‰å¾…æ•°æ®ç¡®è®¤æˆ–è€…ç¼“å†²åŒºç§¯æ”’åˆ°ä¸€å®šå¤§å°å†æŠŠæ•°æ®åŒ…å‘é€å‡ºå»ã€‚Netty ä¸­ä¸ºäº†ä½¿æ•°æ®<strong>ä¼ è¾“å»¶è¿Ÿæœ€å°åŒ–</strong>ï¼Œå°±é»˜è®¤<strong>ç¦ç”¨äº† Nagle ç®—æ³•</strong>ã€‚</p><p><strong>æ‹†åŒ…&#x2F;ç²˜åŒ…çš„è§£å†³æ–¹æ¡ˆ</strong></p><p>åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯é€šä¿¡çš„è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡ç«¯ä¸€æ¬¡è¯»åˆ°çš„æ•°æ®å¤§å°æ˜¯ä¸ç¡®å®šçš„ã€‚éœ€è¦ç¡®å®šè¾¹ç•Œï¼š</p><p><strong>æ¶ˆæ¯é•¿åº¦å›ºå®š</strong><br><strong>ç‰¹å®šåˆ†éš”ç¬¦</strong><br><strong>æ¶ˆæ¯é•¿åº¦ + æ¶ˆæ¯å†…å®¹</strong>(Netty)</p><h4 id="4ã€è‡ªå®šä¹‰åè®®"><a href="#4ã€è‡ªå®šä¹‰åè®®" class="headerlink" title="4ã€è‡ªå®šä¹‰åè®®"></a>4ã€è‡ªå®šä¹‰åè®®</h4><p>Netty å¸¸ç”¨ç¼–ç å™¨ç±»å‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MessageToByteEncoder <span class="comment">//å¯¹è±¡ç¼–ç æˆå­—èŠ‚æµï¼›</span></span><br><span class="line"></span><br><span class="line">MessageToMessageEncoder <span class="comment">//ä¸€ç§æ¶ˆæ¯ç±»å‹ç¼–ç æˆå¦å¤–ä¸€ç§æ¶ˆæ¯ç±»å‹ã€‚</span></span><br></pre></td></tr></table></figure><p>Netty å¸¸ç”¨è§£ç å™¨ç±»å‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ByteToMessageDecoder/ReplayingDecoder <span class="comment">//å°†å­—èŠ‚æµè§£ç ä¸ºæ¶ˆæ¯å¯¹è±¡ï¼›</span></span><br><span class="line"></span><br><span class="line">MessageToMessageDecoder <span class="comment">//å°†ä¸€ç§æ¶ˆæ¯ç±»å‹è§£ç ä¸ºå¦å¤–ä¸€ç§æ¶ˆæ¯ç±»å‹ã€‚</span></span><br></pre></td></tr></table></figure><p>ç¼–è§£ç å™¨å¯ä»¥åˆ†ä¸º<strong>ä¸€æ¬¡è§£ç å™¨</strong>å’Œ<strong>äºŒæ¬¡è§£ç å™¨</strong>ï¼Œä¸€æ¬¡è§£ç å™¨ç”¨äºè§£å†³ <strong>TCP æ‹†åŒ…&#x2F;ç²˜åŒ…é—®é¢˜</strong>ï¼ŒæŒ‰åè®®è§£æåå¾—åˆ°çš„å­—èŠ‚æ•°æ®ã€‚å¦‚æœä½ éœ€è¦å¯¹è§£æåçš„<strong>å­—èŠ‚æ•°æ®åšå¯¹è±¡æ¨¡å‹</strong>çš„è½¬æ¢ï¼Œè¿™æ—¶å€™ä¾¿éœ€è¦ç”¨åˆ°äºŒæ¬¡è§£ç å™¨ï¼ŒåŒç†ç¼–ç å™¨çš„è¿‡ç¨‹æ˜¯åè¿‡æ¥çš„ã€‚</p><p><strong>Nettyè‡ªå®šä¹‰åè®®å†…å®¹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">+---------------------------------------------------------------+</span></span><br><span class="line"><span class="comment">| é­”æ•° 2byte | åè®®ç‰ˆæœ¬å· 1byte | åºåˆ—åŒ–ç®—æ³• 1byte | æŠ¥æ–‡ç±»å‹ 1byteÂ  |</span></span><br><span class="line"><span class="comment">+---------------------------------------------------------------+</span></span><br><span class="line"><span class="comment">| çŠ¶æ€ 1byte |Â  Â  Â  Â  ä¿ç•™å­—æ®µ 4byteÂ  Â  Â |Â  Â  Â  æ•°æ®é•¿åº¦ 4byteÂ  Â  Â |Â </span></span><br><span class="line"><span class="comment">+---------------------------------------------------------------+</span></span><br><span class="line"><span class="comment">|Â  Â  Â  Â  Â  Â  Â  Â  Â  Â æ•°æ®å†…å®¹ ï¼ˆé•¿åº¦ä¸å®šï¼‰Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  |</span></span><br><span class="line"><span class="comment">+---------------------------------------------------------------+</span></span><br><span class="line"><span class="comment">Â */</span></span><br></pre></td></tr></table></figure><p>å¦‚ä½•åˆ¤æ–­ ByteBuf æ˜¯å¦å­˜åœ¨å®Œæ•´çš„æŠ¥æ–‡ï¼Ÿæœ€å¸¸ç”¨çš„åšæ³•å°±æ˜¯é€šè¿‡è¯»å–æ¶ˆæ¯é•¿åº¦ dataLength è¿›è¡Œåˆ¤æ–­ã€‚å¦‚æœ ByteBuf çš„å¯è¯»æ•°æ®é•¿åº¦å°äº dataLengthï¼Œè¯´æ˜ ByteBuf è¿˜ä¸å¤Ÿè·å–ä¸€ä¸ªå®Œæ•´çš„æŠ¥æ–‡ã€‚</p><h4 id="5ã€WriteAndFlush"><a href="#5ã€WriteAndFlush" class="headerlink" title="5ã€WriteAndFlush"></a>5ã€WriteAndFlush</h4><p>â€‹<img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6iqnas8fj31400lkaj2.jpg" alt="image-20210504172303465" style="zoom:50%;" /></p><p>â€‹â‘ writeAndFlush å±äºå‡ºç«™æ“ä½œï¼Œå®ƒæ˜¯ä» Pipeline çš„ Tail èŠ‚ç‚¹å¼€å§‹è¿›è¡Œäº‹ä»¶ä¼ æ’­ï¼Œä¸€ç›´å‘å‰ä¼ æ’­åˆ° Head èŠ‚ç‚¹ã€‚ä¸ç®¡åœ¨ write è¿˜æ˜¯ flush è¿‡ç¨‹ï¼ŒHead èŠ‚ç‚¹éƒ½ä¸­æ‰®æ¼”ç€é‡è¦çš„è§’è‰²ã€‚</p><p>â€‹â‘¡write æ–¹æ³•å¹¶æ²¡æœ‰å°†æ•°æ®å†™å…¥ Socket ç¼“å†²åŒºï¼Œåªæ˜¯å°†æ•°æ®å†™å…¥åˆ° ChannelOutboundBuffer ç¼“å­˜ä¸­ï¼ŒChannelOutboundBuffer ç¼“å­˜å†…éƒ¨æ˜¯ç”±å•å‘é“¾è¡¨å®ç°çš„ã€‚</p><p>â€‹â‘¢flush æ–¹æ³•æ‰æœ€ç»ˆå°†æ•°æ®å†™å…¥åˆ° Socket ç¼“å†²åŒºã€‚</p><h3 id="å†…å­˜ç®¡ç†"><a href="#å†…å­˜ç®¡ç†" class="headerlink" title="å†…å­˜ç®¡ç†"></a>å†…å­˜ç®¡ç†</h3><h4 id="1ã€å †å¤–å†…å­˜"><a href="#1ã€å †å¤–å†…å­˜" class="headerlink" title="1ã€å †å¤–å†…å­˜"></a>1ã€å †å¤–å†…å­˜</h4><p>â€‹åœ¨ Java ä¸­å¯¹è±¡éƒ½æ˜¯åœ¨å †å†…åˆ†é…çš„ï¼Œé€šå¸¸æˆ‘ä»¬è¯´çš„<strong>JVM å†…å­˜</strong>ä¹Ÿå°±æŒ‡çš„<strong>å †å†…å†…å­˜</strong>ï¼Œ<strong>å †å†…å†…å­˜</strong>å®Œå…¨è¢«<strong>JVM è™šæ‹Ÿæœº</strong>æ‰€ç®¡ç†ï¼ŒJVM æœ‰è‡ªå·±çš„åƒåœ¾å›æ”¶ç®—æ³•ï¼Œå¯¹äºä½¿ç”¨è€…æ¥è¯´ä¸å¿…å…³å¿ƒå¯¹è±¡çš„å†…å­˜å¦‚ä½•å›æ”¶ã€‚<strong>å †å¤–å†…å­˜</strong>ä¸å †å†…å†…å­˜ç›¸å¯¹åº”ï¼Œå¯¹äºæ•´ä¸ªæœºå™¨å†…å­˜è€Œè¨€ï¼Œé™¤<strong>å †å†…å†…å­˜ä»¥å¤–éƒ¨åˆ†å³ä¸ºå †å¤–å†…å­˜</strong>ã€‚å †å¤–å†…å­˜ä¸å— JVM è™šæ‹Ÿæœºç®¡ç†ï¼Œç›´æ¥ç”±æ“ä½œç³»ç»Ÿç®¡ç†ã€‚ä½¿ç”¨å †å¤–å†…å­˜æœ‰å¦‚ä¸‹å‡ ä¸ªä¼˜ç‚¹ï¼š</p><ol><li>å †å†…å†…å­˜ç”± JVM GC è‡ªåŠ¨å›æ”¶å†…å­˜ï¼Œé™ä½äº† Java ç”¨æˆ·çš„ä½¿ç”¨å¿ƒæ™ºï¼Œå †å¤–å†…å­˜ç”±äºä¸å— JVM ç®¡ç†ï¼Œæ‰€ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥é™ä½ GC å¯¹åº”ç”¨è¿è¡Œæ—¶å¸¦æ¥çš„å½±å“ã€‚</li><li>å †å¤–å†…å­˜éœ€è¦æ‰‹åŠ¨é‡Šæ”¾ï¼Œè¿™ä¸€ç‚¹è·Ÿ C&#x2F;C++ å¾ˆåƒï¼Œç¨æœ‰ä¸æ…å°±ä¼šé€ æˆåº”ç”¨ç¨‹åºå†…å­˜æ³„æ¼ï¼Œå½“å‡ºç°å†…å­˜æ³„æ¼é—®é¢˜æ—¶æ’æŸ¥èµ·æ¥ä¼šç›¸å¯¹å›°éš¾ã€‚</li><li>å½“è¿›è¡Œç½‘ç»œ I&#x2F;O æ“ä½œã€æ–‡ä»¶è¯»å†™æ—¶ï¼Œå †å†…å†…å­˜éƒ½éœ€è¦è½¬æ¢ä¸ºå †å¤–å†…å­˜ï¼Œç„¶åå†ä¸åº•å±‚è®¾å¤‡è¿›è¡Œäº¤äº’ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨å †å¤–å†…å­˜å¯ä»¥å‡å°‘ä¸€æ¬¡å†…å­˜æ‹·è´ã€‚</li><li>å †å¤–å†…å­˜å¯ä»¥æ–¹ä¾¿å®ç°è¿›ç¨‹ä¹‹é—´ã€JVM å¤šå®ä¾‹ä¹‹é—´çš„æ•°æ®å…±äº«ã€‚</li></ol><p>â€‹    åœ¨å †å†…å­˜æ”¾çš„ DirectByteBuffer å¯¹è±¡å¹¶ä¸å¤§ï¼Œä»…ä»…åŒ…å«å †å¤–å†…å­˜çš„åœ°å€ã€å¤§å°ç­‰å±æ€§ï¼ŒåŒæ—¶è¿˜ä¼šåˆ›å»ºå¯¹åº”çš„ Cleaner å¯¹è±¡ï¼Œé€šè¿‡ ByteBuffer åˆ†é…çš„å †å¤–å†…å­˜ä¸éœ€è¦æ‰‹åŠ¨å›æ”¶ï¼Œå®ƒå¯ä»¥è¢« JVM è‡ªåŠ¨å›æ”¶ã€‚å½“å †å†…çš„ DirectByteBuffer å¯¹è±¡è¢« GC å›æ”¶æ—¶ï¼ŒCleaner å°±ä¼šç”¨äºå›æ”¶å¯¹åº”çš„å †å¤–å†…å­˜ã€‚</p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6ir0d0cmj30qw0hw41z.jpg" alt="image-20210504172324820" style="zoom:50%;" /><p>â€‹ä» DirectByteBuffer çš„æ„é€ å‡½æ•°ä¸­å¯ä»¥çœ‹å‡ºï¼ŒçœŸæ­£åˆ†é…å †å¤–å†…å­˜çš„é€»è¾‘è¿˜æ˜¯é€šè¿‡ unsafe.allocateMemory(size)ï¼ŒUnsafe æ˜¯ä¸€ä¸ªéå¸¸ä¸å®‰å…¨çš„ç±»ï¼Œå®ƒç”¨äºæ‰§è¡Œå†…å­˜è®¿é—®ã€åˆ†é…ã€ä¿®æ”¹ç­‰<strong>æ•æ„Ÿæ“ä½œ</strong>ï¼Œå¯ä»¥è¶Šè¿‡ JVM é™åˆ¶çš„æ·é”ã€‚Unsafe æœ€åˆå¹¶ä¸æ˜¯ä¸ºå¼€å‘è€…è®¾è®¡çš„ï¼Œä½¿ç”¨å®ƒæ—¶è™½ç„¶å¯ä»¥è·å–å¯¹åº•å±‚èµ„æºçš„æ§åˆ¶æƒï¼Œä½†ä¹Ÿå¤±å»äº†å®‰å…¨æ€§çš„ä¿è¯ï¼Œä½¿ç”¨ Unsafe ä¸€å®šè¦æ…é‡ï¼ˆJava ä¸­æ˜¯ä¸èƒ½ç›´æ¥ä½¿ç”¨ Unsafe çš„ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡åå°„è·å– Unsafe å®ä¾‹ï¼‰ã€‚Netty ä¸­ä¾èµ–äº† Unsafe å·¥å…·ç±»ï¼Œæ˜¯å› ä¸º Netty éœ€è¦ä¸åº•å±‚ Socket è¿›è¡Œäº¤äº’ï¼ŒUnsafe æå‡ Netty çš„æ€§èƒ½</p><p>â€‹ å› ä¸ºDirectByteBuffer å¯¹è±¡çš„å›æ”¶éœ€è¦ä¾èµ– Old GC æˆ–è€… Full GC æ‰èƒ½è§¦å‘æ¸…ç†ï¼Œå¦‚æœé•¿æ—¶é—´æ²¡æœ‰ GCæ‰§è¡Œï¼Œé‚£ä¹ˆå †å¤–å†…å­˜å³ä½¿ä¸å†ä½¿ç”¨ï¼Œä¹Ÿä¼šä¸€ç›´åœ¨å ç”¨å†…å­˜ä¸é‡Šæ”¾ï¼Œå¾ˆå®¹æ˜“å°†æœºå™¨çš„ç‰©ç†å†…å­˜è€—å°½ã€‚-XX:MaxDirectMemorySize æŒ‡å®šå †å¤–å†…å­˜çš„ä¸Šé™å¤§å°ï¼Œè¶…å‡ºæ—¶è§¦å‘GCï¼Œä»æ— æ³•é‡Šæ”¾æŠ›å‡ºOOMå¼‚å¸¸ã€‚</p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6ir0d0cmj30qw0hw41z.jpg" alt="image-20210504172324820" style="zoom:50%;" /><p>â€‹å½“åˆå§‹åŒ–å †å¤–å†…å­˜æ—¶ï¼Œå†…å­˜ä¸­çš„å¯¹è±¡å¼•ç”¨æƒ…å†µå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œfirst æ˜¯ Cleaner ç±»ä¸­çš„é™æ€å˜é‡ï¼ŒCleaner å¯¹è±¡åœ¨åˆå§‹åŒ–æ—¶ä¼šåŠ å…¥ Cleaner é“¾è¡¨ä¸­ã€‚DirectByteBuffer å¯¹è±¡åŒ…å«å †å¤–å†…å­˜çš„åœ°å€ã€å¤§å°ä»¥åŠ Cleaner å¯¹è±¡çš„å¼•ç”¨ï¼ŒReferenceQueue ç”¨äºä¿å­˜éœ€è¦å›æ”¶çš„ Cleaner å¯¹è±¡ã€‚</p><p>â€‹</p><h4 id="2ã€æ•°æ®è½½ä½“ByteBuf"><a href="#2ã€æ•°æ®è½½ä½“ByteBuf" class="headerlink" title="2ã€æ•°æ®è½½ä½“ByteBuf"></a>2ã€<strong>æ•°æ®è½½ä½“ByteBuf</strong></h4><p>JDK NIO çš„ <strong>ByteBuffer</strong></p><ul><li>markï¼šä¸ºæŸä¸ªè¯»å–è¿‡çš„å…³é”®ä½ç½®åšæ ‡è®°ï¼Œæ–¹ä¾¿å›é€€åˆ°è¯¥ä½ç½®ï¼›</li><li>positionï¼šå½“å‰è¯»å–çš„ä½ç½®ï¼›</li><li>limitï¼šbuffer ä¸­æœ‰æ•ˆçš„æ•°æ®é•¿åº¦å¤§å°ï¼›</li><li>capacityï¼šåˆå§‹åŒ–æ—¶çš„ç©ºé—´å®¹é‡ã€‚</li></ul><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6irlptv0j30z408wabn.jpg" alt="image-20210504172358702" style="zoom:50%;" /><p>â€‹ç¬¬ä¸€ï¼ŒByteBuffer åˆ†é…çš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œæ— æ³•åŠ¨æ€æ‰©ç¼©å®¹ï¼Œæ¯æ¬¡åœ¨å­˜æ”¾æ•°æ®çš„æ—¶å€™å¯¹å®¹é‡å¤§å°åšæ ¡éªŒï¼Œæ‰©å®¹éœ€è¦å°†å·²æœ‰çš„æ•°æ®è¿ç§»ã€‚</p><p>â€‹ç¬¬äºŒï¼ŒByteBuffer åªèƒ½é€šè¿‡ position è·å–å½“å‰å¯æ“ä½œçš„ä½ç½®ï¼Œå› ä¸ºè¯»å†™å…±ç”¨çš„ position æŒ‡é’ˆï¼Œæ‰€ä»¥éœ€è¦é¢‘ç¹è°ƒç”¨ flipã€rewind æ–¹æ³•åˆ‡æ¢è¯»å†™çŠ¶æ€ã€‚</p><p>Nettyä¸­çš„ByteBuf</p><ul><li><strong>åºŸå¼ƒå­—èŠ‚</strong>ï¼Œè¡¨ç¤ºå·²ç»ä¸¢å¼ƒçš„æ— æ•ˆå­—èŠ‚æ•°æ®ã€‚</li><li><strong>å¯è¯»å­—èŠ‚</strong>ï¼Œè¡¨ç¤º ByteBuf ä¸­å¯ä»¥è¢«è¯»å–çš„å­—èŠ‚å†…å®¹ï¼Œå¯ä»¥é€šè¿‡ writeIndex - readerIndex è®¡ç®—å¾—å‡ºã€‚å½“è¯»å†™ä½ç½®é‡å æ—¶æ—¶ï¼Œè¡¨ç¤º ByteBuf å·²ç»ä¸å¯è¯»ã€‚</li><li><strong>å¯å†™å­—èŠ‚</strong>ï¼Œå‘ ByteBuf ä¸­å†™å…¥æ•°æ®éƒ½ä¼šå­˜å‚¨åˆ°å¯å†™å­—èŠ‚åŒºåŸŸã€‚å½“ writeIndex è¶…è¿‡ capacityï¼Œè¡¨ç¤º ByteBuf å®¹é‡ä¸è¶³ï¼Œéœ€è¦æ‰©å®¹ã€‚</li><li><strong>å¯æ‰©å®¹å­—èŠ‚</strong>ï¼Œè¡¨ç¤º ByteBuf æœ€å¤šè¿˜å¯ä»¥æ‰©å®¹å¤šå°‘å­—èŠ‚ï¼Œæœ€å¤šæ‰©å®¹åˆ° maxCapacity ä¸ºæ­¢ï¼Œè¶…è¿‡ maxCapacity å†å†™å…¥å°±ä¼šå‡ºé”™ã€‚</li></ul><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6j1t85zuj31020ds42m.jpg" alt="image-20210504173347000" style="zoom:50%;" /><p><strong>å¼•ç”¨è®¡æ•°</strong></p><p>â€‹å½“byteBufå½“å¼•ç”¨è®¡æ•°ä¸º 0ï¼Œè¯¥ ByteBuf å¯ä»¥è¢«æ”¾å…¥åˆ°å¯¹è±¡æ± ä¸­ï¼Œé¿å…æ¯æ¬¡ä½¿ç”¨ ByteBuf éƒ½é‡å¤åˆ›å»ºã€‚</p><p>â€‹JVM å¹¶ä¸çŸ¥é“ Netty çš„å¼•ç”¨è®¡æ•°æ˜¯å¦‚ä½•å®ç°çš„ï¼Œå½“ ByteBuf å¯¹è±¡ä¸å¯è¾¾æ—¶ï¼Œä¸€æ ·ä¼šè¢« GC å›æ”¶æ‰ï¼Œä½†æ˜¯å¦‚æœæ­¤æ—¶ ByteBuf çš„å¼•ç”¨è®¡æ•°ä¸ä¸º 0ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡å°±ä¸ä¼šé‡Šæ”¾æˆ–è€…è¢«æ”¾å…¥å¯¹è±¡æ± ï¼Œä»è€Œå‘ç”Ÿäº†å†…å­˜æ³„æ¼ã€‚Netty ä¼šå¯¹åˆ†é…çš„ ByteBuf è¿›è¡ŒæŠ½æ ·åˆ†æï¼Œæ£€æµ‹ ByteBuf æ˜¯å¦å·²ç»ä¸å¯è¾¾ä¸”å¼•ç”¨è®¡æ•°å¤§äº 0ï¼Œåˆ¤å®šå†…å­˜æ³„æ¼çš„ä½ç½®å¹¶è¾“å‡ºåˆ°æ—¥å¿—ä¸­ï¼Œ<strong>é€šè¿‡å…³æ³¨æ—¥å¿—ä¸­ LEAK å…³é”®å­—å¯ä»¥æ‰¾åˆ°å†…å­˜æ³„æ¼çš„å…·ä½“å¯¹è±¡</strong>ã€‚</p><h4 id="3ã€å†…å­˜åˆ†é…jemalloc"><a href="#3ã€å†…å­˜åˆ†é…jemalloc" class="headerlink" title="3ã€å†…å­˜åˆ†é…jemalloc"></a>3ã€<strong>å†…å­˜åˆ†é…jemalloc</strong></h4><p>â€‹ä¸ºäº†å‡å°‘åˆ†é…æ—¶äº§ç”Ÿçš„å†…éƒ¨ç¢ç‰‡å’Œå¤–éƒ¨ç¢ç‰‡ï¼Œå¸¸è§çš„å†…å­˜åˆ†é…ç®—æ³•<strong>åŠ¨æ€å†…å­˜åˆ†é…</strong>ã€<strong>ä¼™ä¼´ç®—æ³•</strong>å’Œ<strong>Slab ç®—æ³•</strong></p><p><strong>åŠ¨æ€å†…å­˜åˆ†é…ï¼ˆDMAï¼‰</strong></p><p>â€‹<strong>â¾¸æ¬¡é€‚åº”ç®—æ³•ï¼ˆfirst fitï¼‰</strong>ï¼Œç©ºé—²åˆ†åŒºé“¾ä»¥åœ°å€é€’å¢çš„é¡ºåºå°†ç©ºé—²åˆ†åŒºä»¥åŒå‘é“¾è¡¨çš„å½¢å¼è¿æ¥åœ¨ä¸€èµ·ï¼Œä»ç©ºé—²åˆ†åŒºé“¾ä¸­æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³åˆ†é…æ¡ä»¶çš„ç©ºé—²åˆ†åŒºï¼Œç„¶åä»ç©ºé—²åˆ†åŒºä¸­åˆ’åˆ†å‡ºä¸€å—å¯ç”¨å†…å­˜ç»™è¯·æ±‚è¿›ç¨‹ï¼Œå‰©ä½™çš„ç©ºé—²åˆ†åŒºä»ç„¶ä¿ç•™åœ¨ç©ºé—²åˆ†åŒºé“¾ä¸­ã€‚</p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6j26fh88j30ni0ea41c.jpg" alt="image-20210504173407923" style="zoom:50%;" /><p>â€‹<strong>å¾ªç¯é¦–æ¬¡é€‚åº”ç®—æ³•ï¼ˆnext fitï¼‰</strong>ä¸å†æ˜¯æ¯æ¬¡ä»é“¾è¡¨çš„å¼€å§‹è¿›è¡ŒæŸ¥æ‰¾ï¼Œè€Œæ˜¯ä»ä¸Šæ¬¡æ‰¾åˆ°çš„ç©ºé—²åˆ†åŒºçš„ä»¥åå¼€å§‹æŸ¥æ‰¾ã€‚æŸ¥æ‰¾æ•ˆç‡æå‡ï¼Œä¼šäº§ç”Ÿæ›´å¤šçš„ç¢ç‰‡ã€‚</p><p>â€‹<strong>æœ€ä½³é€‚åº”ç®—æ³•ï¼ˆbest fitï¼‰</strong>ï¼Œç©ºé—²åˆ†åŒºé“¾ä»¥ç©ºé—²åˆ†åŒºå¤§å°é€’å¢çš„é¡ºåºå°†ç©ºé—²åˆ†åŒºä»¥åŒå‘é“¾è¡¨çš„å½¢å¼è¿æ¥åœ¨ä¸€èµ·ï¼Œæ¯æ¬¡ä»ç©ºé—²åˆ†åŒºé“¾çš„å¼€å¤´è¿›è¡ŒæŸ¥æ‰¾ã€‚</p><p><strong>ä¼™ä¼´ç®—æ³•</strong>ï¼ˆå¤–éƒ¨ç¢ç‰‡å°‘ï¼Œå†…éƒ¨ç¢ç‰‡å¤šï¼‰</p><p>â€‹æ˜¯ä¸€ç§éå¸¸ç»å…¸çš„å†…å­˜åˆ†é…ç®—æ³•ï¼Œå®ƒé‡‡ç”¨äº†<strong>åˆ†ç¦»é€‚é…çš„è®¾è®¡æ€æƒ³</strong>ï¼Œå°†ç‰©ç†å†…å­˜æŒ‰ç…§ 2 çš„æ¬¡å¹‚è¿›è¡Œåˆ’åˆ†ï¼Œå†…å­˜åˆ†é…æ—¶ä¹Ÿæ˜¯æŒ‰ç…§ 2 çš„æ¬¡å¹‚å¤§å°è¿›è¡ŒæŒ‰éœ€åˆ†é…</p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6j2m0rr1j30ly0iugnk.jpg" alt="image-20210504173433749" style="zoom:50%;" /><ol><li>é¦–å…ˆéœ€è¦æ‰¾åˆ°å­˜å‚¨ 2^4 è¿ç»­ Page æ‰€å¯¹åº”çš„é“¾è¡¨ï¼Œå³æ•°ç»„ä¸‹æ ‡ä¸º 4ï¼›</li><li>æŸ¥æ‰¾ 2^4 é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç©ºé—²çš„å†…å­˜å—ï¼Œå¦‚æœæœ‰åˆ™åˆ†é…æˆåŠŸï¼›</li><li>å¦‚æœ 2^4 é“¾è¡¨ä¸å­˜åœ¨ç©ºé—²çš„å†…å­˜å—ï¼Œåˆ™ç»§ç»­æ²¿æ•°ç»„å‘ä¸ŠæŸ¥æ‰¾ï¼Œå³å®šä½åˆ°æ•°ç»„ä¸‹æ ‡ä¸º 5 çš„é“¾è¡¨ï¼Œé“¾è¡¨ä¸­æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨ 2^5 çš„è¿ç»­ Pageï¼›</li><li>å¦‚æœ 2^5 é“¾è¡¨ä¸­å­˜åœ¨ç©ºé—²çš„å†…å­˜å—ï¼Œåˆ™å–å‡ºè¯¥å†…å­˜å—å¹¶å°†å®ƒåˆ†å‰²ä¸º 2 ä¸ª 2^4 å¤§å°çš„å†…å­˜å—ï¼Œå…¶ä¸­ä¸€å—åˆ†é…ç»™è¿›ç¨‹ä½¿ç”¨ï¼Œå‰©ä½™çš„ä¸€å—é“¾æ¥åˆ° 2^4 é“¾è¡¨ä¸­ã€‚</li></ol><p><strong>Slab ç®—æ³•ï¼ˆè§£å†³ä¼™ä¼´ç®—æ³•å†…éƒ¨ç¢ç‰‡é—®é¢˜ï¼‰</strong></p><p>â€‹Slab ç®—æ³•åœ¨ä¼™ä¼´ç®—æ³•çš„åŸºç¡€ä¸Šï¼Œå¯¹å°å†…å­˜çš„åœºæ™¯ä¸“é—¨åšäº†ä¼˜åŒ–ï¼Œé‡‡ç”¨äº†å†…å­˜æ± çš„æ–¹æ¡ˆï¼Œè§£å†³å†…éƒ¨ç¢ç‰‡é—®é¢˜ã€‚</p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6j3160yuj30rw0eo77o.jpg" alt="image-20210504173454562" style="zoom:50%;" /><p>åœ¨ Slab ç®—æ³•ä¸­ç»´æŠ¤ç€å¤§å°ä¸åŒçš„ Slab é›†åˆï¼Œå°†è¿™å—å†…å­˜åˆ’åˆ†ä¸ºå¤§å°ç›¸åŒçš„ slotï¼Œä¸ä¼šå¯¹å†…å­˜å—å†è¿›è¡Œåˆå¹¶ï¼ŒåŒæ—¶ä½¿ç”¨ä½å›¾ bitmap è®°å½•æ¯ä¸ª slot çš„ä½¿ç”¨æƒ…å†µã€‚</p><p>â€‹kmem_cache ä¸­åŒ…å«ä¸‰ä¸ª Slab é“¾è¡¨ï¼š<strong>å®Œå…¨åˆ†é…ä½¿ç”¨ slab_full</strong>ã€<strong>éƒ¨åˆ†åˆ†é…ä½¿ç”¨ slab_partial</strong>å’Œ<strong>å®Œå…¨ç©ºé—² slabs_empty</strong>ï¼Œè¿™ä¸‰ä¸ªé“¾è¡¨è´Ÿè´£å†…å­˜çš„åˆ†é…å’Œé‡Šæ”¾ã€‚Slab ç®—æ³•æ˜¯åŸºäºå¯¹è±¡è¿›è¡Œå†…å­˜ç®¡ç†çš„ï¼Œå®ƒæŠŠç›¸åŒç±»å‹çš„å¯¹è±¡åˆ†ä¸ºä¸€ç±»ã€‚å½“åˆ†é…å†…å­˜æ—¶ï¼Œä» Slab é“¾è¡¨ä¸­åˆ’åˆ†ç›¸åº”çš„å†…å­˜å•å…ƒï¼›å•ä¸ª Slab å¯ä»¥åœ¨ä¸åŒçš„é“¾è¡¨ä¹‹é—´ç§»åŠ¨ï¼Œä¾‹å¦‚å½“ä¸€ä¸ª Slab è¢«åˆ†é…å®Œï¼Œå°±ä¼šä» slab_partial ç§»åŠ¨åˆ° slabs_fullï¼Œå½“ä¸€ä¸ª Slab ä¸­æœ‰å¯¹è±¡è¢«é‡Šæ”¾åï¼Œå°±ä¼šä» slab_full å†æ¬¡å›åˆ° slab_partialï¼Œæ‰€æœ‰å¯¹è±¡éƒ½è¢«é‡Šæ”¾å®Œçš„è¯ï¼Œå°±ä¼šä» slab_partial ç§»åŠ¨åˆ° slab_emptyã€‚å½“<strong>é‡Šæ”¾å†…å­˜æ—¶ï¼ŒSlab ç®—æ³•å¹¶ä¸ä¼šä¸¢å¼ƒå·²ç»åˆ†é…çš„å¯¹è±¡ï¼Œè€Œæ˜¯å°†å®ƒä¿å­˜åœ¨ç¼“å­˜ä¸­ï¼Œå½“ä¸‹æ¬¡å†ä¸ºå¯¹è±¡åˆ†é…å†…å­˜æ—¶ï¼Œç›´æ¥ä¼šä½¿ç”¨æœ€è¿‘é‡Šæ”¾çš„å†…å­˜å—</strong>ã€‚</p><h4 id="4ã€jemalloc-æ¶æ„"><a href="#4ã€jemalloc-æ¶æ„" class="headerlink" title="4ã€jemalloc æ¶æ„"></a>4ã€jemalloc æ¶æ„</h4><ul><li>å†…å­˜æ˜¯ç”±ä¸€å®šæ•°é‡çš„ arenas è´Ÿè´£ç®¡ç†ï¼Œçº¿ç¨‹å‡åŒ€åˆ†å¸ƒåœ¨ arenas å½“ä¸­ï¼›</li><li>æ¯ä¸ª arena éƒ½åŒ…å«ä¸€ä¸ª bin æ•°ç»„ï¼Œæ¯ä¸ª bin ç®¡ç†ä¸åŒæ¡£ä½çš„å†…å­˜å—ï¼›</li><li>æ¯ä¸ª arena è¢«åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ª chunksï¼Œæ¯ä¸ª chunk åˆåŒ…å«è‹¥å¹²ä¸ª runsï¼Œæ¯ä¸ª run ç”±è¿ç»­çš„ Page ç»„æˆï¼Œrun æ‰æ˜¯å®é™…åˆ†é…å†…å­˜çš„æ“ä½œå¯¹è±¡ï¼›</li><li>æ¯ä¸ª run ä¼šè¢«åˆ’åˆ†ä¸ºä¸€å®šæ•°é‡çš„ regionsï¼Œåœ¨å°å†…å­˜çš„åˆ†é…åœºæ™¯ï¼Œregion ç›¸å½“äºç”¨æˆ·å†…å­˜ï¼›</li><li>æ¯ä¸ª tcache å¯¹åº”ä¸€ä¸ª arenaï¼Œtcache ä¸­åŒ…å«å¤šç§ç±»å‹çš„ binã€‚</li></ul><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6j3160yuj30rw0eo77o.jpg" alt="image-20210504173454562" style="zoom:50%;" /><p><strong>å†…å­˜ç®¡ç†Arena</strong> ï¼Œå†…å­˜ç”±ä¸€å®šæ•°é‡çš„ arenas è´Ÿè´£ç®¡ç†ã€‚æ¯ä¸ªç”¨æˆ·çº¿ç¨‹é‡‡ç”¨ round-robin è½®è¯¢çš„æ–¹å¼é€‰æ‹©å¯ç”¨çš„ arena è¿›è¡Œå†…å­˜åˆ†é…ã€‚</p><p><strong>åˆ†çº§ç®¡ç†Bin</strong>ï¼Œæ¯ä¸ª bin ç®¡ç†çš„å†…å­˜å¤§å°æ˜¯æŒ‰åˆ†ç±»ä¾æ¬¡é€’å¢ã€‚<strong>jemalloc ä¸­å°å†…å­˜çš„åˆ†é…æ˜¯åŸºäº Slab ç®—æ³•</strong>å®Œæˆçš„ï¼Œä¼šäº§ç”Ÿä¸åŒç±»åˆ«çš„å†…å­˜å—ã€‚</p><p><strong>Pageé›†åˆchunk</strong>ï¼Œchunk ä»¥ Page ä¸ºå•ä½ç®¡ç†å†…å­˜ã€‚æ¯ä¸ª chunk å¯è¢«ç”¨äºå¤šæ¬¡å°å†…å­˜çš„ç”³è¯·ï¼Œä½†æ˜¯åœ¨å¤§å†…å­˜åˆ†é…çš„åœºæ™¯ä¸‹åªèƒ½åˆ†é…ä¸€æ¬¡ã€‚</p><p><strong>å®é™…åˆ†é…å•ä½run</strong>ï¼Œrun ç»“æ„å…·ä½“çš„å¤§å°ç”±ä¸åŒçš„ bin å†³å®šï¼Œä¾‹å¦‚ 8 å­—èŠ‚çš„ bin å¯¹åº”çš„ run åªæœ‰ä¸€ä¸ª Pageï¼Œå¯ä»¥ä»ä¸­é€‰å– 8 å­—èŠ‚çš„å—è¿›è¡Œåˆ†é…ã€‚</p><p><strong>run ç»†åˆ†region</strong>ï¼Œæ¯ä¸ª run ä¼šå°†åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªç­‰é•¿çš„ regionï¼Œæ¯æ¬¡å†…å­˜åˆ†é…ä¹Ÿæ˜¯æŒ‰ç…§ region è¿›è¡Œåˆ†å‘ã€‚</p><p><strong>tcache æ˜¯æ¯ä¸ªçº¿ç¨‹ç§æœ‰çš„ç¼“å­˜</strong>ï¼Œtcache æ¯æ¬¡ä» arena ç”³è¯·ä¸€æ‰¹å†…å­˜ï¼Œåœ¨åˆ†é…å†…å­˜æ—¶é¦–å…ˆåœ¨ tcache æŸ¥æ‰¾ï¼Œé¿å…é”ç«äº‰ï¼Œåˆ†é…å¤±è´¥æ‰ä¼šé€šè¿‡ run æ‰§è¡Œå†…å­˜åˆ†é…ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gx2u1jn9b3j31e80hqjt5.jpg" alt="image-20211205121406792"></p><p>Small åœºæ™¯ï¼Œå¦‚æœè¯·æ±‚åˆ†é…å†…å­˜çš„å¤§å°å°äº arena ä¸­çš„æœ€å°çš„ binï¼Œé‚£ä¹ˆä¼˜å…ˆä»çº¿ç¨‹ä¸­å¯¹åº”çš„ tcache ä¸­è¿›è¡Œåˆ†é…ã€‚é¦–å…ˆç¡®å®šæŸ¥æ‰¾å¯¹åº”çš„ tbin ä¸­æ˜¯å¦å­˜åœ¨ç¼“å­˜çš„å†…å­˜å—ï¼Œå¦‚æœå­˜åœ¨åˆ™åˆ†é…æˆåŠŸï¼Œå¦åˆ™æ‰¾åˆ° tbin å¯¹åº”çš„ arenaï¼Œä» arena ä¸­å¯¹åº”çš„ bin ä¸­åˆ†é… region ä¿å­˜åœ¨ tbin çš„ avail æ•°ç»„ä¸­ï¼Œæœ€ç»ˆä» availl æ•°ç»„ä¸­é€‰å–ä¸€ä¸ªåœ°å€è¿›è¡Œå†…å­˜åˆ†é…ï¼Œå½“å†…å­˜é‡Šæ”¾æ—¶ä¹Ÿä¼šå°†è¢«å›æ”¶çš„å†…å­˜å—è¿›è¡Œç¼“å­˜ã€‚</p><p>Large åœºæ™¯çš„å†…å­˜åˆ†é…ä¸ Smalll ç±»ä¼¼ï¼Œå¦‚æœè¯·æ±‚åˆ†é…å†…å­˜çš„å¤§å°å¤§äº arena ä¸­çš„æœ€å°çš„ binï¼Œä½†æ˜¯ä¸å¤§äº tcache ä¸­èƒ½å¤Ÿç¼“å­˜çš„æœ€å¤§å—ï¼Œä¾ç„¶ä¼šé€šè¿‡ tcache è¿›è¡Œåˆ†é…ï¼Œä½†æ˜¯ä¸åŒçš„æ˜¯æ­¤æ—¶ä¼šåˆ†é… chunk ä»¥åŠæ‰€å¯¹åº”çš„ runï¼Œä» chunk ä¸­æ‰¾åˆ°ç›¸åº”çš„å†…å­˜ç©ºé—´è¿›è¡Œåˆ†é…ã€‚å†…å­˜é‡Šæ”¾æ—¶ä¹Ÿè·Ÿ samll åœºæ™¯ç±»ä¼¼ï¼Œä¼šæŠŠé‡Šæ”¾çš„å†…å­˜å—ç¼“å­˜åœ¨ tacache çš„ tbin ä¸­ã€‚æ­¤å¤–è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œå½“è¯·æ±‚åˆ†é…å†…å­˜çš„å¤§å°å¤§äºtcache ä¸­èƒ½å¤Ÿç¼“å­˜çš„æœ€å¤§å—ï¼Œä½†æ˜¯ä¸å¤§äº chunk çš„å¤§å°ï¼Œé‚£ä¹ˆå°†ä¸ä¼šé‡‡ç”¨ tcache æœºåˆ¶ï¼Œç›´æ¥åœ¨ chunk ä¸­è¿›è¡Œå†…å­˜åˆ†é…ã€‚</p><p>Huge åœºæ™¯ï¼Œå¦‚æœè¯·æ±‚åˆ†é…å†…å­˜çš„å¤§å°å¤§äº chunk çš„å¤§å°ï¼Œé‚£ä¹ˆç›´æ¥é€šè¿‡ mmap è¿›è¡Œåˆ†é…ï¼Œè°ƒç”¨ munmap è¿›è¡Œå›æ”¶ã€‚</p><h4 id="5ã€å†…å­˜æ± è®¾è®¡ï¼ˆå¾…è¡¥å……ï¼‰"><a href="#5ã€å†…å­˜æ± è®¾è®¡ï¼ˆå¾…è¡¥å……ï¼‰" class="headerlink" title="5ã€å†…å­˜æ± è®¾è®¡ï¼ˆå¾…è¡¥å……ï¼‰"></a>5ã€å†…å­˜æ± è®¾è®¡ï¼ˆå¾…è¡¥å……ï¼‰</h4><h4 id="6ã€Recycleå¯¹è±¡æ± ï¼ˆå¾…è¡¥å……ï¼‰"><a href="#6ã€Recycleå¯¹è±¡æ± ï¼ˆå¾…è¡¥å……ï¼‰" class="headerlink" title="6ã€Recycleå¯¹è±¡æ± ï¼ˆå¾…è¡¥å……ï¼‰"></a>6ã€Recycleå¯¹è±¡æ± ï¼ˆå¾…è¡¥å……ï¼‰</h4><h4 id="7ã€é›¶æ‹·è´æŠ€æœ¯"><a href="#7ã€é›¶æ‹·è´æŠ€æœ¯" class="headerlink" title="7ã€é›¶æ‹·è´æŠ€æœ¯"></a>7ã€é›¶æ‹·è´æŠ€æœ¯</h4><ol><li>å½“ç”¨æˆ·è¿›ç¨‹å‘èµ· read() è°ƒç”¨åï¼Œä¸Šä¸‹æ–‡ä»ç”¨æˆ·æ€åˆ‡æ¢è‡³å†…æ ¸æ€ã€‚DMA å¼•æ“ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œå¹¶å­˜å‚¨åˆ°å†…æ ¸æ€ç¼“å†²åŒºï¼Œè¿™é‡Œæ˜¯<strong>ç¬¬ä¸€æ¬¡æ•°æ®æ‹·è´</strong>ã€‚</li><li>è¯·æ±‚çš„æ•°æ®ä»å†…æ ¸æ€ç¼“å†²åŒºæ‹·è´åˆ°ç”¨æˆ·æ€ç¼“å†²åŒºï¼Œç„¶åè¿”å›ç»™ç”¨æˆ·è¿›ç¨‹ã€‚<strong>ç¬¬äºŒæ¬¡æ•°æ®æ‹·è´</strong>çš„è¿‡ç¨‹åŒæ—¶ï¼Œä¼šå¯¼è‡´ä¸Šä¸‹æ–‡ä»å†…æ ¸æ€å†æ¬¡åˆ‡æ¢åˆ°ç”¨æˆ·æ€ã€‚</li><li>ç”¨æˆ·è¿›ç¨‹è°ƒç”¨ send() æ–¹æ³•æœŸæœ›å°†æ•°æ®å‘é€åˆ°ç½‘ç»œä¸­ï¼Œç”¨æˆ·æ€ä¼šå†æ¬¡åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œ<strong>ç¬¬ä¸‰æ¬¡æ•°æ®æ‹·è´</strong>è¯·æ±‚çš„æ•°æ®ä»ç”¨æˆ·æ€ç¼“å†²åŒºè¢«æ‹·è´åˆ° Socket ç¼“å†²åŒºã€‚</li><li>æœ€ç»ˆ send() ç³»ç»Ÿè°ƒç”¨ç»“æŸè¿”å›ç»™ç”¨æˆ·è¿›ç¨‹ï¼Œå‘ç”Ÿäº†ç¬¬å››æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚<strong>ç¬¬å››æ¬¡æ‹·è´ä¼šå¼‚æ­¥æ‰§è¡Œ</strong>ï¼Œä» Socket ç¼“å†²åŒºæ‹·è´åˆ°åè®®å¼•æ“ä¸­ã€‚</li></ol><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6jlghxe0j30t00fsjtw.jpg" alt="image-20210504175240348" style="zoom:50%;" /><p>â€‹<strong>åœ¨ Linux ä¸­</strong>ç³»ç»Ÿè°ƒç”¨ sendfile() å¯ä»¥å®ç°å°†æ•°æ®ä»ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¼ è¾“åˆ°å¦ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œä»è€Œå®ç°äº†é›¶æ‹·è´æŠ€æœ¯ã€‚</p><p>â€‹<strong>åœ¨ Java ä¸­</strong>ä¹Ÿä½¿ç”¨äº†é›¶æ‹·è´æŠ€æœ¯ï¼Œå®ƒå°±æ˜¯ NIO FileChannel ç±»ä¸­çš„ transferTo() æ–¹æ³•ï¼Œå®ƒå¯ä»¥å°†æ•°æ®ä» FileChannel ç›´æ¥ä¼ è¾“åˆ°å¦å¤–ä¸€ä¸ª Channelã€‚</p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6jm8q3yej311c0h6q7v.jpg" alt="image-20210504175323875" style="zoom:50%;" /><p><strong>Netty ä¸­çš„é›¶æ‹·è´</strong>æŠ€æœ¯é™¤äº†æ“ä½œç³»ç»Ÿçº§åˆ«çš„åŠŸèƒ½å°è£…ï¼Œæ›´å¤šçš„æ˜¯é¢å‘ç”¨æˆ·æ€çš„æ•°æ®æ“ä½œä¼˜åŒ–ï¼Œä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹ 5 ä¸ªæ–¹é¢ï¼š</p><ul><li>å †å¤–å†…å­˜ï¼Œé¿å… JVM å †å†…å­˜åˆ°å †å¤–å†…å­˜çš„æ•°æ®æ‹·è´ã€‚</li><li>CompositeByteBuf ç±»ï¼Œå¯ä»¥ç»„åˆå¤šä¸ª Buffer å¯¹è±¡åˆå¹¶æˆä¸€ä¸ªé€»è¾‘ä¸Šçš„å¯¹è±¡ï¼Œé¿å…é€šè¿‡ä¼ ç»Ÿå†…å­˜æ‹·è´çš„æ–¹å¼å°†å‡ ä¸ª Buffer åˆå¹¶æˆä¸€ä¸ªå¤§çš„ Bufferã€‚</li><li>é€šè¿‡ Unpooled.wrappedBuffer å¯ä»¥å°† byte æ•°ç»„åŒ…è£…æˆ ByteBuf å¯¹è±¡ï¼ŒåŒ…è£…è¿‡ç¨‹ä¸­ä¸ä¼šäº§ç”Ÿå†…å­˜æ‹·è´ã€‚</li><li>ByteBuf.slice ï¼Œslice æ“ä½œå¯ä»¥å°†ä¸€ä¸ª ByteBuf å¯¹è±¡åˆ‡åˆ†æˆå¤šä¸ª ByteBuf å¯¹è±¡ï¼Œåˆ‡åˆ†è¿‡ç¨‹ä¸­ä¸ä¼šäº§ç”Ÿå†…å­˜æ‹·è´ï¼Œåº•å±‚å…±äº«ä¸€ä¸ª byte æ•°ç»„çš„å­˜å‚¨ç©ºé—´ã€‚</li><li>Netty ä½¿ç”¨ å°è£…äº†transferTo() æ–¹æ³• FileRegionï¼Œå¯ä»¥å°†æ–‡ä»¶ç¼“å†²åŒºçš„æ•°æ®ç›´æ¥ä¼ è¾“åˆ°ç›®æ ‡ Channelï¼Œé¿å…å†…æ ¸ç¼“å†²åŒºå’Œç”¨æˆ·æ€ç¼“å†²åŒºä¹‹é—´çš„æ•°æ®æ‹·è´ã€‚</li></ul><h3 id="é«˜æ€§èƒ½æ•°æ®ç»“æ„"><a href="#é«˜æ€§èƒ½æ•°æ®ç»“æ„" class="headerlink" title="é«˜æ€§èƒ½æ•°æ®ç»“æ„"></a>é«˜æ€§èƒ½æ•°æ®ç»“æ„</h3><h4 id="1ã€FastThreadLocal"><a href="#1ã€FastThreadLocal" class="headerlink" title="1ã€FastThreadLocal"></a>1ã€FastThreadLocal</h4><p>â€‹ThreadLocal å¯ä»¥ç†è§£ä¸ºçº¿ç¨‹æœ¬åœ°å˜é‡ã€‚ThreadLocal ä¸ºå˜é‡åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­éƒ½åˆ›å»ºäº†ä¸€ä¸ªå‰¯æœ¬ï¼Œè¯¥å‰¯æœ¬åªèƒ½è¢«å½“å‰çº¿ç¨‹è®¿é—®ï¼Œå¤šçº¿ç¨‹ä¹‹é—´æ˜¯éš”ç¦»çš„ï¼Œå˜é‡ä¸èƒ½åœ¨å¤šçº¿ç¨‹ä¹‹é—´å…±äº«ã€‚è¿™æ ·æ¯ä¸ªçº¿ç¨‹ä¿®æ”¹å˜é‡å‰¯æœ¬æ—¶ï¼Œä¸ä¼šå¯¹å…¶ä»–çº¿ç¨‹äº§ç”Ÿå½±å“ã€‚</p><p>â€‹æ—¢ç„¶å¤šçº¿ç¨‹è®¿é—® ThreadLocal å˜é‡æ—¶éƒ½ä¼šæœ‰è‡ªå·±ç‹¬ç«‹çš„å®ä¾‹å‰¯æœ¬ï¼Œé‚£ä¹ˆå¾ˆå®¹æ˜“æƒ³åˆ°çš„æ–¹æ¡ˆå°±æ˜¯åœ¨ ThreadLocal ä¸­ç»´æŠ¤ä¸€ä¸ª Mapï¼Œè®°å½•çº¿ç¨‹ä¸å®ä¾‹ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚å½“æ–°å¢çº¿ç¨‹å’Œé”€æ¯çº¿ç¨‹æ—¶éƒ½éœ€è¦æ›´æ–° Map ä¸­çš„æ˜ å°„å…³ç³»ï¼Œå› ä¸ºä¼šå­˜åœ¨å¤šçº¿ç¨‹å¹¶å‘ä¿®æ”¹ï¼Œæ‰€ä»¥éœ€è¦ä¿è¯ Map æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä½†æ˜¯åœ¨é«˜å¹¶å‘çš„åœºæ™¯å¹¶å‘ä¿®æ”¹ Map éœ€è¦åŠ é”ï¼ŒåŠ¿å¿…ä¼šé™ä½æ€§èƒ½ã€‚</p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6jmqtl1hj30q60dmtck.jpg" alt="image-20210504175349901" style="zoom:50%;" /><p>â€‹JDK ä¸ºäº†é¿å…åŠ é”ï¼Œé‡‡ç”¨äº†ç›¸åçš„è®¾è®¡æ€è·¯ã€‚ä»¥ Thread å…¥æ‰‹ï¼Œåœ¨ Thread ä¸­ç»´æŠ¤ä¸€ä¸ª Mapï¼Œè®°å½• ThreadLocal ä¸å®ä¾‹ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œè¿™æ ·åœ¨åŒä¸€ä¸ªçº¿ç¨‹å†…ï¼ŒMap å°±ä¸éœ€è¦åŠ é”äº†ã€‚</p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6jmyxnylj30ns06adgu.jpg" alt="image-20210504175406824" style="zoom:50%;" /><p>â€‹ThreadLocalMap æ˜¯ä¸€ç§ä½¿ç”¨çº¿æ€§æ¢æµ‹æ³•å®ç°çš„å“ˆå¸Œè¡¨ï¼Œåº•å±‚é‡‡ç”¨æ•°ç»„å­˜å‚¨æ•°æ®ï¼Œé€šè¿‡é­”æ•°0x61c88647æ¥ä½¿æ•£åˆ—æ›´åŠ å¹³è¡¡ã€‚ThreadLocalMap åˆå§‹åŒ–ä¸€ä¸ªé•¿åº¦ä¸º 16 çš„ Entry æ•°ç»„ã€‚ä¸ HashMap ä¸åŒçš„æ˜¯ï¼ŒEntry çš„ key å°±æ˜¯ ThreadLocalå¯¹è±¡æœ¬èº«ï¼Œvalue å°±æ˜¯ç”¨æˆ·å…·ä½“éœ€è¦å­˜å‚¨çš„å€¼ã€‚</p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6jncecy1j30yy0eejtq.jpg" alt="image-20210504175428964" style="zoom:50%;" /><p>â€‹Entry ç»§æ‰¿è‡ªå¼±å¼•ç”¨ç±» WeakReferenceï¼ŒEntry çš„ key æ˜¯å¼±å¼•ç”¨ï¼Œvalue æ˜¯å¼ºå¼•ç”¨ã€‚åœ¨ JVM åƒåœ¾å›æ”¶æ—¶ï¼Œåªè¦å‘ç°äº†å¼±å¼•ç”¨çš„å¯¹è±¡ï¼Œä¸ç®¡å†…å­˜æ˜¯å¦å……è¶³ï¼Œéƒ½ä¼šè¢«å›æ”¶ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆ Entry çš„ key è¦è®¾è®¡æˆå¼±å¼•ç”¨å‘¢ï¼Ÿå¦‚æœ key éƒ½æ˜¯å¼ºå¼•ç”¨ï¼Œå½“çº¿ ThreadLocal ä¸å†ä½¿ç”¨æ—¶ï¼Œç„¶è€Œ ThreadLocalMap ä¸­è¿˜æ˜¯å­˜åœ¨å¯¹ ThreadLocal çš„å¼ºå¼•ç”¨ï¼Œé‚£ä¹ˆ GC æ˜¯æ— æ³•å›æ”¶çš„ï¼Œä»è€Œé€ æˆå†…å­˜æ³„æ¼ã€‚</p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gm4umi0759j30hi0a03zd.jpg" alt="img" style="zoom: 67%;" /><p>â€‹è™½ç„¶ Entry çš„ key è®¾è®¡æˆäº†å¼±å¼•ç”¨ï¼Œä½†æ˜¯å½“ ThreadLocalä¸å†ä½¿ç”¨(<strong>ä¸šåŠ¡é€»è¾‘èµ°å®Œï¼Œä½†æ˜¯ç”±äºçº¿ç¨‹å¤ç”¨å¯¼è‡´çº¿ç¨‹å¹¶æ²¡æœ‰ç»“æŸ</strong>)è¢« GC å›æ”¶åï¼ŒThreadLocalMap ä¸­å¯èƒ½å‡ºç° Entry çš„ key ä¸º NULLï¼Œé‚£ä¹ˆ Entry çš„ value ä¸€ç›´ä¼šå¼ºå¼•ç”¨æ•°æ®è€Œå¾—ä¸åˆ°é‡Šæ”¾ï¼Œåªèƒ½ç­‰å¾…çº¿ç¨‹é”€æ¯ã€‚é‚£ä¹ˆåº”è¯¥å¦‚ä½•é¿å… ThreadLocalMap å†…å­˜æ³„æ¼å‘¢ï¼ŸThreadLocal å·²ç»å¸®åŠ©æˆ‘ä»¬åšäº†ä¸€å®šçš„ä¿æŠ¤æªæ–½ï¼Œåœ¨æ‰§è¡Œ ThreadLocal.set()&#x2F;get() æ–¹æ³•æ—¶ï¼ŒThreadLocal ä¼šæ¸…é™¤ ThreadLocalMap ä¸­ key ä¸º NULL çš„ Entry å¯¹è±¡ï¼Œè®©å®ƒè¿˜èƒ½å¤Ÿè¢« GC å›æ”¶ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå½“çº¿ç¨‹ä¸­æŸä¸ª ThreadLocal å¯¹è±¡ä¸å†ä½¿ç”¨æ—¶ï¼Œç«‹å³è°ƒç”¨ remove() æ–¹æ³•åˆ é™¤ Entry å¯¹è±¡ã€‚å¦‚æœæ˜¯åœ¨å¼‚å¸¸çš„åœºæ™¯ä¸­ï¼Œåº”åœ¨ finally ä»£ç å—ä¸­è¿›è¡Œæ¸…ç†ï¼Œä¿æŒè‰¯å¥½çš„ç¼–ç æ„è¯†ã€‚åœ¨Nettyä¸­ï¼Œå¯ä»¥æ–¹ä¾¿çš„ä½¿ç”¨FashThreadLocalæ¥é˜²æ­¢å†…å­˜æ³„æ¼</p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gm4ux5gohpj30hs0ajjs1.jpg" alt="img" style="zoom:67%;" /><p><strong>FastThreadLocal</strong></p><p>â€‹FastThreadLocal ä½¿ç”¨ Object æ•°ç»„æ›¿ä»£äº† Entry æ•°ç»„ï¼ŒObject[0] å­˜å‚¨çš„æ˜¯ä¸€ä¸ªSet&lt;FastThreadLocal&lt;?&gt;&gt; é›†åˆï¼Œä»æ•°ç»„ä¸‹æ ‡ 1 å¼€å§‹éƒ½æ˜¯ç›´æ¥å­˜å‚¨çš„ value æ•°æ®ï¼Œä¸å†é‡‡ç”¨ ThreadLocal çš„é”®å€¼å¯¹å½¢å¼è¿›è¡Œå­˜å‚¨ã€‚ä¸»è¦æ˜¯é’ˆå¯¹setæ–¹æ³•ï¼Œå¢åŠ äº†ä¸¤ä¸ªé¢å¤–çš„è¡Œä¸ºã€‚</p><ol><li>æ‰¾åˆ°æ•°ç»„ä¸‹æ ‡ index ä½ç½®ï¼Œè®¾ç½®æ–°çš„ valueã€‚</li><li>å°† <strong>FastThreadLocal å¯¹è±¡ä¿å­˜åˆ°å¾…æ¸…ç†çš„ Set ä¸­</strong>ã€‚</li></ol><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6jnu8l6aj315k060wfi.jpg" alt="image-20210504175457264" style="zoom:50%;" /><ul><li><strong>é«˜æ•ˆæŸ¥æ‰¾</strong>ã€‚FastThreadLocal åœ¨å®šä½æ•°æ®çš„æ—¶å€™å¯ä»¥ç›´æ¥æ ¹æ®æ•°ç»„ä¸‹æ ‡ index è·å–ï¼Œæ—¶é—´å¤æ‚åº¦ O(1)ã€‚è€Œ JDK åŸç”Ÿçš„ ThreadLocal åœ¨æ•°æ®è¾ƒå¤šæ—¶å“ˆå¸Œè¡¨å¾ˆå®¹æ˜“å‘ç”Ÿ Hash å†²çªï¼Œçº¿æ€§æ¢æµ‹æ³•åœ¨è§£å†³ Hash å†²çªæ—¶éœ€è¦ä¸åœåœ°å‘ä¸‹å¯»æ‰¾ï¼Œæ•ˆç‡è¾ƒä½ã€‚æ­¤å¤–ï¼ŒFastThreadLocal ç›¸æ¯” ThreadLocal æ•°æ®æ‰©å®¹æ›´åŠ ç®€å•é«˜æ•ˆï¼ŒFastThreadLocal ä»¥ index ä¸ºåŸºå‡†å‘ä¸Šå–æ•´åˆ° 2 çš„æ¬¡å¹‚ä½œä¸ºæ‰©å®¹åå®¹é‡ï¼Œç„¶åæŠŠåŸæ•°æ®æ‹·è´åˆ°æ–°æ•°ç»„ã€‚è€Œ ThreadLocal ç”±äºé‡‡ç”¨çš„å“ˆå¸Œè¡¨ï¼Œæ‰€ä»¥åœ¨æ‰©å®¹åéœ€è¦å†åšä¸€è½® rehashã€‚</li><li><strong>å®‰å…¨æ€§æ›´é«˜</strong>ã€‚JDK åŸç”Ÿçš„ ThreadLocal ä½¿ç”¨ä¸å½“å¯èƒ½é€ æˆå†…å­˜æ³„æ¼ï¼Œåªèƒ½ç­‰å¾…çº¿ç¨‹é”€æ¯ã€‚åœ¨ä½¿ç”¨çº¿ç¨‹æ± çš„åœºæ™¯ä¸‹ï¼ŒThreadLocal åªèƒ½é€šè¿‡ä¸»åŠ¨æ£€æµ‹çš„æ–¹å¼é˜²æ­¢å†…å­˜æ³„æ¼ï¼Œä»è€Œé€ æˆäº†ä¸€å®šçš„å¼€é”€ã€‚ç„¶è€Œ FastThreadLocal ä¸ä»…æä¾›äº† remove() ä¸»åŠ¨æ¸…é™¤å¯¹è±¡çš„æ–¹æ³•ï¼Œè€Œä¸”åœ¨çº¿ç¨‹æ± åœºæ™¯ä¸­ Netty è¿˜å°è£…äº† FastThreadLocalRunnableï¼Œ<strong>ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åä¸€å®šä¼šæ‰§è¡Œ FastThreadLocal.removeAll() å°† Set é›†åˆä¸­æ‰€æœ‰ FastThreadLocal å¯¹è±¡éƒ½æ¸…ç†æ‰</strong></li></ul><h4 id="2ã€HashedTimerWheel"><a href="#2ã€HashedTimerWheel" class="headerlink" title="2ã€HashedTimerWheel"></a>2ã€<strong>HashedTimerWheel</strong></h4><p>â€‹ç”Ÿæˆæœˆç»Ÿè®¡æŠ¥è¡¨ã€æ¯æ—¥å¾—åˆ†ç»“ç®—ã€é‚®ä»¶å®šæ—¶æ¨é€</p><p>â€‹å®šæ—¶ä»»åŠ¡ä¸‰ç§å½¢å¼ï¼š</p><p>â€‹1ã€æŒ‰å›ºå®šå‘¨æœŸå®šæ—¶æ‰§è¡Œ</p><p>â€‹2ã€å»¶è¿Ÿä¸€å®šæ—¶é—´åæ‰§è¡Œ</p><p>â€‹3ã€æŒ‡å®šæŸä¸ªæ—¶åˆ»æ‰§è¡Œ</p><p>â€‹å®šæ—¶ä»»åŠ¡çš„ä¸‰ä¸ªå…³é”®æ–¹æ³•ï¼š</p><p>â€‹Schedule æ–°å¢ä»»åŠ¡è‡³ä»»åŠ¡é›†åˆï¼›</p><p>â€‹Cancel å–æ¶ˆæŸä¸ªä»»åŠ¡ï¼›</p><p>â€‹Run æ‰§è¡Œåˆ°æœŸçš„ä»»åŠ¡</p><p>JDKè‡ªå¸¦çš„ä¸‰ç§å®šæ—¶å™¨ï¼š<strong>Timer</strong>ã€<strong>DelayedQueue</strong> å’Œ <strong>ScheduledThreadPoolExecutor</strong></p><pre><code>Timerå°æ ¹å †é˜Ÿåˆ—ï¼Œdeadline ä»»åŠ¡ä½äºå †é¡¶ç«¯ï¼Œå¼¹å‡ºçš„å§‹ç»ˆæ˜¯æœ€ä¼˜å…ˆè¢«æ‰§è¡Œçš„ä»»åŠ¡ã€‚Run æ“ä½œæ—¶é—´å¤æ‚åº¦ O(1)ï¼ŒSchedule å’ŒCancel æ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(logn)ã€‚</code></pre><p>ä¸è®ºæœ‰å¤šå°‘ä»»åŠ¡è¢«åŠ å…¥æ•°ç»„ï¼Œå§‹ç»ˆç”± å¼‚æ­¥çº¿ç¨‹TimerThread è´Ÿè´£å¤„ç†ã€‚TimerThread ä¼šå®šæ—¶è½®è¯¢ TaskQueue ä¸­çš„ä»»åŠ¡ï¼Œå¦‚æœå †é¡¶çš„ä»»åŠ¡çš„ deadline å·²åˆ°ï¼Œé‚£ä¹ˆæ‰§è¡Œä»»åŠ¡ï¼›å¦‚æœæ˜¯å‘¨æœŸæ€§ä»»åŠ¡ï¼Œæ‰§è¡Œå®Œæˆåé‡æ–°è®¡ç®—ä¸‹ä¸€æ¬¡ä»»åŠ¡çš„ deadlineï¼Œå¹¶å†æ¬¡æ”¾å…¥å°æ ¹å †ï¼›å¦‚æœæ˜¯å•æ¬¡æ‰§è¡Œçš„ä»»åŠ¡ï¼Œæ‰§è¡Œç»“æŸåä¼šä» TaskQueue ä¸­åˆ é™¤ã€‚</p><p>â€‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DelayedQueue é‡‡ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ— PriorityQueueå»¶è¿Ÿè·å–å¯¹è±¡çš„é˜»å¡é˜Ÿåˆ—ã€‚DelayQueueä¸­çš„æ¯ä¸ªå¯¹è±¡éƒ½å¿…é¡»å®ç°Delayed æ¥å£ï¼Œå¹¶é‡å†™ compareTo å’Œ getDelay æ–¹æ³•ã€‚</span><br></pre></td></tr></table></figure><p>DelayQueue æä¾›äº† put() å’Œ take() çš„é˜»å¡æ–¹æ³•ï¼Œå¯ä»¥å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¯¹è±¡å’Œå–å‡ºå¯¹è±¡ã€‚å¯¹è±¡è¢«æ·»åŠ åˆ° DelayQueue åï¼Œä¼šæ ¹æ® compareTo() æ–¹æ³•è¿›è¡Œä¼˜å…ˆçº§æ’åºã€‚getDelay() æ–¹æ³•ç”¨äºè®¡ç®—æ¶ˆæ¯å»¶è¿Ÿçš„å‰©ä½™æ—¶é—´ï¼Œåªæœ‰ getDelay &lt;&#x3D;0 æ—¶ï¼Œè¯¥å¯¹è±¡æ‰èƒ½ä» DelayQueue ä¸­å–å‡ºã€‚</p><p>DelayQueue åœ¨æ—¥å¸¸å¼€å‘ä¸­æœ€å¸¸ç”¨çš„åœºæ™¯å°±æ˜¯å®ç°é‡è¯•æœºåˆ¶ã€‚ä¾‹å¦‚ï¼Œæ¥å£è°ƒç”¨å¤±è´¥æˆ–è€…è¯·æ±‚è¶…æ—¶åï¼Œå¯ä»¥å°†å½“å‰è¯·æ±‚å¯¹è±¡æ”¾å…¥ DelayQueueï¼Œé€šè¿‡ä¸€ä¸ªå¼‚æ­¥çº¿ç¨‹ take() å–å‡ºå¯¹è±¡ç„¶åç»§ç»­è¿›è¡Œé‡è¯•ã€‚å¦‚æœè¿˜æ˜¯è¯·æ±‚å¤±è´¥ï¼Œç»§ç»­æ”¾å› DelayQueueã€‚å¯ä»¥è®¾ç½®é‡è¯•çš„æœ€å¤§æ¬¡æ•°ä»¥åŠé‡‡ç”¨æŒ‡æ•°é€€é¿ç®—æ³•è®¾ç½®å¯¹è±¡çš„ deadlineï¼Œå¦‚ 2sã€4sã€8sã€16s â€¦â€¦ä»¥æ­¤ç±»æ¨ã€‚DelayQueueçš„æ—¶é—´å¤æ‚åº¦å’ŒTimeråŸºæœ¬ä¸€è‡´ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¸ºäº†è§£å†³ Timer çš„è®¾è®¡ç¼ºé™·ï¼ŒJDK æä¾›äº†åŠŸèƒ½æ›´åŠ ä¸°å¯Œçš„ ScheduledThreadPoolExecutorï¼Œå¤šçº¿ç¨‹ã€ç›¸å¯¹æ—¶é—´ã€å¯¹å¼‚å¸¸</span><br></pre></td></tr></table></figure><p>â€‹Timer æ˜¯å•çº¿ç¨‹æ¨¡å¼ã€‚å¦‚æœæŸä¸ª TimerTask æ‰§è¡Œæ—¶é—´å¾ˆä¹…ï¼Œä¼šå½±å“å…¶ä»–ä»»åŠ¡çš„è°ƒåº¦ã€‚</p><p>â€‹Timer çš„ä»»åŠ¡è°ƒåº¦æ˜¯åŸºäºç³»ç»Ÿç»å¯¹æ—¶é—´çš„ï¼Œå¦‚æœç³»ç»Ÿæ—¶é—´ä¸æ­£ç¡®ï¼Œå¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚</p><p>â€‹TimerTask å¦‚æœæ‰§è¡Œå‡ºç°å¼‚å¸¸ï¼ŒTimer å¹¶ä¸ä¼šæ•è·ï¼Œä¼šå¯¼è‡´çº¿ç¨‹ç»ˆæ­¢ï¼Œå…¶ä»–ä»»åŠ¡æ°¸è¿œä¸ä¼šæ‰§è¡Œã€‚</p><p><strong>æ—¶é—´è½®åŸç†åˆ†æ</strong></p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6jo7abpbj30wi0ciacs.jpg" alt="image-20210504175518335" style="zoom:50%;" /><p>æ ¹æ®ä»»åŠ¡çš„åˆ°æœŸæ—¶é—´è¿›è¡Œå–ä½™å’Œå–æ¨¡ï¼Œç„¶åæ ¹æ®å–ä½™ç»“æœå°†ä»»åŠ¡åˆ†å¸ƒåˆ°ä¸åŒçš„ slot ä¸­ï¼Œæ¯ä¸ªslotä¸­æ ¹æ®roundå€¼å†³å®šæ˜¯å¦æ“ä½œï¼Œæ¯æ¬¡è½®è¯¢åˆ°æŒ‡å®šslotæ—¶ï¼Œæ€»æ—¶éå†æœ€å°‘roundçš„å¯¹è±¡è¿›è¡Œæ‰§è¡Œï¼Œè¿™æ ·æ–°å¢ã€æ‰§è¡Œä¸¤ä¸ªæ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½è¿‘ä¼¼O(1)ã€‚å¦‚æœå†²çªè¾ƒå¤§å¯ä»¥å¢åŠ æ•°ç»„é•¿åº¦ï¼Œæˆ–è€…é‡‡ç”¨å¤šçº§æ—¶é—´è½®çš„æ–¹å¼å¤„ç†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">HashedWheelTimer</span><span class="params">(</span></span><br><span class="line"><span class="params">Â  Â  Â  Â  ThreadFactory threadFactory, //çº¿ç¨‹æ± ï¼Œä½†æ˜¯åªåˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line"><span class="params">Â  Â  Â  Â  <span class="type">long</span> tickDuration,Â //æ—¶é’ˆæ¯æ¬¡ tick çš„æ—¶é—´ï¼Œç›¸å½“äºæ—¶é’ˆé—´éš”å¤šä¹…èµ°åˆ°ä¸‹ä¸€ä¸ª slot</span></span><br><span class="line"><span class="params">Â  Â  Â  Â  TimeUnit unit,Â //è¡¨ç¤º tickDuration çš„æ—¶é—´å•ä½ï¼ŒtickDuration * unit</span></span><br><span class="line"><span class="params">Â  Â  Â  Â  <span class="type">int</span> ticksPerWheel,Â  //æ—¶é—´è½®ä¸Šä¸€å…±æœ‰å¤šå°‘ä¸ª slotï¼Œé»˜è®¤ <span class="number">512</span> ä¸ªã€‚</span></span><br><span class="line"><span class="params">Â  Â  Â  Â  <span class="type">boolean</span> leakDetection,</span></span><br><span class="line"><span class="params">Â  Â  Â  Â  <span class="type">long</span> maxPendingTimeouts)</span> &#123;<span class="comment">//æœ€å¤§å…è®¸ç­‰å¾…ä»»åŠ¡æ•°</span></span><br><span class="line">Â  Â  <span class="comment">// çœç•¥å…¶ä»–ä»£ç </span></span><br><span class="line">Â  Â  wheel = createWheel(ticksPerWheel); <span class="comment">// åˆ›å»ºæ—¶é—´è½®çš„ç¯å½¢æ•°ç»„ç»“æ„</span></span><br><span class="line">Â  Â  mask = wheel.length - <span class="number">1</span>; <span class="comment">// ç”¨äºå¿«é€Ÿå–æ¨¡çš„æ©ç </span></span><br><span class="line">Â  Â  <span class="type">long</span> <span class="variable">duration</span> <span class="operator">=</span> unit.toNanos(tickDuration); <span class="comment">// è½¬æ¢æˆçº³ç§’å¤„ç†</span></span><br><span class="line">Â  Â  workerThread = threadFactory.newThread(worker); <span class="comment">// åˆ›å»ºå·¥ä½œçº¿ç¨‹</span></span><br><span class="line">Â  Â  leak = leakDetection || !workerThread.isDaemon() ? leakDetector.track(<span class="built_in">this</span>) : <span class="literal">null</span>; <span class="comment">// æ˜¯å¦å¼€å¯å†…å­˜æ³„æ¼æ£€æµ‹</span></span><br><span class="line">Â  Â  <span class="built_in">this</span>.maxPendingTimeouts = maxPendingTimeouts; <span class="comment">// æœ€å¤§å…è®¸ç­‰å¾…ä»»åŠ¡æ•°ï¼ŒHashedWheelTimer ä¸­ä»»åŠ¡è¶…å‡ºè¯¥é˜ˆå€¼æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6jofq9r4j315i0fmq96.jpg" alt="image-20210504175531294" style="zoom:50%;" /><p>â€‹<strong>æ—¶é—´è½®ç©ºæ¨è¿›é—®é¢˜</strong></p><p>â€‹Netty ä¸­çš„æ—¶é—´è½®æ˜¯é€šè¿‡å›ºå®šçš„æ—¶é—´é—´éš” tickDuration è¿›è¡Œæ¨åŠ¨çš„ï¼Œå¦‚æœé•¿æ—¶é—´æ²¡æœ‰åˆ°æœŸä»»åŠ¡ï¼Œé‚£ä¹ˆä¼šå­˜åœ¨æ—¶é—´è½®ç©ºæ¨è¿›çš„ç°è±¡ï¼Œä»è€Œé€ æˆä¸€å®šçš„æ€§èƒ½æŸè€—ã€‚æ­¤å¤–ï¼Œå¦‚æœä»»åŠ¡çš„åˆ°æœŸæ—¶é—´è·¨åº¦å¾ˆå¤§ï¼Œä¾‹å¦‚ A ä»»åŠ¡ 1s åæ‰§è¡Œï¼ŒB ä»»åŠ¡ 6 å°æ—¶ä¹‹åæ‰§è¡Œï¼Œä¹Ÿä¼šé€ æˆç©ºæ¨è¿›çš„é—®é¢˜ã€‚</p><p><strong>Kafkaè§£å†³æ–¹æ¡ˆ</strong></p><p>â€‹<strong>ä¸ºäº†è§£å†³ç©ºæ¨è¿›çš„é—®é¢˜</strong>ï¼ŒKafka å€ŸåŠ© JDK çš„ DelayQueue æ¥è´Ÿè´£æ¨è¿›æ—¶é—´è½®ã€‚DelayQueue ä¿å­˜äº†æ—¶é—´è½®ä¸­çš„æ¯ä¸ª Bucketï¼Œå¹¶ä¸”æ ¹æ® Bucket çš„åˆ°æœŸæ—¶é—´è¿›è¡Œæ’åºï¼Œæœ€è¿‘çš„åˆ°æœŸæ—¶é—´è¢«æ”¾åœ¨ DelayQueue çš„é˜Ÿå¤´ã€‚Kafka ä¸­ä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹æ¥è¯»å– DelayQueue ä¸­çš„ä»»åŠ¡åˆ—è¡¨ï¼Œ<strong>å¦‚æœæ—¶é—´æ²¡æœ‰åˆ°ï¼Œé‚£ä¹ˆ DelayQueue ä¼šä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€</strong>ï¼Œä»è€Œè§£å†³ç©ºæ¨è¿›çš„é—®é¢˜ã€‚è™½ç„¶DelayQueue æ’å…¥å’Œåˆ é™¤çš„æ€§èƒ½ä¸æ˜¯å¾ˆå¥½ï¼Œä½†è¿™å…¶å®å°±æ˜¯ä¸€ç§æƒè¡¡çš„ç­–ç•¥ï¼Œä½†æ˜¯DelayQueue åªå­˜æ”¾äº† Bucketï¼ŒBucket çš„æ•°é‡å¹¶ä¸å¤šï¼Œç›¸æ¯”ç©ºæ¨è¿›å¸¦æ¥çš„å½±å“æ˜¯åˆ©å¤§äºå¼Šçš„ã€‚</p><p>â€‹<strong>ä¸ºäº†è§£å†³ä»»åŠ¡æ—¶é—´è·¨åº¦å¾ˆå¤§çš„é—®é¢˜</strong>ï¼ŒKafka å¼•å…¥äº†å±‚çº§æ—¶é—´è½®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å½“ä»»åŠ¡çš„ deadline è¶…å‡ºå½“å‰æ‰€åœ¨å±‚çš„æ—¶é—´è½®è¡¨ç¤ºèŒƒå›´æ—¶ï¼Œå°±ä¼šå°è¯•å°†ä»»åŠ¡æ·»åŠ åˆ°ä¸Šä¸€å±‚æ—¶é—´è½®ä¸­ï¼Œè·Ÿé’Ÿè¡¨çš„æ—¶é’ˆã€åˆ†é’ˆã€ç§’é’ˆçš„è½¬åŠ¨è§„åˆ™æ˜¯åŒä¸€ä¸ªé“ç†ã€‚</p><h4 id="3ã€MpscQueue"><a href="#3ã€MpscQueue" class="headerlink" title="3ã€MpscQueue"></a>3ã€MpscQueue</h4><h4 id="4ã€selectã€pollã€epollçš„åŒºåˆ«"><a href="#4ã€selectã€pollã€epollçš„åŒºåˆ«" class="headerlink" title="4ã€selectã€pollã€epollçš„åŒºåˆ«"></a>4ã€selectã€pollã€epollçš„åŒºåˆ«</h4><p><strong>select</strong> ï¼ˆwindowsï¼‰**poll **(linux)æœ¬è´¨ä¸Šå’Œselectæ²¡æœ‰åŒºåˆ«ï¼ŒæŸ¥è¯¢æ¯ä¸ªfdå¯¹åº”çš„è®¾å¤‡çŠ¶æ€ï¼Œå¦‚æœè®¾å¤‡å°±ç»ªåˆ™åœ¨è®¾å¤‡ç­‰å¾…é˜Ÿåˆ—ä¸­åŠ å…¥ä¸€é¡¹å¹¶ç»§ç»­éå†ï¼Œå¦‚æœéå†å®Œæ‰€æœ‰fdåæ²¡æœ‰å‘ç°å°±ç»ªè®¾å¤‡ï¼Œåˆ™æŒ‚èµ·å½“å‰è¿›ç¨‹ï¼Œç›´åˆ°è®¾å¤‡å°±ç»ªæˆ–è€…ä¸»åŠ¨è¶…æ—¶ï¼Œè¢«å”¤é†’åå®ƒåˆè¦å†æ¬¡éå†fdã€‚</p><p>**epoll **æ”¯æŒæ°´å¹³è§¦å‘å’Œè¾¹ç¼˜è§¦å‘ï¼Œæœ€å¤§çš„ç‰¹ç‚¹åœ¨äºè¾¹ç¼˜è§¦å‘ï¼Œå®ƒåªå‘Šè¯‰è¿›ç¨‹å“ªäº›fdåˆšåˆšå˜ä¸ºå°±ç»ªæ€ï¼Œå¹¶ä¸”åªä¼šé€šçŸ¥ä¸€æ¬¡ã€‚è¿˜æœ‰ä¸€ä¸ªç‰¹ç‚¹æ˜¯ï¼Œepollä½¿ç”¨â€œäº‹ä»¶â€çš„å°±ç»ªé€šçŸ¥æ–¹å¼ï¼Œé€šè¿‡epoll_ctlæ³¨å†Œfdï¼Œä¸€æ—¦è¯¥fdå°±ç»ªï¼Œå†…æ ¸å°±ä¼šé‡‡ç”¨ç±»ä¼¼callbackçš„å›è°ƒæœºåˆ¶æ¥æ¿€æ´»è¯¥fdï¼Œepoll_waitä¾¿å¯ä»¥æ”¶åˆ°é€šçŸ¥ã€‚</p><p><strong>Epollç©ºè½®è¯¢æ¼æ´</strong></p><p>åœ¨ JDK ä¸­ï¼Œ Epoll çš„å®ç°æ˜¯å­˜åœ¨æ¼æ´çš„ï¼Œå³ä½¿ Selector è½®è¯¢çš„äº‹ä»¶åˆ—è¡¨ä¸ºç©ºï¼ŒNIO çº¿ç¨‹ä¸€æ ·å¯ä»¥è¢«å”¤é†’ï¼Œå¯¼è‡´ CPU 100% å ç”¨ã€‚å®é™…ä¸Š Netty å¹¶æ²¡æœ‰ä»æ ¹æºä¸Šè§£å†³è¯¥é—®é¢˜ï¼Œè€Œæ˜¯å·§å¦™åœ°è§„é¿äº†è¿™ä¸ªé—®é¢˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="variable">time</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line"><span class="keyword">if</span> (<span class="comment">/*äº‹ä»¶è½®è¯¢çš„æŒç»­æ—¶é—´å¤§äºç­‰äº timeoutMillis*/</span>) &#123;</span><br><span class="line">    selectCnt = <span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="comment">/*ä¸æ­£å¸¸çš„æ¬¡æ•° selectCnt è¾¾åˆ°é˜ˆå€¼ 512*/</span>) &#123;</span><br><span class="line">    <span class="comment">//é‡å»ºSelectå¹¶ä¸”SelectionKeyé‡æ–°æ³¨å†Œåˆ°æ–°Selectorä¸Š</span></span><br><span class="line">  selector = selectRebuildSelector(selectCnt);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>NioEventLoop çº¿ç¨‹çš„å¯é æ€§è‡³å…³é‡è¦ï¼Œä¸€æ—¦ NioEventLoop å‘ç”Ÿé˜»å¡æˆ–è€…é™·å…¥ç©ºè½®è¯¢ï¼Œå°±ä¼šå¯¼è‡´æ•´ä¸ªç³»ç»Ÿä¸å¯ç”¨ã€‚</p><h1 id="å››ã€LEETCODE"><a href="#å››ã€LEETCODE" class="headerlink" title="å››ã€LEETCODE"></a>å››ã€LEETCODE</h1><h3 id="ã€Pythonè¯­æ³•ã€‘"><a href="#ã€Pythonè¯­æ³•ã€‘" class="headerlink" title="ã€Pythonè¯­æ³•ã€‘"></a>ã€Pythonè¯­æ³•ã€‘</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">reduce(function, iterable[, initializer])</span><br><span class="line">    reduce(<span class="keyword">lambda</span> x,y:x * y,ns) <span class="comment"># æ•°ç»„ä¹‹ä¹˜ç§¯ (ns[0] * ns[1]) * ns[2]</span></span><br><span class="line">    reduce(<span class="keyword">lambda</span> x,y:x + y,ns) <span class="comment"># æ•°ç»„ä¹‹å’Œ</span></span><br><span class="line"><span class="comment"># è®°å¿†åŒ–æœç´¢</span></span><br><span class="line"><span class="meta">@functools.lru_cache(<span class="params"><span class="literal">None</span></span>)</span></span><br><span class="line">res = helper(<span class="number">0</span>,N,<span class="number">0</span>)</span><br><span class="line">helper.cache_clear()</span><br><span class="line"><span class="built_in">tuple</span>(ns) å¯ä»¥<span class="built_in">hash</span>åšå‚æ•°</span><br><span class="line"><span class="comment"># å¤§æ ¹å †</span></span><br><span class="line">q = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x:-x,ns))</span><br><span class="line">heapq.heapify(q)</span><br><span class="line">key = -heapq.heappop(q)</span><br><span class="line"><span class="comment"># è¿‡æ»¤å‡½æ•°</span></span><br><span class="line"><span class="built_in">filter</span>(function, iterable)</span><br><span class="line">    <span class="built_in">filter</span>(<span class="keyword">lambda</span> x: <span class="number">2</span> &lt; x &lt; <span class="number">10</span> <span class="keyword">and</span> x % <span class="number">2</span> == <span class="number">0</span>, <span class="built_in">range</span>(<span class="number">18</span>))</span><br><span class="line">    <span class="built_in">filter</span>(dfs, <span class="built_in">range</span>(<span class="built_in">len</span>(graph)))</span><br><span class="line"><span class="comment"># é™¤æ•°</span></span><br><span class="line">div, mod = <span class="built_in">divmod</span>(<span class="built_in">sum</span>(ns), <span class="number">4</span>)</span><br><span class="line">random.randint(i,<span class="built_in">len</span>(<span class="variable language_">self</span>.ns)-<span class="number">1</span>)</span><br><span class="line"><span class="comment">#ç¬¬ä¸€ä¸ªé™åºï¼Œç¬¬äºŒä¸ªå‡åº</span></span><br><span class="line"><span class="built_in">sorted</span>(pss,key = <span class="keyword">lambda</span> x:[x[<span class="number">0</span>],-x[<span class="number">1</span>]])</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸å¯å˜str å¸¸è§å‡½æ•°</span></span><br><span class="line">split(sep=<span class="literal">None</span>, maxsplit=-<span class="number">1</span>)  <span class="comment"># ä»¥sepæ¥åˆ†å‰²å­—ç¬¦ä¸²</span></span><br><span class="line">strip([chars])  <span class="comment"># å»é™¤é¦–æœ«ä¸¤ç«¯çš„å­—ç¬¦, é»˜è®¤æ˜¯ \r,\n,&quot; &quot;</span></span><br><span class="line">join(iterable)  <span class="comment"># å°†iterableå†…çš„å…ƒç´ æ‹¼æ¥æˆå­—ç¬¦ä¸²,å¦‚&#x27;,&#x27;.join([&#x27;leet&#x27;, &#x27;code&#x27;])=&quot;leet,code&quot;</span></span><br><span class="line">replace(old, new[, count])  <span class="comment"># å­—ç¬¦ä¸²æ›¿æ¢, old to new</span></span><br><span class="line">count(sub[, start[, end]])  <span class="comment"># ç»Ÿè®¡å­å­—ç¬¦ä¸²subçš„ä¸ªæ•°</span></span><br><span class="line">startswith(prefix[, start[, end]])  <span class="comment"># ä»¥prefixå¼€å§‹çš„å­—ç¬¦ä¸²</span></span><br><span class="line">endswith(suffix[, start[, end]])  <span class="comment"># ä»¥suffixç»“æŸçš„å­—ç¬¦ä¸²</span></span><br><span class="line">cs <span class="keyword">in</span> chrs: <span class="comment"># chrs ä¸­åŒ…å« cs </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># deque å¸¸è§å‡½æ•°</span></span><br><span class="line">queue = deque([iterable[, maxlen]])</span><br><span class="line">queue.append(val)  <span class="comment"># å¾€å³è¾¹æ·»åŠ ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">queue.appendleft(val)  <span class="comment"># å¾€å·¦è¾¹æ·»åŠ ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">queue.clear()  <span class="comment"># æ¸…ç©ºé˜Ÿåˆ—</span></span><br><span class="line">queue.count(val)  <span class="comment"># è¿”å›æŒ‡å®šå…ƒç´ çš„å‡ºç°æ¬¡æ•°</span></span><br><span class="line">queue.insert(val[, start[, stop]])  <span class="comment"># åœ¨æŒ‡å®šä½ç½®æ’å…¥å…ƒç´ </span></span><br><span class="line">queue.pop()  <span class="comment"># è·å–æœ€å³è¾¹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶åœ¨é˜Ÿåˆ—ä¸­åˆ é™¤</span></span><br><span class="line">queue.popleft()  <span class="comment"># è·å–æœ€å·¦è¾¹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶åœ¨é˜Ÿåˆ—ä¸­åˆ é™¤</span></span><br><span class="line">queue.reverse()  <span class="comment"># é˜Ÿåˆ—åè½¬</span></span><br><span class="line">queue.remove(val)  <span class="comment"># åˆ é™¤æŒ‡å®šå…ƒç´ </span></span><br><span class="line">queue.rotate(n=<span class="number">1</span>)  <span class="comment"># æŠŠå³è¾¹å…ƒç´ æ”¾åˆ°å·¦è¾¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># list å¸¸è§å‡½æ•°</span></span><br><span class="line">lst.sort(*, key=<span class="literal">None</span>, reverse=<span class="literal">False</span>)</span><br><span class="line">lst.append(val)  <span class="comment"># ä¹Ÿå¯ä»¥ lst = lst + [val]</span></span><br><span class="line">lst.clear()  <span class="comment"># æ¸…ç©ºåˆ—è¡¨</span></span><br><span class="line">lst.count(val)  <span class="comment"># valä¸ªæ•°</span></span><br><span class="line">lst.pop(val=lst[-<span class="number">1</span>])  <span class="comment"># (é»˜è®¤)ä»æœ«ç«¯ç§»é™¤ä¸€ä¸ªå€¼</span></span><br><span class="line">lst.remove(val)  <span class="comment"># ç§»é™¤ val</span></span><br><span class="line">lst.reverse()  <span class="comment"># åè½¬</span></span><br><span class="line">lst.insert(i, val)  <span class="comment"># åœ¨ i å¤„æ’å…¥ val</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å­—å…¸dict å¸¸è§å‡½æ•°</span></span><br><span class="line">d = defaultdict(<span class="keyword">lambda</span> : value) <span class="comment"># å–åˆ°ä¸å­˜åœ¨çš„å€¼æ—¶ä¸ä¼šæŠ¥é”™ï¼Œç”¨&#123;&#125;æ—¶ã€éœ€è¦è®¾ç½®getçš„defaultå€¼</span></span><br><span class="line">pop(key[, default])  <span class="comment"># é€šè¿‡é”®å»åˆ é™¤é”®å€¼å¯¹(è‹¥æ²¡æœ‰è¯¥é”®åˆ™è¿”å›default(æ²¡æœ‰è®¾ç½®defaultåˆ™æŠ¥é”™))</span></span><br><span class="line">setdefault(key[, default])  <span class="comment"># è®¾ç½®é»˜è®¤å€¼</span></span><br><span class="line">update([other])  <span class="comment"># æ‰¹é‡æ·»åŠ </span></span><br><span class="line">get(key[, default])  <span class="comment"># é€šè¿‡é”®è·å–å€¼(è‹¥æ²¡æœ‰è¯¥é”®å¯è®¾ç½®é»˜è®¤å€¼, é¢„é˜²æŠ¥é”™)</span></span><br><span class="line">clear()  <span class="comment"># æ¸…ç©ºå­—å…¸</span></span><br><span class="line">keys()  <span class="comment"># å°†å­—å…¸çš„é”®ç»„æˆæ–°çš„å¯è¿­ä»£å¯¹è±¡</span></span><br><span class="line">values()  <span class="comment"># å°†å­—å…¸ä¸­çš„å€¼ç»„æˆæ–°çš„å¯è¿­ä»£å¯¹è±¡</span></span><br><span class="line">items()  <span class="comment"># å°†å­—å…¸çš„é”®å€¼å¯¹å‡‘æˆä¸€ä¸ªä¸ªå…ƒç»„, ç»„æˆæ–°çš„å¯è¿­ä»£å¯¹è±¡</span></span><br><span class="line">dict1 = dict2 <span class="comment">#ä¸¤ä¸ªå­—å…¸å®Œå…¨ç›¸ç­‰ï¼Œæ»‘çª—æ—¶å¯ç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é›†åˆset å¸¸è§å‡½æ•°</span></span><br><span class="line">s = <span class="built_in">set</span>(<span class="keyword">lambda</span> : value)</span><br><span class="line">add(elem)  <span class="comment"># å‘é›†åˆä¸­æ·»åŠ æ•°æ®</span></span><br><span class="line">update(*others)  <span class="comment"># è¿­ä»£ç€å¢åŠ </span></span><br><span class="line">clear()  <span class="comment"># æ¸…ç©ºé›†åˆ</span></span><br><span class="line">discard(elem)  <span class="comment"># åˆ é™¤é›†åˆä¸­æŒ‡å®šçš„å€¼(ä¸å­˜åœ¨åˆ™ä¸åˆ é™¤)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å †heapq å¸¸è§å‡½æ•°</span></span><br><span class="line">heap = []  <span class="comment"># å»ºå †</span></span><br><span class="line">heapq.heappush(heap,item)  <span class="comment"># å¾€å †ä¸­æ’å…¥æ–°å€¼</span></span><br><span class="line">heapq.heappop(heap)  <span class="comment"># å¼¹å‡ºæœ€å°çš„å€¼</span></span><br><span class="line">heap[<span class="number">0</span>]  <span class="comment"># æŸ¥çœ‹å †ä¸­æœ€å°çš„å€¼, ä¸å¼¹å‡º</span></span><br><span class="line">heapq.heapify(x)  <span class="comment"># ä»¥çº¿æ€§æ—¶é—´å°†ä¸€ä¸ªåˆ—è¡¨è½¬ä¸ºå †</span></span><br><span class="line">heapq.heappoppush(heap, item)  <span class="comment"># å¼¹å‡ºæœ€å°çš„å€¼.å¹¶ä¸”å°†æ–°çš„å€¼æ’å…¥å…¶ä¸­.</span></span><br><span class="line">heapq.merge(*iterables, key=<span class="literal">None</span>, reverse=<span class="literal">False</span>)  <span class="comment"># å°†å¤šä¸ªå †è¿›è¡Œåˆå¹¶</span></span><br><span class="line">heapq.nlargest(n, iterable, key=<span class="literal">None</span>)  <span class="comment"># ä»å †ä¸­æ‰¾å‡ºæœ€å¤§çš„ n ä¸ªæ•°ï¼Œkeyçš„ä½œç”¨å’Œsorted( )æ–¹æ³•é‡Œé¢çš„keyç±»ä¼¼, ç”¨åˆ—è¡¨å…ƒç´ çš„æŸä¸ªå±æ€§å’Œå‡½æ•°ä½œä¸ºå…³é”®å­—</span></span><br><span class="line">heapq.nsmallest(n, iterable, key=<span class="literal">None</span>)  <span class="comment"># ä»å †ä¸­æ‰¾å‡ºæœ€å°çš„ n ä¸ªæ•°, ä¸ nlargest ç›¸å</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># äºŒåˆ†æŸ¥æ‰¾å‡½æ•°</span></span><br><span class="line">bisect.bisect_left(ps, T, L=<span class="number">0</span>, R=<span class="built_in">len</span>(ns))  <span class="comment">#äºŒåˆ†å·¦è¾¹ç•Œ</span></span><br><span class="line">bisect.bisect_right(ps, T, L=<span class="number">0</span>, R=<span class="built_in">len</span>(ns)) <span class="comment">#äºŒåˆ†å³è¾¹ç•Œ </span></span><br><span class="line">bisect.insort_left(a, x, lo=<span class="number">0</span>, hi=<span class="built_in">len</span>(a))  <span class="comment"># äºŒåˆ†æ’å…¥åˆ°å·¦ä¾§</span></span><br><span class="line">bisect.insort_right(a, x, lo=<span class="number">0</span>, hi=<span class="built_in">len</span>(a)) <span class="comment"># äºŒåˆ†æ’å…¥åˆ°å³ä¾§</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># bitæ“ä½œ</span></span><br><span class="line">&amp; ç¬¦å·ï¼Œx &amp; y ï¼Œä¼šå°†ä¸¤ä¸ªåè¿›åˆ¶æ•°åœ¨äºŒè¿›åˆ¶ä¸‹è¿›è¡Œä¸è¿ç®—</span><br><span class="line">| ç¬¦å·ï¼Œx | y ï¼Œä¼šå°†ä¸¤ä¸ªåè¿›åˆ¶æ•°åœ¨äºŒè¿›åˆ¶ä¸‹è¿›è¡Œæˆ–è¿ç®—</span><br><span class="line">^ ç¬¦å·ï¼Œx ^ y ï¼Œä¼šå°†ä¸¤ä¸ªåè¿›åˆ¶æ•°åœ¨äºŒè¿›åˆ¶ä¸‹è¿›è¡Œå¼‚æˆ–è¿ç®—</span><br><span class="line">&lt;&lt; ç¬¦å·ï¼Œx &lt;&lt; y å·¦ç§»æ“ä½œï¼Œæœ€å³è¾¹ç”¨ <span class="number">0</span> å¡«å……</span><br><span class="line">&gt;&gt; ç¬¦å·ï¼Œx &gt;&gt; y å³ç§»æ“ä½œï¼Œæœ€å·¦è¾¹ç”¨ <span class="number">0</span> å¡«å……</span><br><span class="line">~ ç¬¦å·ï¼Œ~x ï¼ŒæŒ‰ä½å–åæ“ä½œï¼Œå°† x åœ¨äºŒè¿›åˆ¶ä¸‹çš„æ¯ä¸€ä½å–å</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•´æ•°é›†åˆsetä½è¿ç®—</span></span><br><span class="line"><span class="comment"># æ•´æ•°é›†åˆåšæ ‡å¿—æ—¶ï¼Œå¯ä»¥åšå‚æ•°åŠ é€Ÿè¿ç®—</span></span><br><span class="line">vstd è®¿é—® i ï¼švstd | (<span class="number">1</span> &lt;&lt; i)</span><br><span class="line">vstd ç¦»å¼€ i ï¼švstd &amp; ~(<span class="number">1</span> &lt;&lt; i)</span><br><span class="line">vstd ä¸åŒ…å« i : <span class="keyword">not</span> vstd &amp; (<span class="number">1</span> &lt;&lt; i)</span><br><span class="line"></span><br><span class="line">å¹¶é›† ï¼šA | B</span><br><span class="line">äº¤é›† ï¼šA &amp; B</span><br><span class="line">å…¨é›† ï¼š(<span class="number">1</span> &lt;&lt; n) - <span class="number">1</span></span><br><span class="line">è¡¥é›† ï¼š((<span class="number">1</span> &lt;&lt; n) - <span class="number">1</span>) ^ A</span><br><span class="line">å­é›† ï¼š(A &amp; B) == B</span><br><span class="line">åˆ¤æ–­æ˜¯å¦æ˜¯ <span class="number">2</span> çš„å¹‚ ï¼šA &amp; (A - <span class="number">1</span>) == <span class="number">0</span></span><br><span class="line">æœ€ä½ä½çš„ <span class="number">1</span> å˜ä¸º <span class="number">0</span> ï¼šn &amp;= (n - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">while</span> n:</span><br><span class="line">            n &amp;= n - <span class="number">1</span></span><br><span class="line">            ret += <span class="number">1</span></span><br><span class="line">æœ€ä½ä½çš„ <span class="number">1</span>ï¼šA &amp; (-A)ï¼Œæœ€ä½ä½çš„ <span class="number">1</span> ä¸€èˆ¬è®°ä¸º lowbit(A)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ^     ï¼šåŒ¹é…å­—ç¬¦ä¸²å¼€å¤´</span></span><br><span class="line"><span class="comment"># [\+\-]ï¼šä»£è¡¨ä¸€ä¸ª+å­—ç¬¦æˆ–-å­—ç¬¦</span></span><br><span class="line"><span class="comment"># ?     ï¼šå‰é¢ä¸€ä¸ªå­—ç¬¦å¯æœ‰å¯æ— </span></span><br><span class="line"><span class="comment"># \d    ï¼šä¸€ä¸ªæ•°å­—</span></span><br><span class="line"><span class="comment"># +     ï¼šå‰é¢ä¸€ä¸ªå­—ç¬¦çš„ä¸€ä¸ªæˆ–å¤šä¸ª</span></span><br><span class="line"><span class="comment"># \D    ï¼šä¸€ä¸ªéæ•°å­—å­—ç¬¦</span></span><br><span class="line"><span class="comment"># *     ï¼šå‰é¢ä¸€ä¸ªå­—ç¬¦çš„0ä¸ªæˆ–å¤šä¸ª</span></span><br><span class="line">matches = re.<span class="keyword">match</span>(<span class="string">&#x27;[ ]*([+-]?\d+)&#x27;</span>, s)</span><br></pre></td></tr></table></figure><h3 id="ã€èƒŒåŒ…æ¨¡æ¿ã€‘"><a href="#ã€èƒŒåŒ…æ¨¡æ¿ã€‘" class="headerlink" title="ã€èƒŒåŒ…æ¨¡æ¿ã€‘"></a>ã€èƒŒåŒ…æ¨¡æ¿ã€‘</h3><p><strong>ã€ŒåŠ›æ‰£ã€ä¸Šçš„ 0-1 èƒŒåŒ…é—®é¢˜ï¼š</strong></p><ul><li><p>ç»„åˆé—®é¢˜æ¨¡æ¿</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#0-1èƒŒåŒ…ï¼Œä¸å¯é‡å¤</span></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> ns: </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(T, n-<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        dp[i] = <span class="built_in">max</span>(dp[i], dp[i - n] + ws[i])</span><br><span class="line"><span class="comment">#å®Œå…¨èƒŒåŒ…ï¼Œå¯é‡å¤ï¼Œæ— åºï¼Œç®—é‡é‡</span></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> ns: </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n, T+<span class="number">1</span>):</span><br><span class="line">        dp[i] = <span class="built_in">max</span>(dp[i], dp[i - n] + ws[i]) </span><br><span class="line"><span class="comment">#å®Œå…¨èƒŒåŒ…ï¼Œå¯é‡å¤ï¼Œæœ‰åºï¼Œç®—æ¬¡æ•°     </span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, T+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> ns:</span><br><span class="line">dp[i] += dp[i-n]</span><br></pre></td></tr></table></figure><p><strong>âœ…377</strong> ç»„åˆæ€»å’Œ â…£<br>âœ…<strong>494</strong> ç›®æ ‡å’Œ<br>âœ…<strong>518</strong> é›¶é’±å…‘æ¢ II</p></li><li><p>Trueã€Falseé—®é¢˜</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dp[i] |= dp[i-num]</span><br></pre></td></tr></table></figure><p><strong>âœ…139</strong> å•è¯æ‹†åˆ†<br><strong>âœ…416</strong> åˆ†å‰²ç­‰å’Œå­é›†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç‰¹æ®Šçš„å¯ä»¥ä½¿ç”¨bitæ•°ç»„</span></span><br></pre></td></tr></table></figure></li><li><p>æœ€å¤§æœ€å°é—®é¢˜ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dp[i] = <span class="built_in">min</span>(dp[i], dp[i-num]+<span class="number">1</span>)</span><br><span class="line">dp[i] = <span class="built_in">max</span>(dp[i], dp[i-num]+<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>âœ…<strong>474</strong> ä¸€å’Œé›¶<br>âœ…<strong>322</strong> é›¶é’±å…‘æ¢</p></li></ul><p>ã€ŒåŠ›æ‰£ã€ç¬¬ <strong>879</strong> é¢˜ï¼šç›ˆåˆ©è®¡åˆ’ï¼ˆå›°éš¾ï¼‰ï¼›<br>ã€ŒåŠ›æ‰£ã€ç¬¬ <strong>1449</strong> é¢˜ï¼šæ•°ä½æˆæœ¬å’Œä¸ºç›®æ ‡å€¼çš„æœ€å¤§æ•°å­—ï¼ˆå›°éš¾ï¼‰ã€‚</p><h3 id="ã€å›æº¯æ¨¡æ¿ã€‘"><a href="#ã€å›æº¯æ¨¡æ¿ã€‘" class="headerlink" title="ã€å›æº¯æ¨¡æ¿ã€‘"></a>ã€å›æº¯æ¨¡æ¿ã€‘</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å›æº¯ç®—æ³•ï¼Œå¤æ‚åº¦è¾ƒé«˜2^næˆ–è€…Nï¼ï¼Œå› ä¸ºå›æº¯ç®—æ³•å°±æ˜¯æš´åŠ›ç©·ä¸¾ï¼Œå¯ç”¨lruå‰ªæ</span></span><br><span class="line"><span class="meta">@functools.lru_cache(<span class="params"><span class="literal">None</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">backtrack</span>(<span class="params">è·¯å¾„, é€‰æ‹©åˆ—è¡¨</span>):</span><br><span class="line">    <span class="keyword">if</span> æ»¡è¶³ç»“æŸæ¡ä»¶:</span><br><span class="line">        ç»“æœ.append(è·¯å¾„)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">for</span> é€‰æ‹© <span class="keyword">in</span> é€‰æ‹©åˆ—è¡¨:    <span class="comment"># æ ¸å¿ƒä»£ç æ®µ</span></span><br><span class="line">      <span class="keyword">if</span> vst[i]:   <span class="comment"># è¾…åŠ©æ•°ç»„ï¼Œå‡æ</span></span><br><span class="line">          <span class="keyword">continue</span></span><br><span class="line">        åšå‡ºé€‰æ‹©</span><br><span class="line">        é€’å½’æ‰§è¡Œbacktrack</span><br><span class="line">        æ’¤é”€é€‰æ‹©</span><br></pre></td></tr></table></figure><p>ã€Œ<strong>å‰ªæ</strong>ã€ç¬¬ <strong>46</strong> é¢˜ å…¨æ’åˆ— ç¬¬ <strong>47</strong> é¢˜ å…¨æ’åˆ—â‘¡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‰ªæ</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">backtrack</span>(<span class="params">temp_list, length</span>):</span><br><span class="line">    <span class="keyword">if</span> length == n:</span><br><span class="line">      res.append(temp_list)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">not</span> visited[i]:</span><br><span class="line">          visited[i] = <span class="number">1</span></span><br><span class="line">          backtrack(temp_list + [nums[i]], length + <span class="number">1</span>)</span><br><span class="line">          visited[i] = <span class="number">0</span></span><br></pre></td></tr></table></figure><p>ã€Œ<strong>ç´¢å¼•éå†</strong>ã€ç¬¬ <strong>78</strong> é¢˜ å­é›† | ç¬¬ <strong>47</strong> é¢˜ å­é›†â‘¡ | ç¬¬ <strong>131</strong> é¢˜ åˆ†å‰²å­—ç¬¦ä¸²</p><pre><code>  ç¬¬ **39 **é¢˜ ç»„åˆ | ç¬¬ **40** é¢˜ ç»„åˆâ‘¡  | ç¬¬ **216** é¢˜ ç»„åˆâ‘¢</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç´¢å¼•éå†</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">helper1</span>(<span class="params">idx, n, temp_list</span>):</span><br><span class="line">  <span class="keyword">if</span> temp_list <span class="keyword">not</span> <span class="keyword">in</span> res:</span><br><span class="line">    res.append(temp_list)</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(idx, n):</span><br><span class="line">    helper1(i + <span class="number">1</span>, n, temp_list + [nums[i]])</span><br></pre></td></tr></table></figure><p>ã€Œ <strong>èµ„æºæ¶ˆè€—</strong>ã€ç¬¬ <strong>22</strong> é¢˜ å¤¸å·ç”Ÿæˆ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># èµ„æºæ¶ˆè€—</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">backtrack</span>(<span class="params">S, L, R</span>):</span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> L <span class="keyword">and</span> <span class="keyword">not</span> R:</span><br><span class="line">    ans.append(<span class="string">&#x27;&#x27;</span>.join(S))</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">if</span> L :     backtrack(S + [<span class="string">&#x27;(&#x27;</span>], L-<span class="number">1</span>, R)</span><br><span class="line">  <span class="keyword">if</span> R &gt; L : backtrack(S + [<span class="string">&#x27;)&#x27;</span>], L, R-<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>ã€Œ<strong>èµ„æºæ¶ˆè€—</strong>ã€ç¬¬ <strong>93</strong> é¢˜ å¤åŸIP</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">èµ„æºæ¶ˆè€—</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">backtrack</span>(<span class="params">i, tmp, flag</span>):</span><br><span class="line">  <span class="keyword">if</span> i == n <span class="keyword">and</span> flag == <span class="number">0</span>:</span><br><span class="line">    res.append(tmp[:-<span class="number">1</span>])</span><br><span class="line">  <span class="keyword">elif</span> i&lt;n <span class="keyword">and</span> s[i] == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">    backtrack(i + <span class="number">1</span>, tmp + s[i] + <span class="string">&quot;.&quot;</span>, flag - <span class="number">1</span>)</span><br><span class="line">  <span class="keyword">elif</span> flag :</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i, <span class="built_in">min</span>(n,i + <span class="number">3</span>)):</span><br><span class="line">      <span class="keyword">if</span> <span class="number">0</span> &lt; <span class="built_in">int</span>(s[i:j + <span class="number">1</span>]) &lt;= <span class="number">255</span>:</span><br><span class="line">        backtrack(j + <span class="number">1</span>, tmp + s[i:j + <span class="number">1</span>] + <span class="string">&quot;.&quot;</span>, flag - <span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>ã€Œ<strong>èµ„æºæ¶ˆè€—</strong>ã€ç¬¬ <strong>17</strong> é¢˜ ç”µè¯å·ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># èµ„æºæ¶ˆè€—</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dfs</span>(<span class="params">path, remains</span>):</span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> remains:</span><br><span class="line">    res.append(path[:])</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(remains)):</span><br><span class="line">    dfs(path + [remains[i]], remains[:i] + remains[i+<span class="number">1</span>:])</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¥—æ¨¡æ¿</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dfs</span>(<span class="params">pth,idx</span>):</span><br><span class="line">    <span class="keyword">if</span> idx == <span class="built_in">len</span>(ds):</span><br><span class="line">        res.append(pth)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> dic[ds[idx]]:</span><br><span class="line">        dfs(pth + c, idx + <span class="number">1</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ã€Œ<strong>å¤šé‡é™åˆ¶</strong>ã€ç¬¬ <strong>37</strong> é¢˜ è§£æ•°ç‹¬  | ç¬¬ <strong>51</strong> é¢˜ Nçš‡å</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¤šé‡é™åˆ¶</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">backtrack</span>(<span class="params">pos</span>):</span><br><span class="line">  <span class="keyword">if</span> pos == n:</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">  i, j = empty[pos]</span><br><span class="line">  <span class="keyword">for</span> num <span class="keyword">in</span> row[i] &amp; col[j] &amp; block[bidx(i, j)]:</span><br><span class="line">    row[i].remove(num)</span><br><span class="line">    col[j].remove(num)</span><br><span class="line">    block[bidx(i, j)].remove(num)</span><br><span class="line">    board[i][j] = <span class="built_in">str</span>(num)</span><br><span class="line">    <span class="keyword">if</span> backtrack(pos + <span class="number">1</span>): <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    row[i].add(num)</span><br><span class="line">    col[j].add(num)</span><br><span class="line">    block[bidx(i, j)].add(num)</span><br></pre></td></tr></table></figure><p>ã€Œ<strong>é€’å½’</strong>ã€ç¬¬ <strong>10</strong> é¢˜ æ­£åˆ™åŒ¹é…</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€’å½’</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">isMatch</span>(<span class="params">self, s: <span class="built_in">str</span>, p: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> p: </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">not</span> s</span><br><span class="line">  f = <span class="built_in">bool</span>(s <span class="keyword">and</span> p[<span class="number">0</span>] <span class="keyword">in</span> &#123;s[<span class="number">0</span>],<span class="string">&#x27;.&#x27;</span>&#125;)</span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">len</span>(p) &gt;= <span class="number">2</span> <span class="keyword">and</span> p[<span class="number">1</span>] == <span class="string">&quot;*&quot;</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">self</span>.isMatch(s, p[<span class="number">2</span>:]) <span class="keyword">or</span> f <span class="keyword">and</span> <span class="variable language_">self</span>.isMatch(s[<span class="number">1</span>:], p)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">return</span> f <span class="keyword">and</span> <span class="variable language_">self</span>.isMatch(s[<span class="number">1</span>:], p[<span class="number">1</span>:])</span><br></pre></td></tr></table></figure><h3 id="ã€å¹¶æŸ¥é›†æ¨¡æ¿ã€‘"><a href="#ã€å¹¶æŸ¥é›†æ¨¡æ¿ã€‘" class="headerlink" title="ã€å¹¶æŸ¥é›†æ¨¡æ¿ã€‘"></a>ã€å¹¶æŸ¥é›†æ¨¡æ¿ã€‘</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è™šæ‹ŸèŠ‚ç‚¹ç”¨ä»¥è¿æ¥æŸä¸€ç‰¹å¾çš„å…¨éƒ¨èŠ‚ç‚¹ï¼Œç±»ä¼¼äºé“¾è¡¨çš„preHead</span></span><br><span class="line">dummy </span><br><span class="line">parent = &#123;&#125;</span><br><span class="line">size = collections.defaultdict(<span class="keyword">lambda</span>:<span class="number">1</span>)</span><br><span class="line">cnt = <span class="number">0</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find</span>(<span class="params">x</span>):</span><br><span class="line">    parent.setdefault(x,x)</span><br><span class="line">    <span class="keyword">while</span> x != parent[x]:</span><br><span class="line">        x = parent[x]</span><br><span class="line">        <span class="comment">#è·¯å¾„å‹ç¼© parent[x] = parent[parent[x]];</span></span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">union</span>(<span class="params">x,y</span>):</span><br><span class="line">    <span class="keyword">nonlocal</span> cnt</span><br><span class="line">    <span class="keyword">if</span> connected(x,y): <span class="keyword">return</span></span><br><span class="line">    <span class="comment"># å°çš„æ ‘æŒ‚åˆ°å¤§çš„æ ‘ä¸Šï¼Œ ä½¿æ ‘å°½é‡å¹³è¡¡</span></span><br><span class="line">    xP = find(x)</span><br><span class="line">    yP = find(y)</span><br><span class="line">    <span class="keyword">if</span> size[hP] &lt; size[yP]:</span><br><span class="line">        parent[xP] = yP</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        parent[yP] = xP</span><br><span class="line">    size[xP] += size[yP]</span><br><span class="line">    <span class="comment"># ä¼˜åŒ–ç»“æŸ</span></span><br><span class="line">    parent[find(x)] = find(y)</span><br><span class="line">    <span class="comment"># ä¸ä¼˜åŒ–</span></span><br><span class="line">    cnt -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> size[xP]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">connected</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="keyword">return</span> find(x) == find(y)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self,x</span>):</span><br><span class="line">    <span class="keyword">if</span> x <span class="keyword">not</span> <span class="keyword">in</span> parent:</span><br><span class="line">        parent[x] = <span class="literal">None</span></span><br><span class="line">        cnt += <span class="number">1</span></span><br><span class="line"><span class="comment"># æ£€æŸ¥æ˜¯å¦æœ‰ç¯</span></span><br><span class="line"><span class="keyword">for</span> a, b <span class="keyword">in</span> edges:</span><br><span class="line">    <span class="keyword">if</span> connected(a, b): </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    union(a, b)</span><br><span class="line"><span class="comment"># å°†æ¯ä¸ªé›†åˆç»„æˆä»¥å¤´ä¸ºkeyçš„å­—å…¸</span></span><br><span class="line">res = collections.defaultdict(<span class="built_in">list</span>)</span><br><span class="line"><span class="keyword">for</span> e <span class="keyword">in</span> e2n:</span><br><span class="line">    res[uf.find(e)].append(e)</span><br></pre></td></tr></table></figure><h3 id="ã€æ‹“æ‰‘æ’åºæ¨¡æ¿ã€‘"><a href="#ã€æ‹“æ‰‘æ’åºæ¨¡æ¿ã€‘" class="headerlink" title="ã€æ‹“æ‰‘æ’åºæ¨¡æ¿ã€‘"></a>ã€æ‹“æ‰‘æ’åºæ¨¡æ¿ã€‘</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ã€æ‹“æ‰‘æ’åºæ¨¡æ¿ã€‘</span></span><br><span class="line">ins = [<span class="number">0</span>] * n</span><br><span class="line">ous = collections.defaultdict(<span class="built_in">list</span>)</span><br><span class="line"><span class="keyword">for</span> cur, pre <span class="keyword">in</span> ps:</span><br><span class="line">    ins[cur] += <span class="number">1</span>  <span class="comment">#å…¥åº¦</span></span><br><span class="line">    ous[pre].append(cur)<span class="comment">#å‡ºåº¦</span></span><br><span class="line">res = <span class="built_in">list</span>(<span class="built_in">filter</span>(<span class="keyword">lambda</span> x:ins[x]==<span class="number">0</span>, <span class="built_in">range</span>(n)))</span><br><span class="line">q = collections.deque(res)</span><br><span class="line"><span class="keyword">while</span> q:</span><br><span class="line">    pre = q.popleft()</span><br><span class="line">    <span class="keyword">for</span> cur <span class="keyword">in</span> ous[pre]:   <span class="comment">#é‡Šæ”¾å‡ºåº¦é˜Ÿåˆ—</span></span><br><span class="line">        ins[cur] -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> ins[cur]: </span><br><span class="line">            q.append(cur)  <span class="comment">#å…¥åº¦ä¸º0è§£é”</span></span><br><span class="line">            res.append(cur)</span><br></pre></td></tr></table></figure><h3 id="ã€å•è°ƒæ ˆæ¨¡æ¿ã€‘"><a href="#ã€å•è°ƒæ ˆæ¨¡æ¿ã€‘" class="headerlink" title="ã€å•è°ƒæ ˆæ¨¡æ¿ã€‘"></a><strong>ã€å•è°ƒæ ˆæ¨¡æ¿ã€‘</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sä¸­ä¸€èˆ¬å­˜ç´¢å¼•</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ns):</span><br><span class="line">    <span class="keyword">while</span> stack <span class="keyword">and</span> ns[stack[-<span class="number">1</span>]] &lt;= ns[i]: <span class="comment"># å•è°ƒé€’å‡æ ˆ</span></span><br><span class="line">        stack.pop()</span><br><span class="line">    <span class="comment"># ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">    stack.append(i)</span><br></pre></td></tr></table></figure><p>ã€Œ<strong>å•è°ƒé€’å¢</strong>ã€ç¬¬ <strong>84</strong> é¢˜ æ±‚æœ€å¤§çŸ©å½¢</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¬¬ **84** é¢˜ æ±‚æœ€å¤§çŸ©å½¢</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(hs)):</span><br><span class="line">    <span class="keyword">while</span> s <span class="keyword">and</span> hs[i] &lt; hs[s[-<span class="number">1</span>]]:</span><br><span class="line">        base = s.pop()</span><br><span class="line">        <span class="keyword">if</span> s:</span><br><span class="line">            H = hs[base]</span><br><span class="line">            W = i - s[-<span class="number">1</span>] - <span class="number">1</span> <span class="comment"># å½“å‰å¼¹å‡ºçš„åšé«˜ï¼Œå½“å‰ä¸æ¬¡å°åšå®½</span></span><br><span class="line">            res = <span class="built_in">max</span>(res, H * W)</span><br><span class="line">    s.append(i)</span><br></pre></td></tr></table></figure><p>ã€Œ<strong>å•è°ƒé€’å¢,è€ƒè™‘å‰©ä½™</strong>ã€ç¬¬ <strong>316</strong> é¢˜ å»é™¤é‡å¤å­—ç¬¦</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¬¬ **316** é¢˜ å»é™¤é‡å¤å­—ç¬¦</span></span><br><span class="line"><span class="keyword">for</span> i,c <span class="keyword">in</span> <span class="built_in">enumerate</span>(ss):</span><br><span class="line">    <span class="keyword">if</span> c <span class="keyword">not</span> <span class="keyword">in</span> s:</span><br><span class="line">        <span class="keyword">while</span> s <span class="keyword">and</span> c &lt; s[-<span class="number">1</span>] <span class="keyword">and</span> s[-<span class="number">1</span>] <span class="keyword">in</span> ss[i:]:</span><br><span class="line">            s.pop()</span><br><span class="line">        s.append(c)</span><br></pre></td></tr></table></figure><p>ã€Œ<strong>å•è°ƒé€’å‡</strong>ã€ç¬¬ <strong>42</strong> é¢˜ æ¥é›¨æ°´</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¬¬ **42** é¢˜ æ¥é›¨æ°´</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(hgt)):</span><br><span class="line">    <span class="keyword">while</span> stack <span class="keyword">and</span> hgt[i] &gt; hgt[stack[-<span class="number">1</span>]]: <span class="comment">#é€’å‡æ ˆ</span></span><br><span class="line">        base = stack.pop()</span><br><span class="line">        <span class="keyword">if</span> stack:</span><br><span class="line">            LH = hgt[stack[-<span class="number">1</span>]]</span><br><span class="line">            W = i - stack[-<span class="number">1</span>] - <span class="number">1</span></span><br><span class="line">            H = <span class="built_in">min</span>(LH,hgt[i]) - hgt[base]</span><br><span class="line">            res += W * H </span><br><span class="line">    stack.append(i)</span><br></pre></td></tr></table></figure><p>ã€Œ<strong>å•è°ƒé€’å‡</strong>ã€ç¬¬ <strong>739</strong> é¢˜ æ¯æ—¥æ¸©åº¦</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¬¬ **739** é¢˜ æ¯æ—¥æ¸©åº¦</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(T)-<span class="number">1</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">while</span> s <span class="keyword">and</span> T[s[-<span class="number">1</span>]] &lt;= T[i] :   <span class="comment">#é€’å‡æ ˆ</span></span><br><span class="line">        s.pop()</span><br><span class="line">    res[i] = s[-<span class="number">1</span>] - i <span class="keyword">if</span> s <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">    s.append(i)</span><br></pre></td></tr></table></figure><h3 id="ã€äºŒåˆ†æ¨¡æ¿ã€‘"><a href="#ã€äºŒåˆ†æ¨¡æ¿ã€‘" class="headerlink" title="ã€äºŒåˆ†æ¨¡æ¿ã€‘"></a>ã€äºŒåˆ†æ¨¡æ¿ã€‘</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1355579 T=5 =&gt; 13(5)55579 è¿”å›2</span></span><br><span class="line"><span class="comment"># ps[i-1] &lt; ps[i] &lt;= ps[i+1]</span></span><br><span class="line">bisect.bisect_left(ps, T, L=<span class="number">0</span>, R=<span class="built_in">len</span>(ns))  </span><br><span class="line"><span class="comment"># 1355579 T=5 =&gt; 13555(5)79 è¿”å›5</span></span><br><span class="line"><span class="comment"># ps[i-1] &lt;= ps[i] &lt; ps[i+1]</span></span><br><span class="line">bisect.bisect_right(ps, T, L=<span class="number">0</span>, R=<span class="built_in">len</span>(ns))  </span><br><span class="line">bisect.bisect(ps, T, L=<span class="number">0</span>, R=<span class="built_in">len</span>(ns))   </span><br></pre></td></tr></table></figure><p>ã€Œ<strong>ä¸­ä½è¿”å›</strong>ã€ç¬¬ <strong>33</strong> é¢˜ æœç´¢æ—‹è½¬æ’åºæ•°ç»„ | ç¬¬<strong>374</strong>é¢˜ çŒœæ•°å­—å¤§å° | ç¬¬<strong>69</strong>é¢˜  xå¹³æ–¹æ ¹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸­ä½è¿”å›</span></span><br><span class="line"><span class="keyword">while</span> L &lt;= R:</span><br><span class="line">    M = (L + R) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> nums[M] == T:</span><br><span class="line">        <span class="keyword">return</span> M</span><br><span class="line">    <span class="keyword">elif</span> nums[M] &lt; T:</span><br><span class="line">        L = M + <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        R = M - <span class="number">1</span></span><br></pre></td></tr></table></figure><p>ã€Œ<strong>åŒºåŸŸå‹ç¼©</strong>ã€ç¬¬<strong>278</strong>é¢˜ ç¬¬ä¸€ä¸ªé”™è¯¯ç‰ˆæœ¬| ç¬¬<strong>162</strong>é¢˜ å¯»æ‰¾å³°å€¼ | ç¬¬<strong>153</strong>é¢˜ å¯»æ‰¾æ•°ç»„æœ€å°å€¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŒºåŸŸå‹ç¼©</span></span><br><span class="line"><span class="keyword">while</span> L &lt; R:</span><br><span class="line">    M = (L + R) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> need <span class="keyword">in</span> s[L:M]:</span><br><span class="line">        R = M</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        L = M + <span class="number">1</span></span><br></pre></td></tr></table></figure><h3 id="ã€åŠ¨æ€è§„åˆ’æ¨¡æ¿ã€‘"><a href="#ã€åŠ¨æ€è§„åˆ’æ¨¡æ¿ã€‘" class="headerlink" title="ã€åŠ¨æ€è§„åˆ’æ¨¡æ¿ã€‘"></a>ã€åŠ¨æ€è§„åˆ’æ¨¡æ¿ã€‘</h3><h4 id="ã€Œå•ä¸²é—®é¢˜ã€"><a href="#ã€Œå•ä¸²é—®é¢˜ã€" class="headerlink" title="ã€Œå•ä¸²é—®é¢˜ã€"></a>ã€Œ<strong>å•ä¸²é—®é¢˜</strong>ã€</h4><ul><li>70 çˆ¬æ¥¼æ¢¯é—®é¢˜</li><li>801 ä½¿åºåˆ—é€’å¢çš„æœ€å°äº¤æ¢æ¬¡æ•°</li><li>746 ä½¿ç”¨æœ€å°èŠ±è´¹çˆ¬æ¥¼æ¢¯</li><li>300 æœ€é•¿ä¸Šå‡å­åºåˆ—</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¾èµ–å‰å•ä¸ªå…ƒç´ </span></span><br><span class="line">dp[i] = dp[i-<span class="number">1</span>] + ns[i]</span><br><span class="line"><span class="comment"># ä¾èµ–å‰éƒ¨åŒºåŸŸå…ƒç´ </span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i)</span><br><span class="line">        dp[i] = <span class="built_in">min</span>(dp[i], f(dp[j])</span><br></pre></td></tr></table></figure><h4 id="ã€Œå•ä¸²åŠ çŠ¶æ€é—®é¢˜ã€"><a href="#ã€Œå•ä¸²åŠ çŠ¶æ€é—®é¢˜ã€" class="headerlink" title="ã€Œå•ä¸²åŠ çŠ¶æ€é—®é¢˜ã€"></a>ã€Œ<strong>å•ä¸²åŠ çŠ¶æ€é—®é¢˜</strong>ã€</h4><ul><li><p>887 é¸¡è›‹æ‰è½</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é¸¡è›‹æ‰è½</span></span><br><span class="line"><span class="keyword">while</span> cur[K] &lt; N:             <span class="comment"># è¿˜å‰© j ä¸ªè›‹ æµ‹ ans æ¬¡ è¦†ç›–å¤šå°‘å±‚</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, K + <span class="number">1</span>): <span class="comment"># è¦†ç›–æ€»å±‚æ•° ç¢äº† -1 æ¬¡å±‚æ•° + 1 + æ²¡ç¢ -1 æ¬¡å±‚æ•°</span></span><br><span class="line">        cur[j] = prev[j - <span class="number">1</span>] + <span class="number">1</span> + prev[j]</span><br><span class="line">    ans += <span class="number">1</span></span><br><span class="line">    prev = copy.deepcopy(cur)</span><br></pre></td></tr></table></figure></li><li><p>813 æœ€å¤§å¹³å‡å€¼åˆ†ç»„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 813 æœ€å¤§å¹³å‡å€¼åˆ†ç»„</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(K-<span class="number">1</span>):            <span class="comment">#å¾ªç¯kæ¬¡</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N):          <span class="comment">#æ¯æ¬¡å‡ä¾èµ–ä¸Šæ¬¡çš„ç»“æœ</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i+<span class="number">1</span>, N):</span><br><span class="line">            dp[i] = <span class="built_in">max</span>(dp[i], avrg(i, j) + dp[j])</span><br></pre></td></tr></table></figure></li><li><p>410 åˆ†å‰²æ•°ç»„æœ€å¤§å€¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 410 åˆ†å‰²æ•°ç»„æœ€å¤§å€¼</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,K):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N): </span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i):</span><br><span class="line">            <span class="comment"># 0~iä¸­åˆ† k æ®µæœ€å¤§ å³ä¸º</span></span><br><span class="line">            <span class="comment"># 0~jä¸­åˆ†k-1æ®µæœ€å¤§ å’Œ jåˆ°içš„å‰ç¼€å’Œçš„æœ€å¤§</span></span><br><span class="line">            dp[i][k] = <span class="built_in">min</span>(dp[i][k], <span class="built_in">max</span>(dp[j][k-<span class="number">1</span>], ps[i+<span class="number">1</span>] - ps[j+<span class="number">1</span>]))</span><br></pre></td></tr></table></figure></li></ul><h4 id="ã€Œç»å…¸åŒä¸²LCSé—®é¢˜ã€"><a href="#ã€Œç»å…¸åŒä¸²LCSé—®é¢˜ã€" class="headerlink" title="ã€Œç»å…¸åŒä¸²LCSé—®é¢˜ã€"></a>ã€Œ<strong>ç»å…¸åŒä¸²LCSé—®é¢˜</strong>ã€</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç»å…¸åŒä¸²LCSé—®é¢˜</span></span><br><span class="line">dp = [[<span class="number">0</span>] * (M+<span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(N+<span class="number">1</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(M):</span><br><span class="line">        <span class="keyword">if</span> t1[i] == t2[j] : dp[i+<span class="number">1</span>][j+<span class="number">1</span>] = dp[i][j] + <span class="number">1</span> </span><br><span class="line">        <span class="keyword">else</span> : dp[i+<span class="number">1</span>][j+<span class="number">1</span>] = <span class="built_in">max</span>(dp[i][j+<span class="number">1</span>],dp[i+<span class="number">1</span>][j])</span><br></pre></td></tr></table></figure><h4 id="ã€ŒåŒºé—´åŠ¨æ€è§„åˆ’ã€"><a href="#ã€ŒåŒºé—´åŠ¨æ€è§„åˆ’ã€" class="headerlink" title="ã€ŒåŒºé—´åŠ¨æ€è§„åˆ’ã€"></a>ã€ŒåŒºé—´åŠ¨æ€è§„åˆ’ã€</h4><ul><li>5 æœ€é•¿å›æ–‡å­ä¸²</li><li>647 æœ€å¤šå›æ–‡å­ä¸²</li><li>516 æœ€é•¿å›æ–‡å­åºåˆ—</li><li>1312 æœ€é•¿å›æ–‡æ’å…¥æ¬¡æ•°</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dp[i][j] ä»£è¡¨ä» i åˆ° j çš„æœ€é•¿å­ä¸²æ»¡è¶³æ¡ä»¶çš„æ•°é‡</span></span><br><span class="line"><span class="comment"># i-- &lt; j++  ==&gt; i åœ¨ 0~j èŒƒå›´å†… --</span></span><br><span class="line">dp = [[<span class="number">0</span>] * (N) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(N)]</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">    dp[j][j] = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(j-<span class="number">1</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> ss[i] == ss[j]:</span><br><span class="line">            dp[i][j] = dp[i+<span class="number">1</span>][j-<span class="number">1</span>] +<span class="number">2</span></span><br><span class="line">        <span class="keyword">else</span> :</span><br><span class="line">            dp[i][j] = <span class="built_in">max</span>(dp[i+<span class="number">1</span>][j],dp[i][j-<span class="number">1</span>])</span><br></pre></td></tr></table></figure><h4 id="ã€ŒåŒºé—´åˆ†æ²»åŠ¨æ€è§„åˆ’ã€"><a href="#ã€ŒåŒºé—´åˆ†æ²»åŠ¨æ€è§„åˆ’ã€" class="headerlink" title="ã€ŒåŒºé—´åˆ†æ²»åŠ¨æ€è§„åˆ’ã€"></a><strong>ã€ŒåŒºé—´åˆ†æ²»åŠ¨æ€è§„åˆ’ã€</strong></h4><p><a href="https://leetcode-cn.com/problems/predict-the-winner/">486 é¢„æµ‹èµ¢å®¶</a></p><p><a href="***https://leetcode-cn.com/problems/burst-balloons/***">312 æˆ³æ°”çƒ</a></p><p><a href="***https://leetcode-cn.com/problems/strange-printer/***">664 å¥‡æ€ªçš„æ‰“å°æœº</a></p><p><a href="***https://leetcode-cn.com/problems/remove-boxes/***">546 ç§»é™¤ç›’å­</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŒºé—´åˆ†æ²»åŠ¨æ€è§„åˆ’</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">helper</span>(<span class="params">self, ns: <span class="type">List</span>[<span class="built_in">int</span>]</span>) :</span><br><span class="line">    N = <span class="built_in">len</span>(ns)</span><br><span class="line">    dp = [[<span class="number">0</span>] * N <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(N+<span class="number">1</span>)]</span><br><span class="line">    <span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">range</span>(N): <span class="comment"># é•¿åº¦ä»å°åˆ°å¤§</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N-l): <span class="comment"># ä»¥ i ä¸º å¼€å¤´</span></span><br><span class="line">            j = i + l           <span class="comment"># ä»¥ j ä¸º ç»ˆç‚¹</span></span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(i,j): <span class="comment"># ä»¥ k ä¸ºåˆ†å‰²ç‚¹ï¼Œè¿›è¡Œåˆ†æ²»         </span></span><br><span class="line">                // Todo ä¸šåŠ¡é€»è¾‘ </span><br></pre></td></tr></table></figure><p>ã€Œ<strong>å¡ç‰¹å…°æ•°</strong>ã€</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¡ç‰¹å…°æ•°</span></span><br><span class="line">g(n) = g(<span class="number">0</span>)*g(n-<span class="number">1</span>) + g(<span class="number">1</span>)*g(n-<span class="number">2</span>) ...g(n-<span class="number">1</span>)*g(<span class="number">0</span>)</span><br><span class="line">dp=[<span class="number">1</span>] + [<span class="number">0</span>] * n</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,n+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,i+<span class="number">1</span>):</span><br><span class="line">        dp[i] += dp[j-<span class="number">1</span>] * dp[i-j]</span><br></pre></td></tr></table></figure><h3 id="ã€æ»‘åŠ¨çª—å£ã€‘"><a href="#ã€æ»‘åŠ¨çª—å£ã€‘" class="headerlink" title="ã€æ»‘åŠ¨çª—å£ã€‘"></a>ã€æ»‘åŠ¨çª—å£ã€‘</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;ç»™å®šå¾…æŸ¥ä¸²så’Œç›®æ ‡ä¸²t&quot;&quot;&quot;</span></span><br><span class="line">nd, wd = &#123;&#125;, &#123;&#125;</span><br><span class="line">nd = collections.Counter(s1)</span><br><span class="line">L, R = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">cnt = <span class="number">0</span> <span class="comment"># æ»¡è¶³æ¡ä»¶ä¸ªæ•°</span></span><br><span class="line"><span class="keyword">while</span> R &lt; <span class="built_in">len</span>(s):        <span class="comment"># çª—å£å³è¾¹ç•Œä¸æ–­æ‰©å¤§ï¼Œæœ¬è´¨æ˜¯æœç´¢é—®é¢˜çš„å¯èƒ½è§£</span></span><br><span class="line">    c = s[R]      <span class="comment"># å³å°†åŠ å…¥åˆ°çª—å£ä¸­çš„å­—ç¬¦</span></span><br><span class="line">    R += <span class="number">1</span></span><br><span class="line">    æ›´æ–°çª—å£ä¸­çš„æ•°æ®</span><br><span class="line">    <span class="keyword">while</span> æ»¡è¶³çª—å£æ”¶ç¼©æ¡ä»¶ï¼š  <span class="comment"># çª—å£çš„å·¦è¾¹ç•Œæ”¶ç¼©ï¼Œæœ¬è´¨æ˜¯ä¼˜åŒ–å¯è¡Œè§£</span></span><br><span class="line">        è®°å½•æˆ–è¿”å›ç»“æœ</span><br><span class="line">        d = s[L]   <span class="comment"># å³å°†ä»çª—å£ä¸­åˆ é™¤çš„å­—ç¬¦</span></span><br><span class="line">        L += <span class="number">1</span></span><br><span class="line">        æ›´æ–°çª—å£ä¸­çš„æ•°æ®</span><br><span class="line"><span class="keyword">return</span> ç»“æœ</span><br><span class="line"></span><br><span class="line"><span class="comment"># å›ºå®šçª—å£ ,æ¯”æ»‘åŠ¨çª—å£æ›´å¿«ä¸€äº›</span></span><br><span class="line">i = j = cnt = <span class="number">0</span>      </span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(A)):</span><br><span class="line">    <span class="keyword">if</span> A[j] == <span class="number">0</span>: </span><br><span class="line">        cnt += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> cnt &gt; K: <span class="comment">#ä¸æ»¡è¶³æ—¶ å¹³ç§»</span></span><br><span class="line">        <span class="keyword">if</span> A[i] == <span class="number">0</span>:</span><br><span class="line">            cnt -= <span class="number">1</span></span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"><span class="keyword">return</span> j - i + <span class="number">1</span>        </span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(A)):</span><br><span class="line">    <span class="keyword">if</span> A[j] == <span class="number">0</span>:</span><br><span class="line">        cnt += <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> cnt &gt; K:</span><br><span class="line">        <span class="keyword">if</span> A[i] == <span class="number">0</span>:</span><br><span class="line">            cnt -= <span class="number">1</span></span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">    res = <span class="built_in">max</span>(res, j - i + <span class="number">1</span>)</span><br><span class="line"><span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ã€å‰ç¼€å’Œã€‘"><a href="#ã€å‰ç¼€å’Œã€‘" class="headerlink" title="ã€å‰ç¼€å’Œã€‘"></a>ã€å‰ç¼€å’Œã€‘</h3><p>ã€Œ<strong>ç´¯åŠ å’Œå­˜ä½ç½®</strong>ã€</p><p>1371 æœ€é•¿å¶æ•°å…ƒéŸ³å­æ•°ç»„</p><p>525 æœ€é•¿ç›¸ç­‰01å­æ•°ç»„</p><p>325 æœ€é•¿å’Œä¸ºk å­æ•°ç»„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‰ç¼€å’Œåˆå§‹åŒ–</span></span><br><span class="line">psd = &#123;<span class="number">0</span>: -<span class="number">1</span>&#125;  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)):</span><br><span class="line">    t ^= cd.get(s[i], <span class="number">0</span>) <span class="comment"># ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">    <span class="keyword">if</span> t <span class="keyword">not</span> <span class="keyword">in</span> psd:</span><br><span class="line">        psd[t] = i       <span class="comment"># ç¬¬ä¸€æ¬¡å­˜å…¥æ•°ç»„</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        ans = <span class="built_in">max</span>(ans, i - psd[t]) <span class="comment">#å·²å­˜å…¥åˆ™å¼€å§‹è®¡ç®—</span></span><br></pre></td></tr></table></figure><p>ã€Œ<strong>ç´¯åŠ å’Œå­˜æ•°é‡</strong>ã€</p><p>560 å’Œä¸ºKçš„å­æ•°ç»„æ•°é‡</p><p> ç»Ÿè®¡ä¼˜ç¾å­æ•°ç»„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç´¯åŠ å’Œå­˜æ•°é‡</span></span><br><span class="line">psd = &#123;<span class="number">0</span>:<span class="number">1</span>&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ns)):</span><br><span class="line">    s += ns[i]</span><br><span class="line">    <span class="keyword">if</span> s - T <span class="keyword">in</span> psd:</span><br><span class="line">        ans += psd[s - T] <span class="comment"># å­˜æ•°é‡</span></span><br><span class="line">    psd[s] = psd.get(s,<span class="number">0</span>) + <span class="number">1</span></span><br></pre></td></tr></table></figure><p>ã€Œ<strong>æ¨¡KçŠ¶æ€å‰ç¼€å’Œ</strong>ã€</p><p>523 è¿ç»­å’Œä¸º k å€ çš„å­æ•°ç»„ï¼ˆå­˜ç´¢å¼•ï¼‰</p><p>974 å’Œè¢«k æ•´é™¤ å­æ•°ç»„æ•°é‡ï¼ˆå­˜æ•°é‡ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¨¡KçŠ¶æ€å‰ç¼€å’Œ</span></span><br><span class="line">psd = &#123;<span class="number">0</span>:-<span class="number">1</span>&#125;</span><br><span class="line">ans = s = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ns)):</span><br><span class="line">    s += ns[i]<span class="comment"># ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">    <span class="keyword">if</span> T != <span class="number">0</span>: s %= <span class="built_in">abs</span>(T)<span class="comment"># æ¨¡kçŠ¶æ€åškeyï¼Œç´¢å¼•åšå€¼</span></span><br><span class="line">    <span class="keyword">if</span> s <span class="keyword">not</span> <span class="keyword">in</span> psd:</span><br><span class="line">        psd[s] = i</span><br><span class="line">    <span class="keyword">elif</span> i - psd[s] &gt; <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><p><strong>ã€ŒçŸ©é˜µå‰ç¼€å’Œã€</strong></p><ul><li>363 ä¸è¶…è¿‡Kçš„æœ€å¤§æ•°å€¼å’Œ</li><li>1074 å’Œä¸ºç›®æ ‡å€¼çš„å­çŸ©é˜µæ•°é‡</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># çŸ©é˜µå‰ç¼€å’Œ</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m):        <span class="comment">#å›ºå®šå·¦è¾¹ç•Œ</span></span><br><span class="line">    ps = [<span class="number">0</span>] * n</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i, m): <span class="comment">#å›ºå®šå³è¾¹ç•Œ</span></span><br><span class="line">    psS = <span class="number">0</span></span><br><span class="line">        dct = &#123;<span class="number">0</span>:<span class="number">1</span>&#125;       <span class="comment">#åˆå§‹åªæœ‰ä¸€ç§å¯èƒ½</span></span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(n): <span class="comment"># ä»¥é«˜åšå‰ç¼€å’Œ</span></span><br><span class="line">            ps[k] += mtx[j][k]          <span class="comment"># æ¯è¡Œå‰ç¼€å’Œ</span></span><br><span class="line">            psS += ps[k]                <span class="comment"># nè¡Œå‰ç¼€å’Œ</span></span><br><span class="line">            cnt += dct.get(psS - T, <span class="number">0</span>)  <span class="comment"># æ»¡è¶³æ¡ä»¶cnt</span></span><br><span class="line">            dct[psS] = dct.get(psS,<span class="number">0</span>) + <span class="number">1</span> <span class="comment"># ä¿å­˜å½“å‰çŠ¶æ€</span></span><br><span class="line"><span class="keyword">return</span> cnt</span><br></pre></td></tr></table></figure><h3 id="ã€åŒæŒ‡é’ˆã€‘"><a href="#ã€åŒæŒ‡é’ˆã€‘" class="headerlink" title="ã€åŒæŒ‡é’ˆã€‘"></a>ã€åŒæŒ‡é’ˆã€‘</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŒæŒ‡é’ˆ</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">removeElement</span>(<span class="params">self, ns: <span class="type">List</span>[<span class="built_in">int</span>], val: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    slow = <span class="number">0</span></span><br><span class="line">    n = <span class="built_in">len</span>(ns)</span><br><span class="line">    <span class="keyword">for</span> fast <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="keyword">if</span> ns[fast] != val:</span><br><span class="line">            ns[slow] = ns[fast]</span><br><span class="line">            slow += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> slow</span><br></pre></td></tr></table></figure><h3 id="ã€æ·±åº¦ä¼˜å…ˆã€‘"><a href="#ã€æ·±åº¦ä¼˜å…ˆã€‘" class="headerlink" title="ã€æ·±åº¦ä¼˜å…ˆã€‘"></a>ã€æ·±åº¦ä¼˜å…ˆã€‘</h3><p>ã€Œ<strong>äºŒå‰æ ‘éå†æ¨¡æ¿</strong>ã€</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€’å½’</span></span><br><span class="line"><span class="comment"># æ—¶é—´å¤æ‚åº¦ï¼šO(n)ï¼Œnä¸ºèŠ‚ç‚¹æ•°ï¼Œè®¿é—®æ¯ä¸ªèŠ‚ç‚¹æ°å¥½ä¸€æ¬¡ã€‚</span></span><br><span class="line"><span class="comment"># ç©ºé—´å¤æ‚åº¦ï¼šç©ºé—´å¤æ‚åº¦ï¼šO(h)ï¼Œhä¸ºæ ‘çš„é«˜åº¦ã€‚æœ€åæƒ…å†µä¸‹éœ€è¦ç©ºé—´O(n)ï¼Œå¹³å‡æƒ…å†µä¸ºO(logn)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é€’å½’1ï¼šäºŒå‰æ ‘éå†æœ€æ˜“ç†è§£å’Œå®ç°ç‰ˆæœ¬</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">preOrd</span>(<span class="params">self, root: TreeNode</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        <span class="comment"># å‰åºé€’å½’</span></span><br><span class="line">        <span class="keyword">return</span> [root.val] + <span class="variable language_">self</span>.preOrd(root.left) + <span class="variable language_">self</span>.preOrd(root.right)</span><br><span class="line">        <span class="comment"># # ä¸­åºé€’å½’ </span></span><br><span class="line">        <span class="comment"># return self.inOrd(root.left) + [root.val] + self.inOrd(root.right)</span></span><br><span class="line">        <span class="comment"># # ååºé€’å½’</span></span><br><span class="line">        <span class="comment"># return self.postOrd(root.left) + self.postOrd(root.right) + [root.val]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é€’å½’2ï¼šé€šç”¨æ¨¡æ¿ï¼Œå¯ä»¥é€‚åº”ä¸åŒçš„é¢˜ç›®ï¼Œæ·»åŠ å‚æ•°ã€å¢åŠ è¿”å›æ¡ä»¶ã€ä¿®æ”¹è¿›å…¥é€’å½’æ¡ä»¶ã€è‡ªå®šä¹‰è¿”å›å€¼</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">preOrd</span>(<span class="params">self, root: TreeNode</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">dfs</span>(<span class="params">cur</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> cur:</span><br><span class="line">                <span class="keyword">return</span>      </span><br><span class="line">            <span class="comment"># å‰åºé€’å½’</span></span><br><span class="line">            res.append(cur.val)</span><br><span class="line">            dfs(cur.left)</span><br><span class="line">            dfs(cur.right) </span><br><span class="line">            <span class="comment"># # ä¸­åºé€’å½’</span></span><br><span class="line">            <span class="comment"># dfs(cur.left)</span></span><br><span class="line">            <span class="comment"># res.append(cur.val)</span></span><br><span class="line">            <span class="comment"># dfs(cur.right)</span></span><br><span class="line">            <span class="comment"># # ååºé€’å½’</span></span><br><span class="line">            <span class="comment"># dfs(cur.left)</span></span><br><span class="line">            <span class="comment"># dfs(cur.right)</span></span><br><span class="line">            <span class="comment"># res.append(cur.val)      </span></span><br><span class="line">        res = []</span><br><span class="line">        dfs(root)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿­ä»£</span></span><br><span class="line"><span class="comment"># æ—¶é—´å¤æ‚åº¦ï¼šO(n)ï¼Œnä¸ºèŠ‚ç‚¹æ•°ï¼Œè®¿é—®æ¯ä¸ªèŠ‚ç‚¹æ°å¥½ä¸€æ¬¡ã€‚</span></span><br><span class="line"><span class="comment"># ç©ºé—´å¤æ‚åº¦ï¼šO(h)ï¼Œhä¸ºæ ‘çš„é«˜åº¦ã€‚å–å†³äºæ ‘çš„ç»“æ„ï¼Œæœ€åæƒ…å†µå­˜å‚¨æ•´æ£µæ ‘ï¼Œå³O(n)</span></span><br><span class="line"><span class="comment"># è¿­ä»£1ï¼šå‰åºéå†æœ€å¸¸ç”¨æ¨¡æ¿ï¼ˆååºåŒæ ·å¯ä»¥ç”¨ï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">preOrd</span>(<span class="params">self, root: TreeNode</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> []        </span><br><span class="line">        res = []</span><br><span class="line">        stack = [root]</span><br><span class="line">        <span class="comment"># # å‰åºè¿­ä»£æ¨¡æ¿ï¼šæœ€å¸¸ç”¨çš„äºŒå‰æ ‘DFSè¿­ä»£éå†æ¨¡æ¿</span></span><br><span class="line">        <span class="keyword">while</span> stack:</span><br><span class="line">            cur = stack.pop()</span><br><span class="line">            res.append(cur.val)</span><br><span class="line">            <span class="keyword">if</span> cur.right:</span><br><span class="line">                stack.append(cur.right)</span><br><span class="line">            <span class="keyword">if</span> cur.left:</span><br><span class="line">                stack.append(cur.left)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># # ååºè¿­ä»£ï¼Œç›¸åŒæ¨¡æ¿ï¼šå°†å‰åºè¿­ä»£è¿›æ ˆé¡ºåºç¨ä½œä¿®æ”¹ï¼Œæœ€åå¾—åˆ°çš„ç»“æœåè½¬</span></span><br><span class="line">        <span class="comment"># while stack:</span></span><br><span class="line">        <span class="comment">#     cur = stack.pop()</span></span><br><span class="line">        <span class="comment">#     if cur.left:</span></span><br><span class="line">        <span class="comment">#         stack.append(cur.left)</span></span><br><span class="line">        <span class="comment">#     if cur.right:</span></span><br><span class="line">        <span class="comment">#         stack.append(cur.right)</span></span><br><span class="line">        <span class="comment">#     res.append(cur.val)</span></span><br><span class="line">        <span class="comment"># return res[::-1]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿­ä»£1ï¼šå±‚åºéå†æœ€å¸¸ç”¨æ¨¡æ¿</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">levelOrder</span>(<span class="params">self, root: TreeNode</span>) -&gt; <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        q = deque([root])</span><br><span class="line">        res = []</span><br><span class="line">        <span class="keyword">while</span> q :</span><br><span class="line">            l = []</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(q)) :</span><br><span class="line">                t = q.popleft()</span><br><span class="line">                l.append(t.val)</span><br><span class="line">                <span class="keyword">if</span> t.left : q.append(t.left)</span><br><span class="line">                <span class="keyword">if</span> t.right : q.append(t.right)</span><br><span class="line">            res.append(l)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"><span class="comment"># è¿­ä»£2ï¼šå‰ã€ä¸­ã€ååºéå†é€šç”¨æ¨¡æ¿ï¼ˆåªéœ€ä¸€ä¸ªæ ˆçš„ç©ºé—´ï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inOrd</span>(<span class="params">self, root: TreeNode</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]: </span><br><span class="line">        res = []</span><br><span class="line">        stack = []</span><br><span class="line">        cur = root</span><br><span class="line">        <span class="comment"># ä¸­åºï¼Œæ¨¡æ¿ï¼šå…ˆç”¨æŒ‡é’ˆæ‰¾åˆ°æ¯é¢—å­æ ‘çš„æœ€å·¦ä¸‹è§’ï¼Œç„¶åè¿›è¡Œè¿›å‡ºæ ˆæ“ä½œ</span></span><br><span class="line">        <span class="keyword">while</span> stack <span class="keyword">or</span> cur:</span><br><span class="line">            <span class="keyword">while</span> cur:</span><br><span class="line">                stack.append(cur)</span><br><span class="line">                cur = cur.left</span><br><span class="line">            cur = stack.pop()</span><br><span class="line">            res.append(cur.val)</span><br><span class="line">            cur = cur.right</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># # å‰åºï¼Œç›¸åŒæ¨¡æ¿</span></span><br><span class="line">        <span class="comment"># while stack or cur:</span></span><br><span class="line">        <span class="comment">#     while cur:</span></span><br><span class="line">        <span class="comment">#         res.append(cur.val)</span></span><br><span class="line">        <span class="comment">#         stack.append(cur)</span></span><br><span class="line">        <span class="comment">#         cur = cur.left</span></span><br><span class="line">        <span class="comment">#     cur = stack.pop()</span></span><br><span class="line">        <span class="comment">#     cur = cur.right</span></span><br><span class="line">        <span class="comment"># return res</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># # ååºï¼Œç›¸åŒæ¨¡æ¿</span></span><br><span class="line">        <span class="comment"># while stack or cur:</span></span><br><span class="line">        <span class="comment">#     while cur:</span></span><br><span class="line">        <span class="comment">#         res.append(cur.val)</span></span><br><span class="line">        <span class="comment">#         stack.append(cur)</span></span><br><span class="line">        <span class="comment">#         cur = cur.right</span></span><br><span class="line">        <span class="comment">#     cur = stack.pop()</span></span><br><span class="line">        <span class="comment">#     cur = cur.left</span></span><br><span class="line">        <span class="comment"># return res[::-1]</span></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿­ä»£3ï¼šæ ‡è®°æ³•è¿­ä»£ï¼ˆéœ€è¦åŒå€çš„ç©ºé—´æ¥å­˜å‚¨è®¿é—®çŠ¶æ€ï¼‰ï¼š</span></span><br><span class="line"><span class="comment"># å‰ã€ä¸­ã€åã€å±‚åºé€šç”¨æ¨¡æ¿ï¼Œåªéœ€æ”¹å˜è¿›æ ˆé¡ºåºæˆ–å³å¯å®ç°å‰åä¸­åºéå†ï¼Œ</span></span><br><span class="line"><span class="comment"># è€Œå±‚åºéå†åˆ™ä½¿ç”¨é˜Ÿåˆ—å…ˆè¿›å…ˆå‡ºã€‚0è¡¨ç¤ºå½“å‰æœªè®¿é—®ï¼Œ1è¡¨ç¤ºå·²è®¿é—®ã€‚</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">preOrd</span>(<span class="params">self, root: TreeNode</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">        res = []</span><br><span class="line">        stack = [(<span class="number">0</span>, root)]</span><br><span class="line">        <span class="keyword">while</span> stack:</span><br><span class="line">            flag, cur = stack.pop()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> cur: <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> flag == <span class="number">0</span>:</span><br><span class="line">                <span class="comment"># å‰åºï¼Œæ ‡è®°æ³•</span></span><br><span class="line">                stack.append((<span class="number">0</span>, cur.right))</span><br><span class="line">                stack.append((<span class="number">0</span>, cur.left))</span><br><span class="line">                stack.append((<span class="number">1</span>, cur))</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># # ååºï¼Œæ ‡è®°æ³•</span></span><br><span class="line">                <span class="comment"># stack.append((1, cur))</span></span><br><span class="line">                <span class="comment"># stack.append((0, cur.right))</span></span><br><span class="line">                <span class="comment"># stack.append((0, cur.left))</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment"># # ä¸­åºï¼Œæ ‡è®°æ³•</span></span><br><span class="line">                <span class="comment"># stack.append((0, cur.right))</span></span><br><span class="line">                <span class="comment"># stack.append((1, cur))</span></span><br><span class="line">                <span class="comment"># stack.append((0, cur.left))  </span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                res.append(cur.val)  </span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># # å±‚åºï¼Œæ ‡è®°æ³•</span></span><br><span class="line">        <span class="comment"># res = []</span></span><br><span class="line">        <span class="comment"># queue = [(0, root)]</span></span><br><span class="line">        <span class="comment"># while queue:</span></span><br><span class="line">        <span class="comment">#     flag, cur = queue.pop(0)  # æ³¨æ„æ˜¯é˜Ÿåˆ—ï¼Œå…ˆè¿›å…ˆå‡º</span></span><br><span class="line">        <span class="comment">#     if not cur: continue</span></span><br><span class="line">        <span class="comment">#     if flag == 0:</span></span><br><span class="line">                  <span class="comment"># å±‚åºéå†è¿™ä¸‰ä¸ªçš„é¡ºåºæ— æ‰€è°“ï¼Œå› ä¸ºæ˜¯é˜Ÿåˆ—ï¼Œåªå¼¹å‡ºé˜Ÿé¦–å…ƒç´ </span></span><br><span class="line">        <span class="comment">#         queue.append((1, cur))</span></span><br><span class="line">        <span class="comment">#         queue.append((0, cur.left))</span></span><br><span class="line">        <span class="comment">#         queue.append((0, cur.right))</span></span><br><span class="line">        <span class="comment">#     else:</span></span><br><span class="line">        <span class="comment">#         res.append(cur.val)</span></span><br><span class="line">        <span class="comment"># return res</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è«é‡Œæ–¯éå†</span></span><br><span class="line"><span class="comment"># æ—¶é—´å¤æ‚åº¦ï¼šO(n)ï¼Œnä¸ºèŠ‚ç‚¹æ•°ï¼Œçœ‹ä¼¼è¶…è¿‡O(n)ï¼Œæœ‰çš„èŠ‚ç‚¹å¯èƒ½è¦è®¿é—®ä¸¤æ¬¡ï¼Œå®é™…åˆ†æè¿˜æ˜¯O(n)</span></span><br><span class="line"><span class="comment"># ç©ºé—´å¤æ‚åº¦ï¼šO(1)ï¼Œå¦‚æœåœ¨éå†è¿‡ç¨‹ä¸­å°±è¾“å‡ºèŠ‚ç‚¹å€¼ï¼Œåˆ™åªéœ€å¸¸æ•°ç©ºé—´å°±èƒ½å¾—åˆ°ä¸­åºéå†ç»“æœï¼Œç©ºé—´åªéœ€ä¸¤ä¸ªæŒ‡é’ˆã€‚</span></span><br><span class="line"><span class="comment"># å¦‚æœå°†ç»“æœå‚¨å­˜æœ€åè¾“å‡ºï¼Œåˆ™ç©ºé—´å¤æ‚åº¦è¿˜æ˜¯O(n)ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># PSï¼šè«é‡Œæ–¯éå†å®é™…ä¸Šæ˜¯åœ¨åŸæœ‰äºŒå‰æ ‘çš„ç»“æ„åŸºç¡€ä¸Šï¼Œæ„é€ äº†çº¿ç´¢äºŒå‰æ ‘ï¼Œ</span></span><br><span class="line"><span class="comment"># çº¿ç´¢äºŒå‰æ ‘å®šä¹‰ä¸ºï¼šåŸæœ¬ä¸ºç©ºçš„å³å­èŠ‚ç‚¹æŒ‡å‘äº†ä¸­åºéå†é¡ºåºä¹‹åçš„é‚£ä¸ªèŠ‚ç‚¹ï¼ŒæŠŠæ‰€æœ‰åŸæœ¬ä¸ºç©ºçš„å·¦å­èŠ‚ç‚¹éƒ½æŒ‡å‘äº†ä¸­åºéå†ä¹‹å‰çš„é‚£ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤å¤„åªç»™å‡ºä¸­åºéå†ï¼Œå‰åºéå†åªéœ€ä¿®æ”¹è¾“å‡ºé¡ºåºå³å¯</span></span><br><span class="line"><span class="comment"># è€Œååºéå†ï¼Œç”±äºéå†æ˜¯ä»æ ¹å¼€å§‹çš„ï¼Œè€Œçº¿ç´¢äºŒå‰æ ‘æ˜¯å°†ä¸ºç©ºçš„å·¦å³å­èŠ‚ç‚¹è¿æ¥åˆ°ç›¸åº”çš„é¡ºåºä¸Šï¼Œä½¿å…¶èƒ½å¤ŸæŒ‰ç…§ç›¸åº”å‡†åˆ™è¾“å‡º</span></span><br><span class="line"><span class="comment"># ä½†æ˜¯ååºéå†çš„æ ¹èŠ‚ç‚¹å´å·²ç»æ²¡æœ‰é¢å¤–çš„ç©ºé—´æ¥æ ‡è®°è‡ªå·±ä¸‹ä¸€ä¸ªåº”è¯¥è®¿é—®çš„èŠ‚ç‚¹ï¼Œ</span></span><br><span class="line"><span class="comment"># æ‰€ä»¥è¿™é‡Œéœ€è¦å»ºç«‹ä¸€ä¸ªä¸´æ—¶èŠ‚ç‚¹dumpï¼Œä»¤å…¶å·¦å­©å­æ˜¯rootã€‚å¹¶ä¸”è¿˜éœ€è¦ä¸€ä¸ªå­è¿‡ç¨‹ï¼Œå°±æ˜¯å€’åºè¾“å‡ºæŸä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´è·¯å¾„ä¸Šçš„å„ä¸ªèŠ‚ç‚¹ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è«é‡Œæ–¯éå†ï¼Œå€ŸåŠ©çº¿ç´¢äºŒå‰æ ‘ä¸­åºéå†ï¼ˆé™„å‰åºéå†ï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inOrd</span>(<span class="params">self, root: TreeNode</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">        res = []</span><br><span class="line">        <span class="comment"># cur = pre = TreeNode(None)</span></span><br><span class="line">        cur = root</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> cur:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> cur.left:</span><br><span class="line">                res.append(cur.val)</span><br><span class="line">                <span class="comment"># print(cur.val)</span></span><br><span class="line">                cur = cur.right</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                pre = cur.left</span><br><span class="line">                <span class="keyword">while</span> pre.right <span class="keyword">and</span> pre.right != cur:</span><br><span class="line">                    pre = pre.right</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> pre.right:</span><br><span class="line">                    <span class="comment"># print(cur.val) è¿™é‡Œæ˜¯å‰åºéå†çš„ä»£ç ï¼Œå‰åºä¸ä¸­åºçš„å”¯ä¸€å·®åˆ«</span></span><br><span class="line">                    pre.right = cur</span><br><span class="line">                    cur = cur.left</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    pre.right = <span class="literal">None</span></span><br><span class="line">                    res.append(cur.val)</span><br><span class="line">                    <span class="comment"># print(cur.val)</span></span><br><span class="line">                    cur = cur.right</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Nå‰æ ‘éå†</span></span><br><span class="line"><span class="comment"># æ—¶é—´å¤æ‚åº¦ï¼šæ—¶é—´å¤æ‚åº¦ï¼šO(M)ï¼Œå…¶ä¸­ M æ˜¯ N å‰æ ‘ä¸­çš„èŠ‚ç‚¹ä¸ªæ•°ã€‚æ¯ä¸ªèŠ‚ç‚¹åªä¼šå…¥æ ˆå’Œå‡ºæ ˆå„ä¸€æ¬¡ã€‚</span></span><br><span class="line"><span class="comment"># ç©ºé—´å¤æ‚åº¦ï¼šO(M)ã€‚åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œè¿™æ£µ N å‰æ ‘åªæœ‰ 2 å±‚ï¼Œæ‰€æœ‰ç¬¬ 2 å±‚çš„èŠ‚ç‚¹éƒ½æ˜¯æ ¹èŠ‚ç‚¹çš„å­©å­ã€‚</span></span><br><span class="line"><span class="comment"># å°†æ ¹èŠ‚ç‚¹æ¨å‡ºæ ˆåï¼Œéœ€è¦å°†è¿™äº›èŠ‚ç‚¹éƒ½æ”¾å…¥æ ˆï¼Œå…±æœ‰ Mâˆ’1ä¸ªèŠ‚ç‚¹ï¼Œå› æ­¤æ ˆçš„å¤§å°ä¸º O(M)ã€‚</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Nå‰æ ‘ç®€æ´é€’å½’</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">preorder</span>(<span class="params">self, root: <span class="string">&#x27;Node&#x27;</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root: <span class="keyword">return</span> []</span><br><span class="line">        res = [root.val]</span><br><span class="line">        <span class="keyword">for</span> node <span class="keyword">in</span> root.children:</span><br><span class="line">            res.extend(<span class="variable language_">self</span>.preorder(node))</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="comment"># Nå‰æ ‘é€šç”¨é€’å½’æ¨¡æ¿</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">preorder</span>(<span class="params">self, root: <span class="string">&#x27;Node&#x27;</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">        res = []</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">helper</span>(<span class="params">root</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            res.append(root.val)</span><br><span class="line">            <span class="keyword">for</span> child <span class="keyword">in</span> root.children:</span><br><span class="line">                helper(child)</span><br><span class="line">        helper(root)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="comment"># Nå‰æ ‘è¿­ä»£æ–¹æ³•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">preorder</span>(<span class="params">self, root: <span class="string">&#x27;Node&#x27;</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        s = [root]</span><br><span class="line">        <span class="comment"># s.append(root)</span></span><br><span class="line">        res = []</span><br><span class="line">        <span class="keyword">while</span> s:</span><br><span class="line">            node = s.pop()</span><br><span class="line">            res.append(node.val)</span><br><span class="line">            <span class="comment"># for child in node.children[::-1]:</span></span><br><span class="line">            <span class="comment">#     s.append(child)</span></span><br><span class="line">            s.extend(node.children[::-<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><h3 id="ã€å¹¿åº¦ä¼˜å…ˆã€‘"><a href="#ã€å¹¿åº¦ä¼˜å…ˆã€‘" class="headerlink" title="ã€å¹¿åº¦ä¼˜å…ˆã€‘"></a>ã€å¹¿åº¦ä¼˜å…ˆã€‘</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ã€Œ**æ— å‘å›¾çš„éå†**ã€</span></span><br><span class="line">q = collections.deque([i])</span><br><span class="line"><span class="keyword">while</span> q:</span><br><span class="line">    cur = q.popleft()</span><br><span class="line">    <span class="keyword">for</span> nxt <span class="keyword">in</span> dt[cur]:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> vst[nxt]:</span><br><span class="line">            vstd[nxt] = <span class="literal">True</span></span><br><span class="line">            q.append(nxt)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ã€Œ**äºŒå‰æ ‘å±‚åºéå†**ã€</span></span><br><span class="line">q = deque([root])</span><br><span class="line">res = []</span><br><span class="line"><span class="keyword">while</span> q :</span><br><span class="line">    l = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(q)) :</span><br><span class="line">        t = q.popleft()</span><br><span class="line">        l.append(t.val)</span><br><span class="line">        <span class="keyword">if</span> t.left : q.append(t.left)</span><br><span class="line">        <span class="keyword">if</span> t.right : q.append(t.right)</span><br><span class="line">    res.append(l)</span><br><span class="line"><span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><h3 id="ã€å›¾è®ºã€‘"><a href="#ã€å›¾è®ºã€‘" class="headerlink" title="ã€å›¾è®ºã€‘"></a>ã€å›¾è®ºã€‘</h3><hr><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ã€ŒDijkstraæœ€çŸ­è·¯å¾„ã€</span></span><br><span class="line">dic = collections.defaultdict(<span class="built_in">list</span>)</span><br><span class="line"><span class="keyword">for</span> u, v, w <span class="keyword">in</span> edges:</span><br><span class="line">    dic[u].append([v, w])</span><br><span class="line">    dic[v].append([u, w])</span><br><span class="line">q = [(<span class="number">0</span>, n)]</span><br><span class="line">dist = [-<span class="number">1</span>] * (n + <span class="number">1</span>)</span><br><span class="line"><span class="keyword">while</span> q:</span><br><span class="line">    dis, cur = heapq.heappop(q)</span><br><span class="line">    <span class="keyword">if</span> dist[cur] &lt; <span class="number">0</span>:</span><br><span class="line">        dist[cur] = dis</span><br><span class="line">        <span class="keyword">for</span> nxt, wi <span class="keyword">in</span> dic[cur]:</span><br><span class="line">            heapq.heappush(q, [dis + wi, nxt])</span><br></pre></td></tr></table></figure><p><strong>ã€ŒFloyd æ±‚å›¾ä¸­è·¯å¾„ã€</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Floydç®—æ³• æ±‚å›¾ä¸­ä»»æ„2ç‚¹è·ç¦»</span></span><br><span class="line">ds = defaultdict(<span class="built_in">int</span>)</span><br><span class="line">st = <span class="built_in">set</span>()</span><br><span class="line"><span class="keyword">for</span> i, (x, y) <span class="keyword">in</span> <span class="built_in">enumerate</span>(ess):</span><br><span class="line">    ds[(x, y)] = vs[i]</span><br><span class="line">    ds[(y, x)] = <span class="number">1</span> / vs[i]</span><br><span class="line">    st.update(&#123;x,y&#125;)</span><br><span class="line">arr = <span class="built_in">list</span>(st)</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> arr:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> arr:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> arr:</span><br><span class="line">            <span class="keyword">if</span> ds[(i, k)] <span class="keyword">and</span> ds[(k, j)]:</span><br><span class="line">                ds[(i, j)] = ds[(i, k)] * ds[(k, j)]</span><br></pre></td></tr></table></figure><h1 id="äº”ã€å®æˆ˜ç®—æ³•ç¯‡"><a href="#äº”ã€å®æˆ˜ç®—æ³•ç¯‡" class="headerlink" title="äº”ã€å®æˆ˜ç®—æ³•ç¯‡"></a>äº”ã€å®æˆ˜ç®—æ³•ç¯‡</h1><h3 id="1ã€URLé»‘åå•ï¼ˆå¸ƒéš†è¿‡æ»¤å™¨ï¼‰"><a href="#1ã€URLé»‘åå•ï¼ˆå¸ƒéš†è¿‡æ»¤å™¨ï¼‰" class="headerlink" title="1ã€URLé»‘åå•ï¼ˆå¸ƒéš†è¿‡æ»¤å™¨ï¼‰"></a><strong>1ã€</strong>URLé»‘åå•ï¼ˆå¸ƒéš†è¿‡æ»¤å™¨ï¼‰</h3><p><strong>100äº¿é»‘åå•URLï¼Œæ¯ä¸ª64Bï¼Œé—®è¿™ä¸ªé»‘åå•è¦æ€ä¹ˆå­˜ï¼Ÿåˆ¤æ–­ä¸€ä¸ªURLæ˜¯å¦åœ¨é»‘åå•ä¸­</strong></p><p>â€‹<strong>æ•£åˆ—è¡¨ï¼š</strong></p><p>â€‹å¦‚æœæŠŠé»‘åå•çœ‹æˆä¸€ä¸ªé›†åˆï¼Œå°†å…¶å­˜åœ¨ hashmap ä¸­ï¼Œè²Œä¼¼å¤ªå¤§äº†ï¼Œéœ€è¦ 640Gï¼Œæ˜æ˜¾ä¸ç§‘å­¦ã€‚</p><p>â€‹<strong>å¸ƒéš†è¿‡æ»¤å™¨ï¼š</strong></p><p>â€‹å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶çŸ¢é‡å’Œä¸€ç³»åˆ—éšæœºæ˜ å°„å‡½æ•°ã€‚</p><p>â€‹å®ƒ<strong>å¯ä»¥ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­</strong>ã€‚å®ƒçš„ä¼˜åŠ¿æ˜¯åªéœ€è¦å ç”¨å¾ˆå°çš„å†…å­˜ç©ºé—´ä»¥åŠæœ‰ç€é«˜æ•ˆçš„æŸ¥è¯¢æ•ˆç‡ã€‚å¯¹äºå¸ƒéš†è¿‡æ»¤å™¨è€Œè¨€ï¼Œå®ƒçš„æœ¬è´¨æ˜¯ä¸€ä¸ª<strong>ä½æ•°ç»„</strong>ï¼šä½æ•°ç»„å°±æ˜¯æ•°ç»„çš„æ¯ä¸ªå…ƒç´ éƒ½åªå ç”¨ 1 bit ï¼Œå¹¶ä¸”æ¯ä¸ªå…ƒç´ åªèƒ½æ˜¯ 0 æˆ–è€… 1ã€‚</p><p>â€‹åœ¨æ•°ç»„ä¸­çš„æ¯ä¸€ä½éƒ½æ˜¯äºŒè¿›åˆ¶ä½ã€‚å¸ƒéš†è¿‡æ»¤å™¨é™¤äº†ä¸€ä¸ªä½æ•°ç»„ï¼Œè¿˜æœ‰ K ä¸ªå“ˆå¸Œå‡½æ•°ã€‚å½“ä¸€ä¸ªå…ƒç´ åŠ å…¥å¸ƒéš†è¿‡æ»¤å™¨ä¸­çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><ul><li>ä½¿ç”¨ K ä¸ªå“ˆå¸Œå‡½æ•°å¯¹å…ƒç´ å€¼è¿›è¡Œ K æ¬¡è®¡ç®—ï¼Œå¾—åˆ° K ä¸ªå“ˆå¸Œå€¼ã€‚</li><li>æ ¹æ®å¾—åˆ°çš„å“ˆå¸Œå€¼ï¼Œåœ¨ä½æ•°ç»„ä¸­æŠŠå¯¹åº”ä¸‹æ ‡çš„å€¼ç½®ä¸º 1ã€‚</li></ul><h3 id="2ã€è¯é¢‘ç»Ÿè®¡ï¼ˆåˆ†æ–‡ä»¶ï¼‰"><a href="#2ã€è¯é¢‘ç»Ÿè®¡ï¼ˆåˆ†æ–‡ä»¶ï¼‰" class="headerlink" title="2ã€è¯é¢‘ç»Ÿè®¡ï¼ˆåˆ†æ–‡ä»¶ï¼‰"></a>2ã€è¯é¢‘ç»Ÿè®¡ï¼ˆåˆ†æ–‡ä»¶ï¼‰</h3><p><strong>2GBå†…å­˜åœ¨20äº¿æ•´æ•°ä¸­æ‰¾åˆ°å‡ºç°æ¬¡æ•°æœ€å¤šçš„æ•°</strong> </p><p>â€‹é€šå¸¸åšæ³•æ˜¯ä½¿ç”¨å“ˆå¸Œè¡¨å¯¹å‡ºç°çš„æ¯ä¸€ä¸ªæ•°åšè¯é¢‘ç»Ÿè®¡ï¼Œå“ˆå¸Œè¡¨çš„keyæ˜¯æŸä¸ªæ•´æ•°ï¼Œvalueè®°å½•æ•´æ•°å‡ºç°çš„æ¬¡æ•°ã€‚æœ¬é¢˜çš„æ•°æ®é‡æ˜¯20äº¿ï¼Œæœ‰å¯èƒ½ä¸€ä¸ªæ•°å‡ºç°20äº¿æ¬¡ï¼Œåˆ™ä¸ºäº†é¿å…æº¢å‡ºï¼Œå“ˆå¸Œè¡¨çš„keyæ˜¯32ä½ï¼ˆ4Bï¼‰,valueä¹Ÿæ˜¯ 32ä½ï¼ˆ4Bï¼‰ï¼Œé‚£ä¹ˆä¸€æ¡å“ˆå¸Œè¡¨çš„è®°å½•å°±éœ€è¦å ç”¨8Bã€‚</p><p>â€‹å½“å“ˆå¸Œè¡¨è®°å½•æ•°ä¸º2äº¿ä¸ªæ—¶ï¼Œéœ€è¦16äº¿ä¸ªå­—èŠ‚æ•°ï¼ˆ8*2äº¿ï¼‰ï¼Œéœ€è¦è‡³å°‘1.6GBå†…å­˜(16äº¿&#x2F;2^30,1GB&#x3D;&#x3D; 2 ^30ä¸ªå­—èŠ‚ &#x3D;&#x3D; 10äº¿)ã€‚åˆ™20äº¿ä¸ªè®°å½•ï¼Œè‡³å°‘éœ€è¦16GBçš„å†…å­˜ï¼Œä¸ç¬¦åˆé¢˜ç›®è¦æ±‚ã€‚</p><p>â€‹è§£å†³åŠæ³•æ˜¯å°†20äº¿ä¸ªæ•°çš„å¤§æ–‡ä»¶åˆ©ç”¨å“ˆå¸Œå‡½æ•°åˆ†æˆ16ä¸ªå°æ–‡ä»¶ï¼Œæ ¹æ®å“ˆå¸Œå‡½æ•°å¯ä»¥æŠŠ20äº¿æ¡æ•°æ®å‡åŒ€åˆ†å¸ƒåˆ°16ä¸ªæ–‡ä»¶ä¸Šï¼ŒåŒä¸€ç§æ•°ä¸å¯èƒ½è¢«å“ˆå¸Œå‡½æ•°åˆ†åˆ°ä¸åŒçš„å°æ–‡ä»¶ä¸Šï¼Œå‡è®¾å“ˆå¸Œå‡½æ•°å¤Ÿå¥½ã€‚ç„¶åå¯¹æ¯ä¸€ä¸ªå°æ–‡ä»¶ç”¨å“ˆå¸Œå‡½æ•°æ¥ç»Ÿè®¡å…¶ä¸­æ¯ç§æ•°å‡ºç°çš„æ¬¡æ•°ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¾—åˆ°16ä¸ªæ–‡ä»¶ä¸­å‡ºç°æ¬¡æ•°æœ€å¤šçš„æ•°ï¼Œæ¥ç€ä»16ä¸ªæ•°ä¸­é€‰å‡ºæ¬¡æ•°æœ€å¤§çš„é‚£ä¸ªkeyå³å¯ã€‚</p><h3 id="3ã€æœªå‡ºç°çš„æ•°ï¼ˆbitæ•°ç»„ï¼‰"><a href="#3ã€æœªå‡ºç°çš„æ•°ï¼ˆbitæ•°ç»„ï¼‰" class="headerlink" title="3ã€æœªå‡ºç°çš„æ•°ï¼ˆbitæ•°ç»„ï¼‰"></a><strong>3ã€æœªå‡ºç°çš„æ•°</strong>ï¼ˆbitæ•°ç»„ï¼‰</h3><p><strong>40äº¿ä¸ªéè´Ÿæ•´æ•°ä¸­æ‰¾åˆ°æ²¡æœ‰å‡ºç°çš„æ•°</strong> </p><p>â€‹å¯¹äºåŸé—®é¢˜ï¼Œå¦‚æœä½¿ç”¨å“ˆå¸Œè¡¨æ¥ä¿å­˜å‡ºç°è¿‡çš„æ•°ï¼Œé‚£ä¹ˆæœ€åæƒ…å†µä¸‹æ˜¯40äº¿ä¸ªæ•°éƒ½ä¸ç›¸åŒï¼Œé‚£ä¹ˆå“ˆå¸Œè¡¨åˆ™éœ€è¦ä¿å­˜40äº¿æ¡æ•°æ®ï¼Œä¸€ä¸ª32ä½æ•´æ•°éœ€è¦4Bï¼Œé‚£ä¹ˆ40äº¿*4B &#x3D; 160äº¿ä¸ªå­—èŠ‚ï¼Œä¸€èˆ¬å¤§æ¦‚10äº¿ä¸ªå­—èŠ‚çš„æ•°æ®éœ€è¦1Gçš„ç©ºé—´ï¼Œé‚£ä¹ˆå¤§æ¦‚éœ€è¦16Gçš„ç©ºé—´ï¼Œè¿™ä¸ç¬¦åˆè¦æ±‚ã€‚</p><p>ã€€ã€€æˆ‘ä»¬æ¢ä¸€ç§æ–¹å¼ï¼Œç”³è¯·ä¸€ä¸ªbitæ•°ç»„ï¼Œæ•°ç»„å¤§å°ä¸º4294967295ï¼Œå¤§æ¦‚ä¸º40äº¿bitï¼Œ40äº¿&#x2F;8 &#x3D; 5äº¿å­—èŠ‚ï¼Œé‚£ä¹ˆéœ€è¦0.5Gç©ºé—´ï¼Œ bitæ•°ç»„çš„æ¯ä¸ªä½ç½®æœ‰ä¸¤ç§çŠ¶æ€0å’Œ1ï¼Œé‚£ä¹ˆæ€ä¹ˆä½¿ç”¨è¿™ä¸ªbitæ•°ç»„å‘¢ï¼Ÿå‘µå‘µï¼Œæ•°ç»„çš„é•¿åº¦åˆšå¥½æ»¡è¶³æˆ‘ä»¬æ•´æ•°çš„ä¸ªæ•°èŒƒå›´ï¼Œé‚£ä¹ˆæ•°ç»„çš„æ¯ä¸ªä¸‹æ ‡å€¼å¯¹åº”4294967295ä¸­çš„ä¸€ä¸ªæ•°ï¼Œé€ä¸ªéå†40äº¿ä¸ªæ— ç¬¦å·æ•°ï¼Œä¾‹å¦‚ï¼Œé‡åˆ°20ï¼Œåˆ™bitArray[20] &#x3D; 1ï¼›é‡åˆ°666ï¼Œåˆ™bitArray[666] &#x3D; 1,éå†å®Œæ‰€æœ‰çš„æ•°ï¼Œå°†æ•°ç»„ç›¸åº”ä½ç½®å˜ä¸º1ã€‚</p><p><strong>40äº¿ä¸ªéè´Ÿæ•´æ•°ä¸­æ‰¾åˆ°ä¸€ä¸ªæ²¡æœ‰å‡ºç°çš„æ•°ï¼Œå†…å­˜é™åˆ¶10MB</strong> </p><p>â€‹10äº¿ä¸ªå­—èŠ‚çš„æ•°æ®å¤§æ¦‚éœ€è¦1GBç©ºé—´å¤„ç†ï¼Œé‚£ä¹ˆ10MBå†…å­˜æ¢ç®—è¿‡æ¥å°±æ˜¯å¯ä»¥å¤„ç†1åƒä¸‡å­—èŠ‚çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯8åƒä¸‡bitï¼Œå¯¹äº40äº¿éè´Ÿæ•´æ•°å¦‚æœç”³è¯·bitæ•°ç»„çš„è¯ï¼Œ40äº¿bit &#x2F; 0.8äº¿bit &#x3D; 50ï¼Œé‚£ä¹ˆè¿™æ ·æœ€å°‘ä¹Ÿå¾—åˆ†50å—æ¥å¤„ç†ï¼Œä¸‹é¢å°±ä»¥64å—æ¥è¿›è¡Œåˆ†æè§£ç­”å§ã€‚</p><p><strong>æ€»ç»“ä¸€ä¸‹è¿›é˜¶çš„è§£æ³•ï¼š</strong></p><p>1ï¼æ ¹æ®10MBçš„å†…å­˜é™åˆ¶ï¼Œç¡®å®šç»Ÿè®¡åŒºé—´çš„å¤§å°ï¼Œå°±æ˜¯ç¬¬äºŒæ¬¡éå†æ—¶çš„bitArrå¤§å°ã€‚</p><p>2ï¼åˆ©ç”¨åŒºé—´è®¡æ•°çš„æ–¹å¼ï¼Œæ‰¾åˆ°é‚£ä¸ªè®¡æ•°ä¸è¶³çš„åŒºé—´ï¼Œè¿™ä¸ªåŒºé—´ä¸Šè‚¯å®šæœ‰æ²¡å‡ºç°çš„æ•°ã€‚</p><p>3ï¼å¯¹è¿™ä¸ªåŒºé—´ä¸Šçš„æ•°åšbit mapæ˜ å°„ï¼Œå†éå†bit mapï¼Œæ‰¾åˆ°ä¸€ä¸ªæ²¡å‡ºç°çš„æ•°å³å¯ã€‚</p><p><strong>è‡ªå·±çš„æƒ³æ³•</strong></p><p>å¦‚æœåªæ˜¯æ‰¾ä¸€ä¸ªæ•°ï¼Œå¯ä»¥é«˜ä½æ¨¡è¿ç®—ï¼Œå†™åˆ°64ä¸ªä¸åŒçš„æ–‡ä»¶ï¼Œç„¶ååœ¨æœ€å°çš„æ–‡ä»¶ä¸­é€šè¿‡bitArrayä¸€æ¬¡å¤„ç†æ‰ã€‚</p><p><strong>40äº¿ä¸ªæ— ç¬¦å·æ•´æ•°ï¼Œ1GBå†…å­˜ï¼Œæ‰¾åˆ°æ‰€æœ‰å‡ºç°ä¸¤æ¬¡çš„æ•°</strong> </p><p>â€‹å¯¹äºåŸé—®é¢˜ï¼Œå¯ä»¥ç”¨bit mapçš„æ–¹å¼æ¥è¡¨ç¤ºæ•°å‡ºç°çš„æƒ…å†µã€‚å…·ä½“åœ°è¯´ï¼Œæ˜¯ç”³è¯·ä¸€ä¸ªé•¿åº¦ä¸º4294967295Ã—2çš„bitç±»å‹çš„æ•°ç»„bitArrï¼Œç”¨2ä¸ªä½ç½®è¡¨ç¤ºä¸€ä¸ªæ•°å‡ºç°çš„è¯é¢‘ï¼Œ1Bå ç”¨8ä¸ªbitï¼Œæ‰€ä»¥é•¿åº¦ä¸º4294967295Ã—2çš„bitç±»å‹çš„æ•°ç»„å ç”¨1GBç©ºé—´ã€‚æ€ä¹ˆä½¿ç”¨è¿™ä¸ªbitArræ•°ç»„å‘¢ï¼Ÿéå†è¿™40äº¿ä¸ªæ— ç¬¦å·æ•°ï¼Œå¦‚æœåˆæ¬¡é‡åˆ°numï¼Œå°±æŠŠbitArr[num<em>2 + 1]å’ŒbitArr[num</em>2]è®¾ç½®ä¸º01ï¼Œå¦‚æœç¬¬äºŒæ¬¡é‡åˆ°numï¼Œå°±æŠŠbitArr[num<em>2+1]å’ŒbitArr[num</em>2]è®¾ç½®ä¸º10ï¼Œå¦‚æœç¬¬ä¸‰æ¬¡é‡åˆ°numï¼Œå°±æŠŠbitArr[num<em>2+1]å’ŒbitArr[num</em>2]è®¾ç½®ä¸º11ã€‚ä»¥åå†é‡åˆ°numï¼Œå‘ç°æ­¤æ—¶bitArr[num<em>2+1]å’ŒbitArr[num</em>2]å·²ç»è¢«è®¾ç½®ä¸º11ï¼Œå°±ä¸å†åšä»»ä½•è®¾ç½®ã€‚éå†å®Œæˆåï¼Œå†ä¾æ¬¡éå†bitArrï¼Œå¦‚æœå‘ç°bitArr[i<em>2+1]å’ŒbitArr[i</em>2]è®¾ç½®ä¸º10ï¼Œé‚£ä¹ˆi å°±æ˜¯å‡ºç°äº†ä¸¤æ¬¡çš„æ•°ã€‚</p><h3 id="4ã€é‡å¤URLï¼ˆåˆ†æœºå™¨ï¼‰"><a href="#4ã€é‡å¤URLï¼ˆåˆ†æœºå™¨ï¼‰" class="headerlink" title="4ã€é‡å¤URLï¼ˆåˆ†æœºå™¨ï¼‰"></a><strong>4ã€é‡å¤URL</strong>ï¼ˆåˆ†æœºå™¨ï¼‰</h3><p><strong>æ‰¾åˆ°100äº¿ä¸ªURLä¸­é‡å¤çš„URL</strong></p><p>â€‹åŸé—®é¢˜çš„è§£æ³•ä½¿ç”¨è§£å†³å¤§æ•°æ®é—®é¢˜çš„ä¸€ç§å¸¸è§„æ–¹æ³•ï¼šæŠŠå¤§æ–‡ä»¶é€šè¿‡å“ˆå¸Œå‡½æ•°åˆ†é…åˆ°æœºå™¨ï¼Œæˆ–è€…é€šè¿‡å“ˆå¸Œå‡½æ•°æŠŠå¤§æ–‡ä»¶æ‹†æˆå°æ–‡ä»¶ã€‚ä¸€ç›´è¿›è¡Œè¿™ç§åˆ’åˆ†ï¼Œç›´åˆ°åˆ’åˆ†çš„ç»“æœæ»¡è¶³èµ„æºé™åˆ¶çš„è¦æ±‚ã€‚é¦–å…ˆï¼Œä½ è¦å‘é¢è¯•å®˜è¯¢é—®åœ¨èµ„æºä¸Šçš„é™åˆ¶æœ‰å“ªäº›ï¼ŒåŒ…æ‹¬å†…å­˜ã€è®¡ç®—æ—¶é—´ç­‰è¦æ±‚ã€‚åœ¨æ˜ç¡®äº†é™åˆ¶è¦æ±‚ä¹‹åï¼Œå¯ä»¥å°†æ¯æ¡URLé€šè¿‡å“ˆå¸Œå‡½æ•°åˆ†é…åˆ°è‹¥å¹²æœºå™¨æˆ–è€…æ‹†åˆ†æˆè‹¥å¹²å°æ–‡ä»¶ï¼Œè¿™é‡Œçš„â€œè‹¥å¹²â€ç”±å…·ä½“çš„èµ„æºé™åˆ¶æ¥è®¡ç®—å‡ºç²¾ç¡®çš„æ•°é‡ã€‚ </p><p>â€‹ä¾‹å¦‚ï¼Œå°†100äº¿å­—èŠ‚çš„å¤§æ–‡ä»¶é€šè¿‡å“ˆå¸Œå‡½æ•°åˆ†é…åˆ°100å°æœºå™¨ä¸Šï¼Œç„¶åæ¯ä¸€å°æœºå™¨åˆ†åˆ«ç»Ÿè®¡åˆ†ç»™è‡ªå·±çš„URLä¸­æ˜¯å¦æœ‰é‡å¤çš„URLï¼Œ<strong>åŒæ—¶å“ˆå¸Œå‡½æ•°çš„æ€§è´¨å†³å®šäº†åŒä¸€æ¡URLä¸å¯èƒ½åˆ†ç»™ä¸åŒçš„æœºå™¨ï¼›</strong>æˆ–è€…åœ¨å•æœºä¸Šå°†å¤§æ–‡ä»¶é€šè¿‡å“ˆå¸Œå‡½æ•°æ‹†æˆ1000ä¸ªå°æ–‡ä»¶ï¼Œå¯¹æ¯ä¸€ä¸ªå°æ–‡ä»¶å†åˆ©ç”¨å“ˆå¸Œè¡¨éå†ï¼Œæ‰¾å‡ºé‡å¤çš„URLï¼›æˆ–è€…åœ¨åˆ†ç»™æœºå™¨æˆ–æ‹†å®Œæ–‡ä»¶ä¹‹åï¼Œè¿›è¡Œæ’åºï¼Œæ’åºè¿‡åå†çœ‹æ˜¯å¦æœ‰é‡å¤çš„URLå‡ºç°ã€‚æ€»ä¹‹ï¼Œç‰¢è®°ä¸€ç‚¹ï¼Œå¾ˆå¤šå¤§æ•°æ®é—®é¢˜éƒ½ç¦»ä¸å¼€åˆ†æµï¼Œè¦ä¹ˆæ˜¯å“ˆå¸Œå‡½æ•°æŠŠå¤§æ–‡ä»¶çš„å†…å®¹åˆ†é…ç»™ä¸åŒçš„æœºå™¨ï¼Œè¦ä¹ˆæ˜¯å“ˆå¸Œå‡½æ•°æŠŠå¤§æ–‡ä»¶æ‹†æˆå°æ–‡ä»¶ï¼Œç„¶åå¤„ç†æ¯ä¸€ä¸ªå°æ•°é‡çš„é›†åˆã€‚</p><h3 id="5ã€TOPKæœç´¢ï¼ˆå°æ ¹å †ï¼‰"><a href="#5ã€TOPKæœç´¢ï¼ˆå°æ ¹å †ï¼‰" class="headerlink" title="5ã€TOPKæœç´¢ï¼ˆå°æ ¹å †ï¼‰"></a><strong>5ã€TOPKæœç´¢ï¼ˆå°æ ¹å †ï¼‰</strong></h3><p><strong>æµ·é‡æœç´¢è¯æ±‡ï¼Œæ‰¾åˆ°æœ€çƒ­TOP100è¯æ±‡çš„æ–¹æ³•</strong> </p><p>â€‹æœ€å¼€å§‹è¿˜æ˜¯ç”¨å“ˆå¸Œåˆ†æµçš„æ€è·¯æ¥å¤„ç†ï¼ŒæŠŠåŒ…å«ç™¾äº¿æ•°æ®é‡çš„è¯æ±‡æ–‡ä»¶åˆ†æµåˆ°ä¸åŒçš„æœºå™¨ä¸Šï¼Œå…·ä½“å¤šå°‘å°æœºå™¨ç”±é¢è¯•å®˜è§„å®šæˆ–è€…ç”±æ›´å¤šçš„é™åˆ¶æ¥å†³å®šã€‚å¯¹æ¯ä¸€å°æœºå™¨æ¥è¯´ï¼Œå¦‚æœåˆ†åˆ°çš„æ•°æ®é‡ä¾ç„¶å¾ˆå¤§ï¼Œæ¯”å¦‚ï¼Œå†…å­˜ä¸å¤Ÿæˆ–å…¶ä»–é—®é¢˜ï¼Œå¯ä»¥å†ç”¨å“ˆå¸Œå‡½æ•°æŠŠæ¯å°æœºå™¨çš„åˆ†æµæ–‡ä»¶æ‹†æˆæ›´å°çš„æ–‡ä»¶å¤„ç†ã€‚</p><p>â€‹å¤„ç†æ¯ä¸€ä¸ªå°æ–‡ä»¶çš„æ—¶å€™ï¼Œå“ˆå¸Œè¡¨ç»Ÿè®¡æ¯ç§è¯åŠå…¶è¯é¢‘ï¼Œå“ˆå¸Œè¡¨è®°å½•å»ºç«‹å®Œæˆåï¼Œå†éå†å“ˆå¸Œè¡¨ï¼Œéå†å“ˆå¸Œè¡¨çš„è¿‡ç¨‹ä¸­ä½¿ç”¨å¤§å°ä¸º100çš„å°æ ¹å †æ¥é€‰å‡ºæ¯ä¸€ä¸ªå°æ–‡ä»¶çš„top 100ï¼ˆæ•´ä½“æœªæ’åºçš„top 100ï¼‰ã€‚æ¯ä¸€ä¸ªå°æ–‡ä»¶éƒ½æœ‰è‡ªå·±è¯é¢‘çš„å°æ ¹å †ï¼ˆæ•´ä½“æœªæ’åºçš„top 100ï¼‰ï¼Œå°†å°æ ¹å †é‡Œçš„è¯æŒ‰ç…§è¯é¢‘æ’åºï¼Œå°±å¾—åˆ°äº†æ¯ä¸ªå°æ–‡ä»¶çš„æ’åºåtop 100ã€‚ç„¶åæŠŠå„ä¸ªå°æ–‡ä»¶æ’åºåçš„top 100è¿›è¡Œå¤–æ’åºæˆ–è€…ç»§ç»­åˆ©ç”¨å°æ ¹å †ï¼Œå°±å¯ä»¥é€‰å‡ºæ¯å°æœºå™¨ä¸Šçš„top 100ã€‚ä¸åŒæœºå™¨ä¹‹é—´çš„top100å†è¿›è¡Œå¤–æ’åºæˆ–è€…ç»§ç»­åˆ©ç”¨å°æ ¹å †ï¼Œæœ€ç»ˆæ±‚å‡ºæ•´ä¸ªç™¾äº¿æ•°æ®é‡ä¸­çš„top 100ã€‚å¯¹äºtop K çš„é—®é¢˜ï¼Œé™¤å“ˆå¸Œå‡½æ•°åˆ†æµå’Œç”¨å“ˆå¸Œè¡¨åšè¯é¢‘ç»Ÿè®¡ä¹‹å¤–ï¼Œè¿˜ç»å¸¸ç”¨å †ç»“æ„å’Œå¤–æ’åºçš„æ‰‹æ®µè¿›è¡Œå¤„ç†ã€‚</p><h3 id="6ã€ä¸­ä½æ•°ï¼ˆå•å‘äºŒåˆ†æŸ¥æ‰¾ï¼‰"><a href="#6ã€ä¸­ä½æ•°ï¼ˆå•å‘äºŒåˆ†æŸ¥æ‰¾ï¼‰" class="headerlink" title="6ã€ä¸­ä½æ•°ï¼ˆå•å‘äºŒåˆ†æŸ¥æ‰¾ï¼‰"></a><strong>6ã€ä¸­ä½æ•°ï¼ˆå•å‘äºŒåˆ†æŸ¥æ‰¾ï¼‰</strong></h3><p><strong>10MBå†…å­˜ï¼Œæ‰¾åˆ°100äº¿æ•´æ•°çš„ä¸­ä½æ•°</strong> </p><p>â‘ å†…å­˜å¤Ÿï¼šå†…å­˜å¤Ÿè¿˜æ…Œä»€ä¹ˆå•Šï¼Œç›´æ¥æŠŠ100äº¿ä¸ªå…¨éƒ¨æ’åºäº†ï¼Œä½ ç”¨å†’æ³¡éƒ½å¯ä»¥â€¦ç„¶åæ‰¾åˆ°ä¸­é—´é‚£ä¸ªå°±å¯ä»¥äº†ã€‚ä½†æ˜¯ä½ ä»¥ä¸ºé¢è¯•å®˜ä¼šç»™ä½ å†…å­˜ï¼Ÿï¼Ÿ </p><p>â‘¡å†…å­˜ä¸å¤Ÿï¼šé¢˜ç›®è¯´æ˜¯æ•´æ•°ï¼Œæˆ‘ä»¬è®¤ä¸ºæ˜¯å¸¦ç¬¦å·çš„int,æ‰€ä»¥4å­—èŠ‚ï¼Œå 32ä½ã€‚ </p><p>  å‡è®¾100äº¿ä¸ªæ•°å­—ä¿å­˜åœ¨ä¸€ä¸ªå¤§æ–‡ä»¶ä¸­ï¼Œä¾æ¬¡è¯»ä¸€éƒ¨åˆ†æ–‡ä»¶åˆ°å†…å­˜(ä¸è¶…è¿‡å†…å­˜çš„é™åˆ¶)ï¼Œå°†æ¯ä¸ªæ•°å­—ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œæ¯”è¾ƒäºŒè¿›åˆ¶çš„æœ€é«˜ä½(ç¬¬32ä½ï¼Œç¬¦å·ä½ï¼Œ0æ˜¯æ­£ï¼Œ1æ˜¯è´Ÿ)ï¼Œå¦‚æœæ•°å­—çš„æœ€é«˜ä½ä¸º0ï¼Œåˆ™å°†è¿™ä¸ªæ•°å­—å†™å…¥ file_0æ–‡ä»¶ä¸­ï¼›å¦‚æœæœ€é«˜ä½ä¸º 1ï¼Œåˆ™å°†è¯¥æ•°å­—å†™å…¥file_1æ–‡ä»¶ä¸­ã€‚ </p><p>  ä»è€Œå°†100äº¿ä¸ªæ•°å­—åˆ†æˆäº†ä¸¤ä¸ªæ–‡ä»¶ï¼Œå‡è®¾ file_0æ–‡ä»¶ä¸­æœ‰ 60äº¿ ä¸ªæ•°å­—ï¼Œfile_1æ–‡ä»¶ä¸­æœ‰ 40äº¿ ä¸ªæ•°å­—ã€‚é‚£ä¹ˆä¸­ä½æ•°å°±åœ¨ file_0 æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”æ˜¯ file_0 æ–‡ä»¶ä¸­æ‰€æœ‰æ•°å­—æ’åºä¹‹åçš„ç¬¬ 10äº¿ ä¸ªæ•°å­—ã€‚ï¼ˆfile_1ä¸­çš„æ•°éƒ½æ˜¯è´Ÿæ•°ï¼Œfile_0ä¸­çš„æ•°éƒ½æ˜¯æ­£æ•°ï¼Œä¹Ÿå³è¿™é‡Œä¸€å…±åªæœ‰40äº¿ä¸ªè´Ÿæ•°ï¼Œé‚£ä¹ˆæ’åºä¹‹åçš„ç¬¬50äº¿ä¸ªæ•°ä¸€å®šä½äºfile_0ä¸­ï¼‰ </p><p>  ç°åœ¨ï¼Œæˆ‘ä»¬åªéœ€è¦å¤„ç† file_0 æ–‡ä»¶äº†ï¼ˆä¸éœ€è¦å†è€ƒè™‘file_1æ–‡ä»¶ï¼‰ã€‚å¯¹äº file_0 æ–‡ä»¶ï¼ŒåŒæ ·é‡‡å–ä¸Šé¢çš„æªæ–½å¤„ç†ï¼šå°†file_0æ–‡ä»¶ä¾æ¬¡è¯»ä¸€éƒ¨åˆ†åˆ°å†…å­˜(ä¸è¶…å†…å­˜é™åˆ¶)ï¼Œå°†æ¯ä¸ªæ•°å­—ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œæ¯”è¾ƒäºŒè¿›åˆ¶çš„ æ¬¡é«˜ä½ï¼ˆç¬¬31ä½ï¼‰ï¼Œå¦‚æœæ•°å­—çš„æ¬¡é«˜ä½ä¸º0ï¼Œå†™å…¥file_0_0æ–‡ä»¶ä¸­ï¼›å¦‚æœæ¬¡é«˜ä½ä¸º1ï¼Œå†™å…¥file_0_1æ–‡ä»¶ ä¸­ã€‚ </p><p>  ç°å‡è®¾ file_0_0æ–‡ä»¶ä¸­æœ‰30äº¿ä¸ªæ•°å­—ï¼Œfile_0_1ä¸­ä¹Ÿæœ‰30äº¿ä¸ªæ•°å­—ï¼Œåˆ™ä¸­ä½æ•°å°±æ˜¯ï¼šfile_0_0æ–‡ä»¶ä¸­çš„æ•°å­—ä»å°åˆ°å¤§æ’åºä¹‹åçš„ç¬¬10äº¿ä¸ªæ•°å­—ã€‚ </p><p>  æŠ›å¼ƒfile_0_1æ–‡ä»¶ï¼Œç»§ç»­å¯¹ file_0_0æ–‡ä»¶ æ ¹æ® æ¬¡æ¬¡é«˜ä½(ç¬¬30ä½) åˆ’åˆ†ï¼Œå‡è®¾æ­¤æ¬¡åˆ’åˆ†çš„ä¸¤ä¸ªæ–‡ä»¶ä¸ºï¼šfile_0_0_0ä¸­æœ‰5äº¿ä¸ªæ•°å­—ï¼Œfile_0_0_1ä¸­æœ‰25äº¿ä¸ªæ•°å­—ï¼Œé‚£ä¹ˆä¸­ä½æ•°å°±æ˜¯ file_0_0_1æ–‡ä»¶ä¸­çš„æ‰€æœ‰æ•°å­—æ’åºä¹‹åçš„ ç¬¬ 5äº¿ ä¸ªæ•°ã€‚ </p><p>  æŒ‰ç…§ä¸Šè¿°æ€è·¯ï¼Œç›´åˆ°åˆ’åˆ†çš„æ–‡ä»¶å¯ç›´æ¥åŠ è½½è¿›å†…å­˜æ—¶ï¼Œå°±å¯ä»¥ç›´æ¥å¯¹æ•°å­—è¿›è¡Œå¿«é€Ÿæ’åºï¼Œæ‰¾å‡ºä¸­ä½æ•°äº†ã€‚</p><h3 id="7ã€çŸ­åŸŸåç³»ç»Ÿï¼ˆç¼“å­˜ï¼‰"><a href="#7ã€çŸ­åŸŸåç³»ç»Ÿï¼ˆç¼“å­˜ï¼‰" class="headerlink" title="7ã€çŸ­åŸŸåç³»ç»Ÿï¼ˆç¼“å­˜ï¼‰"></a><strong>7ã€çŸ­åŸŸåç³»ç»Ÿï¼ˆç¼“å­˜ï¼‰</strong></h3><p><strong>è®¾è®¡çŸ­åŸŸåç³»ç»Ÿï¼Œå°†é•¿URLè½¬åŒ–æˆçŸ­çš„URL.</strong></p><p>ï¼ˆ1ï¼‰åˆ©ç”¨æ”¾å·å™¨ï¼Œåˆå§‹å€¼ä¸º0ï¼Œå¯¹äºæ¯ä¸€ä¸ªçŸ­é“¾æ¥ç”Ÿæˆè¯·æ±‚ï¼Œéƒ½é€’å¢æ”¾å·å™¨çš„å€¼ï¼Œå†å°†æ­¤å€¼è½¬æ¢ä¸º62è¿›åˆ¶ï¼ˆa-zA-Z0-9ï¼‰ï¼Œæ¯”å¦‚ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶æ”¾å·å™¨çš„å€¼ä¸º0ï¼Œå¯¹åº”62è¿›åˆ¶ä¸ºaï¼Œç¬¬äºŒæ¬¡è¯·æ±‚æ—¶æ”¾å·å™¨çš„å€¼ä¸º1ï¼Œå¯¹åº”62è¿›åˆ¶ä¸ºbï¼Œç¬¬10001æ¬¡è¯·æ±‚æ—¶æ”¾å·å™¨çš„å€¼ä¸º10000ï¼Œå¯¹åº”62è¿›åˆ¶ä¸ºsBcã€‚</p><p>ï¼ˆ2ï¼‰å°†çŸ­é“¾æ¥æœåŠ¡å™¨åŸŸåä¸æ”¾å·å™¨çš„62è¿›åˆ¶å€¼è¿›è¡Œå­—ç¬¦ä¸²è¿æ¥ï¼Œå³ä¸ºçŸ­é“¾æ¥çš„URLï¼Œæ¯”å¦‚ï¼š<a href="http://t.cn/sBc%E3%80%82">t.cn&#x2F;sBcã€‚</a></p><p>ï¼ˆ3ï¼‰é‡å®šå‘è¿‡ç¨‹ï¼šç”ŸæˆçŸ­é“¾æ¥ä¹‹åï¼Œéœ€è¦å­˜å‚¨çŸ­é“¾æ¥åˆ°é•¿é“¾æ¥çš„æ˜ å°„å…³ç³»ï¼Œå³sBc -&gt; URLï¼Œæµè§ˆå™¨è®¿é—®çŸ­é“¾æ¥æœåŠ¡å™¨æ—¶ï¼Œæ ¹æ®URL Pathå–åˆ°åŸå§‹çš„é“¾æ¥ï¼Œç„¶åè¿›è¡Œ302é‡å®šå‘ã€‚æ˜ å°„å…³ç³»å¯ä½¿ç”¨K-Vå­˜å‚¨ï¼Œæ¯”å¦‚Redisæˆ–Memcacheã€‚</p><h3 id="8ã€æµ·é‡è¯„è®ºå…¥åº“ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰"><a href="#8ã€æµ·é‡è¯„è®ºå…¥åº“ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰" class="headerlink" title="8ã€æµ·é‡è¯„è®ºå…¥åº“ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰"></a><strong>8ã€æµ·é‡è¯„è®ºå…¥åº“ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰</strong></h3><p><strong>å‡è®¾æœ‰è¿™ä¹ˆä¸€ä¸ªåœºæ™¯ï¼Œæœ‰ä¸€æ¡æ–°é—»ï¼Œæ–°é—»çš„è¯„è®ºé‡å¯èƒ½å¾ˆå¤§ï¼Œå¦‚ä½•è®¾è®¡è¯„è®ºçš„è¯»å’Œå†™</strong></p><p>å‰ç«¯é¡µé¢ç›´æ¥ç»™ç”¨æˆ·å±•ç¤ºã€é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥æ–¹å¼å…¥åº“</p><p>è¯»å¯ä»¥è¿›è¡Œè¯»å†™åˆ†ç¦»ã€åŒæ—¶çƒ­ç‚¹è¯„è®ºå®šæ—¶åŠ è½½åˆ°ç¼“å­˜</p><h3 id="9ã€åœ¨çº¿-å¹¶å‘ç”¨æˆ·æ•°ï¼ˆRedisï¼‰"><a href="#9ã€åœ¨çº¿-å¹¶å‘ç”¨æˆ·æ•°ï¼ˆRedisï¼‰" class="headerlink" title="9ã€åœ¨çº¿&#x2F;å¹¶å‘ç”¨æˆ·æ•°ï¼ˆRedisï¼‰"></a><strong>9ã€åœ¨çº¿&#x2F;å¹¶å‘ç”¨æˆ·æ•°ï¼ˆRedisï¼‰</strong></h3><p>â€‹<strong>æ˜¾ç¤ºç½‘ç«™çš„ç”¨æˆ·åœ¨çº¿æ•°çš„è§£å†³æ€è·¯</strong></p><p>â€‹ç»´æŠ¤åœ¨çº¿ç”¨æˆ·è¡¨</p><p>â€‹ä½¿ç”¨Redisç»Ÿè®¡</p><p><strong>æ˜¾ç¤ºç½‘ç«™å¹¶å‘ç”¨æˆ·æ•°</strong></p><ol><li>æ¯å½“ç”¨æˆ·è®¿é—®æœåŠ¡æ—¶ï¼ŒæŠŠè¯¥ç”¨æˆ·çš„ ID å†™å…¥ZSORTé˜Ÿåˆ—ï¼Œæƒé‡ä¸ºå½“å‰æ—¶é—´</li><li>æ ¹æ®æƒé‡(å³æ—¶é—´)è®¡ç®—ä¸€åˆ†é’Ÿå†…è¯¥æœºæ„çš„ç”¨æˆ·æ•°Zrange</li><li>åˆ æ‰ä¸€åˆ†é’Ÿä»¥ä¸Šè¿‡æœŸçš„ç”¨æˆ·Zrem</li></ol><h3 id="10ã€çƒ­é—¨å­—ç¬¦ä¸²ï¼ˆå‰ç¼€æ ‘ï¼‰"><a href="#10ã€çƒ­é—¨å­—ç¬¦ä¸²ï¼ˆå‰ç¼€æ ‘ï¼‰" class="headerlink" title="10ã€çƒ­é—¨å­—ç¬¦ä¸²ï¼ˆå‰ç¼€æ ‘ï¼‰"></a>10ã€çƒ­é—¨å­—ç¬¦ä¸²ï¼ˆå‰ç¼€æ ‘ï¼‰</h3><p>å‡è®¾ç›®å‰æœ‰ 1000w ä¸ªè®°å½•ï¼ˆè¿™äº›æŸ¥è¯¢ä¸²çš„é‡å¤åº¦æ¯”è¾ƒé«˜ï¼Œè™½ç„¶æ€»æ•°æ˜¯ 1000wï¼Œä½†å¦‚æœé™¤å»é‡å¤åï¼Œåˆ™ä¸è¶…è¿‡ 300w ä¸ªï¼‰ã€‚è¯·ç»Ÿè®¡æœ€çƒ­é—¨çš„ 10 ä¸ªæŸ¥è¯¢ä¸²ï¼Œè¦æ±‚ä½¿ç”¨çš„å†…å­˜ä¸èƒ½è¶…è¿‡ 1Gã€‚ï¼ˆä¸€ä¸ªæŸ¥è¯¢ä¸²çš„é‡å¤åº¦è¶Šé«˜ï¼Œè¯´æ˜æŸ¥è¯¢å®ƒçš„ç”¨æˆ·è¶Šå¤šï¼Œä¹Ÿå°±è¶Šçƒ­é—¨ã€‚ï¼‰</p><p><strong>HashMap æ³•</strong></p><p>è™½ç„¶å­—ç¬¦ä¸²æ€»æ•°æ¯”è¾ƒå¤šï¼Œä½†å»é‡åä¸è¶…è¿‡ 300wï¼Œå› æ­¤ï¼Œå¯ä»¥è€ƒè™‘æŠŠæ‰€æœ‰å­—ç¬¦ä¸²åŠå‡ºç°æ¬¡æ•°ä¿å­˜åœ¨ä¸€ä¸ª HashMap ä¸­ï¼Œæ‰€å ç”¨çš„ç©ºé—´ä¸º 300w*(255+4)â‰ˆ777Mï¼ˆå…¶ä¸­ï¼Œ4 è¡¨ç¤ºæ•´æ•°å ç”¨çš„ 4 ä¸ªå­—èŠ‚ï¼‰ã€‚ç”±æ­¤å¯è§ï¼Œ1G çš„å†…å­˜ç©ºé—´å®Œå…¨å¤Ÿç”¨ã€‚</p><p><strong>æ€è·¯å¦‚ä¸‹</strong>ï¼š</p><p>é¦–å…ˆï¼Œéå†å­—ç¬¦ä¸²ï¼Œè‹¥ä¸åœ¨ map ä¸­ï¼Œç›´æ¥å­˜å…¥ mapï¼Œvalue è®°ä¸º 1ï¼›è‹¥åœ¨ map ä¸­ï¼Œåˆ™æŠŠå¯¹åº”çš„ value åŠ  1ï¼Œè¿™ä¸€æ­¥æ—¶é—´å¤æ‚åº¦ <code>O(N)</code> ã€‚</p><p>æ¥ç€éå† mapï¼Œæ„å»ºä¸€ä¸ª 10 ä¸ªå…ƒç´ çš„å°é¡¶å †ï¼Œè‹¥éå†åˆ°çš„å­—ç¬¦ä¸²çš„å‡ºç°æ¬¡æ•°å¤§äºå †é¡¶å­—ç¬¦ä¸²çš„å‡ºç°æ¬¡æ•°ï¼Œåˆ™è¿›è¡Œæ›¿æ¢ï¼Œå¹¶å°†å †è°ƒæ•´ä¸ºå°é¡¶å †ã€‚</p><p>éå†ç»“æŸåï¼Œå †ä¸­ 10 ä¸ªå­—ç¬¦ä¸²å°±æ˜¯å‡ºç°æ¬¡æ•°æœ€å¤šçš„å­—ç¬¦ä¸²ã€‚è¿™ä¸€æ­¥æ—¶é—´å¤æ‚åº¦ <code>O(Nlog10)</code> ã€‚</p><p><strong>å‰ç¼€æ ‘æ³•</strong></p><p>å½“è¿™äº›å­—ç¬¦ä¸²æœ‰å¤§é‡ç›¸åŒå‰ç¼€æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å‰ç¼€æ ‘æ¥ç»Ÿè®¡å­—ç¬¦ä¸²å‡ºç°çš„æ¬¡æ•°ï¼Œæ ‘çš„ç»“ç‚¹ä¿å­˜å­—ç¬¦ä¸²å‡ºç°æ¬¡æ•°ï¼Œ0 è¡¨ç¤ºæ²¡æœ‰å‡ºç°ã€‚</p><p><strong>æ€è·¯å¦‚ä¸‹</strong>ï¼š</p><p>åœ¨éå†å­—ç¬¦ä¸²æ—¶ï¼Œåœ¨å‰ç¼€æ ‘ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œåˆ™æŠŠç»“ç‚¹ä¸­ä¿å­˜çš„å­—ç¬¦ä¸²æ¬¡æ•°åŠ  1ï¼Œå¦åˆ™ä¸ºè¿™ä¸ªå­—ç¬¦ä¸²æ„å»ºæ–°ç»“ç‚¹ï¼Œæ„å»ºå®ŒæˆåæŠŠå¶å­ç»“ç‚¹ä¸­å­—ç¬¦ä¸²çš„å‡ºç°æ¬¡æ•°ç½®ä¸º 1ã€‚</p><p>æœ€åä¾ç„¶ä½¿ç”¨<strong>å°é¡¶å †</strong>æ¥å¯¹å­—ç¬¦ä¸²çš„å‡ºç°æ¬¡æ•°è¿›è¡Œæ’åºã€‚</p><h3 id="11ã€çº¢åŒ…ç®—æ³•"><a href="#11ã€çº¢åŒ…ç®—æ³•" class="headerlink" title="11ã€çº¢åŒ…ç®—æ³•"></a>11ã€çº¢åŒ…ç®—æ³•</h3><p>çº¿æ€§åˆ‡å‰²æ³•ï¼Œä¸€ä¸ªåŒºé—´åˆ‡N-1åˆ€ã€‚è¶Šæ—©è¶Šå¤š</p><p>äºŒå€å‡å€¼æ³•ï¼Œã€0 ~ å‰©ä½™é‡‘é¢ &#x2F; å‰©ä½™äººæ•° * 2ã€‘ä¸­éšæœºï¼Œç›¸å¯¹å‡åŒ€</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1goqpbvl5pvj30qu0gcgm0.jpg" alt="img"></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1goqpc3hz9dj31450ggq8k.jpg" alt="img"></p><h3 id="11ã€æ‰‹å†™å¿«æ’"><a href="#11ã€æ‰‹å†™å¿«æ’" class="headerlink" title="11ã€æ‰‹å†™å¿«æ’"></a>11ã€æ‰‹å†™å¿«æ’</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QuickSort</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> arr[i];</span><br><span class="line">arr[i] = arr[j];</span><br><span class="line">arr[j] = tmp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* å¸¸è§„å¿«æ’ */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">quickSort1</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> L , <span class="type">int</span> R)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (L &gt; R)  <span class="keyword">return</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">M</span> <span class="operator">=</span> partition(arr, L, R);</span><br><span class="line">quickSort1(arr, L, M - <span class="number">1</span>);</span><br><span class="line">quickSort1(arr, M + <span class="number">1</span>, R);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">partition</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> L, <span class="type">int</span> R)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (L &gt; R) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span> (L == R) <span class="keyword">return</span> L;</span><br><span class="line"><span class="type">int</span> <span class="variable">lessEqual</span> <span class="operator">=</span> L - <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> L;</span><br><span class="line"><span class="keyword">while</span> (index &lt; R) &#123;</span><br><span class="line"><span class="keyword">if</span> (arr[index] &lt;= arr[R])</span><br><span class="line">swap(arr, index, ++lessEqual);</span><br><span class="line">index++;</span><br><span class="line">&#125;</span><br><span class="line">swap(arr, ++lessEqual, R);</span><br><span class="line"><span class="keyword">return</span> lessEqual;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* è·å…°å›½æ—— */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">quickSort2</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> L, <span class="type">int</span> R)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (L &gt; R)  <span class="keyword">return</span>;</span><br><span class="line"><span class="type">int</span>[] equalArea = netherlandsFlag(arr, L, R);</span><br><span class="line">quickSort2(arr, L, equalArea[<span class="number">0</span>] - <span class="number">1</span>);</span><br><span class="line">quickSort2(arr, equalArea[<span class="number">1</span>] + <span class="number">1</span>, R);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] netherlandsFlag(<span class="type">int</span>[] arr, <span class="type">int</span> L, <span class="type">int</span> R) &#123;</span><br><span class="line"><span class="keyword">if</span> (L &gt; R) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[] &#123; -<span class="number">1</span>, -<span class="number">1</span> &#125;;</span><br><span class="line"><span class="keyword">if</span> (L == R) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[] &#123; L, R &#125;;</span><br><span class="line"><span class="type">int</span> <span class="variable">less</span> <span class="operator">=</span> L - <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">more</span> <span class="operator">=</span> R;</span><br><span class="line"><span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> L;</span><br><span class="line"><span class="keyword">while</span> (index &lt; more) &#123;</span><br><span class="line"><span class="keyword">if</span> (arr[index] == arr[R]) &#123;</span><br><span class="line">index++;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (arr[index] &lt; arr[R]) &#123;</span><br><span class="line">swap(arr, index++, ++less);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">swap(arr, index, --more);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">swap(arr, more, R);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[] &#123; less + <span class="number">1</span>, more &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// for test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">testTime</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">maxSize</span> <span class="operator">=</span> <span class="number">10000000</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">maxValue</span> <span class="operator">=</span> <span class="number">100000</span>;</span><br><span class="line"><span class="type">boolean</span> <span class="variable">succeed</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"><span class="type">long</span> T1=<span class="number">0</span>,T2=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; testTime; i++) &#123;</span><br><span class="line"><span class="type">int</span>[] arr1 = generateRandomArray(maxSize, maxValue);</span><br><span class="line"><span class="type">int</span>[] arr2 = copyArray(arr1);</span><br><span class="line"><span class="type">int</span>[] arr3 = copyArray(arr1);</span><br><span class="line"><span class="comment">//int[] arr1 = &#123;9,8,7,6,5,4,3,2,1&#125;;</span></span><br><span class="line"><span class="type">long</span> <span class="variable">t1</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">quickSort1(arr1,<span class="number">0</span>,arr1.length-<span class="number">1</span>);</span><br><span class="line"><span class="type">long</span> <span class="variable">t2</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">quickSort2(arr2,<span class="number">0</span>,arr2.length-<span class="number">1</span>);</span><br><span class="line"><span class="type">long</span> <span class="variable">t3</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">T1 += (t2-t1);</span><br><span class="line">T2 += (t3-t2);</span><br><span class="line"><span class="keyword">if</span> (!isEqual(arr1, arr2) || !isEqual(arr2, arr3)) &#123;</span><br><span class="line">succeed = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(T1+<span class="string">&quot; &quot;</span>+T2);</span><br><span class="line"><span class="comment">//System.out.println(succeed ? &quot;Nice!&quot; : &quot;Oops!&quot;);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span>[] generateRandomArray(<span class="type">int</span> maxSize, <span class="type">int</span> maxValue) &#123;</span><br><span class="line"><span class="type">int</span>[] arr = <span class="keyword">new</span> <span class="title class_">int</span>[(<span class="type">int</span>) ((maxSize + <span class="number">1</span>) * Math.random())];</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">arr[i] = (<span class="type">int</span>) ((maxValue + <span class="number">1</span>) * Math.random()) </span><br><span class="line">                - (<span class="type">int</span>) (maxValue * Math.random());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span>[] copyArray(<span class="type">int</span>[] arr) &#123;</span><br><span class="line"><span class="keyword">if</span> (arr == <span class="literal">null</span>)  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"><span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[arr.length];</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">res[i] = arr[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isEqual</span><span class="params">(<span class="type">int</span>[] arr1, <span class="type">int</span>[] arr2)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> ((arr1 == <span class="literal">null</span> &amp;&amp; arr2 != <span class="literal">null</span>) || (arr1 != <span class="literal">null</span> &amp;&amp; arr2 == <span class="literal">null</span>)) </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span> (arr1 == <span class="literal">null</span> &amp;&amp; arr2 == <span class="literal">null</span>) </span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">if</span> (arr1.length != arr2.length) </span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr1.length; i++)</span><br><span class="line"><span class="keyword">if</span> (arr1[i] != arr2[i])</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">printArray</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (arr == <span class="literal">null</span>) </span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++) </span><br><span class="line">System.out.print(arr[i] + <span class="string">&quot; &quot;</span>);</span><br><span class="line">System.out.println();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="12ã€æ‰‹å†™å½’å¹¶"><a href="#12ã€æ‰‹å†™å½’å¹¶" class="headerlink" title="12ã€æ‰‹å†™å½’å¹¶"></a>12ã€æ‰‹å†™å½’å¹¶</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">merge</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> L, <span class="type">int</span> M, <span class="type">int</span> R)</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] help = <span class="keyword">new</span> <span class="title class_">int</span>[R - L + <span class="number">1</span>];</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">p1</span> <span class="operator">=</span> L;</span><br><span class="line">    <span class="type">int</span> <span class="variable">p2</span> <span class="operator">=</span> M + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (p1 &lt;= M &amp;&amp; p2 &lt;= R)</span><br><span class="line">        help[i++] = arr[p1] &lt;= arr[p2] ? arr[p1++] : arr[p2++];</span><br><span class="line">    <span class="keyword">while</span> (p1 &lt;= M)</span><br><span class="line">        help[i++] = arr[p1++];</span><br><span class="line">    <span class="keyword">while</span> (p2 &lt;= R)</span><br><span class="line">        help[i++] = arr[p2++];</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; help.length; i++)</span><br><span class="line">        arr[L + i] = help[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">mergeSort</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> L, <span class="type">int</span> R)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (L == R)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> L + ((R - L) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">    process(arr, L, mid);</span><br><span class="line">    process(arr, mid + <span class="number">1</span>, R);</span><br><span class="line">    merge(arr, L, mid, R);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] arr1 = &#123;<span class="number">9</span>,<span class="number">8</span>,<span class="number">7</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>&#125;;</span><br><span class="line">    mergeSort(arr, <span class="number">0</span>, arr.length - <span class="number">1</span>);</span><br><span class="line">    printArray(arr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="13ã€æ‰‹å†™å †æ’"><a href="#13ã€æ‰‹å†™å †æ’" class="headerlink" title="13ã€æ‰‹å†™å †æ’"></a>13ã€æ‰‹å†™å †æ’</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å †æ’åºé¢å¤–ç©ºé—´å¤æ‚åº¦O(1)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">heapSort</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (arr == <span class="literal">null</span> || arr.length &lt; <span class="number">2</span>) </span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> arr.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) </span><br><span class="line">        heapify(arr, i, arr.length);</span><br><span class="line">    <span class="type">int</span> <span class="variable">heapSize</span> <span class="operator">=</span> arr.length;</span><br><span class="line">    swap(arr, <span class="number">0</span>, --heapSize);</span><br><span class="line">    <span class="comment">// O(N*logN)</span></span><br><span class="line">    <span class="keyword">while</span> (heapSize &gt; <span class="number">0</span>) &#123; <span class="comment">// O(N)</span></span><br><span class="line">        heapify(arr, <span class="number">0</span>, heapSize); <span class="comment">// O(logN)</span></span><br><span class="line">        swap(arr, <span class="number">0</span>, --heapSize); <span class="comment">// O(1)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// arr[index]åˆšæ¥çš„æ•°ï¼Œå¾€ä¸Š</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">heapInsert</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> index)</span> &#123;</span><br><span class="line">    <span class="keyword">while</span> (arr[index] &gt; arr[(index - <span class="number">1</span>) / <span class="number">2</span>]) &#123;</span><br><span class="line">        swap(arr, index, (index - <span class="number">1</span>) / <span class="number">2</span>);</span><br><span class="line">        index = (index - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// arr[index]ä½ç½®çš„æ•°ï¼Œèƒ½å¦å¾€ä¸‹ç§»åŠ¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">heapify</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> index, <span class="type">int</span> heapSize)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> index * <span class="number">2</span> + <span class="number">1</span>; <span class="comment">// å·¦å­©å­çš„ä¸‹æ ‡</span></span><br><span class="line">    <span class="keyword">while</span> (left &lt; heapSize) &#123; <span class="comment">// ä¸‹æ–¹è¿˜æœ‰å­©å­çš„æ—¶å€™</span></span><br><span class="line">        <span class="comment">// ä¸¤ä¸ªå­©å­ä¸­ï¼Œè°çš„å€¼å¤§ï¼ŒæŠŠä¸‹æ ‡ç»™largest</span></span><br><span class="line">        <span class="comment">// 1ï¼‰åªæœ‰å·¦å­©å­ï¼Œleft -&gt; largest</span></span><br><span class="line">        <span class="comment">// 2) åŒæ—¶æœ‰å·¦å­©å­å’Œå³å­©å­ï¼Œå³å­©å­çš„å€¼&lt;= å·¦å­©å­çš„å€¼ï¼Œleft -&gt; largest</span></span><br><span class="line">        <span class="comment">// 3) åŒæ—¶æœ‰å·¦å­©å­å’Œå³å­©å­å¹¶ä¸”å³å­©å­çš„å€¼&gt; å·¦å­©å­çš„å€¼ï¼Œ right -&gt; largest</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">largest</span> <span class="operator">=</span> left+<span class="number">1</span> &lt; heapSize &amp;&amp; arr[left+<span class="number">1</span>]&gt; arr[left] ? left+<span class="number">1</span> : left;</span><br><span class="line">        <span class="comment">// çˆ¶å’Œè¾ƒå¤§çš„å­©å­ä¹‹é—´ï¼Œè°çš„å€¼å¤§ï¼ŒæŠŠä¸‹æ ‡ç»™largest</span></span><br><span class="line">        largest = arr[largest] &gt; arr[index] ? largest : index;</span><br><span class="line">        <span class="keyword">if</span> (largest == index)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        swap(arr, largest, index);</span><br><span class="line">        index = largest;</span><br><span class="line">        left = index * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> arr[i];</span><br><span class="line">    arr[i] = arr[j];</span><br><span class="line">    arr[j] = tmp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] arr1 = &#123;<span class="number">9</span>,<span class="number">8</span>,<span class="number">7</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>&#125;;</span><br><span class="line">    heapSort(arr1);</span><br><span class="line">    printArray(arr1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="14ã€æ‰‹å†™å•ä¾‹"><a href="#14ã€æ‰‹å†™å•ä¾‹" class="headerlink" title="14ã€æ‰‹å†™å•ä¾‹"></a>14ã€æ‰‹å†™å•ä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Singleton singleton;</span><br><span class="line"><span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (singleton == <span class="literal">null</span>) &#123;</span><br><span class="line">          <span class="keyword">synchronized</span> (Singleton.class) &#123;</span><br><span class="line">            <span class="keyword">if</span> (singleton == <span class="literal">null</span>) &#123;</span><br><span class="line">              singleton = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> singleton;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="15ã€æ‰‹å†™LRUcache"><a href="#15ã€æ‰‹å†™LRUcache" class="headerlink" title="15ã€æ‰‹å†™LRUcache"></a>15ã€æ‰‹å†™LRUcache</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŸºäºlinkedHashMap</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LRUCache</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> LinkedHashMap&lt;Integer,Integer&gt; cache;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> capacity;   <span class="comment">//å®¹é‡å¤§å°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LRUCache</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        cache = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;(capacity);</span><br><span class="line">        <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">        <span class="comment">//ç¼“å­˜ä¸­ä¸å­˜åœ¨æ­¤keyï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span>(!cache.containsKey(key)) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> cache.get(key);</span><br><span class="line">        cache.remove(key);   <span class="comment">//å…ˆä»é“¾è¡¨ä¸­åˆ é™¤</span></span><br><span class="line">        cache.put(key,res);  <span class="comment">//å†æŠŠè¯¥èŠ‚ç‚¹æ”¾åˆ°é“¾è¡¨æœ«å°¾å¤„</span></span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(<span class="type">int</span> key,<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(cache.containsKey(key)) &#123;</span><br><span class="line">            cache.remove(key); <span class="comment">//å·²ç»å­˜åœ¨ï¼Œåœ¨å½“å‰é“¾è¡¨ç§»é™¤</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(capacity == cache.size()) &#123;</span><br><span class="line">            <span class="comment">//cacheå·²æ»¡ï¼Œåˆ é™¤é“¾è¡¨å¤´ä½ç½®</span></span><br><span class="line">            Set&lt;Integer&gt; keySet = cache.keySet();</span><br><span class="line">            Iterator&lt;Integer&gt; iterator = keySet.iterator();</span><br><span class="line">            cache.remove(iterator.next());</span><br><span class="line">        &#125;</span><br><span class="line">        cache.put(key,value);  <span class="comment">//æ’å…¥åˆ°é“¾è¡¨æœ«å°¾</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ‰‹å†™åŒå‘é“¾è¡¨</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LRUCache</span> &#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">DNode</span> &#123;</span><br><span class="line">        DNode prev;</span><br><span class="line">        DNode next;</span><br><span class="line">        <span class="type">int</span> val;</span><br><span class="line">        <span class="type">int</span> key;</span><br><span class="line">    &#125;</span><br><span class="line">    Map&lt;Integer, DNode&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    DNode head, tail;</span><br><span class="line">    <span class="type">int</span> cap;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LRUCache</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        head = <span class="keyword">new</span> <span class="title class_">DNode</span>();</span><br><span class="line">        tail = <span class="keyword">new</span> <span class="title class_">DNode</span>();</span><br><span class="line">        head.next = tail;</span><br><span class="line">        tail.prev = head;</span><br><span class="line">        cap = capacity;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (map.containsKey(key)) &#123;</span><br><span class="line">            <span class="type">DNode</span> <span class="variable">node</span> <span class="operator">=</span> map.get(key);</span><br><span class="line">            removeNode(node);</span><br><span class="line">            addToHead(node);</span><br><span class="line">            <span class="keyword">return</span> node.val;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(<span class="type">int</span> key, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (map.containsKey(key)) &#123;</span><br><span class="line">            <span class="type">DNode</span> <span class="variable">node</span> <span class="operator">=</span> map.get(key);</span><br><span class="line">            node.val = value;</span><br><span class="line">            removeNode(node);</span><br><span class="line">            addToHead(node);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">DNode</span> <span class="variable">newNode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DNode</span>();</span><br><span class="line">            newNode.val = value;</span><br><span class="line">            newNode.key = key;</span><br><span class="line">            addToHead(newNode);</span><br><span class="line">            map.put(key, newNode);</span><br><span class="line">            <span class="keyword">if</span> (map.size() &gt; cap) &#123;</span><br><span class="line">                map.remove(tail.prev.key);</span><br><span class="line">                removeNode(tail.prev);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeNode</span><span class="params">(DNode node)</span> &#123;</span><br><span class="line">        <span class="type">DNode</span> <span class="variable">prevNode</span> <span class="operator">=</span> node.prev;</span><br><span class="line">        <span class="type">DNode</span> <span class="variable">nextNode</span> <span class="operator">=</span> node.next;</span><br><span class="line">        prevNode.next = nextNode;</span><br><span class="line">        nextNode.prev = prevNode;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addToHead</span><span class="params">(DNode node)</span> &#123;</span><br><span class="line">        <span class="type">DNode</span> <span class="variable">firstNode</span> <span class="operator">=</span> head.next;</span><br><span class="line">        head.next = node;</span><br><span class="line">        node.prev = head;</span><br><span class="line">        node.next = firstNode;</span><br><span class="line">        firstNode.prev = node;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="16ã€æ‰‹å†™çº¿ç¨‹æ± "><a href="#16ã€æ‰‹å†™çº¿ç¨‹æ± " class="headerlink" title="16ã€æ‰‹å†™çº¿ç¨‹æ± "></a><strong>16ã€æ‰‹å†™çº¿ç¨‹æ± </strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.concurrent.pool;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ArrayBlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.BlockingQueue;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MySelfThreadPool</span> &#123;</span><br><span class="line"><span class="comment">//é»˜è®¤çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹çš„æ•°é‡</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">WORK_NUM</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line"><span class="comment">//é»˜è®¤å¤„ç†ä»»åŠ¡çš„æ•°é‡</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">TASK_NUM</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> workNum;<span class="comment">//çº¿ç¨‹æ•°é‡</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> taskNum;<span class="comment">//ä»»åŠ¡æ•°é‡</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Set&lt;WorkThread&gt; workThreads;<span class="comment">//ä¿å­˜çº¿ç¨‹çš„é›†åˆ</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> BlockingQueue&lt;Runnable&gt; taskQueue;<span class="comment">//é˜»å¡æœ‰åºé˜Ÿåˆ—å­˜æ”¾ä»»åŠ¡</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">MySelfThreadPool</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="built_in">this</span>(WORK_NUM, TASK_NUM);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="title function_">MySelfThreadPool</span><span class="params">(<span class="type">int</span> workNum, <span class="type">int</span> taskNum)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (workNum &lt;= <span class="number">0</span>) workNum = WORK_NUM;</span><br><span class="line"><span class="keyword">if</span> (taskNum &lt;= <span class="number">0</span>) taskNum = TASK_NUM;</span><br><span class="line">taskQueue = <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(taskNum);</span><br><span class="line"><span class="built_in">this</span>.workNum = workNum;</span><br><span class="line"><span class="built_in">this</span>.taskNum = taskNum;</span><br><span class="line">workThreads = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line"><span class="comment">//å¯åŠ¨ä¸€å®šæ•°é‡çš„çº¿ç¨‹æ•°ï¼Œä»é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡å¤„ç†</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;workNum;i++) &#123;</span><br><span class="line"><span class="type">WorkThread</span> <span class="variable">workThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WorkThread</span>(<span class="string">&quot;thead_&quot;</span>+i);</span><br><span class="line">workThread.start();</span><br><span class="line">workThreads.add(workThread);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(Runnable task)</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">taskQueue.put(task);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;ready close thread pool...&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (workThreads == <span class="literal">null</span> || workThreads.isEmpty()) <span class="keyword">return</span> ;</span><br><span class="line"><span class="keyword">for</span> (WorkThread workThread : workThreads) &#123;</span><br><span class="line">workThread.stopWork();</span><br><span class="line">workThread = <span class="literal">null</span>;<span class="comment">//help gc</span></span><br><span class="line">&#125;</span><br><span class="line">workThreads.clear();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">WorkThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="title function_">WorkThread</span><span class="params">(String name)</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line">setName(name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">while</span> (!interrupted()) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="type">Runnable</span> <span class="variable">runnable</span> <span class="operator">=</span> taskQueue.take();<span class="comment">//è·å–ä»»åŠ¡</span></span><br><span class="line"><span class="keyword">if</span> (runnable !=<span class="literal">null</span>) &#123;</span><br><span class="line">System.out.println(getName()+<span class="string">&quot; readyexecute:&quot;</span>+runnable.toString());</span><br><span class="line">runnable.run();<span class="comment">//æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">&#125;</span><br><span class="line">runnable = <span class="literal">null</span>;<span class="comment">//help gc</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">interrupt();</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stopWork</span><span class="params">()</span> &#123;</span><br><span class="line">interrupt();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.concurrent.pool;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestMySelfThreadPool</span> &#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">TASK_NUM</span> <span class="operator">=</span> <span class="number">50</span>;<span class="comment">//ä»»åŠ¡çš„ä¸ªæ•°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">MySelfThreadPool</span> <span class="variable">myPool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MySelfThreadPool</span>(<span class="number">3</span>,<span class="number">50</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;TASK_NUM;i++) &#123;</span><br><span class="line">myPool.execute(<span class="keyword">new</span> <span class="title class_">MyTask</span>(<span class="string">&quot;task_&quot;</span>+i));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyTask</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="keyword">public</span> <span class="title function_">MyTask</span><span class="params">(String name)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">&quot;task :&quot;</span>+name+<span class="string">&quot; end...&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;name = &quot;</span>+name;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="17ã€æ‰‹å†™æ¶ˆè´¹è€…ç”Ÿäº§è€…æ¨¡å¼"><a href="#17ã€æ‰‹å†™æ¶ˆè´¹è€…ç”Ÿäº§è€…æ¨¡å¼" class="headerlink" title="17ã€æ‰‹å†™æ¶ˆè´¹è€…ç”Ÿäº§è€…æ¨¡å¼"></a><strong>17ã€æ‰‹å†™æ¶ˆè´¹è€…ç”Ÿäº§è€…æ¨¡å¼</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Storage</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">MAX_VALUE</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Object&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">produce</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (list) &#123;</span><br><span class="line">            <span class="keyword">while</span> (list.size() + num &gt; MAX_VALUE) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;æš‚æ—¶ä¸èƒ½æ‰§è¡Œç”Ÿäº§ä»»åŠ¡&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    list.wait();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; num; i++) &#123;</span><br><span class="line">                list.add(<span class="keyword">new</span> <span class="title class_">Object</span>());</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;å·²ç”Ÿäº§äº§å“æ•°&quot;</span>+num+<span class="string">&quot; ä»“åº“å®¹é‡&quot;</span>+list.size());</span><br><span class="line">            list.notifyAll();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">consume</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (list) &#123;</span><br><span class="line">            <span class="keyword">while</span> (list.size() &lt; num) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;æš‚æ—¶ä¸èƒ½æ‰§è¡Œæ¶ˆè´¹ä»»åŠ¡&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    list.wait();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; num; i++) &#123;</span><br><span class="line">                list.remove(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;å·²æ¶ˆè´¹äº§å“æ•°&quot;</span>+num+<span class="string">&quot; ä»“åº“å®¹é‡&quot;</span> + list.size());</span><br><span class="line">            list.notifyAll();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Producer</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> num;</span><br><span class="line">    <span class="keyword">private</span> Storage storage;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Producer</span><span class="params">(Storage storage)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.storage = storage;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNum</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.num = num;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        storage.produce(<span class="built_in">this</span>.num);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Customer</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> num;</span><br><span class="line">    <span class="keyword">private</span> Storage storage;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Customer</span><span class="params">(Storage storage)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.storage = storage;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNum</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.num = num;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        storage.consume(<span class="built_in">this</span>.num);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Storage</span> <span class="variable">storage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Storage</span>();</span><br><span class="line">        <span class="type">Producer</span> <span class="variable">p1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Producer</span>(storage);</span><br><span class="line">        <span class="type">Producer</span> <span class="variable">p2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Producer</span>(storage);</span><br><span class="line">        <span class="type">Producer</span> <span class="variable">p3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Producer</span>(storage);</span><br><span class="line">        <span class="type">Producer</span> <span class="variable">p4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Producer</span>(storage);</span><br><span class="line">        <span class="type">Customer</span> <span class="variable">c1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Customer</span>(storage);</span><br><span class="line">        <span class="type">Customer</span> <span class="variable">c2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Customer</span>(storage);</span><br><span class="line">        <span class="type">Customer</span> <span class="variable">c3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Customer</span>(storage);</span><br><span class="line">        p1.setNum(<span class="number">10</span>);</span><br><span class="line">        p2.setNum(<span class="number">20</span>);</span><br><span class="line">        p3.setNum(<span class="number">80</span>);</span><br><span class="line">        c1.setNum(<span class="number">50</span>);</span><br><span class="line">        c2.setNum(<span class="number">20</span>);</span><br><span class="line">        c3.setNum(<span class="number">20</span>);</span><br><span class="line">        c1.start();</span><br><span class="line">        c2.start();</span><br><span class="line">        c3.start();</span><br><span class="line">        p1.start();</span><br><span class="line">        p2.start();</span><br><span class="line">        p3.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="18ã€æ‰‹å†™é˜»å¡é˜Ÿåˆ—"><a href="#18ã€æ‰‹å†™é˜»å¡é˜Ÿåˆ—" class="headerlink" title="18ã€æ‰‹å†™é˜»å¡é˜Ÿåˆ—"></a><strong>18ã€æ‰‹å†™é˜»å¡é˜Ÿåˆ—</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">blockQueue</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Integer&gt; container = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">int</span> size;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">int</span> capacity;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Condition</span> <span class="variable">isNull</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Condition</span> <span class="variable">isFull</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    blockQueue(<span class="type">int</span> capacity) &#123;</span><br><span class="line">        <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> data)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">while</span> (size &gt;= capacity) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;é˜»å¡é˜Ÿåˆ—æ»¡äº†&quot;</span>);</span><br><span class="line">                    isFull.await();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                isFull.signal();</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            ++size;</span><br><span class="line">            container.add(data);</span><br><span class="line">            isNull.signal();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">take</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">while</span> (size == <span class="number">0</span>) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;é˜»å¡é˜Ÿåˆ—ç©ºäº†&quot;</span>);</span><br><span class="line">                    isNull.await();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                isNull.signal();</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            --size;</span><br><span class="line">            <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> container.get(<span class="number">0</span>);</span><br><span class="line">            container.remove(<span class="number">0</span>);</span><br><span class="line">            isFull.signal();</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">AxinBlockQueue</span> <span class="variable">queue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AxinBlockQueue</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            queue.add(i);</span><br><span class="line">            System.out.println(<span class="string">&quot;å¡å…¥&quot;</span> + i);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">500</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">for</span> (; ; ) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¶ˆè´¹&quot;</span>+queue.take());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">800</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">    t1.start();</span><br><span class="line">    t2.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="19ã€æ‰‹å†™å¤šçº¿ç¨‹äº¤æ›¿æ‰“å°ABC"><a href="#19ã€æ‰‹å†™å¤šçº¿ç¨‹äº¤æ›¿æ‰“å°ABC" class="headerlink" title="19ã€æ‰‹å†™å¤šçº¿ç¨‹äº¤æ›¿æ‰“å°ABC"></a><strong>19ã€æ‰‹å†™å¤šçº¿ç¨‹äº¤æ›¿æ‰“å°ABC</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.demo.test;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">syncPrinter</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="comment">// æ‰“å°æ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">PRINT_COUNT</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ReentrantLock reentrantLock;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Condition thisCondtion;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Condition nextCondtion;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">char</span> printChar;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">syncPrinter</span><span class="params">(ReentrantLock reentrantLock, Condition thisCondtion, Condition nextCondition, <span class="type">char</span> printChar)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.reentrantLock = reentrantLock;</span><br><span class="line">        <span class="built_in">this</span>.nextCondtion = nextCondition;</span><br><span class="line">        <span class="built_in">this</span>.thisCondtion = thisCondtion;</span><br><span class="line">        <span class="built_in">this</span>.printChar = printChar;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–æ‰“å°é” è¿›å…¥ä¸´ç•ŒåŒº</span></span><br><span class="line">        reentrantLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// è¿ç»­æ‰“å°PRINT_COUNTæ¬¡</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; PRINT_COUNT; i++) &#123;</span><br><span class="line">                <span class="comment">//æ‰“å°å­—ç¬¦</span></span><br><span class="line">                System.out.print(printChar);</span><br><span class="line">                <span class="comment">// ä½¿ç”¨nextConditionå”¤é†’ä¸‹ä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line">                <span class="comment">// å› ä¸ºåªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨ç­‰å¾…ï¼Œæ‰€ä»¥signalæˆ–è€…signalAlléƒ½å¯ä»¥</span></span><br><span class="line">                nextCondtion.signal();</span><br><span class="line">                <span class="comment">// ä¸æ˜¯æœ€åä¸€æ¬¡åˆ™é€šè¿‡thisCondtionç­‰å¾…è¢«å”¤é†’</span></span><br><span class="line">                <span class="comment">// å¿…é¡»è¦åŠ åˆ¤æ–­ï¼Œä¸ç„¶è™½ç„¶èƒ½å¤Ÿæ‰“å°10æ¬¡ï¼Œä½†10æ¬¡åå°±ä¼šç›´æ¥æ­»é”</span></span><br><span class="line">                <span class="keyword">if</span> (i &lt; PRINT_COUNT - <span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="comment">// æœ¬çº¿ç¨‹è®©å‡ºé”å¹¶ç­‰å¾…å”¤é†’</span></span><br><span class="line">                        thisCondtion.await();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            reentrantLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">        <span class="type">Condition</span> <span class="variable">conditionA</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">        <span class="type">Condition</span> <span class="variable">conditionB</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">        <span class="type">Condition</span> <span class="variable">conditionC</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">printA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">syncPrinter</span>(lock, conditionA, conditionB,<span class="string">&#x27;A&#x27;</span>));</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">printB</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">syncPrinter</span>(lock, conditionB, conditionC,<span class="string">&#x27;B&#x27;</span>));</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">printC</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">syncPrinter</span>(lock, conditionC, conditionA,<span class="string">&#x27;C&#x27;</span>));</span><br><span class="line">        printA.start();</span><br><span class="line">        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        printB.start();</span><br><span class="line">        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        printC.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="20ã€äº¤æ›¿æ‰“å°FooBar"><a href="#20ã€äº¤æ›¿æ‰“å°FooBar" class="headerlink" title="20ã€äº¤æ›¿æ‰“å°FooBar"></a>20ã€äº¤æ›¿æ‰“å°FooBar</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ‰‹å¤ªé˜´è‚ºç» BLOCKING Queue</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FooBar</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> n;</span><br><span class="line">    <span class="keyword">private</span> BlockingQueue&lt;Integer&gt; bar = <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;&gt;(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">private</span> BlockingQueue&lt;Integer&gt; foo = <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;&gt;(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FooBar</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.n = n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">(Runnable printFoo)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            foo.put(i);</span><br><span class="line">            printFoo.run();</span><br><span class="line">            bar.put(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bar</span><span class="params">(Runnable printBar)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            bar.take();</span><br><span class="line">            printBar.run();</span><br><span class="line">            foo.take();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰‹é˜³æ˜å¤§è‚ ç»CyclicBarrier æ§åˆ¶å…ˆå</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FooBar6</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> n;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FooBar6</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.n = n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">CyclicBarrier</span> <span class="variable">cb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CyclicBarrier</span>(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">fin</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">(Runnable printFoo)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">while</span>(!fin);</span><br><span class="line">            printFoo.run();</span><br><span class="line">            fin = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                cb.await();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (BrokenBarrierException e) &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bar</span><span class="params">(Runnable printBar)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                cb.await();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (BrokenBarrierException e) &#123;&#125;</span><br><span class="line">            printBar.run();</span><br><span class="line">            fin = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰‹å°‘é˜´å¿ƒç» è‡ªæ—‹ + è®©å‡ºCPU</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FooBar5</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> n;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FooBar5</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.n = n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">permitFoo</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">(Runnable printFoo)</span> <span class="keyword">throws</span> InterruptedException &#123;     </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; ) &#123;</span><br><span class="line">            <span class="keyword">if</span>(permitFoo) &#123;</span><br><span class="line">            printFoo.run();</span><br><span class="line">            i++;</span><br><span class="line">            permitFoo = <span class="literal">false</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                Thread.<span class="keyword">yield</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bar</span><span class="params">(Runnable printBar)</span> <span class="keyword">throws</span> InterruptedException &#123;       </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; ) &#123;</span><br><span class="line">            <span class="keyword">if</span>(!permitFoo) &#123;</span><br><span class="line">        printBar.run();</span><br><span class="line">        i++;</span><br><span class="line">        permitFoo = <span class="literal">true</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                Thread.<span class="keyword">yield</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰‹å°‘é˜³ä¸‰ç„¦ç» å¯é‡å…¥é” + Condition</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FooBar4</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> n;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FooBar4</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.n = n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>(<span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Condition</span> <span class="variable">foo</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">(Runnable printFoo)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span>(!flag) &#123;</span><br><span class="line">                    foo.await();</span><br><span class="line">                &#125;</span><br><span class="line">                printFoo.run();</span><br><span class="line">                flag = <span class="literal">false</span>;</span><br><span class="line">                foo.signal();</span><br><span class="line">            &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bar</span><span class="params">(Runnable printBar)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n;i++) &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span>(flag) &#123;</span><br><span class="line">                    foo.await();</span><br><span class="line">            &#125;</span><br><span class="line">                printBar.run();</span><br><span class="line">                flag = <span class="literal">true</span>;</span><br><span class="line">                foo.signal();</span><br><span class="line">            &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰‹å¥é˜´å¿ƒåŒ…ç» synchronized + æ ‡å¿—ä½ + å”¤é†’</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FooBar3</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> n;</span><br><span class="line">    <span class="comment">// æ ‡å¿—ä½ï¼Œæ§åˆ¶æ‰§è¡Œé¡ºåºï¼Œtrueæ‰§è¡ŒprintFooï¼Œfalseæ‰§è¡ŒprintBar</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">type</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object foo=  <span class="keyword">new</span> <span class="title class_">Object</span>(); <span class="comment">// é”æ ‡å¿—</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FooBar3</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.n = n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">(Runnable printFoo)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (foo) &#123;</span><br><span class="line">                <span class="keyword">while</span>(!type)&#123;</span><br><span class="line">                    foo.wait();</span><br><span class="line">                &#125;</span><br><span class="line">                printFoo.run();</span><br><span class="line">                type = <span class="literal">false</span>;</span><br><span class="line">                foo.notifyAll();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bar</span><span class="params">(Runnable printBar)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (foo) &#123;</span><br><span class="line">                <span class="keyword">while</span>(type)&#123;</span><br><span class="line">                    foo.wait();</span><br><span class="line">                &#125;</span><br><span class="line">                printBar.run();</span><br><span class="line">                type = <span class="literal">true</span>;</span><br><span class="line">                foo.notifyAll();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰‹å¤ªé˜³å°è‚ ç» ä¿¡å·é‡ é€‚åˆæ§åˆ¶é¡ºåº</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FooBar2</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> n;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Semaphore</span> <span class="variable">foo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Semaphore</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Semaphore</span> <span class="variable">bar</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Semaphore</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FooBar2</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.n = n;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">(Runnable printFoo)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            foo.acquire();</span><br><span class="line">        printFoo.run();</span><br><span class="line">            bar.release();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bar</span><span class="params">(Runnable printBar)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            bar.acquire();</span><br><span class="line">        printBar.run();</span><br><span class="line">            foo.release();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="å…­ã€ä¸ªäººé¡¹ç›®"><a href="#å…­ã€ä¸ªäººé¡¹ç›®" class="headerlink" title="å…­ã€ä¸ªäººé¡¹ç›®"></a><strong>å…­ã€ä¸ªäººé¡¹ç›®</strong></h1><h2 id="ä¸€ã€ä¸€ç«™åˆ°åº•"><a href="#ä¸€ã€ä¸€ç«™åˆ°åº•" class="headerlink" title="ä¸€ã€ä¸€ç«™åˆ°åº•"></a><strong>ä¸€ã€ä¸€ç«™åˆ°åº•</strong></h2><p>â€‹é‡‡ç”¨SpringBootæ„å»ºé¡¹ç›®ï¼Œä¸»è¦é€šè¿‡åˆ†å¸ƒå¼ç¼“å­˜ã€é˜Ÿåˆ—ã€é™æµä¿è¯ç³»ç»Ÿé«˜å¯ç”¨ï¼ŒNettyã€ç¼“å­˜ã€åå‘ä»£ç†ä¿è¯é«˜å¹¶å‘ã€‚</p><blockquote><p>åŒäººå¯¹æˆ˜ç­”é¢˜ã€å…¬å¸å¯¹æˆ˜æŠ¢ç­”</p></blockquote><h3 id="1ã€å¦‚ä½•è®¾è®¡æ’è¡Œæ¦œ"><a href="#1ã€å¦‚ä½•è®¾è®¡æ’è¡Œæ¦œ" class="headerlink" title="1ã€å¦‚ä½•è®¾è®¡æ’è¡Œæ¦œ"></a>1ã€å¦‚ä½•è®¾è®¡æ’è¡Œæ¦œ</h3><ul><li>ä¸ªäººæ€»å¾—åˆ†å’Œæ€»æ’åå®æ—¶æ›´æ–°</li><li>ä¸ªäººæ’è¡Œæ¦œæŒ‰åˆ†æ•°ã€æ—¶é—´ã€æ¬¡æ•°ã€æ­£ç¡®ç‡å±•ç¤º</li><li>æ—¥æ¦œã€è¿‡å»Næ—¥æ¦œæ»šåŠ¨æ›´æ–°</li></ul><h4 id="æ€§èƒ½ä¼˜åŒ–è¿‡ç¨‹"><a href="#æ€§èƒ½ä¼˜åŒ–è¿‡ç¨‹" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–è¿‡ç¨‹"></a>æ€§èƒ½ä¼˜åŒ–è¿‡ç¨‹</h4><p>â€‹ç¬¬ä¸€æ¡éœ€æ±‚å¾ˆç®€å•ï¼Œä½¿ç”¨äº†Redisçš„<strong>Zset</strong>å®ç°ä¸è¿‡è¿™é‡Œæ€»å¾—åˆ†é‡‡ç”¨äº†åŸºäº<strong>åˆ†æ•°ã€æ—¶é—´ã€æ¬¡æ•°å’Œæ­£ç¡®ç‡</strong>çš„æ··åˆåŠ æƒã€‚è€ƒè™‘åˆ°æ•°æ®çš„<strong>æŒä¹…åŒ–</strong>ï¼Œä»¥åŠ<strong>å…³ç³»æ•°æ®åº“å’Œç¼“å­˜çš„ä¸€è‡´æ€§</strong>å¯¼è‡´çš„è®¾è®¡çš„å¤æ‚æ€§ï¼Œä½¿ç”¨äº†<strong>è°·æ­Œ</strong>å¼€æºçš„<strong>JamsRanking</strong></p><p>â€‹ä¼˜ç‚¹<strong>æ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨ç°æˆçš„setScoreså’ŒgetRankingæ¥å£å°è£…äº†Rediså’ŒMysqlå’Œæ¶ˆæ¯é˜Ÿåˆ—çš„å®Œæˆ</strong>äº‹åŠ¡å’Œä¸€è‡´æ€§<strong>çš„ä½¿ç”¨ç»†èŠ‚ã€‚ç¼ºç‚¹æ˜¯</strong>å¹¶å‘æ¯”è¾ƒä½<strong>ä½¿ç”¨Jmeterè¿›è¡Œå‹æµ‹ï¼Œå•æœºåªæœ‰</strong>20<strong>å·¦å³çš„</strong>TPS**</p><p>â€‹åæ¥çœ‹äº†ä¸‹æºç ï¼Œä¸»è¦æ˜¯å®ƒé’ˆå¯¹æ¯ä¸€æ¬¡è®¾ç½®éƒ½è¿›è¡Œäº†åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†ï¼Œå¹¶ä¸”ä¼šè¿”å›äº‹åŠ¡æäº¤æˆ–å›æ»šçš„ç»“æœã€‚äº†è§£äº†åº•å±‚å®ç°ä»¥åå°±å»è°·æ­Œçš„<strong>å¼€æºç¤¾åŒº</strong>å»æŸ¥é˜…äº†ç›¸å…³çš„è§£å†³æ–¹æ¡ˆï¼Œå½“æ—¶å®˜æ–¹å¯¹è¿™ä¸ªé—®é¢˜å¹¶æ²¡æœ‰é€šè¿‡<strong>é…ç½®èƒ½ç›´æ¥è§£å†³é—®é¢˜</strong>çš„å¿«æ·æ–¹å¼ï¼Œä¸è¿‡æ¨èäº†ä½¿ç”¨è€…è‡ªèº«å¦‚æœå¯¹å“åº”æ—¶é—´ä¸é«˜çš„åœºæ™¯ä¸‹å¯ä»¥é‡‡ç”¨<strong>æ‰¹é‡åˆå¹¶äº‹åŠ¡</strong>çš„æ–¹å¼è¿›è¡Œä¼˜åŒ–ã€‚åŸºäºè¿™ä¸ªæ€è·¯ï¼Œæˆ‘ä»¬æŠŠå†™æ“ä½œè¿›è¡Œäº†å°è£…å¹¶æ”¾å…¥äº†<strong>é˜Ÿåˆ—</strong>ï¼Œç„¶ååœ¨æ¶ˆè´¹è€…ç«¯æ‰¹é‡å–å¾—æ•°æ®åè¿›è¡Œäº‹åŠ¡çš„æ‰¹é‡å¤„ç†ï¼Œå‹æµ‹ç¯å¢ƒä¸‹æ•´ä½“æ€§èƒ½è¾¾åˆ°äº†<strong>500TPS</strong>ã€‚å·²ç»åŸºæœ¬æ»¡è¶³äº†çº¿ä¸Šæ›´æ–°çš„éœ€æ±‚ï¼Œä½†æ˜¯å½“æ—¶å‹æµ‹çš„è¿‡ç¨‹ä¸­ï¼Œé˜Ÿåˆ—å¶å°”çš„ååé‡ä¼š<strong>å¤§èŒƒå›´æ³¢åŠ¨</strong>ï¼Œç»å¸¸ä¼šæŒç»­æ•°åç§’ï¼Œç„¶åä¸šåŠ¡ä¸€æ¬¡æ€§å¤„ç†å®Œå†å“åº”ï¼Œå¯¼è‡´<strong>å±€éƒ¨å“åº”æ—¶é—´å¤§å¹…åº¦å¢é•¿</strong></p><p>â€‹åæ¥ä¹Ÿæ˜¯åœ¨å®˜ç½‘ä¸ŠæŸ¥è¯¢ï¼Œäº†è§£åˆ°è°·æ­Œå¼€æºç»„ä»¶ä½¿ç”¨çš„<strong>é˜Ÿåˆ—æœåŠ¡</strong>åº•å±‚æ˜¯ä½¿ç”¨<strong>BigTable</strong>ä½œä¸ºæŒä¹…å±‚ï¼Œä½†æ˜¯å½“BigTableåˆ†ç‰‡è¿‡å¤§æ—¶ï¼Œä¼šè§¦å‘<strong>å†åˆ†ç‰‡</strong>çš„è¿‡ç¨‹ï¼Œå†åˆ†ç‰‡çš„è¿‡ç¨‹ä¸­ï¼Œæ˜¯<strong>ä¸ä¼šè¿›è¡Œä»»åŠ¡åˆ†å‘</strong>çš„ï¼Œæ‰€ä»¥å°±ä¼šå¯¼è‡´å…ˆå‰çš„é—®é¢˜ã€‚é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œè°·æ­Œå®˜æ–¹çš„å»ºè®®æ˜¯æå‰<strong>é…ç½®é˜Ÿåˆ—çš„æ•°é‡ã€è´Ÿè½½ç­–ç•¥å’Œæœ€å¤§å®¹é‡</strong>ç­‰ä¿¡æ¯ï¼Œä¿è¯æ‰€æœ‰é˜Ÿåˆ—<strong>ä¸åŒæ—¶è§¦å‘</strong>å†åˆ†ç‰‡</p><p>â€‹è¿›è¡Œä¸¤æ¬¡ä¼˜åŒ–åï¼Œå‹æµ‹ç¯å¢ƒå·²ç»åŸºæœ¬å¯ä»¥æ»¡è¶³é¢„æœŸäº†ï¼Œåœ¨å®é™…ç”Ÿäº§ç¯å¢ƒçš„éƒ¨ç½²ä¸­ï¼Œå‘ç°å¯¹äºäº‹åŠ¡æ›´æ–°å¤±è´¥æ—¶ï¼ŒJamsRankingä¼šå¯¹å¤±è´¥çš„äº‹åŠ¡è¿›è¡Œ<strong>åˆ‡åˆ†å’Œé‡è¯•</strong>ï¼Œæ•´ä¸ªè¿‡ç¨‹å¯¹äºç ”å‘äººå‘˜æ˜¯<strong>é€æ˜</strong>çš„ï¼Œä¸åˆ©äºçº¿ä¸Šé—®é¢˜æ’æŸ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å½“æ—¶ç‰¹åœ°å†™äº†ä¸€ä¸ªwatchdogçš„å·¥å…·ï¼Œç›‘æ§äº‹åŠ¡å›æ»šè¾¾åˆ°åæ¬¡ä»¥ä¸Šçš„äº‹åŠ¡ï¼ŒæŸ¥æ˜åŸå› åé€šè¿‡åå°ç®¡ç†ç³»ç»Ÿè¿›è¡Œç›¸åº”è¡¥å¿ï¼Œä¿è¯<strong>æœ€ç»ˆä¸€è‡´æ€§</strong></p><p><strong>æœ€ç»ˆç»“æœï¼š</strong></p><ul><li><p>é«˜æ•ˆå¿«é€Ÿï¼šèƒ½åœ¨æ•°ç™¾æ¯«ç§’å†…æ‰¾åˆ°ç©å®¶æ’åä»¥åŠè¿›è¡Œæ›´æ–°</p></li><li><p>å¼ºä¸€è‡´æ€§ä»¥åŠæŒä¹…åŒ–ã€æ’åå‡†ç¡®</p></li><li><p>å¯ä»¥æ‰©å±•åˆ°ä»»æ„æ•°é‡çš„ç©å®¶</p></li><li><p>ååé‡æœ‰é™åˆ¶ï¼Œåªèƒ½æ”¯æŒçº¦æ¯ç§’ 500æ¬¡æ›´æ–°ã€‚</p></li></ul><p>é’ˆå¯¹è¿™ä¸ªç¼ºç‚¹è°·æ­Œå®˜æ–¹ä¹Ÿæ˜¯ç»™å‡ºäº†ä½¿ç”¨åˆ†ç‰‡æ ‘å’Œè¿‘ä¼¼æ’åçš„è§£å†³æ–¹æ¡ˆï¼Œå½“ç„¶å¤æ‚çš„æ–¹æ¡ˆæœ‰æ›´é«˜çš„è¿ç»´æˆæœ¬ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼˜åŒ–å·¥ä½œä¹Ÿå°±åˆ°æ­¤ä¸ºæ­¢</p><h4 id="æ–¹æ¡ˆä¼˜åŒ–è¿‡ç¨‹"><a href="#æ–¹æ¡ˆä¼˜åŒ–è¿‡ç¨‹" class="headerlink" title="æ–¹æ¡ˆä¼˜åŒ–è¿‡ç¨‹"></a>æ–¹æ¡ˆä¼˜åŒ–è¿‡ç¨‹</h4><h4 id="æ–¹æ¡ˆ1ï¼šæ¯æ—¥ä¸€ä¸ªæ»šåŠ¨æ¦œï¼Œå½“æ—¥æ±‡èšï¼ˆè´¹æ—¶é—´ï¼‰"><a href="#æ–¹æ¡ˆ1ï¼šæ¯æ—¥ä¸€ä¸ªæ»šåŠ¨æ¦œï¼Œå½“æ—¥æ±‡èšï¼ˆè´¹æ—¶é—´ï¼‰" class="headerlink" title="æ–¹æ¡ˆ1ï¼šæ¯æ—¥ä¸€ä¸ªæ»šåŠ¨æ¦œï¼Œå½“æ—¥æ±‡èšï¼ˆè´¹æ—¶é—´ï¼‰"></a>æ–¹æ¡ˆ1ï¼šæ¯æ—¥ä¸€ä¸ªæ»šåŠ¨æ¦œï¼Œå½“æ—¥æ±‡èšï¼ˆè´¹æ—¶é—´ï¼‰</h4><p>â€‹é¦–å…ˆè®°å½•æ¯å¤©çš„æ’è¡Œæ¦œå’Œä¸€ä¸ªæ»šåŠ¨æ¦œï¼ŒåŠ åˆ†æ—¶åŒæ—¶å†™å…¥è¿™ä¸¤ä¸ªæ¦œå•ï¼Œæ¯æ—¥é›¶ç‚¹åè·‘å·¥å…·å°†å‰å‡ å¤©æ•°æ®ç´¯åŠ å†™å…¥å½“æ—¥æ»šåŠ¨æ¦œï¼Œè¯¥æ–¹æ¡ˆç¼ºç‚¹æ˜¯æ—¶é—´å¤æ‚åº¦é«˜ï¼Œ7å¤©æ¦œè¿˜å¥½ï¼Œåªéœ€è¦è¯»è¿‡å»6å¤©æ•°æ®ï¼Œå¦‚æœæ˜¯100å¤©æ¦œï¼Œè¯¥æ–¹æ¡ˆéœ€è¦è¯»è¿‡å»99å¤©æ¦œï¼Œæ˜¾ç„¶ä¸å¯æ¥å—</p><h4 id="æ–¹æ¡ˆ2ï¼šå…¨å±€Nä¸ªæ»šåŠ¨æ¦œåŒæ—¶å†™ï¼ˆè´¹ç©ºé—´ï¼‰"><a href="#æ–¹æ¡ˆ2ï¼šå…¨å±€Nä¸ªæ»šåŠ¨æ¦œåŒæ—¶å†™ï¼ˆè´¹ç©ºé—´ï¼‰" class="headerlink" title="æ–¹æ¡ˆ2ï¼šå…¨å±€Nä¸ªæ»šåŠ¨æ¦œåŒæ—¶å†™ï¼ˆè´¹ç©ºé—´ï¼‰"></a>æ–¹æ¡ˆ2ï¼šå…¨å±€Nä¸ªæ»šåŠ¨æ¦œåŒæ—¶å†™ï¼ˆè´¹ç©ºé—´ï¼‰</h4><p>â€‹è¦åšåˆ°æ¯æ—¥é›¶ç‚¹åæ¦œå•å®æ—¶ç”Ÿæ•ˆï¼Œè€Œä¸éœ€è¦ç­‰å¾…ç¦»çº¿ä½œä¸šçš„å®Œæˆï¼Œä¸€ç§æ–¹æ¡ˆæ˜¯é¢„å†™æœªæ¥çš„æ¦œå•ã€‚å¯ä»¥å†™å½“å¤©çš„æ»šåŠ¨æ¦œçš„åŒæ—¶ï¼Œå†™å¾€åN-1å¤©çš„æ»šåŠ¨æ¦œä¸€èµ·å†™å…¥è¯¥æ–¹æ¡ˆä¸ä»…èƒ½è„±ç¦»ç¦»çº¿ä½œä¸šåšåˆ°å®æ—¶æ›´æ–°ï¼Œä¸”å¯ä»¥çœç•¥æ¯å¤©çš„æ—¥æ¦œã€‚ä½†ç¼ºç‚¹ä¹Ÿä¸éš¾çœ‹å‡ºï¼Œå¯¹äº7å¤©æ»šåŠ¨æ¦œï¼Œæ¯æ¬¡å†™æ“ä½œéœ€è¦æ›´æ–°7ä¸ªæ¦œå•ï¼Œä½†æ˜¯å¯¹äºç™¾æ—¥æ¦œï¼Œç©ºé—´æ¶ˆè€—æ— æ³•æ¥å—ï¼Œ1000ä¸‡æ¦œå•å¤§çº¦æ¶ˆè€—1Gå†…å­˜</p><h4 id="æ–¹æ¡ˆ3ï¼šå®æ—¶æ›´æ–°ï¼Œå¸¸æ•°æ¬¡å†™æ“ä½œ"><a href="#æ–¹æ¡ˆ3ï¼šå®æ—¶æ›´æ–°ï¼Œå¸¸æ•°æ¬¡å†™æ“ä½œ" class="headerlink" title="æ–¹æ¡ˆ3ï¼šå®æ—¶æ›´æ–°ï¼Œå¸¸æ•°æ¬¡å†™æ“ä½œ"></a>æ–¹æ¡ˆ3ï¼šå®æ—¶æ›´æ–°ï¼Œå¸¸æ•°æ¬¡å†™æ“ä½œ</h4><p>æœ‰ä¸æœ‰åŠæ³•åšåˆ°æ—¢èƒ½å®æ—¶æ›´æ–°ï¼Œå†™æ¦œæ•°é‡ä¹Ÿä¸éšNçš„å¢åŠ è€Œå¢åŠ å‘¢ï¼Ÿ</p><p>â€‹ä»ç„¶æ˜¯è®°å½•æ¯å¤©çš„æ’è¡Œæ¦œå’Œä¸€ä¸ªæ»šåŠ¨æ¦œï¼ŒåŠ åˆ†æ“ä½œä¹Ÿè¿˜æ˜¯åŒæ—¶æ“ä½œå½“æ—¥æ¦œå’Œå…¨å±€æ¦œï¼Œä½†æ¯æ—¥é›¶ç‚¹çš„ç¦»çº¿ä½œä¸šæ”¹ä¸ºä»å…¨å±€æ¦œä¸­å‡å»ä¹‹å‰è¿‡æœŸçš„æ•°æ®ï¼Œä»è€Œå®ç°å…ˆæ»šåŠ¨æ›´æ–°ã€‚  æ­¤æ–¹æ¡ˆæ¯æ¬¡åªéœ€è¯»å–ä¸€ä¸ªæ—¥æ¦œåšå‡æ³•ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼›ä½†æ˜¯æ— æ³•åšåˆ°å®æ—¶æ›´æ–°ã€‚ è¿™ä¸ªæ–¹æ¡ˆçš„ä¼˜ç‚¹æ˜¯åœ¨åäºŒç‚¹å‰æå‰å‡†å¤‡å¥½å·®åˆ†æ¦œï¼Œåˆ°äº†åäºŒç‚¹ç›´æ¥åŠ ä¸Šå½“å¤©æ•°æ®å°±æ˜¯æ»šåŠ¨æ¦œå†…å®¹ ï¼Œè¿™æ ·å°±åœ¨å¸¸æ•°æ¬¡å†™æ“ä½œçš„å‰æä¸‹ï¼Œå®ç°äº†æ»šåŠ¨æ¦œçš„å®æ—¶æ›´æ–°</p><h3 id="2ã€å¦‚ä½•è§£å†³é‡å¤ç­”é¢˜"><a href="#2ã€å¦‚ä½•è§£å†³é‡å¤ç­”é¢˜" class="headerlink" title="2ã€å¦‚ä½•è§£å†³é‡å¤ç­”é¢˜"></a>2ã€<strong>å¦‚ä½•è§£å†³é‡å¤ç­”é¢˜</strong></h3><p>â€‹<strong>åˆ©ç”¨setnxé˜²æ­¢é‡å¤ç­”é¢˜</strong><br>â€‹åˆ†å¸ƒå¼é”æ˜¯æ§åˆ¶åˆ†å¸ƒå¼ç³»ç»Ÿä¹‹é—´åŒæ­¥è®¿é—®å…±äº«èµ„æºçš„ä¸€ç§æ–¹å¼ã€‚ åˆ©ç”¨Redisçš„å•çº¿ç¨‹ç‰¹æ€§å¯¹å…±äº«èµ„æºè¿›è¡Œä¸²è¡ŒåŒ–å¤„ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–é”æ¨èä½¿ç”¨setçš„æ–¹å¼</span></span><br><span class="line"><span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> jedis.set(lockKey, requestId, <span class="string">&quot;NX&quot;</span>, <span class="string">&quot;EX&quot;</span>, expireTime);</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¨èä½¿ç”¨redis+luaè„šæœ¬</span></span><br><span class="line"><span class="type">String</span> <span class="variable">lua</span> <span class="operator">=</span> <span class="string">&quot;if redis.call(&#x27;get&#x27;,KEYS[1]) == ARGV[1] then return redis.call(&#x27;del&#x27;,KEYS[1]) else return 0 end&quot;</span>;</span><br><span class="line"><span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> jedis.eval(lua, Collections.singletonList(lockKey)</span><br></pre></td></tr></table></figure><h3 id="3ã€ä¸€ä¸ªé¢˜ç›®è¢«å¤šä¸ªäººæŠ¢ç­”"><a href="#3ã€ä¸€ä¸ªé¢˜ç›®è¢«å¤šä¸ªäººæŠ¢ç­”" class="headerlink" title="3ã€ä¸€ä¸ªé¢˜ç›®è¢«å¤šä¸ªäººæŠ¢ç­”"></a><strong>3ã€ä¸€ä¸ªé¢˜ç›®è¢«å¤šä¸ªäººæŠ¢ç­”</strong></h3><p>â€‹<strong>åˆ©ç”¨redisæ¥å®ç°ä¹è§‚é”ï¼ˆæŠ¢ç­”ï¼‰</strong>ï¼Œå¥½å¤„æ˜¯ç­”é”™çš„äººä¸å½±å“çŠ¶æ€ï¼Œç¬¬ä¸€ä¸ªç§’æ€ç­”å¯¹çš„äººæ‰èƒ½å¾—åˆ†ã€‚</p><p>1ã€åˆ©ç”¨redisçš„watchåŠŸèƒ½ï¼Œç›‘æ§è¿™ä¸ª Corp:Activ:Qust: çš„çŠ¶æ€å€¼<br>2ã€è·å–Corp:Activ:Qust: çš„å€¼ï¼Œåˆ›å»ºredisäº‹åŠ¡ï¼Œç»™è¿™ä¸ªkeyçš„å€¼-1<br>3ã€æ‰§è¡Œè¿™ä¸ªäº‹åŠ¡ï¼Œå¦‚æœkeyçš„å€¼è¢«ä¿®æ”¹è¿‡åˆ™å›æ»šï¼Œkeyä¸å˜</p><h3 id="4ã€å¦‚ä½•ç®¡ç†æ˜µç§°é‡å¤"><a href="#4ã€å¦‚ä½•ç®¡ç†æ˜µç§°é‡å¤" class="headerlink" title="4ã€å¦‚ä½•ç®¡ç†æ˜µç§°é‡å¤"></a><strong>4ã€å¦‚ä½•ç®¡ç†æ˜µç§°é‡å¤</strong></h3><p>â€‹<strong>ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼š</strong></p><p>â€‹å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶çŸ¢é‡æ•°ç»„å’Œ K ä¸ªå“ˆå¸Œå‡½æ•°ã€‚å½“ä¸€ä¸ªæ˜µç§°åŠ å…¥å¸ƒéš†è¿‡æ»¤å™¨ä¸­çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><ul><li>ä½¿ç”¨ K ä¸ªå“ˆå¸Œå‡½æ•°å¯¹å…ƒç´ å€¼è¿›è¡Œ K æ¬¡è®¡ç®—ï¼Œå¾—åˆ° K ä¸ªå“ˆå¸Œå€¼ã€‚</li><li>æ ¹æ®å¾—åˆ°çš„å“ˆå¸Œå€¼ï¼Œåœ¨ä½æ•°ç»„ä¸­æŠŠå¯¹åº”ä¸‹æ ‡çš„å€¼ç½®ä¸º 1ã€‚ Na</li></ul><p>â€‹ç”¨æˆ·æ–°å¢æ˜µç§°æ—¶éœ€è¦é¦–å…ˆè®¡ç®—Kä¸ªå“ˆå¸Œå€¼ï¼Œå¦‚æœKä¸ªå“ˆå¸Œå€¼æœ‰ä¸€ä¸ªä¸ä¸º0åˆ™é€šè¿‡ï¼Œå¦åˆ™ä¸é€šè¿‡ï¼Œä¸é€šè¿‡æ—¶é€šè¿‡åŠ éšæœºå­—ç¬¦ä¸²å†æ¬¡æ£€éªŒï¼Œæ£€æµ‹é€šè¿‡åè¿”å›ç»™å‰ç«¯ï¼Œå¸®åŠ©ç”¨æˆ·è‡ªåŠ¨å¡«å†™ã€‚</p><p>â€‹å¸ƒéš†è¿‡æ»¤å™¨çš„å¥½å¤„æ˜¯å®ƒ<strong>å¯ä»¥ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­</strong>ã€‚å®ƒçš„ä¼˜åŠ¿æ˜¯åªéœ€è¦å ç”¨å¾ˆå°çš„å†…å­˜ç©ºé—´ä»¥åŠæœ‰ç€é«˜æ•ˆçš„æŸ¥è¯¢æ•ˆç‡ã€‚å¯¹äºå¸ƒéš†è¿‡æ»¤å™¨è€Œè¨€ï¼Œå®ƒçš„æœ¬è´¨æ˜¯ä¸€ä¸ª<strong>ä½æ•°ç»„</strong>ï¼šä½æ•°ç»„å°±æ˜¯æ•°ç»„çš„æ¯ä¸ªå…ƒç´ éƒ½åªå ç”¨ 1 bit ï¼Œå¹¶ä¸”æ¯ä¸ªå…ƒç´ åªèƒ½æ˜¯ 0 æˆ–è€… 1ã€‚</p><p>BloomFilter çš„ä¼˜åŠ¿æ˜¯ï¼Œå…¨å†…å­˜æ“ä½œï¼Œæ€§èƒ½å¾ˆé«˜ã€‚å¦å¤–ç©ºé—´æ•ˆç‡éå¸¸é«˜ï¼Œ<strong>è¦è¾¾åˆ° 1% çš„è¯¯åˆ¤ç‡ï¼Œå¹³å‡å•æ¡è®°å½•å ç”¨ 1.2 å­—èŠ‚å³å¯ã€‚è€Œä¸”ï¼Œå¹³å‡å•æ¡è®°å½•æ¯å¢åŠ  0.6 å­—èŠ‚ï¼Œè¿˜å¯è®©è¯¯åˆ¤ç‡ç»§ç»­å˜ä¸ºä¹‹å‰çš„ 1&#x2F;10ï¼Œå³å¹³å‡å•æ¡è®°å½•å ç”¨ 1.8 å­—èŠ‚ï¼Œè¯¯åˆ¤ç‡å¯ä»¥è¾¾åˆ° 1&#x2F;1000ï¼›å¹³å‡å•æ¡è®°å½•å ç”¨ 2.4 å­—èŠ‚ï¼Œè¯¯åˆ¤ç‡å¯ä»¥åˆ° 1&#x2F;10000ï¼Œä»¥æ­¤ç±»æ¨</strong>ã€‚è¿™é‡Œçš„è¯¯åˆ¤ç‡æ˜¯æŒ‡ï¼ŒBloomFilter åˆ¤æ–­æŸä¸ª key å­˜åœ¨ï¼Œä½†å®ƒå®é™…ä¸å­˜åœ¨çš„æ¦‚ç‡ï¼Œå› ä¸ºå®ƒå­˜çš„æ˜¯ key çš„ Hash å€¼ï¼Œè€Œé key çš„å€¼ï¼Œæ‰€ä»¥æœ‰æ¦‚ç‡å­˜åœ¨è¿™æ ·çš„ keyï¼Œå®ƒä»¬å†…å®¹ä¸åŒï¼Œä½†å¤šæ¬¡ Hash åçš„ Hash å€¼éƒ½ç›¸åŒã€‚å¯¹äº BloomFilter åˆ¤æ–­ä¸å­˜åœ¨çš„ key ï¼Œåˆ™æ˜¯ 100% ä¸å­˜åœ¨çš„ï¼Œåè¯æ³•ï¼Œå¦‚æœè¿™ä¸ª key å­˜åœ¨ï¼Œé‚£å®ƒæ¯æ¬¡ Hash åå¯¹åº”çš„ Hash å€¼ä½ç½®è‚¯å®šæ˜¯ 1ï¼Œè€Œä¸ä¼šæ˜¯ 0</p><p>â€‹</p><h3 id="5ã€å¦‚ä½•ç®¡ç†å‡ºé¢˜å®šæ—¶ä»»åŠ¡"><a href="#5ã€å¦‚ä½•ç®¡ç†å‡ºé¢˜å®šæ—¶ä»»åŠ¡" class="headerlink" title="5ã€å¦‚ä½•ç®¡ç†å‡ºé¢˜å®šæ—¶ä»»åŠ¡"></a><strong>5ã€å¦‚ä½•ç®¡ç†å‡ºé¢˜å®šæ—¶ä»»åŠ¡</strong></h3><p>â€‹å‹æµ‹ç¯å¢ƒä¸­æœåŠ¡å™¨é€šè¿‡Nettyçš„ä¸»ä»Reactorå¤šè·¯å¤ç”¨NIOäº‹ä»¶æ¨¡å‹ï¼Œå•æœºå¯ä»¥<strong>è½»æ¾åº”å¯¹åä¸‡é•¿è¿æ¥</strong>ï¼Œä½†æ˜¯æ¯ä¸ªä¸šåŠ¡ä¸­ï¼Œç”±äºæ¯ä¸ªç”¨æˆ·ç™»å½•ç³»ç»Ÿåéœ€è¦æŒ‰ç…§æŒ‡å®šé¡ºåºç­”é¢˜ï¼Œä¾‹å¦‚ä¸€å…±è¦ç­”åé“ï¼Œé‚£ä¹ˆæœåŠ¡å™¨é’ˆå¯¹è¿™ä¸€ä¸ªç”¨æˆ·å°±ä¼šäº§ç”Ÿåä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ‰€ä»¥å¯¹äºç³»ç»Ÿæ¥è¯´ï¼Œå®šæ—¶å™¨çš„<strong>æ•°é‡å°±æ˜¯ç™¾ä¸‡çº§åˆ«çš„</strong>ã€‚</p><p>â€‹é€šè¿‡å‹æµ‹ç»“æœå‘ç°ï¼šJDKè‡ªå¸¦çš„Timerï¼Œåœ¨å¤§æ¦‚ä¸‰ä¸‡å¹¶å‘æ—¶æ€§èƒ½å°±æ€¥å‰§ä¸‹é™äº†ã€‚ä¹Ÿæ˜¯æ­¤æ—¶æ ¹æ®ä¸šåŠ¡åœºæ™¯çš„éœ€è¦ï¼Œå°†å®šæ—¶ä»»åŠ¡æ”¹æˆäº†Nettyè‡ªå¸¦çš„HashedWheelTimeræ—¶é—´è½®æ–¹æ¡ˆï¼Œé€šè¿‡å‹æµ‹å•æœºåœ¨50ä¸‡çº§åˆ«ä¸‹ä¾ç„¶èƒ½å¤Ÿå¹³æ»‘çš„æ‰§è¡Œã€‚</p><p>â€‹ä¹Ÿæ˜¯è¿™ä¸ªå¼ºçƒˆçš„åå·®ï¼Œä½¿æˆ‘åœ¨å¼ºçƒˆçš„å¥½å¥‡å¿ƒä¿ƒä½¿ä¸‹ï¼Œé˜…è¯»æºç äº†è§£åˆ°å¸¸è§„çš„JDK çš„Timer å’Œ DelayedQueue ç­‰å·¥å…·ç±»ï¼Œå¯å®ç°ç®€å•çš„å®šæ—¶ä»»åŠ¡ï¼Œå•åº•å±‚ç”¨çš„æ˜¯<strong>å †æ•°æ®ç»“æ„</strong>ï¼Œå­˜å–å¤æ‚åº¦éƒ½æ˜¯ <strong>O(NlogN)<strong>ï¼Œæ— æ³•æ”¯æ’‘æµ·é‡å®šæ—¶ä»»åŠ¡ã€‚</strong>Nettyç»å…¸çš„æ—¶é—´è½®æ–¹æ¡ˆ</strong>ï¼Œæ­£æ˜¯é€šè¿‡å°†ä»»åŠ¡å­˜å–åŠå–æ¶ˆæ“ä½œæ—¶é—´å¤æ‚åº¦é™ä¸º O(1)ï¼Œè€Œå¹¿æ³›åº”ç”¨åœ¨å®šæ—¶<strong>ä»»åŠ¡é‡å¤§ã€æ€§èƒ½è¦æ±‚é«˜</strong>çš„åœºæ™¯ä¸­ã€‚</p><p>â€‹<img src="https://tva1.sinaimg.cn/large/0081Kckwly1glvl9c3hp2j30py0d7q4i.jpg" alt="img" style="zoom:50%;" /></p><p>â€‹åŸºäºNettyçš„Websocketåº•å±‚ï¼ŒæœåŠ¡å™¨ç«¯ç»´æŠ¤ä¸€ä¸ªé«˜æ•ˆæ‰¹é‡ç®¡ç†å®šæ—¶ä»»åŠ¡çš„è°ƒåº¦æ¨¡å‹ã€‚æ—¶é—´è½®ä¸€èˆ¬ä¼šå®ç°æˆä¸€ä¸ª<strong>ç¯å½¢æ•°ç»„ç»“æ„</strong>ï¼Œç±»ä¼¼ä¸€ä¸ªæ—¶é’Ÿï¼Œåˆ†ä¸ºå¾ˆå¤šæ§½ï¼Œä¸€ä¸ªæ§½ä»£è¡¨ä¸€ä¸ªæ—¶é—´é—´éš”ï¼Œæ¯ä¸ªæ§½ä½¿ç”¨<strong>åŒå‘é“¾è¡¨</strong>å­˜å‚¨å®šæ—¶ä»»åŠ¡ã€‚æŒ‡é’ˆ<strong>å‘¨æœŸæ€§åœ°è·³åŠ¨</strong>ï¼Œè·³åŠ¨åˆ°ä¸€ä¸ªæ§½ä½ï¼Œå°±æ‰§è¡Œè¯¥æ§½ä½çš„å®šæ—¶ä»»åŠ¡ã€‚</p><p>â€‹å•å±‚æ—¶é—´è½®çš„å®¹é‡å’Œç²¾åº¦éƒ½æ˜¯æœ‰é™çš„ï¼Œå¯¹äºç²¾åº¦è¦æ±‚ç‰¹åˆ«é«˜ã€æ—¶é—´è·¨åº¦ç‰¹åˆ«å¤§æˆ–æ˜¯æµ·é‡å®šæ—¶ä»»åŠ¡éœ€è¦è°ƒåº¦çš„åœºæ™¯ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å¤šçº§æ—¶é—´è½®ä»¥åŠæŒä¹…åŒ–å­˜å‚¨ä¸æ—¶é—´è½®ç»“åˆçš„æ–¹æ¡ˆã€‚æ—¶é—´è½®çš„<strong>å®šæ—¶ä»»åŠ¡å¤„ç†é€»è¾‘</strong>å¦‚ä¸‹ï¼š</p><ol><li>å°†ç¼“å­˜åœ¨ timeouts é˜Ÿåˆ—ä¸­çš„å®šæ—¶ä»»åŠ¡è½¬ç§»åˆ°æ—¶é—´è½®ä¸­å¯¹åº”çš„æ§½ä¸­</li><li>æ ¹æ®å½“å‰æŒ‡é’ˆå®šä½å¯¹åº”æ§½ï¼Œå¤„ç†è¯¥æ§½ä½çš„åŒå‘é“¾è¡¨ä¸­çš„å®šæ—¶ä»»åŠ¡ï¼Œä»é“¾è¡¨å¤´éƒ¨å¼€å§‹è¿­ä»£ï¼š<ul><li>å±äºå½“å‰æ—¶é’Ÿå‘¨æœŸåˆ™å–å‡ºè¿è¡Œ</li><li>ä¸å±äºåˆ™å°†å…¶å‰©ä½™çš„æ—¶é’Ÿå‘¨æœŸæ•°å‡ä¸€</li></ul></li><li>æ£€æµ‹æ—¶é—´è½®çš„çŠ¶æ€ã€‚å¦‚æœæ—¶é—´è½®å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œåˆ™å¾ªç¯æ‰§è¡Œä¸Šè¿°æ­¥éª¤ï¼Œä¸æ–­æ‰§è¡Œå®šæ—¶ä»»åŠ¡ã€‚</li></ol><h3 id="6ï¼šå¦‚ä½•è§£å†³å®¢æˆ·ç«¯æ–­è¿"><a href="#6ï¼šå¦‚ä½•è§£å†³å®¢æˆ·ç«¯æ–­è¿" class="headerlink" title="6ï¼šå¦‚ä½•è§£å†³å®¢æˆ·ç«¯æ–­è¿"></a><strong>6ï¼šå¦‚ä½•è§£å†³å®¢æˆ·ç«¯æ–­è¿</strong></h3><p>â€‹ä½¿ç”¨Nettyçš„<strong>é‡è¿æ£€æµ‹ç‹—</strong>ConnectionWatchdog</p><p>â€‹æœåŠ¡ç«¯å®šä¹‰refreshTimeï¼Œå½“æˆ‘ä»¬ä»channelä¸­readåˆ°äº†æœåŠ¡ç«¯å‘æ¥çš„å¿ƒè·³å“åº”æ¶ˆæ¯çš„è¯ï¼Œå°±åˆ·æ–°refreshTimeä¸ºå½“å‰æ—¶é—´</p><p>â€‹å®¢æˆ·ç«¯åœ¨stateæ˜¯WRITER_IDLEçš„æ—¶å€™æ¯éš”ä¸€ç§’å°±å‘é€ä¸€ä¸ªå¿ƒè·³åŒ…åˆ°severç«¯ï¼Œå‘Šè¯‰serverç«¯æˆ‘è¿˜æ´»ç€ã€‚</p><p>å½“é‡è¿æˆåŠŸæ—¶ï¼Œä¼šè§¦å‘channelActiveæ–¹æ³•ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¼€å¯äº†ä¸€ä¸ªå®šæ—¶ä»»åŠ¡å»åˆ¤æ–­refreshTimeå’Œå½“å‰æ—¶é—´çš„æ—¶é—´å·®ï¼Œè¶…è¿‡5ç§’è¯´æ˜æ–­çº¿äº†ï¼Œè¦è¿›è¡Œé‡è¿ï¼Œæœ€åè®¡ç®—é‡è¿æ¬¡æ•°ï¼Œå°è¯•è¿æ¥2æ¬¡ä»¥ä¸Šè¿ä¸ä¸Šå°±ä¼šä¿®æ”¹headerä¿¡æ¯å¼ºåˆ¶é‡è¿å»è¿å¦ä¸€ä¸ªæœåŠ¡å™¨ã€‚</p><h2 id="äºŒã€ç§’æ€é¡¹ç›®"><a href="#äºŒã€ç§’æ€é¡¹ç›®" class="headerlink" title="äºŒã€ç§’æ€é¡¹ç›®"></a>äºŒã€ç§’æ€é¡¹ç›®</h2><h3 id="æŠ€æœ¯é€‰å‹"><a href="#æŠ€æœ¯é€‰å‹" class="headerlink" title="æŠ€æœ¯é€‰å‹"></a><strong>æŠ€æœ¯é€‰å‹</strong></h3><p>ç§’æ€ç”¨åˆ°çš„åŸºç¡€ç»„ä»¶ï¼Œä¸»è¦æœ‰<strong>æ¡†æ¶ã€KV å­˜å‚¨ã€å…³ç³»å‹æ•°æ®åº“ã€MQ</strong>ã€‚</p><p>æ¡†æ¶ä¸»è¦æœ‰ Web æ¡†æ¶å’Œ RPC æ¡†æ¶ã€‚</p><p>å…¶ä¸­ï¼ŒWeb æ¡†æ¶ä¸»è¦ç”¨äºæä¾› HTTP æ¥å£ç»™æµè§ˆå™¨è®¿é—®ï¼Œæ‰€ä»¥ Web æ¡†æ¶çš„é€‰å‹åœ¨ç§’æ€æœåŠ¡ä¸­éå¸¸é‡è¦ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘<strong>æ¨èGin</strong>ï¼Œå®ƒçš„æ€§èƒ½å’Œæ˜“ç”¨æ€§éƒ½ä¸é”™ï¼Œåœ¨ <strong>GitHub ä¸Šçš„ Star è¾¾åˆ°äº† 44k</strong>ã€‚å¯¹æ¯”æ€§èƒ½æœ€å¥½çš„ fasthttpï¼Œè™½ç„¶ fasthttp åœ¨è¯·æ±‚å»¶è¿Ÿä½äº 10ms æ—¶æ€§èƒ½ä¼˜åŠ¿æ˜æ˜¾ï¼Œä½†å…¶åº•å±‚ä½¿ç”¨çš„å¯¹è±¡æ± å®¹æ˜“è®©äººè¸©å‘ï¼Œå¯¼è‡´å…¶æ˜“ç”¨æ€§è¾ƒå·®ï¼Œæ‰€ä»¥æ²¡å¿…è¦è¿‡äºè¿½æ±‚æ€§èƒ½è€Œå¿½ç•¥äº†ç¨³å®šæ€§</p><p>è‡³äº RPC æ¡†æ¶ï¼Œæˆ‘æ¨èé€‰ç”¨ <strong>gRPC</strong>ï¼Œå› ä¸ºå®ƒçš„æ‰©å±•æ€§å’Œæ€§èƒ½éƒ½éå¸¸ä¸é”™ã€‚åœ¨ç§’æ€ç³»ç»Ÿä¸­ï¼ŒRedis ä¸­çš„æ•°æ®ä¸»è¦æ˜¯ç»™ç§’æ€æ¥å£æœåŠ¡ä½¿ç”¨ï¼Œä»¥ä¾¿å°†é…ç½®ä»ç®¡ç†åå°åŒæ­¥åˆ° Redis ç¼“å­˜ä¸­ã€‚</p><p>KV å­˜å‚¨æ–¹é¢ï¼Œç§’æ€ç³»ç»Ÿä¸­ä¸»è¦æ˜¯ç”¨ <strong>Redis ç¼“å­˜æ´»åŠ¨é…ç½®</strong>ï¼Œç”¨ <strong>etcd å­˜å‚¨é›†ç¾¤ä¿¡æ¯</strong>ã€‚</p><p>å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œ<strong>MySQL</strong> æŠ€æœ¯æˆç†Ÿä¸”ç¨³å®šå¯é ï¼Œç§’æ€ç³»ç»Ÿç”¨å®ƒå­˜å‚¨æ´»åŠ¨é…ç½®æ•°æ®å¾ˆåˆé€‚ã€‚ä¸»è¦ åŸå› è¿˜æ˜¯ç§’æ€æ´»åŠ¨ä¿¡æ¯å’Œåº“å­˜æ•°æ®éƒ½ç¼“å­˜åœ¨ Redis ä¸­ï¼Œæ´»åŠ¨è¿‡ç¨‹ä¸­ç§’æ€æœåŠ¡ä¸æ“ä½œæ•°æ®åº“ï¼Œ ä½¿ç”¨ MySQL å®Œå…¨èƒ½å¤Ÿæ»¡è¶³éœ€æ±‚ã€‚</p><p>MQ æœ‰å¾ˆå¤šç§ï¼Œå…¶ä¸­ <strong>Kafka</strong> åœ¨ä¸šç•Œè®¤å¯åº¦æœ€é«˜ï¼ŒæŠ€æœ¯ä¹Ÿéå¸¸æˆç†Ÿï¼Œæ€§èƒ½å¾ˆä¸é”™ï¼Œéå¸¸é€‚åˆç”¨åœ¨ç§’æ€ç³»ç»Ÿä¸­ã€‚Kafka æ”¯æŒè‡ªåŠ¨åˆ›å»ºé˜Ÿåˆ—ï¼Œç§’æ€æœåŠ¡å„ä¸ªèŠ‚ç‚¹å¯ä»¥ç”¨å®ƒè‡ªåŠ¨åˆ›å»ºå±äºè‡ªå·±çš„é˜Ÿåˆ—</p><h3 id="æ–¹æ¡ˆè®¾è®¡"><a href="#æ–¹æ¡ˆè®¾è®¡" class="headerlink" title="æ–¹æ¡ˆè®¾è®¡"></a>æ–¹æ¡ˆè®¾è®¡</h3><p><strong>èƒŒæ™¯</strong></p><ul><li><p>ç§’æ€ä¸šåŠ¡ç®€å•ï¼Œæ¯ä¸ªç§’æ€æ´»åŠ¨çš„å•†å“æ˜¯äº‹å…ˆå®šä¹‰å¥½çš„ï¼Œå•†å“æœ‰æ˜ç¡®çš„ç±»å‹å’Œæ•°é‡ï¼Œå–å®Œå³æ­¢</p></li><li><p>ç§’æ€æ´»åŠ¨å®šæ—¶ä¸Šæ¶ï¼Œæ¶ˆè´¹è€…å¯ä»¥åœ¨æ´»åŠ¨å¼€å§‹åï¼Œé€šè¿‡ç§’æ€å…¥å£è¿›è¡ŒæŠ¢è´­ç§’æ€æ´»åŠ¨</p></li><li><p>ç§’æ€æ´»åŠ¨ç”±äºå•†å“ç‰©ç¾ä»·å»‰ï¼Œå¼€å§‹å”®å–åï¼Œä¼šè¢«å¿«é€ŸæŠ¢è´­ä¸€ç©ºã€‚</p></li></ul><p><strong>ç°è±¡</strong></p><p>-<br>  ç§’æ€æ´»åŠ¨æŒç»­æ—¶é—´çŸ­ï¼Œè®¿é—®å†²å‡»é‡å¤§ï¼Œç§’æ€ç³»ç»Ÿéœ€è¦åº”å¯¹è¿™ç§çˆ†å‘æ€§çš„è®¿é—®æ¨¡å‹</p><p>-<br>  ä¸šåŠ¡çš„è¯·æ±‚é‡è¿œè¿œå¤§äºå”®å–é‡ï¼Œå¤§éƒ¨åˆ†æ˜¯é™ªè·‘çš„è¯·æ±‚ï¼Œç§’æ€ç³»ç»Ÿéœ€è¦æå‰è§„åˆ’å¥½å¤„ç†ç­–ç•¥</p><p>-<br>  å‰ç«¯è®¿é—®é‡å·¨å¤§ï¼Œç³»ç»Ÿå¯¹åç«¯æ•°æ®çš„è®¿é—®é‡ä¹Ÿä¼šçŸ­æ—¶é—´çˆ†å¢ï¼Œå¯¹æ•°æ®å­˜å‚¨èµ„æºè¿›è¡Œè‰¯å¥½è®¾è®¡</p><p>-<br>  æ´»åŠ¨æœŸé—´ä¼šç»™æ•´ä¸ªä¸šåŠ¡ç³»ç»Ÿå¸¦æ¥è¶…å¤§è´Ÿè·ï¼Œéœ€è¦åˆ¶å®šå„ç§ç­–ç•¥ï¼Œé¿å…ç³»ç»Ÿè¿‡è½½è€Œå®•æœº</p><p>-<br>  å”®å–æ´»åŠ¨å•†å“ä»·æ ¼ä½å»‰ï¼Œå­˜åœ¨å¥—åˆ©ç©ºé—´ï¼Œå„ç§éæ³•ä½œå¼Šæ‰‹æ®µå±‚å‡ºï¼Œéœ€è¦æå‰è§„åˆ’é¢„é˜²ç­–ç•¥</p><p><strong>ç§’æ€ç³»ç»Ÿè®¾è®¡</strong></p><p>â€‹é¦–å…ˆï¼Œè¦<strong>å°½åŠ›å°†è¯·æ±‚æ‹¦æˆªåœ¨ç³»ç»Ÿä¸Šæ¸¸</strong>ï¼Œå±‚å±‚è®¾é˜»æ‹¦æˆªï¼Œè¿‡æ»¤æ‰æ— æ•ˆæˆ–è¶…é‡çš„è¯·æ±‚ã€‚å› ä¸ºè®¿é—®é‡è¿œè¿œå¤§äºå•†å“æ•°é‡ï¼Œæ‰€æœ‰çš„è¯·æ±‚æ‰“åˆ°åç«¯æœåŠ¡çš„æœ€åä¸€æ­¥ï¼Œå…¶å®å¹¶æ²¡æœ‰å¿…è¦ï¼Œåè€Œä¼šä¸¥é‡æ‹–æ…¢çœŸæ­£èƒ½æˆäº¤çš„è¯·æ±‚ï¼Œé™ä½ç”¨æˆ·ä½“éªŒã€‚</p><p>â€‹ç§’æ€ç³»ç»Ÿä¸“ä¸ºç§’æ€æ´»åŠ¨æœåŠ¡ï¼Œå”®å–å•†å“ç¡®å®šï¼Œå› æ­¤å¯ä»¥åœ¨è®¾è®¡ç§’æ€å•†å“é¡µé¢æ—¶ï¼Œå°†å•†å“ä¿¡æ¯æå‰è®¾è®¡ä¸ºé™æ€ä¿¡æ¯ï¼Œå°†é™æ€çš„å•†å“ä¿¡æ¯ä»¥åŠå¸¸è§„çš„ CSSã€JSã€å®£ä¼ å›¾ç‰‡ç­‰é™æ€èµ„æºï¼Œä¸€èµ·<strong>ç‹¬ç«‹å­˜æ”¾åˆ° CDN èŠ‚ç‚¹</strong>ï¼ŒåŠ é€Ÿè®¿é—®ï¼Œä¸”é™ä½ç³»ç»Ÿè®¿é—®å‹åŠ›ï¼Œåœ¨è®¿é—®å‰ç«¯ä¹Ÿå¯ä»¥<strong>åˆ¶å®šç§ç§é™åˆ¶ç­–ç•¥ï¼Œ</strong>æ¯”å¦‚æ´»åŠ¨æ²¡å¼€å§‹æ—¶ï¼ŒæŠ¢è´­æŒ‰é’®ç½®ç°ï¼Œé¿å…æŠ¢å…ˆè®¿é—®ï¼Œç”¨æˆ·æŠ¢è´­ä¸€æ¬¡åï¼Œä¹Ÿå°†æŒ‰é’®ç½®ç°ï¼Œè®©ç”¨æˆ·æ’é˜Ÿç­‰å¾…ï¼Œé¿å…åå¤åˆ·æ–°ã€‚</p><p>â€‹å…¶æ¬¡ï¼Œè¦<strong>å……åˆ†åˆ©ç”¨ç¼“å­˜</strong>ï¼Œæå‡ç³»ç»Ÿçš„æ€§èƒ½å’Œå¯ç”¨æ€§ã€‚</p><p>â€‹ç”¨æˆ·æ‰€æœ‰çš„è¯·æ±‚è¿›å…¥ç§’æ€ç³»ç»Ÿå‰ï¼Œé€šè¿‡<strong>è´Ÿè½½å‡è¡¡ç­–ç•¥</strong>å‡åŒ€åˆ†å‘åˆ°ä¸åŒ Web æœåŠ¡å™¨ï¼Œé¿å…èŠ‚ç‚¹è¿‡è½½ã€‚åœ¨ Web æœåŠ¡å™¨ä¸­ï¼Œé¦–å…ˆæ£€æŸ¥ç”¨æˆ·çš„è®¿é—®æƒé™ï¼Œè¯†åˆ«å¹¶å‘åˆ·è®¢å•çš„è¡Œä¸ºã€‚å¦‚æœå‘ç°å”®å‡ºæ•°é‡å·²ç»è¾¾åˆ°ç§’æ€æ•°é‡ï¼Œåˆ™ç›´æ¥è¿”å›ç»“æŸï¼Œè¦å°†ç§’æ€ä¸šåŠ¡ç³»ç»Ÿå’Œå…¶ä»–ä¸šåŠ¡ç³»ç»Ÿè¿›è¡ŒåŠŸèƒ½åˆ†æ‹†ï¼Œå°½é‡å°†ç§’æ€ç³»ç»ŸåŠä¾èµ–æœåŠ¡<strong>ç‹¬ç«‹åˆ†æ‹†éƒ¨ç½²</strong>ï¼Œé¿å…å½±å“å…¶ä»–æ ¸å¿ƒä¸šåŠ¡ç³»ç»Ÿã€‚</p><p>â€‹ç§’æ€ç³»ç»Ÿéœ€è¦æ„å»ºè®¿é—®è®°å½•ç¼“å­˜ï¼Œè®°å½•è®¿é—® IPã€ç”¨æˆ·çš„è®¿é—®è¡Œä¸ºï¼Œå‘ç°å¼‚å¸¸è®¿é—®ï¼Œæå‰è¿›è¡Œé˜»æ–­åŠè¿”å›ã€‚åŒæ—¶è¿˜éœ€è¦<strong>æ„å»ºç”¨æˆ·ç¼“å­˜</strong>ï¼Œå¹¶é’ˆå¯¹å†å²æ•°æ®åˆ†æï¼Œæå‰ç¼“å­˜åƒµå°¸å¼ºåˆ·ä¸“ä¸šæˆ·ï¼Œæ–¹ä¾¿åœ¨ç§’æ€æœŸé—´å¯¹å…¶è¿›è¡Œç­–ç•¥é™åˆ¶ã€‚è¿™äº›è®¿é—®è®°å½•ã€ç”¨æˆ·æ•°æ®ï¼Œé€šè¿‡ç¼“å­˜è¿›è¡Œå­˜å‚¨ï¼Œå¯ä»¥åŠ é€Ÿè®¿é—®ï¼Œå¦å¤–ï¼Œå¯¹ç”¨æˆ·æ•°æ®è¿˜è¿›è¡Œç¼“å­˜é¢„çƒ­ï¼Œé¿å…æ´»åŠ¨æœŸé—´å¤§é‡ç©¿é€ã€‚</p><h3 id="1ã€å¦‚ä½•è§£å†³è¶…å–ï¼Ÿ"><a href="#1ã€å¦‚ä½•è§£å†³è¶…å–ï¼Ÿ" class="headerlink" title="1ã€å¦‚ä½•è§£å†³è¶…å–ï¼Ÿ"></a><strong>1ã€å¦‚ä½•è§£å†³è¶…å–ï¼Ÿ</strong></h3><p>mysqlä¹è§‚é”+redisé¢„å‡åº“å­˜+redisç¼“å­˜å–å®Œæ ‡è®° </p><p>ç¬¬ä¸€æ˜¯åŸºäº<strong>æ•°æ®åº“ä¹è§‚é”</strong>çš„æ–¹å¼ä¿è¯æ•°æ®å¹¶å‘æ‰£å‡çš„å¼ºä¸€è‡´æ€§ï¼›</p><p>ç¬¬äºŒæ˜¯åŸºäº<strong>æ•°æ®åº“çš„äº‹åŠ¡</strong>å®ç°æ‰¹é‡æ‰£å‡éƒ¨åˆ†å¤±è´¥æ—¶çš„æ•°æ®å›æ»šã€‚</p><p>â€‹åœ¨æ‰£å‡æŒ‡å®šæ•°é‡å‰åº”å…ˆåšä¸€æ¬¡å‰ç½®æ•°é‡æ ¡éªŒçš„è¯»è¯·æ±‚ï¼ˆå‚è€ƒ<strong>è¯»å†™åˆ†ç¦»</strong> + <strong>å…¨ç¼“å­˜æ–¹æ¡ˆ</strong>ï¼‰</p><blockquote><p>çº¯æ•°æ®åº“ä¹è§‚é”+äº‹åŠ¡çš„æ–¹å¼æ€§èƒ½æ¯”è¾ƒå·®ï¼Œä½†æ˜¯å¦‚æœä¸è®¡æˆæœ¬å’Œè€ƒè™‘åœºæ™¯çš„è¯ä¹Ÿå®Œå…¨å¤Ÿç”¨ï¼Œå› ä¸ºä»»ä½•æ²¡æœ‰æœºå™¨é…ç½®çš„æŒ‡æ ‡ï¼Œéƒ½æ˜¯è€æµæ°“ã€‚å¦‚æœæˆ‘é‡‡ç”¨ Oracle çš„æ•°æ®åº“ã€100 å¤šæ ¸çš„åˆ€é”‹æœåŠ¡å™¨ã€SSD çš„ç¡¬ç›˜ï¼Œå³ä½¿æ˜¯çº¯æ•°æ®åº“çš„æ‰£å‡æ–¹æ¡ˆï¼Œä¹Ÿæ˜¯å¯ä»¥è¾¾åˆ°å•æœºä¸Šä¸‡çš„ TPS çš„ã€‚</p></blockquote><p><strong>å•çº¿ç¨‹Redis çš„ lua è„šæœ¬å®ç°æ‰¹é‡æ‰£å‡</strong></p><p>å½“ç”¨æˆ·è°ƒç”¨æ‰£å‡æ¥å£æ—¶ï¼Œå°†æ‰£å‡çš„ å¯¹åº”æ•°é‡ + è„šæœ¬æ ‡ç¤ºä¼ é€’è‡³ Redis å³å¯ï¼Œæ‰€æœ‰çš„æ‰£å‡åˆ¤æ–­é€»è¾‘å‡åœ¨ Redis ä¸­çš„ lua è„šæœ¬ä¸­æ‰§è¡Œï¼Œlua è„šæœ¬æ‰§è¡Œå®Œæˆä¹‹åè¿”è¿˜æ˜¯å¦æˆåŠŸç»™å®¢æˆ·ç«¯ã€‚</p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6j9dkq6vj30w20kowku.jpg" alt="image-20210504174103769" style="zoom:50%;" /><p>Redis ä¸­çš„ lua è„šæœ¬æ‰§è¡Œæ—¶ï¼Œé¦–å…ˆä¼šä½¿ç”¨ get å‘½ä»¤æŸ¥è¯¢ uuid è¿›è¡ŒæŸ¥é‡ã€‚å½“é˜²é‡é€šè¿‡åï¼Œä¼š<strong>æ‰¹é‡è·å–å¯¹åº”çš„å‰©ä½™åº“å­˜çŠ¶æ€å¹¶è¿›è¡Œåˆ¤æ–­</strong>ï¼Œå¦‚æœä¸€ä¸ªæ‰£å‡çš„æ•°é‡å¤§äºå‰©ä½™æ•°é‡ï¼Œåˆ™è¿”å›é”™è¯¯å¹¶æç¤ºæ•°é‡ä¸è¶³ã€‚</p><p>Redis çš„å•çº¿ç¨‹æ¨¡å‹ï¼Œç¡®ä¿<strong>ä¸ä¼šå‡ºç°å½“æ‰€æœ‰æ‰£å‡æ•°é‡åœ¨åˆ¤æ–­å‡æ»¡è¶³åï¼Œåœ¨å®é™…æ‰£å‡æ—¶å´æ•°é‡ä¸å¤Ÿ</strong>ã€‚åŒæ—¶ï¼Œå•çº¿ç¨‹ä¿è¯åˆ¤æ–­æ•°é‡çš„æ­¥éª¤å’Œåç»­æ‰£å‡æ­¥éª¤ä¹‹é—´ï¼Œæ²¡æœ‰å…¶ä»–ä»»ä½•çº¿ç¨‹å‡ºç°å¹¶å‘çš„æ‰§è¡Œã€‚</p><p>å½“ Redis æ‰£å‡æˆåŠŸåï¼Œæ‰£å‡æ¥å£ä¼š<strong>å¼‚æ­¥çš„å°†æ­¤æ¬¡æ‰£å‡å†…å®¹ä¿å­˜è‡³æ•°æ®åº“</strong>ã€‚å¼‚æ­¥ä¿å­˜æ•°æ®åº“çš„ç›®çš„æ˜¯é˜²æ­¢å‡ºç°æç«¯æƒ…å†µâ€”â€” Redis å®•æœºåæ•°æ®æœªæŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ•°æ®åº“æ¢å¤æˆ–è€…æ ¡å‡†æ•°æ®</p><p>æœ€åï¼Œè¿è¥åå°ç›´è¿æ•°æ®åº“ï¼Œæ˜¯è¿è¥å’Œå•†å®¶ä¿®æ”¹åº“å­˜çš„å…¥å£ã€‚å•†å®¶åœ¨è¿è¥åå°è¿›è´§ç‰©è¿›è¡Œè¡¥å……ã€‚åŒæ—¶ï¼Œè¿è¥åå°çš„å®ç°éœ€è¦å°†æ­¤æ•°é‡<strong>åŒæ­¥çš„å¢åŠ è‡³ Redis</strong>ï¼Œå› ä¸ºå½“å‰æ–¹æ¡ˆçš„æ‰€æœ‰å®é™…æ‰£å‡éƒ½åœ¨ Redis ä¸­</p><blockquote><p>çº¯ç¼“å­˜æ–¹æ¡ˆè™½<strong>ä¸ä¼šå¯¼è‡´è¶…å–</strong>ï¼Œä½†å› <strong>ç¼“å­˜ä¸å…·å¤‡äº‹åŠ¡ç‰¹æ€§</strong>ï¼Œæç«¯æƒ…å†µä¸‹ä¼šå­˜åœ¨ç¼“å­˜é‡Œçš„æ•°æ®<strong>æ— æ³•å›æ»š</strong>ï¼Œå¯¼è‡´å‡ºç°<strong>å°‘å–</strong>çš„æƒ…å†µã€‚ä¸”æ¶æ„ä¸­çš„å¼‚æ­¥å†™åº“ï¼Œä¹Ÿå¯èƒ½å‘ç”Ÿå¤±è´¥ï¼Œå¯¼è‡´å¤šæ‰£çš„æ•°æ®ä¸¢å¤±</p></blockquote><p>å¯ä»¥å€ŸåŠ©<strong>é¡ºåºå†™</strong>çš„ç‰¹æ€§ï¼Œå°†æ‰£å‡ä»»åŠ¡åŒæ­¥<strong>æ’å…¥</strong>ä»»åŠ¡è¡¨ï¼Œå‘ç°å¼‚å¸¸æ—¶ï¼Œå°†ä»»åŠ¡è¡¨ä½œä¸º<strong>undolog</strong>è¿›è¡Œå›æ»š</p><p>å¯ä»¥è§£å†³ç”±äº<strong>ç½‘ç»œä¸é€š</strong>ã€è°ƒç”¨ç¼“å­˜<strong>æ‰£å‡è¶…æ—¶</strong>ã€åœ¨æ‰£å‡åˆ°ä¸€åŠæ—¶ç¼“å­˜<strong>çªç„¶å®•æœº</strong>ï¼ˆæ•…éšœ failoverï¼‰äº†ã€‚é’ˆå¯¹ä¸Šè¿°è¯·æ±‚ï¼Œéƒ½æœ‰ç›¸åº”çš„å¼‚å¸¸æŠ›å‡ºï¼Œæ ¹æ®å¼‚å¸¸è¿›è¡Œ<strong>æ•°æ®åº“å›æ»š</strong>å³å¯ï¼Œæœ€ç»ˆä»»åŠ¡åº“é‡Œçš„æ•°æ®éƒ½æ˜¯å‡†çš„</p><p>æ›´è¿›ä¸€æ­¥ï¼šç”±äºä»»åŠ¡åº“æ˜¯æ— çŠ¶æ€çš„ï¼Œå¯ä»¥è¿›è¡Œæ°´å¹³åˆ†åº“ï¼Œæå‡æ•´ä½“æ€§èƒ½</p><h3 id="2ã€å¦‚ä½•è§£å†³é‡å¤ä¸‹å•ï¼Ÿ"><a href="#2ã€å¦‚ä½•è§£å†³é‡å¤ä¸‹å•ï¼Ÿ" class="headerlink" title="2ã€å¦‚ä½•è§£å†³é‡å¤ä¸‹å•ï¼Ÿ"></a><strong>2ã€å¦‚ä½•è§£å†³é‡å¤ä¸‹å•ï¼Ÿ</strong></h3><p>mysqlå”¯ä¸€ç´¢å¼•+åˆ†å¸ƒå¼é” </p><h3 id="3ã€å¦‚ä½•é˜²åˆ·ï¼Ÿ"><a href="#3ã€å¦‚ä½•é˜²åˆ·ï¼Ÿ" class="headerlink" title="3ã€å¦‚ä½•é˜²åˆ·ï¼Ÿ"></a><strong>3ã€å¦‚ä½•é˜²åˆ·ï¼Ÿ</strong></h3><p>IPé™æµ | éªŒè¯ç  | å•ç”¨æˆ· | å•è®¾å¤‡ | IMEI | æºIP |å‡è®¾ç½®è§„åˆ™</p><h3 id="4ã€çƒ­keyé—®é¢˜å¦‚ä½•è§£å†³ï¼Ÿ"><a href="#4ã€çƒ­keyé—®é¢˜å¦‚ä½•è§£å†³ï¼Ÿ" class="headerlink" title="4ã€çƒ­keyé—®é¢˜å¦‚ä½•è§£å†³ï¼Ÿ"></a><strong>4ã€çƒ­keyé—®é¢˜å¦‚ä½•è§£å†³ï¼Ÿ</strong></h3><p>redisé›†ç¾¤+æœ¬åœ°ç¼“å­˜+é™æµ+keyåŠ éšæœºå€¼åˆ†å¸ƒåœ¨å¤šä¸ªå®ä¾‹ä¸­ </p><p>1ã€<strong>ç¼“å­˜é›†ç¾¤</strong>å¯ä»¥å•èŠ‚ç‚¹è¿›è¡Œ<strong>ä¸»ä»å¤åˆ¶å’Œå‚ç›´æ‰©å®¹</strong></p><p>2ã€åˆ©ç”¨åº”ç”¨å†…çš„<strong>å‰ç½®ç¼“å­˜</strong>ï¼Œä½†æ˜¯éœ€æ³¨æ„éœ€è¦è®¾ç½®ä¸Šé™</p><p>3ã€å»¶è¿Ÿä¸æ•æ„Ÿï¼Œ<strong>å®šæ—¶åˆ·æ–°</strong>ï¼Œå®æ—¶æ„ŸçŸ¥ç”¨ä¸»åŠ¨åˆ·æ–°</p><p>4ã€å’Œç¼“å­˜ç©¿é€ä¸€æ ·ï¼Œé™åˆ¶é€ƒé€¸æµé‡ï¼Œå•è¯·æ±‚è¿›è¡Œæ•°æ®<strong>å›æºå¹¶åˆ·æ–°å‰ç½®</strong></p><p>5ã€æ— è®ºå¦‚ä½•è®¾è®¡ï¼Œæœ€åéƒ½è¦å†™ä¸€ä¸ª<strong>å…œåº•é€»è¾‘</strong>ï¼Œåƒä¸‡çº§æµé‡è¯´æ¥å°±æ¥</p><h3 id="5ã€åº”å¯¹é«˜å¹¶å‘çš„è¯»è¯·æ±‚"><a href="#5ã€åº”å¯¹é«˜å¹¶å‘çš„è¯»è¯·æ±‚" class="headerlink" title="5ã€åº”å¯¹é«˜å¹¶å‘çš„è¯»è¯·æ±‚"></a><strong>5ã€åº”å¯¹é«˜å¹¶å‘çš„è¯»è¯·æ±‚</strong></h3><p>ä½¿ç”¨ç¼“å­˜ç­–ç•¥å°†è¯·æ±‚æŒ¡åœ¨ä¸Šå±‚ä¸­çš„ç¼“å­˜ä¸­</p><p>ä½¿ç”¨CDNï¼Œèƒ½é™æ€åŒ–çš„æ•°æ®å°½é‡åšåˆ°é™æ€åŒ–ï¼Œ</p><p>åŠ å…¥é™æµï¼ˆæ¯”å¦‚å¯¹çŸ­æ—¶é—´ä¹‹å†…æ¥è‡ªæŸä¸€ä¸ªç”¨æˆ·ï¼ŒæŸä¸€ä¸ªIPã€æŸä¸ªè®¾å¤‡çš„é‡å¤è¯·æ±‚åšä¸¢å¼ƒå¤„ç†ï¼‰</p><p><strong>èµ„æºéš”ç¦»é™æµ</strong>ä¼šå°†å¯¹åº”çš„èµ„æºæŒ‰ç…§æŒ‡å®šçš„ç±»å‹è¿›è¡Œéš”ç¦»ï¼Œæ¯”å¦‚<strong>çº¿ç¨‹æ± </strong>å’Œ<strong>ä¿¡å·é‡</strong>ã€‚</p><ul><li><p>è®¡æ•°å™¨é™æµï¼Œä¾‹å¦‚5ç§’å†…æŠ€æœ¯1000è¯·æ±‚ï¼Œè¶…æ•°åé™æµï¼Œæœªè¶…æ•°é‡æ–°è®¡æ•°</p></li><li><p>æ»‘åŠ¨çª—å£é™æµï¼Œè§£å†³è®¡æ•°å™¨ä¸å¤Ÿç²¾ç¡®çš„é—®é¢˜ï¼ŒæŠŠä¸€ä¸ªçª—å£æ‹†åˆ†å¤šæ»šåŠ¨çª—å£</p></li><li><p>ä»¤ç‰Œæ¡¶é™æµï¼Œç±»ä¼¼æ™¯åŒºå”®ç¥¨ï¼Œå”®ç¥¨çš„é€Ÿåº¦æ˜¯å›ºå®šçš„ï¼Œæ‹¿åˆ°ä»¤ç‰Œæ‰èƒ½å»å¤„ç†è¯·æ±‚</p></li><li><p>æ¼æ¡¶é™æµï¼Œç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼Œå®ç°äº†æ’å®šé€Ÿåº¦å¤„ç†è¯·æ±‚ï¼Œèƒ½å¤Ÿç»å¯¹é˜²æ­¢çªå‘æµé‡</p><p>æµé‡æ§åˆ¶æ•ˆæœä»å¥½åˆ°å·®ä¾æ¬¡æ˜¯ï¼š<strong>æ¼æ¡¶é™æµ &gt; ä»¤ç‰Œæ¡¶é™æµ &gt; æ»‘åŠ¨çª—å£é™æµ &gt; è®¡æ•°å™¨é™æµ</strong></p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6ja736ekj316o06640u.jpg" alt="image-20210504174148831" style="zoom:50%;" /><p>å…¶ä¸­ï¼Œåªæœ‰æ¼æ¡¶ç®—æ³•<strong>çœŸæ­£å®ç°äº†æ’å®šé€Ÿåº¦å¤„ç†è¯·æ±‚</strong>ï¼Œèƒ½å¤Ÿç»å¯¹<strong>é˜²æ­¢çªå‘æµé‡è¶…è¿‡ä¸‹æ¸¸ç³»ç»Ÿæ‰¿è½½èƒ½åŠ›</strong>ã€‚<br>ä¸è¿‡ï¼Œæ¼æ¡¶é™æµä¹Ÿæœ‰ä¸ªä¸è¶³ï¼Œå°±æ˜¯éœ€è¦åˆ†<strong>é…å†…å­˜èµ„æºç¼“å­˜è¯·æ±‚</strong>ï¼Œè¿™ä¼šå¢åŠ å†…å­˜çš„ä½¿ç”¨ç‡ã€‚è€Œ<strong>ä»¤ç‰Œæ¡¶é™æµ</strong>ç®—æ³•ä¸­çš„â€œæ¡¶â€å¯ä»¥ç”¨ä¸€ä¸ªæ•´æ•°è¡¨ç¤ºï¼Œ<strong>èµ„æºå ç”¨ç›¸å¯¹è¾ƒå°</strong>ï¼Œè¿™ä¹Ÿè®©å®ƒæˆä¸ºæœ€å¸¸ç”¨çš„é™æµç®—æ³•ã€‚æ­£æ˜¯å› ä¸ºè¿™äº›ç‰¹ç‚¹ï¼Œ<strong>æ¼æ¡¶é™æµå’Œä»¤ç‰Œæ¡¶é™æµ</strong>ç»å¸¸åœ¨ä¸€äº›å¤§æµé‡ç³»ç»Ÿä¸­ç»“åˆä½¿ç”¨ã€‚</p></li></ul><h3 id="6ã€åº”å¯¹é«˜å¹¶å‘çš„å†™è¯·æ±‚"><a href="#6ã€åº”å¯¹é«˜å¹¶å‘çš„å†™è¯·æ±‚" class="headerlink" title="6ã€åº”å¯¹é«˜å¹¶å‘çš„å†™è¯·æ±‚"></a><strong>6ã€åº”å¯¹é«˜å¹¶å‘çš„å†™è¯·æ±‚</strong></h3><ul><li><p><strong>å‰Šå³°</strong>ï¼šæ¶æ„ç”¨æˆ·æ‹¦æˆª</p><p>å¯¹äºå•ç”¨æˆ·å¤šæ¬¡ç‚¹å‡»ã€å•è®¾å¤‡ã€IMEIã€æºIPå‡è®¾ç½®è§„åˆ™</p></li><li><p>é‡‡ç”¨æ¯”è¾ƒæˆç†Ÿçš„<strong>æ¼æ¡¶ç®—æ³•ã€ä»¤ç‰Œæ¡¶</strong>ç®—æ³•ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<strong>guava</strong>å¼€ç®±å³ç”¨çš„é™æµç®—æ³•</p><p>å¯ä»¥é›†ç¾¤é™æµï¼Œä½†å•æœºé™æµæ›´åŠ ç®€æ´å’Œç¨³å®š</p></li><li><p>å½“å‰å±‚<strong>ç›´æ¥è¿‡æ»¤</strong>ä¸€å®šæ¯”ä¾‹çš„è¯·æ±‚ï¼Œæœ€å¤§æ‰¿è½½å€¼å‰éœ€è¦åŠ ä¸Š<strong>å…œåº•é€»è¾‘</strong></p></li><li><p>å¯¹äºå·²ç»æ— è´§çš„äº§å“ï¼Œ<strong>æœ¬åœ°ç¼“å­˜</strong>ç›´æ¥è¿”å›</p></li><li><p><strong>å•ç‹¬éƒ¨ç½²ï¼Œå‡å°‘å¯¹ç³»ç»Ÿæ­£å¸¸æœåŠ¡çš„å½±å“ï¼Œæ–¹ä¾¿æ‰©ç¼©å®¹</strong></p></li></ul><p>å¯¹äº<strong>ä¸€æ®µæ—¶é—´å†…çš„ç§’æ€æ´»åŠ¨ï¼Œéœ€è¦ä¿è¯å†™æˆåŠŸ</strong>ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ã€‚</p><ul><li>å‰Šå»ç§’æ€åœºæ™¯ä¸‹çš„å³°å€¼å†™æµé‡â€”â€”<strong>æµé‡å‰Šå³°</strong></li><li>é€šè¿‡å¼‚æ­¥å¤„ç†ç®€åŒ–ç§’æ€è¯·æ±‚ä¸­çš„ä¸šåŠ¡æµç¨‹â€”â€”<strong>å¼‚æ­¥å¤„ç†</strong></li><li>è§£è€¦ï¼Œå®ç°ç§’æ€ç³»ç»Ÿæ¨¡å—ä¹‹é—´æ¾è€¦åˆâ€”â€”<strong>è§£è€¦</strong></li></ul><p><strong>å‰Šå»ç§’æ€åœºæ™¯ä¸‹çš„å³°å€¼å†™æµé‡</strong></p><ul><li><strong>å°†ç§’æ€è¯·æ±‚æš‚å­˜äºæ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼Œä¸šåŠ¡æœåŠ¡å™¨å“åº”ç”¨æˆ·â€œç§’æ€ç»“æœæ­£åœ¨å¤„ç†ä¸­ã€‚ã€‚ã€‚â€ï¼Œé‡Šæ”¾ç³»ç»Ÿèµ„æºå»å¤„ç†å…¶å®ƒç”¨æˆ·çš„è¯·æ±‚ã€‚</li><li><strong>å‰Šå³°å¡«è°·</strong>ï¼Œå‰Šå¹³çŸ­æš‚çš„æµé‡é«˜å³°ï¼Œæ¶ˆæ¯å †ç§¯ä¼šé€ æˆè¯·æ±‚å»¶è¿Ÿå¤„ç†ï¼Œä½†ç§’æ€ç”¨æˆ·å¯¹äºçŸ­æš‚å»¶è¿Ÿæœ‰ä¸€å®šå®¹å¿åº¦ã€‚ç§’æ€å•†å“æœ‰ 1000 ä»¶ï¼Œå¤„ç†ä¸€æ¬¡è´­ä¹°è¯·æ±‚çš„æ—¶é—´æ˜¯ 500msï¼Œé‚£ä¹ˆæ€»å…±å°±éœ€è¦ 500s çš„æ—¶é—´ã€‚è¿™æ—¶ä½ éƒ¨ç½² 10 ä¸ªé˜Ÿåˆ—å¤„ç†ç¨‹åºï¼Œé‚£ä¹ˆç§’æ€è¯·æ±‚çš„å¤„ç†æ—¶é—´å°±æ˜¯ 50sï¼Œä¹Ÿå°±æ˜¯è¯´ç”¨æˆ·éœ€è¦ç­‰å¾… 50s æ‰å¯ä»¥çœ‹åˆ°ç§’æ€çš„ç»“æœï¼Œè¿™æ˜¯å¯ä»¥æ¥å—çš„ã€‚è¿™æ—¶ä¼š<strong>å¹¶å‘ 10 ä¸ª</strong>è¯·æ±‚åˆ°è¾¾æ•°æ®åº“ï¼Œå¹¶ä¸ä¼šå¯¹æ•°æ®åº“é€ æˆå¾ˆå¤§çš„å‹åŠ›ã€‚</li></ul><p><strong>é€šè¿‡å¼‚æ­¥å¤„ç†ç®€åŒ–ç§’æ€è¯·æ±‚ä¸­çš„ä¸šåŠ¡æµç¨‹</strong></p><p>â€‹å…ˆå¤„ç†ä¸»è¦çš„ä¸šåŠ¡ï¼Œå¼‚æ­¥å¤„ç†æ¬¡è¦çš„ä¸šåŠ¡ã€‚</p><ul><li>å¦‚ä¸»è¦æµç¨‹æ˜¯<strong>ç”Ÿæˆè®¢å•</strong>ã€<strong>æ‰£å‡åº“å­˜</strong>ï¼›</li><li>æ¬¡è¦æµç¨‹æ¯”å¦‚è´­ä¹°æˆåŠŸä¹‹åä¼šç»™ç”¨æˆ·<strong>å‘ä¼˜æƒ åˆ¸</strong>ï¼Œ<strong>å¢åŠ ç”¨æˆ·çš„ç§¯****åˆ†</strong>ã€‚</li><li>æ­¤æ—¶ç§’æ€åªè¦å¤„ç†ç”Ÿæˆè®¢å•ï¼Œæ‰£å‡åº“å­˜çš„è€—æ—¶ï¼Œå‘æ”¾ä¼˜æƒ åˆ¸ã€å¢åŠ ç”¨æˆ·ç§¯åˆ†å¼‚æ­¥å»å¤„ç†äº†ã€‚</li></ul><p><strong>è§£è€¦</strong></p><p>â€‹å®ç°ç§’æ€ç³»ç»Ÿæ¨¡å—ä¹‹é—´æ¾è€¦åˆå°†ç§’æ€æ•°æ®åŒæ­¥ç»™æ•°æ®å›¢é˜Ÿï¼Œæœ‰ä¸¤ç§æ€è·¯ï¼š</p><ul><li>ä½¿ç”¨ HTTP æˆ–è€… RPC åŒæ­¥è°ƒç”¨ï¼Œå³æä¾›ä¸€ä¸ªæ¥å£ï¼Œå®æ—¶å°†æ•°æ®æ¨é€ç»™æ•°æ®æœåŠ¡ã€‚<strong>ç³»ç»Ÿçš„è€¦åˆåº¦é«˜</strong>ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªæœåŠ¡æœ‰é—®é¢˜ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¦ä¸€ä¸ªæœåŠ¡ä¸å¯ç”¨ã€‚</li><li>ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—<strong>å°†æ•°æ®å…¨éƒ¨å‘é€ç»™æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼Œç„¶å<strong>æ•°æ®æœåŠ¡è®¢é˜…è¿™ä¸ªæ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼Œæ¥æ”¶æ•°æ®è¿›è¡Œå¤„ç†ã€‚</li></ul><h3 id="7ã€å¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§"><a href="#7ã€å¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§" class="headerlink" title="7ã€å¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§"></a><strong>7ã€å¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§</strong></h3><p><strong>CacheAsideæ—è·¯ç¼“å­˜</strong>è¯»è¯·æ±‚ä¸å‘½ä¸­æŸ¥è¯¢æ•°æ®åº“ï¼ŒæŸ¥è¯¢å®Œæˆå†™å…¥ç¼“å­˜ï¼Œå†™è¯·æ±‚æ›´æ–°æ•°æ®åº“ååˆ é™¤ç¼“å­˜æ•°æ®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å»¶è¿ŸåŒåˆ ï¼Œç”¨ä»¥ä¿è¯æœ€ç»ˆä¸€è‡´æ€§,é˜²æ­¢å°æ¦‚ç‡æ—§æ•°æ®è¯»è¯·æ±‚åœ¨ç¬¬ä¸€æ¬¡åˆ é™¤åæ›´æ–°æ•°æ®åº“</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(String key,Object data)</span>&#123;</span><br><span class="line">redis.delKey(key);</span><br><span class="line">db.updateData(data);</span><br><span class="line">Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">redis.delKey(key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºé˜²ç¼“å­˜å¤±æ•ˆè¿™ä¸€ä¿¡æ¯ä¸¢å¤±ï¼Œå¯ç”¨æ¶ˆæ¯é˜Ÿåˆ—ç¡®ä¿ã€‚</p><ul><li>æ›´æ–°æ•°æ®åº“æ•°æ®ï¼›</li><li>æ•°æ®åº“ä¼šå°†æ“ä½œä¿¡æ¯å†™å…¥binlogæ—¥å¿—å½“ä¸­ï¼›</li><li>å¦èµ·ä¸€æ®µéä¸šåŠ¡ä»£ç ï¼Œç¨‹åºè®¢é˜…æå–å‡ºæ‰€éœ€è¦çš„æ•°æ®ä»¥åŠkeyï¼›</li><li>å°è¯•åˆ é™¤ç¼“å­˜æ“ä½œï¼Œè‹¥åˆ é™¤å¤±è´¥ï¼Œå°†è¿™äº›ä¿¡æ¯å‘é€è‡³æ¶ˆæ¯é˜Ÿåˆ—ï¼›</li><li>é‡æ–°ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å¾—è¯¥æ•°æ®ï¼Œé‡è¯•æ“ä½œï¼›</li></ul><p>è®¢é˜…<strong>binlogç¨‹åºåœ¨mysqlä¸­æœ‰ç°æˆçš„ä¸­é—´</strong>ä»¶å«canalï¼Œé‡è¯•æœºåˆ¶ï¼Œä¸»è¦é‡‡ç”¨çš„æ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼ã€‚</p><p><strong>ç»ˆææ–¹æ¡ˆï¼šè¯·æ±‚ä¸²è¡ŒåŒ–</strong></p><p>çœŸæ­£é è°±éç§’æ€çš„æ–¹æ¡ˆï¼šå°†è®¿é—®æ“ä½œä¸²è¡ŒåŒ–</p><ol><li>å…ˆåˆ ç¼“å­˜ï¼Œå°†æ›´æ–°æ•°æ®åº“çš„<strong>å†™æ“ä½œæ”¾è¿›æœ‰åºé˜Ÿåˆ—ä¸­</strong></li><li>ä»ç¼“å­˜æŸ¥ä¸åˆ°çš„<strong>è¯»æ“ä½œä¹Ÿè¿›å…¥æœ‰åºé˜Ÿåˆ—</strong></li></ol><p>éœ€è¦è§£å†³çš„é—®é¢˜ï¼š</p><ol><li>è¯»è¯·æ±‚ç§¯å‹ï¼Œå¤§é‡è¶…æ—¶ï¼Œå¯¼è‡´æ•°æ®åº“çš„å‹åŠ›ï¼šé™æµã€ç†”æ–­</li><li>å¦‚ä½•é¿å…å¤§é‡è¯·æ±‚ç§¯å‹ï¼šå°†é˜Ÿåˆ—æ°´å¹³æ‹†åˆ†ï¼Œæé«˜å¹¶è¡Œåº¦ã€‚</li></ol><h3 id="8ã€å¯é æ€§å¦‚ä½•ä¿éšœ"><a href="#8ã€å¯é æ€§å¦‚ä½•ä¿éšœ" class="headerlink" title="8ã€å¯é æ€§å¦‚ä½•ä¿éšœ**"></a>8ã€å¯é æ€§å¦‚ä½•ä¿éšœ**</h3><p>â€‹ç”±ä¸€ä¸ªæˆ–å¤šä¸ªsentinelå®ä¾‹ç»„æˆsentinelé›†ç¾¤å¯ä»¥ç›‘è§†ä¸€ä¸ªæˆ–å¤šä¸ªä¸»æœåŠ¡å™¨å’Œå¤šä¸ªä»æœåŠ¡å™¨ã€‚<strong>å“¨å…µæ¨¡å¼é€‚åˆè¯»è¯·æ±‚è¿œå¤šäºå†™è¯·æ±‚çš„ä¸šåŠ¡åœºæ™¯ï¼Œæ¯”å¦‚åœ¨ç§’æ€ç³»ç»Ÿ</strong>ä¸­ç”¨æ¥ç¼“å­˜æ´»åŠ¨ä¿¡æ¯ã€‚ å¦‚æœå†™è¯·æ±‚è¾ƒå¤šï¼Œå½“é›†ç¾¤ Slave èŠ‚ç‚¹æ•°é‡å¤šäº†åï¼ŒMaster èŠ‚ç‚¹åŒæ­¥æ•°æ®çš„å‹åŠ›ä¼šéå¸¸å¤§ã€‚</p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gluq6vlvglj30nw0e076f.jpg" alt="image-20201220231241725" style="zoom:50%;" /><p>â€‹å½“ä¸»æœåŠ¡å™¨è¿›å…¥ä¸‹çº¿çŠ¶æ€æ—¶ï¼Œsentinelå¯ä»¥å°†è¯¥ä¸»æœåŠ¡å™¨ä¸‹çš„æŸä¸€ä»æœåŠ¡å™¨å‡çº§ä¸ºä¸»æœåŠ¡å™¨ç»§ç»­æä¾›æœåŠ¡ï¼Œä»è€Œä¿è¯redisçš„é«˜å¯ç”¨æ€§ã€‚ </p><h3 id="9ã€ç§’æ€ç³»ç»Ÿç“¶é¢ˆ-æ—¥å¿—"><a href="#9ã€ç§’æ€ç³»ç»Ÿç“¶é¢ˆ-æ—¥å¿—" class="headerlink" title="9ã€ç§’æ€ç³»ç»Ÿç“¶é¢ˆ-æ—¥å¿—"></a>9ã€ç§’æ€ç³»ç»Ÿç“¶é¢ˆ-æ—¥å¿—</h3><blockquote><p>ç§’æ€æœåŠ¡å•èŠ‚ç‚¹éœ€è¦å¤„ç†çš„è¯·æ±‚ QPS å¯èƒ½è¾¾åˆ° 10 ä¸‡ä»¥ä¸Šã€‚ä¸€ä¸ªè¯·æ±‚ä»è¿›å…¥ç§’æ€æœåŠ¡åˆ°å¤„ç†å¤±è´¥æˆ–è€…æˆåŠŸï¼Œè‡³å°‘ä¼šäº§ç”Ÿä¸¤æ¡æ—¥å¿—ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé«˜å³°æœŸé—´ï¼Œä¸€ä¸ªç§’æ€èŠ‚ç‚¹æ¯ç§’äº§ç”Ÿçš„æ—¥å¿—å¯èƒ½è¾¾åˆ° <strong>30 ä¸‡æ¡</strong>ä»¥ä¸Š</p></blockquote><p>â€‹ä¸€å—æ€§èƒ½æ¯”è¾ƒå¥½çš„å›ºæ€ç¡¬ç›˜ï¼Œæ¯ç§’å†™çš„IOPS å¤§æ¦‚åœ¨ 3 ä¸‡å·¦å³ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªç§’æ€èŠ‚ç‚¹çš„æ¯ç§’æ—¥å¿—æ¡æ•°æ˜¯å›ºæ€ç¡¬ç›˜ IOPS çš„ 10 å€ï¼Œç£ç›˜éƒ½æ‰›ä¸ä½ï¼Œæ›´åˆ«è¯´é€šè¿‡ç½‘ç»œå†™å…¥åˆ°ç›‘æ§ç³»ç»Ÿä¸­ã€‚</p><ul><li><strong>æ¯ç§’æ—¥å¿—é‡è¿œé«˜äºç£ç›˜ IOPS</strong>ï¼Œç›´æ¥å†™ç£ç›˜ä¼šå½±å“æœåŠ¡æ€§èƒ½å’Œç¨³å®šæ€§</li><li>å¤§é‡æ—¥å¿—å¯¼è‡´æœåŠ¡é¢‘ç¹åˆ†é…ï¼Œ<strong>é¢‘ç¹é‡Šæ”¾å†…å­˜ï¼Œå½±å“æœåŠ¡æ€§èƒ½</strong>ã€‚</li><li>æœåŠ¡å¼‚å¸¸é€€å‡º<strong>ä¸¢å¤±å¤§é‡æ—¥å¿—</strong>çš„é—®é¢˜</li></ul><p><strong>è§£å†³æ–¹æ¡ˆ</strong></p><ul><li><strong>Tmpfs</strong>ï¼Œå³ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒæ˜¯ä¸€ç§åŸºäºå†…å­˜çš„æ–‡ä»¶ç³»ç»Ÿã€‚æˆ‘ä»¬å¯ä»¥å°†ç§’æ€æœåŠ¡å†™æ—¥å¿—çš„æ–‡ä»¶æ”¾åœ¨ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚ç›¸æ¯”ç›´æ¥å†™ç£ç›˜ï¼Œåœ¨ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿä¸­å†™æ—¥å¿—çš„æ€§èƒ½è‡³å°‘<strong>èƒ½æå‡ 100 å€</strong>ï¼Œæ¯å½“æ—¥å¿—æ–‡ä»¶è¾¾åˆ° 20MB çš„æ—¶å€™ï¼Œå°±å°†<strong>æ—¥å¿—æ–‡ä»¶è½¬ç§»åˆ°ç£ç›˜ä¸Š</strong>ï¼Œå¹¶å°†ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ—¥å¿—æ–‡ä»¶æ¸…ç©ºã€‚</li><li>å¯ä»¥å‚è€ƒå†…å­˜æ± è®¾è®¡ï¼Œå°†ç»™loggeråˆ†é…ç¼“å†²åŒºï¼Œæ¯ä¸€æ¬¡çš„æ–°å†™å¯ä»¥å¤ç”¨Loggerå¯¹è±¡</li><li>å‚è€ƒkafkaçš„ç¼“å†²æ± è®¾è®¡ï¼Œå½“ç¼“å†²åŒºè¾¾åˆ°å¤§å°å’Œé—´éš”æ—¶é•¿ä¸´ç•Œå€¼æ—¶ï¼Œè°ƒç”¨Flushå‡½æ•°ï¼Œå‡å°‘ä¸¢å¤±çš„é£é™©</li></ul><p><strong>10ã€æ± åŒ–æŠ€æœ¯</strong></p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6japwof2j31520na4mh.jpg" alt="image-20210504174220668"></p><p>â€‹é€šå¸¸å¯ä»¥é‡‡ç”¨<strong>å¾ªç¯é˜Ÿåˆ—</strong>æ¥ä¿å­˜ç©ºé—²è¿æ¥ã€‚ä½¿ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥ä»é˜Ÿåˆ—å¤´éƒ¨å–å‡ºè¿æ¥ï¼Œç”¨å®Œåå°†ç©ºé—²è¿æ¥æ”¾åˆ°é˜Ÿåˆ—å°¾éƒ¨ã€‚Nettyä¸­åˆ©ç”¨å¸¦ç¼“å†²åŒºçš„ channel æ¥å……å½“é˜Ÿåˆ—ã€‚</p><h2 id="ä¸‰ã€å³æ—¶é€šä¿¡"><a href="#ä¸‰ã€å³æ—¶é€šä¿¡" class="headerlink" title="ä¸‰ã€å³æ—¶é€šä¿¡"></a>ä¸‰ã€å³æ—¶é€šä¿¡</h2><h3 id="1ã€å•èŠæ¶ˆæ¯å¯é ä¼ è¾“"><a href="#1ã€å•èŠæ¶ˆæ¯å¯é ä¼ è¾“" class="headerlink" title="1ã€å•èŠæ¶ˆæ¯å¯é ä¼ è¾“"></a>1ã€<strong>å•èŠæ¶ˆæ¯å¯é ä¼ è¾“</strong></h3><p>TCPä¿è¯æ¶ˆæ¯å¯é ä¼ è¾“ä¸‰æ¿æ–§ï¼šè¶…æ—¶ã€é‡ä¼ ã€ç¡®è®¤ã€‚æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯é€šä¿¡MSGå’ŒACKçš„å…±è®¡6ä¸ªæŠ¥æ–‡</p><ul><li>è¯·æ±‚æŠ¥æ–‡ï¼ˆrequestï¼Œåç®€ç§°ä¸ºä¸ºRï¼‰ï¼Œå®¢æˆ·ç«¯ä¸»åŠ¨å‘é€ç»™æœåŠ¡ç«¯ã€‚</li><li>åº”ç­”æŠ¥æ–‡ï¼ˆacknowledgeï¼Œåç®€ç§°ä¸ºAï¼‰ï¼ŒæœåŠ¡å™¨è¢«åŠ¨åº”ç­”å®¢æˆ·ç«¯çš„æŠ¥æ–‡ã€‚</li><li>é€šçŸ¥æŠ¥æ–‡ï¼ˆnotifyï¼Œåç®€ç§°ä¸ºNï¼‰ï¼ŒæœåŠ¡å™¨ä¸»åŠ¨å‘é€ç»™å®¢æˆ·ç«¯çš„æŠ¥æ–‡</li></ul><p><strong>åœ¨çº¿æ¶ˆæ¯æµç¨‹ï¼š</strong></p><p>â€‹A æ¶ˆæ¯è¯·æ±‚  <strong>MSG:R</strong>  &#x3D;&gt; S æ¶ˆæ¯åº”ç­”  <strong>MSG:A</strong>  &#x3D;&gt; S æ¶ˆæ¯é€šçŸ¥B  <strong>MSG:N</strong> </p><p>â€‹S ç¡®è®¤é€šçŸ¥  <strong>ACK:N</strong>  &lt;&#x3D;  S ç¡®è®¤åº”ç­”  <strong>ACK:A</strong>  &lt;&#x3D;  Bç¡®è®¤è¯·æ±‚S  <strong>ACK:R</strong> </p><p><strong>è¶…æ—¶ä¸é‡ä¼ ã€ç¡®è®¤å’Œå»é‡ï¼š</strong></p><p>â€‹Aå‘å‡ºäº† <strong>MSG:R</strong> ï¼Œæ”¶åˆ°äº†<strong>MSG:A</strong>ä¹‹åï¼Œåœ¨ä¸€ä¸ªæœŸå¾…çš„æ—¶é—´å†…ï¼Œå¦‚æœæ²¡æœ‰æ”¶åˆ°<strong>ACK:N</strong>ï¼ŒAä¼šå°è¯•å°† <strong>MSG:R</strong>  é‡å‘ã€‚å¯èƒ½AåŒæ—¶å‘å‡ºäº†å¾ˆå¤šæ¶ˆæ¯ï¼Œæ‰€ä»¥Aéœ€è¦åœ¨æœ¬åœ°ç»´æŠ¤ä¸€ä¸ªç­‰å¾…acké˜Ÿåˆ—ï¼Œå¹¶é…åˆtimerè¶…æ—¶æœºåˆ¶ï¼Œæ¥è®°å½•å“ªäº›æ¶ˆæ¯æ²¡æœ‰æ”¶åˆ°<strong>ACK:N</strong>ï¼Œå®šæ—¶é‡å‘ã€‚ç¡®è®¤ACK<strong>ä¿è¯å¿…è¾¾</strong>ï¼Œå»é‡ä¿è¯<strong>å”¯ä¸€</strong></p><p><strong>ç¦»çº¿æ¶ˆæ¯æµç¨‹</strong></p><p>â€‹åŸæ–¹æ¡ˆï¼šæ ¹æ®ç¦»çº¿å¥½å‹çš„æ ‡è¯†ï¼Œäº¤äº’æ‹‰å–æŒ‡å®šçš„æ¶ˆæ¯</p><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gm8kxci29zj30b305974z.jpg" alt="IMæ¶ˆæ¯é€è¾¾ä¿è¯æœºåˆ¶å®ç°(äºŒ)ï¼šä¿è¯ç¦»çº¿æ¶ˆæ¯çš„å¯é æŠ•é€’_2.png"></p><p>ä¼˜åŒ–çš„æ–¹æ¡ˆï¼š</p><ul><li>å¦‚ç”¨æˆ·<strong>å‹¾é€‰å…¨é‡</strong>åˆ™è¿”å›è®¡æ•°ï¼Œåœ¨ç”¨æˆ·ç‚¹å‡»æ—¶æ‹‰å–ã€‚</li><li>å¦‚ç”¨æˆ·æœªå‹¾é€‰å…¨é‡åˆ™è¿”å›<strong>æœ€è¿‘å…¨éƒ¨ç¦»çº¿æ¶ˆæ¯</strong>ï¼Œå®¢æˆ·ç«¯é’ˆå¯¹<strong>ç”¨æˆ·idè¿›è¡Œè®¡ç®—</strong>ã€‚</li><li>å…¨é‡ç¦»çº¿ä¿¡æ¯å¯ä»¥é€šè¿‡å®¢æˆ·ç«¯å¼‚æ­¥çº¿ç¨‹åˆ†é¡µæ‹‰å–ï¼Œå‡å°‘å¡é¡¿</li><li>å°†ACKå’Œåˆ†é¡µç¬¬äºŒæ¬¡æ‹‰å–çš„æŠ¥æ–‡é‡åˆï¼Œå¯ä»¥è¾ƒå°‘ç¦»çº¿æ¶ˆæ¯æ‹‰å–äº¤äº’çš„æ¬¡æ•°</li></ul><h3 id="2ã€ç¾¤èŠæ¶ˆæ¯å¦‚ä½•ä¿è¯ä¸ä¸¢ä¸é‡"><a href="#2ã€ç¾¤èŠæ¶ˆæ¯å¦‚ä½•ä¿è¯ä¸ä¸¢ä¸é‡" class="headerlink" title="2ã€ç¾¤èŠæ¶ˆæ¯å¦‚ä½•ä¿è¯ä¸ä¸¢ä¸é‡"></a><strong>2ã€ç¾¤èŠæ¶ˆæ¯å¦‚ä½•ä¿è¯ä¸ä¸¢ä¸é‡</strong></h3><blockquote><p>åœ¨çº¿çš„ç¾¤å‹èƒ½ç¬¬ä¸€æ—¶é—´æ”¶åˆ°æ¶ˆæ¯ï¼›<br>ç¦»çº¿çš„ç¾¤å‹èƒ½åœ¨ç™»é™†åæ”¶åˆ°æ¶ˆæ¯ã€‚</p></blockquote><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gm8jswr3poj30hh078dg2.jpg" alt="IMç¾¤èŠæ¶ˆæ¯å¦‚æ­¤å¤æ‚ï¼Œå¦‚ä½•ä¿è¯ä¸ä¸¢ä¸é‡ï¼Ÿ_1.jpg"></p><ul><li>ç¾¤æ¶ˆæ¯å‘é€è€…xå‘serverå‘å‡ºç¾¤æ¶ˆæ¯ï¼›</li><li>serverå»dbä¸­æŸ¥è¯¢ç¾¤ä¸­æœ‰å¤šå°‘ç”¨æˆ·(x,A,B,C,D)ï¼›</li><li>serverå»cacheä¸­æŸ¥è¯¢è¿™äº›ç”¨æˆ·çš„åœ¨çº¿çŠ¶æ€ï¼›</li><li>å¯¹äºç¾¤ä¸­åœ¨çº¿çš„ç”¨æˆ·Aä¸Bï¼Œç¾¤æ¶ˆæ¯serverè¿›è¡Œå®æ—¶æ¨é€ï¼›</li><li>å¯¹äºç¾¤ä¸­ç¦»çº¿çš„ç”¨æˆ·Cä¸Dï¼Œç¾¤æ¶ˆæ¯serverè¿›è¡Œç¦»çº¿å­˜å‚¨ã€‚</li></ul><p>â€‹    å¯¹äºåŒä¸€ä»½ç¾¤æ¶ˆæ¯çš„å†…å®¹ï¼Œå¤šä¸ªç¦»çº¿ç”¨æˆ·å­˜å‚¨äº†å¾ˆå¤šä»½ã€‚å‡è®¾ç¾¤ä¸­æœ‰200ä¸ªç”¨æˆ·ç¦»çº¿ï¼Œç¦»çº¿æ¶ˆæ¯åˆ™å†—ä½™äº†200ä»½ï¼Œè¿™æå¤§çš„å¢åŠ äº†æ•°æ®åº“çš„å­˜å‚¨å‹åŠ›</p><ul><li><p>ç¦»çº¿æ¶ˆæ¯è¡¨åªå­˜å‚¨ç”¨æˆ·çš„ç¾¤ç¦»çº¿æ¶ˆæ¯msg_idï¼Œé™ä½æ•°æ®åº“çš„å†—ä½™å­˜å‚¨é‡</p></li><li><p>åŠ å…¥åº”ç”¨å±‚çš„ACKï¼Œæ‰èƒ½ä¿è¯ç¾¤æ¶ˆæ¯ä¸€å®šåˆ°è¾¾ï¼ŒæœåŠ¡ç«¯å¹‚ç­‰æ€§æ ¡éªŒåŠå®¢æˆ·ç«¯å»é‡ï¼Œä¿è¯ä¸é‡å¤</p></li><li><p>æ¯æ¡ç¾¤æ¶ˆæ¯éƒ½ACKï¼Œä¼šç»™æœåŠ¡å™¨é€ æˆå·¨å¤§çš„å†²å‡»ï¼Œé€šè¿‡æ‰¹é‡ACKå‡å°‘æ¶ˆæ¯é£æš´æ‰©æ•£ç³»æ•°çš„å½±å“</p></li><li><p>ç¾¤ç¦»çº¿æ¶ˆæ¯è¿‡å¤šï¼šæ‹‰å–è¿‡æ…¢ï¼Œå¯ä»¥é€šè¿‡åˆ†é¡µæ‡’æ‹‰å–æ”¹å–„ã€‚</p></li></ul><h3 id="3ã€å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„æ—¶åºæ€§"><a href="#3ã€å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„æ—¶åºæ€§" class="headerlink" title="3ã€å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„æ—¶åºæ€§"></a>3ã€<strong>å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„æ—¶åºæ€§</strong></h3><p>æ–¹æ¡ˆï¼š</p><ul><li>Idé€šè¿‡å€Ÿé‰´å¾®ä¿¡å·æ®µ+è·³è·ƒçš„æ–¹å¼ä¿è¯è¶‹åŠ¿é€’å¢</li><li>å•èŠå€Ÿé‰´æ•°æ®åº“è®¾è®¡ï¼Œå•ç‚¹åºåˆ—åŒ–åŒæ­¥åˆ°å…¶ä»–èŠ‚ç‚¹ä¿è¯å¤šæœºæ—¶åº</li><li>ç¾¤èŠæ¶ˆæ¯ä½¿ç”¨å•ç‚¹åºåˆ—åŒ–ä¿è¯å„ä¸ªå‘é€è€…çš„æ¶ˆæ¯ç›¸å¯¹æ—¶åº</li></ul><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gm8m1ge2ksj30j707gt96.jpg" alt="å¦‚ä½•ä¿è¯IMå®æ—¶æ¶ˆæ¯çš„â€œæ—¶åºæ€§â€ä¸â€œä¸€è‡´æ€§â€ï¼Ÿ_10.jpg"></p><p>ä¼˜åŒ–ï¼š</p><ul><li>åˆ©ç”¨æœåŠ¡å™¨å•ç‚¹åºåˆ—åŒ–æ—¶åºï¼Œå¯èƒ½å‡ºç°æœåŠ¡ç«¯æ”¶åˆ°æ¶ˆæ¯çš„æ—¶åºï¼Œä¸å‘å‡ºåºåˆ—ä¸ä¸€è‡´</li><li>åœ¨Aå¾€Bå‘å‡ºçš„æ¶ˆæ¯ä¸­ï¼ŒåŠ ä¸Šå‘é€æ–¹Aæœ¬åœ°çš„ä¸€ä¸ªç»å¯¹æ—¶åºï¼Œæ¥è¡¨ç¤ºæ¥æ”¶æ–¹Bçš„å±•ç°æ—¶åºã€‚</li><li>ç¾¤èŠæ¶ˆæ¯ä¿è¯ä¸€ä¸ªç¾¤èŠè½åœ¨ä¸€ä¸ªserviceä¸Šç„¶åé€šè¿‡æœ¬åœ°é€’å¢è§£å†³å…¨å±€é€’å¢çš„ç“¶é¢ˆé—®é¢˜</li></ul><h3 id="4ï¼šæ¨æ‹‰ç»“åˆ"><a href="#4ï¼šæ¨æ‹‰ç»“åˆ" class="headerlink" title="4ï¼šæ¨æ‹‰ç»“åˆ"></a><strong>4ï¼šæ¨æ‹‰ç»“åˆ</strong></h3><p>å†å²æ–¹æ¡ˆï¼š</p><ul><li>æœåŠ¡å™¨åœ¨ç¼“å­˜é›†ç¾¤é‡Œå­˜å‚¨æ‰€æœ‰ç”¨æˆ·çš„åœ¨çº¿çŠ¶æ€ -&gt; ä¿è¯çŠ¶æ€å¯æŸ¥</li><li>ç”¨æˆ·çŠ¶æ€å®æ—¶å˜æ›´ï¼Œä»»ä½•ç”¨æˆ·ç™»å½•&#x2F;ç™»å‡ºæ—¶ï¼Œéœ€è¦æ¨é€æ‰€æœ‰å¥½å‹æ›´æ–°çŠ¶æ€</li><li>Aç™»å½•æ—¶ï¼Œå…ˆå»æ•°æ®åº“æ‹‰å–è‡ªå·±çš„å¥½å‹åˆ—è¡¨ï¼Œå†å»ç¼“å­˜è·å–æ‰€æœ‰å¥½å‹çš„åœ¨çº¿çŠ¶æ€</li></ul><p><strong>â€œæ¶ˆæ¯é£æš´æ‰©æ•£ç³»æ•°â€</strong>æ˜¯æŒ‡ä¸€ä¸ªæ¶ˆæ¯å‘å‡ºæ—¶ï¼Œå˜æˆNä¸ªæ¶ˆæ¯çš„æ‰©æ•£ç³»æ•°ï¼Œè¿™ä¸ªç³»æ•°ä¸ä¸šåŠ¡åŠæ•°æ®ç›¸å…³ï¼Œä¸€å®šç¨‹åº¦ä¸Šå®ƒçš„å¤§å°å†³å®šäº†æŠ€æœ¯é‡‡ç”¨æ¨é€è¿˜æ˜¯æ‹‰å–ã€‚</p><p>ä¼˜åŒ–æ–¹æ¡ˆï¼š</p><ul><li><strong>å¥½å‹çŠ¶æ€æ¨æ‹‰ç»“åˆ</strong>ï¼Œé¦–é¡µç½®é¡¶äº²å¯†ã€å½“å‰ç¾¤èŠï¼Œé‡‡ç”¨æ¨é€ï¼Œå¦åˆ™å¯ä»¥é‡‡ç”¨è½®è¯¢æ‹‰å–çš„æ–¹å¼åŒæ­¥ï¼›</li><li><strong>ç¾¤å‹çš„çŠ¶æ€</strong>ï¼Œç”±äºæ¶ˆæ¯é£æš´æ‰©æ•£ç³»æ•°è¿‡å¤§ï¼Œå¯ä»¥é‡‡ç”¨æŒ‰éœ€æ‹‰å–ï¼Œå»¶æ—¶æ‹‰å–çš„æ–¹å¼åŒæ­¥ï¼›</li><li><strong>ç³»ç»Ÿæ¶ˆæ¯&#x2F;å¼€å±å¹¿å‘Šç­‰</strong>è¿™ç§å®æ—¶äº§ç”Ÿçš„æ¶ˆæ¯ï¼Œå¯ä»¥é‡‡ç”¨æ¨é€çš„æ–¹å¼è·å–æ¶ˆæ¯ï¼›</li></ul><h3 id="5ã€å¥½å‹æ¨è"><a href="#5ã€å¥½å‹æ¨è" class="headerlink" title="5ã€å¥½å‹æ¨è"></a>5ã€å¥½å‹æ¨è</h3><p>Neo4j å›¾è°±æ•°æ®åº“</p><h2 id="å››ã€æ™ºæ…§ç¤¾åŒº"><a href="#å››ã€æ™ºæ…§ç¤¾åŒº" class="headerlink" title="å››ã€æ™ºæ…§ç¤¾åŒº"></a>å››ã€æ™ºæ…§ç¤¾åŒº</h2><p>â€‹18å¹´åˆï¼Œé’ˆå¯¹æˆ‘ä»¬Dubboæ¡†æ¶çš„æ™ºæ…§æ¥¼å®‡é¡¹ç›®çš„å•ä½“æœåŠ¡æ˜¾å¾—ååˆ†ç¬¨é‡ï¼Œéœ€è¦é‡‡ç”¨å¾®æœåŠ¡çš„å½¢å¼è¿›è¡Œæ¶æ„çš„é‡æ–°è®¾è®¡ï¼Œå½“æ—¶ï¼Œæˆ‘é˜…è¯»äº†<em>Eric Evans</em> å†™çš„ã€Šé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼šè½¯ä»¶æ ¸å¿ƒå¤æ‚æ€§åº”å¯¹ä¹‹é“ã€‹å’Œ<em>Martin</em> <em>fowler</em>çš„ã€Šå¾®æœåŠ¡æ¶æ„ï¼š<em>Microservice</em>ã€‹ä¸¤æœ¬é‡é‡çº§ä¹¦ç±ï¼Œä¹¦ä¸­äº†è§£åˆ°è½¬å‹å¾®æœåŠ¡çš„é‡è¦åŸå› ä¹‹ä¸€å°±æ˜¯åˆ©ç”¨<strong>åˆ†æ²»çš„æ€æƒ³</strong>å‡å°‘ç³»ç»Ÿçš„å¤æ‚æ€§ï¼Œæ˜¯ä¸€ç§é’ˆå¯¹<strong>å¤æ‚é—®é¢˜çš„å®è§‚è®¾è®¡</strong>ï¼Œæ¥åº”å¯¹ç³»ç»Ÿåæ¥è§„æ¨¡è¶Šæ¥è¶Šå¤§ï¼Œç»´æŠ¤è¶Šæ¥è¶Šå›°éš¾çš„é—®é¢˜ã€‚ç„¶è€Œï¼Œæ‹†åˆ†æˆå¾®æœåŠ¡ä»¥åï¼Œå¹¶<strong>ä¸æ„å‘³ç€æ¯ä¸ªå¾®æœåŠ¡éƒ½æ˜¯å„è‡ªç‹¬ç«‹åœ°è¿è¡Œ</strong>ï¼Œè€Œæ˜¯å½¼æ­¤åä½œåœ°ç»„ç»‡åœ¨ä¸€èµ·ã€‚è¿™å°±å¥½åƒä¸€ä¸ªå›¢é˜Ÿï¼Œ<strong>è§„æ¨¡è¶Šå¤§è¶Šéœ€è¦ä¸€äº›æ–¹æ³•æ¥ç»„ç»‡</strong>ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬éœ€è¦DDDæ¨¡å‹ä¸ºæˆ‘ä»¬çš„æ¶æ„è®¾è®¡æä¾›ç†è®ºå¹¶å®è·µçš„æ–¹æ³•ã€‚</p><p>â€‹å½“æ—¶æ¯æ¬¡ç‰ˆæœ¬æ›´æ–°è¿­ä»£åŠ¨è¾„åå‡ ä¸ªå¾®æœåŠ¡åŒæ—¶ä¿®æ”¹ï¼Œæœ‰æ—¶ä¸€ä¸ªç®€å•çš„æ•°æ®åº“å­—æ®µå˜æ›´ï¼Œä¹Ÿéœ€è¦åŒæ—¶å˜æ›´å¤šä¸ªå¾®æœåŠ¡ï¼Œå¼•èµ·äº†å›¢é˜Ÿçš„åæ€ï¼šå¾®æœåŠ¡åŒ–çœ‹ä¸Šå»å¹¶æ²¡æœ‰å‡å°‘æˆ‘ä»¬çš„å·¥ä½œé‡ã€‚ã€Šä¼ä¸šæ¶æ„è®¾è®¡ã€‹ä¸­å¯¹äºå¾®æœåŠ¡çš„å®šä¹‰æ˜¯<strong>å°è€Œä¸“</strong>ï¼Œä½†åœ¨èµ·åˆçš„è®¾è®¡æ—¶ï¼Œæˆ‘ä»¬åªç‰‡é¢çš„<strong>ç†è§£äº†å°å´å¿½è§†äº†ä¸“</strong>ï¼Œæ­¤æ—¶æˆ‘ä»¬æ‰æ„è¯†åˆ°æ‹†åˆ†çš„å…³é”®æ˜¯è¦ä¿è¯å¾®æœåŠ¡å†…é«˜å†…èšï¼Œå¾®æœåŠ¡é—´ä½è€¦åˆã€‚</p><h3 id="ç‰©è”ç½‘æ¶æ„"><a href="#ç‰©è”ç½‘æ¶æ„" class="headerlink" title="ç‰©è”ç½‘æ¶æ„"></a><strong>ç‰©è”ç½‘æ¶æ„</strong></h3><blockquote><p>ç‰©è”ç½‘æ˜¯äº’è”ç½‘çš„<strong>å¤–å»¶</strong>ã€‚å°†ç”¨æˆ·ç«¯<strong>å»¶ä¼¸</strong>å’Œæ‰©å±•åˆ°ç‰©ä¸äººçš„è¿æ¥ã€‚ç‰©è”ç½‘æ¨¡å¼ä¸­ï¼Œæ‰€æœ‰<strong>ç‰©å“ä¸ç½‘ç»œè¿æ¥</strong>ï¼Œå¹¶è¿›è¡Œé€šä¿¡å’Œåœºæ™¯è”åŠ¨ã€‚äº’è”ç½‘é€šè¿‡<strong>ç”µè„‘ã€ç§»åŠ¨ç»ˆç«¯</strong>ç­‰è®¾å¤‡å°†å‚ä¸è€…è”ç³»èµ·æ¥ï¼Œå½¢æˆçš„ä¸€ç§å…¨æ–°çš„<strong>ä¿¡æ¯äº’æ¢æ–¹å¼</strong></p></blockquote><h4 id="DCMç³»ç»Ÿæ¶æ„"><a href="#DCMç³»ç»Ÿæ¶æ„" class="headerlink" title="DCMç³»ç»Ÿæ¶æ„"></a>DCMç³»ç»Ÿæ¶æ„</h4><ul><li><strong>è®¾å¤‡æ„ŸçŸ¥å±‚</strong>ï¼ˆDeviceï¼‰ï¼šåˆ©ç”¨å°„é¢‘è¯†åˆ«ã€äºŒç»´ç ã€ä¼ æ„Ÿå™¨ç­‰æŠ€æœ¯è¿›è¡Œæ•°æ®é‡‡é›†</li><li><strong>ç½‘ç»œä¼ è¾“å±‚</strong>ï¼ˆConnectï¼‰ï¼šä¾æ‰˜é€šä¿¡ç½‘ç»œå’Œåè®®ï¼Œå®ç°å¯ä¿¡çš„ä¿¡æ¯äº¤äº’å’Œå…±äº«</li><li><strong>åº”ç”¨æ§åˆ¶å±‚</strong>ï¼ˆManageï¼‰ï¼šåˆ†æå’Œå¤„ç†æµ·é‡æ•°æ®å’Œä¿¡æ¯ï¼Œå®ç°æ™ºèƒ½åŒ–çš„å†³ç­–å’Œæ§åˆ¶</li></ul><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6jc1stt3j31380lswso.jpg" alt="image-20210504174337327" style="zoom:50%;" /><h4 id="ä¸‰è¦ç´ "><a href="#ä¸‰è¦ç´ " class="headerlink" title="ä¸‰è¦ç´ "></a><strong>ä¸‰è¦ç´ </strong></h4><ul><li><strong>è®¾å¤‡è”ç½‘</strong>ï¼šé€šè¿‡ä¸åŒçš„ç½‘ç»œåè®®å’Œé€šä¿¡æ ‡å‡†ï¼Œå®ç°è®¾å¤‡ä¸æ§åˆ¶ç«¯çš„è¿æ¥</li><li><strong>äº‘ç«¯åˆ†æ</strong>ï¼šæä¾›ç›‘æ§ã€å­˜å‚¨ã€åˆ†æç­‰æ•°æ®æœåŠ¡ï¼Œä»¥åŠä¿éšœå®¢æˆ·çš„ä¸šåŠ¡æ•°æ®å®‰å…¨</li><li><strong>äº‘è¾¹ååŒ</strong>ï¼šäº‘ç«¯æ¥å—è®¾å¤‡ä¸ŠæŠ¥æ•°æ®ï¼Œä¸‹å‘è®¾å¤‡ç®¡æ§æŒ‡ä»¤</li></ul><h4 id="äº‘-è¾¹-ç«¯ååŒ"><a href="#äº‘-è¾¹-ç«¯ååŒ" class="headerlink" title="äº‘ &#x2F; è¾¹ &#x2F; ç«¯ååŒ"></a>äº‘ &#x2F; è¾¹ &#x2F; ç«¯ååŒ</h4><p><strong>äº‘ç«¯è®¡ç®—</strong>ã€<strong>ç»ˆç«¯è®¡ç®—</strong>å’Œ<strong>è¾¹ç¼˜è®¡ç®—</strong>æ˜¯ä¸€ä¸ªååŒçš„ç³»ç»Ÿï¼Œæ ¹æ®ç”¨æˆ·åœºæ™¯ã€èµ„æºçº¦æŸç¨‹åº¦ã€ä¸šåŠ¡å®æ—¶æ€§ç­‰è¿›è¡ŒåŠ¨æ€è°ƒ é…ï¼Œå½¢æˆå¯é ã€ä½æˆæœ¬çš„åº”ç”¨æ–¹æ¡ˆã€‚ä»è¿‡å»å‡ å¹´çš„å‘å±•ç§¯ç´¯æ¥çœ‹ï¼ŒAI å·²åœ¨ç‰©è”ç½‘å¤šä¸ªå±‚é¢è¿›è¡Œèåˆï¼Œæ¯”æˆ‘ä»¬åˆä½œçš„æµ·åº·å¨è§†ã€æ—·è§†å®‡è§†ã€å•†æ±¤ç§‘æŠ€ç­‰çº·çº·å‘å¸ƒäº†ç‰©è”ç½‘AIç›¸å…³å¹³å°å’Œäº§å“ï¼Œå’Œç§»åŠ¨å’Œå°åŒºè¿›è¡Œäº†ç´§å¯†çš„èåˆã€‚</p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gn9kwux9vjj312w0li138.jpg" alt="image-20210202225351673" style="zoom:50%;" /><h4 id="ç‰©è”ç½‘å¹³å°æ¥å…¥"><a href="#ç‰©è”ç½‘å¹³å°æ¥å…¥" class="headerlink" title="ç‰©è”ç½‘å¹³å°æ¥å…¥"></a>ç‰©è”ç½‘å¹³å°æ¥å…¥</h4><img src="https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/3199158061/p132750.png" alt="ä¼ä¸šåŸºäºç‰©è”ç½‘å¹³å°çš„ä¸šåŠ¡é“¾è·¯" style="zoom:50%;" /><p>å‘ä¸‹è¿æ¥æµ·é‡è®¾å¤‡ï¼Œæ”¯æ’‘è®¾å¤‡<strong>æ•°æ®é‡‡é›†ä¸Šäº‘</strong>ï¼›</p><p>å‘ä¸Šé€šè¿‡è°ƒç”¨<strong>äº‘ç«¯API</strong>å°†æŒ‡ä»¤ä¸‹å‘è‡³è®¾å¤‡ç«¯ï¼Œå®ç°<strong>è¿œç¨‹æ§åˆ¶</strong>ã€‚</p><p><strong>ä¸Šè¡Œæ•°æ®é“¾è·¯</strong></p><ul><li>è®¾å¤‡å»ºç«‹<strong>MQTT</strong>é•¿è¿æ¥ï¼Œä¸ŠæŠ¥æ•°æ®ï¼ˆå‘å¸ƒTopicå’ŒPayloadï¼‰åˆ°ç‰©è”ç½‘å¹³å°</li><li>ç‰©è”ç½‘å¹³å°é€šè¿‡<strong>é…ç½®</strong>è§„åˆ™ï¼Œé€šè¿‡<strong>RocketMQ</strong>ã€<strong>AMQP</strong>ç­‰é˜Ÿåˆ—è½¬å‘åˆ°ä¸šåŠ¡å¹³å°</li></ul><p><strong>ä¸‹è¡ŒæŒ‡ä»¤é“¾è·¯</strong></p><ul><li>ä¸šåŠ¡æœåŠ¡å™¨åŸºäº<strong>HTTPS</strong>åè®®è°ƒç”¨çš„APIæ¥å£ï¼Œå‘å¸ƒTopicæŒ‡ä»¤åˆ°ç‰©è”ç½‘å¹³å°ã€‚</li><li>ç‰©è”ç½‘å¹³å°é€šè¿‡<strong>MQTT</strong>åè®®ï¼Œä½¿ç”¨å‘å¸ƒï¼ˆæŒ‡å®šTopicå’ŒPayloadï¼‰åˆ°<strong>è®¾å¤‡ç«¯</strong>ã€‚</li></ul><h4 id="é—¨é”æ¥å…¥"><a href="#é—¨é”æ¥å…¥" class="headerlink" title="é—¨é”æ¥å…¥"></a>é—¨é”æ¥å…¥</h4><p><strong>WIFIé—¨é”</strong>ï¼š<strong>éä¿æ´»</strong> å¹³å¸¸å¤„äºæ–­ç”µä¼‘çœ çŠ¶æ€ï¼Œéœ€è¦<strong>MCU</strong> <strong>å”¤é†’</strong>æ‰èƒ½ä¼ è¾“å’Œå‘é€æ•°æ®</p><p><strong>è“ç‰™é—¨é”</strong>ï¼š<strong>MCUä¸²å£å¯¹æ¥</strong>å’Œ<strong>SDKå¯¹æ¥</strong>ï¼Œè¿‘è·ç¦»<strong>å•ç‚¹ç™»å½•</strong>å’Œè¿œè·ç¦»<strong>ç½‘å…³ç™»å½•</strong></p><p><strong>Zigbeeé—¨é”</strong>ï¼š<strong>éä¿æ´»</strong> ä½†æ˜¯ä¿æŒå¿ƒè·³ï¼Œ<strong>MCU</strong>å¯¹æ¥ï¼Œ<strong>Zigbeeåè®®</strong>æ§åˆ¶ã€‚</p><p><strong>NB-Ioté—¨é”</strong>ï¼šå¯ä»¥é€šè¿‡<strong>å…¬ç½‘</strong>è¿æ¥ï¼ŒæŠŠé—¨ç¦å˜æˆ<strong>SAAS</strong>æœåŠ¡ï¼Œ<strong>MCU</strong></p><table><thead><tr><th>åè¯</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td><strong>SaaS</strong></td><td><strong>Software-as-a-Service</strong> ï¼Œæä¾›ç»™å®¢æˆ·çš„æœåŠ¡æ˜¯è¿è¥å•†è¿è¡Œåœ¨äº‘è®¡ç®—åŸºç¡€è®¾æ–½ä¸Šçš„åº”ç”¨ç¨‹åºã€‚<strong>ç”¨æˆ·å¯ä»¥åœ¨å„ç§è®¾å¤‡ä¸Šé€šè¿‡å®¢æˆ·ç«¯ç•Œé¢è®¿é—®åº”ç”¨</strong>ï¼Œä¾‹å¦‚è®¡ç®—æœºæµè§ˆå™¨ã€‚ç”¨æˆ·ä¸éœ€è¦ç®¡ç†æˆ–æ§åˆ¶ä»»ä½•äº‘è®¡ç®—åŸºç¡€è®¾æ–½ï¼ŒåŒ…æ‹¬ç½‘ç»œã€æœåŠ¡å™¨ã€æ“ä½œç³»ç»Ÿã€å­˜å‚¨ç­‰èµ„æºï¼Œä¸€åˆ‡ç”± SaaS æä¾›å•†ç®¡ç†å’Œè¿ç»´ã€‚</td></tr><tr><td><strong>PaaS</strong></td><td><strong>Platform-as-a-Service</strong>ï¼Œè¡¨ç¤ºå¹³å°å³æœåŠ¡ç†å¿µï¼Œå®¢æˆ·ä¸éœ€è¦ç®¡ç†æˆ–æ§åˆ¶åº•å±‚çš„äº‘åŸºç¡€è®¾æ–½ï¼ŒåŒ…æ‹¬ç½‘ç»œã€æœåŠ¡å™¨ã€æ“ä½œç³»ç»Ÿã€å­˜å‚¨ç­‰ï¼Œä½†<strong>å®¢æˆ·èƒ½æ§åˆ¶éƒ¨ç½²çš„åº”ç”¨ç¨‹åº</strong>ï¼Œä¹Ÿå¯èƒ½æ§åˆ¶è¿è¡Œåº”ç”¨ç¨‹åºçš„æ‰˜ç®¡ç¯å¢ƒé…ç½®ã€‚</td></tr><tr><td><strong>IaaS</strong></td><td>I<strong>nfrastructure-as-a-Service</strong> ï¼Œè¡¨ç¤ºåŸºç¡€è®¾æ–½å³æœåŠ¡ç†å¿µï¼Œæä¾›çš„æœåŠ¡æ˜¯å¯¹æ‰€æœ‰è®¡ç®—åŸºç¡€è®¾æ–½çš„åˆ©ç”¨ï¼ŒåŒ…æ‹¬ CPUã€å†…å­˜ã€å­˜å‚¨ã€ç½‘ç»œç­‰å…¶å®ƒè®¡ç®—èµ„æºã€‚<strong>ç”¨æˆ·èƒ½å¤Ÿéƒ¨ç½²å’Œè¿è¡Œä»»æ„è½¯ä»¶ï¼ŒåŒ…æ‹¬æ“ä½œç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºã€‚</strong></td></tr></tbody></table><h4 id="å„ç§åè®®"><a href="#å„ç§åè®®" class="headerlink" title="å„ç§åè®®"></a>å„ç§åè®®</h4><p><strong>HTTPåè®®ï¼ˆCSç”¨æˆ·ä¸Šç½‘ï¼‰</strong></p><p>HTTPåè®®æ˜¯å…¸å‹çš„CSé€šè®¯æ¨¡å¼ï¼Œç”±<strong>å®¢æˆ·ç«¯ä¸»åŠ¨</strong>å‘èµ·è¿æ¥ï¼Œå‘æœåŠ¡å™¨è¯·æ±‚<strong>XMLæˆ–JSONæ•°æ®</strong>ã€‚è¯¥åè®®æœ€æ—©æ˜¯ä¸ºäº†é€‚ç”¨webæµè§ˆå™¨çš„<strong>ä¸Šç½‘æµè§ˆåœºæ™¯</strong>å’Œè®¾è®¡çš„ï¼Œç›®å‰åœ¨<strong>PCã€æ‰‹æœºã€pad</strong>ç­‰ç»ˆç«¯ä¸Šéƒ½åº”ç”¨å¹¿æ³›ï¼Œä½†å¹¶<strong>ä¸é€‚ç”¨äºç‰©è”ç½‘åœºæ™¯</strong></p><ul><li>ç”±äºå¿…é¡»ç”±è®¾å¤‡ä¸»åŠ¨å‘æœåŠ¡å™¨å‘é€æ•°æ®ï¼Œéš¾ä»¥ä¸»åŠ¨å‘è®¾å¤‡æ¨é€æ•°æ®ã€‚</li><li>ç‰©è”ç½‘åœºæ™¯ä¸­çš„<strong>è®¾å¤‡å¤šæ ·</strong>ï¼Œè¿ç®—<strong>å—é™çš„è®¾å¤‡</strong>ï¼Œéš¾ä»¥å®ç°JSONæ•°æ®æ ¼å¼çš„è§£æ</li></ul><p><strong>RESTAPIï¼ˆæ¾è€¦åˆè°ƒç”¨ï¼‰</strong></p><p>REST&#x2F;HTTPä¸»è¦ä¸ºäº†<strong>ç®€åŒ–</strong>äº’è”ç½‘ä¸­çš„ç³»ç»Ÿæ¶æ„ï¼Œ<strong>å¿«é€Ÿå®ç°</strong>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´äº¤äº’çš„<strong>æ¾è€¦åˆ</strong>ï¼Œé™ä½äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„<strong>äº¤äº’å»¶è¿Ÿ</strong>ã€‚å› æ­¤é€‚åˆåœ¨ç‰©è”ç½‘çš„åº”ç”¨å±‚é¢ï¼Œé€šè¿‡REST<strong>å¼€æ”¾</strong>ç‰©è”ç½‘ä¸­èµ„æºï¼Œå®ç°æœåŠ¡è¢«å…¶ä»–åº”ç”¨æ‰€è°ƒç”¨ã€‚</p><p><strong>CoAPåè®®ï¼ˆæ— çº¿ä¼ æ„Ÿï¼‰</strong></p><blockquote><p>ç®€åŒ–äº†HTTPåè®®çš„<strong>RESTful API</strong>ï¼Œå®ƒé€‚ç”¨äºåœ¨<strong>èµ„æºå—é™</strong>çš„é€šä¿¡çš„IPç½‘ç»œã€‚</p></blockquote><p><strong>MQTTåè®®ï¼ˆä½å¸¦å®½ï¼‰</strong></p><blockquote><p>MQTTåè®®é‡‡ç”¨<strong>å‘å¸ƒ&#x2F;è®¢é˜…</strong>æ¨¡å¼ï¼Œç‰©è”ç½‘ç»ˆç«¯éƒ½é€šè¿‡TCPè¿æ¥åˆ°äº‘ç«¯ï¼Œäº‘ç«¯é€šè¿‡ä¸»é¢˜çš„æ–¹å¼ç®¡ç†å„ä¸ªè®¾å¤‡å…³æ³¨çš„é€šè®¯å†…å®¹ï¼Œ<strong>è´Ÿè´£</strong>å°†è®¾å¤‡ä¸è®¾å¤‡ä¹‹é—´<strong>æ¶ˆæ¯çš„è½¬å‘</strong></p></blockquote><p>é€‚ç”¨èŒƒå›´ï¼šåœ¨ä½å¸¦å®½ã€ä¸å¯é çš„é›†ä¸­<strong>æ˜Ÿå‹ç½‘ç»œæ¶æ„</strong>ï¼ˆhub-and-spokeï¼‰ï¼Œä¸é€‚ç”¨è®¾å¤‡ä¸è®¾å¤‡ä¹‹é—´é€šä¿¡ï¼Œè®¾å¤‡<strong>æ§åˆ¶èƒ½åŠ›å¼±</strong>ï¼Œå¦å¤–<strong>å®æ—¶æ€§è¾ƒå·®</strong>ï¼Œä¸€èˆ¬éƒ½åœ¨<strong>ç§’çº§</strong>ã€‚åè®®è¦<strong>è¶³å¤Ÿè½»é‡</strong>ï¼Œæ–¹ä¾¿åµŒå…¥å¼è®¾å¤‡å»å¿«é€Ÿåœ°è§£æå’Œå“åº”ã€‚å…·å¤‡<strong>è¶³å¤Ÿçš„çµæ´»æ€§</strong>ï¼Œä½¿å…¶è¶³ä»¥ä¸º IoT è®¾å¤‡å’ŒæœåŠ¡çš„å¤šæ ·åŒ–æä¾›æ”¯æŒã€‚åº”è¯¥è®¾è®¡ä¸º<strong>å¼‚æ­¥æ¶ˆæ¯åè®®</strong>ï¼Œè¿™ä¹ˆåšæ˜¯å› ä¸ºå¤§å¤šæ•° IoT è®¾å¤‡çš„ç½‘ç»œå»¶è¿Ÿå¾ˆå¯èƒ½éå¸¸ä¸ç¨³å®šï¼Œè‹¥ä½¿ç”¨åŒæ­¥æ¶ˆæ¯åè®®ï¼ŒIoT è®¾å¤‡éœ€è¦ç­‰å¾…æœåŠ¡å™¨çš„å“åº”ï¼Œå¿…é¡»æ˜¯<strong>åŒå‘é€šä¿¡</strong>ï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯åº”è¯¥å¯ä»¥äº’ç›¸å‘é€æ¶ˆæ¯ã€‚</p><p><strong>AMQPåè®®ï¼ˆäº’æ“ä½œæ€§ï¼‰</strong></p><blockquote><p>ç”¨äºä¸šåŠ¡ç³»ç»Ÿä¾‹å¦‚PLMï¼ŒERPï¼ŒMESç­‰è¿›è¡Œæ•°æ®äº¤æ¢ã€‚</p></blockquote><p>ã€€ã€€é€‚ç”¨èŒƒå›´ï¼šæœ€æ—©åº”ç”¨äºé‡‘èç³»ç»Ÿä¹‹é—´çš„äº¤æ˜“æ¶ˆæ¯ä¼ é€’ï¼Œåœ¨ç‰©è”ç½‘åº”ç”¨ä¸­ï¼Œä¸»è¦é€‚ç”¨äºç§»åŠ¨æ‰‹æŒè®¾å¤‡ä¸åå°æ•°æ®ä¸­å¿ƒçš„é€šä¿¡å’Œåˆ†æã€‚</p><p><strong>XMPPåè®®ï¼ˆå³æ—¶é€šä¿¡ï¼‰</strong></p><blockquote><p>å¼€æºå½¢å¼ç»„ç»‡äº§ç”Ÿçš„ç½‘ç»œå³æ—¶é€šä¿¡åè®®ã€‚è¢«IETFå›½é™…æ ‡å‡†ç»„ç»‡å®Œæˆäº†æ ‡å‡†åŒ–å·¥ä½œ</p></blockquote><p>ã€€ã€€é€‚ç”¨èŒƒå›´ï¼š<strong>å³æ—¶é€šä¿¡</strong>çš„åº”ç”¨ç¨‹åºï¼Œè¿˜èƒ½ç”¨åœ¨<strong>ååŒå·¥å…·</strong>ã€æ¸¸æˆç­‰ã€‚</p><p>â€‹XMPPåœ¨é€šè®¯çš„ä¸šåŠ¡æµç¨‹ä¸Šæ˜¯æ›´é€‚åˆç‰©è”ç½‘ç³»ç»Ÿçš„ï¼Œå¼€å‘è€…ä¸ç”¨èŠ±å¤ªå¤šå¿ƒæ€å»è§£å†³è®¾å¤‡é€šè®¯æ—¶çš„ä¸šåŠ¡é€šè®¯æµç¨‹ï¼Œç›¸å¯¹å¼€å‘æˆæœ¬ä¼šæ›´ä½ã€‚ä½†æ˜¯HTTPåè®®ä¸­çš„å®‰å…¨æ€§ä»¥åŠè®¡ç®—èµ„æºæ¶ˆè€—çš„ç¡¬ä¼¤å¹¶æ²¡æœ‰å¾—åˆ°æœ¬è´¨çš„è§£å†³ã€‚</p><p><strong>JMS ï¼ˆJavaæ¶ˆæ¯æœåŠ¡ï¼‰</strong></p><p>â€‹Javaæ¶ˆæ¯æœåŠ¡ï¼ˆJava Message Serviceï¼‰åº”ç”¨ç¨‹åºæ¥å£ï¼Œæ˜¯ä¸€ä¸ªJavaå¹³å°ä¸­å…³äºé¢å‘æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆMOMï¼‰çš„APIï¼Œç”¨äºåœ¨ä¸¤ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´ï¼Œæˆ–åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å‘é€æ¶ˆæ¯ï¼Œè¿›è¡Œå¼‚æ­¥é€šä¿¡ã€‚</p><p><strong>Zigbeeåè®®</strong></p><p>â€‹ä½åŠŸè€—ï¼Œå®ƒä¿æŒIEEE 802.15.4ï¼ˆ2003ï¼‰æ ‡å‡†</p><h3 id="IOTæµé‡æ´ªå³°"><a href="#IOTæµé‡æ´ªå³°" class="headerlink" title="IOTæµé‡æ´ªå³°"></a>IOTæµé‡æ´ªå³°</h3><p>æ™ºæ…§ç¤¾åŒºIOTé¢†åŸŸï¼Œä¸ç®¡æ˜¯åµŒå…¥å¼èŠ¯ç‰‡è¿˜æ˜¯åº”ç”¨æœåŠ¡å™¨éƒ½éœ€è¦ä¼ é€’æ¶ˆæ¯ï¼Œå¸¸è§ä¸Šè¡Œçš„æ¶ˆæ¯æœ‰ï¼š<strong>äººè„¸è¯†åˆ«å¼€é—¨ã€çƒŸæ„Ÿé›¾æ„Ÿå‘Šè­¦</strong>ã€å…±äº«å……ç”µæ¡©å……ç”µï¼Œä¸‹è¡Œçš„<strong>å¹¿å‘Šä¸‹å‘ã€NBé—¨ç¦å¼€é—¨æŒ‡ä»¤ã€</strong>è¶…çº§é—¨æ¿æ˜¾ç¤ºç­‰ï¼Œç”±äºç‰©è”ç½‘è®¾å¤‡æ—¶ä¸æ—¶ä¼š<strong>æ•…éšœå’Œæ–­ç½‘å¯¼è‡´å¤§é‡çš„æµé‡æ´ªå³°</strong>ï¼Œä¼ ç»Ÿæ¶ˆæ¯é˜Ÿåˆ—éœ€è¦é’ˆå¯¹æ€§ä¼˜åŒ–ã€‚</p><ul><li><p><strong>ä¸Šä¸‹è¡Œæ‹†åˆ†</strong></p><p>ä¸Šè¡Œæ¶ˆæ¯ç‰¹å¾ï¼šå¹¶å‘é‡<strong>é«˜</strong>ã€å¯é æ€§å’Œ<strong>æ—¶å»¶æ€§è¦æ±‚ä½</strong></p><p>ä¸‹è¡Œæ¶ˆæ¯ç‰¹å¾ï¼šå¹¶å‘é‡<strong>ä½</strong>ã€æ§åˆ¶æŒ‡ä»¤çš„<strong>æˆåŠŸç‡è¦æ±‚é«˜</strong></p></li><li><p><strong>æµ·é‡Topicä¸‹æ€§èƒ½</strong></p><p><strong>Kafka</strong>æµ·é‡Topicæ€§èƒ½ä¼š<strong>æ€¥å‰§ä¸‹é™</strong>ï¼ŒZookeeperåè°ƒä¹Ÿæœ‰ç“¶é¢ˆ</p><p><strong>å¤šæ³³é“æ¶ˆæ¯é˜Ÿåˆ—</strong>å¯ä»¥å®ç°IoTæ¶ˆæ¯é˜Ÿåˆ—çš„æ•…éšœ<strong>éš”ç¦»</strong></p></li><li><p><strong>å®æ—¶æ¶ˆæ¯ä¼˜å…ˆå¤„ç†</strong></p><p>NBé—¨ç¦å®æ—¶äº§ç”Ÿçš„å¼€é—¨æŒ‡ä»¤å¿…é¡»<strong>ç¬¬ä¸€ä¼˜å…ˆçº§å¤„ç†</strong>ï¼Œå †ç§¯çš„æ¶ˆæ¯é™çº§</p><p>è®¾è®¡æˆ<strong>æ— åºã€ä¸æŒä¹…åŒ–</strong>çš„ï¼Œå¹¶ä¸ä¼ ç»Ÿçš„FIFOé˜Ÿåˆ—éš”ç¦»</p></li><li><p><strong>è¿æ¥ã€è®¡ç®—ã€å­˜å‚¨åˆ†ç¦»</strong></p><p>Brokeråªåš<strong>æµè½¬åˆ†å‘</strong>ï¼Œå®ç°<strong>æ— çŠ¶æ€</strong>å’Œ<strong>æ°´å¹³æ‰©å±•</strong></p><p>è®¡ç®—äº¤ç»™<strong>Flink</strong>ï¼Œå­˜å‚¨äº¤ç»™nosqlDBï¼Œå®ç°<strong>é«˜ååå†™</strong></p></li><li><p><strong>æ¶ˆæ¯ç­–ç•¥-æ¨æ‹‰ç»“åˆ</strong></p><p>MQTTé’ˆå¯¹ç”µæ± ç±»ç‰©è”ç½‘è®¾å¤‡ï¼ŒAMQPé’ˆå¯¹å®‰å…¨æ€§è¾ƒé«˜çš„é—¨ç¦è®¾å¤‡</p><p>æ¶ˆè´¹ç«¯ç¦»çº¿æ—¶å­˜åˆ°queueï¼Œåœ¨çº¿æ—¶å°†<strong>å®æ—¶æ¶ˆæ¯å’Œä»queueä¸­æ‹‰å–çš„æ¶ˆæ¯</strong>ä¸€èµ·æ¨é€</p></li></ul><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1goboitd4h2j30u00ciq3i.jpg" alt="img"></p><p><strong>å¦‚æœè§£å†³æµ·é‡Topic</strong></p><p>â€‹é¦–å…ˆè¦åšçš„å°±æ˜¯åˆ†åŒºã€åˆ†ç»„ç­‰æ°´å¹³æ‹†åˆ†çš„æ–¹å¼ï¼Œæ¥ä¸‹æ¥è€ƒè™‘å•å®ä¾‹å¦‚ä½•å¤„ç†æ›´å¤šTopicï¼Œä¼ ç»Ÿæ¶ˆæ¯é˜Ÿåˆ—åœ¨æµ·é‡Topicä¸‹é¡ºåºå†™ä¼šé€€åŒ–æˆéšæœºå†™ï¼Œæ€§èƒ½å¤§å¹…ä¸‹é™</p><ul><li><p><strong>äººå·¥Sharding</strong>ï¼šéƒ¨ç½²å¤šä¸ªKafkaé›†ç¾¤ï¼Œé€šè¿‡ä¸åŒmqè¿æ¥æ¥éš”ç¦»</p></li><li><p><strong>åˆå¹¶Topic</strong>ï¼Œå®¢æˆ·ç«¯å°è£…subTopicã€‚æ¯”å¦‚ä¸€ä¸ªæœåŠ¡çš„Nä¸ªç»Ÿè®¡é¡¹ï¼Œä¼šæ¶ˆè´¹åˆ°æ— å…³æ¶ˆæ¯</p><p>â€‹åŸºäºè¿™ä¸ªæ€è·¯ï¼Œä½¿ç”¨<strong>Kafka Streams</strong>æˆ–è€…<strong>Hbaseåˆ—</strong>å­˜å‚¨æ¥èšåˆ</p></li></ul><p>é’ˆå¯¹å•ä¸ªTopicæµ·é‡è®¢é˜…çš„é—®é¢˜ï¼Œ<strong>å¯ä»¥åœ¨ä¸Šå±‚å°è£…å¹¿æ’­ç»„ä»¶æ¥åè°ƒæ‰¹é‡å‘é€</strong></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gobohzda8fj30u00cgaax.jpg" alt="img"></p><h3 id="ç¤¾åŒºç›´æ’­å¸¦è´§"><a href="#ç¤¾åŒºç›´æ’­å¸¦è´§" class="headerlink" title="ç¤¾åŒºç›´æ’­å¸¦è´§"></a>ç¤¾åŒºç›´æ’­å¸¦è´§</h3><blockquote><p>ä½¿ç”¨<strong>ç«¯ &#x2F; è¾¹ &#x2F; äº‘</strong>ä¸‰çº§æ¶æ„ï¼Œå®¢æˆ·ç«¯åŠ å¯†ä¼ è¾“ï¼Œè¾¹ç¼˜èŠ‚ç‚¹è½¬å‘ã€äº‘ä¾§è½¬ç å¹¶æŒä¹…åŒ–</p></blockquote><h4 id="äº§å“çš„èƒŒæ™¯"><a href="#äº§å“çš„èƒŒæ™¯" class="headerlink" title="äº§å“çš„èƒŒæ™¯"></a><strong>äº§å“çš„èƒŒæ™¯</strong></h4><blockquote><p>ä¸Šçº¿æ—¶é—´ï¼Œä»è°ƒç ”åˆ°æ­£å¼ä¸Šçº¿ç”¨äº† 3ä¸ªæœˆæ—¶é—´ï¼Œä¸Šçº¿åä¸€ä¸ªæœˆå†…å°±è¦ç»å†åŒåäºŒæŒ‘æˆ˜ã€‚åœ¨è¿™ä¹ˆç´§çš„ä¸Šçº¿æ—¶é—´è¦æ±‚ä¸‹ï¼Œéœ€è¦ç”¨åˆ°å…¬å¸æä¾›çš„æ‰€æœ‰ä¼˜åŠ¿ï¼ŒåŒ…æ‹¬<strong>cdnç½‘ç»œï¼Œç›´æ’­ç‰Œç…§</strong>ç­‰</p></blockquote><h4 id="é¢ä¸´çš„æŒ‘æˆ˜"><a href="#é¢ä¸´çš„æŒ‘æˆ˜" class="headerlink" title="é¢ä¸´çš„æŒ‘æˆ˜"></a>é¢ä¸´çš„æŒ‘æˆ˜</h4><ul><li><p>ç›´æ’­æ•°æ®æ˜¯<strong>å®æ—¶</strong>ç”Ÿæˆçš„ï¼Œæ‰€æœ‰ä¸èƒ½å¤Ÿè¿›è¡Œ<strong>é¢„ç¼“å­˜</strong></p></li><li><p>ç›´æ’­éšæ—¶ä¼šå‘ç”Ÿï¼Œä¸¾åŠçƒ­ç‚¹æ´»åŠ¨ï¼Œç›¸å…³æœåŠ¡å™¨èµ„æºéœ€è¦<strong>åŠ¨æ€åˆ†é…</strong></p></li><li><p>ç›´æ’­çš„å»¶è¿Ÿå¯¹äºç”¨æˆ·ä½“éªŒå½±å“å¾ˆå¤§ï¼Œéœ€è¦æ§åˆ¶åœ¨<strong>ç§’çº§</strong></p></li><li><p>ç›´æ’­sdkæ˜¯å†…åµŒåœ¨ç¤¾åŒºåº”ç”¨é‡Œçš„ï¼Œæ•´ä½“è¦æ±‚ä¸èƒ½è¶…è¿‡5M</p></li></ul><h4 id="åè®®çš„æ¯”è¾ƒ"><a href="#åè®®çš„æ¯”è¾ƒ" class="headerlink" title="åè®®çš„æ¯”è¾ƒ"></a>åè®®çš„æ¯”è¾ƒ</h4><table><thead><tr><th>åè®®</th><th>ä¸Šçº¿æ—¶é—´</th><th>ç½‘ç»œå…¼å®¹</th><th>ç«¯å¯¹ç«¯å»¶è¿Ÿ</th><th>åº”ç”¨å¤§å°</th><th>é—®é¢˜</th></tr></thead><tbody><tr><td>WebRTC</td><td></td><td>âœ—</td><td></td><td></td><td>Webrtc åŸºäº UDPï¼Œå’Œç¤¾åŒºåº”ç”¨çš„ç½‘ç»œæ¶æ„ä¸å…¼å®¹</td></tr><tr><td>HTTP Upload</td><td></td><td></td><td>âœ—</td><td></td><td>ä¼šå¯¼è‡´ç½‘ç»œé«˜å»¶è¿Ÿ</td></tr><tr><td>Custom Protocol</td><td>âœ—</td><td></td><td></td><td></td><td>å·¥ç¨‹å¸ˆéœ€è¦å®ç°è‡ªå·±çš„å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„åº“ï¼Œæ— æ³•æŒ‰æ—¶ä¸Šçº¿</td></tr><tr><td>Proprietary</td><td></td><td></td><td></td><td>âœ—</td><td>åè®®å°±éœ€è¦å‡ å…†çš„ç©ºé—´ï¼Œè¶…å‡ºé¢åº¦</td></tr><tr><td>RTMPS</td><td>âœ”</td><td>âœ”</td><td>âœ”</td><td>âœ”</td><td>TCPå®æ—¶ä¼ è¾“æ¶ˆæ¯åè®®ï¼Œæ›´å®‰å…¨æ›´å¯é </td></tr></tbody></table><h4 id="æ•´ä½“æµç¨‹"><a href="#æ•´ä½“æµç¨‹" class="headerlink" title="æ•´ä½“æµç¨‹"></a>æ•´ä½“æµç¨‹</h4><p><strong>RTMPS</strong>ï¼šåŸºäºTCPå®æ—¶ä¼ è¾“æ¶ˆæ¯åè®®ï¼Œæ›´å®‰å…¨æ›´å¯é </p><p><strong>MPEG-DASH</strong>ï¼šæ˜¯ä¸€ç§åŸºäºHTTPåè®®è‡ªé€‚åº”æ¯”ç‰¹ç‡æµåª’ä½“æŠ€æœ¯ï¼Œåº”å¯¹å¤æ‚çš„ç¯å¢ƒ</p><p><img src="https://i.loli.net/2021/01/25/zjwC7B8fdcpDytA.png" alt="image-20210125145103417"></p><ol><li><p>ç›´æ’­ç«¯ä½¿ç”¨ <strong>RTMPS</strong> åè®®å‘é€ç›´æ’­æ•°æ®åˆ°<strong>è¾¹ç¼˜èŠ‚ç‚¹</strong>ï¼ˆPOPï¼‰</p></li><li><p>POP ä½¿ç”¨<strong>RTMP</strong>å‘é€æ•°æ®åˆ°æ•°æ®ä¸­å¿ƒï¼ˆDCï¼‰</p></li><li><p>DC å°†æ•°æ®ç¼–ç æˆ<strong>ä¸åŒçš„æ¸…æ™°åº¦</strong>å¹¶è¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨</p><p><strong>äº‘ç«¯è½¬ç </strong>ä¸»è¦æœ‰<strong>ä¸¤ç§åˆ†è¾¨ç‡</strong>400x400 å’Œ 720x720. </p></li><li><p>æ’­æ”¾ç«¯é€šè¿‡ <strong>MPEG-DASH</strong> &#x2F; RTMPS åè®®æ¥æ”¶ç›´æ’­æ•°æ®</p><p>å¦‚æœç”¨æˆ·ç½‘ç»œä¸å¥½**<a href="https://www.cloudflare.com/zh-cn/learning/video/what-is-mpeg-dash/">MPEG-DASH</a>**ä¼šè‡ªåŠ¨è½¬æ¢æˆä½åˆ†è¾¨ç‡</p></li></ol><h4 id="ç›´æ’­æµç¨‹"><a href="#ç›´æ’­æµç¨‹" class="headerlink" title="ç›´æ’­æµç¨‹"></a><strong>ç›´æ’­æµç¨‹</strong></h4><img src="https://i.loli.net/2021/01/25/GITnbhDqPdtZY2k.png" alt="image-20210125153606264" style="zoom:50%;" /><ol><li><p>ç›´æ’­ç«¯ä½¿ç”¨ <strong>RTMPS</strong> åè®®å‘é€ç›´æ’­æµæ•°æ®åˆ° POP å†…çš„å°±è¿‘çš„ä»£ç†æœåŠ¡å™¨</p></li><li><p>ä»£ç†æœåŠ¡å™¨<strong>è½¬å‘</strong>ç›´æ’­æµæ•°æ®åˆ°æ•°æ®ä¸­å¿ƒçš„ç½‘å…³æœåŠ¡å™¨ï¼ˆ<strong>443è½¬80</strong>ï¼‰</p></li><li><p>ç½‘å…³æœåŠ¡å™¨ä½¿ç”¨<strong>ç›´æ’­ id çš„ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•</strong>å‘é€ç›´æ’­æ•°æ®åˆ°æŒ‡å®šçš„ç¼–ç æœåŠ¡å™¨</p></li><li><p>ç¼–ç æœåŠ¡å™¨æœ‰å‡ é¡¹èŒè´£ï¼š</p><ul><li><p>4.1 <strong>éªŒè¯ç›´æ’­æ•°æ®</strong>çš„æ ¼å¼æ˜¯å¦æ­£ç¡®ã€‚</p></li><li><p>4.2 <strong>å…³è”</strong>ç›´æ’­ id ä»¥åŠç¼–ç æœåŠ¡å™¨ç¬¬ä¸€æ˜ å°„ï¼Œä¿è¯å®¢æˆ·ç«¯å³ä½¿è¿æ¥ä¸­æ–­æˆ–è€…æœåŠ¡å™¨æ‰©å®¹æ—¶ï¼Œåœ¨<strong>é‡æ–°è¿æ¥</strong>çš„æ—¶å€™ä¾ç„¶èƒ½å¤Ÿè¿æ¥åˆ°ç›¸åŒçš„ç¼–ç æœåŠ¡å™¨</p></li><li><p>4.3 ä½¿ç”¨ç›´æ’­æ•°æ®<strong>ç¼–ç æˆä¸åŒè§£æåº¦</strong>çš„è¾“å‡ºæ•°æ®</p></li><li><p>4.4 ä½¿ç”¨ <strong>DASH</strong> åè®®è¾“å‡ºæ•°æ®å¹¶<strong>æŒä¹…åŒ–</strong>å­˜å‚¨</p></li></ul></li></ol><h4 id="æ’­æ”¾æµç¨‹"><a href="#æ’­æ”¾æµç¨‹" class="headerlink" title="æ’­æ”¾æµç¨‹"></a>æ’­æ”¾æµç¨‹</h4><img src="https://i.loli.net/2021/01/25/Lo5N8QYlI2DPjyO.png" alt="image-20210125154758184" style="zoom:50%;" /><ol><li>æ’­æ”¾ç«¯ä½¿ç”¨ HTTP <strong>DASH</strong> åè®®å‘ POP æ‹‰å–ç›´æ’­æ•°æ®</li><li>POP é‡Œé¢çš„ä»£ç†æœåŠ¡å™¨ä¼šæ£€æŸ¥æ•°æ®æ˜¯å¦å·²ç»åœ¨ POP çš„<strong>ç¼“å­˜</strong>å†…ã€‚å¦‚æœæ˜¯çš„è¯ï¼Œç¼“å­˜ä¼šè¿”å›æ•°æ®ç»™æ’­æ”¾ç«¯ï¼Œå¦åˆ™ï¼Œä»£ç†æœåŠ¡å™¨ä¼šå‘ DC æ‹‰å–ç›´æ’­æ•°æ®</li><li>DC å†…çš„ä»£ç†æœåŠ¡å™¨ä¼šæ£€æŸ¥æ•°æ®æ˜¯å¦åœ¨ DC çš„ç¼“å­˜å†…ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œç¼“å­˜ä¼šè¿”å›æ•°æ®ç»™ POPï¼Œå¹¶æ›´æ–° POP çš„ç¼“å­˜ï¼Œå†è¿”å›ç»™æ’­æ”¾ç«¯ã€‚ä¸æ˜¯çš„è¯ï¼Œä»£ç†æœåŠ¡å™¨ä¼šä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å‘å¯¹åº”çš„ç¼–ç æœåŠ¡å™¨è¯·æ±‚æ•°æ®ï¼Œå¹¶æ›´æ–° DC çš„ç¼“å­˜ï¼Œè¿”å›åˆ° POPï¼Œå†è¿”å›åˆ°æ’­æ”¾ç«¯ã€‚</li></ol><p><strong>æ”¶è·</strong></p><ol><li>é¡¹ç›®çš„æˆåŠŸä¸ï¼Œä»£ç åªæ˜¯å†…åŠŸï¼Œè€ƒè™‘é€‚é…ä¸åŒçš„ç½‘ç»œã€åˆ©ç”¨å¯åˆ©ç”¨çš„èµ„æº</li><li>æƒŠç¾¤æ•ˆåº”åœ¨çƒ­ç‚¹æœåŠ¡å™¨ä»¥åŠè®¸å¤šç»„ä»¶ä¸­éƒ½å¯èƒ½å‘ç”Ÿ</li><li>å¼€å‘å¤§å‹é¡¹ç›®éœ€è¦å¯¹<strong>ååé‡å’Œæ—¶å»¶</strong>ã€<strong>å®‰å…¨å’Œæ€§èƒ½</strong>åšå‡ºå¦¥å</li><li>ä¿è¯æ¶æ„çš„çµæ´»åº¦å’Œå¯æ‰©å±•æ€§ï¼Œä¸ºå†…å­˜ã€æœåŠ¡å™¨ã€å¸¦å®½è€—å°½åšå¥½è§„åˆ’</li></ol><h3 id="ç›´æ’­é«˜å¯ç”¨æ–¹æ¡ˆ"><a href="#ç›´æ’­é«˜å¯ç”¨æ–¹æ¡ˆ" class="headerlink" title="ç›´æ’­é«˜å¯ç”¨æ–¹æ¡ˆ"></a><strong>ç›´æ’­é«˜å¯ç”¨æ–¹æ¡ˆ</strong></h3><p><strong>ç½‘ç»œå¯é æ€§</strong>ï¼š</p><ul><li>æ ¹æ®<strong>ç½‘ç»œè¿æ¥é€Ÿåº¦</strong>æ¥è‡ªåŠ¨è°ƒæ•´è§†é¢‘è´¨é‡</li><li>ä½¿ç”¨<strong>çŸ­æ—¶é—´çš„æ•°æ®ç¼“å­˜</strong>æ¥è§£å†³ç›´æ’­ç«¯ä¸ç¨³å®šï¼Œç¬é—´æ–­çº¿çš„é—®é¢˜</li><li>æ ¹æ®<strong>ç½‘ç»œè´¨é‡è‡ªåŠ¨é™çº§</strong>ä¸ºéŸ³é¢‘ç›´æ’­ä»¥åŠæ’­æ”¾</li></ul><p><strong>æƒŠç¾¤æ•ˆåº”ï¼š</strong></p><ul><li>å½“å¤šä¸ªæ’­æ”¾ç«¯å‘åŒä¸€ä¸ª POP è¯·æ±‚ç›´æ’­æ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœæ•°æ®ä¸åœ¨ç¼“å­˜ä¸­</li><li>è¿™æ—¶å€™åªæœ‰ä¸€ä¸ªè¯·æ±‚ A ä¼šåˆ° DC ä¸­è¯·æ±‚æ•°æ®ï¼Œå…¶ä»–è¯·æ±‚ä¼šç­‰å¾…ç»“æœ</li><li>ä½†æ˜¯å¦‚æœè¯·æ±‚ A è¶…æ—¶æ²¡æœ‰è¿”å›æ•°æ®çš„è¯ï¼Œæ‰€æœ‰è¯·æ±‚ä¼šä¸€èµ·å‘ DC è®¿é—®æ•°æ®</li><li>è¿™æ—¶å€™å°±ä¼šåŠ å¤§ DC çš„å‹åŠ›ï¼Œè§¦å‘æƒŠç¾¤æ•ˆåº”</li><li>è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•å°±æ˜¯é€šè¿‡<strong>å®é™…çš„æƒ…å†µ</strong>æ¥è°ƒæ•´è¯·æ±‚è¶…æ—¶çš„æ—¶é—´ã€‚è¿™ä¸ªæ—¶é—´å¦‚æœå¤ªé•¿çš„è¯ä¼šå¸¦æ¥ç›´æ’­çš„å»¶è¿Ÿï¼Œå¤ªçŸ­çš„è¯ä¼šç»å¸¸è§¦å‘æƒŠç¾¤æ•ˆåº”ï¼ˆ<strong>æ¯ä¸ªæ—¶é—´çª—å£åªå…è®¸è§¦å‘ä¸€æ¬¡</strong>ï¼Œè®¾ç½®å…è®¸æœ€å¤§å›æºæ•°é‡ï¼‰</li></ul><h3 id="æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ"><a href="#æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ"></a><strong>æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ</strong></h3><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gobogaxxjkj304v0e7t93.jpg" alt="img"></p><p><strong>æ•°æ®åº“ä¼˜åŒ–ï¼š</strong> æ•°æ®åº“æ˜¯æœ€å®¹æ˜“æˆä¸ºç“¶é¢ˆçš„ç»„ä»¶ï¼Œè€ƒè™‘ä» SQL ä¼˜åŒ–æˆ–è€…æ•°æ®åº“æœ¬èº«å»æé«˜å®ƒçš„æ€§èƒ½ã€‚å¦‚æœç“¶é¢ˆä¾ç„¶å­˜åœ¨ï¼Œåˆ™ä¼šè€ƒè™‘åˆ†åº“åˆ†è¡¨å°†æ•°æ®æ‰“æ•£ï¼Œå¦‚æœè¿™æ ·ä¹Ÿæ²¡èƒ½è§£å†³é—®é¢˜ï¼Œåˆ™å¯èƒ½ä¼šé€‰æ‹©ç¼“å­˜ç»„ä»¶è¿›è¡Œä¼˜åŒ–</p><p><strong>é›†ç¾¤æœ€ä¼˜ï¼š</strong>å­˜å‚¨èŠ‚ç‚¹çš„é—®é¢˜è§£å†³åï¼Œè®¡ç®—èŠ‚ç‚¹ä¹Ÿæœ‰å¯èƒ½å‘ç”Ÿé—®é¢˜ã€‚ä¸€ä¸ªé›†ç¾¤ç³»ç»Ÿå¦‚æœè·å¾—äº†æ°´å¹³æ‰©å®¹çš„èƒ½åŠ›ï¼Œå°±ä¼šç»™ä¸‹å±‚çš„ä¼˜åŒ–æä¾›éå¸¸å¤§çš„æ—¶é—´ç©ºé—´ï¼Œç”±æœ€åˆçš„ 3 ä¸ªèŠ‚ç‚¹ï¼Œæ‰©å®¹åˆ°æœ€åçš„ 200 å¤šä¸ªèŠ‚ç‚¹ï¼Œä½†ç”±äºäººåŠ›é—®é¢˜ï¼ŒæœåŠ¡åˆæ²¡æœ‰ä»€ä¹ˆæ–°çš„éœ€æ±‚ï¼Œä¸‹å±‚çš„ä¼˜åŒ–å°±ä¸€ç›´è¢«æç½®ç€ã€‚</p><p><strong>ç¡¬ä»¶å‡çº§ï¼š</strong>æ°´å¹³æ‰©å®¹ä¸æ€»æ˜¯æœ‰æ•ˆçš„ï¼ŒåŸå› åœ¨äºå•èŠ‚ç‚¹çš„è®¡ç®—é‡æ¯”è¾ƒé›†ä¸­ï¼Œæˆ–è€… JVM å¯¹å†…å­˜çš„ä½¿ç”¨è¶…å‡ºäº†å®¿ä¸»æœºçš„æ‰¿è½½èŒƒå›´ã€‚åœ¨åŠ¨æ‰‹è¿›è¡Œä»£ç ä¼˜åŒ–ä¹‹å‰ï¼Œæˆ‘ä»¬ä¼šå¯¹èŠ‚ç‚¹çš„ç¡¬ä»¶é…ç½®è¿›è¡Œå‡çº§ã€‚</p><p><strong>ä»£ç ä¼˜åŒ–</strong>ï¼šä»£ç ä¼˜åŒ–æ˜¯æé«˜æ€§èƒ½æœ€æœ‰æ•ˆçš„æ–¹å¼ï¼Œä½†éœ€è¦æ”¶é›†ä¸€äº›æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½æ˜¯æœåŠ¡æ²»ç†ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ä»£ç æµç¨‹ä¼˜åŒ–ã€‚æ¯”å¦‚JavaAgent æŠ€æœ¯ï¼Œä¼šæ— ä¾µå…¥çš„æ”¶é›†ä¸€äº› profile ä¿¡æ¯ï¼Œä¾›æˆ‘ä»¬è¿›è¡Œå†³ç­–ã€‚</p><p><strong>å¹¶è¡Œä¼˜åŒ–ï¼š</strong>å¹¶è¡Œä¼˜åŒ–æ˜¯é’ˆå¯¹é€Ÿåº¦æ…¢çš„æ¥å£è¿›è¡Œå¹¶è¡Œè°ƒç”¨ã€‚æ‰€ä»¥æˆ‘ä»¬é€šå¸¸ä½¿ç”¨ ContDownLatch å¯¹éœ€è¦è·å–çš„æ•°æ®è¿›è¡Œå¹¶è¡Œå¤„ç†ï¼Œæ•ˆæœéå¸¸ä¸é”™ï¼Œæ¯”å¦‚åœ¨ 200ms å†…è¿”å›å¯¹ 50 ä¸ªè€—æ—¶ 100ms çš„ä¸‹å±‚æ¥å£çš„è°ƒç”¨ã€‚</p><p><strong>JVM ä¼˜åŒ–</strong>ï¼š JVM å‘ç”Ÿé—®é¢˜æ—¶ï¼Œä¼˜åŒ–ä¼šè·å¾—å·¨å¤§çš„æ€§èƒ½æå‡ã€‚ä½†åœ¨ JVM ä¸å‘ç”Ÿé—®é¢˜æ—¶ï¼Œå®ƒçš„ä¼˜åŒ–æ•ˆæœæœ‰é™ã€‚ä½†åœ¨ä»£ç ä¼˜åŒ–ã€å¹¶è¡Œä¼˜åŒ–ã€JVM ä¼˜åŒ–çš„è¿‡ç¨‹ä¸­ï¼ŒJVM çš„çŸ¥è¯†å´èµ·åˆ°äº†å…³é”®æ€§çš„ä½œç”¨</p><p><strong>æ“ä½œç³»ç»Ÿä¼˜åŒ–ï¼š</strong>æ“ä½œç³»ç»Ÿä¼˜åŒ–æ˜¯è§£å†³é—®é¢˜çš„æ€æ‰‹é”ï¼Œæ¯”å¦‚åƒ HugePageã€SWAPã€â€œCPU äº²å’Œæ€§â€è¿™ç§æ¯”è¾ƒåº•å±‚çš„ä¼˜åŒ–ã€‚ä½†å°±è®¡ç®—èŠ‚ç‚¹æ¥è¯´ï¼Œå¯¹æ“ä½œç³»ç»Ÿè¿›è¡Œä¼˜åŒ–å¹¶ä¸æ˜¯å¾ˆå¸¸è§ã€‚è¿ç»´åœ¨èƒŒåä¼šåšä¸€äº›è¯¸å¦‚æ–‡ä»¶å¥æŸ„çš„è°ƒæ•´ã€ç½‘ç»œå‚æ•°çš„ä¿®æ”¹ï¼Œè¿™å¯¹äºæˆ‘ä»¬æ¥è¯´å°±å·²ç»å¤Ÿç”¨äº†</p><h3 id="æµé‡å›æ”¾è‡ªåŠ¨åŒ–æµ‹è¯•"><a href="#æµé‡å›æ”¾è‡ªåŠ¨åŒ–æµ‹è¯•" class="headerlink" title="æµé‡å›æ”¾è‡ªåŠ¨åŒ–æµ‹è¯•"></a>æµé‡å›æ”¾è‡ªåŠ¨åŒ–æµ‹è¯•</h3><blockquote><p>ç³»ç»Ÿçº§çš„é‡æ„ï¼Œæµ‹è¯•å›å½’çš„å·¥ä½œé‡è‡³å°‘éƒ½æ˜¯ä»¥æœˆä¸ºå•ä½ï¼Œå¯¹äºäººåŠ›çš„æ¶ˆè€—å·¨å¤§ã€‚ä¸€ç§åº”å¯¹æ–¹æ¡ˆæ˜¯ï¼Œå…ˆä¸æ”¹é€ ï¼Œåˆ°ç³»ç»Ÿå®åœ¨æ‰›ä¸ä½äº†å†æƒ³åŠæ³•ã€‚å¦ä¸€ç§åº”å¯¹æ–¹æ¡ˆæ˜¯ï¼Œå…ˆæš‚åœéœ€æ±‚ï¼Œå…¨åŠ›è¿›è¡Œæ”¹é€ ã€‚ä½†åœ¨å®é™…å·¥ä½œåœºæ™¯ä¸­ï¼Œä¸Šè¿°åº”å¯¹ç­–ç•¥å¾€å¾€å¾ˆéš¾å®ç°ã€‚</p></blockquote><p>åœºæ™¯ï¼š</p><p>1ã€è¯»æœåŠ¡å‡æ˜¯æŸ¥è¯¢ï¼Œå®ƒæ˜¯æ— çŠ¶æ€çš„ã€‚</p><p>2ã€ä¸ç®¡æ˜¯æ¶æ„å‡çº§è¿˜æ˜¯æ—¥å¸¸éœ€æ±‚ï¼Œè¯»æœåŠ¡å¯¹å¤–æ¥å£çš„å‡ºå…¥å‚æ ¼å¼æ˜¯æ²¡æœ‰å˜åŒ–çš„</p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6jd95rpij315g0hqn5q.jpg" alt="image-20210504174447049" style="zoom:50%;" /><ul><li><p><strong>æ—¥å¿—æ”¶é›†</strong>ï¼Œä¸»è¦ä½œç”¨æ˜¯æ”¶é›†è¢«æµ‹ç³»ç»Ÿçš„çœŸå®ç”¨æˆ·è¯·æ±‚ï¼ŒåŸºäºä¸€å®šè§„åˆ™å¤„ç†åä½œä¸ºç³»ç»Ÿç”¨ä¾‹ï¼›</p><p>Spring é‡Œçš„ Interceptor ã€Servlet é‡Œçš„ Filter è¿‡æ»¤å™¨ï¼Œå¯¹æ‰€æœ‰è¯·æ±‚çš„å…¥å‚å’Œå‡ºå‚è¿›è¡Œè®°å½•ï¼Œå¹¶é€šè¿‡ MQ å‘é€å‡ºå»ã€‚ï¼ˆæ³¨æ„é”™å³°ã€è¿‡æ»¤å†™ã€å»é‡ç­‰ï¼‰</p></li><li><p>æ•°æ®å›æ”¾æ˜¯åŸºäºæ”¶é›†çš„ç”¨ä¾‹ï¼Œå¯¹è¢«æµ‹ç³»ç»Ÿè¿›è¡Œæ•°æ®å›æ”¾ï¼Œå‘èµ·è‡ªåŠ¨åŒ–æµ‹è¯•å›å½’ï¼›</p><p><strong>ç¦»çº¿å›æ”¾ï¼š</strong>åªè°ƒç”¨æ–°æœåŠ¡ï¼Œå°†è¿”å›çš„æ•°æ®å’Œæ—¥å¿—é‡Œçš„å‡ºå‚è¿›è¡Œæ¯”è¾ƒï¼Œ<strong>æ—¥å¿—æ¯”è¾ƒå¤§</strong></p><p><strong>å®æ—¶å›æ”¾ï¼š</strong>å»å®æ—¶è°ƒç”¨çº¿ä¸Šç³»ç»Ÿå’Œè¢«æµ‹ç³»ç»Ÿï¼Œå¹¶å­˜å‚¨å®æ—¶è¿”å›å›æ”¾çš„ç»“æœä¿¡æ¯ï¼Œ<strong>çº¿ä¸Šæœ‰è´Ÿæ‹…</strong></p><p><strong>å¹¶è¡Œå›æ”¾ï¼š</strong>æ–°ç‰ˆæœ¬ä¸å³æ—¶ä¸Šçº¿ï¼Œæ¯æ¬¡è°ƒç”¨è€ç‰ˆæœ¬æ¥å£æ—¶æ¦‚ç‡å®æ—¶å›æ”¾æ–°ç‰ˆæœ¬æ¥å£ï¼Œ<strong>è€—æ—¶é—´å‘¨æœŸ</strong></p></li><li><p><strong>å·®å¼‚å¯¹æ¯”</strong>ï¼Œé€šè¿‡å·®å¼‚å¯¹æ¯”è‡ªåŠ¨å‘ç°ä¸é¢„æœŸä¸ä¸€è‡´çš„ç”¨ä¾‹ï¼Œè¿›è€Œç¡®å®š Bugã€‚</p><p>é‡‡ç”¨æ–‡æœ¬å¯¹æ¯”ï¼Œå¯ä»¥ç›´è§‚åœ°çœ‹åˆ°å“ªä¸ªå­—æ®µæ•°æ®æœ‰å·®å¼‚ï¼Œä»è€Œæ›´å¿«å®šä½åˆ°é—®é¢˜ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œåªè¦å­˜åœ¨å·®å¼‚çš„æ•°æ®ï¼Œå‡å¯è®¤ä¸ºæ˜¯ Bugï¼Œæ˜¯éœ€è¦è¿›è¡Œä¿®å¤çš„ã€‚</p></li></ul><p><strong>æ–¹æ³•è®º</strong></p><p><strong>Discovery</strong></p><p>â€‹è€ƒè™‘ä¼ä¸šæˆ˜ç•¥ï¼Œåˆ†æå®¢æˆ·éœ€æ±‚ï¼Œåˆ¶å®šäº§å“ç›®æ ‡</p><p>â€‹ç”±å¤–åˆ°å†…ï¼šç«äº‰å¯¹æ‰‹çš„æ–¹æ¡ˆï¼Œä¸ºä»€ä¹ˆåšï¼Œä»¥åæ€ä¹ˆå‘å±•ï¼Œå¦‚ä½•å»ä¼˜åŒ–ã€‚</p><p>â€‹è‡ªä¸Šè€Œä¸‹ï¼šåŸºäºå…¬å¸çš„æˆ˜ç•¥ï¼Œè€ƒè™‘è‡ªèº«èƒ½åŠ›å’Œæ‰€å¤„ç¯å¢ƒã€‚</p><p>â€‹è‡ªä¸‹è€Œä¸Šï¼šä»èµ„æºã€å†å²é—®é¢˜ã€ä¼˜å…ˆçº§å‡ºå‘ï¼Œå½¢æˆä¸€å¥—å¯è¡Œæ€§å®æ–½æ–¹æ³•ã€‚</p><p><strong>Define</strong></p><p>â€‹åŸºäºæ”¶é›†çš„ä¿¡æ¯ï¼Œç»¼åˆè·¨ä¸šåŠ¡çº¿çš„æŠ½è±¡èƒ½åŠ›å’ŒæœåŠ¡ï¼Œå…ˆåšä»€ä¹ˆååšä»€ä¹ˆï¼Œæ€ä¹ˆåš</p><p>â€‹è®¾è®¡æ–°çš„æ¶æ„ï¼Œé‡ç‚¹è®¾è®¡è§£å†³ç—›ç‚¹é—®é¢˜ã€‚</p><p>â€‹æ‹†åˆ†ä¸šåŠ¡é¢†åŸŸï¼Œé‡ç‚¹åˆ’åˆ†å·¥ä½œä¸´ç•Œä¸Šä¸‹æ–‡ã€‚</p><p><strong>Design</strong></p><p>â€‹è¯¦ç»†çš„ä¸šåŠ¡è®¾è®¡ï¼ŒåŠŸèƒ½è®¾è®¡ï¼Œäº¤ä»˜è®¡åˆ’ï¼Œè€ƒæ ¸è®¡åˆ’</p><p>â€‹äº§å“æ„¿æ™¯ï¼Œäº§å“å½¢æ€ï¼Œç›¸å…³ç«å“æ–¹æ¡ˆå¯¹æ¯”ï¼Œä»·å€¼ã€ä¼˜åŠ¿ã€æ”¶ç›Š</p><p>â€‹æ¢³ç†ä¸šåŠ¡èŒƒå›´ï¼Œè¦çŸ¥é“ç”µå•†é¢†åŸŸå››å¤§æµï¼ˆä¿¡æ¯æµã€å•†æµã€èµ„é‡‘æµã€ç‰©æµï¼‰</p><p>â€‹MVPæœ€å°å¯ç”¨æ¯”ï¼Œè®©å®¢æˆ·å’Œè€å¤§çœ‹åˆ°ç»“æœï¼Œæœ€åé€šç¼–å†™storyæŠŠæ•…äº‹ç¼–åœ†</p><p><strong>Delivery</strong></p><p>â€‹äº¤ä»˜é˜¶æ®µï¼Œæ ¹æ®åé¦ˆåŠæ—¶è°ƒæ•´ä¸­å°æˆ˜ç•¥ï¼Œå‡å°‘æŸå¤±å’Œå¢å¤§æ”¶ç›Š</p><p>â€‹åˆç†åˆ¶å®šæ¯ä¸ªé˜¶æ®µçš„ç»©æ•ˆè€ƒæ ¸ç›®æ ‡ï¼š</p><p>â€‹40%ç¨³å®š+25%ä¸šåŠ¡åˆ›æ–°+20%æœåŠ¡æ¥å…¥+15%ç”¨æˆ·æ»¡æ„åº¦</p><h1 id="ä¸ƒã€æ¶æ„è®¾è®¡"><a href="#ä¸ƒã€æ¶æ„è®¾è®¡" class="headerlink" title="ä¸ƒã€æ¶æ„è®¾è®¡"></a><strong>ä¸ƒã€æ¶æ„è®¾è®¡</strong></h1><h2 id="1ã€ç¤¾åŒºç³»ç»Ÿçš„æ¶æ„"><a href="#1ã€ç¤¾åŒºç³»ç»Ÿçš„æ¶æ„" class="headerlink" title="1ã€ç¤¾åŒºç³»ç»Ÿçš„æ¶æ„"></a>1ã€ç¤¾åŒºç³»ç»Ÿçš„æ¶æ„</h2><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gmqv8zyhkqj311s0u0q7s.jpg" alt="image-20210117182546782" style="zoom:40%;" /><p><strong>ç³»ç»Ÿæ‹†åˆ†</strong></p><p>â€‹é€šè¿‡DDDé¢†åŸŸæ¨¡å‹ï¼Œå¯¹æœåŠ¡è¿›è¡Œæ‹†åˆ†ï¼Œå°†ä¸€ä¸ªç³»ç»Ÿæ‹†åˆ†ä¸ºå¤šä¸ªå­ç³»ç»Ÿï¼ŒåšæˆSpringCloudçš„å¾®æœåŠ¡ã€‚å¾®æœåŠ¡è®¾è®¡æ—¶è¦å°½å¯èƒ½åšåˆ°å°‘æ‰‡å‡ºï¼Œå¤šæ‰‡å…¥ï¼Œæ ¹æ®æœåŠ¡å™¨çš„æ‰¿è½½ï¼Œè¿›è¡Œå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼Œé€šè¿‡å¯¹æ ¸å¿ƒæœåŠ¡çš„ä¸Šæ¸¸æœåŠ¡è¿›è¡Œé™æµå’Œé™çº§æ”¹é€ ã€‚</p><p>â€‹ä¸€ä¸ªæœåŠ¡çš„ä»£ç ä¸è¦å¤ªå¤šï¼Œ1 ä¸‡è¡Œå·¦å³ï¼Œä¸¤ä¸‰ä¸‡æ’‘æ­»äº†å§ã€‚</p><p>â€‹å¤§éƒ¨åˆ†çš„ç³»ç»Ÿï¼Œæ˜¯è¦è¿›è¡Œ<strong>å¤šè½®æ‹†åˆ†</strong>çš„ï¼Œç¬¬ä¸€æ¬¡æ‹†åˆ†ï¼Œå¯èƒ½å°±æ˜¯å°†ä»¥å‰çš„å¤šä¸ªæ¨¡å—è¯¥æ‹†åˆ†å¼€æ¥äº†ï¼Œæ¯”å¦‚è¯´å°†ç”µå•†ç³»ç»Ÿæ‹†åˆ†æˆ<strong>è®¢å•ç³»ç»Ÿã€å•†å“ç³»ç»Ÿã€é‡‡è´­ç³»ç»Ÿã€ä»“å‚¨ç³»ç»Ÿã€ç”¨æˆ·ç³»ç»Ÿ</strong>ç­‰ç­‰å§ã€‚</p><p>â€‹ä½†æ˜¯åé¢å¯èƒ½æ¯ä¸ªç³»ç»Ÿåˆå˜å¾—è¶Šæ¥è¶Šå¤æ‚äº†ï¼Œæ¯”å¦‚è¯´é‡‡è´­ç³»ç»Ÿé‡Œé¢åˆåˆ†æˆäº†<strong>ä¾›åº”å•†ç®¡ç†ç³»ç»Ÿã€é‡‡è´­å•ç®¡ç†ç³»ç»Ÿ</strong>ï¼Œè®¢å•ç³»ç»Ÿåˆæ‹†åˆ†æˆäº†<strong>è´­ç‰©è½¦ç³»ç»Ÿã€ä»·æ ¼ç³»ç»Ÿã€è®¢å•ç®¡ç†</strong>ç³»ç»Ÿã€‚</p><p><strong>CDNã€Nginxé™æ€ç¼“å­˜ã€JVMç¼“å­˜</strong></p><p>â€‹åˆ©ç”¨Javaçš„æ¨¡æ¿thymeleafå¯ä»¥å°†é¡µé¢å’Œæ•°æ®åŠ¨æ€æ¸²æŸ“å¥½ï¼Œç„¶åé€šè¿‡Nginxç›´æ¥è¿”å›ã€‚åŠ¨æ€æ•°æ®å¯ä»¥ä»redisä¸­è·å–ã€‚å…¶ä¸­redisé‡Œçš„æ•°æ®ç”±ä¸€ä¸ªç¼“å­˜æœåŠ¡æ¥è¿›è¡Œæ¶ˆè´¹æŒ‡å®šçš„å˜æ›´æœåŠ¡ã€‚</p><p>â€‹å•†å“æ•°æ®ï¼Œæ¯æ¡æ•°æ®æ˜¯ 10kbã€‚100 æ¡æ•°æ®æ˜¯ 1mbï¼Œ10 ä¸‡æ¡æ•°æ®æ˜¯ 1gã€‚å¸¸é©»å†…å­˜çš„æ˜¯ 200 ä¸‡æ¡å•†å“æ•°æ®ï¼Œå ç”¨å†…å­˜æ˜¯ 20gï¼Œä»…ä»…ä¸åˆ°æ€»å†…å­˜çš„ 50%ã€‚ç›®å‰é«˜å³°æœŸæ¯ç§’å°±æ˜¯ 3500 å·¦å³çš„è¯·æ±‚é‡ã€‚</p><p><strong>ç¼“å­˜</strong></p><p>Redis clusterï¼Œ10 å°æœºå™¨ï¼Œ5ä¸»5ä»ï¼Œ5 ä¸ªèŠ‚ç‚¹å¯¹å¤–æä¾›è¯»å†™æœåŠ¡ï¼Œ<strong>æ¯ä¸ªèŠ‚ç‚¹çš„è¯»å†™é«˜å³° QPS</strong> å¯èƒ½å¯ä»¥è¾¾åˆ°æ¯ç§’ 5 ä¸‡ï¼Œ<strong>5 å°æœºå™¨æœ€å¤šæ˜¯ 25 ä¸‡è¯»å†™</strong>è¯·æ±‚æ¯ç§’ã€‚</p><p>â€‹<strong>32G å†…å­˜+ 8 æ ¸ CPU + 1T</strong> ç£ç›˜ï¼Œä½†æ˜¯åˆ†é…ç»™ <strong>Redis è¿›ç¨‹çš„æ˜¯ 10g å†…å­˜</strong>ï¼Œä¸€èˆ¬çº¿ä¸Šç”Ÿäº§ç¯å¢ƒï¼ŒRedis çš„å†…å­˜å°½é‡ä¸è¦è¶…è¿‡ 10gï¼Œè¶…è¿‡ 10g å¯èƒ½ä¼šæœ‰é—®é¢˜ã€‚</p><p>â€‹å› ä¸ºæ¯ä¸ªä¸»å®ä¾‹éƒ½æŒ‚äº†ä¸€ä¸ªä»å®ä¾‹ï¼Œæ‰€ä»¥æ˜¯<strong>é«˜å¯ç”¨</strong>çš„ï¼Œä»»ä½•ä¸€ä¸ªä¸»å®ä¾‹å®•æœºï¼Œéƒ½ä¼šè‡ªåŠ¨æ•…éšœè¿ç§»ï¼ŒRedis ä»å®ä¾‹<strong>ä¼šè‡ªåŠ¨å˜æˆä¸»å®ä¾‹</strong>ç»§ç»­æä¾›è¯»å†™æœåŠ¡ã€‚</p><p><strong>MQ</strong></p><p>â€‹å¯ä»¥é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å¯¹å¾®æœåŠ¡ç³»ç»Ÿè¿›è¡Œ<a href="#1%E3%80%81%E6%8B%86%E5%88%86%E5%BE%AE%E6%9C%8D%E5%8A%A1">è§£è€¦</a>ï¼Œå¼‚æ­¥è°ƒç”¨çš„æ›´é€‚åˆå¾®æœåŠ¡çš„æ‰©å±•</p><p>â€‹åŒæ—¶å¯ä»¥åº”å¯¹ç§’æ€æ´»åŠ¨ä¸­[åº”å¯¹é«˜å¹¶å‘å†™è¯·æ±‚](# 6ã€åº”å¯¹é«˜å¹¶å‘çš„å†™è¯·æ±‚)ï¼Œæ¯”å¦‚kafkaåœ¨æ¯«ç§’å»¶è¿ŸåŸºç¡€ä¸Šå¯ä»¥å®ç°10wçº§ååé‡</p><p>â€‹é’ˆå¯¹<a href="#IOT%E6%B5%81%E9%87%8F%E6%B4%AA%E5%B3%B0">IOTæµé‡æ´ªå³°</a>åšäº†ä¸€äº›ç‰¹æ®Šçš„ä¼˜åŒ–ï¼Œä¿è¯æ¶ˆæ¯çš„åŠæ—¶æ€§</p><p>â€‹åŒæ—¶å¯ä»¥ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ä¿è¯åˆ†å¸ƒå¼ç³»ç»Ÿ<a href="#7%E3%80%81%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7">æœ€ç»ˆä¸€è‡´æ€§</a></p><p><strong>åˆ†åº“åˆ†è¡¨</strong></p><p>â€‹åˆ†åº“åˆ†è¡¨ï¼Œå¯èƒ½åˆ°äº†æœ€åæ•°æ®åº“å±‚é¢è¿˜æ˜¯å…ä¸äº†æŠ—é«˜å¹¶å‘çš„è¦æ±‚ï¼Œå¥½å§ï¼Œé‚£ä¹ˆå°± å°†ä¸€ä¸ªæ•°æ®åº“æ‹†åˆ†ä¸ºå¤šä¸ªåº“ï¼Œå¤šä¸ªåº“æ¥æ‰›æ›´é«˜çš„å¹¶å‘ï¼›ç„¶åå°†ä¸€ä¸ªè¡¨æ‹†åˆ†ä¸ºå¤šä¸ª è¡¨ï¼Œæ¯ä¸ªè¡¨çš„æ•°æ®é‡ä¿æŒå°‘ä¸€ç‚¹ï¼Œæé«˜ sql è·‘çš„æ€§èƒ½ã€‚<strong>åœ¨é€šè®¯å½•ã€è®¢å•å’Œå•†åŸå•†å“æ¨¡å—è¶…è¿‡åƒä¸‡çº§åˆ«éƒ½åº”åŠæ—¶è€ƒè™‘åˆ†è¡¨åˆ†åº“</strong></p><p><strong>è¯»å†™åˆ†ç¦»</strong></p><p>â€‹è¯»å†™åˆ†ç¦»ï¼Œè¿™ä¸ªå°±æ˜¯è¯´å¤§éƒ¨åˆ†æ—¶å€™æ•°æ®åº“å¯èƒ½ä¹Ÿæ˜¯è¯»å¤šå†™å°‘ï¼Œæ²¡å¿…è¦æ‰€æœ‰è¯·æ±‚éƒ½ é›†ä¸­åœ¨ä¸€ä¸ªåº“ä¸Šå§ï¼Œå¯ä»¥æä¸ªä¸»ä»æ¶æ„ï¼Œä¸»åº“å†™å…¥ï¼Œä»åº“è¯»å–ï¼Œæä¸€ä¸ªè¯»å†™åˆ†ç¦»ã€‚ è¯»æµé‡å¤ªå¤šçš„æ—¶å€™ï¼Œè¿˜å¯ä»¥åŠ æ›´å¤šçš„ä»åº“ã€‚æ¯”å¦‚<strong>ç»Ÿè®¡ç›‘æ§ç±»çš„å¾®æœåŠ¡</strong>é€šè¿‡è¯»å†™åˆ†ç¦»ï¼Œåªéœ€è®¿é—®ä»åº“å°±å¯ä»¥å®Œæˆç»Ÿè®¡ï¼Œä¾‹å¦‚ES</p><p><strong>ElasticSearch</strong></p><p>â€‹Elasticsearchï¼Œç®€ç§° esã€‚es æ˜¯åˆ†å¸ƒå¼çš„ï¼Œå¯ä»¥éšä¾¿æ‰©å®¹ï¼Œåˆ†å¸ƒå¼å¤©ç„¶å°±å¯ä»¥æ”¯æ’‘é«˜å¹¶å‘ï¼Œå› ä¸ºåŠ¨ä¸åŠ¨å°±å¯ä»¥æ‰©å®¹åŠ æœºå™¨æ¥æ‰›æ›´é«˜çš„å¹¶å‘ã€‚é‚£ä¹ˆä¸€äº›æ¯”è¾ƒç®€å•çš„<strong>æŸ¥è¯¢ã€ç»Ÿè®¡ç±»</strong>çš„æ“ä½œï¼Œæ¯”å¦‚<strong>è¿è¥å¹³å°ä¸Š</strong>çš„å„åœ°å¸‚çš„æ±‡èšç»Ÿè®¡ï¼Œè¿˜æœ‰ä¸€äº›<strong>å…¨æ–‡æœç´¢ç±»</strong>çš„æ“ä½œï¼Œæ¯”å¦‚<strong>é€šè®¯å½•å’Œè®¢å•</strong>çš„æŸ¥è¯¢ã€‚</p><h2 id="2ã€å•†åŸç³»ç»Ÿ-äº¿çº§å•†å“å¦‚ä½•å­˜å‚¨"><a href="#2ã€å•†åŸç³»ç»Ÿ-äº¿çº§å•†å“å¦‚ä½•å­˜å‚¨" class="headerlink" title="2ã€å•†åŸç³»ç»Ÿ-äº¿çº§å•†å“å¦‚ä½•å­˜å‚¨"></a>2ã€å•†åŸç³»ç»Ÿ-äº¿çº§å•†å“å¦‚ä½•å­˜å‚¨</h2><p>åŸºäº Hash å–æ¨¡ã€ä¸€è‡´æ€§ Hash å®ç°åˆ†åº“åˆ†è¡¨</p><p>é«˜å¹¶å‘è¯»å¯ä»¥é€šè¿‡<a href="5%E3%80%81%E5%BA%94%E5%AF%B9%E9%AB%98%E5%B9%B6%E5%8F%91%E7%9A%84%E8%AF%BB%E8%AF%B7%E6%B1%82">å¤šçº§ç¼“å­˜</a>åº”å¯¹</p><p>å¤§ä¿ƒé”€çƒ­keyè¯»çš„é—®é¢˜é€šè¿‡<a href="**4%E3%80%81%E7%83%ADkey%E9%97%AE%E9%A2%98%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%EF%BC%9F**">redisé›†ç¾¤+æœ¬åœ°ç¼“å­˜+é™æµ+keyåŠ éšæœºå€¼</a>åˆ†å¸ƒåœ¨å¤šä¸ªå®ä¾‹ä¸­</p><p>é«˜å¹¶å‘å†™çš„é—®é¢˜é€šè¿‡<strong>åŸºäº Hash å–æ¨¡ã€ä¸€è‡´æ€§ Hash å®ç°åˆ†åº“åˆ†è¡¨</strong>å‡åŒ€è½ç›˜</p><p>ä¸šåŠ¡åˆ†é…ä¸å‡å¯¼è‡´çš„<strong>çƒ­key</strong>è¯»å†™é—®é¢˜ï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡åœºæ™¯è¿›è¡Œrangeåˆ†ç‰‡ï¼Œå°†çƒ­ç‚¹èŒƒå›´ä¸‹çš„å­keyæ‰“æ•£</p><p>å…·ä½“å®ç°ï¼šé¢„å…ˆè®¾å®šä¸»é”®çš„ç”Ÿæˆè§„åˆ™ï¼Œæ ¹æ®è§„åˆ™è¿›è¡Œæ•°æ®çš„åˆ†ç‰‡è·¯ç”±ï¼Œä½†è¿™ç§æ–¹å¼ä¼šä¾µå…¥å•†å“å„æ¡çº¿ä¸»æ•°æ®çš„ä¸šåŠ¡è§„åˆ™ï¼Œæ›´å¥½çš„æ–¹å¼æ˜¯åŸºäº<strong>åˆ†ç‰‡å…ƒæ•°æ®æœåŠ¡å™¨</strong>ï¼ˆå³æ¯æ¬¡è®¿é—®åˆ†ç‰‡å‰å…ˆè¯¢é—®åˆ†ç‰‡å…ƒæœåŠ¡å™¨åœ¨è·¯ç”±åˆ°å®é™…åˆ†ç‰‡ï¼‰ä¸è¿‡ä¼šå¸¦æ¥å¤æ‚æ€§ï¼Œæ¯”å¦‚ä¿è¯å…ƒæ•°æ®æœåŠ¡å™¨çš„<strong>ä¸€è‡´æ€§</strong>å’Œå¯ç”¨æ€§ã€‚</p><h2 id="3ã€å¯¹è´¦ç³»ç»Ÿ-åˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§"><a href="#3ã€å¯¹è´¦ç³»ç»Ÿ-åˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§" class="headerlink" title="3ã€å¯¹è´¦ç³»ç»Ÿ-åˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§"></a>3ã€å¯¹è´¦ç³»ç»Ÿ-åˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§</h2><blockquote><p>å°½é‡é¿å…åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå•è¿›ç¨‹ç”¨æ•°æ®åº“äº‹åŠ¡ï¼Œè·¨è¿›ç¨‹ç”¨æ¶ˆæ¯é˜Ÿåˆ—</p></blockquote><p>ä¸»æµå®ç°åˆ†å¸ƒå¼ç³»ç»Ÿäº‹åŠ¡ä¸€è‡´æ€§çš„æ–¹æ¡ˆï¼š</p><ol><li><strong>æœ€ç»ˆä¸€è‡´æ€§</strong>ï¼šä¹Ÿå°±æ˜¯åŸºäº MQ çš„å¯é æ¶ˆæ¯æŠ•é€’çš„æœºåˆ¶ï¼Œ</li><li>åŸºäºé‡è¯•åŠ ç¡®è®¤çš„çš„<strong>æœ€å¤§åŠªåŠ›é€šçŸ¥æ–¹æ¡ˆ</strong>ã€‚</li></ol><p>ç†è®ºä¸Šä¹Ÿå¯ä»¥ä½¿ç”¨ï¼ˆ2PCä¸¤é˜¶æ®µæäº¤ã€3PCä¸‰é˜¶æ®µæäº¤ã€TCCçŸ­äº‹åŠ¡ã€SAGAé•¿äº‹åŠ¡æ–¹æ¡ˆï¼‰ï¼Œä½†æ˜¯è¿™äº›æ–¹æ¡ˆå·¥ä¸šä¸Šè½åœ°ä»£ä»·å¾ˆå¤§ï¼Œä¸é€‚åˆäº’è”ç½‘çš„ä¸šç•Œåœºæ™¯ã€‚é’ˆå¯¹é‡‘èæ”¯ä»˜ç­‰éœ€è¦å¼ºä¸€è‡´æ€§çš„åœºæ™¯å¯ä»¥é€šè¿‡å‰ä¸¤ç§æ–¹æ¡ˆå®ç°ã€‚ï¼ˆ<strong>å±•å¼€è¯´çš„è¯å‚è€ƒåˆ†å¸ƒå¼äº‹åŠ¡</strong>ï¼‰</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1goruh4oifej30xq0auq7p.jpg" alt="image-20210321212516364"></p><p>æœ¬åœ°æ•°æ®åº“äº‹åŠ¡åŸç†ï¼š<strong>undo log</strong>ï¼ˆåŸå­æ€§ï¼‰ + <strong>redo log</strong>ï¼ˆæŒä¹…æ€§ï¼‰ + <strong>æ•°æ®åº“é”</strong>ï¼ˆåŸå­æ€§&amp;éš”ç¦»æ€§ï¼‰ + <strong>MVCC</strong>ï¼ˆéš”ç¦»æ€§ï¼‰</p><p>åˆ†å¸ƒå¼äº‹åŠ¡åŸç†ï¼š<strong>å…¨å±€äº‹åŠ¡åè°ƒå™¨ï¼ˆåŸå­æ€§ï¼‰</strong> + å…¨å±€é”ï¼ˆéš”ç¦»æ€§ï¼‰ + <strong>DBæœ¬åœ°äº‹åŠ¡ï¼ˆåŸå­æ€§ã€æŒä¹…æ€§ï¼‰</strong></p><p>ä¸€ã€æˆ‘ä»¬å…¬å¸è´¦å•ç³»ç»Ÿå’Œç¬¬ä¸‰æ–¹æ”¯ä»˜ç³»ç»Ÿå¯¹è´¦æ—¶ï¼Œå°±é‡‡ç”¨â€œ<strong>è‡ªç ”è¡¥å¿&#x2F;MQæ–¹æ¡ˆ + äººå·¥ä»‹å…¥</strong>â€æ–¹å¼</p><p>è½åœ°çš„è¯ï¼šæ–¹æ¡ˆæœ€â€œè½»â€ï¼Œæ€§èƒ½æŸå¤±æœ€å°‘ã€‚å¯æŒæ§æ€§å¥½ï¼Œç®€å•æ˜“æ‡‚ï¼Œæ˜“ç»´æŠ¤ã€‚<br>è€ƒè™‘åˆ°åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜æ˜¯å°æ¦‚ç‡äº‹ä»¶ï¼Œç•™æœ‰è¡¥æ•‘ä½™åœ°å°±è¡Œï¼Œæ€§èƒ½çš„æŸå¤±å¯æ˜¯å®æ‰“å®çš„ååº”åœ¨çº¿ä¸Šæ¯ä¸€ä¸ªè¯·æ±‚ä¸Š</p><p>äºŒã€ä¹Ÿäº†è§£åˆ°ä¸šç•Œæ¯”å¦‚é˜¿é‡Œæˆç†Ÿ<strong>Seata AT</strong>æ¨¡å¼ï¼Œå¹³å‡æ€§èƒ½ä¼šé™ä½35%ä»¥ä¸Š</p><p>æˆ‘è§‰å¾—ä¸æ˜¯ç‰¹æ®Šçš„åœºæ™¯ä¸æ¨è</p><p>ä¸‰ã€RocketMQäº‹åŠ¡æ¶ˆæ¯</p><p>å¬èµ·æ¥æŒºå¥½æŒºç®€å•çš„æ–¹æ¡ˆï¼Œä½†å®ƒæ¯”è¾ƒæŒ‘ä¸šåŠ¡åœºæ™¯ï¼ŒåŒæ­¥æ€§å¼ºçš„å¤„ç†é“¾è·¯ä¸é€‚åˆã€‚<br>ã€é‡è¦ã€‘è¦æ±‚ä¸‹æ¸¸MQæ¶ˆè´¹æ–¹ä¸€å®šèƒ½æˆåŠŸæ¶ˆè´¹æ¶ˆæ¯ã€‚å¦åˆ™è½¬äººå·¥ä»‹å…¥å¤„ç†ã€‚<br>ã€é‡è¦ã€‘åƒä¸‡è®°å¾—å®ç°å¹‚ç­‰æ€§ã€‚</p><h2 id="4ã€ç”¨æˆ·ç³»ç»Ÿ-å¤šçº¿ç¨‹æ•°æ®å‰²æ¥"><a href="#4ã€ç”¨æˆ·ç³»ç»Ÿ-å¤šçº¿ç¨‹æ•°æ®å‰²æ¥" class="headerlink" title="4ã€ç”¨æˆ·ç³»ç»Ÿ-å¤šçº¿ç¨‹æ•°æ®å‰²æ¥"></a>4ã€ç”¨æˆ·ç³»ç»Ÿ-å¤šçº¿ç¨‹æ•°æ®å‰²æ¥</h2><p>ç”±äºé¡¹ç›®éœ€è¦è¿›è¡Œæ•°æ®å‰²æ¥ï¼Œä¿è¯ç”¨æˆ·å¤šå¹³å°ä½¿ç”¨ç”¨æˆ·æ„ŸçŸ¥çš„ä¸€è‡´ï¼Œå°†å¹¿ä¸œé¡¹ç›®çš„å‡ ç™¾ä¸‡ç”¨æˆ·åŠä¸šåŠ¡æ•°æ®æŒ‰ç…§ä¸€å®šçš„é€»è¾‘çŒåˆ°ç¤¾åŒºäº‘å¹³å°ä¸Šï¼Œç”±äºä¾èµ–äº†ç¬¬ä¸‰æ–¹ç»Ÿä¸€è®¤è¯å’Œçœä¾§crmç³»ç»Ÿï¼ŒæŒ‰ç…§ä¹‹å‰ç³»ç»Ÿå†…å‰²æ¥çš„æ–¹æ³•ï¼Œé€šè¿‡æ•°æ®åº“å°†ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†æŸ¥å‡ºæ¥ç„¶åä½¿ç”¨å¤šçº¿ç¨‹å‘çœä¾§crmç³»ç»Ÿè·å–ç»“æœã€‚</p><p>ä½†æ˜¯æµ‹è¯•çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°æ¯ä¸ªçº¿ç¨‹è¯·æ±‚çš„æ•°æ®å‘ç”Ÿäº†é”™ä¹±ï¼Œå¯¼è‡´æ¯ä¸ªè¯·æ±‚å¤„ç†çš„æ•°æ®æœ‰é‡å¤ï¼Œäºæ˜¯ç«‹å³åœæ­¢äº†è„šæœ¬ï¼Œå½“æ—¶æ€€ç–‘æ˜¯å¤šçº¿ç¨‹å¯¹èµ„æºå¹¶å‘è®¿é—®å¯¼è‡´çš„ï¼Œäºæ˜¯æŠŠArrayList æ”¹æˆäº†CopyOnWriteArrayListï¼Œä½†æ˜¯æŠ˜è…¾äº†ä¸€æ™šä¸Šï¼Œä¸ç®¡æ€ä¹ˆä¿®æ”¹ï¼Œçº¿ç¨‹ä¹‹é—´ä¸€ç›´æœ‰é‡å¤æ•°æ®ï¼Œå«äº†ä¸€èµ·åŠ ç­çš„åŒäº‹ä¹Ÿæ²¡çœ‹å‡ºé—®é¢˜æ¥ï¼Œå’ŒåŒäº‹ä¼°ç®—äº†ä¸€ä¸‹ä¸ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œå¤§æ¦‚30-40ä¸ªå°æ—¶èƒ½è·‘å®Œï¼Œæƒ³äº†ä¸‹ä¹Ÿèƒ½æ¥å—ï¼Œæœ¬æ¥å·²ç»å‡†å¤‡æ”¾å¼ƒäº†ã€‚</p><p>ä¸è¿‡å›åˆ°å®¶ï¼Œæˆ‘è¿˜æ˜¯ç”¨å¤šçº¿ç¨‹ä»”ç»†å•æ­¥æ¨¡æ‹Ÿäº†ä¸‹ï¼Œæ•´ä¸ªå¤„ç†çš„è¿‡ç¨‹ï¼Œå‘ç°åœ¨èµ·çº¿ç¨‹çš„æ—¶å€™ï¼Œæœ‰äº›å­çº¿ç¨‹å¹¶æ²¡æœ‰æŠŠåˆ†é…ç»™ä»–çš„å…¨éƒ¨idçš„listå¤„ç†å®Œï¼Œå¯¼è‡´æœ€ç»ˆçŠ¶æ€æ²¡æ›´æ–°ï¼Œæ–°çº¿ç¨‹åˆå»æ‰§è¡Œäº†ä¸€éï¼Œç„¶åæˆ‘å°è¯•é€šè¿‡ä¿®æ”¹åœ¨çº¿ç¨‹å¤–æ·±æ‹·è´ä¸€ä¸ªListå†ä½œä¸ºå‚æ•°ä¼ å…¥åˆ°å­çº¿ç¨‹é‡Œï¼Œï¼ˆåç»­clearçš„æ—¶å€™ä¹Ÿæ˜¯clearè€çš„Listï¼‰æœç„¶ï¼Œæ•´ä¸ªæµ‹è¯•è¿‡ç¨‹ä¸­å†ä¹Ÿæ²¡å‡ºç°è¿‡é‡å¤å¤„ç†çš„æƒ…å†µã€‚</p><p>äº‹åï¼Œæˆ‘ä¹Ÿæ·±ç©¶äº†ä¸‹åŸå› ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(arrayBuffer.length == <span class="number">99</span>) &#123;</span><br><span class="line"> <span class="type">val</span> <span class="variable">asList</span> <span class="operator">=</span> arrayBuffer.toList</span><br><span class="line"> exec.execute ( openIdInsertMethod(asList) )</span><br><span class="line"> arrayBuffer.clear</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å¼€å¯å¦å¤–ä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œåˆ™æ–°å¼€çº¿ç¨‹ç§°ä¸ºè¯¥çº¿ç¨‹çš„å­çº¿ç¨‹ï¼Œå­çº¿ç¨‹åˆå§‹ä¼˜å…ˆçº§ä¸çˆ¶çº¿ç¨‹ç›¸åŒã€‚ä¸è¿‡ä¸»çº¿ç¨‹å…ˆå¯åŠ¨å ç”¨äº†cpuèµ„æºï¼Œå› æ­¤ä¸»çº¿ç¨‹æ€»æ˜¯ä¼˜äºå­çº¿ç¨‹ã€‚ç„¶è€Œï¼Œå³ä½¿è®¾ç½®äº†ä¼˜å…ˆçº§ï¼Œä¹Ÿæ— æ³•ä¿éšœçº¿ç¨‹çš„æ‰§è¡Œæ¬¡åºã€‚åªä¸è¿‡ï¼Œä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹è·å–CPUèµ„æºçš„æ¦‚ç‡è¾ƒå¤§ï¼Œä¼˜å…ˆçº§ä½çš„å¹¶éæ²¡æœºä¼šæ‰§è¡Œã€‚</p><p>æ‰€ä»¥ä¸»çº¿ç¨‹ä¸Šçš„clearæ“ä½œæœ‰å¯èƒ½å…ˆæ‰§è¡Œï¼Œé‚£ä¹ˆå­çº¿ç¨‹ä¸­æœªå¤„ç†å®Œçš„æ•°æ®å°±å˜æˆä¸€ä¸ªç©ºçš„æ•°ç»„ï¼Œæ‰€ä»¥å°±å‡ºç°äº†å¤šä¸ªçº¿ç¨‹å‡ºç°äº†é‡å¤æ•°æ®çš„åŸå› ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä¿è¯çš„æ˜¯å­çº¿ç¨‹æ¯æ¬¡æ‰§è¡Œå®Œåå†è¿›è¡Œclearå³å¯ã€‚è€Œä¸æ˜¯ä¸€å¼€å§‹å®šä½çš„ä¿è¯ArrayListçš„å®‰å…¨æ€§ã€‚æ‰€ä»¥å°†èµ‹å€¼(buffer-&gt;list)æ“ä½œæ”¾åœ¨å¤–é¢å»æ‰§è¡Œåï¼Œå¤šçº¿ç¨‹æ•°æ®å°±æ­£å¸¸äº†ã€‚</p><h2 id="5ã€ç§’æ€ç³»ç»Ÿåœºæ™¯è®¾è®¡"><a href="#5ã€ç§’æ€ç³»ç»Ÿåœºæ™¯è®¾è®¡" class="headerlink" title="5ã€ç§’æ€ç³»ç»Ÿåœºæ™¯è®¾è®¡"></a>5ã€ç§’æ€ç³»ç»Ÿåœºæ™¯è®¾è®¡</h2><p>[è§ç§’æ€é¡¹ç›®æ–¹æ¡ˆè®¾è®¡](# äºŒã€ç§’æ€é¡¹ç›®)</p><h2 id="6ã€ç»Ÿè®¡ç³»ç»Ÿ-æµ·é‡è®¡æ•°"><a href="#6ã€ç»Ÿè®¡ç³»ç»Ÿ-æµ·é‡è®¡æ•°" class="headerlink" title="6ã€ç»Ÿè®¡ç³»ç»Ÿ-æµ·é‡è®¡æ•°"></a><strong>6ã€ç»Ÿè®¡ç³»ç»Ÿ-æµ·é‡è®¡æ•°</strong></h2><p><strong>ä¸­å°è§„æ¨¡çš„è®¡æ•°æœåŠ¡</strong>ï¼ˆä¸‡çº§ï¼‰</p><p>æœ€å¸¸è§çš„è®¡æ•°æ–¹æ¡ˆæ˜¯é‡‡ç”¨ç¼“å­˜ + DB çš„å­˜å‚¨æ–¹æ¡ˆã€‚å½“è®¡æ•°å˜æ›´æ—¶ï¼Œå…ˆå˜æ›´è®¡æ•° DBï¼Œè®¡æ•°åŠ  1ï¼Œç„¶åå†å˜æ›´è®¡æ•°ç¼“å­˜ï¼Œä¿®æ”¹è®¡æ•°å­˜å‚¨çš„ Memcached æˆ– Redisã€‚è¿™ç§æ–¹æ¡ˆæ¯”è¾ƒé€šç”¨ä¸”æˆç†Ÿï¼Œä½†åœ¨é«˜å¹¶å‘è®¿é—®åœºæ™¯ï¼Œæ”¯æŒä¸å¤Ÿå‹å¥½ã€‚åœ¨äº’è”ç½‘ç¤¾äº¤ç³»ç»Ÿä¸­ï¼Œæœ‰äº›ä¸šåŠ¡çš„è®¡æ•°å˜æ›´ç‰¹åˆ«é¢‘ç¹ï¼Œæ¯”å¦‚å¾®åš feed çš„é˜…è¯»æ•°ï¼Œè®¡æ•°çš„å˜æ›´æ¬¡æ•°å’Œè®¿é—®æ¬¡æ•°ç›¸å½“ï¼Œæ¯ç§’åä¸‡åˆ°ç™¾ä¸‡çº§ä»¥ä¸Šçš„æ›´æ–°é‡ï¼Œå¦‚æœç”¨ DB å­˜å‚¨ï¼Œä¼šç»™ DB å¸¦æ¥å·¨å¤§çš„å‹åŠ›ï¼ŒDB å°±ä¼šæˆä¸ºæ•´ä¸ªè®¡æ•°æœåŠ¡çš„ç“¶é¢ˆæ‰€åœ¨ã€‚å³ä¾¿é‡‡ç”¨èšåˆå»¶è¿Ÿæ›´æ–° DB çš„æ–¹æ¡ˆï¼Œç”±äºæ€»é‡ç‰¹åˆ«å¤§ï¼ŒåŒæ—¶è¯·æ±‚å‡è¡¡åˆ†æ•£åœ¨å¤§é‡ä¸åŒçš„ä¸šåŠ¡ç«¯ï¼Œå·¨å¤§çš„å†™å‹åŠ›ä»ç„¶æ˜¯ DB çš„ä¸å¯æ‰¿å—ä¹‹é‡ã€‚</p><p><strong>å¤§å‹äº’è”ç½‘åœºæ™¯</strong>ï¼ˆç™¾ä¸‡çº§ï¼‰</p><p>ç›´æ¥æŠŠè®¡æ•°å…¨éƒ¨å­˜å‚¨åœ¨ Redis ä¸­ï¼Œé€šè¿‡ hash åˆ†æ‹†çš„æ–¹å¼ï¼Œå¯ä»¥å¤§å¹…æå‡è®¡æ•°æœåŠ¡åœ¨ Redis é›†ç¾¤çš„å†™æ€§èƒ½ï¼Œé€šè¿‡ä¸»ä»å¤åˆ¶ï¼Œåœ¨ master åæŒ‚è½½å¤šä¸ªä»åº“ï¼Œåˆ©ç”¨è¯»å†™åˆ†ç¦»ï¼Œå¯ä»¥å¤§å¹…æå‡è®¡æ•°æœåŠ¡åœ¨ Redis é›†ç¾¤çš„è¯»æ€§èƒ½ã€‚è€Œä¸” Redis æœ‰æŒä¹…åŒ–æœºåˆ¶ï¼Œä¸ä¼šä¸¢æ•°æ®</p><p>ä¸€æ–¹é¢ Redis ä½œä¸ºé€šç”¨å‹å­˜å‚¨æ¥å­˜å‚¨è®¡æ•°ï¼Œå†…å­˜å­˜å‚¨æ•ˆç‡ä½ã€‚ä»¥å­˜å‚¨ä¸€ä¸ª key ä¸º long å‹ idã€value ä¸º 4 å­—èŠ‚çš„è®¡æ•°ä¸ºä¾‹ï¼ŒRedis è‡³å°‘éœ€è¦ 65 ä¸ªå­—èŠ‚å·¦å³ï¼Œä¸åŒç‰ˆæœ¬ç•¥æœ‰å·®å¼‚ã€‚ä½†è¿™ä¸ªè®¡æ•°ç†è®ºåªéœ€è¦å ç”¨ 12 ä¸ªå­—èŠ‚å³å¯ã€‚å†…å­˜æœ‰æ•ˆè´Ÿè·åªæœ‰ 12&#x2F;65&#x3D;18.5%ã€‚å¦‚æœå†è€ƒè™‘ä¸€ä¸ª long å‹ id éœ€è¦å­˜ 4 ä¸ªä¸åŒç±»å‹çš„ 4 å­—èŠ‚è®¡æ•°ï¼Œå†…å­˜æœ‰æ•ˆè´Ÿè·åªæœ‰ (8+16)&#x2F;(65*4)&#x3D; 9.2%ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼ŒRedis æ‰€æœ‰æ•°æ®å‡å­˜åœ¨å†…å­˜ï¼Œå•å­˜å‚¨å†å²åƒäº¿çº§è®°å½•ï¼Œå•ä»½æ•°æ®æ‹·è´éœ€è¦ 10T ä»¥ä¸Šï¼Œè¦è€ƒè™‘æ ¸å¿ƒä¸šåŠ¡ä¸Š 1 ä¸» 3 ä»ï¼Œéœ€è¦ 40T ä»¥ä¸Šçš„å†…å­˜ï¼Œå†è€ƒè™‘å¤š IDC éƒ¨ç½²ï¼Œè½»æ¾å ç”¨ä¸Šç™¾ T å†…å­˜ã€‚å°±æŒ‰å•æœº 100G å†…å­˜æ¥ç®—ï¼Œè®¡æ•°æœåŠ¡å°±è¦å ç”¨ä¸Šåƒå°å¤§å†…å­˜æœåŠ¡å™¨ã€‚å­˜å‚¨æˆæœ¬å¤ªé«˜ã€‚</p><p><strong>å¾®åšã€å¾®ä¿¡ã€æŠ–éŸ³</strong>ï¼ˆäº¿çº§ï¼‰</p><p>å®šåˆ¶æ•°æ®ç»“æ„ï¼Œå…±äº«key ç´§å‡‘å­˜å‚¨ï¼Œæå‡è®¡æ•°æœ‰æ•ˆè´Ÿè·ç‡</p><p>è¶…è¿‡é˜ˆå€¼åæ•°æ®ä¿å­˜åˆ°SSDç¡¬ç›˜ï¼Œå†…å­˜é‡Œå­˜ç´¢å¼•</p><p>å†·keyä»SSDç¡¬ç›˜ä¸­è¯»å–åï¼Œæ”¾å…¥åˆ°LRUé˜Ÿåˆ—ä¸­</p><p>è‡ªå®šä¹‰ä¸»ä»å¤åˆ¶çš„æ–¹å¼ï¼Œæµ·é‡å†·æ•°æ®å¼‚æ­¥å¤šçº¿ç¨‹å¹¶å‘å¤åˆ¶</p><h2 id="7ã€ç³»ç»Ÿè®¾è®¡-å¾®è½¯"><a href="#7ã€ç³»ç»Ÿè®¾è®¡-å¾®è½¯" class="headerlink" title="7ã€ç³»ç»Ÿè®¾è®¡ - å¾®è½¯"></a>7ã€ç³»ç»Ÿè®¾è®¡ - å¾®è½¯</h2><h3 id="1ã€éœ€æ±‚æ”¶é›†"><a href="#1ã€éœ€æ±‚æ”¶é›†" class="headerlink" title="1ã€éœ€æ±‚æ”¶é›†"></a><strong>1ã€éœ€æ±‚æ”¶é›†</strong></h3><p>ç¡®è®¤<strong>ä½¿ç”¨çš„å¯¹è±¡</strong>ï¼ˆToCï¼šé«˜å¹¶å‘ï¼ŒToBï¼šé«˜å¯ç”¨ï¼‰</p><p><strong>ç³»ç»Ÿçš„æœåŠ¡åœºæ™¯</strong>ï¼ˆ<strong>å³æ—¶é€šä¿¡</strong>ï¼šä½å»¶è¿Ÿï¼Œ<strong>æ¸¸æˆ</strong>ï¼šé«˜æ€§èƒ½ï¼Œ<strong>è´­ç‰©</strong>ï¼šç§’æ€-ä¸€è‡´æ€§ï¼‰</p><p><strong>ç”¨æˆ·é‡çº§</strong>ï¼ˆ<strong>ä¸‡çº§</strong>ï¼šåŒæœºã€<strong>ç™¾ä¸‡</strong>ï¼šé›†ç¾¤ã€<strong>äº¿çº§</strong>ï¼šå¼¹æ€§åˆ†å¸ƒå¼ã€å®¹å™¨åŒ–ç¼–æ’æ¶æ„ï¼‰</p><p><strong>ç™¾ä¸‡è¯»</strong>ï¼š3ä¸»6ä»ï¼Œ<strong>æ¯ä¸ªèŠ‚ç‚¹çš„è¯»å†™é«˜å³° QPS</strong> å¯èƒ½å¯ä»¥è¾¾åˆ°æ¯ç§’ 5 ä¸‡ï¼Œå¯ä»¥å®ç°15ä¸‡ï¼Œ30ä¸‡è¯»æ€§èƒ½</p><p><strong>äº¿çº§è¯»</strong>ï¼Œé€šè¿‡CDNã€é™æ€ç¼“å­˜ã€JVMç¼“å­˜ç­‰å¤šçº§ç¼“å­˜æ¥æé«˜è¯»å¹¶å‘</p><p><strong>ç™¾ä¸‡å†™</strong>ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å‰Šå³°å¡«è°·ï¼Œé€šè¿‡hashåˆ†æ‹†ï¼Œæ°´å¹³æ‰©å±•åˆ†å¸ƒå¼ç¼“å­˜</p><p><strong>äº¿çº§å†™</strong>ï¼Œrediså¯ä»¥å®šåˆ¶æ•°æ®ç»“æ„ã€SSD+å†…å­˜LRUã€å†·æ•°æ®å¼‚æ­¥å¤šçº¿ç¨‹å¤åˆ¶</p><p>æŒä¹…åŒ–ï¼Œï¼ˆMysqlï¼‰æ‰¿å—é‡çº¦ä¸º 1Kçš„QPSï¼Œè¯»å†™åˆ†ç¦»æå‡<strong>è¯»å¹¶å‘</strong>ï¼Œåˆ†åº“åˆ†è¡¨æå‡<strong>å†™å¹¶å‘</strong></p><h3 id="2ã€é¡¶å±‚è®¾è®¡"><a href="#2ã€é¡¶å±‚è®¾è®¡" class="headerlink" title="2ã€é¡¶å±‚è®¾è®¡"></a><strong>2ã€é¡¶å±‚è®¾è®¡</strong></h3><p>æ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬ä»€ä¹ˆï¼š</p><p>å†™åŠŸèƒ½ï¼šå‘é€å¾®åš</p><p>è¯»åŠŸèƒ½ï¼šçƒ­ç‚¹èµ„è®¯</p><p>äº¤äº’ï¼šç‚¹èµã€å…³æ³¨</p><h3 id="3ã€ç³»ç»Ÿæ ¸å¿ƒæŒ‡æ ‡"><a href="#3ã€ç³»ç»Ÿæ ¸å¿ƒæŒ‡æ ‡" class="headerlink" title="3ã€ç³»ç»Ÿæ ¸å¿ƒæŒ‡æ ‡"></a><strong>3ã€ç³»ç»Ÿæ ¸å¿ƒæŒ‡æ ‡</strong></h3><ul><li>ç³»ç»Ÿ<strong>æ€§èƒ½</strong>å’Œ<strong>å»¶è¿Ÿ</strong><ul><li>è¾¹ç¼˜è®¡ç®— | åŠ¨é™åˆ†ç¦» | ç¼“å­˜ |  å¤šçº¿ç¨‹ |</li></ul></li><li><strong>å¯æ‰©å±•æ€§</strong>å’Œ<strong>ååé‡</strong><ul><li>è´Ÿè½½å‡è¡¡ | æ°´å¹³æ‰©å±• | å‚ç›´æ‰©å±• | å¼‚æ­¥ | æ‰¹å¤„ç† | è¯»å†™åˆ†ç¦»</li></ul></li><li><strong>å¯ç”¨æ€§</strong>å’Œ<strong>ä¸€è‡´æ€§</strong><ul><li>ä¸»ä»å¤åˆ¶ | å“¨å…µæ¨¡å¼ | é›†ç¾¤ | åˆ†å¸ƒå¼äº‹åŠ¡</li></ul></li></ul><h3 id="4ã€æ•°æ®å­˜å‚¨"><a href="#4ã€æ•°æ®å­˜å‚¨" class="headerlink" title="4ã€æ•°æ®å­˜å‚¨"></a>4ã€æ•°æ®å­˜å‚¨</h3><p>é”®å€¼å­˜å‚¨ : Redis ( çƒ­ç‚¹èµ„è®¯ )</p><p>æ–‡æ¡£å­˜å‚¨ : MongoDB ( å¾®åšæ–‡æ¡£åˆ†ç±»)</p><p>åˆ†è¯å€’æ’ï¼šElasticsearchï¼ˆæœç´¢ï¼‰</p><p>åˆ—å‹å­˜å‚¨ï¼šHbaseã€BigTableï¼ˆå¤§æ•°æ®ï¼‰</p><p>å›¾å½¢å­˜å‚¨ï¼šNeo4j ï¼ˆç¤¾äº¤åŠæ¨èï¼‰</p><p>å¤šåª’ä½“ï¼šFastDfsï¼ˆå›¾æ–‡è§†é¢‘å¾®åšï¼‰</p><h2 id="7ã€å¦‚ä½•è®¾è®¡ä¸€ä¸ªå¾®åš"><a href="#7ã€å¦‚ä½•è®¾è®¡ä¸€ä¸ªå¾®åš" class="headerlink" title="7ã€å¦‚ä½•è®¾è®¡ä¸€ä¸ªå¾®åš"></a>7ã€å¦‚ä½•è®¾è®¡ä¸€ä¸ªå¾®åš</h2><p><strong>å®ç°å“ªäº›åŠŸèƒ½ï¼š</strong></p><p>ç­›é€‰å‡ºæ ¸å¿ƒåŠŸèƒ½ï¼ˆPost a Tweetï¼ŒTimelineï¼ŒNews Feedï¼ŒFollow&#x2F;Unfollow a userï¼ŒRegister&#x2F;Loginï¼‰</p><p><strong>æ‰¿æ‹…å¤šå¤§QPSï¼š</strong></p><p>QPS &#x3D; 100ï¼Œé‚£ä¹ˆç”¨æˆ‘çš„ç¬”è®°æœ¬ä½œWebæœåŠ¡å™¨å°±å¥½äº†</p><p>QPS &#x3D; 1Kï¼Œä¸€å°å¥½ç‚¹çš„Web æœåŠ¡å™¨ä¹Ÿèƒ½åº”ä»˜ï¼Œéœ€è¦è€ƒè™‘å•ç‚¹æ•…éšœï¼›</p><p>QPS &#x3D; 1mï¼Œåˆ™éœ€è¦å»ºè®¾ä¸€ä¸ª1000å°WebæœåŠ¡å™¨çš„é›†ç¾¤ï¼Œè€ƒè™‘åŠ¨æ€æ‰©å®¹ã€è´Ÿè½½åˆ†æ‹…ã€æ•…éšœè½¬ç§»</p><p>ä¸€å° SQL Database ï¼ˆMysqlï¼‰æ‰¿å—é‡çº¦ä¸º 1Kçš„QPSï¼›</p><p>ä¸€å° NoSQL Database (Redis) çº¦æ‰¿å—é‡æ˜¯ 20k çš„ QPSï¼›</p><p>ä¸€å° NoSQL Database (Memcache) çº¦æ‰¿å—é‡æ˜¯ 200k çš„ QPSï¼›</p><p><strong>å¾®æœåŠ¡æˆ˜ç•¥æ‹†åˆ†</strong></p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1goruqql81gj30p20c5q45.jpg" alt="img" style="zoom:67%;" /><p><strong>é’ˆå¯¹ä¸åŒæœåŠ¡é€‰æ‹©ä¸åŒå­˜å‚¨</strong></p><p><img src="https://pic1.zhimg.com/80/v2-13cab4d5f56e3ecb682c351c0eb4a24b_1440w.jpg?source=1940ef5c" alt="img"></p><p><strong>è®¾è®¡æ•°æ®è¡¨çš„ç»“æ„</strong></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1goruu4homyj31400ht405.jpg" alt="img"></p><p>åŸºæœ¬å·®ä¸å¤šå°±å½¢æˆäº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯å¹¶ä¸æ˜¯å®Œç¾çš„ï¼Œä»ç„¶éœ€è¦å°æ­¥å¿«è·‘çš„ä¸æ–­çš„é’ˆå¯¹<strong>æ¶ˆæ¯é˜Ÿåˆ—ã€ç¼“å­˜ã€åˆ†å¸ƒå¼äº‹åŠ¡ã€åˆ†è¡¨åˆ†åº“ã€å¤§æ•°æ®ã€ç›‘æ§ã€å¯ä¼¸ç¼©</strong>æ–¹é¢è¿›è¡Œä¼˜åŒ–</p><h1 id="å…«ã€é¢†åŸŸæ¨¡å‹è½åœ°"><a href="#å…«ã€é¢†åŸŸæ¨¡å‹è½åœ°" class="headerlink" title="å…«ã€é¢†åŸŸæ¨¡å‹è½åœ°"></a>å…«ã€é¢†åŸŸæ¨¡å‹è½åœ°</h1><h3 id="1ã€æ‹†åˆ†å¾®æœåŠ¡"><a href="#1ã€æ‹†åˆ†å¾®æœåŠ¡" class="headerlink" title="1ã€æ‹†åˆ†å¾®æœåŠ¡"></a>1ã€æ‹†åˆ†å¾®æœåŠ¡</h3><blockquote><p>â€‹å¾®æœåŠ¡å†…é«˜å†…èšï¼Œå¾®æœåŠ¡é—´ä½è€¦åˆ</p></blockquote><p><strong>å¾®æœåŠ¡å†…é«˜å†…èš</strong>å³å•ä¸€èŒè´£åŸåˆ™</p><p>â€‹æ¯ä¸ªå¾®æœåŠ¡ä¸­çš„ä»£ç å˜åŒ–éƒ½æ˜¯åŒä¸€ç±»åŸå› ã€‚å› è¿™ç±»åŸå› è€Œéœ€è¦å˜æ›´çš„ä»£ç éƒ½åœ¨è¿™ä¸ªå¾®æœåŠ¡ä¸­ï¼Œä¸å…¶ä»–å¾®æœåŠ¡æ— å…³ï¼Œé‚£ä¹ˆå°±å¯ä»¥å°†ä»£ç ä¿®æ”¹çš„èŒƒå›´ç¼©å°åˆ°è¿™ä¸ªå¾®æœåŠ¡å†…ã€‚æŠŠè¿™ä¸ªå¾®æœåŠ¡ä¿®æ”¹å¥½äº†ï¼Œç‹¬ç«‹ä¿®æ”¹ã€ç‹¬ç«‹å‘å¸ƒï¼Œè¯¥éœ€æ±‚å°±å®ç°äº†ã€‚è¿™æ ·ï¼Œå¾®æœåŠ¡çš„ä¼˜åŠ¿æ‰èƒ½å‘æŒ¥å‡ºæ¥ã€‚</p><p><strong>å¾®æœåŠ¡é—´ä½è€¦åˆ</strong>å¼€æ”¾å°é—­åŸåˆ™</p><p>â€‹å°±æ˜¯è¯´åœ¨å¾®æœåŠ¡å®ç°è‡ªèº«ä¸šåŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœéœ€è¦æ‰§è¡Œçš„æŸäº›è¿‡ç¨‹ä¸æ˜¯è‡ªå·±çš„èŒè´£ï¼Œå°±åº”å½“å°†è¿™äº›è¿‡ç¨‹äº¤ç»™å…¶ä»–å¾®æœåŠ¡å»å®ç°ï¼Œä½ åªéœ€è¦å¯¹å®ƒçš„æ¥å£è¿›è¡Œè°ƒç”¨ã€‚è¿™æ ·ï¼Œå¾®æœåŠ¡ä¹‹é—´çš„è°ƒç”¨å°±å®ç°äº†è§£è€¦ã€‚</p><p>â€‹<strong>é¢†åŸŸå»ºæ¨¡</strong>å°±æ˜¯å°†ä¸€ä¸ªç³»ç»Ÿåˆ’åˆ†æˆäº†å¤šä¸ªå­åŸŸï¼Œæ¯ä¸ªå­åŸŸéƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ä¸šåŠ¡åœºæ™¯ï¼Œæ¯ä¸ªå­åŸŸçš„è¾¹ç•Œå°±æ˜¯â€œ<strong>é™ç•Œä¸Šä¸‹æ–‡</strong>â€ã€‚è¯¥ä¸šåŠ¡åœºæ™¯ä¼šæ¶‰åŠè®¸å¤šé¢†åŸŸå¯¹è±¡ï¼Œä½†<strong>åˆ†æå»ºæ¨¡</strong>å§‹ç»ˆéœ€è¦å›´ç»•ç€ä¸šåŠ¡åœºæ™¯çš„ä¸Šä¸‹æ–‡è¿›è¡Œã€‚</p><p>â€‹<strong>é¢†åŸŸäº‹ä»¶é€šçŸ¥æœºåˆ¶</strong>æœ€æœ‰æ•ˆçš„æ–¹å¼å°±æ˜¯é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ç°é¢†åŸŸäº‹ä»¶åœ¨å¾®æœåŠ¡é—´çš„é€šçŸ¥ã€‚</p><blockquote><p>â€œæ ¸å¿ƒé€šè®¯å½•â€å¾®æœåŠ¡åªè´Ÿè´£å‘é€å˜æ›´æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¸ç®¡è°ä¼šæ¥æ”¶å¹¶å¤„ç†è¿™äº›æ¶ˆæ¯ï¼›</p><p>â€œé—¨ç¦ç®¡ç†â€å¾®æœåŠ¡åªè´Ÿè´£æ¥æ”¶ç…§ç‰‡å˜æ›´æ¶ˆæ¯ï¼Œä¸ç®¡è°å‘é€çš„è¿™ä¸ªæ¶ˆæ¯ã€‚</p></blockquote><h3 id="2ã€å…³è”å¾®æœåŠ¡"><a href="#2ã€å…³è”å¾®æœåŠ¡" class="headerlink" title="2ã€å…³è”å¾®æœåŠ¡"></a>2ã€å…³è”å¾®æœåŠ¡</h3><ol><li><p>æŒ‰ç…§<strong>é™ç•Œä¸Šä¸‹æ–‡</strong>è¿›è¡Œå¾®æœåŠ¡çš„æ‹†åˆ†ï¼Œå°†é¢†åŸŸæ¨¡å‹<strong>åˆ’åˆ†åˆ°å¤šä¸ªé—®é¢˜å­åŸŸ</strong></p></li><li><p>åŸºäº<strong>å……è¡€æ¨¡å‹</strong>ä¸<strong>è´«è¡€æ¨¡å‹</strong>è®¾è®¡å„ä¸ªå¾®æœåŠ¡çš„ä¸šåŠ¡é¢†åŸŸå±‚ï¼ˆServiceã€Entityã€Valueï¼‰</p></li><li><p>é€šè¿‡<strong>é¢†åŸŸäº‹ä»¶é€šçŸ¥æœºåˆ¶</strong>å’Œ<strong>å¾®æœåŠ¡è°ƒç”¨</strong>çš„æ¨æ‹‰ç»“åˆï¼Œå°†å„ä¸ªå­åŸŸè¿›è¡Œè§£è€¦å…³è”</p><ul><li><strong>æ ¸å¿ƒ</strong>ï¼š</li></ul></li></ol><ul><li><p>é€šè®¯å½• | çŸ­ä¿¡ | æ¨é€é€šçŸ¥ | æ”¯ä»˜ | æ–‡ä»¶æœåŠ¡</p></li><li><p><strong>æ™ºæ…§é€šè¡Œ</strong></p><blockquote><p>è§£å†³ç‰©ä¸šå¤šå“ç‰Œã€å¤šç³»ç»Ÿåº”ç”¨é€ æˆçš„<strong>ä¿¡æ¯å­¤å²›</strong>ï¼Œ<strong>æ•°æ®æ··ä¹±</strong>çš„é—®é¢˜</p></blockquote><ul><li>äººè„¸é—¨ç¦ | å¯è§†å¯¹è®² | ç”µæ¢¯æ¢¯æ§ | åœè½¦ç³»ç»Ÿ | è®¿å®¢é¢„çº¦</li></ul></li><li><p><strong>å®‰å…¨ç¤¾åŒº</strong></p><blockquote><p>é€šè¿‡<strong>å›¾åƒè§†é¢‘è¯†åˆ«</strong>ã€<strong>ä¼ æ„Ÿæ•°æ®é‡‡é›†</strong>ï¼Œå®ç°<strong>æŠ¥è­¦è”åŠ¨</strong>å’Œ<strong>é£é™©é¢„è­¦</strong></p></blockquote><ul><li>è§†é¢‘ç›‘æ§ | å‘¨ç•ŒæŠ¥è­¦ | é«˜ç©ºæŠ›ç‰© | è·¨åŸŸè¿½è¸ª</li></ul></li><li><p><strong>å…¨å±‹æ™ºèƒ½</strong></p><blockquote><p>å›´ç»•ä¸šä¸»éœ€æ±‚ï¼Œé€æ­¥å¼•å…¥ç¤¾åŒºåŒ»ç–—ã€ç¤¾åŒºå…»è€ã€<strong>ç¤¾åŒºå›¢è´­</strong>ã€<strong>ç¤¾åŒºå®¶æ”¿</strong>ç­‰æœåŠ¡</p></blockquote><ul><li>è¶…çº§é¢æ¿ | æ— çº¿é—¨é” | çƒŸæ„Ÿé›¾æ„Ÿ</li></ul></li><li><p><strong>å¢å€¼æœåŠ¡</strong></p><blockquote><p>å®ç°è·¨å“ç‰Œçš„äº§å“ä½“éªŒï¼Œæ”¯æŒåŸºäº<strong>matrixå¼•æ“</strong>çš„æ™ºèƒ½ç”Ÿæ´»åœºæ™¯è£‚å˜èƒ½åŠ›</p></blockquote><ul><li>æ™ºèƒ½å……ç”µ | äº‘å¹¿æ’­ | å‡ºå…¥æé†’ | å®šå‘æŠ•æ”¾</li></ul></li></ul><h3 id="3ã€å¾®æœåŠ¡çš„è½åœ°"><a href="#3ã€å¾®æœåŠ¡çš„è½åœ°" class="headerlink" title="3ã€å¾®æœåŠ¡çš„è½åœ°"></a><strong>3ã€å¾®æœåŠ¡çš„è½åœ°</strong></h3><blockquote><p>â€‹é€šè¿‡åˆç†çš„å¾®æœåŠ¡è®¾è®¡ï¼Œå°½é‡è®©æ¯æ¬¡çš„éœ€æ±‚å˜æ›´éƒ½äº¤ç»™æŸä¸ªå°å›¢é˜Ÿç‹¬ç«‹å®Œæˆï¼Œè®©éœ€æ±‚å˜æ›´è½åˆ°æŸä¸ªå¾®æœåŠ¡ä¸Šè¿›è¡Œå˜æ›´ã€‚å”¯æœ‰è¿™æ ·ï¼Œæ¯æ¬¡å˜æ›´åªéœ€ç‹¬ç«‹åœ°ä¿®æ”¹è¿™ä¸ªå¾®æœåŠ¡ï¼Œç‹¬ç«‹æ‰“åŒ…ã€ç‹¬ç«‹å‡çº§ï¼Œæ–°éœ€æ±‚ç‹¬ç«‹å®ç°ï¼Œæ‰èƒ½å‘æŒ¥å¾®æœåŠ¡çš„ä¼˜åŠ¿ã€‚</p></blockquote><ul><li><p><strong>æ•°æ®éš”ç¦»ï¼š</strong>æ•°æ®åº“ä¸­ç”¨æˆ·ä¿¡æ¯è¡¨çš„è¯»å†™åªæœ‰<strong>é€šè®¯å½•</strong>å¾®æœåŠ¡ã€‚å½“å…¶ä»–å¾®æœåŠ¡éœ€è¦è¯»å†™ç”¨æˆ·ä¿¡æ¯æ—¶ï¼Œå°±ä¸èƒ½ç›´æ¥è¯»å–ç”¨æˆ·ä¿¡æ¯è¡¨ï¼Œè€Œæ˜¯é€šè¿‡ API æ¥å£å»è°ƒç”¨<strong>é€šè®¯å½•</strong>å¾®æœåŠ¡ã€‚</p></li><li><p><strong>æ¥å£å¤ç”¨ï¼š</strong>å› æ­¤ï¼Œå½“å¤šä¸ªå›¢é˜Ÿå‘ä½ æéœ€æ±‚æ—¶ï¼Œå¿…é¡»è¦å¯¹è¿™äº›æ¥å£è¿›è¡Œè§„åˆ’ï¼Œé€šè¿‡å¤ç”¨<strong>å°½å¯èƒ½å°‘çš„æ¥å£æ»¡è¶³ä»–ä»¬çš„éœ€æ±‚ï¼›</strong>å½“æœ‰æ–°çš„æ¥å£æå‡ºæ—¶ï¼Œè¦å°½é‡é€šè¿‡ç°æœ‰æ¥å£è§£å†³é—®é¢˜ã€‚</p></li><li><p><strong>å‘å‰å…¼å®¹ï¼š</strong>å½“è°ƒç”¨æ–¹éœ€è¦æ¥å£å˜æ›´æ—¶æ€ä¹ˆåŠï¼Ÿå˜æ›´ç°æœ‰æ¥å£åº”å½“å°½å¯èƒ½å‘å‰å…¼å®¹ï¼Œå³æ¥å£çš„åç§°ä¸å‚æ•°éƒ½ä¸å˜ï¼Œåªæ˜¯åœ¨å†…éƒ¨å¢åŠ æ–°çš„åŠŸèƒ½ã€‚<strong>å®æ„¿å¢åŠ ä¸€ä¸ªæ–°çš„æ¥å£ä¹Ÿæœ€å¥½ä¸è¦å»å˜æ›´åŸæœ‰çš„æ¥å£ã€‚</strong></p></li><li><p><strong>æœ¬åœ°è°ƒç”¨ï¼š</strong>åœ¨<strong>è®¿å®¢ç”³è¯·</strong>å¾®æœåŠ¡çš„æœ¬åœ°ï¼Œå¢åŠ ä¸€ä¸ª<strong>æŸ¥è¯¢ç”¨æˆ·Service</strong>çš„ feign æ¥å£ã€‚è¿™æ ·ï¼Œ<strong>è®¿å®¢ç”³è¯·Service</strong>å°±åƒæœ¬åœ°è°ƒç”¨ä¸€æ ·è°ƒç”¨<strong>æŸ¥è¯¢ç”¨æˆ·Service</strong>ï¼Œå†é€šè¿‡ feign æ¥å£å®ç°è¿œç¨‹è°ƒç”¨ã€‚è¿™ç§<strong>é˜²è…å±‚</strong>çš„è®¾è®¡ï¼Œå¯ä»¥éš”ç¦»å½“å‰å¾®æœåŠ¡ä»¥å¤–çš„å…¶ä»–å¾®æœåŠ¡æ‹†åˆ†å˜æ›´å¯¼è‡´çš„æ¥å£çš„å¤±æ•ˆçš„å½±å“ã€‚</p></li><li><p><strong>æ•°æ®åº“å»ä¸­å¿ƒåŒ–ï¼š</strong></p><ul><li>å¾®æœåŠ¡ä¸­<strong>é€šè®¯å½•æœåŠ¡</strong>ä¸<strong>å¥åº·ç æœåŠ¡</strong>åˆ†åˆ«å¯¹åº”çš„<strong>ç”¨æˆ·åº“ä¸æƒé™åº“</strong>ï¼Œå®ƒä»¬çš„å…±åŒç‰¹ç‚¹æ˜¯æ•°æ®é‡å°ä½†é¢‘ç¹è¯»å–ï¼Œå¯ä»¥é€‰ç”¨å°å‹çš„ MySQL æ•°æ®åº“å¹¶åœ¨å‰é¢æ¶è®¾ Redis æ¥æé«˜æŸ¥è¯¢æ€§èƒ½ï¼›</li><li>å¾®æœåŠ¡ä¸­<strong>è®¿å®¢é€šè¡Œ</strong>ä¸<strong>ç”Ÿæ´»ç¼´è´¹</strong>åˆ†åˆ«å¯¹åº”çš„<strong>é€šè¡Œè®°å½•åº“ã€è®¢å•åº“</strong>ï¼Œå…¶ç‰¹ç‚¹æ˜¯æ•°æ®é‡å¤§å¹¶ä¸”é«˜å¹¶å‘å†™ï¼Œé€‰ç”¨ä¸€ä¸ªæ•°æ®åº“æ˜¾ç„¶æ‰›ä¸ä½è¿™æ ·çš„å‹åŠ›ï¼Œå› æ­¤å¯ä»¥é€‰ç”¨äº† TiDB è¿™æ ·çš„ NewSQL æ•°æ®åº“è¿›è¡Œåˆ†å¸ƒå¼å­˜å‚¨ï¼Œå°†æ•°æ®å‹åŠ›åˆ†æ•£åˆ°å¤šä¸ªæ•°æ®èŠ‚ç‚¹ä¸­ï¼Œä»è€Œè§£å†³ I&#x2F;O ç“¶é¢ˆï¼›</li><li>å¾®æœåŠ¡ä¸­<strong>æ•°æ®åˆ†æ</strong>ä¸<strong>é€šè®¯å½•æŸ¥è¯¢</strong>è¿™æ ·çš„æŸ¥è¯¢åˆ†æä¸šåŠ¡ï¼Œåˆ™é€‰ç”¨ <strong>NoSQL æ•°æ®åº“</strong>æˆ–<strong>å¤§æ•°æ®å¹³å°</strong>ï¼Œé€šè¿‡è¯»å†™åˆ†ç¦»å°†ç”Ÿäº§åº“ä¸Šçš„æ•°æ®åŒæ­¥è¿‡æ¥è¿›è¡Œåˆ†å¸ƒå¼å­˜å‚¨ï¼Œç„¶åå®½è¡¨ä¸€ç³»åˆ—çš„é¢„å¤„ç†ï¼Œåº”å¯¹æµ·é‡å†å²æ•°æ®çš„å†³ç­–åˆ†æä¸ç§’çº§æŸ¥è¯¢ã€‚ï¼ˆ NoSQL ä¸ºç©ºçš„å­—æ®µæ˜¯ä¸å ç”¨ç©ºé—´çš„ï¼Œå› æ­¤å­—æ®µå†å¤šéƒ½ä¸å½±å“æŸ¥è¯¢æ€§èƒ½ï¼‰</li></ul></li></ul><h3 id="4ã€é¢†åŸŸæ¨¡å‹çš„æ„ä¹‰"><a href="#4ã€é¢†åŸŸæ¨¡å‹çš„æ„ä¹‰" class="headerlink" title="4ã€é¢†åŸŸæ¨¡å‹çš„æ„ä¹‰"></a>4ã€é¢†åŸŸæ¨¡å‹çš„æ„ä¹‰</h3><p>â€‹<strong>è´«è¡€æ¨¡å‹ã€å……è¡€æ¨¡å‹ã€ç­–ç•¥æ¨¡å¼ã€è£…é¥°è€…æ¨¡å¼</strong>åªæ˜¯DDDå®ç°çš„æ–¹å¼ï¼Œè€ŒDDDçš„çœŸè°›æ˜¯<strong>é¢†åŸŸå»ºæ¨¡</strong>ã€‚</p><p>â€‹åšäº‹ä¸èƒ½ä»…å‡­ä¸€è…”çƒ­è¡€ï¼Œä¸€å®šè¦ç¬¦åˆè‡ªç„¶è§„å¾‹ã€‚å…¶å®è½¯ä»¶çš„è®¾è®¡å¼€å‘è¿‡ç¨‹ä¹Ÿæ˜¯è¿™æ ·ã€‚å¯¹ä¸šåŠ¡ç†è§£ä¸æ·±åˆ»å…¨å±€æ¶æ„è®¾è®¡å¾€å¾€æ˜¯è¿‡åº¦è®¾è®¡ï¼Œè¿™æ—¶å€™<strong>åº”è¯¥æŠ“ä¸»è¦æµç¨‹</strong>ï¼Œå¼€å§‹é¢†åŸŸå»ºæ¨¡ã€‚</p><ul><li>æ¥ç€ï¼Œæ¯æ¬¡æ·»åŠ æ–°åŠŸèƒ½çš„æ—¶å€™ï¼Œä¸€æ–¹é¢è¦æ»¡è¶³å½“å‰çš„éœ€æ±‚ï¼Œå¦ä¸€æ–¹é¢ä¸šåŠ¡ç›¸å…³çš„<strong>é¢†åŸŸå»ºæ¨¡è®¾è®¡</strong>åˆšåˆšæ»¡è¶³éœ€æ±‚ï¼Œä»è€Œä½¿è®¾è®¡æœ€ç®€åŒ–ã€ä»£ç æœ€å°‘ã€‚</li><li>è¿™æ ·çš„è®¾è®¡è¿‡ç¨‹å«<strong>å°æ­¥å¿«è·‘</strong>ã€‚é‡‡ç”¨å°æ­¥å¿«è·‘çš„è®¾è®¡æ–¹æ³•ï¼Œä¸€å¼€å§‹ä¸ç”¨æ€è€ƒé‚£ä¹ˆå¤šé—®é¢˜ï¼Œä»ç®€å•é—®é¢˜å¼€å§‹é€æ­¥æ·±å…¥ã€‚<strong>é¢†åŸŸæ¨¡å‹</strong>å°±åƒå°æ ‘ä¸€æ ·ä¸€ç‚¹å„¿ä¸€ç‚¹å„¿æˆé•¿ï¼Œæœ€åå®Œæˆæ‰€æœ‰çš„åŠŸèƒ½ã€‚</li></ul><blockquote><p>ä¿æŒè½¯ä»¶è®¾è®¡ä¸é€€åŒ–çš„å…³é”®åœ¨äºæ¯æ¬¡éœ€æ±‚å˜æ›´çš„è®¾è®¡ï¼Œåªæœ‰ä¿è¯æ¯æ¬¡éœ€æ±‚å˜æ›´æ—¶åšå‡ºæ­£ç¡®çš„è®¾è®¡ï¼Œæ‰èƒ½ä¿è¯è½¯ä»¶ä»¥ä¸€ç§è‰¯æ€§å¾ªç¯çš„æ–¹å¼ä¸æ–­ç»´æŠ¤ä¸‹å»ã€‚</p></blockquote><p>â€‹æœ‰æ²¡æœ‰ä¸€ç§æ–¹æ³•ï¼Œè®©æˆ‘ä»¬åœ¨ç¬¬åæ¬¡å˜æ›´ã€ç¬¬äºŒåæ¬¡å˜æ›´ã€ç¬¬ä¸‰åæ¬¡å˜æ›´æ—¶ï¼Œä¾ç„¶èƒ½å¤Ÿæ‰¾åˆ°æ­£ç¡®çš„è®¾è®¡å‘¢ï¼Ÿæœ‰ï¼Œé‚£å°±æ˜¯<strong>é¢†åŸŸé©±åŠ¨è®¾è®¡</strong></p><p>â€‹é‚£ä¹ˆåœ¨æ¯æ¬¡éœ€æ±‚å˜æ›´æ—¶ï¼Œå°†å˜æ›´è¿˜åŸåˆ°çœŸå®ä¸–ç•Œä¸­ï¼Œçœ‹çœ‹çœŸå®ä¸–ç•Œæ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Œæ ¹æ®çœŸå®ä¸–ç•Œè¿›è¡Œå˜æ›´ã€‚</p><h3 id="5ã€æˆ˜ç•¥å»ºæ¨¡"><a href="#5ã€æˆ˜ç•¥å»ºæ¨¡" class="headerlink" title="5ã€æˆ˜ç•¥å»ºæ¨¡"></a>5ã€æˆ˜ç•¥å»ºæ¨¡</h3><p>â€‹<img src="https://tva1.sinaimg.cn/large/008i3skNly1gq6jet6kizj310c0ngtp4.jpg" alt="image-20210504174616848" style="zoom:50%;" /></p><h3 id="6ã€ç›¸å…³åè¯"><a href="#6ã€ç›¸å…³åè¯" class="headerlink" title="6ã€ç›¸å…³åè¯"></a><strong>6ã€ç›¸å…³åè¯</strong></h3><p><strong>é¢†åŸŸå’Œå­åŸŸï¼ˆDomain&#x2F;Subdomainï¼‰</strong></p><p>â€‹åœ¨<strong>ä¸Šä¸‹æ–‡åœ°å›¾</strong>æ„å»ºçš„é¢†åŸŸä¸­ï¼Œå¯¹åº”æ¨¡å—ï¼Œä½¿ç”¨<strong>é™ç•Œä¸Šä¸‹æ–‡</strong>åˆ’åˆ†é¢†åŸŸï¼Œå¯¹åº”å¾®æœåŠ¡</p><p><strong>é™ç•Œä¸Šä¸‹æ–‡ï¼ˆBounded Contextï¼‰</strong></p><p>â€‹åœ¨ä¸€ä¸ªé¢†åŸŸ&#x2F;å­åŸŸä¸­ï¼Œæœ‰æ¦‚å¿µä¸Šçš„é¢†åŸŸè¾¹ç•Œï¼Œä»»ä½•<strong>é¢†åŸŸå¯¹è±¡</strong>åœ¨è¯¥è¾¹ç•Œå†…éƒ¨çš„æœ‰ä¸ä¾èµ–å¤–éƒ¨çš„ç¡®åˆ‡å«ä¹‰ã€‚</p><p><strong>é¢†åŸŸå¯¹è±¡</strong></p><p>â€‹æœåŠ¡ã€å®ä½“ä¸å€¼å¯¹è±¡æ˜¯é¢†åŸŸé©±åŠ¨è®¾è®¡çš„é¢†åŸŸå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡<strong>è´«è¡€æ¨¡å‹</strong>å’Œ<strong>å……è¡€æ¨¡å‹</strong>è½¬æ¢ä¸ºç¨‹åºè®¾è®¡</p><p><strong>å®ä½“å’Œå€¼å¯¹è±¡</strong></p><p>â€‹é€šè¿‡ä¸€ä¸ª<strong>å”¯ä¸€æ ‡è¯†å­—æ®µæ¥åŒºåˆ†</strong>çœŸå®ä¸–ç•Œä¸­çš„æ¯ä¸€ä¸ªä¸ªä½“çš„é¢†åŸŸå¯¹è±¡ï¼Œç§°ä¸ºå®ä½“ã€‚çœŸå®ä¸–ç•Œä¸­é‚£äº›<strong>ä¸€æˆä¸å˜çš„</strong>ã€æœ¬è´¨æ€§çš„äº‹ç‰©çš„é¢†åŸŸå¯¹è±¡ï¼Œç§°ä¸ºå€¼å¯¹è±¡ã€‚<strong>å¯å˜æ€§</strong>æ˜¯å®ä½“çš„ç‰¹ç‚¹ï¼Œè€Œ<strong>ä¸å˜æ€§</strong>åˆ™æ˜¯å€¼å¯¹è±¡çš„æœ¬è´¨ã€‚</p><p><strong>è´«è¡€æ¨¡å‹ä¸å……è¡€æ¨¡å‹</strong></p><p>â€‹POJOå¯¹è±¡ä¸­åªä¿å­˜get&#x2F;setæ–¹æ³•ï¼Œæ²¡æœ‰ä»»ä½•ä¸šåŠ¡é€»è¾‘ï¼Œè¿™æ ·çš„è®¾è®¡è¢«ç§°ä¸º<strong>è´«è¡€æ¨¡å‹</strong></p><p>â€‹<strong>å……è¡€æ¨¡å‹</strong>æ˜¯å°è£…å’Œç»§æ‰¿æ€æƒ³çš„ä½“ç°ï¼Œé—¨ç¦è®¾å¤‡å®ä½“ä¸­ï¼ŒåŒ…å«ç‰¹å¾å€¼ä¸‹å‘ã€å¹¿å‘Šä¸‹å‘ã€é€šè¡Œè®°å½•å›è°ƒç­‰æ–¹æ³•ï¼Œä¸åŒå‚å•†çš„å®ä½“é’ˆå¯¹å¤šæ€è¿›è¡Œ<strong>èšåˆ</strong>ï¼Œå¹¶é€šè¿‡<strong>å·¥å‚æˆ–ä»“åº“</strong>å¯¹å¤–æä¾›æœåŠ¡ã€‚åœ¨å……è¡€æ¨¡å‹ä¸­ï¼Œ Service åªå¹²ä¸€ä»¶éå¸¸ç®€å•çš„äº‹ï¼Œå°±æ˜¯ç›´æ¥å»è°ƒç”¨å¯¹è±¡ä¸­çš„<strong>å·¥å‚æ–¹æ³•</strong>ç”Ÿæˆä¸åŒäº§å“ï¼Œå…¶ä»–çš„ä»€ä¹ˆéƒ½ä¸å¹²ã€‚</p><p><strong>èšåˆ</strong></p><p>â€‹èšåˆä½“ç°çš„æ˜¯ä¸€ç§<strong>æ•´ä½“ä¸éƒ¨åˆ†</strong>çš„å…³ç³»ã€‚æ­£æ˜¯å› ä¸ºæœ‰è¿™æ ·çš„å…³ç³»ï¼Œåœ¨æ“ä½œæ•´ä½“çš„æ—¶å€™ï¼Œæ•´ä½“å°±å°è£…äº†å¯¹éƒ¨åˆ†çš„æ“ä½œã€‚å¦‚ä½•æ­£ç¡®ç†è§£æ˜¯å¦å­˜åœ¨èšåˆçš„å…³ç³»ï¼šå°±æ˜¯å½“<strong>æ•´ä½“ä¸å­˜åœ¨</strong>æ—¶ï¼Œéƒ¨åˆ†å°±å˜å¾—<strong>æ²¡æœ‰äº†æ„ä¹‰</strong>ã€‚éƒ¨åˆ†æ˜¯æ•´ä½“çš„ä¸€ä¸ªéƒ¨åˆ†ï¼Œä¸<strong>æ•´ä½“æœ‰ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸ</strong>ã€‚</p><p><strong>å·¥å‚</strong></p><p><strong>é€šè¿‡è£…é…ï¼Œåˆ›å»ºé¢†åŸŸå¯¹è±¡ï¼Œæ˜¯é¢†åŸŸå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„èµ·ç‚¹ã€‚</strong>è­¬å¦‚ï¼Œç³»ç»Ÿè¦é€šè¿‡ ID è£…è½½ä¸€ä¸ªè®¿å®¢ç”³è¯·ï¼š</p><ol><li><p>è¡¨å•å·¥å‚åˆ†åˆ«è°ƒç”¨è¡¨å•ä¿¡æ¯DAOã€è¡¨å•æ˜ç»† DAO å’Œç”¨æˆ·DAO å»è¿›è¡ŒæŸ¥è¯¢ï¼›</p></li><li><p>å°†å¾—åˆ°çš„è¡¨å•æ˜ç»†å¯¹è±¡ã€ç”¨æˆ·å¯¹è±¡è¿›è¡Œè£…é…ï¼Œåˆ†åˆ« set åˆ°<strong>è¡¨å•ä¿¡æ¯å¯¹è±¡</strong>çš„<strong>è¡¨å•æ˜ç»†</strong>ä¸<strong>ç”¨æˆ·å±æ€§</strong>ä¸­ï¼›</p></li><li><p>æœ€åï¼Œè¡¨å•å·¥å‚å°†è£…é…å¥½çš„è¡¨å•å¯¹è±¡è¿”å›ç»™è¡¨å•ä»“åº“ã€‚</p></li></ol><p><strong>ä»“åº“</strong></p><p>â€‹å¦‚æœæœåŠ¡å™¨æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„æœåŠ¡å™¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸éœ€è¦ä»»ä½•æ•°æ®åº“ã€‚ç³»ç»Ÿåˆ›å»ºçš„æ‰€æœ‰é¢†åŸŸå¯¹è±¡éƒ½æ”¾åœ¨ä»“åº“ä¸­ï¼Œå½“éœ€è¦è¿™äº›å¯¹è±¡æ—¶ï¼Œé€šè¿‡ ID åˆ°ä»“åº“ä¸­å»è·å–ã€‚</p><ul><li><p>å½“å®¢æˆ·ç¨‹åºé€šè¿‡ ID å»è·å–æŸä¸ªé¢†åŸŸå¯¹è±¡æ—¶ï¼Œä»“åº“ä¼šé€šè¿‡è¿™ä¸ª ID å…ˆåˆ°<strong>ç¼“å­˜ä¸­è¿›è¡ŒæŸ¥æ‰¾</strong>ï¼š</p></li><li><p>æŸ¥æ‰¾åˆ°äº†ï¼Œåˆ™<strong>ç›´æ¥è¿”å›</strong>ï¼Œä¸éœ€è¦æŸ¥è¯¢æ•°æ®åº“ï¼›</p></li><li><p>æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™é€šçŸ¥å·¥å‚ï¼Œå·¥å‚è°ƒç”¨ DAO å»æ•°æ®åº“ä¸­æŸ¥è¯¢ï¼Œç„¶å<strong>è£…é…æˆé¢†åŸŸå¯¹è±¡è¿”å›ç»™ä»“åº“</strong>ã€‚</p></li><li><p>ä»“åº“åœ¨æ”¶åˆ°è¿™ä¸ªé¢†åŸŸå¯¹è±¡ä»¥åï¼Œåœ¨è¿”å›ç»™å®¢æˆ·ç¨‹åºçš„åŒæ—¶ï¼Œå°†è¯¥<strong>å¯¹è±¡æ”¾åˆ°ç¼“å­˜ä¸­</strong></p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> é¢ç» </tag>
            
            <tag> é¢è¯•é¢˜ </tag>
            
            <tag> ç³»ç»Ÿè®¾è®¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é‚£äº›å¹´æˆ‘ä»¬èƒŒè¿‡çš„JAVAé¢è¯•é¢˜</title>
      <link href="/posts/d64d980f.html"/>
      <url>/posts/d64d980f.html</url>
      
        <content type="html"><![CDATA[<hr><span id="more"></span><h1 id="ä¸€ã€åŸºç¡€ç¯‡"><a href="#ä¸€ã€åŸºç¡€ç¯‡" class="headerlink" title="ä¸€ã€åŸºç¡€ç¯‡"></a>ä¸€ã€åŸºç¡€ç¯‡</h1><h2 id="ç½‘ç»œåŸºç¡€"><a href="#ç½‘ç»œåŸºç¡€" class="headerlink" title="ç½‘ç»œåŸºç¡€"></a>ç½‘ç»œåŸºç¡€</h2><h3 id="TCPä¸‰æ¬¡æ¡æ‰‹"><a href="#TCPä¸‰æ¬¡æ¡æ‰‹" class="headerlink" title="TCPä¸‰æ¬¡æ¡æ‰‹"></a><strong>TCPä¸‰æ¬¡æ¡æ‰‹</strong></h3><p>â€‹<strong>ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹ï¼š</strong></p><p>â€‹å®¢æˆ·ç«¯â€”â€”å‘é€å¸¦æœ‰SYNæ ‡å¿—çš„æ•°æ®åŒ…â€”â€”æœåŠ¡ç«¯       <strong>ä¸€æ¬¡æ¡æ‰‹</strong>  Clientè¿›å…¥syn_sentçŠ¶æ€</p><p>â€‹æœåŠ¡ç«¯â€”â€”å‘é€å¸¦æœ‰SYN&#x2F;ACKæ ‡å¿—çš„æ•°æ®åŒ…â€”â€”å®¢æˆ·ç«¯   <strong>äºŒæ¬¡æ¡æ‰‹</strong>  æœåŠ¡ç«¯è¿›å…¥syn_rcvd</p><p>â€‹å®¢æˆ·ç«¯â€”â€”å‘é€å¸¦æœ‰ACKæ ‡å¿—çš„æ•°æ®åŒ…â€”â€”æœåŠ¡ç«¯               <strong>ä¸‰æ¬¡æ¡æ‰‹</strong>   è¿æ¥å°±è¿›å…¥EstablishedçŠ¶æ€</p><p>â€‹<strong>ä¸ºä»€ä¹ˆä¸‰æ¬¡ï¼š</strong></p><p>â€‹ä¸»è¦æ˜¯ä¸ºäº†å»ºç«‹å¯é çš„é€šä¿¡ä¿¡é“ï¼Œä¿è¯å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯åŒæ—¶å…·å¤‡å‘é€ã€æ¥æ”¶æ•°æ®çš„èƒ½åŠ›</p><p>â€‹<strong>ä¸ºä»€ä¹ˆä¸¤æ¬¡ä¸è¡Œï¼Ÿ</strong></p><p>â€‹1ã€é˜²æ­¢å·²å¤±æ•ˆçš„è¯·æ±‚æŠ¥æ–‡åˆä¼ é€åˆ°äº†æœåŠ¡ç«¯ï¼Œå»ºç«‹äº†å¤šä½™çš„é“¾æ¥ï¼Œæµªè´¹èµ„æº</p><p>â€‹2ã€ ä¸¤æ¬¡æ¡æ‰‹åªèƒ½ä¿è¯å•å‘è¿æ¥æ˜¯ç•…é€šçš„ã€‚ï¼ˆä¸ºäº†å®ç°å¯é æ•°æ®ä¼ è¾“ï¼Œ TCP åè®®çš„é€šä¿¡åŒæ–¹ï¼Œ éƒ½å¿…é¡»ç»´æŠ¤ä¸€ä¸ªåºåˆ—å·ï¼Œ ä»¥æ ‡è¯†å‘é€å‡ºå»çš„æ•°æ®åŒ…ä¸­ï¼Œ å“ªäº›æ˜¯å·²ç»è¢«å¯¹æ–¹æ”¶åˆ°çš„ã€‚ ä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹å³æ˜¯é€šä¿¡åŒæ–¹ç›¸äº’å‘ŠçŸ¥åºåˆ—å·èµ·å§‹å€¼ï¼Œ å¹¶ç¡®è®¤å¯¹æ–¹å·²ç»æ”¶åˆ°äº†åºåˆ—å·èµ·å§‹å€¼çš„å¿…ç»æ­¥éª¤ï¼›å¦‚æœåªæ˜¯ä¸¤æ¬¡æ¡æ‰‹ï¼Œ è‡³å¤šåªæœ‰è¿æ¥å‘èµ·æ–¹çš„èµ·å§‹åºåˆ—å·èƒ½è¢«ç¡®è®¤ï¼Œ å¦ä¸€æ–¹é€‰æ‹©çš„åºåˆ—å·åˆ™å¾—ä¸åˆ°ç¡®è®¤ï¼‰</p><p><strong>TCPå››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹</strong> </p><p><strong>å››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹ï¼š</strong></p><p>â€‹å®¢æˆ·ç«¯â€”â€”å‘é€å¸¦æœ‰FINæ ‡å¿—çš„æ•°æ®åŒ…â€”â€”æœåŠ¡ç«¯ï¼Œå…³é—­ä¸æœåŠ¡ç«¯çš„è¿æ¥ ï¼Œå®¢æˆ·ç«¯è¿›å…¥FIN-WAIT-1çŠ¶æ€</p><p>â€‹æœåŠ¡ç«¯æ”¶åˆ°è¿™ä¸ª FINï¼Œå®ƒå‘å›â¼€ ä¸ª ACKï¼Œç¡®è®¤åºå·ä¸ºæ”¶åˆ°çš„åºå·åŠ 1ï¼ŒæœåŠ¡ç«¯å°±è¿›å…¥äº†CLOSE-WAITçŠ¶æ€</p><p>â€‹æœåŠ¡ç«¯â€”â€”å‘é€â¼€ä¸ªFINæ•°æ®åŒ…â€”â€”å®¢æˆ·ç«¯ï¼Œå…³é—­ä¸å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œå®¢æˆ·ç«¯å°±è¿›å…¥FIN-WAIT-2çŠ¶æ€</p><p>â€‹å®¢æˆ·ç«¯æ”¶åˆ°è¿™ä¸ª FINï¼Œå‘å› ACK æŠ¥â½‚ç¡®è®¤ï¼Œå¹¶å°†ç¡®è®¤åºå·è®¾ç½®ä¸ºæ”¶åˆ°åºå·åŠ 1ï¼ŒTIME-WAITçŠ¶æ€</p><p><strong>ä¸ºä»€ä¹ˆå››æ¬¡ï¼š</strong></p><p>â€‹å› ä¸ºéœ€è¦ç¡®ä¿å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„æ•°æ®èƒ½å¤Ÿå®Œæˆä¼ è¾“ã€‚</p><p><strong>CLOSE-WAITï¼š</strong></p><p>â€‹è¿™ç§çŠ¶æ€çš„å«ä¹‰å…¶å®æ˜¯è¡¨ç¤ºåœ¨ç­‰å¾…å…³é—­</p><p><strong>TIME-WAITï¼š</strong></p><p>â€‹ä¸ºäº†è§£å†³ç½‘ç»œçš„ä¸¢åŒ…å’Œç½‘ç»œä¸ç¨³å®šæ‰€å¸¦æ¥çš„å…¶ä»–é—®é¢˜ï¼Œç¡®ä¿è¿æ¥æ–¹èƒ½åœ¨æ—¶é—´èŒƒå›´å†…ï¼Œå…³é—­è‡ªå·±çš„è¿æ¥</p><p><strong>å¦‚ä½•æŸ¥çœ‹TIME-WAITçŠ¶æ€çš„é“¾æ¥æ•°é‡ï¼Ÿ</strong></p><p>â€‹netstat -an |grep TIME_WAIT|wc -l  æŸ¥çœ‹è¿æ¥æ•°ç­‰å¾…time_waitçŠ¶æ€è¿æ¥æ•°</p><p><strong>ä¸ºä»€ä¹ˆä¼šTIME-WAITè¿‡å¤šï¼Ÿè§£å†³æ–¹æ³•æ˜¯æ€æ ·çš„ï¼Ÿ</strong></p><p>â€‹<strong>å¯èƒ½åŸå› ï¼š</strong> é«˜å¹¶å‘çŸ­è¿æ¥çš„TCPæœåŠ¡å™¨ä¸Šï¼Œå½“æœåŠ¡å™¨å¤„ç†å®Œè¯·æ±‚åç«‹åˆ»æŒ‰ç…§ä¸»åŠ¨æ­£å¸¸å…³é—­è¿æ¥</p><p>â€‹<strong>è§£å†³ï¼š</strong>è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼›WebæœåŠ¡å™¨é¦–å…ˆå…³é—­æ¥è‡ªè´Ÿè½½å‡è¡¡æœåŠ¡å™¨çš„è¿æ¥</p><h4 id="1ã€OSIä¸TCP-IP-æ¨¡å‹"><a href="#1ã€OSIä¸TCP-IP-æ¨¡å‹" class="headerlink" title="1ã€OSIä¸TCP&#x2F;IP æ¨¡å‹"></a><strong>1ã€OSIä¸TCP&#x2F;IP æ¨¡å‹</strong></h4><p>â€‹OSIä¸ƒå±‚ï¼šç‰©ç†å±‚ã€æ•°æ®é“¾è·¯å±‚ã€ç½‘ç»œå±‚ã€ä¼ è¾“å±‚ã€ä¼šè¯å±‚ã€è¡¨ç¤ºå±‚ã€åº”ç”¨å±‚</p><p>â€‹TCP&#x2F;IPäº”å±‚ï¼šç‰©ç†å±‚ã€æ•°æ®é“¾è·¯å±‚ã€ç½‘ç»œå±‚ã€ä¼ è¾“å±‚ã€åº”ç”¨å±‚</p><h4 id="2ã€å¸¸è§ç½‘ç»œæœåŠ¡åˆ†å±‚"><a href="#2ã€å¸¸è§ç½‘ç»œæœåŠ¡åˆ†å±‚" class="headerlink" title="2ã€å¸¸è§ç½‘ç»œæœåŠ¡åˆ†å±‚"></a><strong>2ã€å¸¸è§ç½‘ç»œæœåŠ¡åˆ†å±‚</strong></h4><p>â€‹åº”ç”¨å±‚ï¼šHTTPã€SMTPã€DNSã€FTP</p><p>â€‹ä¼ è¾“å±‚ï¼šTCP ã€UDP</p><p>â€‹ç½‘ç»œå±‚ï¼šICMP ã€IPã€è·¯ç”±å™¨ã€é˜²ç«å¢™</p><p>â€‹æ•°æ®é“¾è·¯å±‚ï¼šç½‘å¡ã€ç½‘æ¡¥ã€äº¤æ¢æœº</p><p>â€‹ç‰©ç†å±‚ï¼šä¸­ç»§å™¨ã€é›†çº¿å™¨</p><h4 id="3ã€TCPä¸UDPåŒºåˆ«åŠåœºæ™¯"><a href="#3ã€TCPä¸UDPåŒºåˆ«åŠåœºæ™¯" class="headerlink" title="3ã€TCPä¸UDPåŒºåˆ«åŠåœºæ™¯"></a><strong>3ã€TCPä¸UDPåŒºåˆ«åŠåœºæ™¯</strong></h4><table><thead><tr><th>ç±»å‹</th><th align="center">ç‰¹ç‚¹</th><th align="center">æ€§èƒ½</th><th align="center">åº”ç”¨è¿‡åœºæ™¯</th><th align="center">é¦–éƒ¨å­—èŠ‚</th><th></th></tr></thead><tbody><tr><td>TCP</td><td align="center">é¢å‘è¿æ¥ã€å¯é ã€å­—èŠ‚æµ</td><td align="center">ä¼ è¾“æ•ˆç‡æ…¢ã€æ‰€éœ€èµ„æºå¤š</td><td align="center">æ–‡ä»¶ã€é‚®ä»¶ä¼ è¾“</td><td align="center">20-60</td><td></td></tr><tr><td>UDP</td><td align="center">æ— è¿æ¥ã€ä¸å¯é ã€æ•°æ®æŠ¥æ–‡æ®µ</td><td align="center">ä¼ è¾“æ•ˆç‡å¿«ã€æ‰€éœ€èµ„æºå°‘</td><td align="center">è¯­éŸ³ã€è§†é¢‘ã€ç›´æ’­</td><td align="center">8ä¸ªå­—èŠ‚</td><td></td></tr></tbody></table><p>â€‹<strong>åŸºäºTCPçš„åè®®ï¼š</strong>HTTPã€FTPã€SMTP</p><p>â€‹<strong>åŸºäºUDPçš„åè®®ï¼š</strong>RIPã€DNSã€SNMP</p><h4 id="4ã€TCPæ»‘åŠ¨çª—å£ï¼Œæ‹¥å¡æ§åˆ¶"><a href="#4ã€TCPæ»‘åŠ¨çª—å£ï¼Œæ‹¥å¡æ§åˆ¶" class="headerlink" title="4ã€TCPæ»‘åŠ¨çª—å£ï¼Œæ‹¥å¡æ§åˆ¶"></a><strong>4ã€TCPæ»‘åŠ¨çª—å£ï¼Œæ‹¥å¡æ§åˆ¶</strong></h4><p>â€‹<strong>TCPé€šè¿‡ï¼š</strong>åº”ç”¨æ•°æ®åˆ†å‰²ã€å¯¹æ•°æ®åŒ…è¿›è¡Œç¼–å·ã€æ ¡éªŒå’Œã€æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶ã€è¶…æ—¶é‡ä¼ ç­‰æªæ–½ä¿è¯æ•°æ®çš„å¯é ä¼ è¾“ï¼›</p><p>â€‹<strong>æ‹¥å¡æ§åˆ¶ç›®çš„ï¼š</strong>ä¸ºäº†é˜²æ­¢è¿‡å¤šçš„æ•°æ®æ³¨å…¥åˆ°ç½‘ç»œä¸­ï¼Œé¿å…ç½‘ç»œä¸­çš„è·¯ç”±å™¨ã€é“¾è·¯è¿‡è½½</p><p>â€‹<strong>æ‹¥å¡æ§åˆ¶è¿‡ç¨‹ï¼š</strong>TCPç»´æŠ¤ä¸€ä¸ªæ‹¥å¡çª—å£ï¼Œè¯¥çª—å£éšç€ç½‘ç»œæ‹¥å¡ç¨‹åº¦åŠ¨æ€å˜åŒ–ï¼Œé€šè¿‡æ…¢å¼€å§‹ã€æ‹¥å¡é¿å…ç­‰ç®—æ³•å‡å°‘ç½‘ç»œæ‹¥å¡çš„å‘ç”Ÿã€‚</p><h4 id="5ã€TCPç²˜åŒ…åŸå› å’Œè§£å†³æ–¹æ³•"><a href="#5ã€TCPç²˜åŒ…åŸå› å’Œè§£å†³æ–¹æ³•" class="headerlink" title="5ã€TCPç²˜åŒ…åŸå› å’Œè§£å†³æ–¹æ³•"></a><strong>5ã€TCPç²˜åŒ…åŸå› å’Œè§£å†³æ–¹æ³•</strong></h4><p>â€‹<strong>TCPç²˜åŒ…æ˜¯æŒ‡</strong>ï¼šå‘é€æ–¹å‘é€çš„è‹¥å¹²åŒ…æ•°æ®åˆ°æ¥æ”¶æ–¹æ¥æ”¶æ—¶ç²˜æˆä¸€åŒ…</p><p>â€‹<strong>å‘é€æ–¹åŸå› ï¼š</strong></p><p>â€‹TCPé»˜è®¤ä½¿ç”¨Nagleç®—æ³•ï¼ˆä¸»è¦ä½œç”¨ï¼šå‡å°‘ç½‘ç»œä¸­æŠ¥æ–‡æ®µçš„æ•°é‡ï¼‰ï¼š</p><p>â€‹æ”¶é›†å¤šä¸ªå°åˆ†ç»„ï¼Œåœ¨ä¸€ä¸ªç¡®è®¤åˆ°æ¥æ—¶ä¸€èµ·å‘é€ã€å¯¼è‡´å‘é€æ–¹å¯èƒ½ä¼šå‡ºç°ç²˜åŒ…é—®é¢˜</p><p>â€‹<strong>æ¥æ”¶æ–¹åŸå› ï¼š</strong></p><p>â€‹TCPå°†æ¥æ”¶åˆ°çš„æ•°æ®åŒ…ä¿å­˜åœ¨æ¥æ”¶ç¼“å­˜é‡Œï¼Œå¦‚æœTCPæ¥æ”¶æ•°æ®åŒ…åˆ°ç¼“å­˜çš„é€Ÿåº¦å¤§äºåº”ç”¨ç¨‹åºä»ç¼“å­˜ä¸­è¯»å–æ•°æ®åŒ…çš„é€Ÿåº¦ï¼Œå¤šä¸ªåŒ…å°±ä¼šè¢«ç¼“å­˜ï¼Œåº”ç”¨ç¨‹åºå°±æœ‰å¯èƒ½è¯»å–åˆ°å¤šä¸ªé¦–å°¾ç›¸æ¥ç²˜åˆ°ä¸€èµ·çš„åŒ…ã€‚</p><p>â€‹<strong>è§£å†³ç²˜åŒ…é—®é¢˜ï¼š</strong></p><p>â€‹æœ€æœ¬è´¨åŸå› åœ¨ä¸æ¥æ”¶å¯¹ç­‰æ–¹æ— æ³•åˆ†è¾¨æ¶ˆæ¯ä¸æ¶ˆæ¯ä¹‹é—´çš„è¾¹ç•Œåœ¨å“ªï¼Œé€šè¿‡ä½¿ç”¨æŸç§æ–¹æ¡ˆç»™å‡ºè¾¹ç•Œï¼Œä¾‹å¦‚ï¼š</p><ul><li><p>å‘é€å®šé•¿åŒ…ã€‚æ¯ä¸ªæ¶ˆæ¯çš„å¤§å°éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ¥æ”¶æ–¹åªè¦ç´¯è®¡æ¥æ”¶æ•°æ®ï¼Œç›´åˆ°æ•°æ®ç­‰äºä¸€ä¸ªå®šé•¿çš„æ•°å€¼å°±å°†å®ƒä½œä¸ºä¸€ä¸ªæ¶ˆæ¯ã€‚</p></li><li><p>åŒ…å°¾åŠ ä¸Š\r\næ ‡è®°ã€‚FTPåè®®æ­£æ˜¯è¿™ä¹ˆåšçš„ã€‚ä½†é—®é¢˜åœ¨äºå¦‚æœæ•°æ®æ­£æ–‡ä¸­ä¹Ÿå«æœ‰\r\nï¼Œåˆ™ä¼šè¯¯åˆ¤ä¸ºæ¶ˆæ¯çš„è¾¹ç•Œã€‚</p></li><li><p>åŒ…å¤´åŠ ä¸ŠåŒ…ä½“é•¿åº¦ã€‚åŒ…å¤´æ˜¯å®šé•¿çš„4ä¸ªå­—èŠ‚ï¼Œè¯´æ˜äº†åŒ…ä½“çš„é•¿åº¦ã€‚æ¥æ”¶å¯¹ç­‰æ–¹å…ˆæ¥æ”¶åŒ…ä½“é•¿åº¦ï¼Œä¾æ®åŒ…ä½“é•¿åº¦æ¥æ¥æ”¶åŒ…ä½“ã€‚</p></li></ul><h4 id="6ã€TCPã€UDPæŠ¥æ–‡æ ¼å¼"><a href="#6ã€TCPã€UDPæŠ¥æ–‡æ ¼å¼" class="headerlink" title="6ã€TCPã€UDPæŠ¥æ–‡æ ¼å¼"></a><strong>6ã€TCPã€UDPæŠ¥æ–‡æ ¼å¼</strong></h4><p>â€‹<strong>TCPæŠ¥æ–‡æ ¼å¼ï¼š</strong></p><p>â€‹<img src="https://farm1.staticflickr.com/792/27194088468_4cb0141fc8_b.jpg" style="zoom: 67%;" /></p><p>â€‹<strong>æºç«¯å£å·å’Œç›®çš„ç«¯å£å·</strong>ï¼š</p><p>â€‹ç”¨äºå¯»æ‰¾å‘ç«¯å’Œæ”¶ç«¯åº”ç”¨è¿›ç¨‹ã€‚è¿™ä¸¤ä¸ªå€¼åŠ ä¸Šipé¦–éƒ¨æºç«¯ipåœ°å€å’Œç›®çš„ç«¯ipåœ°å€å”¯ä¸€ç¡®å®šä¸€ä¸ªtcpè¿æ¥ã€‚</p><p>â€‹<strong>åºå·å­—æ®µï¼š</strong></p><p>â€‹åºå·ç”¨æ¥æ ‡è¯†ä»T C På‘ç«¯å‘T C Pæ”¶ç«¯å‘é€çš„æ•°æ®å­—èŠ‚æµï¼Œå®ƒè¡¨ç¤ºåœ¨è¿™ä¸ªæŠ¥æ–‡æ®µä¸­çš„çš„ç¬¬ä¸€ä¸ªæ•°æ®å­—èŠ‚ã€‚å¦‚æœå°†å­—èŠ‚æµçœ‹ä½œåœ¨ä¸¤ä¸ªåº”ç”¨ç¨‹åºé—´çš„å•å‘æµåŠ¨ï¼Œåˆ™ T C Pç”¨åºå·å¯¹æ¯ä¸ªå­—èŠ‚è¿›è¡Œè®¡æ•°ã€‚åºå·æ˜¯32 bitçš„æ— ç¬¦å·æ•°ï¼Œåºå·åˆ°è¾¾ 2^32-1ååˆä»0å¼€å§‹ã€‚</p><p>ã€€ã€€å½“å»ºç«‹ä¸€ä¸ªæ–°çš„è¿æ¥æ—¶ï¼ŒSYNæ ‡å¿—å˜1ã€‚åºå·å­—æ®µåŒ…å«ç”±è¿™ä¸ªä¸»æœºé€‰æ‹©çš„è¯¥è¿æ¥çš„åˆå§‹åºå·ISNï¼ˆInitial Sequence Numberï¼‰ã€‚è¯¥ä¸»æœºè¦å‘é€æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚åºå·ä¸ºè¿™ä¸ªISNåŠ 1ï¼Œå› ä¸ºSYNæ ‡å¿—æ¶ˆè€—äº†ä¸€ä¸ªåºå·</p><p>â€‹<strong>ç¡®è®¤åºå·</strong>ï¼š</p><p>â€‹æ—¢ç„¶æ¯ä¸ªä¼ è¾“çš„å­—èŠ‚éƒ½è¢«è®¡æ•°ï¼Œç¡®è®¤åºå·åŒ…å«å‘é€ç¡®è®¤çš„ä¸€ç«¯æ‰€æœŸæœ›æ”¶åˆ°çš„ä¸‹ä¸€ä¸ªåºå·ã€‚å› æ­¤ï¼Œç¡®è®¤åºå·åº”å½“æ˜¯ä¸Šæ¬¡å·²æˆåŠŸæ”¶åˆ°æ•°æ®å­—èŠ‚åºå·åŠ  1ã€‚åªæœ‰ACKæ ‡å¿—ä¸º 1æ—¶ç¡®è®¤åºå·å­—æ®µæ‰æœ‰æ•ˆã€‚å‘é€ACKæ— éœ€ä»»ä½•ä»£ä»·ï¼Œå› ä¸º 32 bitçš„ç¡®è®¤åºå·å­—æ®µå’ŒA C Kæ ‡å¿—ä¸€æ ·ï¼Œæ€»æ˜¯T C Pé¦–éƒ¨çš„ä¸€éƒ¨åˆ†ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çœ‹åˆ°ä¸€æ—¦ä¸€ä¸ªè¿æ¥å»ºç«‹èµ·æ¥ï¼Œè¿™ä¸ªå­—æ®µæ€»æ˜¯è¢«è®¾ç½®ï¼Œ ACKæ ‡å¿—ä¹Ÿæ€»æ˜¯è¢«è®¾ç½®ä¸º1ã€‚TCPä¸ºåº”ç”¨å±‚æä¾›å…¨åŒå·¥æœåŠ¡ã€‚è¿™æ„å‘³æ•°æ®èƒ½åœ¨ä¸¤ä¸ªæ–¹å‘ä¸Šç‹¬ç«‹åœ°è¿›è¡Œä¼ è¾“ã€‚å› æ­¤ï¼Œè¿æ¥çš„æ¯ä¸€ç«¯å¿…é¡»ä¿æŒæ¯ä¸ªæ–¹å‘ä¸Šçš„ä¼ è¾“æ•°æ®åºå·ã€‚</p><p>â€‹<strong>é¦–éƒ½é•¿åº¦</strong>ï¼š</p><p>â€‹é¦–éƒ¨é•¿åº¦ç»™å‡ºé¦–éƒ¨ä¸­ 32 bitå­—çš„æ•°ç›®ã€‚éœ€è¦è¿™ä¸ªå€¼æ˜¯å› ä¸ºä»»é€‰å­—æ®µçš„é•¿åº¦æ˜¯å¯å˜çš„ã€‚è¿™ä¸ªå­—æ®µå 4 bitï¼Œå› æ­¤T C Pæœ€å¤šæœ‰6 0å­—èŠ‚çš„é¦–éƒ¨ã€‚ç„¶è€Œï¼Œæ²¡æœ‰ä»»é€‰å­—æ®µï¼Œæ­£å¸¸çš„é•¿åº¦æ˜¯ 2 0å­—èŠ‚ã€‚</p><p>â€‹<strong>æ ‡å¿—å­—æ®µ</strong>ï¼šåœ¨T C Pé¦–éƒ¨ä¸­æœ‰ 6ä¸ªæ ‡å¿—æ¯”ç‰¹ã€‚å®ƒä»¬ä¸­çš„å¤šä¸ªå¯åŒæ—¶è¢«è®¾ç½®ä¸º1.<br>ã€€ã€€URGç´§æ€¥æŒ‡é’ˆï¼ˆu rgent pointerï¼‰æœ‰æ•ˆ<br>ã€€ã€€ACKç¡®è®¤åºå·æœ‰æ•ˆã€‚<br>ã€€ã€€PSHæ¥æ”¶æ–¹åº”è¯¥å°½å¿«å°†è¿™ä¸ªæŠ¥æ–‡æ®µäº¤ç»™åº”ç”¨å±‚ã€‚<br>ã€€ã€€RSTé‡å»ºè¿æ¥ã€‚<br>ã€€ã€€SYNåŒæ­¥åºå·ç”¨æ¥å‘èµ·ä¸€ä¸ªè¿æ¥ã€‚è¿™ä¸ªæ ‡å¿—å’Œä¸‹ä¸€ä¸ªæ ‡å¿—å°†åœ¨ç¬¬ 1 8ç« ä»‹ç»ã€‚<br>ã€€ã€€FINå‘ç«¯å®Œæˆå‘é€ä»»åŠ¡ã€‚</p><p>â€‹<strong>çª—å£å¤§å°</strong>ï¼š</p><p>â€‹T C Pçš„æµé‡æ§åˆ¶ç”±è¿æ¥çš„æ¯ä¸€ç«¯é€šè¿‡å£°æ˜çš„çª—å£å¤§å°æ¥æä¾›ã€‚çª—å£å¤§å°ä¸ºå­—èŠ‚æ•°ï¼Œèµ·å§‹äºç¡®è®¤åºå·å­—æ®µæŒ‡æ˜çš„å€¼ï¼Œè¿™ä¸ªå€¼æ˜¯æ¥æ”¶ç«¯æœŸæœ›æ¥æ”¶çš„å­—èŠ‚ã€‚çª—å£å¤§å°æ˜¯ä¸€ä¸ª 16 bitå­—æ®µï¼Œå› è€Œçª—å£å¤§å°æœ€å¤§ä¸º 65535å­—èŠ‚ã€‚</p><p>â€‹<strong>æ£€éªŒå’Œï¼š</strong></p><p>â€‹æ£€éªŒå’Œè¦†ç›–äº†æ•´ä¸ªçš„ T C PæŠ¥æ–‡æ®µï¼šT C Pé¦–éƒ¨å’ŒT C Pæ•°æ®ã€‚è¿™æ˜¯ä¸€ä¸ªå¼ºåˆ¶æ€§çš„å­—æ®µï¼Œä¸€å®šæ˜¯ç”±å‘ç«¯è®¡ç®—å’Œå­˜å‚¨ï¼Œå¹¶ç”±æ”¶ç«¯è¿›è¡ŒéªŒè¯ã€‚</p><p>â€‹<strong>ç´§æ€¥æŒ‡é’ˆ</strong>ï¼š</p><p>â€‹åªæœ‰å½“URGæ ‡å¿—ç½®1æ—¶ç´§æ€¥æŒ‡é’ˆæ‰æœ‰æ•ˆã€‚ç´§æ€¥æŒ‡é’ˆæ˜¯ä¸€ä¸ªæ­£çš„åç§»é‡ï¼Œå’Œåºå·å­—æ®µä¸­çš„å€¼ç›¸åŠ è¡¨ç¤ºç´§æ€¥æ•°æ®æœ€åä¸€ä¸ªå­—èŠ‚çš„åºå·ã€‚ T C Pçš„ç´§æ€¥æ–¹å¼æ˜¯å‘é€ç«¯å‘å¦ä¸€ç«¯å‘é€ç´§æ€¥æ•°æ®çš„ä¸€ç§æ–¹å¼ã€‚</p><p>â€‹<strong>é€‰é¡¹</strong>ï¼š</p><p>â€‹æœ€å¸¸è§çš„å¯é€‰å­—æ®µæ˜¯æœ€é•¿æŠ¥æ–‡å¤§å°ï¼Œåˆç§°ä¸º MSS (Maximum Segment Size)ã€‚æ¯ä¸ªè¿æ¥æ–¹é€šå¸¸éƒ½åœ¨é€šä¿¡çš„ç¬¬ä¸€ä¸ªæŠ¥æ–‡æ®µï¼ˆä¸ºå»ºç«‹è¿æ¥è€Œè®¾ç½® S Y Næ ‡å¿—çš„é‚£ä¸ªæ®µï¼‰ä¸­æŒ‡æ˜è¿™ä¸ªé€‰é¡¹ã€‚å®ƒæŒ‡æ˜æœ¬ç«¯æ‰€èƒ½æ¥æ”¶çš„æœ€å¤§é•¿åº¦çš„æŠ¥æ–‡æ®µã€‚</p><p>â€‹<strong>UDPæŠ¥æ–‡æ ¼å¼ï¼š</strong></p><p>â€‹<img src="https://appwk.baidu.com/naapi/doc/view?ih=482&o=png_6_0_0_176_917_504_247_892.979_1262.879&iw=986&ix=0&iy=0&aimw=986&rn=1&doc_id=182d935c3186bceb18e8bb77&pn=1&sign=b88bda03b9954e506622f97b8b2ae438&type=1&app_ver=2.9.8.2&ua=bd_800_800_IncredibleS_2.9.8.2_2.3.7&bid=1&app_ua=IncredibleS&uid=&cuid=&fr=3&Bdi_bear=WIFI&from=3_10000&bduss=&pid=1&screen=800_800&sys_ver=2.3.7" style="zoom:50%;" /></p><p>â€‹<strong>ç«¯å£å·</strong>ï¼š</p><p>â€‹ç”¨æ¥è¡¨ç¤ºå‘é€å’Œæ¥å—è¿›ç¨‹ã€‚ç”±äº I På±‚å·²ç»æŠŠI Pæ•°æ®æŠ¥åˆ†é…ç»™T C Pæˆ–U D Pï¼ˆæ ¹æ®I Pé¦–éƒ¨ä¸­åè®®å­—æ®µå€¼ï¼‰ï¼Œå› æ­¤T C Pç«¯å£å·ç”±T C Pæ¥æŸ¥çœ‹ï¼Œè€Œ U D Pç«¯å£å·ç”±UDPæ¥æŸ¥çœ‹ã€‚T C Pç«¯å£å·ä¸UDPç«¯å£å·æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚</p><p>â€‹<strong>é•¿åº¦</strong>ï¼š</p><p>â€‹UDPé•¿åº¦å­—æ®µæŒ‡çš„æ˜¯UDPé¦–éƒ¨å’ŒUDPæ•°æ®çš„å­—èŠ‚é•¿åº¦ã€‚è¯¥å­—æ®µçš„æœ€å°å€¼ä¸º 8å­—èŠ‚ï¼ˆå‘é€ä¸€ä»½0å­—èŠ‚çš„UDPæ•°æ®æŠ¥æ˜¯ O Kï¼‰ã€‚</p><p>â€‹<strong>æ£€éªŒå’Œ</strong>ï¼š</p><p>â€‹UDPæ£€éªŒå’Œæ˜¯ä¸€ä¸ªç«¯åˆ°ç«¯çš„æ£€éªŒå’Œã€‚å®ƒç”±å‘é€ç«¯è®¡ç®—ï¼Œç„¶åç”±æ¥æ”¶ç«¯éªŒè¯ã€‚å…¶ç›®çš„æ˜¯ä¸ºäº†å‘ç°UDPé¦–éƒ¨å’Œæ•°æ®åœ¨å‘é€ç«¯åˆ°æ¥æ”¶ç«¯ä¹‹é—´å‘ç”Ÿçš„ä»»ä½•æ”¹åŠ¨ã€‚</p><p>â€‹<strong>IPæŠ¥æ–‡æ ¼å¼ï¼š</strong>æ™®é€šçš„IPé¦–éƒ¨é•¿ä¸º20ä¸ªå­—èŠ‚ï¼Œé™¤éå«æœ‰å¯é€‰é¡¹å­—æ®µã€‚</p><p>â€‹<img src="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=1614312792,1954581760&fm=26&gp=0.jpg" style="zoom:67%;" /></p><p>â€‹<strong>4ä½ç‰ˆæœ¬</strong>ï¼š</p><p>â€‹ç›®å‰åè®®ç‰ˆæœ¬å·æ˜¯4ï¼Œå› æ­¤IPæœ‰æ—¶ä¹Ÿç§°ä½œIPV4.</p><p>â€‹<strong>4ä½é¦–éƒ¨é•¿åº¦</strong>ï¼š</p><p>â€‹é¦–éƒ¨é•¿åº¦æŒ‡çš„æ˜¯é¦–éƒ¨å 32bitå­—çš„æ•°ç›®ï¼ŒåŒ…æ‹¬ä»»ä½•é€‰é¡¹ã€‚ç”±äºå®ƒæ˜¯ä¸€ä¸ª4æ¯”ç‰¹å­—æ®µï¼Œå› æ­¤é¦–éƒ¨é•¿åº¦æœ€é•¿ä¸º60ä¸ªå­—èŠ‚ã€‚</p><p>â€‹<strong>æœåŠ¡ç±»å‹ï¼ˆTOSï¼‰</strong>ï¼š</p><p>â€‹æœåŠ¡ç±»å‹å­—æ®µåŒ…æ‹¬ä¸€ä¸ª3bitçš„ä¼˜å…ˆæƒå­—æ®µï¼ˆç°åœ¨å·²ç»è¢«å¿½ç•¥ï¼‰ï¼Œ4bitçš„TOSå­å­—æ®µå’Œ1bitæœªç”¨ä½å¿…é¡»ç½®0ã€‚4bitçš„TOSåˆ†åˆ«ä»£è¡¨ï¼šæœ€å°æ—¶å»¶ï¼Œæœ€å¤§ååé‡ï¼Œæœ€é«˜å¯é æ€§å’Œæœ€å°è´¹ç”¨ã€‚4bitä¸­åªèƒ½ç½®å…¶ä¸­1æ¯”ç‰¹ã€‚å¦‚æœæ‰€æœ‰4bitå‡ä¸º0ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€æ˜¯ä¸€èˆ¬æœåŠ¡ã€‚</p><p>â€‹<strong>æ€»é•¿åº¦</strong>ï¼š</p><p>â€‹æ€»é•¿åº¦å­—æ®µæ˜¯æŒ‡æ•´ä¸ªIPæ•°æ®æŠ¥çš„é•¿åº¦ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ã€‚åˆ©ç”¨é¦–éƒ¨é•¿åº¦å’Œæ€»é•¿åº¦å­—æ®µï¼Œå°±å¯ä»¥çŸ¥é“IPæ•°æ®æŠ¥ä¸­æ•°æ®å†…å®¹çš„èµ·å§‹ä½ç½®å’Œé•¿åº¦ã€‚ç”±äºè¯¥å­—æ®µé•¿16bitï¼Œæ‰€ä»¥IPæ•°æ®æŠ¥æœ€é•¿å¯è¾¾65535å­—èŠ‚ã€‚å½“æ•°æ®æŠ¥è¢«åˆ†ç‰‡æ—¶ï¼Œè¯¥å­—æ®µçš„å€¼ä¹Ÿéšç€å˜åŒ–ã€‚</p><p>â€‹<strong>æ ‡è¯†å­—æ®µ</strong>ï¼š</p><p>â€‹æ ‡è¯†å­—æ®µå”¯ä¸€åœ°æ ‡è¯†ä¸»æœºå‘é€çš„æ¯ä¸€ä»½æ•°æ®æŠ¥ã€‚é€šå¸¸æ¯å‘é€ä¸€ä»½æŠ¥æ–‡å®ƒçš„å€¼å°±ä¼šåŠ 1ã€‚</p><p>â€‹<strong>ç”Ÿå­˜æ—¶é—´</strong>ï¼š</p><p>â€‹TTLï¼ˆtime-to-liveï¼‰ç”Ÿå­˜æ—¶é—´å­—æ®µè®¾ç½®äº†æ•°æ®æŠ¥å¯ä»¥ç»è¿‡çš„æœ€å¤šè·¯ç”±å™¨æ•°ã€‚å®ƒæŒ‡å®šäº†æ•°æ®æŠ¥çš„ç”Ÿå­˜æ—¶é—´ã€‚TTLçš„åˆå§‹å€¼ç”±æºä¸»æœºè®¾ç½®ï¼ˆé€šå¸¸ä¸º 3 2æˆ–6 4ï¼‰ï¼Œä¸€æ—¦ç»è¿‡ä¸€ä¸ªå¤„ç†å®ƒçš„è·¯ç”±å™¨ï¼Œå®ƒçš„å€¼å°±å‡å» 1ã€‚å½“è¯¥å­—æ®µçš„å€¼ä¸º 0æ—¶ï¼Œæ•°æ®æŠ¥å°±è¢«ä¸¢å¼ƒï¼Œå¹¶å‘é€ ICMP æŠ¥æ–‡é€šçŸ¥æºä¸»æœºã€‚</p><p>â€‹<strong>é¦–éƒ¨æ£€éªŒå’Œ</strong>ï¼š</p><p>â€‹é¦–éƒ¨æ£€éªŒå’Œå­—æ®µæ˜¯æ ¹æ® I Pé¦–éƒ¨è®¡ç®—çš„æ£€éªŒå’Œç ã€‚å®ƒä¸å¯¹é¦–éƒ¨åé¢çš„æ•°æ®è¿›è¡Œè®¡ç®—ã€‚ ICMPã€IGMPã€UDPå’ŒTCPåœ¨å®ƒä»¬å„è‡ªçš„é¦–éƒ¨ä¸­å‡å«æœ‰åŒæ—¶è¦†ç›–é¦–éƒ¨å’Œæ•°æ®æ£€éªŒå’Œç ã€‚</p><p>â€‹<strong>ä»¥å¤ªç½‘æŠ¥æ–‡æ ¼å¼ï¼š</strong></p><p><img src="https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/u=2733576797,55677727&fm=26&gp=0.jpg"></p><p>â€‹<strong>ç›®çš„åœ°å€å’Œæºåœ°å€ï¼š</strong></p><p>â€‹æ˜¯æŒ‡ç½‘å¡çš„ç¡¬ä»¶åœ°å€ï¼ˆä¹Ÿå«MAC åœ°å€ï¼‰ï¼Œé•¿åº¦æ˜¯48 ä½ï¼Œæ˜¯åœ¨ç½‘å¡å‡ºå‚æ—¶å›ºåŒ–çš„ã€‚</p><p>â€‹<strong>æ•°æ®ï¼š</strong></p><p>â€‹ä»¥å¤ªç½‘å¸§ä¸­çš„æ•°æ®é•¿åº¦è§„å®šæœ€å°46 å­—èŠ‚ï¼Œæœ€å¤§1500 å­—èŠ‚ï¼ŒARP å’ŒRARP æ•°æ®åŒ…çš„é•¿åº¦ä¸å¤Ÿ46 å­—èŠ‚ï¼Œè¦åœ¨åé¢è¡¥å¡«å……ä½ã€‚æœ€å¤§å€¼1500 ç§°ä¸ºä»¥å¤ªç½‘çš„æœ€å¤§ä¼ è¾“å•å…ƒï¼ˆMTUï¼‰ï¼Œä¸åŒçš„ç½‘ç»œç±»å‹æœ‰ä¸åŒçš„MTUï¼Œå¦‚æœä¸€ä¸ªæ•°æ®åŒ…ä»ä»¥å¤ªç½‘è·¯ç”±åˆ°æ‹¨å·é“¾è·¯ä¸Šï¼Œæ•°æ®åŒ…åº¦å¤§äºæ‹¨å·é“¾è·¯çš„MTUäº†ï¼Œåˆ™éœ€è¦å¯¹æ•°æ®åŒ…è¿›è¡Œåˆ†ç‰‡fragmentationï¼‰ã€‚ifconfig å‘½ä»¤çš„è¾“å‡ºä¸­ä¹Ÿæœ‰â€œMTU:1500â€ã€‚æ³¨æ„ï¼ŒMTU ä¸ªæ¦‚å¿µæŒ‡æ•°æ®å¸§ä¸­æœ‰æ•ˆè½½è·çš„æœ€å¤§é•¿åº¦ï¼Œä¸åŒ…æ‹¬å¸§é¦–éƒ¨çš„é•¿åº¦ã€‚</p><h3 id="HTTPåè®®"><a href="#HTTPåè®®" class="headerlink" title="HTTPåè®®"></a><strong>HTTPåè®®</strong></h3><h4 id="1ã€HTTPåè®®1-0-1-1-2-0"><a href="#1ã€HTTPåè®®1-0-1-1-2-0" class="headerlink" title="1ã€HTTPåè®®1.0_1.1_2.0"></a>1ã€HTTPåè®®1.0_1.1_2.0</h4><p>â€‹<strong>HTTP1.0ï¼š</strong>æœåŠ¡å™¨å¤„ç†å®Œæˆåç«‹å³æ–­å¼€TCPè¿æ¥ï¼ˆ<strong>æ— è¿æ¥</strong>ï¼‰ï¼ŒæœåŠ¡å™¨ä¸è·Ÿè¸ªæ¯ä¸ªå®¢æˆ·ç«¯ä¹Ÿä¸è®°å½•è¿‡å»çš„è¯·æ±‚ï¼ˆ<strong>æ— çŠ¶æ€</strong>ï¼‰</p><p>â€‹<strong>HTTP1.1ï¼š</strong>KeepAlived<strong>é•¿è¿æ¥</strong>é¿å…äº†è¿æ¥å»ºç«‹å’Œé‡Šæ”¾çš„å¼€é”€ï¼›é€šè¿‡Content-Lengthæ¥åˆ¤æ–­å½“å‰è¯·æ±‚æ•°æ®æ˜¯å¦å·²ç»å…¨éƒ¨æ¥å—ï¼ˆ<strong>æœ‰çŠ¶æ€</strong>ï¼‰</p><p>â€‹<strong>HTTP2.0ï¼š</strong>å¼•å…¥äºŒè¿›åˆ¶æ•°æ®å¸§å’Œæµçš„æ¦‚å¿µï¼Œå…¶ä¸­å¸§å¯¹æ•°æ®è¿›è¡Œé¡ºåºæ ‡è¯†ï¼›å› ä¸ºæœ‰äº†åºåˆ—ï¼ŒæœåŠ¡å™¨å¯ä»¥<strong>å¹¶è¡Œ</strong>çš„ä¼ è¾“æ•°æ®ã€‚</p><p>â€‹<strong>http1.0å’Œhttp1.1çš„ä¸»è¦åŒºåˆ«å¦‚ä¸‹ï¼š</strong><br>â€‹1ã€ç¼“å­˜å¤„ç†ï¼š1.1æ·»åŠ æ›´å¤šçš„ç¼“å­˜æ§åˆ¶ç­–ç•¥ï¼ˆå¦‚ï¼šEntity tagï¼ŒIf-Matchï¼‰<br>â€‹2ã€ç½‘ç»œè¿æ¥çš„ä¼˜åŒ–ï¼š1.1æ”¯æŒæ–­ç‚¹ç»­ä¼ <br>â€‹3ã€é”™è¯¯çŠ¶æ€ç çš„å¢å¤šï¼š1.1æ–°å¢äº†24ä¸ªé”™è¯¯çŠ¶æ€å“åº”ç ï¼Œä¸°å¯Œçš„é”™è¯¯ç æ›´åŠ æ˜ç¡®å„ä¸ªçŠ¶æ€<br>â€‹4ã€Hostå¤´å¤„ç†ï¼šæ”¯æŒHostå¤´åŸŸï¼Œä¸åœ¨ä»¥IPä¸ºè¯·æ±‚æ–¹æ ‡å¿—<br>â€‹5ã€é•¿è¿æ¥ï¼šå‡å°‘äº†å»ºç«‹å’Œå…³é—­è¿æ¥çš„æ¶ˆè€—å’Œå»¶è¿Ÿã€‚</p><p>â€‹<strong>http1.1å’Œhttp2.0çš„ä¸»è¦åŒºåˆ«ï¼š</strong><br>â€‹1ã€æ–°çš„ä¼ è¾“æ ¼å¼ï¼š2.0ä½¿ç”¨äºŒè¿›åˆ¶æ ¼å¼ï¼Œ1.0ä¾ç„¶ä½¿ç”¨åŸºäºæ–‡æœ¬æ ¼å¼<br>â€‹2ã€å¤šè·¯å¤ç”¨ï¼šè¿æ¥å…±äº«ï¼Œä¸åŒçš„requestå¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªè¿æ¥ä¼ è¾“ï¼ˆæœ€åæ ¹æ®æ¯ä¸ªrequestä¸Šçš„idå·ç»„åˆæˆæ­£å¸¸çš„è¯·æ±‚ï¼‰<br>â€‹3ã€headerå‹ç¼©ï¼šç”±äº1.Xä¸­headerå¸¦æœ‰å¤§é‡çš„ä¿¡æ¯ï¼Œå¹¶ä¸”å¾—é‡å¤ä¼ è¾“ï¼Œ2.0ä½¿ç”¨encoderæ¥å‡å°‘éœ€è¦ä¼ è¾“çš„hearderå¤§å°<br>â€‹4ã€æœåŠ¡ç«¯æ¨é€ï¼šåŒgoogleçš„SPDUYï¼ˆ1.0çš„ä¸€ç§å‡çº§ï¼‰ä¸€æ ·</p><h4 id="2ã€HTTPä¸HTTPSä¹‹é—´çš„åŒºåˆ«"><a href="#2ã€HTTPä¸HTTPSä¹‹é—´çš„åŒºåˆ«" class="headerlink" title="2ã€HTTPä¸HTTPSä¹‹é—´çš„åŒºåˆ«"></a>2ã€HTTPä¸HTTPSä¹‹é—´çš„åŒºåˆ«</h4><p>â€‹<strong>HTTPä¸HTTPSä¹‹é—´çš„åŒºåˆ«ï¼š</strong></p><table><thead><tr><th align="center">HTTP</th><th align="center">HTTPS</th></tr></thead><tbody><tr><td align="center">é»˜è®¤ç«¯å£80</td><td align="center">HTTPSé»˜è®¤ä½¿ç”¨ç«¯å£443</td></tr><tr><td align="center">æ˜æ–‡ä¼ è¾“ã€æ•°æ®æœªåŠ å¯†ã€å®‰å…¨æ€§å·®</td><td align="center">ä¼ è¾“è¿‡ç¨‹sslåŠ å¯†ã€å®‰å…¨æ€§è¾ƒå¥½</td></tr><tr><td align="center">å“åº”é€Ÿåº¦å¿«ã€æ¶ˆè€—èµ„æºå°‘</td><td align="center">å“åº”é€Ÿåº¦è¾ƒæ…¢ã€æ¶ˆè€—èµ„æºå¤šã€éœ€è¦ç”¨åˆ°CAè¯ä¹¦</td></tr></tbody></table><p>â€‹<strong>HTTPSé“¾æ¥å»ºç«‹çš„è¿‡ç¨‹ï¼š</strong></p><p>â€‹1.é¦–å…ˆå®¢æˆ·ç«¯å…ˆç»™æœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚</p><p>â€‹2.æœåŠ¡å™¨å‘é€ä¸€ä¸ªSSLè¯ä¹¦ç»™å®¢æˆ·ç«¯ï¼Œå†…å®¹åŒ…æ‹¬ï¼šè¯ä¹¦çš„å‘å¸ƒæœºæ„ã€æœ‰æ•ˆæœŸã€æ‰€æœ‰è€…ã€ç­¾åä»¥åŠå…¬é’¥</p><p>â€‹3.å®¢æˆ·ç«¯å¯¹å‘æ¥çš„å…¬é’¥è¿›è¡ŒçœŸä¼ªæ ¡éªŒï¼Œæ ¡éªŒä¸ºçœŸåˆ™ä½¿ç”¨å…¬é’¥å¯¹å¯¹ç§°åŠ å¯†ç®—æ³•ä»¥åŠå¯¹ç§°å¯†é’¥è¿›è¡ŒåŠ å¯†</p><p>â€‹4.æœåŠ¡å™¨ç«¯ä½¿ç”¨ç§é’¥è¿›è¡Œè§£å¯†å¹¶ä½¿ç”¨å¯¹ç§°å¯†é’¥åŠ å¯†ç¡®è®¤ä¿¡æ¯å‘é€ç»™å®¢æˆ·ç«¯</p><p>â€‹5.éšåå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å°±ä½¿ç”¨å¯¹ç§°å¯†é’¥è¿›è¡Œä¿¡æ¯ä¼ è¾“</p><p>â€‹<strong>å¯¹ç§°åŠ å¯†ç®—æ³•ï¼š</strong></p><p>â€‹åŒæ–¹æŒæœ‰ç›¸åŒçš„å¯†é’¥ï¼Œä¸”åŠ å¯†é€Ÿåº¦å¿«ï¼Œå…¸å‹å¯¹ç§°åŠ å¯†ç®—æ³•ï¼šDESã€AES</p><p>â€‹<strong>éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼š</strong></p><p>â€‹å¯†é’¥æˆå¯¹å‡ºç°ï¼ˆç§é’¥ã€å…¬é’¥ï¼‰ï¼Œç§é’¥åªæœ‰è‡ªå·±çŸ¥é“ï¼Œä¸åœ¨ç½‘ç»œä¸­ä¼ è¾“ï¼›è€Œå…¬é’¥å¯ä»¥å…¬å¼€ã€‚ç›¸æ¯”å¯¹ç§°åŠ å¯†é€Ÿåº¦è¾ƒæ…¢ï¼Œå…¸å‹çš„éå¯¹ç§°åŠ å¯†ç®—æ³•æœ‰ï¼šRSAã€DSA</p><h4 id="3ã€Getå’ŒPostè¯·æ±‚åŒºåˆ«"><a href="#3ã€Getå’ŒPostè¯·æ±‚åŒºåˆ«" class="headerlink" title="3ã€Getå’ŒPostè¯·æ±‚åŒºåˆ«"></a><strong>3ã€Getå’ŒPostè¯·æ±‚åŒºåˆ«</strong></h4><p><strong>HTTPè¯·æ±‚ï¼š</strong></p><table><thead><tr><th align="left">æ–¹æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td align="left">GET</td><td>å‘ç‰¹å®šèµ„æºå‘é€è¯·æ±‚ï¼ŒæŸ¥è¯¢æ•°æ®ï¼Œå¹¶è¿”å›å®ä½“</td></tr><tr><td align="left">POST</td><td>å‘æŒ‡å®šèµ„æºæäº¤æ•°æ®è¿›è¡Œå¤„ç†è¯·æ±‚ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ–°çš„èµ„æºå»ºç«‹ã€å·²æœ‰èµ„æºä¿®æ”¹</td></tr><tr><td align="left">PUT</td><td>å‘æœåŠ¡å™¨ä¸Šä¼ æ–°çš„å†…å®¹</td></tr><tr><td align="left">HEAD</td><td>ç±»ä¼¼GETè¯·æ±‚ï¼Œè¿”å›çš„å“åº”ä¸­æ²¡æœ‰å…·ä½“çš„å†…å®¹ï¼Œç”¨äºè·å–æŠ¥å¤´</td></tr><tr><td align="left">DELETE</td><td>è¯·æ±‚æœåŠ¡å™¨åˆ é™¤æŒ‡å®šæ ‡è¯†çš„èµ„æº</td></tr><tr><td align="left">OPTIONS</td><td>å¯ä»¥ç”¨æ¥å‘æœåŠ¡å™¨å‘é€è¯·æ±‚æ¥æµ‹è¯•æœåŠ¡å™¨çš„åŠŸèƒ½æ€§</td></tr><tr><td align="left">TRACE</td><td>å›æ˜¾æœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚ï¼Œç”¨äºæµ‹è¯•æˆ–è¯Šæ–­</td></tr><tr><td align="left">CONNECT</td><td>HTTP&#x2F;1.1åè®®ä¸­é¢„ç•™ç»™èƒ½å¤Ÿå°†è¿æ¥æ”¹ä¸ºç®¡é“æ–¹å¼çš„ä»£ç†æœåŠ¡å™¨</td></tr></tbody></table><p><strong>getå’ŒPoståŒºåˆ«ï¼š</strong></p><table><thead><tr><th></th><th>GET</th><th>POST</th></tr></thead><tbody><tr><td>å¯è§æ€§</td><td>æ•°æ®åœ¨URLä¸­å¯¹æ‰€æœ‰äººå¯è§</td><td>æ•°æ®ä¸ä¼šæ˜¾ç¤ºåœ¨URLä¸­</td></tr><tr><td>å®‰å…¨æ€§</td><td>ä¸postç›¸æ¯”ï¼Œgetçš„å®‰å…¨æ€§è¾ƒå·®ï¼Œå› ä¸ºæ‰€<br/>å‘é€çš„æ•°æ®æ˜¯URLçš„ä¸€éƒ¨åˆ†</td><td>å®‰å…¨ï¼Œå› ä¸ºå‚æ•°ä¸ä¼šè¢«ä¿å­˜åœ¨æµè§ˆå™¨<br/>å†å²æˆ–webæœåŠ¡å™¨æ—¥å¿—ä¸­</td></tr><tr><td>æ•°æ®é•¿åº¦</td><td>å—é™åˆ¶ï¼Œæœ€é•¿2kb</td><td>æ— é™åˆ¶</td></tr><tr><td>ç¼–ç ç±»å‹</td><td>application&#x2F;x-www-form-urlencoded</td><td>multipart&#x2F;form-data</td></tr><tr><td>ç¼“å­˜</td><td>èƒ½è¢«ç¼“å­˜</td><td>ä¸èƒ½è¢«ç¼“å­˜</td></tr><tr><td></td><td></td><td></td></tr></tbody></table><h4 id="4ã€HTTPå¸¸è§å“åº”çŠ¶æ€ç "><a href="#4ã€HTTPå¸¸è§å“åº”çŠ¶æ€ç " class="headerlink" title="4ã€HTTPå¸¸è§å“åº”çŠ¶æ€ç "></a><strong>4ã€HTTPå¸¸è§å“åº”çŠ¶æ€ç </strong></h4><p>â€‹100ï¼šContinue â€” ç»§ç»­ã€‚å®¢æˆ·ç«¯åº”ç»§ç»­å…¶è¯·æ±‚ã€‚</p><p>â€‹200ï¼šOK â€” è¯·æ±‚æˆåŠŸã€‚ä¸€èˆ¬ç”¨äºGETä¸POSTè¯·æ±‚ã€‚</p><p>â€‹301ï¼šMoved Permanently â€” æ°¸ä¹…é‡å®šå‘ã€‚</p><p>â€‹302ï¼šFound â€” æš‚æ—¶é‡å®šå‘ã€‚</p><p>â€‹400ï¼šBad Request â€” å®¢æˆ·ç«¯è¯·æ±‚çš„è¯­æ³•é”™è¯¯ï¼ŒæœåŠ¡å™¨æ— æ³•ç†è§£ã€‚</p><p>â€‹403ï¼šForbideen â€” æœåŠ¡å™¨ç†è§£è¯·æ±‚å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä½†æ˜¯æ‹’ç»æ‰§è¡Œæ­¤è¯·æ±‚ã€‚</p><p>â€‹404ï¼šNot Found â€” æœåŠ¡å™¨æ— æ³•æ ¹æ®å®¢æˆ·ç«¯çš„è¯·æ±‚æ‰¾åˆ°èµ„æºï¼ˆç½‘é¡µï¼‰ã€‚</p><p>â€‹500ï¼šInternal Server Error â€” æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œæ— æ³•å®Œæˆè¯·æ±‚ã€‚</p><p>â€‹502ï¼šBad Gateway â€” ä½œä¸ºç½‘å…³æˆ–è€…ä»£ç†æœåŠ¡å™¨å°è¯•æ‰§è¡Œè¯·æ±‚æ—¶ï¼Œä»è¿œç¨‹æœåŠ¡å™¨æ¥æ”¶åˆ°äº†æ— æ•ˆçš„å“åº”ã€‚</p><h4 id="5ã€é‡å®šå‘å’Œè½¬å‘åŒºåˆ«"><a href="#5ã€é‡å®šå‘å’Œè½¬å‘åŒºåˆ«" class="headerlink" title="5ã€é‡å®šå‘å’Œè½¬å‘åŒºåˆ«"></a><strong>5ã€é‡å®šå‘å’Œè½¬å‘åŒºåˆ«</strong></h4><p>â€‹<strong>é‡å®šå‘ï¼šredirectï¼š</strong></p><p>â€‹åœ°å€æ å‘ç”Ÿå˜åŒ–</p><p>â€‹é‡å®šå‘å¯ä»¥è®¿é—®å…¶ä»–ç«™ç‚¹ï¼ˆæœåŠ¡å™¨ï¼‰çš„èµ„æº</p><p>â€‹é‡å®šå‘æ˜¯ä¸¤æ¬¡è¯·æ±‚ã€‚ä¸èƒ½ä½¿ç”¨requestå¯¹è±¡æ¥å…±äº«æ•°æ®</p><p>â€‹<strong>è½¬å‘ï¼šforwardï¼š</strong></p><p>â€‹è½¬å‘åœ°å€æ è·¯å¾„ä¸å˜</p><p>â€‹è½¬å‘åªèƒ½è®¿é—®å½“å‰æœåŠ¡å™¨ä¸‹çš„èµ„æº</p><p>â€‹è½¬å‘æ˜¯ä¸€æ¬¡è¯·æ±‚ï¼Œå¯ä»¥ä½¿ç”¨requestå¯¹è±¡å…±äº«æ•°æ®</p><h4 id="6ã€Cookieå’ŒSessionåŒºåˆ«ã€‚"><a href="#6ã€Cookieå’ŒSessionåŒºåˆ«ã€‚" class="headerlink" title="6ã€Cookieå’ŒSessionåŒºåˆ«ã€‚"></a><strong>6ã€Cookieå’ŒSessionåŒºåˆ«ã€‚</strong></h4><p>â€‹Cookie å’Œ Sessionéƒ½æ˜¯ç”¨æ¥è·Ÿè¸ªæµè§ˆå™¨ç”¨æˆ·èº«ä»½çš„ä¼šè¯æ–¹å¼ï¼Œä½†ä¸¤è€…æœ‰æ‰€åŒºåˆ«ï¼š</p><p>â€‹Cookie æ•°æ®ä¿å­˜åœ¨å®¢æˆ·ç«¯(æµè§ˆå™¨ç«¯)ï¼ŒSession æ•°æ®ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯ã€‚</p><p>â€‹cookieä¸æ˜¯å¾ˆå®‰å…¨ï¼Œåˆ«äººå¯ä»¥åˆ†æå­˜æ”¾åœ¨æœ¬åœ°çš„COOKIEå¹¶è¿›è¡Œæ¬ºéª—,è€ƒè™‘åˆ°å®‰å…¨åº”å½“ä½¿ç”¨sessionã€‚</p><p>â€‹Cookie â¼€èˆ¬â½¤æ¥ä¿å­˜â½¤æˆ·ä¿¡æ¯ï¼ŒSession çš„ä¸»è¦ä½œâ½¤å°±æ˜¯é€šè¿‡æœåŠ¡ç«¯è®°å½•â½¤æˆ·çš„çŠ¶æ€</p><h3 id="æµè§ˆå™¨è¾“å…¥URLè¿‡ç¨‹"><a href="#æµè§ˆå™¨è¾“å…¥URLè¿‡ç¨‹" class="headerlink" title="æµè§ˆå™¨è¾“å…¥URLè¿‡ç¨‹"></a><strong>æµè§ˆå™¨è¾“å…¥URLè¿‡ç¨‹</strong></h3><p>â€‹<strong>è¿‡ç¨‹ï¼š</strong>DNSè§£æã€TCPè¿æ¥ã€å‘é€HTTPè¯·æ±‚ã€æœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶è¿”å›HTTPæŠ¥æ–‡ã€æµè§ˆå™¨æ¸²æŸ“ã€ç»“æŸ</p><table><thead><tr><th>è¿‡ç¨‹</th><th>ä½¿ç”¨çš„åè®®</th></tr></thead><tbody><tr><td>1ã€æµè§ˆå™¨æŸ¥æ‰¾åŸŸåDNSçš„IPåœ°å€<br />DNSæŸ¥æ‰¾è¿‡ç¨‹ï¼ˆæµè§ˆå™¨ç¼“å­˜ã€è·¯ç”±å™¨ç¼“å­˜ã€DNSç¼“å­˜ï¼‰</td><td>DNSï¼šè·å–åŸŸåå¯¹åº”çš„ip</td></tr><tr><td>2ã€æ ¹æ®ipå»ºç«‹TCPè¿æ¥</td><td>TCPï¼šä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥</td></tr><tr><td>3ã€æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€HTTPè¯·æ±‚</td><td>HTTPï¼šå‘é€è¯·æ±‚</td></tr><tr><td>4ã€æœåŠ¡å™¨å“åº”HTTPå“åº”</td><td>HTTP</td></tr><tr><td>5ã€æµè§ˆå™¨è¿›è¡Œæ¸²æŸ“</td><td></td></tr></tbody></table><h2 id="æ“ä½œç³»ç»ŸåŸºç¡€"><a href="#æ“ä½œç³»ç»ŸåŸºç¡€" class="headerlink" title="æ“ä½œç³»ç»ŸåŸºç¡€"></a><strong>æ“ä½œç³»ç»ŸåŸºç¡€</strong></h2><h3 id="è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«"><a href="#è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«" class="headerlink" title="è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«"></a><strong>è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«</strong></h3><p>â€‹<strong>è¿›ç¨‹ï¼š</strong>æ˜¯èµ„æºåˆ†é…çš„æœ€å°å•ä½ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œå¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„å †å’Œæ–¹æ³•åŒºèµ„æºï¼Œä¸å…±äº«æ ˆã€ç¨‹åºè®¡æ•°å™¨</p><p>â€‹<strong>çº¿ç¨‹ï¼š</strong>æ˜¯ä»»åŠ¡è°ƒåº¦å’Œæ‰§è¡Œçš„æœ€å°å•ä½ï¼Œçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œå­˜åœ¨èµ„æºç«äº‰å’Œä¸Šä¸‹æ–‡åˆ‡æ¢çš„é—®é¢˜</p><p>â€‹<strong>åç¨‹ï¼š</strong>æ˜¯ä¸€ç§æ¯”çº¿ç¨‹æ›´åŠ è½»é‡çº§çš„å­˜åœ¨ï¼Œæ­£å¦‚ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æ‹¥æœ‰å¤šä¸ªçº¿ç¨‹ä¸€æ ·ï¼Œä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‹¥æœ‰å¤šä¸ªåç¨‹ã€‚</p><h4 id="1ã€è¿›ç¨‹é—´é€šä¿¡æ–¹å¼IPC"><a href="#1ã€è¿›ç¨‹é—´é€šä¿¡æ–¹å¼IPC" class="headerlink" title="1ã€è¿›ç¨‹é—´é€šä¿¡æ–¹å¼IPC"></a><strong>1ã€è¿›ç¨‹é—´é€šä¿¡æ–¹å¼IPC</strong></h4><p><strong>ç®¡é“pipeï¼š</strong></p><p>â€‹äº²ç¼˜å…³ç³»ä½¿ç”¨åŒ¿åç®¡é“ï¼Œéäº²ç¼˜å…³ç³»ä½¿ç”¨å‘½åç®¡é“ï¼Œç®¡é“éµå¾ªFIFOï¼ŒåŠåŒå·¥ï¼Œæ•°æ®åªèƒ½å•å‘é€šä¿¡ï¼›</p><p><strong>ä¿¡å·ï¼š</strong></p><p>â€‹ä¿¡å·æ˜¯ä¸€ç§æ¯”è¾ƒå¤æ‚çš„é€šä¿¡æ–¹å¼ï¼Œç”¨æˆ·è°ƒç”¨killå‘½ä»¤å°†ä¿¡å·å‘é€ç»™å…¶ä»–è¿›ç¨‹ã€‚</p><p><strong>æ¶ˆæ¯é˜Ÿåˆ—ï¼š</strong></p><p>â€‹æ¶ˆæ¯é˜Ÿåˆ—å…‹æœäº†ä¿¡å·ä¼ é€’ä¿¡æ¯å°‘ï¼Œç®¡é“åªèƒ½æ‰¿è½½æ— æ ¼å¼å­—èŠ‚æµä»¥åŠç¼“å†²åŒºå¤§å°å—é™ç­‰ç‰¹ç‚¹ã€‚</p><p><strong>å…±äº«å†…å­˜(share memory)ï¼š</strong></p><ul><li>ä½¿å¾—å¤šä¸ªè¿›ç¨‹å¯ä»¥å¯ä»¥ç›´æ¥è¯»å†™åŒä¸€å—å†…å­˜ç©ºé—´ï¼Œæ˜¯æœ€å¿«çš„å¯ç”¨IPCå½¢å¼ã€‚æ˜¯é’ˆå¯¹å…¶ä»–é€šä¿¡æœºåˆ¶è¿è¡Œæ•ˆç‡è¾ƒä½è€Œè®¾è®¡çš„ã€‚</li><li>ç”±äºå¤šä¸ªè¿›ç¨‹å…±äº«ä¸€æ®µå†…å­˜ï¼Œå› æ­¤éœ€è¦ä¾é æŸç§åŒæ­¥æœºåˆ¶ï¼ˆå¦‚ä¿¡å·é‡ï¼‰æ¥è¾¾åˆ°è¿›ç¨‹é—´çš„åŒæ­¥åŠäº’æ–¥ã€‚</li></ul><p><strong>ä¿¡å·é‡(Semaphores) ï¼š</strong></p><p>â€‹ä¿¡å·é‡æ˜¯â¼€ä¸ªè®¡æ•°å™¨ï¼Œâ½¤äºå¤šè¿›ç¨‹å¯¹å…±äº«æ•°æ®çš„è®¿é—®ï¼Œè¿™ç§é€šä¿¡â½…å¼ä¸»è¦â½¤äºè§£å†³ä¸åŒæ­¥ç›¸å…³çš„é—®é¢˜å¹¶é¿å…ç«äº‰æ¡ä»¶ã€‚</p><p><strong>å¥—æ¥å­—(Sockets) :</strong> </p><p>â€‹ç®€å•çš„è¯´å°±æ˜¯é€šä¿¡çš„ä¸¤â½…çš„â¼€ç§çº¦å®šï¼Œâ½¤å¥—æ¥å­—ä¸­çš„ç›¸å…³å‡½æ•°æ¥å®Œæˆé€šä¿¡è¿‡ç¨‹ã€‚</p><h4 id="2ã€ç”¨æˆ·æ€å’Œæ ¸å¿ƒæ€"><a href="#2ã€ç”¨æˆ·æ€å’Œæ ¸å¿ƒæ€" class="headerlink" title="2ã€ç”¨æˆ·æ€å’Œæ ¸å¿ƒæ€"></a><strong>2ã€ç”¨æˆ·æ€å’Œæ ¸å¿ƒæ€</strong></h4><p><strong>ç”¨æˆ·æ€ï¼š</strong>åªèƒ½å—é™çš„è®¿é—®å†…å­˜ï¼Œè¿è¡Œæ‰€æœ‰çš„åº”ç”¨ç¨‹åº</p><p><strong>æ ¸å¿ƒæ€ï¼š</strong>è¿è¡Œæ“ä½œç³»ç»Ÿç¨‹åºï¼Œcpuå¯ä»¥è®¿é—®å†…å­˜çš„æ‰€æœ‰æ•°æ®ï¼ŒåŒ…æ‹¬å¤–å›´è®¾å¤‡</p><p><strong>ä¸ºä»€ä¹ˆè¦æœ‰ç”¨æˆ·æ€å’Œå†…æ ¸æ€ï¼š</strong></p><p>â€‹ç”±äºéœ€è¦é™åˆ¶ä¸åŒçš„ç¨‹åºä¹‹é—´çš„è®¿é—®èƒ½åŠ›, é˜²æ­¢ä»–ä»¬è·å–åˆ«çš„ç¨‹åºçš„å†…å­˜æ•°æ®, æˆ–è€…è·å–å¤–å›´è®¾å¤‡çš„æ•°æ®, å¹¶å‘é€åˆ°ç½‘ç»œ</p><p><strong>ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€çš„3ç§æ–¹å¼ï¼š</strong></p><p>â€‹<strong>a. ç³»ç»Ÿè°ƒç”¨</strong></p><p>â€‹ä¸»åŠ¨è°ƒç”¨ï¼Œç³»ç»Ÿè°ƒç”¨çš„æœºåˆ¶å…¶æ ¸å¿ƒè¿˜æ˜¯ä½¿ç”¨äº†æ“ä½œç³»ç»Ÿä¸ºç”¨æˆ·ç‰¹åˆ«å¼€æ”¾çš„ä¸€ä¸ªä¸­æ–­æ¥å®ç°ï¼Œä¾‹å¦‚Linuxçš„int 80hä¸­æ–­ã€‚</p><p>â€‹<strong>b. å¼‚å¸¸</strong></p><p>â€‹å½“CPUåœ¨æ‰§è¡Œè¿è¡Œåœ¨ç”¨æˆ·æ€ä¸‹çš„ç¨‹åºæ—¶ï¼Œå‘ç”Ÿäº†æŸäº›äº‹å…ˆä¸å¯çŸ¥çš„å¼‚å¸¸ï¼Œæ¯”å¦‚ç¼ºé¡µå¼‚å¸¸ï¼Œè¿™æ—¶ä¼šè§¦å‘åˆ‡æ¢å†…æ ¸æ€å¤„ç†å¼‚å¸¸ã€‚</p><p>â€‹<strong>c. å¤–å›´è®¾å¤‡çš„ä¸­æ–­</strong></p><p>â€‹å½“å¤–å›´è®¾å¤‡å®Œæˆç”¨æˆ·è¯·æ±‚çš„æ“ä½œåï¼Œä¼šå‘CPUå‘å‡ºç›¸åº”çš„ä¸­æ–­ä¿¡å·ï¼Œè¿™æ—¶CPUä¼šç”±ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„åˆ‡æ¢ã€‚</p><h4 id="3ã€æ“ä½œç³»ç»Ÿçš„è¿›ç¨‹ç©ºé—´"><a href="#3ã€æ“ä½œç³»ç»Ÿçš„è¿›ç¨‹ç©ºé—´" class="headerlink" title="3ã€æ“ä½œç³»ç»Ÿçš„è¿›ç¨‹ç©ºé—´"></a><strong>3ã€æ“ä½œç³»ç»Ÿçš„è¿›ç¨‹ç©ºé—´</strong></h4><p>â€‹æ ˆåŒºï¼ˆstackï¼‰â€” ç”±ç¼–è¯‘å™¨è‡ªåŠ¨åˆ†é…é‡Šæ”¾ ï¼Œå­˜æ”¾å‡½æ•°çš„å‚æ•°å€¼ï¼Œå±€éƒ¨å˜é‡çš„å€¼ç­‰ã€‚</p><p>â€‹å †åŒºï¼ˆheapï¼‰â€” ä¸€èˆ¬ç”±ç¨‹åºå‘˜åˆ†é…é‡Šæ”¾ï¼Œ è‹¥ç¨‹åºå‘˜ä¸é‡Šæ”¾ï¼Œç¨‹åºç»“æŸæ—¶å¯èƒ½ç”±OSå›æ”¶ ã€‚</p><p>â€‹é™æ€åŒºï¼ˆstaticï¼‰â€”å­˜æ”¾å…¨å±€å˜é‡å’Œé™æ€å˜é‡çš„å­˜å‚¨</p><p>â€‹ä»£ç åŒº(text)â€”å­˜æ”¾å‡½æ•°ä½“çš„äºŒè¿›åˆ¶ä»£ç ã€‚</p><p>â€‹<strong>çº¿ç¨‹å…±äº«å †åŒºã€é™æ€åŒº</strong></p><h3 id="æ“ä½œç³»ç»Ÿå†…å­˜ç®¡ç†"><a href="#æ“ä½œç³»ç»Ÿå†…å­˜ç®¡ç†" class="headerlink" title="æ“ä½œç³»ç»Ÿå†…å­˜ç®¡ç†"></a>æ“ä½œç³»ç»Ÿå†…å­˜ç®¡ç†</h3><p><strong>å­˜ç®¡ç†æ–¹å¼ï¼š</strong>é¡µå¼ç®¡ç†ã€æ®µå¼ç®¡ç†ã€æ®µé¡µå¼ç®¡ç†</p><p><strong>åˆ†æ®µç®¡ç†ï¼š</strong></p><p>â€‹å°†ç¨‹åºçš„åœ°å€ç©ºé—´åˆ’åˆ†ä¸ºè‹¥å¹²æ®µï¼ˆsegmentï¼‰ï¼Œå¦‚ä»£ç æ®µï¼Œæ•°æ®æ®µï¼Œå †æ ˆæ®µï¼›è¿™æ ·æ¯ä¸ªè¿›ç¨‹æœ‰ä¸€ä¸ªäºŒç»´åœ°å€ç©ºé—´ï¼Œç›¸äº’ç‹¬ç«‹ï¼Œäº’ä¸å¹²æ‰°ã€‚æ®µå¼ç®¡ç†çš„ä¼˜ç‚¹æ˜¯ï¼šæ²¡æœ‰å†…ç¢ç‰‡ï¼ˆå› ä¸ºæ®µå¤§å°å¯å˜ï¼Œæ”¹å˜æ®µå¤§å°æ¥æ¶ˆé™¤å†…ç¢ç‰‡ï¼‰ã€‚ä½†æ®µæ¢å…¥æ¢å‡ºæ—¶ï¼Œä¼šäº§ç”Ÿå¤–ç¢ç‰‡ï¼ˆæ¯”å¦‚4kçš„æ®µæ¢5kçš„æ®µï¼Œä¼šäº§ç”Ÿ1kçš„å¤–ç¢ç‰‡ï¼‰</p><p><strong>åˆ†é¡µç®¡ç†ï¼š</strong></p><p>â€‹åœ¨é¡µå¼å­˜å‚¨ç®¡ç†ä¸­ï¼Œå°†ç¨‹åºçš„é€»è¾‘åœ°å€åˆ’åˆ†ä¸ºå›ºå®šå¤§å°çš„é¡µï¼ˆpageï¼‰ï¼Œè€Œç‰©ç†å†…å­˜åˆ’åˆ†ä¸ºåŒæ ·å¤§å°çš„é¡µæ¡†ï¼Œç¨‹åºåŠ è½½æ—¶ï¼Œå¯ä»¥å°†ä»»æ„ä¸€é¡µæ”¾å…¥å†…å­˜ä¸­ä»»æ„ä¸€ä¸ªé¡µæ¡†ï¼Œè¿™äº›é¡µæ¡†ä¸å¿…è¿ç»­ï¼Œä»è€Œå®ç°äº†ç¦»æ•£åˆ†ç¦»ã€‚é¡µå¼å­˜å‚¨ç®¡ç†çš„ä¼˜ç‚¹æ˜¯ï¼šæ²¡æœ‰å¤–ç¢ç‰‡ï¼ˆå› ä¸ºé¡µçš„å¤§å°å›ºå®šï¼‰ï¼Œä½†ä¼šäº§ç”Ÿå†…ç¢ç‰‡ï¼ˆä¸€ä¸ªé¡µå¯èƒ½å¡«å……ä¸æ»¡ï¼‰</p><p><strong>æ®µé¡µå¼ç®¡ç†ï¼š</strong></p><p>â€‹æ®µâ»šå¼ç®¡ç†æœºåˆ¶ç»“åˆäº†æ®µå¼ç®¡ç†å’Œâ»šå¼ç®¡ç†çš„ä¼˜ç‚¹ã€‚ç®€å•æ¥è¯´æ®µâ»šå¼ç®¡ç†æœºåˆ¶å°±æ˜¯æŠŠä¸»å­˜å…ˆåˆ†æˆè‹¥â¼²æ®µï¼Œæ¯ä¸ªæ®µâ¼œåˆ†æˆè‹¥â¼²â»šï¼Œä¹Ÿå°±æ˜¯è¯´ æ®µâ»šå¼ç®¡ç†æœºåˆ¶ ä¸­æ®µä¸æ®µä¹‹é—´ä»¥åŠæ®µçš„å†…éƒ¨çš„éƒ½æ˜¯ç¦»æ•£çš„</p><h4 id="1ã€é¡µé¢ç½®æ¢ç®—æ³•FIFOã€LRU"><a href="#1ã€é¡µé¢ç½®æ¢ç®—æ³•FIFOã€LRU" class="headerlink" title="1ã€é¡µé¢ç½®æ¢ç®—æ³•FIFOã€LRU"></a><strong>1ã€é¡µé¢ç½®æ¢ç®—æ³•FIFOã€LRU</strong></h4><p><strong>ç½®æ¢ç®—æ³•ï¼š</strong>å…ˆè¿›å…ˆå‡ºFIFOã€æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨LRUã€æœ€ä½³ç½®æ¢ç®—æ³•OPT</p><p><strong>å…ˆè¿›å…ˆå‡ºFIFO:</strong></p><p>â€‹ç¼ºç‚¹ï¼šæ²¡æœ‰è€ƒè™‘åˆ°å®é™…çš„é¡µé¢ä½¿ç”¨é¢‘ç‡ï¼Œæ€§èƒ½å·®ã€ä¸é€šå¸¸é¡µé¢ä½¿ç”¨çš„è§„åˆ™ä¸ç¬¦åˆï¼Œå®é™…åº”ç”¨è¾ƒå°‘</p><p><strong>æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨LRU:</strong></p><p>â€‹åŸç†ï¼šé€‰æ‹©æœ€è¿‘ä¸”æœ€ä¹…æœªä½¿ç”¨çš„é¡µé¢è¿›è¡Œæ·˜æ±°</p><p>â€‹ä¼˜ç‚¹ï¼šè€ƒè™‘åˆ°äº†ç¨‹åºè®¿é—®çš„æ—¶é—´å±€éƒ¨æ€§ï¼Œæœ‰è¾ƒå¥½çš„æ€§èƒ½ï¼Œå®é™…åº”ç”¨ä¹Ÿæ¯”è¾ƒå¤š</p><p>â€‹ç¼ºç‚¹ï¼šæ²¡æœ‰åˆé€‚çš„ç®—æ³•ï¼Œåªæœ‰é€‚åˆçš„ç®—æ³•ï¼ŒlFUã€randoméƒ½å¯ä»¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: Java</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: LRUæœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ç½®æ¢ç®—æ³•ï¼Œé€šè¿‡LinkedHashMapå®ç°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Li</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2020-07-17 10:29</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LRUCache</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> LinkedHashMap&lt;Integer,Integer&gt; cache;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> capacity;   <span class="comment">//å®¹é‡å¤§å°</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *åˆå§‹åŒ–æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> capacity</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LRUCache</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        cache = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;(capacity);</span><br><span class="line">        <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">        <span class="comment">//ç¼“å­˜ä¸­ä¸å­˜åœ¨æ­¤keyï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span>(!cache.containsKey(key)) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> cache.get(key);</span><br><span class="line">        cache.remove(key);   <span class="comment">//å…ˆä»é“¾è¡¨ä¸­åˆ é™¤</span></span><br><span class="line">        cache.put(key,res);  <span class="comment">//å†æŠŠè¯¥èŠ‚ç‚¹æ”¾åˆ°é“¾è¡¨æœ«å°¾å¤„</span></span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(<span class="type">int</span> key,<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(cache.containsKey(key)) &#123;</span><br><span class="line">            cache.remove(key); <span class="comment">//å·²ç»å­˜åœ¨ï¼Œåœ¨å½“å‰é“¾è¡¨ç§»é™¤</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(capacity == cache.size()) &#123;</span><br><span class="line">            <span class="comment">//cacheå·²æ»¡ï¼Œåˆ é™¤é“¾è¡¨å¤´ä½ç½®</span></span><br><span class="line">            Set&lt;Integer&gt; keySet = cache.keySet();</span><br><span class="line">            Iterator&lt;Integer&gt; iterator = keySet.iterator();</span><br><span class="line">            cache.remove(iterator.next());</span><br><span class="line">        &#125;</span><br><span class="line">        cache.put(key,value);  <span class="comment">//æ’å…¥åˆ°é“¾è¡¨æœ«å°¾</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: Java</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: LRUæœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ç½®æ¢ç®—æ³•ï¼Œé€šè¿‡LinkedHashMapå†…éƒ¨removeEldestEntryæ–¹æ³•å®ç°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Li</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2020-07-17 10:59</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LRUCache</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;Integer, Integer&gt; map;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> capacity;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *åˆå§‹åŒ–æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> capacity</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LRUCache</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">        map = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;Integer, Integer&gt;(capacity, <span class="number">0.75f</span>, <span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">removeEldestEntry</span><span class="params">(Map.Entry eldest)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> size() &gt; capacity;  <span class="comment">// å®¹é‡å¤§äºcapacity æ—¶å°±åˆ é™¤</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">        <span class="comment">//è¿”å›keyå¯¹åº”çš„valueå€¼ï¼Œè‹¥ä¸å­˜åœ¨ï¼Œè¿”å›-1</span></span><br><span class="line">        <span class="keyword">return</span> map.getOrDefault(key, -<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(<span class="type">int</span> key, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">        map.put(key, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æœ€ä½³ç½®æ¢ç®—æ³•OPT:</strong></p><p>â€‹åŸç†ï¼šæ¯æ¬¡é€‰æ‹©å½“å‰ç‰©ç†å—ä¸­çš„é¡µé¢åœ¨æœªæ¥é•¿æ—¶é—´ä¸è¢«è®¿é—®çš„æˆ–æœªæ¥ä¸å†ä½¿ç”¨çš„é¡µé¢è¿›è¡Œæ·˜æ±°</p><p>â€‹ä¼˜ç‚¹ï¼šå…·æœ‰è¾ƒå¥½çš„æ€§èƒ½ï¼Œå¯ä»¥ä¿è¯è·å¾—æœ€ä½çš„ç¼ºé¡µç‡</p><p>â€‹ç¼ºç‚¹ï¼šè¿‡äºç†æƒ³åŒ–ï¼Œä½†æ˜¯å®é™…ä¸Šæ— æ³•å®ç°ï¼ˆæ²¡åŠæ³•é¢„çŸ¥æœªæ¥çš„é¡µé¢ï¼‰</p><h4 id="2ã€æ­»é”æ¡ä»¶ã€è§£å†³æ–¹å¼ã€‚"><a href="#2ã€æ­»é”æ¡ä»¶ã€è§£å†³æ–¹å¼ã€‚" class="headerlink" title="2ã€æ­»é”æ¡ä»¶ã€è§£å†³æ–¹å¼ã€‚"></a><strong>2ã€æ­»é”æ¡ä»¶ã€è§£å†³æ–¹å¼ã€‚</strong></h4><p>â€‹æ­»é”æ˜¯æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šè¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå› äº‰å¤ºèµ„æºè€Œé€ æˆçš„ä¸‹ç›¸äº’ç­‰å¾…çš„ç°è±¡ï¼›</p><p>â€‹<strong>æ­»é”çš„æ¡ä»¶ï¼š</strong></p><p>â€‹äº’æ–¥æ¡ä»¶ï¼šè¿›ç¨‹å¯¹æ‰€åˆ†é…åˆ°çš„èµ„æºä¸å…è®¸å…¶ä»–è¿›ç¨‹è®¿é—®ï¼Œè‹¥å…¶ä»–è¿›ç¨‹è®¿é—®è¯¥èµ„æºï¼Œåªèƒ½ç­‰å¾…è‡³å æœ‰è¯¥èµ„æºçš„è¿›ç¨‹é‡Šæ”¾è¯¥èµ„æºï¼›</p><p>â€‹è¯·æ±‚ä¸ä¿æŒæ¡ä»¶ï¼šè¿›ç¨‹è·å¾—ä¸€å®šçš„èµ„æºåï¼Œåˆå¯¹å…¶ä»–èµ„æºå‘å‡ºè¯·æ±‚ï¼Œé˜»å¡è¿‡ç¨‹ä¸­ä¸ä¼šé‡Šæ”¾è‡ªå·±å·²ç»å æœ‰çš„èµ„æº</p><p>â€‹éå‰¥å¤ºæ¡ä»¶ï¼šè¿›ç¨‹å·²è·å¾—çš„èµ„æºï¼Œåœ¨æœªå®Œæˆä½¿ç”¨ä¹‹å‰ï¼Œä¸å¯è¢«å‰¥å¤ºï¼Œåªèƒ½åœ¨ä½¿ç”¨åè‡ªå·±é‡Šæ”¾</p><p>â€‹å¾ªç¯ç­‰å¾…æ¡ä»¶ï¼šç³»ç»Ÿä¸­è‹¥å¹²è¿›ç¨‹ç»„æˆç¯è·¯ï¼Œç¯è·¯ä¸­æ¯ä¸ªè¿›ç¨‹éƒ½åœ¨ç­‰å¾…ç›¸é‚»è¿›ç¨‹å ç”¨çš„èµ„æº</p><p>â€‹<strong>è§£å†³æ–¹æ³•ï¼š</strong>ç ´åæ­»é”çš„ä»»æ„ä¸€æ¡ä»¶</p><p>â€‹ä¹è§‚é”ï¼Œç ´åèµ„æºäº’æ–¥æ¡ä»¶ï¼Œ<strong>CAS</strong></p><p>â€‹èµ„æºä¸€æ¬¡æ€§åˆ†é…ï¼Œä»è€Œå‰¥å¤ºè¯·æ±‚å’Œä¿æŒæ¡ä»¶ã€<strong>tryLock</strong></p><p>â€‹å¯å‰¥å¤ºèµ„æºï¼šå³å½“è¿›ç¨‹æ–°çš„èµ„æºæœªå¾—åˆ°æ»¡è¶³æ—¶ï¼Œé‡Šæ”¾å·²å æœ‰çš„èµ„æºï¼Œä»è€Œç ´åä¸å¯å‰¥å¤ºçš„æ¡ä»¶ï¼Œ<strong>æ•°æ®åº“deadlockè¶…æ—¶</strong></p><p>â€‹èµ„æºæœ‰åºåˆ†é…æ³•ï¼šç³»ç»Ÿç»™æ¯ç±»èµ„æºèµ‹äºˆä¸€ä¸ªåºå·ï¼Œæ¯ä¸ªè¿›ç¨‹æŒ‰ç¼–å·é€’å¢çš„è¯·æ±‚èµ„æºï¼Œä»è€Œç ´åç¯è·¯ç­‰å¾…çš„æ¡ä»¶ï¼Œ<strong>è½¬è´¦åœºæ™¯</strong></p><h2 id="JavaåŸºç¡€"><a href="#JavaåŸºç¡€" class="headerlink" title="JavaåŸºç¡€"></a><strong>JavaåŸºç¡€</strong></h2><h3 id="é¢å‘å¯¹è±¡ä¸‰å¤§ç‰¹æ€§"><a href="#é¢å‘å¯¹è±¡ä¸‰å¤§ç‰¹æ€§" class="headerlink" title="é¢å‘å¯¹è±¡ä¸‰å¤§ç‰¹æ€§"></a>é¢å‘å¯¹è±¡ä¸‰å¤§ç‰¹æ€§</h3><p><strong>ç‰¹æ€§ï¼š</strong>å°è£…ã€ç»§æ‰¿ã€å¤šæ€</p><p>â€‹<strong>å°è£…ï¼š</strong>å¯¹æŠ½è±¡çš„äº‹ç‰©æŠ½è±¡åŒ–æˆä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶å¯¹å…¶å¯¹è±¡çš„å±æ€§ç§æœ‰åŒ–ï¼ŒåŒæ—¶æä¾›ä¸€äº›èƒ½è¢«å¤–ç•Œè®¿é—®å±æ€§çš„æ–¹æ³•ï¼›</p><p>â€‹<strong>ç»§æ‰¿</strong>ï¼šå­ç±»æ‰©å±•æ–°çš„æ•°æ®åŸŸæˆ–åŠŸèƒ½ï¼Œå¹¶å¤ç”¨çˆ¶ç±»çš„å±æ€§ä¸åŠŸèƒ½ï¼Œå•ç»§æ‰¿ï¼Œå¤šå®ç°ï¼›</p><p>â€‹<strong>å¤šæ€ï¼š</strong>é€šè¿‡ç»§æ‰¿ï¼ˆå¤šä¸ªâ¼¦ç±»å¯¹åŒâ¼€â½…æ³•çš„é‡å†™ï¼‰ã€ä¹Ÿå¯ä»¥é€šè¿‡æ¥â¼ï¼ˆå®ç°æ¥â¼å¹¶è¦†ç›–æ¥â¼ï¼‰</p><h4 id="1ã€Javaä¸C-åŒºåˆ«"><a href="#1ã€Javaä¸C-åŒºåˆ«" class="headerlink" title="1ã€Javaä¸C++åŒºåˆ«"></a><strong>1ã€Javaä¸C++åŒºåˆ«</strong></h4><p>â€‹ä¸åŒç‚¹ï¼šc++æ”¯æŒå¤šç»§æ‰¿ï¼Œå¹¶ä¸”æœ‰æŒ‡é’ˆçš„æ¦‚å¿µï¼Œç”±ç¨‹åºå‘˜è‡ªå·±ç®¡ç†å†…å­˜ï¼›Javaæ˜¯å•ç»§æ‰¿ï¼Œå¯ä»¥ç”¨æ¥å£å®ç°å¤šç»§æ‰¿ï¼ŒJava ä¸æä¾›æŒ‡é’ˆæ¥ç›´æ¥è®¿é—®å†…å­˜ï¼Œç¨‹åºå†…å­˜æ›´åŠ å®‰å…¨ï¼Œå¹¶ä¸”Javaæœ‰JVMâ¾ƒåŠ¨å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œä¸éœ€è¦ç¨‹åºå‘˜â¼¿åŠ¨é‡Šæ”¾â½†â½¤å†…å­˜</p><h4 id="2ã€å¤šæ€å®ç°åŸç†"><a href="#2ã€å¤šæ€å®ç°åŸç†" class="headerlink" title="2ã€å¤šæ€å®ç°åŸç†"></a><strong>2ã€å¤šæ€å®ç°åŸç†</strong></h4><p>å¤šæ€çš„åº•å±‚å®ç°æ˜¯åŠ¨æ€ç»‘å®šï¼Œå³åœ¨è¿è¡Œæ—¶æ‰æŠŠæ–¹æ³•è°ƒç”¨ä¸æ–¹æ³•å®ç°å…³è”èµ·æ¥ã€‚</p><p><strong>é™æ€ç»‘å®šä¸åŠ¨æ€ç»‘å®šï¼š</strong></p><p>â€‹ä¸€ç§æ˜¯åœ¨ç¼–è¯‘æœŸç¡®å®šï¼Œè¢«ç§°ä¸ºé™æ€åˆ†æ´¾ï¼Œæ¯”å¦‚æ–¹æ³•çš„é‡è½½ï¼›</p><p>â€‹    ä¸€ç§æ˜¯åœ¨è¿è¡Œæ—¶ç¡®å®šï¼Œè¢«ç§°ä¸ºåŠ¨æ€åˆ†æ´¾ï¼Œæ¯”å¦‚æ–¹æ³•çš„è¦†ç›–ï¼ˆé‡å†™ï¼‰å’Œæ¥å£çš„å®ç°ã€‚</p><p><strong>å¤šæ€çš„å®ç°</strong></p><p>â€‹è™šæ‹Ÿæœºæ ˆä¸­ä¼šå­˜æ”¾å½“å‰æ–¹æ³•è°ƒç”¨çš„æ ˆå¸§ï¼ˆå±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ ˆã€åŠ¨æ€è¿æ¥ ã€è¿”å›åœ°å€ï¼‰ã€‚å¤šæ€çš„å®ç°è¿‡ç¨‹ï¼Œå°±æ˜¯æ–¹æ³•è°ƒç”¨åŠ¨æ€åˆ†æ´¾çš„è¿‡ç¨‹ï¼Œå¦‚æœå­ç±»è¦†ç›–äº†çˆ¶ç±»çš„æ–¹æ³•ï¼Œåˆ™åœ¨å¤šæ€è°ƒç”¨ä¸­ï¼ŒåŠ¨æ€ç»‘å®šè¿‡ç¨‹ä¼šé¦–å…ˆç¡®å®šå®é™…ç±»å‹æ˜¯å­ç±»ï¼Œä»è€Œå…ˆæœç´¢åˆ°å­ç±»ä¸­çš„æ–¹æ³•ã€‚è¿™ä¸ªè¿‡ç¨‹ä¾¿æ˜¯æ–¹æ³•è¦†ç›–çš„æœ¬è´¨ã€‚</p><h4 id="3ã€staticå’Œfinalå…³é”®å­—"><a href="#3ã€staticå’Œfinalå…³é”®å­—" class="headerlink" title="3ã€staticå’Œfinalå…³é”®å­—"></a>3ã€staticå’Œfinalå…³é”®å­—</h4><p><strong>staticï¼š</strong>å¯ä»¥ä¿®é¥°å±æ€§ã€æ–¹æ³•</p><p>â€‹<strong>staticä¿®é¥°å±æ€§ï¼š</strong></p><p>â€‹ç±»çº§åˆ«å±æ€§ï¼Œæ‰€æœ‰å¯¹è±¡å…±äº«ä¸€ä»½ï¼Œéšç€ç±»çš„åŠ è½½è€ŒåŠ è½½ï¼ˆåªåŠ è½½ä¸€æ¬¡ï¼‰ï¼Œå…ˆäºå¯¹è±¡çš„åˆ›å»ºï¼›å¯ä»¥ä½¿ç”¨ç±»åç›´æ¥è°ƒç”¨ã€‚</p><p>â€‹<strong>staticä¿®é¥°æ–¹æ³•ï¼š</strong></p><p>â€‹éšç€ç±»çš„åŠ è½½è€ŒåŠ è½½ï¼›å¯ä»¥ä½¿ç”¨ç±»åç›´æ¥è°ƒç”¨ï¼›é™æ€æ–¹æ³•ä¸­ï¼Œåªèƒ½è°ƒç”¨é™æ€çš„æˆå‘˜ï¼Œä¸å¯ç”¨thisï¼›</p><p><strong>finalï¼š</strong>å…³é”®å­—ä¸»è¦â½¤åœ¨ä¸‰ä¸ªåœ°â½…ï¼šå˜é‡ã€â½…æ³•ã€ç±»ã€‚</p><p>â€‹<strong>finalä¿®é¥°å˜é‡ï¼š</strong></p><p>â€‹å¦‚æœæ˜¯åŸºæœ¬æ•°æ®ç±»å‹çš„å˜é‡ï¼Œåˆ™å…¶æ•°å€¼â¼€æ—¦åœ¨åˆå§‹åŒ–ä¹‹åä¾¿ä¸èƒ½æ›´æ”¹ï¼›</p><p>â€‹å¦‚æœæ˜¯å¼•â½¤ç±»å‹çš„å˜é‡ï¼Œåˆ™åœ¨å¯¹å…¶åˆå§‹åŒ–ä¹‹åä¾¿ä¸èƒ½å†è®©å…¶æŒ‡å‘å¦â¼€ä¸ªå¯¹è±¡ã€‚</p><p>â€‹<strong>finalä¿®é¥°æ–¹æ³•ï¼š</strong></p><p>â€‹æŠŠâ½…æ³•é”å®šï¼Œä»¥é˜²ä»»ä½•ç»§æ‰¿ç±»ä¿®æ”¹å®ƒçš„å«ä¹‰ï¼ˆé‡å†™ï¼‰ï¼›ç±»ä¸­æ‰€æœ‰çš„ private â½…æ³•éƒ½éšå¼åœ°æŒ‡å®šä¸º finalã€‚</p><p>â€‹<strong>finalä¿®é¥°ç±»ï¼š</strong></p><p>â€‹ final ä¿®é¥°ç±»æ—¶ï¼Œè¡¨æ˜è¿™ä¸ªç±»ä¸èƒ½è¢«ç»§æ‰¿ã€‚final ç±»ä¸­çš„æ‰€æœ‰æˆå‘˜â½…æ³•éƒ½ä¼šè¢«éšå¼åœ°æŒ‡å®šä¸º final â½…æ³•ã€‚</p><p>ä¸€ä¸ªç±»ä¸èƒ½è¢«ç»§æ‰¿ï¼Œé™¤äº†finalå…³é”®å­—ä¹‹å¤–ï¼Œè¿˜æœ‰å¯ä»¥ç§æœ‰åŒ–æ„é€ å™¨ã€‚ï¼ˆå†…éƒ¨ç±»æ— æ•ˆï¼‰</p><h4 id="4ã€æŠ½è±¡ç±»å’Œæ¥å£"><a href="#4ã€æŠ½è±¡ç±»å’Œæ¥å£" class="headerlink" title="4ã€æŠ½è±¡ç±»å’Œæ¥å£"></a>4ã€æŠ½è±¡ç±»å’Œæ¥å£</h4><p><strong>æŠ½è±¡ç±»ï¼š</strong>åŒ…å«æŠ½è±¡æ–¹æ³•çš„ç±»ï¼Œå³ä½¿ç”¨abstractä¿®é¥°çš„ç±»ï¼›æŠ½è±¡ç±»åªèƒ½è¢«ç»§æ‰¿ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨finalä¿®é¥°ï¼ŒæŠ½è±¡ç±»ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œ</p><p><strong>æ¥å£ï¼š</strong>æ¥å£æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»å‹ï¼Œæ˜¯æŠ½è±¡æ–¹æ³•çš„é›†åˆï¼Œæ¥å£æ”¯æŒå¤šç»§æ‰¿ï¼Œæ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œé»˜è®¤æ˜¯public abstractä¿®é¥°çš„æŠ½è±¡æ–¹æ³•</p><p><strong>ç›¸åŒç‚¹ï¼š</strong></p><p>â€‹â‘  æŠ½è±¡ç±»å’Œæ¥å£éƒ½ä¸èƒ½è¢«å®ä¾‹åŒ–</p><p>â€‹â‘¡ æŠ½è±¡ç±»å’Œæ¥å£éƒ½å¯ä»¥å®šä¹‰æŠ½è±¡æ–¹æ³•ï¼Œå­ç±»&#x2F;å®ç°ç±»å¿…é¡»è¦†å†™è¿™äº›æŠ½è±¡æ–¹æ³•</p><p><strong>ä¸åŒç‚¹ï¼š</strong></p><p>â€‹â‘  æŠ½è±¡ç±»æœ‰æ„é€ æ–¹æ³•ï¼Œæ¥å£æ²¡æœ‰æ„é€ æ–¹æ³•</p><p>â€‹â‘¢æŠ½è±¡ç±»å¯ä»¥åŒ…å«æ™®é€šæ–¹æ³•ï¼Œæ¥å£ä¸­åªèƒ½æ˜¯public abstractä¿®é¥°æŠ½è±¡æ–¹æ³•ï¼ˆJava8ä¹‹åå¯ä»¥ï¼‰</p><p>â€‹â‘¢ æŠ½è±¡ç±»åªèƒ½å•ç»§æ‰¿ï¼Œæ¥å£å¯ä»¥å¤šç»§æ‰¿</p><p>â€‹â‘£ æŠ½è±¡ç±»å¯ä»¥å®šä¹‰å„ç§ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œæ¥å£ä¸­åªèƒ½æ˜¯public static finalä¿®é¥°çš„é™æ€å¸¸é‡</p><p><strong>æŠ½è±¡ç±»çš„ä½¿ç”¨åœºæ™¯ï¼š</strong></p><p>â€‹æ—¢æƒ³çº¦æŸå­ç±»å…·æœ‰å…±åŒçš„è¡Œä¸ºï¼ˆä½†ä¸å†ä¹å…¶å¦‚ä½•å®ç°ï¼‰ï¼Œåˆæƒ³æ‹¥æœ‰ç¼ºçœçš„æ–¹æ³•ï¼Œåˆèƒ½æ‹¥æœ‰å®ä¾‹å˜é‡</p><p><strong>æ¥å£çš„åº”ç”¨åœºæ™¯ï¼š</strong></p><p>â€‹çº¦æŸå¤šä¸ªå®ç°ç±»å…·æœ‰ç»Ÿä¸€çš„è¡Œä¸ºï¼Œä½†æ˜¯ä¸åœ¨ä¹æ¯ä¸ªå®ç°ç±»å¦‚ä½•å…·ä½“å®ç°ï¼›å®ç°ç±»ä¸­å„ä¸ªåŠŸèƒ½ä¹‹é—´å¯èƒ½æ²¡æœ‰ä»»ä½•è”ç³»</p><h4 id="5ã€æ³›å‹ä»¥åŠæ³›å‹æ“¦é™¤"><a href="#5ã€æ³›å‹ä»¥åŠæ³›å‹æ“¦é™¤" class="headerlink" title="5ã€æ³›å‹ä»¥åŠæ³›å‹æ“¦é™¤"></a>5ã€æ³›å‹ä»¥åŠæ³›å‹æ“¦é™¤</h4><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/baoyinwang/article/details/107341997">https://blog.csdn.net/baoyinwang/article/details/107341997</a></p><p><strong>æ³›å‹ï¼š</strong></p><p>â€‹æ³›å‹çš„æœ¬è´¨æ˜¯å‚æ•°åŒ–ç±»å‹ã€‚è¿™ç§å‚æ•°ç±»å‹å¯ä»¥ç”¨åœ¨ç±»ã€æ¥å£å’Œæ–¹æ³•çš„åˆ›å»ºä¸­ï¼Œåˆ†åˆ«ç§°ä¸ºæ³›å‹ç±»ã€æ³›å‹æ¥å£å’Œæ³›å‹æ–¹æ³•ã€‚</p><p><strong>æ³›å‹æ“¦é™¤ï¼š</strong></p><p>â€‹Javaçš„æ³›å‹æ˜¯ä¼ªæ³›å‹ï¼Œä½¿ç”¨æ³›å‹çš„æ—¶å€™åŠ ä¸Šç±»å‹å‚æ•°ï¼Œåœ¨ç¼–è¯‘å™¨ç¼–è¯‘ç”Ÿæˆçš„å­—èŠ‚ç çš„æ—¶å€™ä¼šå»æ‰ï¼Œè¿™ä¸ªè¿‡ç¨‹æˆä¸ºç±»å‹æ“¦é™¤ã€‚</p><p>â€‹å¦‚List<String>ç­‰ç±»å‹ï¼Œåœ¨ç¼–è¯‘ä¹‹åéƒ½ä¼šå˜æˆ Listã€‚JVM çœ‹åˆ°çš„åªæ˜¯ Listï¼Œè€Œç”±æ³›å‹é™„åŠ çš„ç±»å‹ä¿¡æ¯å¯¹ JVM æ¥è¯´æ˜¯ä¸å¯è§çš„ã€‚</p><p>å¯ä»¥é€šè¿‡åå°„æ·»åŠ å…¶å®ƒç±»å‹å…ƒç´ </p><h4 id="6ã€åå°„åŸç†ä»¥åŠä½¿ç”¨åœºæ™¯"><a href="#6ã€åå°„åŸç†ä»¥åŠä½¿ç”¨åœºæ™¯" class="headerlink" title="6ã€åå°„åŸç†ä»¥åŠä½¿ç”¨åœºæ™¯"></a><strong>6ã€åå°„åŸç†ä»¥åŠä½¿ç”¨åœºæ™¯</strong></h4><p><strong>Javaåå°„ï¼š</strong></p><p>â€‹æ˜¯æŒ‡åœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»éƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»æ‰€æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼›å¹¶ä¸”éƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•ï¼›</p><p><strong>åå°„åŸç†ï¼š</strong></p><p>â€‹åå°„é¦–å…ˆæ˜¯èƒ½å¤Ÿè·å–åˆ°Javaä¸­çš„åå°„ç±»çš„å­—èŠ‚ç ï¼Œç„¶åå°†å­—èŠ‚ç ä¸­çš„æ–¹æ³•ï¼Œå˜é‡ï¼Œæ„é€ å‡½æ•°ç­‰æ˜ å°„æˆ ç›¸åº”çš„ Methodã€Filedã€Constructor ç­‰ç±»</p><p>â€‹<strong>å¦‚ä½•å¾—åˆ°Classçš„å®ä¾‹:</strong></p><pre><code>     1.ç±»å.class(å°±æ˜¯ä¸€ä»½å­—èŠ‚ç )     2.Class.forName(String className);æ ¹æ®ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥æ„å»ºClasså¯¹è±¡     3.æ¯ä¸€ä¸ªå¯¹è±¡å¤šæœ‰getClass()æ–¹æ³•:obj.getClass();è¿”å›å¯¹è±¡çš„çœŸå®ç±»å‹</code></pre><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p><ul><li><p><strong>å¼€å‘é€šç”¨æ¡†æ¶ -</strong> åå°„æœ€é‡è¦çš„ç”¨é€”å°±æ˜¯å¼€å‘å„ç§é€šç”¨æ¡†æ¶ã€‚å¾ˆå¤šæ¡†æ¶ï¼ˆæ¯”å¦‚ Springï¼‰éƒ½æ˜¯é…ç½®åŒ–çš„ï¼ˆæ¯”å¦‚é€šè¿‡ XML æ–‡ä»¶é…ç½® JavaBeanã€Filter ç­‰ï¼‰ï¼Œä¸ºäº†ä¿è¯æ¡†æ¶çš„é€šç”¨æ€§ï¼Œéœ€è¦æ ¹æ®é…ç½®æ–‡ä»¶è¿è¡Œæ—¶åŠ¨æ€åŠ è½½ä¸åŒçš„å¯¹è±¡æˆ–ç±»ï¼Œè°ƒç”¨ä¸åŒçš„æ–¹æ³•ã€‚</p></li><li><p><strong>åŠ¨æ€ä»£ç†</strong> - åœ¨åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰ä¸­ï¼Œéœ€è¦æ‹¦æˆªç‰¹å®šçš„æ–¹æ³•ï¼Œé€šå¸¸ï¼Œä¼šé€‰æ‹©åŠ¨æ€ä»£ç†æ–¹å¼ã€‚è¿™æ—¶ï¼Œå°±éœ€è¦åå°„æŠ€æœ¯æ¥å®ç°äº†ã€‚</p><p>JDKï¼šspringé»˜è®¤åŠ¨æ€ä»£ç†ï¼Œéœ€è¦å®ç°æ¥å£</p><p>CGLIBï¼šé€šè¿‡asmæ¡†æ¶åºåˆ—åŒ–å­—èŠ‚æµï¼Œå¯é…ç½®ï¼Œæ€§èƒ½å·®</p></li><li><p><strong>è‡ªå®šä¹‰æ³¨è§£</strong> - æ³¨è§£æœ¬èº«ä»…ä»…æ˜¯èµ·åˆ°æ ‡è®°ä½œç”¨ï¼Œå®ƒéœ€è¦åˆ©ç”¨åå°„æœºåˆ¶ï¼Œæ ¹æ®æ³¨è§£æ ‡è®°å»è°ƒç”¨æ³¨è§£è§£é‡Šå™¨ï¼Œæ‰§è¡Œè¡Œä¸ºã€‚</p></li></ul><h4 id="7ã€Javaå¼‚å¸¸ä½“ç³»"><a href="#7ã€Javaå¼‚å¸¸ä½“ç³»" class="headerlink" title="7ã€Javaå¼‚å¸¸ä½“ç³»"></a><strong>7ã€Javaå¼‚å¸¸ä½“ç³»</strong></h4><p>â€‹<img src="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=3137389296,1222888772&fm=26&gp=0.jpg" style="zoom:67%;" /></p><p>Throwable æ˜¯ Java è¯­è¨€ä¸­æ‰€æœ‰é”™è¯¯æˆ–å¼‚å¸¸çš„è¶…ç±»ã€‚ä¸‹ä¸€å±‚åˆ†ä¸º Error å’Œ Exception</p><p><strong>Error ï¼š</strong></p><p>â€‹æ˜¯æŒ‡ java è¿è¡Œæ—¶ç³»ç»Ÿçš„å†…éƒ¨é”™è¯¯å’Œèµ„æºè€—å°½é”™è¯¯ã€‚åº”ç”¨ç¨‹åºä¸ä¼šæŠ›å‡ºè¯¥ç±»å¯¹è±¡ã€‚å¦‚æœå‡ºç°äº†è¿™æ ·çš„é”™è¯¯ï¼Œé™¤äº†å‘ŠçŸ¥ç”¨æˆ·ï¼Œå‰©ä¸‹çš„å°±æ˜¯å°½åŠ›ä½¿ç¨‹åºå®‰å…¨çš„ç»ˆæ­¢ã€‚</p><p><strong>Exception åŒ…å«ï¼šRuntimeException ã€CheckedException</strong></p><p>ç¼–ç¨‹é”™è¯¯å¯ä»¥åˆ†æˆä¸‰ç±»ï¼šè¯­æ³•é”™è¯¯ã€é€»è¾‘é”™è¯¯å’Œè¿è¡Œé”™è¯¯ã€‚</p><p><strong>è¯­æ³•é”™è¯¯</strong>ï¼ˆä¹Ÿç§°ç¼–è¯‘é”™è¯¯ï¼‰æ˜¯åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å‡ºç°çš„é”™è¯¯ï¼Œç”±ç¼–è¯‘å™¨æ£€æŸ¥å‘ç°è¯­æ³•é”™è¯¯</p><p><strong>é€»è¾‘é”™è¯¯</strong>æŒ‡ç¨‹åºçš„æ‰§è¡Œç»“æœä¸é¢„æœŸä¸ç¬¦ï¼Œå¯ä»¥é€šè¿‡è°ƒè¯•å®šä½å¹¶å‘ç°é”™è¯¯çš„åŸå› </p><p><strong>è¿è¡Œé”™è¯¯</strong>æ˜¯å¼•èµ·ç¨‹åºéæ­£å¸¸ç»ˆç«¯çš„é”™è¯¯ï¼Œéœ€è¦é€šè¿‡å¼‚å¸¸å¤„ç†çš„æ–¹å¼å¤„ç†è¿è¡Œé”™è¯¯</p><p><strong>RuntimeExceptionï¼š</strong> è¿è¡Œæ—¶å¼‚å¸¸ï¼Œç¨‹åºåº”è¯¥ä»é€»è¾‘è§’åº¦å°½å¯èƒ½é¿å…è¿™ç±»å¼‚å¸¸çš„å‘ç”Ÿã€‚</p><p>â€‹ å¦‚ NullPointerException ã€ ClassCastException ï¼› </p><p><strong>CheckedExceptionï¼š</strong>å—æ£€å¼‚å¸¸ï¼Œç¨‹åºä½¿ç”¨trycatchè¿›è¡Œæ•æ‰å¤„ç†</p><p>â€‹å¦‚IOExceptionã€SQLExceptionã€NotFoundExceptionï¼›</p><h3 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1goe17hajvzj316d0lhju3.jpg" alt="JavaCollection"></p><h4 id="1ã€ArrayListå’ŒLinkedList"><a href="#1ã€ArrayListå’ŒLinkedList" class="headerlink" title="1ã€ArrayListå’ŒLinkedList"></a><strong>1ã€ArrayListå’ŒLinkedList</strong></h4><p><strong>ArrayListï¼š</strong></p><p>â€‹åº•å±‚åŸºäºæ•°ç»„å®ç°ï¼Œæ”¯æŒå¯¹å…ƒç´ è¿›è¡Œå¿«é€Ÿéšæœºè®¿é—®ï¼Œé€‚åˆéšæœºæŸ¥æ‰¾å’Œéå†ï¼Œä¸é€‚åˆæ’å…¥å’Œåˆ é™¤ã€‚ï¼ˆæä¸€å¥å®é™…ä¸Šï¼‰<br>â€‹é»˜è®¤åˆå§‹å¤§å°ä¸º10ï¼Œå½“æ•°ç»„å®¹é‡ä¸å¤Ÿæ—¶ï¼Œä¼šè§¦å‘æ‰©å®¹æœºåˆ¶ï¼ˆæ‰©å¤§åˆ°å½“å‰çš„1.5å€ï¼‰ï¼Œéœ€è¦å°†åŸæ¥æ•°ç»„çš„æ•°æ®å¤åˆ¶åˆ°æ–°çš„æ•°ç»„ä¸­ï¼›å½“ä» ArrayList çš„ä¸­é—´ä½ç½®æ’å…¥æˆ–è€…åˆ é™¤å…ƒç´ æ—¶ï¼Œéœ€è¦å¯¹æ•°ç»„è¿›è¡Œå¤åˆ¶ã€ç§»åŠ¨ã€ä»£ä»·æ¯”è¾ƒé«˜ã€‚</p><p><strong>LinkedListï¼š</strong></p><p>â€‹åº•å±‚åŸºäºåŒå‘é“¾è¡¨å®ç°ï¼Œé€‚åˆæ•°æ®çš„åŠ¨æ€æ’å…¥å’Œåˆ é™¤ï¼›<br>â€‹å†…éƒ¨æä¾›äº† List æ¥å£ä¸­æ²¡æœ‰å®šä¹‰çš„æ–¹æ³•ï¼Œç”¨äºæ“ä½œè¡¨å¤´å’Œè¡¨å°¾å…ƒç´ ï¼Œå¯ä»¥å½“ä½œå †æ ˆã€é˜Ÿåˆ—å’ŒåŒå‘é˜Ÿåˆ—ä½¿ç”¨ã€‚ï¼ˆæ¯”å¦‚jdkå®˜æ–¹æ¨èä½¿ç”¨åŸºäºlinkedListçš„Dequeè¿›è¡Œå †æ ˆæ“ä½œï¼‰</p><p><strong>ArrayListä¸LinkedListåŒºåˆ«ï¼š</strong></p><p>â€‹éƒ½æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼ŒArrayList é€‚ç”¨äºæŸ¥æ‰¾çš„åœºæ™¯ï¼ŒLinkedList é€‚ç”¨äºå¢åŠ ã€åˆ é™¤å¤šçš„åœºæ™¯</p><p><strong>å®ç°çº¿ç¨‹å®‰å…¨ï¼š</strong></p><p>â€‹å¯ä»¥ä½¿ç”¨åŸç”Ÿçš„Vectorï¼Œæˆ–è€…æ˜¯Collections.synchronizedList(List list)å‡½æ•°è¿”å›ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ArrayListé›†åˆã€‚<br>â€‹å»ºè®®ä½¿ç”¨concurrentå¹¶å‘åŒ…ä¸‹çš„<strong>CopyOnWriteArrayList</strong>çš„ã€‚</p><p>â€‹â‘ <strong>Vector:</strong> åº•å±‚é€šè¿‡synchronizeä¿®é¥°ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ•ˆç‡è¾ƒå·®</p><p>â€‹â‘¡<strong>CopyOnWriteArrayListï¼š</strong>å†™æ—¶åŠ é”ï¼Œä½¿ç”¨äº†ä¸€ç§å«<strong>å†™æ—¶å¤åˆ¶</strong>çš„æ–¹æ³•ï¼›è¯»æ“ä½œæ˜¯å¯ä»¥ä¸ç”¨åŠ é”çš„</p><p>â€‹</p><h4 id="2ã€Listéå†å¿«é€Ÿå’Œå®‰å…¨å¤±è´¥"><a href="#2ã€Listéå†å¿«é€Ÿå’Œå®‰å…¨å¤±è´¥" class="headerlink" title="2ã€Listéå†å¿«é€Ÿå’Œå®‰å…¨å¤±è´¥"></a><strong>2ã€Listéå†å¿«é€Ÿå’Œå®‰å…¨å¤±è´¥</strong></h4><p><strong>â‘ æ™®é€šforå¾ªç¯éå†Liståˆ é™¤æŒ‡å®šå…ƒç´ </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i &lt; list.size(); i++)&#123;</span><br><span class="line">   <span class="keyword">if</span>(list.get(i) == <span class="number">5</span>) </span><br><span class="line">       list.remove(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>â‘¡ è¿­ä»£éå†,ç”¨list.remove(i)æ–¹æ³•åˆ é™¤å…ƒç´ </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Iterator&lt;Integer&gt; it = list.iterator();</span><br><span class="line"><span class="keyword">while</span>(it.hasNext())&#123;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">value</span> <span class="operator">=</span> it.next();</span><br><span class="line">    <span class="keyword">if</span>(value == <span class="number">5</span>)&#123;</span><br><span class="line">        list.remove(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>â‘¢foreachéå†Liståˆ é™¤å…ƒç´ </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(Integer i:list)&#123;</span><br><span class="line">    <span class="keyword">if</span>(i==<span class="number">3</span>) list.remove(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>failâ€”fastï¼š</strong>å¿«é€Ÿå¤±è´¥</p><p>â€‹å½“å¼‚å¸¸äº§ç”Ÿæ—¶ï¼Œç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œç¨‹åºç»ˆæ­¢;</p><p>â€‹fail-fastä¸»è¦æ˜¯ä½“ç°åœ¨å½“æˆ‘ä»¬åœ¨éå†é›†åˆå…ƒç´ çš„æ—¶å€™ï¼Œç»å¸¸ä¼šä½¿ç”¨è¿­ä»£å™¨ï¼Œä½†åœ¨è¿­ä»£å™¨éå†å…ƒç´ çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœé›†åˆçš„ç»“æ„ï¼ˆmodCountï¼‰è¢«æ”¹å˜çš„è¯ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ConcurrentModificationExceptionï¼Œé˜²æ­¢ç»§ç»­éå†ã€‚è¿™å°±æ˜¯æ‰€è°“çš„å¿«é€Ÿå¤±è´¥æœºåˆ¶ã€‚</p><p><strong>failâ€”safeï¼š</strong>å®‰å…¨å¤±è´¥</p><p>â€ƒ â€ƒ é‡‡ç”¨å®‰å…¨å¤±è´¥æœºåˆ¶çš„é›†åˆå®¹å™¨ï¼Œåœ¨éå†æ—¶ä¸æ˜¯ç›´æ¥åœ¨é›†åˆå†…å®¹ä¸Šè®¿é—®çš„ï¼Œè€Œæ˜¯å…ˆå¤åˆ¶åŸæœ‰é›†åˆå†…å®¹ï¼Œåœ¨æ‹·è´çš„é›†åˆä¸Šè¿›è¡Œéå†ã€‚ç”±äºåœ¨éå†è¿‡ç¨‹ä¸­å¯¹åŸé›†åˆæ‰€ä½œçš„ä¿®æ”¹å¹¶ä¸èƒ½è¢«è¿­ä»£å™¨æ£€æµ‹åˆ°ï¼Œæ‰€ä»¥ä¸ä¼šè§¦å‘ConcurrentModificationExceptionã€‚</p><p>â€ƒ â€ƒ ç¼ºç‚¹ï¼šåŸºäºæ‹·è´å†…å®¹çš„ä¼˜ç‚¹æ˜¯é¿å…äº†ConcurrentModificationExceptionï¼Œä½†åŒæ ·åœ°ï¼Œè¿­ä»£å™¨å¹¶ä¸èƒ½è®¿é—®åˆ°ä¿®æ”¹åçš„å†…å®¹ï¼Œå³ï¼šè¿­ä»£å™¨éå†çš„æ˜¯å¼€å§‹éå†é‚£ä¸€åˆ»æ‹¿åˆ°çš„é›†åˆæ‹·è´ï¼Œåœ¨éå†æœŸé—´åŸé›†åˆå‘ç”Ÿçš„ä¿®æ”¹è¿­ä»£å™¨æ˜¯ä¸çŸ¥é“çš„ã€‚</p><p>â€ƒ â€ƒ åœºæ™¯ï¼šjava.util.concurrentåŒ…ä¸‹çš„å®¹å™¨éƒ½æ˜¯å®‰å…¨å¤±è´¥ï¼Œå¯ä»¥åœ¨å¤šçº¿ç¨‹ä¸‹å¹¶å‘ä½¿ç”¨ï¼Œå¹¶å‘ä¿®æ”¹ã€‚</p><h4 id="3ã€è¯¦ç»†ä»‹ç»HashMap"><a href="#3ã€è¯¦ç»†ä»‹ç»HashMap" class="headerlink" title="3ã€è¯¦ç»†ä»‹ç»HashMap"></a><strong>3ã€è¯¦ç»†ä»‹ç»HashMap</strong></h4><p>è§’åº¦ï¼šæ•°æ®ç»“æ„+æ‰©å®¹æƒ…å†µ+putæŸ¥æ‰¾çš„è¯¦ç»†è¿‡ç¨‹+å“ˆå¸Œå‡½æ•°+å®¹é‡ä¸ºä»€ä¹ˆå§‹ç»ˆéƒ½æ˜¯2^Nï¼ŒJDK1.7ä¸1.8çš„åŒºåˆ«ã€‚</p><p>å‚è€ƒï¼š<a href="https://www.jianshu.com/p/9fe4cb316c05">https://www.jianshu.com/p/9fe4cb316c05</a></p><p><strong>æ•°æ®ç»“æ„ï¼š</strong></p><p>â€‹HashMapåœ¨åº•å±‚æ•°æ®ç»“æ„ä¸Šé‡‡ç”¨äº†æ•°ç»„ï¼‹é“¾è¡¨ï¼‹çº¢é»‘æ ‘ï¼Œé€šè¿‡æ•£åˆ—æ˜ å°„æ¥å­˜å‚¨é”®å€¼å¯¹æ•°æ®</p><p><strong>æ‰©å®¹æƒ…å†µï¼š</strong></p><p>â€‹é»˜è®¤çš„è´Ÿè½½å› å­æ˜¯0.75ï¼Œå¦‚æœæ•°ç»„ä¸­å·²ç»å­˜å‚¨çš„å…ƒç´ ä¸ªæ•°å¤§äºæ•°ç»„é•¿åº¦çš„75%ï¼Œå°†ä¼šå¼•å‘æ‰©å®¹æ“ä½œã€‚</p><p>â€‹ã€1ã€‘åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸ºåŸæ¥æ•°ç»„é•¿åº¦<strong>ä¸¤å€çš„æ–°æ•°ç»„</strong>ã€‚</p><p>â€‹ã€2ã€‘1.7é‡‡ç”¨Entryçš„é‡æ–°hashè¿ç®—ï¼Œ1.8é‡‡ç”¨é«˜äºä¸è¿ç®—ã€‚</p><p><strong>putæ“ä½œæ­¥éª¤ï¼š</strong></p><p>â€‹<img src="https://s0.lgstatic.com/i/image3/M01/73/D9/CgpOIF5rDYmATP43AAB3coc0R64799.png" alt="img" style="zoom:67%;" /></p><p>â€‹1ã€åˆ¤æ–­æ•°ç»„æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºè¿›è¡Œåˆå§‹åŒ–;</p><p>â€‹2ã€ä¸ä¸ºç©ºï¼Œåˆ™è®¡ç®— key çš„ hash å€¼ï¼Œé€šè¿‡(n - 1) &amp; hashè®¡ç®—åº”å½“å­˜æ”¾åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ index;</p><p>â€‹3ã€æŸ¥çœ‹ table[index] æ˜¯å¦å­˜åœ¨æ•°æ®ï¼Œæ²¡æœ‰æ•°æ®å°±æ„é€ ä¸€ä¸ªNodeèŠ‚ç‚¹å­˜æ”¾åœ¨ table[index] ä¸­ï¼›</p><p>â€‹4ã€å­˜åœ¨æ•°æ®ï¼Œè¯´æ˜å‘ç”Ÿäº†hashå†²çª(å­˜åœ¨äºŒä¸ªèŠ‚ç‚¹keyçš„hashå€¼ä¸€æ ·), ç»§ç»­åˆ¤æ–­keyæ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰ï¼Œç”¨æ–°çš„valueæ›¿æ¢åŸæ•°æ®ï¼›</p><p>â€‹5ã€è‹¥ä¸ç›¸ç­‰ï¼Œåˆ¤æ–­å½“å‰èŠ‚ç‚¹ç±»å‹æ˜¯ä¸æ˜¯æ ‘å‹èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯æ ‘å‹èŠ‚ç‚¹ï¼Œåˆ›é€ æ ‘å‹èŠ‚ç‚¹æ’å…¥çº¢é»‘æ ‘ä¸­ï¼›</p><p>â€‹6ã€è‹¥ä¸æ˜¯çº¢é»‘æ ‘ï¼Œåˆ›å»ºæ™®é€šNodeåŠ å…¥é“¾è¡¨ä¸­ï¼›åˆ¤æ–­é“¾è¡¨é•¿åº¦æ˜¯å¦å¤§äº 8ï¼Œå¤§äºåˆ™å°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼›</p><p>â€‹7ã€æ’å…¥å®Œæˆä¹‹ååˆ¤æ–­å½“å‰èŠ‚ç‚¹æ•°æ˜¯å¦å¤§äºé˜ˆå€¼ï¼Œè‹¥å¤§äºï¼Œåˆ™æ‰©å®¹ä¸ºåŸæ•°ç»„çš„äºŒå€</p><p><strong>å“ˆå¸Œå‡½æ•°ï¼š</strong></p><p>â€‹ é€šè¿‡hashå‡½æ•°ï¼ˆä¼˜è´¨å› å­31å¾ªç¯ç´¯åŠ ï¼‰å…ˆæ‹¿åˆ° key çš„hashcodeï¼Œæ˜¯ä¸€ä¸ª32ä½çš„å€¼ï¼Œç„¶åè®©hashcodeçš„é«˜16ä½å’Œä½16ä½è¿›è¡Œ<strong>å¼‚æˆ–</strong>æ“ä½œã€‚è¯¥å‡½æ•°ä¹Ÿç§°ä¸ºæ‰°åŠ¨å‡½æ•°ï¼Œåšåˆ°å°½å¯èƒ½é™ä½hashç¢°æ’ï¼Œé€šè¿‡å°¾æ’æ³•è¿›è¡Œæ’å…¥ã€‚</p><p><strong>å®¹é‡ä¸ºä»€ä¹ˆå§‹ç»ˆéƒ½æ˜¯2^Nï¼š</strong></p><p>â€‹å…ˆåšå¯¹æ•°ç»„çš„â»“åº¦å–æ¨¡è¿ç®—ï¼Œå¾—åˆ°çš„ä½™æ•°æ‰èƒ½â½¤æ¥è¦å­˜æ”¾çš„ä½ç½®ä¹Ÿå°±æ˜¯å¯¹åº”çš„æ•°ç»„ä¸‹æ ‡ã€‚è¿™ä¸ªæ•°ç»„ä¸‹æ ‡çš„è®¡ç®—â½…æ³•æ˜¯â€œ  (n - 1) &amp; hash â€ã€‚ï¼ˆnä»£è¡¨æ•°ç»„â»“åº¦ï¼‰ã€‚æ–¹ä¾¿æ•°ç»„çš„æ‰©å®¹å’Œå¢åˆ æ”¹æ—¶çš„å–æ¨¡ã€‚</p><p><strong>JDK1.7ä¸1.8çš„åŒºåˆ«ï¼š</strong></p><p><strong>JDK1.7 HashMapï¼š</strong></p><p>â€‹åº•å±‚æ˜¯ <strong>æ•°ç»„å’Œé“¾è¡¨</strong> ç»“åˆåœ¨â¼€èµ·ä½¿â½¤ä¹Ÿå°±æ˜¯é“¾è¡¨æ•£åˆ—ã€‚å¦‚æœç›¸åŒçš„è¯ï¼Œç›´æ¥è¦†ç›–ï¼Œä¸ç›¸åŒå°±é€šè¿‡æ‹‰é“¾æ³•è§£å†³å†²çªã€‚æ‰©å®¹ç¿»è½¬æ—¶é¡ºåºä¸ä¸€è‡´ä½¿ç”¨å¤´æ’æ³•ä¼šäº§ç”Ÿæ­»å¾ªç¯ï¼Œå¯¼è‡´cpu100%</p><p><strong>JDK1.8 HashMapï¼š</strong></p><p>â€‹åº•å±‚æ•°æ®ç»“æ„ä¸Šé‡‡ç”¨äº†<strong>æ•°ç»„ï¼‹é“¾è¡¨ï¼‹çº¢é»‘æ ‘</strong>ï¼›å½“é“¾è¡¨â»“åº¦â¼¤äºé˜ˆå€¼ï¼ˆé»˜è®¤ä¸º 8-æ³Šæ¾åˆ†å¸ƒï¼‰ï¼Œæ•°ç»„çš„â»“åº¦å¤§äº 64æ—¶ï¼Œé“¾è¡¨å°†è½¬åŒ–ä¸ºçº¢â¿Šæ ‘ï¼Œä»¥å‡å°‘æœç´¢æ—¶é—´ã€‚ï¼ˆè§£å†³äº†tomcatè‡­åæ˜­è‘—çš„urlå‚æ•°dosæ”»å‡»é—®é¢˜ï¼‰</p><h4 id="4ã€ConcurrentHashMap"><a href="#4ã€ConcurrentHashMap" class="headerlink" title="**4ã€ConcurrentHashMap **"></a>**4ã€ConcurrentHashMap **</h4><p>â€‹å¯ä»¥é€šè¿‡<strong>ConcurrentHashMap</strong> å’Œ <strong>Hashtable</strong>æ¥å®ç°çº¿ç¨‹å®‰å…¨ï¼›Hashtable æ˜¯åŸå§‹APIç±»ï¼Œé€šè¿‡synchronizeåŒæ­¥ä¿®é¥°ï¼Œæ•ˆç‡ä½ä¸‹ï¼›ConcurrentHashMap é€šè¿‡åˆ†æ®µé”å®ç°ï¼Œæ•ˆç‡è¾ƒæ¯”Hashtableè¦å¥½ï¼›</p><p><strong>ConcurrentHashMapçš„åº•å±‚å®ç°ï¼š</strong></p><p>â€‹<strong>JDK1.7çš„ ConcurrentHashMap</strong> åº•å±‚é‡‡â½¤ åˆ†æ®µçš„æ•°ç»„+é“¾è¡¨ å®ç°ï¼›é‡‡ç”¨ <strong>åˆ†æ®µé”</strong>ï¼ˆSagmentï¼‰ å¯¹æ•´ä¸ªæ¡¶æ•°ç»„è¿›â¾äº†åˆ†å‰²åˆ†æ®µ(Segmenté»˜è®¤16ä¸ª)ï¼Œæ¯â¼€æŠŠé”åªé”å®¹å™¨å…¶ä¸­â¼€éƒ¨åˆ†æ•°æ®ï¼Œå¤šçº¿ç¨‹è®¿é—®å®¹å™¨â¾¥ä¸åŒæ•°æ®æ®µçš„æ•°æ®ï¼Œå°±ä¸ä¼šå­˜åœ¨é”ç«äº‰ï¼Œæâ¾¼å¹¶å‘è®¿é—®ç‡ã€‚</p><p><img src="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=1035283471,1167301443&fm=26&gp=0.jpg"></p><p>â€‹<strong>JDK1.8çš„ ConcurrentHashMap</strong> é‡‡â½¤çš„æ•°æ®ç»“æ„è·ŸHashMap1.8çš„ç»“æ„â¼€æ ·ï¼Œæ•°ç»„+é“¾è¡¨&#x2F;çº¢â¿Šæ ‘ï¼›æ‘’å¼ƒäº†Segmentçš„æ¦‚å¿µï¼Œâ½½æ˜¯ç›´æ¥â½¤ Node æ•°ç»„+é“¾è¡¨+çº¢â¿Šæ ‘çš„æ•°æ®ç»“æ„æ¥å®ç°ï¼Œé€šè¿‡å¹¶å‘æ§åˆ¶ <strong>synchronized å’ŒCAS</strong>æ¥æ“ä½œä¿è¯çº¿ç¨‹çš„å®‰å…¨ã€‚</p><h4 id="5ã€åºåˆ—åŒ–å’Œååºåˆ—åŒ–"><a href="#5ã€åºåˆ—åŒ–å’Œååºåˆ—åŒ–" class="headerlink" title="5ã€åºåˆ—åŒ–å’Œååºåˆ—åŒ–"></a><strong>5ã€åºåˆ—åŒ–å’Œååºåˆ—åŒ–</strong></h4><p>â€‹åºåˆ—åŒ–çš„æ„æ€å°±æ˜¯å°†å¯¹è±¡çš„çŠ¶æ€è½¬åŒ–æˆå­—èŠ‚æµï¼Œä»¥åå¯ä»¥é€šè¿‡è¿™äº›å€¼å†ç”Ÿæˆç›¸åŒçŠ¶æ€çš„å¯¹è±¡ã€‚å¯¹è±¡åºåˆ—åŒ–æ˜¯å¯¹è±¡æŒä¹…åŒ–çš„ä¸€ç§å®ç°æ–¹æ³•ï¼Œå®ƒæ˜¯å°†å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•è½¬åŒ–ä¸ºä¸€ç§åºåˆ—åŒ–çš„å½¢å¼ç”¨äºå­˜å‚¨å’Œä¼ è¾“ã€‚ååºåˆ—åŒ–å°±æ˜¯æ ¹æ®è¿™äº›ä¿å­˜çš„ä¿¡æ¯é‡å»ºå¯¹è±¡çš„è¿‡ç¨‹ã€‚</p><p><strong>åºåˆ—åŒ–ï¼š</strong>å°†javaå¯¹è±¡è½¬åŒ–ä¸ºå­—èŠ‚åºåˆ—çš„è¿‡ç¨‹ã€‚</p><p><strong>ååºåˆ—åŒ–ï¼š</strong>å°†å­—èŠ‚åºåˆ—è½¬åŒ–ä¸ºjavaå¯¹è±¡çš„è¿‡ç¨‹ã€‚ </p><p><strong>ä¼˜ç‚¹ï¼š</strong></p><p>â€‹aã€å®ç°äº†æ•°æ®çš„æŒä¹…åŒ–ï¼Œé€šè¿‡åºåˆ—åŒ–å¯ä»¥æŠŠæ•°æ®æ°¸ä¹…åœ°ä¿å­˜åˆ°ç¡¬ç›˜ä¸Šï¼ˆé€šå¸¸å­˜æ”¾åœ¨æ–‡ä»¶é‡Œï¼‰Redisçš„RDB</p><p>â€‹bã€åˆ©ç”¨åºåˆ—åŒ–å®ç°è¿œç¨‹é€šä¿¡ï¼Œå³åœ¨ç½‘ç»œä¸Šä¼ é€å¯¹è±¡çš„å­—èŠ‚åºåˆ—ã€‚ Googleçš„protoBuf</p><p><strong>ååºåˆ—åŒ–å¤±è´¥çš„åœºæ™¯ï¼š</strong></p><p>â€‹åºåˆ—åŒ–IDï¼šserialVersionUIDä¸ä¸€è‡´çš„æ—¶å€™ï¼Œå¯¼è‡´ååºåˆ—åŒ–å¤±è´¥</p><h4 id="6ã€String"><a href="#6ã€String" class="headerlink" title="6ã€String"></a><strong>6ã€String</strong></h4><p>String ä½¿ç”¨<strong>æ•°ç»„</strong>å­˜å‚¨å†…å®¹ï¼Œæ•°ç»„ä½¿ç”¨ <strong>final</strong> ä¿®é¥°ï¼Œå› æ­¤ String å®šä¹‰çš„å­—ç¬¦ä¸²çš„å€¼ä¹Ÿæ˜¯<strong>ä¸å¯å˜çš„</strong></p><p>StringBuffer å¯¹æ–¹æ³•åŠ äº†åŒæ­¥é”ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œæ•ˆç‡ç•¥ä½äº StringBuilder</p><h3 id="è®¾è®¡æ¨¡å¼ä¸åŸåˆ™"><a href="#è®¾è®¡æ¨¡å¼ä¸åŸåˆ™" class="headerlink" title="è®¾è®¡æ¨¡å¼ä¸åŸåˆ™"></a>è®¾è®¡æ¨¡å¼ä¸åŸåˆ™</h3><h4 id="1ã€å•ä¾‹æ¨¡å¼"><a href="#1ã€å•ä¾‹æ¨¡å¼" class="headerlink" title="1ã€å•ä¾‹æ¨¡å¼"></a>1ã€å•ä¾‹æ¨¡å¼</h4><p>â€‹æŸä¸ªç±»åªèƒ½ç”Ÿæˆä¸€ä¸ªå®ä¾‹ï¼Œè¯¥å®ä¾‹å…¨å±€è®¿é—®ï¼Œä¾‹å¦‚Springå®¹å™¨é‡Œä¸€çº§ç¼“å­˜é‡Œçš„å•ä¾‹æ± ã€‚</p><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><p>â€‹<strong>å”¯ä¸€è®¿é—®</strong>ï¼šå¦‚ç”Ÿæˆå”¯ä¸€åºåˆ—åŒ–çš„åœºæ™¯ã€æˆ–è€…springé»˜è®¤çš„beanç±»å‹ã€‚</p><p>â€‹<strong>æé«˜æ€§èƒ½</strong>ï¼šé¢‘ç¹å®ä¾‹åŒ–åˆ›å»ºé”€æ¯æˆ–è€…è€—æ—¶è€—èµ„æºçš„åœºæ™¯ï¼Œå¦‚è¿æ¥æ± ã€çº¿ç¨‹æ± ã€‚</p><p><strong>ç¼ºç‚¹</strong>ï¼š</p><p>â€‹ä¸é€‚åˆæœ‰çŠ¶æ€ä¸”éœ€å˜æ›´çš„</p><p><strong>å®ç°æ–¹å¼</strong>ï¼š</p><p>â€‹<strong>é¥¿æ±‰å¼</strong>ï¼šçº¿ç¨‹å®‰å…¨é€Ÿåº¦å¿«</p><p>â€‹<strong>æ‡’æ±‰å¼</strong>ï¼šåŒé‡æ£€æµ‹é”ï¼Œç¬¬ä¸€æ¬¡å‡å°‘é”çš„å¼€é”€ã€ç¬¬äºŒæ¬¡é˜²æ­¢é‡å¤ã€volatileé˜²æ­¢é‡æ’åºå¯¼è‡´å®ä¾‹åŒ–æœªå®Œæˆ</p><p>â€‹<strong>é™æ€å†…éƒ¨ç±»</strong>ï¼šçº¿ç¨‹å®‰å…¨åˆ©ç”¨ç‡é«˜</p><p>â€‹<strong>æšä¸¾</strong>ï¼šeffictiveJAVAæ¨èï¼Œåå°„ä¹Ÿæ— æ³•ç ´å</p><h4 id="2ã€å·¥å‚æ¨¡å¼"><a href="#2ã€å·¥å‚æ¨¡å¼" class="headerlink" title="2ã€å·¥å‚æ¨¡å¼"></a>2ã€å·¥å‚æ¨¡å¼</h4><p>â€‹å®šä¹‰ä¸€ä¸ªç”¨äºåˆ›å»ºäº§å“çš„æ¥å£ï¼Œç”±å­ç±»å†³å®šç”Ÿäº§ä½•ç§äº§å“ã€‚</p><p><strong>ä¼˜ç‚¹ï¼š</strong>è§£è€¦ï¼šæä¾›å‚æ•°å³å¯è·å–äº§å“ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶å¯ä»¥ä¸ä¿®æ”¹ä»£ç å¢åŠ å…·ä½“äº§å“ã€‚</p><p><strong>ç¼ºç‚¹ï¼š</strong>æ¯å¢åŠ ä¸€ä¸ªäº§å“å°±å¾—æ–°å¢ä¸€ä¸ªäº§å“ç±»</p><h4 id="3ã€æŠ½è±¡å·¥å‚æ¨¡å¼"><a href="#3ã€æŠ½è±¡å·¥å‚æ¨¡å¼" class="headerlink" title="3ã€æŠ½è±¡å·¥å‚æ¨¡å¼"></a>3ã€æŠ½è±¡å·¥å‚æ¨¡å¼</h4><p>â€‹æä¾›ä¸€ä¸ªæ¥å£ï¼Œç”¨äºåˆ›å»ºç›¸å…³æˆ–è€…ä¾èµ–å¯¹è±¡çš„å®¶æ—ï¼Œå¹¶ç”±æ­¤è¿›è¡Œçº¦æŸã€‚</p><p><strong>ä¼˜ç‚¹ï¼š</strong>å¯ä»¥åœ¨ç±»çš„å†…éƒ¨å¯¹äº§å“æ—è¿›è¡Œçº¦æŸ</p><p><strong>ç¼ºç‚¹</strong>ï¼šå‡å¦‚äº§å“æ—ä¸­éœ€è¦å¢åŠ ä¸€ä¸ªæ–°çš„äº§å“ï¼Œåˆ™å‡ ä¹æ‰€æœ‰çš„å·¥å‚ç±»éƒ½éœ€è¦è¿›è¡Œä¿®æ”¹ã€‚</p><h2 id="é¢è¯•é¢˜"><a href="#é¢è¯•é¢˜" class="headerlink" title="é¢è¯•é¢˜"></a>é¢è¯•é¢˜</h2><h3 id="æ„é€ æ–¹æ³•"><a href="#æ„é€ æ–¹æ³•" class="headerlink" title="æ„é€ æ–¹æ³•"></a>æ„é€ æ–¹æ³•</h3><p>æ„é€ æ–¹æ³•å¯ä»¥è¢«é‡è½½ï¼Œåªæœ‰å½“ç±»ä¸­æ²¡æœ‰æ˜¾æ€§å£°æ˜ä»»ä½•æ„é€ æ–¹æ³•æ—¶ï¼Œæ‰ä¼šæœ‰é»˜è®¤æ„é€ æ–¹æ³•ã€‚</p><p>æ„é€ æ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼Œæ„é€ æ–¹æ³•çš„ä½œç”¨æ˜¯åˆ›å»ºæ–°å¯¹è±¡ã€‚</p><h3 id="åˆå§‹åŒ–å—"><a href="#åˆå§‹åŒ–å—" class="headerlink" title="åˆå§‹åŒ–å—"></a>åˆå§‹åŒ–å—</h3><p>é™æ€åˆå§‹åŒ–å—çš„ä¼˜å…ˆçº§æœ€é«˜ï¼Œä¼šæœ€å…ˆæ‰§è¡Œï¼Œåœ¨éé™æ€åˆå§‹åŒ–å—ä¹‹å‰æ‰§è¡Œã€‚</p><p>é™æ€åˆå§‹åŒ–å—ä¼šåœ¨ç±»ç¬¬ä¸€æ¬¡è¢«åŠ è½½æ—¶æœ€å…ˆæ‰§è¡Œï¼Œå› æ­¤åœ¨ main æ–¹æ³•ä¹‹å‰ã€‚</p><h3 id="This"><a href="#This" class="headerlink" title="This"></a>This</h3><p>å…³é”®å­— <code>this</code> ä»£è¡¨å½“å‰å¯¹è±¡çš„å¼•ç”¨ã€‚å½“å‰å¯¹è±¡æŒ‡çš„æ˜¯è°ƒç”¨ç±»ä¸­çš„å±æ€§æˆ–æ–¹æ³•çš„å¯¹è±¡</p><p>å…³é”®å­— <code>this</code> ä¸å¯ä»¥åœ¨é™æ€æ–¹æ³•ä¸­ä½¿ç”¨ã€‚é™æ€æ–¹æ³•ä¸ä¾èµ–äºç±»çš„å…·ä½“å¯¹è±¡çš„å¼•ç”¨</p><h3 id="é‡å†™å’Œé‡è½½çš„åŒºåˆ«"><a href="#é‡å†™å’Œé‡è½½çš„åŒºåˆ«" class="headerlink" title="é‡å†™å’Œé‡è½½çš„åŒºåˆ«"></a><strong>é‡å†™å’Œé‡è½½çš„åŒºåˆ«</strong></h3><p>é‡è½½æŒ‡åœ¨åŒä¸€ä¸ªç±»ä¸­å®šä¹‰å¤šä¸ªæ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•åç§°ç›¸åŒï¼Œç­¾åä¸åŒã€‚</p><p>é‡å†™æŒ‡åœ¨å­ç±»ä¸­çš„æ–¹æ³•çš„åç§°å’Œç­¾åéƒ½å’Œçˆ¶ç±»ç›¸åŒï¼Œä½¿ç”¨overrideæ³¨è§£</p><h3 id="Objectç±»æ–¹æ³•"><a href="#Objectç±»æ–¹æ³•" class="headerlink" title="Objectç±»æ–¹æ³•"></a>Objectç±»æ–¹æ³•</h3><p><strong>toString</strong>     é»˜è®¤æ˜¯ä¸ªæŒ‡é’ˆï¼Œä¸€èˆ¬éœ€è¦é‡å†™</p><p><strong>equals</strong>        æ¯”è¾ƒå¯¹è±¡æ˜¯å¦ç›¸åŒï¼Œé»˜è®¤å’Œ&#x3D;&#x3D;åŠŸèƒ½ä¸€è‡´</p><p><strong>hashCode</strong>  æ•£åˆ—ç ï¼Œequalsåˆ™hashCodeç›¸åŒï¼Œæ‰€ä»¥é‡å†™equalså¿…é¡»é‡å†™hashCode</p><p>**finalize   **    ç”¨äºåƒåœ¾å›æ”¶ä¹‹å‰åšçš„é—å˜±ï¼Œé»˜è®¤ç©ºï¼Œå­ç±»éœ€é‡å†™</p><p><strong>clone</strong>           æ·±æ‹·è´ï¼Œç±»éœ€å®ç°cloneableçš„æ¥å£</p><p><strong>getClass</strong>     åå°„è·å–å¯¹è±¡å…ƒæ•°æ®ï¼ŒåŒ…æ‹¬ç±»åã€æ–¹æ³•ã€</p><p><strong>notifyã€wait</strong>   ç”¨äºçº¿ç¨‹é€šçŸ¥å’Œå”¤é†’</p><h3 id="åŸºæœ¬æ•°æ®ç±»å‹å’ŒåŒ…è£…ç±»"><a href="#åŸºæœ¬æ•°æ®ç±»å‹å’ŒåŒ…è£…ç±»" class="headerlink" title="åŸºæœ¬æ•°æ®ç±»å‹å’ŒåŒ…è£…ç±»"></a>åŸºæœ¬æ•°æ®ç±»å‹å’ŒåŒ…è£…ç±»</h3><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1goe1gq2yipj318s0ruwj4.jpg" alt="image-20210309224910999"></p><table><thead><tr><th>ç±»å‹</th><th>ç¼“å­˜èŒƒå›´</th></tr></thead><tbody><tr><td>Byte,Short,Integer,Long</td><td>[-128, 127]</td></tr><tr><td>Character</td><td>[0, 127]</td></tr><tr><td>Boolean</td><td>[false, true]</td></tr></tbody></table><h1 id="äºŒã€JVMç¯‡"><a href="#äºŒã€JVMç¯‡" class="headerlink" title="äºŒã€JVMç¯‡"></a>äºŒã€JVMç¯‡</h1><h3 id="JVMå†…å­˜åˆ’åˆ†"><a href="#JVMå†…å­˜åˆ’åˆ†" class="headerlink" title="JVMå†…å­˜åˆ’åˆ†"></a><strong>JVMå†…å­˜åˆ’åˆ†</strong></h3><h4 id="1ã€JVMè¿è¡Œæ—¶æ•°æ®åŒºåŸŸ"><a href="#1ã€JVMè¿è¡Œæ—¶æ•°æ®åŒºåŸŸ" class="headerlink" title="1ã€JVMè¿è¡Œæ—¶æ•°æ®åŒºåŸŸ"></a><strong>1ã€JVMè¿è¡Œæ—¶æ•°æ®åŒºåŸŸ</strong></h4><p>â€‹å †ã€æ–¹æ³•åŒºï¼ˆå…ƒç©ºé—´ï¼‰ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€ç¨‹åºè®¡æ•°å™¨</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gobgnw8m8uj30l10bejs4.jpg" alt="xxx"></p><p><strong>Heap(å †)ï¼š</strong></p><p>â€‹å¯¹è±¡çš„å®ä¾‹ä»¥åŠæ•°ç»„çš„å†…å­˜éƒ½æ˜¯è¦åœ¨å †ä¸Šè¿›è¡Œåˆ†é…çš„ï¼Œå †æ˜¯çº¿ç¨‹å…±äº«çš„ä¸€å—åŒºåŸŸï¼Œç”¨æ¥å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œä¹Ÿæ˜¯åƒåœ¾å›æ”¶ï¼ˆGCï¼‰çš„ä¸»è¦åŒºåŸŸï¼›å¼€å¯é€ƒé€¸åˆ†æåï¼ŒæŸäº›æœªé€ƒé€¸çš„å¯¹è±¡å¯ä»¥é€šè¿‡æ ‡é‡æ›¿æ¢çš„æ–¹å¼åœ¨æ ˆä¸­åˆ†é…</p><p>â€‹å †ç»†åˆ†ï¼šæ–°ç”Ÿä»£ã€è€å¹´ä»£ï¼Œå¯¹äºæ–°ç”Ÿä»£åˆåˆ†ä¸ºï¼š<strong>EdenåŒº</strong>å’Œ<strong>Surviver1</strong>å’Œ<strong>Surviver2</strong>åŒºï¼›</p><p><strong>æ–¹æ³•åŒºï¼š</strong></p><p>â€‹å¯¹äºJVMçš„æ–¹æ³•åŒºä¹Ÿå¯ä»¥ç§°ä¹‹ä¸ºæ°¸ä¹…åŒºï¼Œå®ƒå‚¨å­˜çš„æ˜¯å·²ç»è¢«javaè™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ï¼›Jdk1.8ä»¥åå–æ¶ˆäº†æ–¹æ³•åŒºè¿™ä¸ªæ¦‚å¿µï¼Œç§°ä¹‹ä¸ºå…ƒç©ºé—´ï¼ˆMetaSpaceï¼‰ï¼›</p><p>â€‹å½“åº”ç”¨ä¸­çš„ Java ç±»è¿‡å¤šæ—¶ï¼Œæ¯”å¦‚ <strong>Spring ç­‰ä¸€äº›ä½¿ç”¨åŠ¨æ€ä»£ç†çš„æ¡†æ¶ç”Ÿæˆäº†å¾ˆå¤šç±»</strong>ï¼Œå¦‚æœå ç”¨ç©ºé—´è¶…å‡ºäº†æˆ‘ä»¬çš„è®¾å®šå€¼ï¼Œå°±ä¼šå‘ç”Ÿ<strong>å…ƒç©ºé—´æº¢å‡º</strong></p><p><strong>è™šæ‹Ÿæœºæ ˆï¼š</strong></p><p>â€‹è™šæ‹Ÿæœºæ ˆ<strong>æ˜¯çº¿ç¨‹ç§æœ‰çš„</strong>ï¼Œä»–çš„ç”Ÿå‘½å‘¨æœŸå’Œçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸€è‡´çš„ã€‚é‡Œé¢è£…çš„æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„<strong>æ ˆå¸§</strong>ï¼Œæ¯ä¸€ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œçš„æ—¶å€™éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œæ ˆå¸§ä¸­ç”¨æ¥å­˜æ”¾ï¼ˆ<strong>å±€éƒ¨å˜é‡è¡¨</strong>ã€<strong>æ“ä½œæ•°æ ˆ</strong> ã€<strong>åŠ¨æ€é“¾æ¥</strong> ã€<strong>è¿”å›åœ°å€</strong>ï¼‰ï¼›åœ¨Javaè™šæ‹Ÿæœºè§„èŒƒä¸­ï¼Œå¯¹æ­¤åŒºåŸŸè§„å®šäº†ä¸¤ç§å¼‚å¸¸çŠ¶å†µï¼šå¦‚æœçº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºè™šæ‹Ÿæœºæ‰€å…è®¸çš„æ·±åº¦ï¼Œå°†ä¼šæŠ›å‡º<strong>StackOverflowError</strong>å¼‚å¸¸ï¼›å¦‚æœè™šæ‹Ÿæœºæ ˆåŠ¨æ€æ‰©å±•æ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ï¼Œå°±ä¼šæŠ›å‡º<strong>OutOfMemoryError</strong>å¼‚å¸¸ã€‚</p><ul><li><p><strong>å±€éƒ¨å˜é‡è¡¨ï¼š</strong>å±€éƒ¨å˜é‡è¡¨æ˜¯ä¸€ç»„å˜é‡å€¼å­˜å‚¨ç©ºé—´ï¼Œç”¨æ¥å­˜æ”¾<strong>æ–¹æ³•å‚æ•°</strong>ã€æ–¹æ³•å†…éƒ¨å®šä¹‰çš„<strong>å±€éƒ¨å˜é‡</strong>ã€‚åº•å±‚æ˜¯å˜é‡æ§½ï¼ˆvariable slotï¼‰</p></li><li><p><strong>æ“ä½œæ•°æ ˆï¼š</strong>æ˜¯ç”¨æ¥è®°å½•ä¸€ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œ<strong>å­—èŠ‚ç æŒ‡ä»¤å‘æ“ä½œæ•°æ ˆä¸­è¿›è¡Œå…¥æ ˆå’Œå‡ºæ ˆçš„è¿‡ç¨‹</strong>ã€‚å¤§å°åœ¨ç¼–è¯‘çš„æ—¶å€™å·²ç»ç¡®å®šäº†ï¼Œå½“ä¸€ä¸ªæ–¹æ³•åˆšå¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œæ“ä½œæ•°æ ˆä¸­æ˜¯ç©ºå‘çš„ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¼šæœ‰å„ç§<strong>å­—èŠ‚ç æŒ‡ä»¤</strong>å¾€æ“ä½œæ•°æ ˆä¸­<strong>å…¥æ ˆå’Œå‡ºæ ˆ</strong>ã€‚</p></li><li><p><strong>åŠ¨æ€é“¾æ¥ï¼š</strong>å› ä¸ºå­—èŠ‚ç æ–‡ä»¶ä¸­æœ‰å¾ˆå¤šç¬¦å·çš„å¼•ç”¨ï¼Œè¿™äº›ç¬¦å·å¼•ç”¨ä¸€éƒ¨åˆ†ä¼šåœ¨<strong>ç±»åŠ è½½çš„è§£æé˜¶æ®µ</strong>æˆ–<strong>ç¬¬ä¸€æ¬¡ä½¿ç”¨</strong>çš„æ—¶å€™è½¬åŒ–æˆ<strong>ç›´æ¥å¼•ç”¨</strong>ï¼Œè¿™ç§ç§°ä¸º<strong>é™æ€è§£æ</strong>ï¼›å¦ä¸€éƒ¨åˆ†ä¼š<strong>åœ¨è¿è¡ŒæœŸé—´</strong>è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨ï¼Œç§°ä¸º<strong>åŠ¨æ€é“¾æ¥</strong>ã€‚</p></li><li><p><strong>è¿”å›åœ°å€ï¼ˆreturnAddressï¼‰ï¼š</strong>ç±»å‹ï¼ˆæŒ‡å‘äº†ä¸€æ¡å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼‰</p><p><strong>JITå³æ—¶ç¼–è¯‘å™¨ï¼ˆJust In Time Compilerï¼‰ï¼Œç®€ç§° JIT ç¼–è¯‘å™¨</strong>: </p><p>ä¸ºäº†æé«˜çƒ­ç‚¹ä»£ç çš„æ‰§è¡Œæ•ˆç‡ï¼Œåœ¨è¿è¡Œæ—¶ï¼Œè™šæ‹Ÿæœºå°†ä¼šæŠŠè¿™äº›ä»£ç ç¼–è¯‘æˆä¸æœ¬åœ°å¹³å°ç›¸å…³çš„æœºå™¨ç ï¼Œå¹¶è¿›è¡Œå„ç§å±‚æ¬¡çš„ä¼˜åŒ–ï¼Œæ¯”å¦‚é”ç²—åŒ–ç­‰</p></li></ul><p><strong>æœ¬åœ°æ–¹æ³•æ ˆï¼š</strong></p><p>â€‹æœ¬åœ°æ–¹æ³•æ ˆå’Œè™šæ‹Ÿæœºæ ˆç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯è™šæ‹Ÿæœºæ ˆæœåŠ¡çš„æ˜¯Javaæ–¹æ³•ï¼Œè€Œ<strong>æœ¬åœ°æ–¹æ³•æ ˆæœåŠ¡çš„æ˜¯Nativeæ–¹æ³•</strong>ã€‚åœ¨HotSpotè™šæ‹Ÿæœºå®ç°ä¸­æ˜¯æŠŠæœ¬åœ°æ–¹æ³•æ ˆå’Œè™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€çš„ï¼ŒåŒç†å®ƒä¹Ÿä¼šæŠ›å‡º<strong>StackOverflowError</strong>å’Œ<strong>OOM</strong>å¼‚å¸¸ã€‚</p><p><strong>PCç¨‹åºè®¡æ•°å™¨ï¼š</strong></p><p>â€‹PCï¼ŒæŒ‡çš„æ˜¯å­˜æ”¾ä¸‹ä¸€æ¡æŒ‡ä»¤çš„ä½ç½®çš„ä¸€ä¸ªæŒ‡é’ˆã€‚å®ƒæ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œä¸”æ˜¯<strong>çº¿ç¨‹ç§æœ‰</strong>çš„ã€‚ç”±äºçº¿ç¨‹çš„åˆ‡æ¢ï¼ŒCPUåœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦è®°ä½åŸçº¿ç¨‹çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„ä½ç½®ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½éœ€è¦æœ‰è‡ªå·±çš„PCã€‚</p><h4 id="2ã€å †å†…å­˜åˆ†é…ç­–ç•¥"><a href="#2ã€å †å†…å­˜åˆ†é…ç­–ç•¥" class="headerlink" title="2ã€å †å†…å­˜åˆ†é…ç­–ç•¥"></a><strong>2ã€å †å†…å­˜åˆ†é…ç­–ç•¥</strong></h4><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gobnjl5glvj30l10h9jrt.jpg" alt="img"></p><ul><li><p>å¯¹è±¡ä¼˜å…ˆåˆ†é…åœ¨EdenåŒºï¼Œå¦‚æœEdenåŒºæ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´è¿›è¡Œåˆ†é…æ—¶ï¼Œè™šæ‹Ÿæœºæ‰§è¡Œä¸€æ¬¡MinorGCã€‚è€Œé‚£äº›æ— éœ€å›æ”¶çš„å­˜æ´»å¯¹è±¡ï¼Œå°†ä¼šè¿›åˆ° Survivor çš„ From åŒºï¼ˆFrom åŒºå†…å­˜ä¸è¶³æ—¶ï¼Œç›´æ¥è¿›å…¥ Old åŒºï¼‰ã€‚</p></li><li><p>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼ˆéœ€è¦å¤§é‡è¿ç»­å†…å­˜ç©ºé—´çš„å¯¹è±¡ï¼‰ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯é¿å…åœ¨EdenåŒºå’Œä¸¤ä¸ªSurvivoråŒºä¹‹é—´å‘ç”Ÿå¤§é‡çš„å†…å­˜æ‹·è´ï¼ˆæ–°ç”Ÿä»£é‡‡ç”¨å¤åˆ¶ç®—æ³•æ”¶é›†å†…å­˜ï¼‰ã€‚</p></li><li><p>é•¿æœŸå­˜æ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£ã€‚è™šæ‹Ÿæœºä¸ºæ¯ä¸ªå¯¹è±¡å®šä¹‰äº†ä¸€ä¸ªå¹´é¾„ï¼ˆAge Countï¼‰è®¡æ•°å™¨ï¼Œå¦‚æœå¯¹è±¡ç»è¿‡äº†1æ¬¡Minor GCé‚£ä¹ˆå¯¹è±¡ä¼šè¿›å…¥SurvivoråŒºï¼Œä¹‹åæ¯ç»è¿‡ä¸€æ¬¡Minor GCé‚£ä¹ˆå¯¹è±¡çš„å¹´é¾„åŠ 1ï¼Œç›´åˆ°è¾¾åˆ°é˜€å€¼ï¼ˆé»˜è®¤15æ¬¡ï¼‰ï¼Œå¯¹è±¡è¿›å…¥è€å¹´åŒºã€‚</p><p>ï¼ˆ<strong>åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®š</strong>ï¼šç¨‹åºä»å¹´é¾„æœ€å°çš„å¯¹è±¡å¼€å§‹ç´¯åŠ ï¼Œå¦‚æœç´¯åŠ çš„å¯¹è±¡å¤§å°ï¼Œå¤§äºå¹¸å­˜åŒºçš„ä¸€åŠï¼Œåˆ™å°†å½“å‰çš„å¯¹è±¡ age ä½œä¸ºæ–°çš„é˜ˆå€¼ï¼Œå¹´é¾„å¤§äºæ­¤é˜ˆå€¼çš„å¯¹è±¡åˆ™ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼‰</p></li><li><p>æ¯æ¬¡è¿›è¡ŒMinor GCæˆ–è€…å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´åŒºæ—¶ï¼ŒJVMä¼šè®¡ç®—æ‰€éœ€ç©ºé—´å¤§å°å¦‚å°äºè€å¹´åŒºçš„å‰©ä½™å€¼å¤§å°ï¼Œåˆ™è¿›è¡Œä¸€æ¬¡<strong>Full GC</strong>ã€‚</p></li></ul><h4 id="3ã€åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„æ­¥éª¤"><a href="#3ã€åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„æ­¥éª¤" class="headerlink" title="3ã€åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„æ­¥éª¤"></a><strong>3ã€åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„æ­¥éª¤</strong></h4><p><strong>æ­¥éª¤ï¼šç±»åŠ è½½æ£€æŸ¥ã€åˆ†é…å†…å­˜ã€åˆå§‹åŒ–é›¶å€¼ã€è®¾ç½®å¯¹è±¡å¤´ã€æ‰§è¡Œinitæ–¹æ³•</strong></p><p><strong>â‘ ç±»åŠ è½½æ£€æŸ¥ï¼š</strong> </p><p>â€‹è™šæ‹Ÿæœºé‡åˆ° new æŒ‡ä»¤æ—¶ï¼Œâ¾¸å…ˆå»æ£€æŸ¥æ˜¯å¦èƒ½åœ¨å¸¸é‡æ± ä¸­å®šä½åˆ°è¿™ä¸ªç±»çš„ç¬¦å·å¼•â½¤ï¼Œå¹¶ä¸”æ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•â½¤ä»£è¡¨çš„ç±»æ˜¯å¦å·²è¢«åŠ è½½è¿‡ã€è§£æå’Œåˆå§‹åŒ–è¿‡ã€‚å¦‚æœæ²¡æœ‰ï¼Œé‚£å¿…é¡»å…ˆæ‰§â¾ç›¸åº”çš„ç±»åŠ è½½è¿‡ç¨‹ã€‚</p><p><strong>â‘¡åˆ†é…å†…å­˜ï¼š</strong></p><p>â€‹ åœ¨ç±»åŠ è½½æ£€æŸ¥é€šè¿‡åï¼Œæ¥ä¸‹æ¥è™šæ‹Ÿæœºå°†ä¸ºæ–°â½£å¯¹è±¡åˆ†é…å†…å­˜ï¼Œåˆ†é…â½…å¼æœ‰ <strong>â€œæŒ‡é’ˆç¢°æ’â€</strong> å’Œ <strong>â€œç©ºé—²åˆ—è¡¨â€</strong> ä¸¤ç§ï¼Œé€‰æ‹©é‚£ç§åˆ†é…â½…å¼ç”± Java å †æ˜¯å¦è§„æ•´å†³å®šï¼Œâ½½Javaå †æ˜¯å¦è§„æ•´â¼œç”±æ‰€é‡‡â½¤çš„åƒåœ¾æ”¶é›†å™¨æ˜¯å¦å¸¦æœ‰å‹ç¼©æ•´ç†åŠŸèƒ½å†³å®šã€‚</p><p><strong>â‘¢åˆå§‹åŒ–é›¶å€¼ï¼š</strong></p><p>â€‹ å†…å­˜åˆ†é…å®Œæˆåï¼Œè™šæ‹Ÿæœºéœ€è¦å°†åˆ†é…åˆ°çš„å†…å­˜ç©ºé—´éƒ½åˆå§‹åŒ–ä¸ºé›¶å€¼ï¼Œè¿™â¼€æ­¥æ“ä½œä¿è¯äº†å¯¹è±¡çš„å®ä¾‹å­—æ®µåœ¨ Java ä»£ç ä¸­å¯ä»¥ä¸èµ‹åˆå§‹å€¼å°±ç›´æ¥ä½¿â½¤ï¼Œç¨‹åºèƒ½è®¿é—®åˆ°è¿™äº›å­—æ®µçš„æ•°æ®ç±»å‹æ‰€å¯¹åº”çš„é›¶å€¼ã€‚</p><p><strong>â‘£è®¾ç½®å¯¹è±¡å¤´ï¼š</strong> </p><p>â€‹åˆå§‹åŒ–é›¶å€¼å®Œæˆä¹‹åï¼Œè™šæ‹Ÿæœºè¦å¯¹å¯¹è±¡è¿›â¾å¿…è¦çš„è®¾ç½®ï¼Œä¾‹å¦‚è¿™ä¸ªå¯¹è±¡æ˜¯é‚£ä¸ªç±»çš„å®ä¾‹ã€å¦‚ä½•æ‰èƒ½æ‰¾åˆ°ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ã€å¯¹è±¡çš„å“ˆå¸Œå—ã€å¯¹è±¡çš„ GC åˆ†ä»£å¹´é¾„ç­‰ä¿¡æ¯ã€‚ è¿™äº›ä¿¡æ¯å­˜æ”¾åœ¨å¯¹è±¡å¤´ä¸­ã€‚ å¦å¤–ï¼Œæ ¹æ®è™šæ‹Ÿæœºå½“å‰è¿â¾çŠ¶æ€çš„ä¸åŒï¼Œå¦‚æ˜¯å¦å¯â½¤åå‘é”ç­‰ï¼Œå¯¹è±¡å¤´ä¼šæœ‰ä¸åŒçš„è®¾ç½®â½…å¼ã€‚</p><p><strong>â‘¤æ‰§â¾ init â½…æ³•ï¼š</strong> </p><p>â€‹ä»è™šæ‹Ÿæœºçš„è§†â»†æ¥çœ‹ï¼Œâ¼€ä¸ªæ–°çš„å¯¹è±¡å·²ç»äº§â½£äº†ï¼Œä½†ä»Java ç¨‹åºçš„è§†â»†æ¥çœ‹ï¼Œ <init> â½…æ³•è¿˜æ²¡æœ‰æ‰§â¾ï¼Œæ‰€æœ‰çš„å­—æ®µéƒ½è¿˜ä¸ºé›¶ã€‚æ‰€ä»¥â¼€èˆ¬æ¥è¯´ï¼ˆé™¤å¾ªç¯ä¾èµ–ï¼‰ï¼Œæ‰§â¾ new æŒ‡ä»¤ä¹‹åä¼šæ¥ç€æ‰§â¾  <init> â½…æ³•ï¼Œè¿™æ ·â¼€ä¸ªçœŸæ­£å¯â½¤çš„å¯¹è±¡æ‰ç®—äº§â½£å‡ºæ¥ã€‚</p><h4 id="4ã€å¯¹è±¡å¼•ç”¨"><a href="#4ã€å¯¹è±¡å¼•ç”¨" class="headerlink" title="4ã€å¯¹è±¡å¼•ç”¨"></a>4ã€<strong>å¯¹è±¡å¼•ç”¨</strong></h4><p>æ™®é€šçš„å¯¹è±¡å¼•ç”¨å…³ç³»å°±æ˜¯<strong>å¼ºå¼•ç”¨</strong>ã€‚</p><p><strong>è½¯å¼•ç”¨</strong>ç”¨äºç»´æŠ¤ä¸€äº›å¯æœ‰å¯æ— çš„å¯¹è±¡ã€‚åªæœ‰åœ¨<strong>å†…å­˜ä¸è¶³æ—¶ï¼Œç³»ç»Ÿåˆ™ä¼šå›æ”¶è½¯å¼•ç”¨å¯¹è±¡</strong>ï¼Œå¦‚æœå›æ”¶äº†è½¯å¼•ç”¨å¯¹è±¡ä¹‹åä»ç„¶æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œæ‰ä¼šæŠ›å‡ºå†…å­˜æº¢å‡ºå¼‚å¸¸ã€‚</p><p><strong>å¼±å¼•ç”¨</strong>å¯¹è±¡ç›¸æ¯”è½¯å¼•ç”¨æ¥è¯´ï¼Œè¦æ›´åŠ æ— ç”¨ä¸€äº›ï¼Œå®ƒæ‹¥æœ‰æ›´çŸ­çš„ç”Ÿå‘½å‘¨æœŸï¼Œå½“ JVM è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œ<strong>æ— è®ºå†…å­˜æ˜¯å¦å……è¶³</strong>ï¼Œéƒ½ä¼šå›æ”¶è¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ã€‚</p><p><strong>è™šå¼•ç”¨</strong>æ˜¯ä¸€ç§å½¢åŒè™šè®¾çš„å¼•ç”¨ï¼Œåœ¨ç°å®åœºæ™¯ä¸­ç”¨çš„ä¸æ˜¯å¾ˆå¤šï¼Œå®ƒä¸»è¦ç”¨æ¥<strong>è·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶</strong>çš„æ´»åŠ¨ã€‚</p><h3 id="JVMç±»åŠ è½½è¿‡ç¨‹"><a href="#JVMç±»åŠ è½½è¿‡ç¨‹" class="headerlink" title="JVMç±»åŠ è½½è¿‡ç¨‹"></a><strong>JVMç±»åŠ è½½è¿‡ç¨‹</strong></h3><p><strong>è¿‡ç¨‹ï¼šåŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æã€åˆå§‹åŒ–</strong></p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gobnnbem87j30eq0cogmj.jpg" alt="img" style="zoom:50%;" /><p><strong>åŠ è½½é˜¶æ®µï¼š</strong></p><p>â€‹1.é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµã€‚</p><p>â€‹2.å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ã€‚</p><p>â€‹3.åœ¨Javaå †ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„java.lang.classå¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™äº›æ•°æ®çš„è®¿é—®å…¥å£ã€‚</p><p><strong>éªŒè¯é˜¶æ®µï¼š</strong></p><p>â€‹1.æ–‡ä»¶æ ¼å¼éªŒè¯ï¼ˆæ˜¯å¦ç¬¦åˆClassæ–‡ä»¶æ ¼å¼çš„è§„èŒƒï¼Œå¹¶ä¸”èƒ½è¢«å½“å‰ç‰ˆæœ¬çš„è™šæ‹Ÿæœºå¤„ç†ï¼‰</p><p>â€‹2.å…ƒæ•°æ®éªŒè¯ï¼ˆå¯¹å­—èŠ‚ç æè¿°çš„ä¿¡æ¯è¿›è¡Œè¯­æ„åˆ†æï¼Œä»¥ä¿è¯å…¶æè¿°çš„ä¿¡æ¯ç¬¦åˆJavaè¯­è¨€è§„èŒƒè¦æ±‚ï¼‰</p><p>â€‹3.å­—èŠ‚ç éªŒè¯ï¼ˆä¿è¯è¢«æ ¡éªŒç±»çš„æ–¹æ³•åœ¨è¿è¡Œæ—¶ä¸ä¼šåšå‡ºå±å®³è™šæ‹Ÿæœºå®‰å…¨çš„è¡Œä¸ºï¼‰</p><p>â€‹4.ç¬¦å·å¼•ç”¨éªŒè¯ï¼ˆè™šæ‹Ÿæœºå°†ç¬¦å·å¼•ç”¨è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨æ—¶ï¼Œè§£æé˜¶æ®µä¸­å‘ç”Ÿï¼‰</p><p><strong>å‡†å¤‡é˜¶æ®µï¼š</strong></p><p>â€‹å‡†å¤‡é˜¶æ®µæ˜¯æ­£å¼ä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡åˆå§‹å€¼çš„é˜¶æ®µã€‚å°†å¯¹è±¡åˆå§‹åŒ–ä¸ºâ€œé›¶â€å€¼</p><p><strong>è§£æé˜¶æ®µï¼š</strong></p><p>â€‹è§£æé˜¶æ®µæ—¶è™šæ‹Ÿæœºå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚</p><p>â€‹<strong>å­—ç¬¦ä¸²å¸¸é‡æ± </strong>ï¼šå †ä¸Šï¼Œé»˜è®¤classæ–‡ä»¶çš„é™æ€å¸¸é‡æ± </p><p>â€‹<strong>è¿è¡Œæ—¶å¸¸é‡æ± </strong>ï¼šåœ¨æ–¹æ³•åŒºï¼Œå±äºå…ƒç©ºé—´</p><p><strong>åˆå§‹åŒ–é˜¶æ®µï¼š</strong></p><p>â€‹åˆå§‹åŒ–é˜¶æ®µæ—¶åŠ è½½è¿‡ç¨‹çš„æœ€åä¸€æ­¥ï¼Œè€Œè¿™ä¸€é˜¶æ®µä¹Ÿæ˜¯çœŸæ­£æ„ä¹‰ä¸Šå¼€å§‹æ‰§è¡Œç±»ä¸­å®šä¹‰çš„Javaç¨‹åºä»£ç ã€‚</p><h4 id="1ã€åŒäº²å§”æ´¾æœºåˆ¶"><a href="#1ã€åŒäº²å§”æ´¾æœºåˆ¶" class="headerlink" title="1ã€åŒäº²å§”æ´¾æœºåˆ¶"></a><strong>1ã€åŒäº²å§”æ´¾æœºåˆ¶</strong></h4><p>â€‹æ¯â¼€ä¸ªç±»éƒ½æœ‰â¼€ä¸ªå¯¹åº”å®ƒçš„ç±»åŠ è½½å™¨ã€‚ç³»ç»Ÿä¸­çš„ ClassLoder åœ¨ååŒâ¼¯ä½œçš„æ—¶å€™ä¼šé»˜è®¤ä½¿â½¤ åŒäº²å§”æ´¾æ¨¡å‹ ã€‚å³åœ¨ç±»åŠ è½½çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šâ¾¸å…ˆåˆ¤æ–­å½“å‰ç±»æ˜¯å¦è¢«åŠ è½½è¿‡ã€‚å·²ç»è¢«åŠ è½½çš„ç±»ä¼šç›´æ¥è¿”å›ï¼Œå¦åˆ™æ‰ä¼šå°è¯•åŠ è½½ã€‚åŠ è½½çš„æ—¶å€™ï¼Œâ¾¸å…ˆä¼šæŠŠè¯¥è¯·æ±‚å§”æ´¾è¯¥â½—ç±»åŠ è½½å™¨çš„  loadClass() å¤„ç†ï¼Œå› æ­¤æ‰€æœ‰çš„è¯·æ±‚æœ€ç»ˆéƒ½åº”è¯¥ä¼ é€åˆ°é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨  BootstrapClassLoader ä¸­ã€‚å½“â½—ç±»åŠ è½½å™¨â½†æ³•å¤„ç†æ—¶ï¼Œæ‰ç”±â¾ƒâ¼°æ¥å¤„ç†ã€‚å½“â½—ç±»åŠ è½½å™¨ä¸ºnullæ—¶ï¼Œä¼šä½¿â½¤å¯åŠ¨ç±»åŠ è½½å™¨  BootstrapClassLoader ä½œä¸ºâ½—ç±»åŠ è½½å™¨ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gobn5lh4f6j30hk08rjso.jpg" alt="img"></p><p><strong>ä½¿ç”¨å¥½å¤„ï¼š</strong></p><p>â€‹æ­¤æœºåˆ¶ä¿è¯JDKæ ¸å¿ƒç±»çš„ä¼˜å…ˆåŠ è½½ï¼›ä½¿å¾—Javaç¨‹åºçš„ç¨³å®šè¿â¾ï¼Œå¯ä»¥é¿å…ç±»çš„é‡å¤åŠ è½½ï¼Œä¹Ÿä¿è¯äº† Java çš„æ ¸â¼¼ API ä¸è¢«ç¯¡æ”¹ã€‚å¦‚æœä¸â½¤æ²¡æœ‰ä½¿â½¤åŒäº²å§”æ´¾æ¨¡å‹ï¼Œâ½½æ˜¯æ¯ä¸ªç±»åŠ è½½å™¨åŠ è½½â¾ƒâ¼°çš„è¯å°±ä¼šå‡ºç°â¼€äº›é—®é¢˜ï¼Œâ½å¦‚æˆ‘ä»¬ç¼–å†™â¼€ä¸ªç§°ä¸º  java.lang.Object ç±»çš„è¯ï¼Œé‚£ä¹ˆç¨‹åºè¿â¾çš„æ—¶å€™ï¼Œç³»ç»Ÿå°±ä¼šå‡ºç°å¤šä¸ªä¸åŒçš„Object ç±»ã€‚</p><p><strong>ç ´ååŒäº²å§”æ´¾æœºåˆ¶ï¼š</strong></p><ul><li><p>å¯ä»¥â¾ƒâ¼°å®šä¹‰â¼€ä¸ªç±»åŠ è½½å™¨ï¼Œé‡å†™loadClassæ–¹æ³•ï¼›</p></li><li><p>Tomcat å¯ä»¥åŠ è½½è‡ªå·±ç›®å½•ä¸‹çš„ class æ–‡ä»¶ï¼Œå¹¶ä¸ä¼šä¼ é€’ç»™çˆ¶ç±»çš„åŠ è½½å™¨ï¼›</p></li><li><p>Java çš„ SPIï¼Œå‘èµ·è€… BootstrapClassLoader å·²ç»æ˜¯æœ€ä¸Šå±‚äº†ï¼Œå®ƒç›´æ¥è·å–äº† AppClassLoader è¿›è¡Œé©±åŠ¨åŠ è½½ï¼Œå’ŒåŒäº²å§”æ´¾æ˜¯ç›¸åçš„ã€‚</p></li></ul><h4 id="2ã€tomcatçš„ç±»åŠ è½½æœºåˆ¶"><a href="#2ã€tomcatçš„ç±»åŠ è½½æœºåˆ¶" class="headerlink" title="2ã€tomcatçš„ç±»åŠ è½½æœºåˆ¶"></a><strong>2ã€tomcatçš„ç±»åŠ è½½æœºåˆ¶</strong></h4><p><strong>æ­¥éª¤ï¼š</strong></p><ol><li>å…ˆåœ¨æœ¬åœ°cacheæŸ¥æ‰¾è¯¥ç±»æ˜¯å¦å·²ç»åŠ è½½è¿‡ï¼Œçœ‹çœ‹ Tomcat æœ‰æ²¡æœ‰åŠ è½½è¿‡è¿™ä¸ªç±»ã€‚</li><li>å¦‚æœTomcat æ²¡æœ‰åŠ è½½è¿‡è¿™ä¸ªç±»ï¼Œåˆ™ä»ç³»ç»Ÿç±»åŠ è½½å™¨çš„cacheä¸­æŸ¥æ‰¾æ˜¯å¦åŠ è½½è¿‡ã€‚</li><li>å¦‚æœæ²¡æœ‰åŠ è½½è¿‡è¿™ä¸ªç±»ï¼Œå°è¯•ç”¨ExtClassLoaderç±»åŠ è½½å™¨ç±»åŠ è½½ï¼Œé‡ç‚¹æ¥äº†ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰é¦–å…ˆä½¿ç”¨ AppClassLoader æ¥åŠ è½½ç±»ã€‚è¿™ä¸ªTomcat çš„ WebAPPClassLoader è¿èƒŒäº†åŒäº²å§”æ´¾æœºåˆ¶ï¼Œç›´æ¥ä½¿ç”¨äº† ExtClassLoaderæ¥åŠ è½½ç±»ã€‚è¿™é‡Œæ³¨æ„ ExtClassLoader åŒäº²å§”æ´¾ä¾ç„¶æœ‰æ•ˆï¼ŒExtClassLoader å°±ä¼šä½¿ç”¨ Bootstrap ClassLoader æ¥å¯¹ç±»è¿›è¡ŒåŠ è½½ï¼Œä¿è¯äº† Jre é‡Œé¢çš„æ ¸å¿ƒç±»ä¸ä¼šè¢«é‡å¤åŠ è½½ã€‚ æ¯”å¦‚åœ¨ Web ä¸­åŠ è½½ä¸€ä¸ª Object ç±»ã€‚WebAppClassLoader â†’ ExtClassLoader â†’ Bootstrap ClassLoaderï¼Œè¿™ä¸ªåŠ è½½é“¾ï¼Œå°±ä¿è¯äº† Object ä¸ä¼šè¢«é‡å¤åŠ è½½ã€‚</li><li>å¦‚æœ BoostrapClassLoaderï¼Œæ²¡æœ‰åŠ è½½æˆåŠŸï¼Œå°±ä¼šè°ƒç”¨è‡ªå·±çš„ findClass æ–¹æ³•ç”±è‡ªå·±æ¥å¯¹ç±»è¿›è¡ŒåŠ è½½ï¼ŒfindClass åŠ è½½ç±»çš„åœ°å€æ˜¯è‡ªå·±æœ¬ web åº”ç”¨ä¸‹çš„ classã€‚</li><li>åŠ è½½ä¾ç„¶å¤±è´¥ï¼Œæ‰ä½¿ç”¨ AppClassLoader ç»§ç»­åŠ è½½ã€‚</li><li>éƒ½æ²¡æœ‰åŠ è½½æˆåŠŸçš„è¯ï¼ŒæŠ›å‡ºå¼‚å¸¸ã€‚</li></ol><p>æ€»ç»“ä¸€ä¸‹ä»¥ä¸Šæ­¥éª¤ï¼ŒWebAppClassLoader åŠ è½½ç±»çš„æ—¶å€™ï¼Œæ•…æ„æ‰“ç ´äº†JVM åŒäº²å§”æ´¾æœºåˆ¶ï¼Œç»•å¼€äº† AppClassLoaderï¼Œç›´æ¥å…ˆä½¿ç”¨ ExtClassLoader æ¥åŠ è½½ç±»ã€‚</p><h3 id="JVMåƒåœ¾å›æ”¶"><a href="#JVMåƒåœ¾å›æ”¶" class="headerlink" title="JVMåƒåœ¾å›æ”¶"></a>JVMåƒåœ¾å›æ”¶</h3><h4 id="1ã€å­˜æ´»ç®—æ³•å’Œä¸¤æ¬¡æ ‡è®°è¿‡ç¨‹"><a href="#1ã€å­˜æ´»ç®—æ³•å’Œä¸¤æ¬¡æ ‡è®°è¿‡ç¨‹" class="headerlink" title="1ã€å­˜æ´»ç®—æ³•å’Œä¸¤æ¬¡æ ‡è®°è¿‡ç¨‹"></a><strong>1ã€å­˜æ´»ç®—æ³•å’Œä¸¤æ¬¡æ ‡è®°è¿‡ç¨‹</strong></h4><p><strong>å¼•ç”¨è®¡æ•°æ³•ï¼š</strong></p><p>â€‹ç»™å¯¹è±¡æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯å½“ç”±ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒæ—¶ï¼Œè®¡æ•°å™¨å€¼å°±åŠ 1ï¼›å½“å¼•ç”¨å¤±æ•ˆæ—¶ï¼Œè®¡æ•°å™¨å€¼å°±å‡1ï¼›ä»»ä½•æ—¶åˆ»è®¡æ•°å™¨ä¸º0çš„å¯¹è±¡å°±æ˜¯ä¸å¯èƒ½å†è¢«ä½¿ç”¨çš„ã€‚</p><p>â€‹ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œåˆ¤å®šæ•ˆç‡ä¹Ÿå¾ˆé«˜</p><p>â€‹ç¼ºç‚¹ï¼šä»–å¾ˆéš¾è§£å†³å¯¹è±¡ä¹‹é—´ç›¸äº’å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼ŒåŸºæœ¬ä¸Šè¢«æŠ›å¼ƒ</p><p><strong>å¯è¾¾æ€§åˆ†ææ³•ï¼š</strong></p><p>â€‹é€šè¿‡ä¸€ç³»åˆ—çš„æˆä¸ºâ€œGC Rootsâ€(æ´»åŠ¨çº¿ç¨‹ç›¸å…³çš„å„ç§å¼•ç”¨ï¼Œè™šæ‹Ÿæœº<strong>æ ˆå¸§å¼•ç”¨</strong>ï¼Œ<strong>é™æ€å˜é‡å¼•ç”¨</strong>ï¼Œ<strong>JNIå¼•ç”¨</strong>)çš„å¯¹è±¡ä½œä¸ºèµ·å§‹ç‚¹ï¼Œä»è¿™äº›èŠ‚ç‚¹ReferenceChainså¼€å§‹å‘ä¸‹æœç´¢ï¼Œæœç´¢æ‰€èµ°è¿‡çš„è·¯å¾„æˆä¸ºå¼•ç”¨é“¾ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åˆ°GC ROOTSæ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿æ—¶ï¼Œåˆ™è¯æ˜æ­¤å¯¹è±¡æ—¶ä¸å¯ç”¨çš„ï¼›</p><p><strong>ä¸¤æ¬¡æ ‡è®°è¿‡ç¨‹ï¼š</strong></p><p>â€‹å¯¹è±¡è¢«å›æ”¶ä¹‹å‰ï¼Œè¯¥å¯¹è±¡çš„finalize()æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼›ä¸¤æ¬¡æ ‡è®°ï¼Œå³ç¬¬ä¸€æ¬¡æ ‡è®°ä¸åœ¨â€œå…³ç³»ç½‘â€ä¸­çš„å¯¹è±¡ã€‚ç¬¬äºŒæ¬¡çš„è¯å°±è¦å…ˆåˆ¤æ–­è¯¥å¯¹è±¡æœ‰æ²¡æœ‰å®ç°finalize()æ–¹æ³•äº†ï¼Œå¦‚æœæ²¡æœ‰å®ç°å°±ç›´æ¥åˆ¤æ–­è¯¥å¯¹è±¡å¯å›æ”¶ï¼›å¦‚æœå®ç°äº†å°±ä¼šå…ˆæ”¾åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œå¹¶ç”±è™šæ‹Ÿæœºå»ºç«‹çš„ä¸€ä¸ªä½ä¼˜å…ˆçº§çš„çº¿ç¨‹å»æ‰§è¡Œå®ƒï¼Œéšåå°±ä¼šè¿›è¡Œç¬¬äºŒæ¬¡çš„å°è§„æ¨¡æ ‡è®°ï¼Œåœ¨è¿™æ¬¡è¢«æ ‡è®°çš„å¯¹è±¡å°±ä¼šçœŸæ­£çš„è¢«å›æ”¶äº†ã€‚</p><h4 id="2ã€åƒåœ¾å›æ”¶ç®—æ³•"><a href="#2ã€åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="2ã€åƒåœ¾å›æ”¶ç®—æ³•"></a><strong>2ã€åƒåœ¾å›æ”¶ç®—æ³•</strong></h4><p><strong>åƒåœ¾å›æ”¶ç®—æ³•</strong>ï¼šå¤åˆ¶ç®—æ³•ã€æ ‡è®°æ¸…é™¤ã€æ ‡è®°æ•´ç†ã€åˆ†ä»£æ”¶é›†</p><p><strong>å¤åˆ¶ç®—æ³•ï¼š(young)</strong></p><p>â€‹å°†å†…å­˜åˆ†ä¸ºâ¼¤â¼©ç›¸åŒçš„ä¸¤å—ï¼Œæ¯æ¬¡ä½¿â½¤å…¶ä¸­çš„â¼€å—ã€‚å½“è¿™â¼€å—çš„å†…å­˜ä½¿â½¤å®Œåï¼Œå°±å°†è¿˜å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦â¼€å—å»ï¼Œç„¶åå†æŠŠä½¿â½¤çš„ç©ºé—´â¼€æ¬¡æ¸…ç†æ‰ã€‚è¿™æ ·å°±ä½¿æ¯æ¬¡çš„å†…å­˜å›æ”¶éƒ½æ˜¯å¯¹å†…å­˜åŒºé—´çš„â¼€åŠè¿›â¾å›æ”¶ï¼›</p><p>â€‹ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œå†…å­˜æ•ˆç‡é«˜ï¼Œä¸æ˜“äº§ç”Ÿç¢ç‰‡</p><p>â€‹ç¼ºç‚¹ï¼šå†…å­˜å‹ç¼©äº†ä¸€åŠï¼Œå€˜è‹¥å­˜æ´»å¯¹è±¡å¤šï¼ŒCopying ç®—æ³•çš„æ•ˆç‡ä¼šå¤§å¤§é™ä½</p><p><strong>æ ‡è®°æ¸…é™¤ï¼š(cms)</strong></p><p>â€‹æ ‡è®°å‡ºæ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œåœ¨æ ‡è®°å®Œæˆåç»Ÿâ¼€å›æ”¶æ‰€æœ‰è¢«æ ‡è®°çš„å¯¹è±¡</p><p>â€‹ç¼ºç‚¹ï¼šæ•ˆç‡ä½ï¼Œæ ‡è®°æ¸…é™¤åä¼šäº§â½£â¼¤é‡ä¸è¿ç»­çš„ç¢â½šï¼Œéœ€è¦é¢„ç•™ç©ºé—´ç»™åˆ†é…é˜¶æ®µçš„æµ®åŠ¨åƒåœ¾</p><p><strong>æ ‡è®°æ•´ç†ï¼š(old)</strong></p><p>â€‹æ ‡è®°è¿‡ç¨‹ä»ç„¶ä¸â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•â¼€æ ·ï¼Œå†è®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å‘â¼€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ï¼›è§£å†³äº†äº§ç”Ÿå¤§é‡ä¸è¿ç»­ç¢ç‰‡é—®é¢˜</p><p><strong>åˆ†ä»£æ”¶é›†ï¼š</strong></p><p>â€‹æ ¹æ®å„ä¸ªå¹´ä»£çš„ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„åƒåœ¾æ”¶é›†ç®—æ³•ã€‚</p><p>â€‹æ–°ç”Ÿä»£é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼Œæ–°ç”Ÿä»£æ¯æ¬¡åƒåœ¾å›æ”¶éƒ½è¦å›æ”¶å¤§éƒ¨åˆ†å¯¹è±¡ï¼Œå­˜æ´»å¯¹è±¡è¾ƒå°‘ï¼Œå³è¦å¤åˆ¶çš„æ“ä½œæ¯”è¾ƒå°‘ï¼Œä¸€èˆ¬å°†æ–°ç”Ÿä»£åˆ’åˆ†ä¸ºä¸€å—è¾ƒå¤§çš„ Eden ç©ºé—´å’Œä¸¤ä¸ªè¾ƒå°çš„ Survivor ç©ºé—´(From Space, To Space)ï¼Œæ¯æ¬¡ä½¿ç”¨Eden ç©ºé—´å’Œå…¶ä¸­çš„ä¸€å— Survivor ç©ºé—´ï¼Œå½“è¿›è¡Œå›æ”¶æ—¶ï¼Œå°†è¯¥ä¸¤å—ç©ºé—´ä¸­è¿˜å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å— Survivor ç©ºé—´ä¸­ã€‚</p><p>â€‹è€å¹´ä»£çš„å¯¹è±¡å­˜æ´»â¼ç‡æ˜¯â½è¾ƒâ¾¼çš„ï¼Œâ½½ä¸”æ²¡æœ‰é¢å¤–çš„ç©ºé—´å¯¹å®ƒè¿›â¾åˆ†é…æ‹…ä¿ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»é€‰æ‹©â€œæ ‡è®°-æ¸…é™¤â€æˆ–â€œæ ‡è®°-æ•´ç†â€ç®—æ³•è¿›â¾åƒåœ¾æ”¶é›†ã€‚</p><p><strong>Safepoint</strong> å½“å‘ç”Ÿ GC æ—¶ï¼Œç”¨æˆ·çº¿ç¨‹å¿…é¡»å…¨éƒ¨åœä¸‹æ¥ï¼Œæ‰å¯ä»¥è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œè¿™ä¸ªçŠ¶æ€æˆ‘ä»¬å¯ä»¥è®¤ä¸º JVM æ˜¯å®‰å…¨çš„ï¼ˆsafeï¼‰ï¼Œæ•´ä¸ªå †çš„çŠ¶æ€æ˜¯ç¨³å®šçš„ã€‚å¦‚æœåœ¨ GC å‰ï¼Œæœ‰çº¿ç¨‹è¿Ÿè¿Ÿè¿›å…¥ä¸äº† safepointï¼Œé‚£ä¹ˆæ•´ä¸ª JVM éƒ½åœ¨ç­‰å¾…è¿™ä¸ªé˜»å¡çš„çº¿ç¨‹ï¼Œé€ æˆäº†æ•´ä½“ GC çš„æ—¶é—´å˜é•¿</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gobnmip32vj30l109q0t3.jpg" alt="img"></p><h5 id="MinorGCã€MajorGCã€FullGC"><a href="#MinorGCã€MajorGCã€FullGC" class="headerlink" title="MinorGCã€MajorGCã€FullGC"></a><strong>MinorGCã€MajorGCã€FullGC</strong></h5><p><strong>MinorGC</strong> åœ¨å¹´è½»ä»£ç©ºé—´ä¸è¶³çš„æ—¶å€™å‘ç”Ÿï¼Œ</p><p><strong>MajorGC</strong> æŒ‡çš„æ˜¯è€å¹´ä»£çš„ GCï¼Œå‡ºç° MajorGC ä¸€èˆ¬ç»å¸¸ä¼´æœ‰ MinorGCã€‚</p><p><strong>FullGC</strong> 1ã€å½“è€å¹´ä»£æ— æ³•å†åˆ†é…å†…å­˜çš„æ—¶å€™ï¼›2ã€å…ƒç©ºé—´ä¸è¶³çš„æ—¶å€™ï¼›3ã€æ˜¾ç¤ºè°ƒç”¨ System.gc çš„æ—¶å€™ã€‚å¦å¤–ï¼Œåƒ CMS ä¸€ç±»çš„åƒåœ¾å›æ”¶å™¨ï¼Œåœ¨ MinorGC å‡ºç° promotion failure çš„æ—¶å€™ä¹Ÿä¼šå‘ç”Ÿ FullGCã€‚</p><p><strong>å¯¹è±¡ä¼˜å…ˆåœ¨ Eden åŒºåˆ†é…</strong><br>    å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯¹è±¡åœ¨æ–°ç”Ÿä»£ Eden åŒºåˆ†é…ï¼Œå½“ Eden åŒºç©ºé—´ä¸å¤Ÿæ—¶ï¼Œå‘èµ· Minor GCã€‚</p><p><strong>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£</strong><br>    å¤§å¯¹è±¡æ˜¯æŒ‡éœ€è¦è¿ç»­å†…å­˜ç©ºé—´çš„å¯¹è±¡ï¼Œæ¯”å¦‚å¾ˆé•¿çš„å­—ç¬¦ä¸²ä»¥åŠæ•°ç»„ã€‚è€å¹´ä»£ç›´æ¥åˆ†é…çš„<strong>ç›®çš„æ˜¯</strong>é¿å…åœ¨ Eden åŒºå’Œ Survivor åŒºä¹‹é—´å‡ºç°å¤§é‡å†…å­˜å¤åˆ¶ã€‚</p><p><strong>é•¿æœŸå­˜æ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£</strong><br>    è™šæ‹Ÿæœºç»™æ¯ä¸ªå¯¹è±¡å®šä¹‰äº†å¹´é¾„è®¡æ•°å™¨ï¼Œå¯¹è±¡åœ¨ Eden åŒºå‡ºç”Ÿä¹‹åï¼Œå¦‚æœç»è¿‡ä¸€æ¬¡ Minor GC ä¹‹åï¼Œå°†è¿›å…¥ Survivor åŒºï¼ŒåŒæ—¶å¯¹è±¡å¹´é¾„å˜ä¸º 1ï¼Œå¢åŠ åˆ°ä¸€å®šé˜ˆå€¼æ—¶åˆ™è¿›å…¥è€å¹´ä»£ï¼ˆé˜ˆå€¼é»˜è®¤ä¸º 15ï¼‰</p><p><strong>åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®š</strong><br>    ä¸ºäº†èƒ½æ›´å¥½åœ°é€‚åº”ä¸åŒç¨‹åºçš„å†…å­˜çŠ¶å†µï¼Œè™šæ‹Ÿæœºå¹¶ä¸æ€»æ˜¯è¦æ±‚å¯¹è±¡çš„å¹´é¾„å¿…é¡»è¾¾åˆ°é˜ˆå€¼æ‰èƒ½è¿›å…¥è€å¹´ä»£ã€‚å¦‚æœåœ¨ Survivor åŒºä¸­ç›¸åŒå¹´é¾„çš„æ‰€æœ‰å¯¹è±¡çš„ç©ºé—´æ€»å’Œå¤§äº Survivor åŒºç©ºé—´çš„ä¸€åŠï¼Œåˆ™å¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚</p><p><strong>ç©ºé—´åˆ†é…æ‹…ä¿</strong><br>    åœ¨å‘ç”Ÿ Minor GC ä¹‹å‰ï¼Œè™šæ‹Ÿæœºä¼šå…ˆæ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºæ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡çš„ç©ºé—´æ€»å’Œï¼Œå¦‚æœè¿™ä¸ªæ¡ä»¶æˆç«‹ï¼Œé‚£ä¹ˆ Minor GC å¯ä»¥ç¡®ä¿æ˜¯å®‰å…¨çš„ã€‚å¦‚æœä¸æˆç«‹åˆ™è¿›è¡Œ Full GCã€‚</p><h4 id="3ã€åƒåœ¾æ”¶é›†å™¨"><a href="#3ã€åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="3ã€åƒåœ¾æ”¶é›†å™¨"></a><strong>3ã€åƒåœ¾æ”¶é›†å™¨</strong></h4><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gobnjx3zcej30l10ctaat.jpg" alt="img"></p><p>â€‹<strong>JDK3ï¼šSerial Parnew å…³æ³¨æ•ˆç‡</strong></p><p><strong>Serialï¼š</strong></p><p>â€‹Serial æ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„æ”¶é›†å™¨ï¼Œå®ƒä¸ä½†åªä¼šä½¿ç”¨ä¸€ä¸ª CPU æˆ–ä¸€æ¡çº¿ç¨‹å»å®Œæˆåƒåœ¾æ”¶é›†å·¥ä½œï¼Œå¹¶ä¸”åœ¨è¿›è¡Œåƒåœ¾æ”¶é›†çš„åŒæ—¶ï¼Œå¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼Œç›´åˆ°åƒåœ¾æ”¶é›†ç»“æŸã€‚é€‚åˆç”¨äºå®¢æˆ·ç«¯åƒåœ¾æ”¶é›†å™¨ã€‚</p><p><strong>Parnewï¼š</strong></p><p>â€‹ParNew åƒåœ¾æ”¶é›†å™¨å…¶å®æ˜¯ Serial æ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œä¹Ÿä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œé™¤äº†ä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡Œåƒåœ¾æ”¶é›†ä¹‹å¤–ï¼Œå…¶ä½™çš„è¡Œä¸ºå’Œ Serial æ”¶é›†å™¨å®Œå…¨ä¸€æ ·ï¼ŒParNew åƒåœ¾æ”¶é›†å™¨åœ¨åƒåœ¾æ”¶é›†è¿‡ç¨‹ä¸­åŒæ ·ä¹Ÿè¦æš‚åœæ‰€æœ‰å…¶ä»–çš„å·¥ä½œçº¿ç¨‹ã€‚</p><p>â€‹<strong>JDK5ï¼šparallel Scavenge+ï¼ˆSerial old&#x2F;parallel oldï¼‰å…³æ³¨ååé‡</strong></p><p><strong>parallel Scavengeï¼š</strong>(å…³æ³¨ååé‡)</p><p>â€‹Parallel Scavengeæ”¶é›†å™¨å…³æ³¨ç‚¹æ˜¯ååé‡ï¼ˆâ¾¼æ•ˆç‡çš„åˆ©â½¤CPUï¼‰ã€‚CMSç­‰åƒåœ¾æ”¶é›†å™¨çš„å…³æ³¨ç‚¹æ›´å¤šçš„æ˜¯â½¤æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´ï¼ˆæâ¾¼â½¤æˆ·ä½“éªŒï¼‰ï¼›é«˜ååé‡å¯ä»¥æœ€é«˜æ•ˆç‡åœ°åˆ©ç”¨ CPU æ—¶é—´ï¼Œå°½å¿«åœ°å®Œæˆç¨‹åºçš„è¿ç®—ä»»åŠ¡ï¼Œä¸»è¦é€‚ç”¨äºåœ¨åå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡ã€‚</p><p><strong>Serial oldï¼š</strong></p><p>Serialæ”¶é›†å™¨çš„â½¼å¹´ä»£ç‰ˆæœ¬ï¼Œå®ƒåŒæ ·æ˜¯â¼€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨ï¼Œä½¿ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ã€‚ä¸»è¦æœ‰ä¸¤ä¸ªç”¨é€”ï¼š</p><ul><li><p>åœ¨ JDK1.5 ä¹‹å‰ç‰ˆæœ¬ä¸­ä¸æ–°ç”Ÿä»£çš„ Parallel Scavenge æ”¶é›†å™¨æ­é…ä½¿ç”¨ã€‚</p></li><li><p>ä½œä¸ºå¹´è€ä»£ä¸­ä½¿ç”¨ CMS æ”¶é›†å™¨çš„åå¤‡åƒåœ¾æ”¶é›†æ–¹æ¡ˆã€‚</p></li></ul><p><strong>parallel oldï¼š</strong></p><p>â€‹Parallel Scavengeæ”¶é›†å™¨çš„â½¼å¹´ä»£ç‰ˆæœ¬ã€‚ä½¿â½¤å¤šçº¿ç¨‹å’Œâ€œæ ‡è®°-æ•´ç†â€ç®—æ³•ã€‚</p><p><strong>JDK8-CMSï¼šï¼ˆå…³æ³¨æœ€çŸ­åƒåœ¾å›æ”¶åœé¡¿æ—¶é—´ï¼‰</strong></p><p>â€‹CMSæ”¶é›†å™¨æ˜¯ä¸€ç§å¹´è€ä»£åƒåœ¾æ”¶é›†å™¨ï¼Œå…¶æœ€ä¸»è¦ç›®æ ‡æ˜¯è·å–<strong>æœ€çŸ­åƒåœ¾å›æ”¶åœé¡¿æ—¶é—´</strong>ï¼Œå’Œå…¶ä»–å¹´è€ä»£ä½¿ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ä¸åŒï¼Œå®ƒä½¿ç”¨å¤šçº¿ç¨‹çš„æ ‡è®°-æ¸…é™¤ç®—æ³•ã€‚æœ€çŸ­çš„åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´å¯ä»¥ä¸ºäº¤äº’æ¯”è¾ƒé«˜çš„ç¨‹åºæé«˜ç”¨æˆ·ä½“éªŒã€‚CMS å·¥ä½œæœºåˆ¶ç›¸æ¯”å…¶ä»–çš„åƒåœ¾æ”¶é›†å™¨æ¥è¯´æ›´å¤æ‚ï¼Œæ•´ä¸ªè¿‡ç¨‹åˆ†ä¸ºä»¥ä¸‹ 4 ä¸ªé˜¶æ®µï¼š</p><p>â€‹<strong>åˆå§‹æ ‡è®°ï¼š</strong>åªæ˜¯æ ‡è®°ä¸€ä¸‹ GC Roots èƒ½ç›´æ¥å…³è”çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼ŒSTWã€‚</p><p>â€‹<strong>å¹¶å‘æ ‡è®°ï¼š</strong>è¿›è¡Œ ReferenceChainsè·Ÿè¸ªçš„è¿‡ç¨‹ï¼Œå’Œç”¨æˆ·çº¿ç¨‹ä¸€èµ·å·¥ä½œï¼Œä¸éœ€è¦æš‚åœå·¥ä½œçº¿ç¨‹ã€‚</p><p>â€‹<strong>é‡æ–°æ ‡è®°ï¼š</strong>ä¸ºäº†ä¿®æ­£åœ¨å¹¶å‘æ ‡è®°æœŸé—´ï¼Œå› ç”¨æˆ·ç¨‹åºç»§ç»­è¿è¡Œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼ŒSTWã€‚</p><p>â€‹<strong>å¹¶å‘æ¸…é™¤ï¼š</strong>æ¸…é™¤ GC Roots ä¸å¯è¾¾å¯¹è±¡ï¼Œå’Œç”¨æˆ·çº¿ç¨‹ä¸€èµ·å·¥ä½œï¼Œä¸éœ€è¦æš‚åœå·¥ä½œçº¿ç¨‹ã€‚</p><p>â€‹ç”±äºè€—æ—¶æœ€é•¿çš„å¹¶å‘æ ‡è®°å’Œå¹¶å‘æ¸…é™¤è¿‡ç¨‹ä¸­ï¼Œåƒåœ¾æ”¶é›†çº¿ç¨‹å¯ä»¥å’Œç”¨æˆ·ç°åœ¨ä¸€èµ·å¹¶å‘å·¥ä½œï¼Œæ‰€ä»¥æ€»ä½“ä¸Šæ¥çœ‹CMS æ”¶é›†å™¨çš„å†…å­˜å›æ”¶å’Œç”¨æˆ·çº¿ç¨‹æ˜¯ä¸€èµ·å¹¶å‘åœ°æ‰§è¡Œã€‚</p><p>â€‹<strong>ä¼˜ç‚¹ï¼š</strong>å¹¶å‘æ”¶é›†ã€ä½åœé¡¿</p><p>â€‹<strong>ç¼ºç‚¹ï¼š</strong>å¯¹CPUèµ„æºæ•æ„Ÿï¼›â½†æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ï¼›ä½¿â½¤â€œæ ‡è®°æ¸…é™¤â€ç®—æ³•ï¼Œä¼šå¯¼è‡´â¼¤é‡ç©ºé—´ç¢â½šäº§â½£ã€‚</p><p><strong>JDK9-G1ï¼šï¼ˆç²¾å‡†æ§åˆ¶åœé¡¿æ—¶é—´ï¼Œé¿å…åƒåœ¾ç¢ç‰‡ï¼‰</strong></p><p>â€‹æ˜¯â¼€æ¬¾â¾¯å‘æœåŠ¡å™¨çš„åƒåœ¾æ”¶é›†å™¨,ä¸»è¦é’ˆå¯¹é…å¤‡å¤šé¢—å¤„ç†å™¨åŠâ¼¤å®¹é‡å†…å­˜çš„æœºå™¨.ä»¥æâ¾¼æ¦‚ç‡æ»¡â¾œGCåœé¡¿æ—¶é—´è¦æ±‚çš„åŒæ—¶,è¿˜å…·å¤‡â¾¼ååé‡æ€§èƒ½ç‰¹å¾ï¼›ç›¸æ¯”ä¸ CMS æ”¶é›†å™¨ï¼ŒG1 æ”¶é›†å™¨ä¸¤ä¸ªæœ€çªå‡ºçš„æ”¹è¿›æ˜¯ï¼š</p><p>â€‹ã€1ã€‘åŸºäºæ ‡è®°-æ•´ç†ç®—æ³•ï¼Œä¸äº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚</p><p>â€‹ã€2ã€‘å¯ä»¥éå¸¸ç²¾ç¡®æ§åˆ¶åœé¡¿æ—¶é—´ï¼Œåœ¨ä¸ç‰ºç‰²ååé‡å‰æä¸‹ï¼Œå®ç°ä½åœé¡¿åƒåœ¾å›æ”¶ã€‚</p><p>â€‹G1 æ”¶é›†å™¨é¿å…å…¨åŒºåŸŸåƒåœ¾æ”¶é›†ï¼Œå®ƒæŠŠå †å†…å­˜åˆ’åˆ†ä¸ºå¤§å°å›ºå®šçš„å‡ ä¸ªç‹¬ç«‹åŒºåŸŸï¼Œå¹¶ä¸”è·Ÿè¸ªè¿™äº›åŒºåŸŸçš„åƒåœ¾æ”¶é›†è¿›åº¦ï¼ŒåŒæ—¶åœ¨åå°ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆçº§åˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®æ‰€å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆå›æ”¶åƒåœ¾æœ€å¤šçš„åŒºåŸŸã€‚<strong>åŒºåŸŸåˆ’åˆ†</strong>å’Œ<strong>ä¼˜å…ˆçº§åŒºåŸŸ</strong>å›æ”¶æœºåˆ¶ï¼Œç¡®ä¿ G1 æ”¶é›†å™¨å¯ä»¥åœ¨æœ‰é™æ—¶é—´è·å¾—æœ€é«˜çš„åƒåœ¾æ”¶é›†æ•ˆç‡ã€‚</p><ul><li><p><strong>åˆå§‹æ ‡è®°</strong>ï¼š<strong>Stop The Worldï¼Œ</strong>ä»…ä½¿ç”¨ä¸€æ¡åˆå§‹æ ‡è®°çº¿ç¨‹å¯¹GC Rootså…³è”çš„å¯¹è±¡è¿›è¡Œæ ‡è®°</p></li><li><p><strong>å¹¶å‘æ ‡è®°</strong>ï¼šä½¿ç”¨ä¸€æ¡æ ‡è®°çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚æ­¤è¿‡ç¨‹è¿›è¡Œ<strong>å¯è¾¾æ€§åˆ†æï¼Œé€Ÿåº¦å¾ˆæ…¢</strong></p></li><li><p><strong>æœ€ç»ˆæ ‡è®°</strong>ï¼š<strong>Stop The World</strong>ï¼Œä½¿ç”¨å¤šæ¡æ ‡è®°çº¿ç¨‹å¹¶å‘æ‰§è¡Œ</p></li><li><p><strong>ç­›é€‰å›æ”¶</strong>ï¼šå›æ”¶åºŸå¼ƒå¯¹è±¡ï¼Œæ­¤æ—¶ä¹Ÿè¦ <strong>Stop The World</strong>ï¼Œå¹¶ä½¿ç”¨å¤šæ¡ç­›é€‰å›æ”¶çº¿ç¨‹å¹¶å‘æ‰§è¡Œ</p></li></ul><p>**JDK11-ZGC:**ï¼ˆåœ¨ä¸å…³æ³¨å®¹é‡çš„æƒ…å†µè·å–æœ€å°åœé¡¿æ—¶é—´5TB&#x2F;10msï¼‰</p><p>â€‹ç€è‰²ç¬”æŠ€æœ¯ï¼šåŠ å¿«æ ‡è®°è¿‡ç¨‹</p><p>â€‹è¯»å±éšœï¼šè§£å†³GCå’Œåº”ç”¨ä¹‹é—´å¹¶å‘å¯¼è‡´çš„STWé—®é¢˜</p><ul><li><p>æ”¯æŒ TB çº§å †å†…å­˜ï¼ˆæœ€å¤§ 4Tï¼Œ JDK13 æœ€å¤§16TBï¼‰</p></li><li><p>æœ€å¤§ GC åœé¡¿ 10ms</p></li><li><p>å¯¹ååé‡å½±å“æœ€å¤§ï¼Œä¸è¶…è¿‡ 15%</p></li></ul><h4 id="4ã€é…ç½®åƒåœ¾æ”¶é›†å™¨"><a href="#4ã€é…ç½®åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="4ã€é…ç½®åƒåœ¾æ”¶é›†å™¨"></a><strong>4ã€é…ç½®åƒåœ¾æ”¶é›†å™¨</strong></h4><ul><li>é¦–å…ˆæ˜¯å†…å­˜å¤§å°é—®é¢˜ï¼ŒåŸºæœ¬ä¸Šæ¯ä¸€ä¸ªå†…å­˜åŒºåŸŸæˆ‘éƒ½ä¼šè®¾ç½®ä¸€ä¸ªä¸Šé™ï¼Œæ¥é¿å…æº¢å‡ºé—®é¢˜ï¼Œæ¯”å¦‚å…ƒç©ºé—´ã€‚</li><li>é€šå¸¸ï¼Œå †ç©ºé—´æˆ‘ä¼šè®¾ç½®æˆæ“ä½œç³»ç»Ÿçš„ 2&#x2F;3ï¼Œè¶…è¿‡ 8GB çš„å †ï¼Œä¼˜å…ˆé€‰ç”¨ G1</li><li>ç„¶åæˆ‘ä¼šå¯¹ JVM è¿›è¡Œåˆæ­¥ä¼˜åŒ–ï¼Œæ¯”å¦‚æ ¹æ®è€å¹´ä»£çš„å¯¹è±¡æå‡é€Ÿåº¦ï¼Œæ¥è°ƒæ•´å¹´è½»ä»£å’Œè€å¹´ä»£ä¹‹é—´çš„æ¯”ä¾‹</li><li>ä¾æ®ç³»ç»Ÿå®¹é‡ã€è®¿é—®å»¶è¿Ÿã€ååé‡ç­‰è¿›è¡Œä¸“é¡¹ä¼˜åŒ–ï¼Œæˆ‘ä»¬çš„æœåŠ¡æ˜¯é«˜å¹¶å‘çš„ï¼Œå¯¹ STW çš„æ—¶é—´æ•æ„Ÿ</li><li>æˆ‘ä¼šé€šè¿‡è®°å½•è¯¦ç»†çš„ GC æ—¥å¿—ï¼Œæ¥æ‰¾åˆ°è¿™ä¸ªç“¶é¢ˆç‚¹ï¼Œå€Ÿç”¨ GCeasy è¿™æ ·çš„æ—¥å¿—åˆ†æå·¥å…·ï¼Œå®šä½é—®é¢˜</li></ul><h4 id="4ã€JVMæ€§èƒ½è°ƒä¼˜"><a href="#4ã€JVMæ€§èƒ½è°ƒä¼˜" class="headerlink" title="4ã€JVMæ€§èƒ½è°ƒä¼˜"></a><strong>4ã€JVMæ€§èƒ½è°ƒä¼˜</strong></h4><p>å¯¹åº”è¿›ç¨‹çš„JVMçŠ¶æ€ä»¥å®šä½é—®é¢˜å’Œè§£å†³é—®é¢˜å¹¶ä½œå‡ºç›¸åº”çš„ä¼˜åŒ–</p><p><strong>å¸¸ç”¨å‘½ä»¤ï¼š</strong>jpsã€jinfoã€jstatã€jstackã€jmap</p><p><strong>jpsï¼šæŸ¥çœ‹javaè¿›ç¨‹åŠç›¸å…³ä¿¡æ¯</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jps -l è¾“å‡ºjaråŒ…è·¯å¾„ï¼Œç±»å…¨å</span><br><span class="line">jps -m è¾“å‡ºmainå‚æ•°</span><br><span class="line">jps -v è¾“å‡ºJVMå‚æ•°</span><br></pre></td></tr></table></figure><p><strong>jinfoï¼šæŸ¥çœ‹JVMå‚æ•°</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jinfo <span class="number">11666</span></span><br><span class="line">jinfo -flags <span class="number">11666</span></span><br><span class="line">Xmxã€Xmsã€Xmnã€MetaspaceSize</span><br></pre></td></tr></table></figure><p><strong>jstatï¼šæŸ¥çœ‹JVMè¿è¡Œæ—¶çš„çŠ¶æ€ä¿¡æ¯ï¼ŒåŒ…æ‹¬å†…å­˜çŠ¶æ€ã€åƒåœ¾å›æ”¶</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">jstat [option] LVMID [interval] [count]</span><br><span class="line">å…¶ä¸­LVMIDæ˜¯è¿›ç¨‹idï¼Œintervalæ˜¯æ‰“å°é—´éš”æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œcountæ˜¯æ‰“å°æ¬¡æ•°ï¼ˆé»˜è®¤ä¸€ç›´æ‰“å°ï¼‰</span><br><span class="line">  </span><br><span class="line">optionå‚æ•°è§£é‡Šï¼š</span><br><span class="line">-gc åƒåœ¾å›æ”¶å †çš„è¡Œä¸ºç»Ÿè®¡</span><br><span class="line">-gccapacity å„ä¸ªåƒåœ¾å›æ”¶ä»£å®¹é‡(young,old,perm)å’Œä»–ä»¬ç›¸åº”çš„ç©ºé—´ç»Ÿè®¡</span><br><span class="line">-gcutil åƒåœ¾å›æ”¶ç»Ÿè®¡æ¦‚è¿°</span><br><span class="line">-gcnew æ–°ç”Ÿä»£è¡Œä¸ºç»Ÿè®¡</span><br><span class="line">-gcold å¹´è€ä»£å’Œæ°¸ç”Ÿä»£è¡Œä¸ºç»Ÿè®¡</span><br></pre></td></tr></table></figure><p><strong>jstackï¼šæŸ¥çœ‹JVMçº¿ç¨‹å¿«ç…§ï¼Œjstackå‘½ä»¤å¯ä»¥å®šä½çº¿ç¨‹å‡ºç°é•¿æ—¶é—´å¡é¡¿çš„åŸå› ï¼Œä¾‹å¦‚æ­»é”ï¼Œæ­»å¾ªç¯</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">jstack [-l] &lt;pid&gt; (è¿æ¥è¿è¡Œä¸­çš„è¿›ç¨‹)</span><br><span class="line">  </span><br><span class="line">optionå‚æ•°è§£é‡Šï¼š</span><br><span class="line">-F å½“ä½¿ç”¨jstack &lt;pid&gt;æ— å“åº”æ—¶ï¼Œå¼ºåˆ¶è¾“å‡ºçº¿ç¨‹å †æ ˆã€‚</span><br><span class="line">-m åŒæ—¶è¾“å‡ºjavaå’Œæœ¬åœ°å †æ ˆ(æ··åˆæ¨¡å¼)</span><br><span class="line">-l é¢å¤–æ˜¾ç¤ºé”ä¿¡æ¯</span><br></pre></td></tr></table></figure><p><strong>jmapï¼šå¯ä»¥ç”¨æ¥æŸ¥çœ‹å†…å­˜ä¿¡æ¯</strong>(é…åˆjhatä½¿ç”¨)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">jmap [option] &lt;pid&gt; (è¿æ¥æ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹)</span><br><span class="line"></span><br><span class="line">optionå‚æ•°è§£é‡Šï¼š</span><br><span class="line">-heap æ‰“å°java heapæ‘˜è¦</span><br><span class="line">-dump:&lt;dump-options&gt; ç”Ÿæˆjavaå †çš„dumpæ–‡ä»¶</span><br></pre></td></tr></table></figure><h4 id="5ã€JDKæ–°ç‰¹æ€§"><a href="#5ã€JDKæ–°ç‰¹æ€§" class="headerlink" title="5ã€JDKæ–°ç‰¹æ€§"></a>5ã€JDKæ–°ç‰¹æ€§</h4><p>JDK8</p><p>æ”¯æŒ Lamda è¡¨è¾¾å¼ã€é›†åˆçš„ stream æ“ä½œã€æå‡HashMapæ€§èƒ½</p><p><strong>JDK9</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Stream APIä¸­iterateæ–¹æ³•çš„æ–°é‡è½½æ–¹æ³•ï¼Œå¯ä»¥æŒ‡å®šä»€ä¹ˆæ—¶å€™ç»“æŸè¿­ä»£</span></span><br><span class="line">IntStream.iterate(<span class="number">1</span>, i -&gt; i &lt; <span class="number">100</span>, i -&gt; i + <span class="number">1</span>).forEach(System.out::println);</span><br></pre></td></tr></table></figure><p>é»˜è®¤G1åƒåœ¾å›æ”¶å™¨</p><p><strong>JDK10</strong> </p><p>å…¶é‡ç‚¹åœ¨äºé€šè¿‡å®Œå…¨GCå¹¶è¡Œæ¥æ”¹å–„G1æœ€åæƒ…å†µçš„ç­‰å¾…æ—¶é—´ã€‚</p><p><strong>JDK11</strong></p><p>ZGC (å¹¶å‘å›æ”¶çš„ç­–ç•¥) 4TB</p><p>ç”¨äº Lambda å‚æ•°çš„å±€éƒ¨å˜é‡è¯­æ³•</p><p><strong>JDK12</strong></p><p>Shenandoah GC (GC ç®—æ³•)åœé¡¿æ—¶é—´å’Œå †çš„å¤§å°æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œå¹¶è¡Œå…³æ³¨åœé¡¿å“åº”æ—¶é—´ã€‚</p><p><strong>JDK13</strong></p><p>å¢åŠ ZGCä»¥å°†æœªä½¿ç”¨çš„å †å†…å­˜è¿”å›ç»™æ“ä½œç³»ç»Ÿï¼Œ16TB</p><p><strong>JDK14</strong></p><p>åˆ é™¤cmsåƒåœ¾å›æ”¶å™¨ã€å¼ƒç”¨ParallelScavenge+SerialOldGCåƒåœ¾å›æ”¶ç®—æ³•ç»„åˆ</p><p>å°†ZGCåƒåœ¾å›æ”¶å™¨åº”ç”¨åˆ°macOSå’Œwindowså¹³å°</p><h3 id="çº¿ä¸Šæ•…éšœæ’æŸ¥"><a href="#çº¿ä¸Šæ•…éšœæ’æŸ¥" class="headerlink" title="çº¿ä¸Šæ•…éšœæ’æŸ¥"></a>çº¿ä¸Šæ•…éšœæ’æŸ¥</h3><h4 id="1ã€ç¡¬ä»¶æ•…éšœæ’æŸ¥"><a href="#1ã€ç¡¬ä»¶æ•…éšœæ’æŸ¥" class="headerlink" title="1ã€ç¡¬ä»¶æ•…éšœæ’æŸ¥"></a>1ã€ç¡¬ä»¶æ•…éšœæ’æŸ¥</h4><p>å¦‚æœä¸€ä¸ªå®ä¾‹å‘ç”Ÿäº†é—®é¢˜ï¼Œæ ¹æ®æƒ…å†µé€‰æ‹©ï¼Œè¦ä¸è¦ç€æ€¥å»é‡å¯ã€‚å¦‚æœå‡ºç°çš„CPUã€å†…å­˜é£™é«˜æˆ–è€…æ—¥å¿—é‡Œå‡ºç°äº†OOMå¼‚å¸¸</p><p><strong>ç¬¬ä¸€æ­¥æ˜¯éš”ç¦»</strong>ï¼Œç¬¬äºŒæ­¥æ˜¯<strong>ä¿ç•™ç°åœº</strong>ï¼Œç¬¬ä¸‰æ­¥æ‰æ˜¯<strong>é—®é¢˜æ’æŸ¥</strong>ã€‚</p><p><strong>éš”ç¦»</strong></p><p>å°±æ˜¯æŠŠä½ çš„è¿™å°æœºå™¨ä»è¯·æ±‚åˆ—è¡¨é‡Œæ‘˜é™¤ï¼Œæ¯”å¦‚æŠŠ nginx ç›¸å…³çš„æƒé‡è®¾æˆé›¶ã€‚</p><p><strong>ç°åœºä¿ç•™</strong></p><p><strong>ç¬æ—¶æ€å’Œå†å²æ€</strong></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gobnwy22d2j30l10cpt9d.jpg" alt="img"></p><p>æŸ¥çœ‹æ¯”å¦‚ CPUã€ç³»ç»Ÿå†…å­˜ç­‰ï¼Œé€šè¿‡å†å²çŠ¶æ€å¯ä»¥ä½“ç°ä¸€ä¸ªè¶‹åŠ¿æ€§é—®é¢˜ï¼Œè€Œè¿™äº›ä¿¡æ¯çš„è·å–ä¸€èˆ¬ä¾é ç›‘æ§ç³»ç»Ÿçš„åä½œã€‚           </p><p><strong>ä¿ç•™ä¿¡æ¯</strong></p><p>ï¼ˆ1ï¼‰<strong>ç³»ç»Ÿå½“å‰ç½‘ç»œè¿æ¥</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ss -antp &gt; $DUMP_DIR/ss.dump 2&gt;&amp;1</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ ss å‘½ä»¤è€Œä¸æ˜¯ netstat çš„åŸå› ï¼Œæ˜¯å› ä¸º netstat åœ¨ç½‘ç»œè¿æ¥éå¸¸å¤šçš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œéå¸¸ç¼“æ…¢ã€‚</p><p>åç»­çš„å¤„ç†ï¼Œå¯é€šè¿‡æŸ¥çœ‹å„ç§ç½‘ç»œè¿æ¥çŠ¶æ€çš„æ¢³ç†ï¼Œæ¥æ’æŸ¥ TIME_WAIT æˆ–è€… CLOSE_WAITï¼Œæˆ–è€…å…¶ä»–è¿æ¥è¿‡é«˜çš„é—®é¢˜ï¼Œéå¸¸æœ‰ç”¨ã€‚</p><p>ï¼ˆ2ï¼‰<strong>ç½‘ç»œçŠ¶æ€ç»Ÿè®¡</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -s &gt; $DUMP_DIR/netstat-s.dump <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br></pre></td></tr></table></figure><p>å®ƒèƒ½å¤ŸæŒ‰ç…§å„ä¸ªåè®®è¿›è¡Œç»Ÿè®¡è¾“å‡ºï¼Œå¯¹æŠŠæ¡å½“æ—¶æ•´ä¸ªç½‘ç»œçŠ¶æ€ï¼Œæœ‰éå¸¸å¤§çš„ä½œç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sar -n DEV <span class="number">1</span> <span class="number">2</span> &gt; $DUMP_DIR/sar-traffic.dump <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br></pre></td></tr></table></figure><p>åœ¨ä¸€äº›é€Ÿåº¦éå¸¸é«˜çš„æ¨¡å—ä¸Šï¼Œæ¯”å¦‚ Redisã€Kafkaï¼Œå°±ç»å¸¸å‘ç”Ÿè·‘æ»¡ç½‘å¡çš„æƒ…å†µã€‚è¡¨ç°å½¢å¼å°±æ˜¯ç½‘ç»œé€šä¿¡éå¸¸ç¼“æ…¢ã€‚</p><p>ï¼ˆ3ï¼‰<strong>è¿›ç¨‹èµ„æº</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof -p $PID &gt; $DUMP_DIR/lsof-$PID.dump</span><br></pre></td></tr></table></figure><p>é€šè¿‡æŸ¥çœ‹è¿›ç¨‹ï¼Œèƒ½çœ‹åˆ°æ‰“å¼€äº†å“ªäº›æ–‡ä»¶ï¼Œå¯ä»¥ä»¥è¿›ç¨‹çš„ç»´åº¦æ¥æŸ¥çœ‹æ•´ä¸ªèµ„æºçš„ä½¿ç”¨æƒ…å†µï¼ŒåŒ…æ‹¬æ¯æ¡ç½‘ç»œè¿æ¥ã€æ¯ä¸ªæ‰“å¼€çš„æ–‡ä»¶å¥æŸ„ã€‚åŒæ—¶ï¼Œä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“çš„çœ‹åˆ°è¿æ¥åˆ°äº†å“ªäº›æœåŠ¡å™¨ã€ä½¿ç”¨äº†å“ªäº›èµ„æºã€‚è¿™ä¸ªå‘½ä»¤åœ¨èµ„æºéå¸¸å¤šçš„æƒ…å†µä¸‹ï¼Œè¾“å‡ºç¨æ…¢ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚</p><p>ï¼ˆ4ï¼‰<strong>CPU èµ„æº</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mpstat &gt; $DUMP_DIR/mpstat.dump 2&gt;&amp;1</span><br><span class="line">vmstat 1 3 &gt; $DUMP_DIR/vmstat.dump 2&gt;&amp;1</span><br><span class="line">sar -p ALL  &gt; $DUMP_DIR/sar-cpu.dump  2&gt;&amp;1</span><br><span class="line">uptime &gt; $DUMP_DIR/uptime.dump 2&gt;&amp;1</span><br></pre></td></tr></table></figure><p>ä¸»è¦ç”¨äºè¾“å‡ºå½“å‰ç³»ç»Ÿçš„ CPU å’Œè´Ÿè½½ï¼Œä¾¿äºäº‹åæ’æŸ¥ã€‚</p><p>ï¼ˆ5ï¼‰<strong>I&#x2F;O èµ„æº</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iostat -x &gt; $DUMP_DIR/iostat.dump <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬ï¼Œä»¥è®¡ç®—ä¸ºä¸»çš„æœåŠ¡èŠ‚ç‚¹ï¼ŒI&#x2F;O èµ„æºä¼šæ¯”è¾ƒæ­£å¸¸ï¼Œä½†æœ‰æ—¶ä¹Ÿä¼šå‘ç”Ÿé—®é¢˜ï¼Œæ¯”å¦‚<strong>æ—¥å¿—è¾“å‡ºè¿‡å¤šï¼Œæˆ–è€…ç£ç›˜é—®é¢˜</strong>ç­‰ã€‚æ­¤å‘½ä»¤å¯ä»¥è¾“å‡ºæ¯å—ç£ç›˜çš„åŸºæœ¬æ€§èƒ½ä¿¡æ¯ï¼Œç”¨æ¥æ’æŸ¥ I&#x2F;O é—®é¢˜ã€‚åœ¨ç¬¬ 8 è¯¾æ—¶ä»‹ç»çš„ GC æ—¥å¿—åˆ†ç£ç›˜é—®é¢˜ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤å»å‘ç°ã€‚</p><p>ï¼ˆ6ï¼‰<strong>å†…å­˜é—®é¢˜</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">free -h &gt; $DUMP_DIR/free.dump <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br></pre></td></tr></table></figure><p>free å‘½ä»¤èƒ½å¤Ÿå¤§ä½“å±•ç°æ“ä½œç³»ç»Ÿçš„å†…å­˜æ¦‚å†µï¼Œè¿™æ˜¯æ•…éšœæ’æŸ¥ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„ç‚¹ï¼Œæ¯”å¦‚ SWAP å½±å“äº† GCï¼ŒSLAB åŒºæŒ¤å äº† JVM çš„å†…å­˜ã€‚</p><p>ï¼ˆ7ï¼‰<strong>å…¶ä»–å…¨å±€</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ps -ef &gt; $DUMP_DIR/ps.dump <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">dmesg &gt; $DUMP_DIR/dmesg.dump <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">sysctl -a &gt; $DUMP_DIR/sysctl.dump <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br></pre></td></tr></table></figure><p>dmesg æ˜¯è®¸å¤šé™æ‚„æ‚„æ­»æ‰çš„æœåŠ¡ç•™ä¸‹çš„æœ€åä¸€ç‚¹çº¿ç´¢ã€‚å½“ç„¶ï¼Œps ä½œä¸ºæ‰§è¡Œé¢‘ç‡æœ€é«˜çš„ä¸€ä¸ªå‘½ä»¤ï¼Œç”±äºå†…æ ¸çš„é…ç½®å‚æ•°ï¼Œä¼šå¯¹ç³»ç»Ÿå’Œ JVM äº§ç”Ÿå½±å“ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿè¾“å‡ºäº†ä¸€ä»½ã€‚</p><p>ï¼ˆ8ï¼‰<strong>è¿›ç¨‹å¿«ç…§</strong>ï¼Œæœ€åçš„é—è¨€ï¼ˆjinfoï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;JDK_BIN&#125;jinfo $PID &gt; $DUMP_DIR/jinfo.dump <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br></pre></td></tr></table></figure><p>æ­¤å‘½ä»¤å°†è¾“å‡º Java çš„åŸºæœ¬è¿›ç¨‹ä¿¡æ¯ï¼ŒåŒ…æ‹¬<strong>ç¯å¢ƒå˜é‡å’Œå‚æ•°é…ç½®</strong>ï¼Œå¯ä»¥æŸ¥çœ‹æ˜¯å¦å› ä¸ºä¸€äº›é”™è¯¯çš„é…ç½®é€ æˆäº† JVM é—®é¢˜ã€‚</p><p><strong>ï¼ˆ9ï¼‰dump å †ä¿¡æ¯</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$&#123;JDK_BIN&#125;jstat -gcutil $PID &gt; $DUMP_DIR/jstat-gcutil.dump <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">$&#123;JDK_BIN&#125;jstat -gccapacity $PID &gt; $DUMP_DIR/jstat-gccapacity.dump <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br></pre></td></tr></table></figure><p>jstat å°†è¾“å‡ºå½“å‰çš„ gc ä¿¡æ¯ã€‚ä¸€èˆ¬ï¼ŒåŸºæœ¬èƒ½å¤§ä½“çœ‹å‡ºä¸€ä¸ªç«¯å€ªï¼Œå¦‚æœä¸èƒ½ï¼Œå¯å°†å€ŸåŠ© jmap æ¥è¿›è¡Œåˆ†æã€‚</p><p><strong>ï¼ˆ10ï¼‰å †ä¿¡æ¯</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$&#123;JDK_BIN&#125;jmap $PID &gt; $DUMP_DIR/jmap.dump <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">$&#123;JDK_BIN&#125;jmap -heap $PID &gt; $DUMP_DIR/jmap-heap.dump <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">$&#123;JDK_BIN&#125;jmap -histo $PID &gt; $DUMP_DIR/jmap-histo.dump <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">$&#123;JDK_BIN&#125;jmap -dump:format=b,file=$DUMP_DIR/heap.bin $PID &gt; /dev/<span class="literal">null</span>  <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br></pre></td></tr></table></figure><p>jmap å°†ä¼šå¾—åˆ°å½“å‰ Java è¿›ç¨‹çš„ dump ä¿¡æ¯ã€‚å¦‚ä¸Šæ‰€ç¤ºï¼Œå…¶å®æœ€æœ‰ç”¨çš„å°±æ˜¯ç¬¬ 4 ä¸ªå‘½ä»¤ï¼Œä½†æ˜¯å‰é¢ä¸‰ä¸ªèƒ½å¤Ÿè®©ä½ åˆæ­¥å¯¹ç³»ç»Ÿæ¦‚å†µè¿›è¡Œå¤§ä½“åˆ¤æ–­ã€‚å› ä¸ºï¼Œç¬¬ 4 ä¸ªå‘½ä»¤äº§ç”Ÿçš„æ–‡ä»¶ï¼Œä¸€èˆ¬éƒ½éå¸¸çš„å¤§ã€‚è€Œä¸”ï¼Œéœ€è¦ä¸‹è½½ä¸‹æ¥ï¼Œå¯¼å…¥ MAT è¿™æ ·çš„å·¥å…·è¿›è¡Œæ·±å…¥åˆ†æï¼Œæ‰èƒ½è·å–ç»“æœã€‚è¿™æ˜¯åˆ†æå†…å­˜æ³„æ¼ä¸€ä¸ªå¿…ç»çš„è¿‡ç¨‹ã€‚</p><p><strong>ï¼ˆ11ï¼‰JVM æ‰§è¡Œæ ˆ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;JDK_BIN&#125;jstack $PID &gt; $DUMP_DIR/jstack.dump <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br></pre></td></tr></table></figure><p>jstack å°†ä¼šè·å–å½“æ—¶çš„æ‰§è¡Œæ ˆã€‚ä¸€èˆ¬ä¼šå¤šæ¬¡å–å€¼ï¼Œæˆ‘ä»¬è¿™é‡Œå–ä¸€æ¬¡å³å¯ã€‚è¿™äº›ä¿¡æ¯éå¸¸æœ‰ç”¨ï¼Œèƒ½å¤Ÿè¿˜åŸ Java è¿›ç¨‹ä¸­çš„çº¿ç¨‹æƒ…å†µã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">top -Hp $PID -b -n <span class="number">1</span> -c &gt;  $DUMP_DIR/top-$PID.dump <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br></pre></td></tr></table></figure><p>ä¸ºäº†èƒ½å¤Ÿå¾—åˆ°æ›´åŠ ç²¾ç»†çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬ä½¿ç”¨ top å‘½ä»¤ï¼Œæ¥è·å–è¿›ç¨‹ä¸­æ‰€æœ‰çº¿ç¨‹çš„ CPU ä¿¡æ¯ï¼Œè¿™æ ·ï¼Œå°±å¯ä»¥çœ‹åˆ°èµ„æºåˆ°åº•è€—è´¹åœ¨ä»€ä¹ˆåœ°æ–¹äº†ã€‚</p><p><strong>ï¼ˆ12ï¼‰é«˜çº§æ›¿è¡¥</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -<span class="number">3</span> $PID</span><br></pre></td></tr></table></figure><p>æœ‰æ—¶å€™ï¼Œjstack å¹¶ä¸èƒ½å¤Ÿè¿è¡Œï¼Œæœ‰å¾ˆå¤šåŸå› ï¼Œæ¯”å¦‚ Java è¿›ç¨‹å‡ ä¹ä¸å“åº”äº†ç­‰ä¹‹ç±»çš„æƒ…å†µã€‚æˆ‘ä»¬ä¼šå°è¯•å‘è¿›ç¨‹å‘é€ kill -3 ä¿¡å·ï¼Œè¿™ä¸ªä¿¡å·å°†ä¼šæ‰“å° jstack çš„ trace ä¿¡æ¯åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œæ˜¯ jstack çš„ä¸€ä¸ªæ›¿è¡¥æ–¹æ¡ˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcore -o $DUMP_DIR/core $PID</span><br></pre></td></tr></table></figure><p>å¯¹äº jmap æ— æ³•æ‰§è¡Œçš„é—®é¢˜ï¼Œä¹Ÿæœ‰æ›¿è¡¥ï¼Œé‚£å°±æ˜¯ GDB ç»„ä»¶ä¸­çš„ gcoreï¼Œå°†ä¼šç”Ÿæˆä¸€ä¸ª core æ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤å»ç”Ÿæˆ dumpï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;JDK_BIN&#125;jhsdb jmap --exe $&#123;JDK&#125;java  --core $DUMP_DIR/core --binaryheap</span><br></pre></td></tr></table></figure><ol start="3"><li><strong>å†…å­˜æ³„æ¼çš„ç°è±¡</strong></li></ol><p>ç¨å¾®æä¸€ä¸‹ jmap å‘½ä»¤ï¼Œå®ƒåœ¨ 9 ç‰ˆæœ¬é‡Œè¢«å¹²æ‰äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ jhsdbï¼Œä½ å¯ä»¥åƒä¸‹é¢çš„å‘½ä»¤ä¸€æ ·ä½¿ç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jhsdb jmap  --heap --pid  <span class="number">37340</span></span><br><span class="line">jhsdb jmap  --pid  <span class="number">37288</span></span><br><span class="line">jhsdb jmap  --histo --pid  <span class="number">37340</span></span><br><span class="line">jhsdb jmap  --binaryheap --pid  <span class="number">37340</span></span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬å†…å­˜æº¢å‡ºï¼Œè¡¨ç°å½¢å¼å°±æ˜¯ Old åŒºçš„å ç”¨æŒç»­ä¸Šå‡ï¼Œå³ä½¿ç»è¿‡äº†å¤šè½® GC ä¹Ÿæ²¡æœ‰æ˜æ˜¾æ”¹å–„ã€‚æ¯”å¦‚ThreadLocalé‡Œé¢çš„GC Rootsï¼Œå†…å­˜æ³„æ¼çš„æ ¹æœ¬å°±æ˜¯ï¼Œè¿™äº›å¯¹è±¡å¹¶æ²¡æœ‰åˆ‡æ–­å’Œ GC Roots çš„å…³ç³»ï¼Œå¯é€šè¿‡ä¸€äº›å·¥å…·ï¼Œèƒ½å¤Ÿçœ‹åˆ°å®ƒä»¬çš„è”ç³»ã€‚</p><h4 id="2ã€æŠ¥è¡¨å¼‚å¸¸-JVMè°ƒä¼˜"><a href="#2ã€æŠ¥è¡¨å¼‚å¸¸-JVMè°ƒä¼˜" class="headerlink" title="2ã€æŠ¥è¡¨å¼‚å¸¸ | JVMè°ƒä¼˜"></a>2ã€æŠ¥è¡¨å¼‚å¸¸ | JVMè°ƒä¼˜</h4><p>æœ‰ä¸€ä¸ªæŠ¥è¡¨ç³»ç»Ÿï¼Œé¢‘ç¹å‘ç”Ÿå†…å­˜æº¢å‡ºï¼Œåœ¨é«˜å³°æœŸé—´ä½¿ç”¨æ—¶ï¼Œè¿˜ä¼šé¢‘ç¹çš„å‘ç”Ÿæ‹’ç»æœåŠ¡ï¼Œç”±äºå¤§å¤šæ•°ä½¿ç”¨è€…æ˜¯ç®¡ç†å‘˜è§’è‰²ï¼Œæ‰€ä»¥å¾ˆå¿«å°±åé¦ˆåˆ°ç ”å‘è¿™é‡Œã€‚</p><p>ä¸šåŠ¡åœºæ™¯æ˜¯ç”±äºæœ‰äº›ç»“æœé›†çš„å­—æ®µä¸æ˜¯å¤ªå…¨ï¼Œå› æ­¤éœ€è¦å¯¹ç»“æœé›†åˆè¿›è¡Œå¾ªç¯ï¼Œå¹¶é€šè¿‡ HttpClient è°ƒç”¨å…¶ä»–æœåŠ¡çš„æ¥å£è¿›è¡Œæ•°æ®å¡«å……ã€‚ä½¿ç”¨ Guava åšäº† JVM å†…ç¼“å­˜ï¼Œä½†æ˜¯å“åº”æ—¶é—´ä¾ç„¶å¾ˆé•¿ã€‚</p><p>åˆæ­¥æ’æŸ¥ï¼ŒJVM çš„èµ„æºå¤ªå°‘ã€‚æ¥å£ A æ¯æ¬¡è¿›è¡ŒæŠ¥è¡¨è®¡ç®—æ—¶ï¼Œéƒ½è¦æ¶‰åŠå‡ ç™¾å…†çš„å†…å­˜ï¼Œè€Œä¸”åœ¨å†…å­˜é‡Œé©»ç•™å¾ˆé•¿æ—¶é—´ï¼Œæœ‰äº›è®¡ç®—åˆéå¸¸è€— CPUï¼Œç‰¹åˆ«çš„â€œåƒâ€èµ„æºã€‚è€Œæˆ‘ä»¬åˆ†é…ç»™ JVM çš„å†…å­˜åªæœ‰ 3 GBï¼Œåœ¨å¤šäººè®¿é—®è¿™äº›æ¥å£çš„æ—¶å€™ï¼Œå†…å­˜å°±ä¸å¤Ÿç”¨äº†ï¼Œè¿›è€Œå‘ç”Ÿäº† OOMã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ²¡åŠæ³•ï¼Œåªæœ‰å‡çº§æœºå™¨ã€‚æŠŠæœºå™¨é…ç½®å‡çº§åˆ° 4C8Gï¼Œç»™ JVM åˆ†é… 6GB çš„å†…å­˜ï¼Œè¿™æ · OOM é—®é¢˜å°±æ¶ˆå¤±äº†ã€‚ä½†éšä¹‹è€Œæ¥çš„æ˜¯é¢‘ç¹çš„ GC é—®é¢˜å’Œè¶…é•¿çš„ GC æ—¶é—´ï¼Œå¹³å‡ GC æ—¶é—´ç«Ÿç„¶æœ‰ 5 ç§’å¤šã€‚</p><p>è¿›ä¸€æ­¥ï¼Œç”±äºæŠ¥è¡¨ç³»ç»Ÿå’Œé«˜å¹¶å‘ç³»ç»Ÿä¸å¤ªä¸€æ ·ï¼Œå®ƒçš„å¯¹è±¡ï¼Œå­˜æ´»æ—¶é•¿å¤§å¾—å¤šï¼Œå¹¶ä¸èƒ½ä»…ä»…é€šè¿‡å¢åŠ å¹´è½»ä»£æ¥è§£å†³ï¼›è€Œä¸”ï¼Œå¦‚æœå¢åŠ äº†å¹´è½»ä»£ï¼Œé‚£ä¹ˆå¿…ç„¶å‡å°‘äº†è€å¹´ä»£çš„å¤§å°ï¼Œç”±äº CMS çš„ç¢ç‰‡å’Œæµ®åŠ¨åƒåœ¾é—®é¢˜ï¼Œæˆ‘ä»¬å¯ç”¨çš„ç©ºé—´å°±æ›´å°‘äº†ã€‚è™½ç„¶æœåŠ¡èƒ½å¤Ÿæ»¡è¶³ç›®å‰çš„éœ€æ±‚ï¼Œä½†è¿˜æœ‰ä¸€äº›ä¸å¤ªç¡®å®šçš„é£é™©ã€‚</p><p>ç¬¬ä¸€ï¼Œäº†è§£åˆ°ç¨‹åºä¸­æœ‰å¾ˆå¤šç¼“å­˜æ•°æ®å’Œé™æ€ç»Ÿè®¡æ•°æ®ï¼Œä¸ºäº†å‡å°‘ MinorGC çš„æ¬¡æ•°ï¼Œé€šè¿‡åˆ†æ GC æ—¥å¿—æ‰“å°çš„å¯¹è±¡å¹´é¾„åˆ†å¸ƒï¼ŒæŠŠ MaxTenuringThreshold å‚æ•°è°ƒæ•´åˆ°äº† 3ï¼ˆç‰¹æ®Šåœºæ™¯ç‰¹æ®Šçš„é…ç½®ï¼‰ã€‚è¿™ä¸ªå‚æ•°æ˜¯è®©å¹´è½»ä»£çš„è¿™äº›å¯¹è±¡ï¼Œèµ¶ç´§å›åˆ°è€å¹´ä»£å»ï¼Œä¸è¦è€å‘†åœ¨å¹´è½»ä»£é‡Œã€‚</p><p>ç¬¬äºŒï¼Œæˆ‘ä»¬çš„ GC æ—¶é—´æ¯”è¾ƒé•¿ï¼Œå°±ä¸€å—å¼€äº†å‚æ•° CMSScavengeBeforeRemarkï¼Œä½¿å¾—åœ¨ CMS remark å‰ï¼Œå…ˆæ‰§è¡Œä¸€æ¬¡ Minor GC å°†æ–°ç”Ÿä»£æ¸…æ‰ã€‚åŒæ—¶é…åˆä¸Šä¸ªå‚æ•°ï¼Œå…¶æ•ˆæœè¿˜æ˜¯æ¯”è¾ƒå¥½çš„ï¼Œä¸€æ–¹é¢ï¼Œå¯¹è±¡å¾ˆå¿«æ™‹å‡åˆ°äº†è€å¹´ä»£ï¼Œå¦ä¸€æ–¹é¢ï¼Œå¹´è½»ä»£çš„å¯¹è±¡åœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯æœ‰é™çš„ï¼Œåœ¨æ•´ä¸ª MajorGC ä¸­å çš„æ—¶é—´ä¹Ÿæœ‰é™ã€‚</p><p>ç¬¬ä¸‰ï¼Œç”±äºç¼“å­˜çš„ä½¿ç”¨ï¼Œæœ‰å¤§é‡çš„å¼±å¼•ç”¨ï¼Œæ‹¿ä¸€æ¬¡é•¿è¾¾ 10 ç§’çš„ GC æ¥è¯´ã€‚æˆ‘ä»¬å‘ç°åœ¨ GC æ—¥å¿—é‡Œï¼Œå¤„ç† weak refs çš„æ—¶é—´è¾ƒé•¿ï¼Œè¾¾åˆ°äº† 4.5 ç§’ã€‚è¿™é‡Œå¯ä»¥åŠ å…¥å‚æ•° ParallelRefProcEnabled æ¥å¹¶è¡Œå¤„ç†Referenceï¼Œä»¥åŠ å¿«å¤„ç†é€Ÿåº¦ï¼Œç¼©çŸ­è€—æ—¶ã€‚</p><p>ä¼˜åŒ–ä¹‹åï¼Œæ•ˆæœä¸é”™ï¼Œä½†å¹¶ä¸æ˜¯ç‰¹åˆ«æ˜æ˜¾ã€‚ç»è¿‡è¯„ä¼°ï¼Œé’ˆå¯¹é«˜å³°æ—¶æœŸçš„æƒ…å†µè¿›è¡Œè°ƒç ”ï¼Œæˆ‘ä»¬å†³å®šå†æ¬¡æå‡æœºå™¨æ€§èƒ½ï¼Œæ”¹ç”¨ 8core16g çš„æœºå™¨ã€‚ä½†æ˜¯ï¼Œè¿™å¸¦æ¥å¦å¤–ä¸€ä¸ªé—®é¢˜ã€‚</p><p><strong>é«˜æ€§èƒ½çš„æœºå™¨å¸¦æ¥äº†éå¸¸å¤§çš„æœåŠ¡ååé‡</strong>ï¼Œé€šè¿‡ jstat è¿›è¡Œç›‘æ§ï¼Œèƒ½å¤Ÿçœ‹åˆ°å¹´è½»ä»£çš„åˆ†é…é€Ÿç‡æ˜æ˜¾æé«˜ï¼Œä½†éšä¹‹è€Œæ¥çš„ MinorGC æ—¶é•¿å´å˜çš„ä¸å¯æ§ï¼Œæœ‰æ—¶å€™ä¼šè¶…è¿‡ 1 ç§’ã€‚ç´¯ç§¯çš„è¯·æ±‚é€ æˆäº†æ›´åŠ ä¸¥é‡çš„åæœã€‚</p><p>è¿™æ˜¯ç”±äºå †ç©ºé—´æ˜æ˜¾åŠ å¤§é€ æˆçš„å›æ”¶æ—¶é—´åŠ é•¿ã€‚ä¸ºäº†è·å–è¾ƒå°çš„åœé¡¿æ—¶é—´ï¼Œæˆ‘ä»¬åœ¨å †ä¸Š<strong>æ”¹ç”¨äº† G1 åƒåœ¾å›æ”¶å™¨</strong>ï¼ŒæŠŠå®ƒçš„ç›®æ ‡è®¾å®šåœ¨ 200msã€‚G1 æ˜¯ä¸€æ¬¾éå¸¸ä¼˜ç§€çš„åƒåœ¾æ”¶é›†å™¨ï¼Œä¸ä»…é€‚åˆå †å†…å­˜å¤§çš„åº”ç”¨ï¼ŒåŒæ—¶ä¹Ÿç®€åŒ–äº†è°ƒä¼˜çš„å·¥ä½œã€‚é€šè¿‡ä¸»è¦çš„å‚æ•°åˆå§‹å’Œæœ€å¤§å †ç©ºé—´ã€ä»¥åŠæœ€å¤§å®¹å¿çš„ GC æš‚åœç›®æ ‡ï¼Œå°±èƒ½å¾—åˆ°ä¸é”™çš„æ€§èƒ½ã€‚ä¿®æ”¹ä¹‹åï¼Œè™½ç„¶ GC æ›´åŠ é¢‘ç¹äº†ä¸€äº›ï¼Œä½†æ˜¯åœé¡¿æ—¶é—´éƒ½æ¯”è¾ƒå°ï¼Œåº”ç”¨çš„è¿è¡Œè¾ƒä¸ºå¹³æ»‘ã€‚</p><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¹Ÿåªæ˜¯å‹‰å¼ºé¡¶ä½äº†å·²æœ‰çš„ä¸šåŠ¡ï¼Œä½†æ˜¯ï¼Œè¿™æ—¶å€™é¢†å¯¼å±‚é¢åˆå‘åŠ›ï¼Œ<strong>è¦æ±‚æŠ¥è¡¨ç³»ç»Ÿå¯ä»¥æ”¯æŒæœªæ¥ä¸¤å¹´ä¸šåŠ¡10åˆ°100å€çš„å¢é•¿</strong>ï¼Œå¹¶ä¿æŒå…¶å¯ç”¨æ€§ï¼Œä½†æ˜¯è¿™ä¸ªâ€œåƒç–®ç™¾å­”â€çš„æŠ¥è¡¨ç³»ç»Ÿï¼Œç¨å¾®ä¸€å‹æµ‹ï¼Œå°±å®•æœºï¼Œé‚£å¦‚ä½•åº”å¯¹åå€ç™¾å€çš„å‹åŠ›å‘¢ ? ç¡¬ä»¶å³ä½¿å¯ä»¥åšåˆ°åŠ¨æ€æ‰©å®¹ï¼Œä½†æ˜¯æ¯•ç«Ÿä¹Ÿæœ‰æé™ã€‚</p><p>ä½¿ç”¨ MAT åˆ†æå †å¿«ç…§ï¼Œå‘ç°å¾ˆå¤šåœ°æ–¹å¯ä»¥é€šè¿‡ä»£ç ä¼˜åŒ–ï¼Œé‚£äº›å ç”¨å†…å­˜ç‰¹åˆ«å¤šçš„å¯¹è±¡ï¼š</p><p>1ã€select * å…¨é‡æ’æŸ¥ï¼Œåªå…è®¸è·å–å¿…é¡»çš„æ•°æ®</p><p>2ã€æŠ¥è¡¨ç³»ç»Ÿä¸­cacheå®é™…çš„å‘½ä¸­ç‡å¹¶ä¸é«˜ï¼Œå°†Guava çš„ Cache å¼•ç”¨çº§åˆ«æ”¹æˆå¼±å¼•ç”¨ï¼ˆWeakKeysï¼‰</p><p>3ã€é™åˆ¶æŠ¥è¡¨å¯¼å…¥æ–‡ä»¶å¤§å°ï¼ŒåŒæ—¶æ‹†åˆ†ç”¨æˆ·è¶…å¤§èŒƒå›´æŸ¥è¯¢å¯¼å‡ºè¯·æ±‚ã€‚</p><p>æ¯ä¸€æ­¥æ“ä½œéƒ½ä½¿å¾—JVMä½¿ç”¨å˜å¾—æ›´åŠ å¯ç”¨ï¼Œä¸€ç³»åˆ—ä¼˜åŒ–ä»¥åï¼Œæœºå™¨ç›¸åŒå‹æµ‹æ•°æ®æ€§èƒ½æå‡äº†æ•°å€ã€‚</p><h4 id="3ã€å¤§å±å¼‚å¸¸-JUCè°ƒä¼˜"><a href="#3ã€å¤§å±å¼‚å¸¸-JUCè°ƒä¼˜" class="headerlink" title="3ã€å¤§å±å¼‚å¸¸ | JUCè°ƒä¼˜"></a>3ã€å¤§å±å¼‚å¸¸ | JUCè°ƒä¼˜</h4><p>æœ‰äº›æ•°æ®éœ€è¦ä½¿ç”¨ HttpClient æ¥è·å–è¿›è¡Œè¡¥å…¨ã€‚æä¾›æ•°æ®çš„æœåŠ¡æä¾›å•†æœ‰çš„å“åº”æ—¶é—´å¯èƒ½ä¼šå¾ˆé•¿ï¼Œä¹Ÿæœ‰å¯èƒ½ä¼šé€ æˆæœåŠ¡æ•´ä½“çš„é˜»å¡ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gobr4whjzwj30l1058dfx.jpg" alt="img"></p><p>æ¥å£ A é€šè¿‡ HttpClient è®¿é—®æœåŠ¡ 2ï¼Œå“åº” 100ms åè¿”å›ï¼›æ¥å£ B è®¿é—®æœåŠ¡ 3ï¼Œè€—æ—¶ 2 ç§’ã€‚HttpClient æœ¬èº«æ˜¯æœ‰ä¸€ä¸ªæœ€å¤§è¿æ¥æ•°é™åˆ¶çš„ï¼Œå¦‚æœæœåŠ¡ 3 è¿Ÿè¿Ÿä¸è¿”å›ï¼Œå°±ä¼šé€ æˆ HttpClient çš„è¿æ¥æ•°è¾¾åˆ°ä¸Šé™ï¼Œ<strong>æ¦‚æ‹¬æ¥è®²ï¼Œå°±æ˜¯åŒä¸€æœåŠ¡ï¼Œç”±äºä¸€ä¸ªè€—æ—¶éå¸¸é•¿çš„æ¥å£ï¼Œè¿›è€Œå¼•èµ·äº†æ•´ä½“çš„æœåŠ¡ä¸å¯ç”¨</strong></p><p>è¿™ä¸ªæ—¶å€™ï¼Œé€šè¿‡ jstack æ‰“å°æ ˆä¿¡æ¯ï¼Œä¼šå‘ç°å¤§å¤šæ•°ç«Ÿç„¶é˜»å¡åœ¨äº†æ¥å£ A ä¸Šï¼Œè€Œä¸æ˜¯è€—æ—¶æ›´é•¿çš„æ¥å£ Bï¼Œè¿™ä¸ªç°è±¡èµ·åˆååˆ†å…·æœ‰è¿·æƒ‘æ€§ï¼Œä¸è¿‡ç»è¿‡åˆ†æåï¼Œæˆ‘ä»¬çŒœæƒ³å…¶å®æ˜¯å› ä¸ºæ¥å£ A çš„é€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œåœ¨é—®é¢˜å‘ç”Ÿç‚¹è¿›å…¥äº†æ›´å¤šçš„è¯·æ±‚ï¼Œå®ƒä»¬å…¨éƒ¨éƒ½é˜»å¡ä½çš„åŒæ—¶è¢«æ‰“å°å‡ºæ¥äº†ã€‚</p><p>ä¸ºäº†éªŒè¯è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘æ­å»ºäº†ä¸€ä¸ªdemo å·¥ç¨‹ï¼Œæ¨¡æ‹Ÿäº†ä¸¤ä¸ªä½¿ç”¨åŒä¸€ä¸ª HttpClient çš„æ¥å£ã€‚fast æ¥å£ç”¨æ¥è®¿é—®ç™¾åº¦ï¼Œå¾ˆå¿«å°±èƒ½è¿”å›ï¼›slow æ¥å£è®¿é—®è°·æ­Œï¼Œç”±äºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œä¼šé˜»å¡ç›´åˆ°è¶…æ—¶ï¼Œå¤§çº¦ 10 sã€‚ åˆ©ç”¨abå¯¹ä¸¤ä¸ªæ¥å£è¿›è¡Œå‹æµ‹ï¼ŒåŒæ—¶ä½¿ç”¨ jstack å·¥å…· dump å †æ ˆã€‚é¦–å…ˆä½¿ç”¨ jps å‘½ä»¤æ‰¾åˆ°è¿›ç¨‹å·ï¼Œç„¶åæŠŠç»“æœé‡å®šå‘åˆ°æ–‡ä»¶ï¼ˆå¯ä»¥å‚è€ƒ 10271.jstack æ–‡ä»¶ï¼‰ã€‚</p><p>è¿‡æ»¤ä¸€ä¸‹ nio å…³é”®å­—ï¼Œå¯ä»¥æŸ¥çœ‹ tomcat ç›¸å…³çš„çº¿ç¨‹ï¼Œè¶³è¶³æœ‰ 200 ä¸ªï¼Œè¿™å’Œ Spring Boot é»˜è®¤çš„ maxThreads ä¸ªæ•°ä¸è°‹è€Œåˆã€‚æ›´è¦å‘½çš„æ˜¯ï¼Œæœ‰å¤§å¤šæ•°çº¿ç¨‹ï¼Œéƒ½å¤„äº BLOCKED çŠ¶æ€ï¼Œè¯´æ˜çº¿ç¨‹ç­‰å¾…èµ„æºè¶…æ—¶ã€‚é€šè¿‡grep fast | wc -l åˆ†æï¼Œç¡®å®200ä¸ªä¸­æœ‰150ä¸ªéƒ½æ˜¯blockedçš„fastçš„è¿›ç¨‹ã€‚</p><p>é—®é¢˜æ‰¾åˆ°äº†ï¼Œè§£å†³æ–¹å¼å°±é¡ºåˆ©æˆç« äº†ã€‚</p><p>1ã€fastå’Œslowäº‰æŠ¢è¿æ¥èµ„æºï¼Œé€šè¿‡çº¿ç¨‹æ± é™æµæˆ–è€…ç†”æ–­å¤„ç†</p><p>2ã€æœ‰æ—¶å€™slowçš„çº¿ç¨‹ä¹Ÿä¸æ˜¯ä¸€ç›´slowï¼Œæ‰€ä»¥å°±å¾—åŠ å…¥ç›‘æ§</p><p>3ã€ä½¿ç”¨å¸¦countdownLaunchå¯¹çº¿ç¨‹çš„æ‰§è¡Œé¡ºåºé€»è¾‘è¿›è¡Œæ§åˆ¶</p><h4 id="4ã€æ¥å£å»¶è¿Ÿ-SWAPè°ƒä¼˜"><a href="#4ã€æ¥å£å»¶è¿Ÿ-SWAPè°ƒä¼˜" class="headerlink" title="4ã€æ¥å£å»¶è¿Ÿ | SWAPè°ƒä¼˜"></a><strong>4ã€æ¥å£å»¶è¿Ÿ | SWAPè°ƒä¼˜</strong></h4><p>æœ‰ä¸€ä¸ªå…³äºæœåŠ¡çš„æŸä¸ªå®ä¾‹ï¼Œç»å¸¸å‘ç”ŸæœåŠ¡å¡é¡¿ã€‚ç”±äºæœåŠ¡çš„å¹¶å‘é‡æ˜¯æ¯”è¾ƒé«˜çš„ï¼Œæ¯å¤šåœé¡¿ 1 ç§’é’Ÿï¼Œå‡ ä¸‡ç”¨æˆ·çš„è¯·æ±‚å°±ä¼šæ„Ÿåˆ°å»¶è¿Ÿã€‚</p><p>æˆ‘ä»¬ç»Ÿè®¡ã€ç±»æ¯”äº†æ­¤æœåŠ¡å…¶ä»–å®ä¾‹çš„ CPUã€å†…å­˜ã€ç½‘ç»œã€I&#x2F;O èµ„æºï¼ŒåŒºåˆ«å¹¶ä¸æ˜¯å¾ˆå¤§ï¼Œæ‰€ä»¥ä¸€åº¦æ€€ç–‘æ˜¯æœºå™¨ç¡¬ä»¶çš„é—®é¢˜ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å¯¹æ¯”äº†èŠ‚ç‚¹çš„ GC æ—¥å¿—ï¼Œå‘ç°æ— è®ºæ˜¯ Minor GCï¼Œè¿˜æ˜¯ Major GCï¼Œè¿™ä¸ªèŠ‚ç‚¹æ‰€èŠ±è´¹çš„æ—¶é—´ï¼Œéƒ½æ¯”å…¶ä»–å®ä¾‹é•¿å¾—å¤šã€‚</p><p>é€šè¿‡ä»”ç»†è§‚å¯Ÿï¼Œæˆ‘ä»¬å‘ç°åœ¨ GC å‘ç”Ÿçš„æ—¶å€™ï¼Œvmstat çš„ siã€so é£™å‡çš„éå¸¸ä¸¥é‡ï¼Œè¿™å’Œå…¶ä»–å®ä¾‹æœ‰ç€æ˜æ˜¾çš„ä¸åŒã€‚</p><p>ä½¿ç”¨ free å‘½ä»¤å†æ¬¡ç¡®è®¤ï¼Œå‘ç° SWAP åˆ†åŒºï¼Œä½¿ç”¨çš„æ¯”ä¾‹éå¸¸é«˜ï¼Œå¼•èµ·çš„å…·ä½“åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>æ›´è¯¦ç»†çš„æ“ä½œç³»ç»Ÿå†…å­˜åˆ†å¸ƒï¼Œä» &#x2F;proc&#x2F;meminfo æ–‡ä»¶ä¸­å¯ä»¥çœ‹åˆ°å…·ä½“çš„é€»è¾‘å†…å­˜å—å¤§å°ï¼Œæœ‰å¤šè¾¾ 40 é¡¹çš„å†…å­˜ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯éƒ½å¯ä»¥é€šè¿‡éå† &#x2F;proc ç›®å½•çš„ä¸€äº›æ–‡ä»¶è·å–ã€‚æˆ‘ä»¬æ³¨æ„åˆ° slabtop å‘½ä»¤æ˜¾ç¤ºçš„æœ‰ä¸€äº›å¼‚å¸¸ï¼Œdentryï¼ˆç›®å½•é«˜é€Ÿç¼“å†²ï¼‰å ç”¨éå¸¸é«˜ã€‚</p><p>é—®é¢˜æœ€ç»ˆå®šä½åˆ°æ˜¯ç”±äºæŸä¸ªè¿ç»´å·¥ç¨‹å¸ˆåˆ é™¤æ—¥å¿—æ—¶ï¼Œå®šæ—¶æ‰§è¡Œäº†ä¸€å¥å‘½ä»¤ï¼š</p><p>find &#x2F; | grep â€œxxx.logâ€</p><p>ä»–æ˜¯æƒ³æ‰¾ä¸€ä¸ªå«åš è¦è¢«åˆ é™¤ çš„æ—¥å¿—æ–‡ä»¶ï¼Œçœ‹çœ‹åœ¨å“ªå°æœåŠ¡å™¨ä¸Šï¼Œç»“æœï¼Œè¿™äº›è€æœåŠ¡å™¨ç”±äºæ–‡ä»¶å¤ªå¤šï¼Œæ‰«æåè¿™äº›æ–‡ä»¶ä¿¡æ¯éƒ½ç¼“å­˜åˆ°äº† slab åŒºä¸Šã€‚è€ŒæœåŠ¡å™¨å¼€äº† swapï¼Œæ“ä½œç³»ç»Ÿå‘ç°ç‰©ç†å†…å­˜å æ»¡åï¼Œå¹¶æ²¡æœ‰ç«‹å³é‡Šæ”¾ cacheï¼Œå¯¼è‡´æ¯æ¬¡ GC éƒ½è¦å’Œç¡¬ç›˜æ‰“ä¸€æ¬¡äº¤é“ã€‚</p><p><strong>è§£å†³æ–¹å¼å°±æ˜¯å…³é—­ SWAP åˆ†åŒºã€‚</strong></p><p>swap æ˜¯å¾ˆå¤šæ€§èƒ½åœºæ™¯çš„ä¸‡æ¶ä¹‹æºï¼Œå»ºè®®ç¦ç”¨ã€‚åœ¨é«˜å¹¶å‘ SWAP ç»å¯¹èƒ½è®©ä½ ä½“éªŒåˆ°å®ƒé­”é¬¼æ€§çš„ä¸€é¢ï¼šè¿›ç¨‹å€’æ˜¯æ­»ä¸äº†äº†ï¼Œä½† GC æ—¶é—´é•¿çš„å´è®©äººæ— æ³•å¿å—ã€‚</p><h4 id="5ã€å†…å­˜æº¢å‡º-Cacheè°ƒä¼˜"><a href="#5ã€å†…å­˜æº¢å‡º-Cacheè°ƒä¼˜" class="headerlink" title="5ã€å†…å­˜æº¢å‡º | Cacheè°ƒä¼˜"></a>5ã€<strong>å†…å­˜æº¢å‡º | Cacheè°ƒä¼˜</strong></h4><blockquote><p>æœ‰ä¸€æ¬¡çº¿ä¸Šé‡åˆ°æ•…éšœï¼Œé‡æ–°å¯åŠ¨åï¼Œä½¿ç”¨ jstat å‘½ä»¤ï¼Œå‘ç° Old åŒºä¸€ç›´åœ¨å¢é•¿ã€‚æˆ‘ä½¿ç”¨ jmap å‘½ä»¤ï¼Œå¯¼å‡ºäº†ä¸€ä»½çº¿ä¸Šå †æ ˆï¼Œç„¶åä½¿ç”¨ MAT è¿›è¡Œåˆ†æï¼Œé€šè¿‡å¯¹ GC Roots çš„åˆ†æï¼Œå‘ç°äº†ä¸€ä¸ªéå¸¸å¤§çš„ HashMap å¯¹è±¡ï¼Œè¿™ä¸ªåŸæœ¬æ˜¯å…¶ä»–åŒäº‹åšç¼“å­˜ç”¨çš„ï¼Œä½†æ˜¯åšäº†ä¸€ä¸ªæ— ç•Œç¼“å­˜ï¼Œæ²¡æœ‰è®¾ç½®è¶…æ—¶æ—¶é—´æˆ–è€… LRU ç­–ç•¥ï¼Œåœ¨ä½¿ç”¨ä¸Šåˆæ²¡æœ‰é‡å†™keyç±»å¯¹è±¡çš„hashcodeå’Œequalsæ–¹æ³•ï¼Œå¯¹è±¡æ— æ³•å–å‡ºä¹Ÿç›´æ¥é€ æˆäº†å †å†…å­˜å ç”¨ä¸€ç›´ä¸Šå‡ï¼Œåæ¥ï¼Œå°†è¿™ä¸ªç¼“å­˜æ”¹æˆ guava çš„ Cacheï¼Œå¹¶è®¾ç½®äº†å¼±å¼•ç”¨ï¼Œæ•…éšœå°±æ¶ˆå¤±äº†ã€‚</p><p>å…³äºæ–‡ä»¶å¤„ç†å™¨çš„åº”ç”¨ï¼Œåœ¨è¯»å–æˆ–è€…å†™å…¥ä¸€äº›æ–‡ä»¶ä¹‹åï¼Œç”±äºå‘ç”Ÿäº†ä¸€äº›å¼‚å¸¸ï¼Œ<strong>close æ–¹æ³•åˆæ²¡æœ‰æ”¾åœ¨ finally</strong> å—é‡Œé¢ï¼Œé€ æˆäº†æ–‡ä»¶å¥æŸ„çš„æ³„æ¼ã€‚ç”±äºæ–‡ä»¶å¤„ç†ååˆ†é¢‘ç¹ï¼Œäº§ç”Ÿäº†ä¸¥é‡çš„å†…å­˜æ³„æ¼é—®é¢˜ã€‚</p></blockquote><p>å†…å­˜æº¢å‡ºæ˜¯ä¸€ä¸ªç»“æœï¼Œè€Œ<strong>å†…å­˜æ³„æ¼</strong>æ˜¯ä¸€ä¸ªåŸå› ã€‚å†…å­˜æº¢å‡ºçš„åŸå› æœ‰<strong>å†…å­˜ç©ºé—´ä¸è¶³ã€é…ç½®é”™è¯¯</strong>ç­‰å› ç´ ã€‚ä¸€äº›é”™è¯¯çš„ç¼–ç¨‹æ–¹å¼ï¼Œä¸å†è¢«ä½¿ç”¨çš„å¯¹è±¡ã€æ²¡æœ‰è¢«å›æ”¶ã€æ²¡æœ‰åŠæ—¶åˆ‡æ–­ä¸ GC Roots çš„è”ç³»ï¼Œè¿™å°±æ˜¯å†…å­˜æ³„æ¼ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œæœ‰å›¢é˜Ÿä½¿ç”¨äº† HashMap åšç¼“å­˜ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è®¾ç½®è¶…æ—¶æ—¶é—´æˆ–è€… LRU ç­–ç•¥ï¼Œé€ æˆäº†æ”¾å…¥ Map å¯¹è±¡çš„æ•°æ®è¶Šæ¥è¶Šå¤šï¼Œè€Œäº§ç”Ÿäº†å†…å­˜æ³„æ¼ã€‚</p><p>å†æ¥çœ‹ä¸€ä¸ªç»å¸¸å‘ç”Ÿçš„å†…å­˜æ³„æ¼çš„ä¾‹å­ï¼Œä¹Ÿæ˜¯ç”±äº HashMap äº§ç”Ÿçš„ã€‚ä»£ç å¦‚ä¸‹ï¼Œç”±äºæ²¡æœ‰é‡å†™ Key ç±»çš„ hashCode å’Œ equals æ–¹æ³•ï¼Œé€ æˆäº†æ”¾å…¥ HashMap çš„æ‰€æœ‰å¯¹è±¡éƒ½æ— æ³•è¢«å–å‡ºæ¥ï¼Œå®ƒä»¬å’Œå¤–ç•Œå¤±è”äº†ã€‚æ‰€ä»¥ä¸‹é¢çš„ä»£ç ç»“æœæ˜¯ nullã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//leak example</span></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HashMapLeakDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Key</span> &#123;</span><br><span class="line">        String title;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Key</span><span class="params">(String title)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.title = title;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    Map&lt;Key, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="keyword">new</span> <span class="title class_">Key</span>(<span class="string">&quot;1&quot;</span>), <span class="number">1</span>);</span><br><span class="line">    map.put(<span class="keyword">new</span> <span class="title class_">Key</span>(<span class="string">&quot;2&quot;</span>), <span class="number">2</span>);</span><br><span class="line">    map.put(<span class="keyword">new</span> <span class="title class_">Key</span>(<span class="string">&quot;3&quot;</span>), <span class="number">2</span>);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">integer</span> <span class="operator">=</span> map.get(<span class="keyword">new</span> <span class="title class_">Key</span>(<span class="string">&quot;2&quot;</span>));</span><br><span class="line">    System.out.println(integer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å³ä½¿æä¾›äº† equals æ–¹æ³•å’Œ hashCode æ–¹æ³•ï¼Œä¹Ÿè¦éå¸¸å°å¿ƒï¼Œå°½é‡é¿å…ä½¿ç”¨è‡ªå®šä¹‰çš„å¯¹è±¡ä½œä¸º Keyã€‚</p><p>å†çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå…³äºæ–‡ä»¶å¤„ç†å™¨çš„åº”ç”¨ï¼Œåœ¨è¯»å–æˆ–è€…å†™å…¥ä¸€äº›æ–‡ä»¶ä¹‹åï¼Œç”±äºå‘ç”Ÿäº†ä¸€äº›å¼‚å¸¸ï¼Œ<strong>close æ–¹æ³•åˆæ²¡æœ‰æ”¾åœ¨ finally</strong> å—é‡Œé¢ï¼Œé€ æˆäº†æ–‡ä»¶å¥æŸ„çš„æ³„æ¼ã€‚ç”±äºæ–‡ä»¶å¤„ç†ååˆ†é¢‘ç¹ï¼Œäº§ç”Ÿäº†ä¸¥é‡çš„å†…å­˜æ³„æ¼é—®é¢˜ã€‚</p><h4 id="6ï¼šCPUé£™é«˜-æ­»å¾ªç¯"><a href="#6ï¼šCPUé£™é«˜-æ­»å¾ªç¯" class="headerlink" title="6ï¼šCPUé£™é«˜ | æ­»å¾ªç¯"></a>6ï¼šCPUé£™é«˜ | æ­»å¾ªç¯</h4><p>æˆ‘ä»¬æœ‰ä¸ªçº¿ä¸Šåº”ç”¨ï¼Œå•èŠ‚ç‚¹åœ¨è¿è¡Œä¸€æ®µæ—¶é—´åï¼ŒCPU çš„ä½¿ç”¨ä¼šé£™å‡ï¼Œä¸€æ—¦é£™å‡ï¼Œä¸€èˆ¬æ€€ç–‘æŸä¸ªä¸šåŠ¡é€»è¾‘çš„è®¡ç®—é‡å¤ªå¤§ï¼Œæˆ–è€…æ˜¯è§¦å‘äº†æ­»å¾ªç¯ï¼ˆæ¯”å¦‚è‘—åçš„ HashMap é«˜å¹¶å‘å¼•èµ·çš„æ­»å¾ªç¯ï¼‰ï¼Œä½†æ’æŸ¥åˆ°æœ€åå…¶å®æ˜¯ GC çš„é—®é¢˜ã€‚        </p><p>ï¼ˆ1ï¼‰ä½¿ç”¨ top å‘½ä»¤ï¼ŒæŸ¥æ‰¾åˆ°ä½¿ç”¨ CPU æœ€å¤šçš„æŸä¸ªè¿›ç¨‹ï¼Œè®°å½•å®ƒçš„ pidã€‚ä½¿ç”¨ Shift + P å¿«æ·é”®å¯ä»¥æŒ‰ CPU çš„ä½¿ç”¨ç‡è¿›è¡Œæ’åºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">top</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰å†æ¬¡ä½¿ç”¨ top å‘½ä»¤ï¼ŒåŠ  -H å‚æ•°ï¼ŒæŸ¥çœ‹æŸä¸ªè¿›ç¨‹ä¸­ä½¿ç”¨ CPU æœ€å¤šçš„æŸä¸ªçº¿ç¨‹ï¼Œè®°å½•çº¿ç¨‹çš„ IDã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">top -Hp $pid</span><br></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰ä½¿ç”¨ printf å‡½æ•°ï¼Œå°†åè¿›åˆ¶çš„ tid è½¬åŒ–æˆåå…­è¿›åˆ¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">printf %x $tid</span><br></pre></td></tr></table></figure><p>ï¼ˆ4ï¼‰ä½¿ç”¨ jstack å‘½ä»¤ï¼ŒæŸ¥çœ‹ Java è¿›ç¨‹çš„çº¿ç¨‹æ ˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstack $pid &gt;$pid.log</span><br></pre></td></tr></table></figure><p>ï¼ˆ5ï¼‰ä½¿ç”¨ less å‘½ä»¤æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶ï¼Œå¹¶æŸ¥æ‰¾åˆšæ‰è½¬åŒ–çš„åå…­è¿›åˆ¶ tidï¼Œæ‰¾åˆ°å‘ç”Ÿé—®é¢˜çš„çº¿ç¨‹ä¸Šä¸‹æ–‡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">less $pid.log</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨ jstack æ—¥å¿—æœå…³é”®å­—DEADï¼Œä»¥åŠä¸­æ‰¾åˆ°äº† CPU ä½¿ç”¨æœ€å¤šçš„å‡ ä¸ªçº¿ç¨‹idã€‚</p><p>å¯ä»¥çœ‹åˆ°é—®é¢˜å‘ç”Ÿçš„æ ¹æºï¼Œæ˜¯æˆ‘ä»¬çš„å †å·²ç»æ»¡äº†ï¼Œä½†æ˜¯åˆæ²¡æœ‰å‘ç”Ÿ OOMï¼Œäºæ˜¯ GC è¿›ç¨‹å°±ä¸€ç›´åœ¨é‚£é‡Œå›æ”¶ï¼Œå›æ”¶çš„æ•ˆæœåˆéå¸¸ä¸€èˆ¬ï¼Œé€ æˆ CPU å‡é«˜åº”ç”¨å‡æ­»ã€‚æ¥ä¸‹æ¥çš„å…·ä½“é—®é¢˜æ’æŸ¥ï¼Œå°±éœ€è¦æŠŠå†…å­˜ dump ä¸€ä»½ä¸‹æ¥ï¼Œä½¿ç”¨ MAT ç­‰å·¥å…·åˆ†æå…·ä½“åŸå› äº†ã€‚</p><h1 id="ä¸‰ã€å¤šçº¿ç¨‹ç¯‡"><a href="#ä¸‰ã€å¤šçº¿ç¨‹ç¯‡" class="headerlink" title="ä¸‰ã€å¤šçº¿ç¨‹ç¯‡"></a>ä¸‰ã€å¤šçº¿ç¨‹ç¯‡</h1><h3 id="çº¿ç¨‹è°ƒåº¦"><a href="#çº¿ç¨‹è°ƒåº¦" class="headerlink" title="çº¿ç¨‹è°ƒåº¦"></a>çº¿ç¨‹è°ƒåº¦</h3><h4 id="1ã€çº¿ç¨‹çŠ¶æ€"><a href="#1ã€çº¿ç¨‹çŠ¶æ€" class="headerlink" title="1ã€çº¿ç¨‹çŠ¶æ€"></a><strong>1ã€çº¿ç¨‹çŠ¶æ€</strong></h4><p>â€‹çº¿ç¨‹æ˜¯cpuä»»åŠ¡è°ƒåº¦çš„æœ€å°æ‰§è¡Œå•ä½ï¼Œæ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆ</p><p><strong>çº¿ç¨‹çŠ¶æ€ï¼šåˆ›å»ºã€å°±ç»ªã€è¿è¡Œã€é˜»å¡ã€æ­»äº¡</strong></p><img src="https://s0.lgstatic.com/i/image3/M01/77/29/Cgq2xl5xxGKAKBpeAAEw9Ifr07Y662.png" alt="img" style="zoom: 40%;" /><h4 id="2ã€çº¿ç¨‹çŠ¶æ€åˆ‡æ¢"><a href="#2ã€çº¿ç¨‹çŠ¶æ€åˆ‡æ¢" class="headerlink" title="2ã€çº¿ç¨‹çŠ¶æ€åˆ‡æ¢"></a><strong>2ã€çº¿ç¨‹çŠ¶æ€åˆ‡æ¢</strong></h4><table><thead><tr><th>æ–¹æ³•</th><th>ä½œç”¨</th><th>åŒºåˆ«</th></tr></thead><tbody><tr><td>start</td><td>å¯åŠ¨çº¿ç¨‹ï¼Œç”±è™šæ‹Ÿæœºè‡ªåŠ¨è°ƒåº¦æ‰§è¡Œrun()æ–¹æ³•</td><td>çº¿ç¨‹å¤„äºå°±ç»ªçŠ¶æ€</td></tr><tr><td>run</td><td>çº¿ç¨‹é€»è¾‘ä»£ç å—å¤„ç†ï¼ŒJVMè°ƒåº¦æ‰§è¡Œ</td><td>çº¿ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€</td></tr><tr><td>sleep</td><td>è®©å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ä¼‘çœ ï¼ˆæš‚åœæ‰§è¡Œï¼‰</td><td>ä¸é‡Šæ”¾é”</td></tr><tr><td>wait</td><td>ä½¿å¾—å½“å‰çº¿ç¨‹ç­‰å¾…</td><td>é‡Šæ”¾åŒæ­¥é”</td></tr><tr><td>notify</td><td>å”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„å•ä¸ªçº¿ç¨‹</td><td>å”¤é†’å•ä¸ªçº¿ç¨‹</td></tr><tr><td>notifyAll</td><td>å”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹</td><td>å”¤é†’å¤šä¸ªçº¿ç¨‹</td></tr><tr><td>yiled</td><td>åœæ­¢å½“å‰çº¿ç¨‹ï¼Œè®©åŒç­‰ä¼˜å…ˆæƒçš„çº¿ç¨‹è¿è¡Œ</td><td>ç”¨Threadç±»è°ƒç”¨</td></tr><tr><td>join</td><td>ä½¿å½“å‰çº¿ç¨‹åœä¸‹æ¥ç­‰å¾…ï¼Œç›´è‡³å¦ä¸€ä¸ªè°ƒç”¨joinæ–¹æ³•çš„çº¿ç¨‹ç»ˆæ­¢</td><td>ç”¨çº¿ç¨‹å¯¹è±¡è°ƒç”¨</td></tr></tbody></table><img src="https://s0.lgstatic.com/i/image/M00/80/24/Ciqc1F_Qfy2ACkrLAAD2DLkc2qw212.png" alt="img" style="zoom:67%;" /><h4 id="3ã€é˜»å¡å”¤é†’è¿‡ç¨‹"><a href="#3ã€é˜»å¡å”¤é†’è¿‡ç¨‹" class="headerlink" title="3ã€é˜»å¡å”¤é†’è¿‡ç¨‹"></a><strong>3ã€é˜»å¡å”¤é†’è¿‡ç¨‹</strong></h4><p><strong>é˜»å¡ï¼š</strong></p><p>â€‹è¿™ä¸‰ä¸ªæ–¹æ³•çš„è°ƒç”¨éƒ½ä¼šä½¿å½“å‰çº¿ç¨‹é˜»å¡ã€‚è¯¥çº¿ç¨‹å°†ä¼šè¢«æ”¾ç½®åˆ°å¯¹è¯¥Objectçš„è¯·æ±‚ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œç„¶åè®©å‡ºå½“å‰å¯¹Objectæ‰€æ‹¥æœ‰çš„æ‰€æœ‰çš„åŒæ­¥è¯·æ±‚ã€‚çº¿ç¨‹ä¼šä¸€ç›´æš‚åœæ‰€æœ‰çº¿ç¨‹è°ƒåº¦ï¼Œç›´åˆ°ä¸‹é¢å…¶ä¸­ä¸€ç§æƒ…å†µå‘ç”Ÿï¼š</p><p>ã€€ã€€ã€€ã€€â‘  å…¶ä»–çº¿ç¨‹è°ƒç”¨äº†è¯¥Objectçš„notifyæ–¹æ³•ï¼Œè€Œè¯¥çº¿ç¨‹åˆšå¥½æ˜¯é‚£ä¸ªè¢«å”¤é†’çš„çº¿ç¨‹ï¼›</p><p>ã€€ã€€ã€€ã€€â‘¡ å…¶ä»–çº¿ç¨‹è°ƒç”¨äº†è¯¥Objectçš„notifyAllæ–¹æ³•ï¼›</p><p><strong>å”¤é†’ï¼š</strong></p><p>â€‹çº¿ç¨‹å°†ä¼šä»ç­‰å¾…é˜Ÿåˆ—ä¸­ç§»é™¤ï¼Œé‡æ–°æˆä¸ºå¯è°ƒåº¦çº¿ç¨‹ã€‚å®ƒä¼šä¸å…¶ä»–çº¿ç¨‹ä»¥å¸¸è§„çš„æ–¹å¼ç«äº‰å¯¹è±¡åŒæ­¥è¯·æ±‚ã€‚<strong>ä¸€æ—¦å®ƒé‡æ–°è·å¾—å¯¹è±¡çš„åŒæ­¥è¯·æ±‚ï¼Œæ‰€æœ‰ä¹‹å‰çš„è¯·æ±‚çŠ¶æ€éƒ½ä¼šæ¢å¤ï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹è°ƒç”¨waitçš„åœ°æ–¹çš„çŠ¶æ€ã€‚çº¿ç¨‹å°†ä¼šåœ¨ä¹‹å‰è°ƒç”¨waitçš„åœ°æ–¹ç»§ç»­è¿è¡Œä¸‹å»ã€‚</strong></p><p><strong>ä¸ºä»€ä¹ˆè¦å‡ºç°åœ¨åŒæ­¥ä»£ç å—ä¸­ï¼š</strong></p><p>â€‹ç”±äº<code>wait()å±äºObjectæ–¹æ³•ï¼Œè°ƒç”¨ä¹‹åä¼šå¼ºåˆ¶é‡Šæ”¾å½“å‰å¯¹è±¡é”ï¼Œæ‰€ä»¥åœ¨wait()</code> è°ƒç”¨æ—¶å¿…é¡»æ‹¿åˆ°å½“å‰å¯¹è±¡çš„ç›‘è§†å™¨monitorå¯¹è±¡ã€‚å› æ­¤ï¼Œwait()æ–¹æ³•åœ¨åŒæ­¥æ–¹æ³•&#x2F;ä»£ç å—ä¸­è°ƒç”¨ã€‚</p><h4 id="4ã€waitå’ŒsleepåŒºåˆ«"><a href="#4ã€waitå’ŒsleepåŒºåˆ«" class="headerlink" title="4ã€waitå’ŒsleepåŒºåˆ«"></a><strong>4ã€waitå’ŒsleepåŒºåˆ«</strong></h4><ul><li><p>wait æ–¹æ³•å¿…é¡»åœ¨ synchronized ä¿æŠ¤çš„ä»£ç ä¸­ä½¿ç”¨ï¼Œè€Œ sleep æ–¹æ³•å¹¶æ²¡æœ‰è¿™ä¸ªè¦æ±‚ã€‚</p></li><li><p>wait æ–¹æ³•ä¼šä¸»åŠ¨é‡Šæ”¾ monitor é”ï¼Œåœ¨åŒæ­¥ä»£ç ä¸­æ‰§è¡Œ sleep æ–¹æ³•æ—¶ï¼Œå¹¶ä¸ä¼šé‡Šæ”¾ monitor é”ã€‚</p></li><li><p>wait æ–¹æ³•æ„å‘³ç€æ°¸ä¹…ç­‰å¾…ï¼Œç›´åˆ°è¢«ä¸­æ–­æˆ–è¢«å”¤é†’æ‰èƒ½æ¢å¤ï¼Œä¸ä¼šä¸»åŠ¨æ¢å¤ï¼Œsleep æ–¹æ³•ä¸­ä¼šå®šä¹‰ä¸€ä¸ªæ—¶é—´ï¼Œæ—¶é—´åˆ°æœŸåä¼šä¸»åŠ¨æ¢å¤ã€‚</p></li><li><p>wait&#x2F;notify æ˜¯ Object ç±»çš„æ–¹æ³•ï¼Œè€Œ sleep æ˜¯ Thread ç±»çš„æ–¹æ³•ã€‚</p></li></ul><h4 id="5ã€åˆ›å»ºçº¿ç¨‹æ–¹å¼"><a href="#5ã€åˆ›å»ºçº¿ç¨‹æ–¹å¼" class="headerlink" title="5ã€åˆ›å»ºçº¿ç¨‹æ–¹å¼"></a>5ã€åˆ›å»ºçº¿ç¨‹æ–¹å¼</h4><p><strong>å®ç° Runnable æ¥å£</strong>ï¼ˆä¼˜å…ˆä½¿ç”¨ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RunnableThread</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;System.out.println(<span class="string">&#x27;ç”¨å®ç°Runnableæ¥å£å®ç°çº¿ç¨‹&#x27;</span>);&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å®ç°Callableæ¥å£</strong>ï¼ˆæœ‰è¿”å›å€¼å¯æŠ›å‡ºå¼‚å¸¸ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span>Â <span class="title class_">CallableTask</span>Â <span class="keyword">implements</span>Â <span class="title class_">Callable</span>&lt;Integer&gt;Â &#123;</span><br><span class="line">Â Â Â Â <span class="meta">@Override</span></span><br><span class="line">Â Â Â Â <span class="keyword">public</span>Â IntegerÂ <span class="title function_">call</span><span class="params">()</span>Â <span class="keyword">throws</span>Â ExceptionÂ &#123; <span class="keyword">return</span>Â <span class="keyword">new</span>Â <span class="title class_">Random</span>().nextInt();&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç»§æ‰¿Threadç±»</strong>ï¼ˆjavaä¸æ”¯æŒå¤šç»§æ‰¿ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span>Â <span class="keyword">class</span>Â <span class="title class_">ExtendsThread</span>Â <span class="keyword">extends</span>Â <span class="title class_">Thread</span>Â &#123;</span><br><span class="line">Â Â Â Â <span class="meta">@Override</span></span><br><span class="line">Â Â Â Â <span class="keyword">public</span>Â <span class="keyword">void</span>Â <span class="title function_">run</span><span class="params">()</span>Â &#123;System.out.println(<span class="string">&#x27;ç”¨Threadç±»å®ç°çº¿ç¨‹&#x27;</span>);&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨çº¿ç¨‹æ± </strong>ï¼ˆåº•å±‚éƒ½æ˜¯å®ç°runæ–¹æ³•ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span>Â <span class="keyword">class</span>Â <span class="title class_">DefaultThreadFactory</span>Â <span class="keyword">implements</span>Â <span class="title class_">ThreadFactory</span>Â &#123;</span><br><span class="line">Â Â Â Â DefaultThreadFactory()Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="type">SecurityManager</span>Â <span class="variable">s</span>Â <span class="operator">=</span>Â System.getSecurityManager();</span><br><span class="line">Â Â Â Â Â Â Â Â groupÂ =Â (sÂ !=Â <span class="literal">null</span>)Â ?Â s.getThreadGroup()Â : Thread.currentThread().getThreadGroup();</span><br><span class="line">Â Â Â Â Â Â Â Â namePrefixÂ =Â <span class="string">&quot;pool-&quot;</span>Â + poolNumber.getAndIncrement()Â +<span class="string">&quot;-thread-&quot;</span>;</span><br><span class="line">Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â <span class="keyword">public</span>Â ThreadÂ <span class="title function_">newThread</span><span class="params">(RunnableÂ r)</span>Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="type">Thread</span>Â <span class="variable">t</span>Â <span class="operator">=</span>Â <span class="keyword">new</span>Â <span class="title class_">Thread</span>(group,Â r,namePrefixÂ +Â threadNumber.getAndIncrement(),<span class="number">0</span>);</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">if</span>Â (t.isDaemon()) t.setDaemon(<span class="literal">false</span>);  <span class="comment">//æ˜¯å¦å®ˆæŠ¤çº¿ç¨‹</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">if</span>Â (t.getPriority()Â !=Â Thread.NORM_PRIORITY) t.setPriority(Thread.NORM_PRIORITY); <span class="comment">//çº¿ç¨‹ä¼˜å…ˆçº§</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">return</span>Â t;</span><br><span class="line">Â Â Â Â &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="çº¿ç¨‹æ± "><a href="#çº¿ç¨‹æ± " class="headerlink" title="çº¿ç¨‹æ± "></a>çº¿ç¨‹æ± </h3><p>ä¼˜ç‚¹ï¼šé€šè¿‡å¤ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹ï¼Œ<strong>é™ä½èµ„æºæŸè€—</strong>ã€çº¿ç¨‹å¯ä»¥ç›´æ¥å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡<strong>åŠ å¿«å“åº”é€Ÿåº¦</strong>ã€åŒæ—¶ä¾¿äº<strong>ç»Ÿä¸€ç›‘æ§å’Œç®¡ç†</strong>ã€‚</p><h4 id="1ã€çº¿ç¨‹æ± æ„é€ å‡½æ•°"><a href="#1ã€çº¿ç¨‹æ± æ„é€ å‡½æ•°" class="headerlink" title="1ã€çº¿ç¨‹æ± æ„é€ å‡½æ•°"></a><strong>1ã€çº¿ç¨‹æ± æ„é€ å‡½æ•°</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* çº¿ç¨‹æ± æ„é€ å‡½æ•°7å¤§å‚æ•°</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ThreadPoolExecutor</span><span class="params">(<span class="type">int</span> corePoolSize,<span class="type">int</span> maximumPoolSize,<span class="type">long</span> keepAliveTime,</span></span><br><span class="line"><span class="params">    TimeUnit unit,BlockingQueue&lt;Runnable&gt; workQueue,ThreadFactory threadFactory,</span></span><br><span class="line"><span class="params">    RejectedExecutionHandler handler)</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p><strong>å‚æ•°ä»‹ç»ï¼š</strong></p><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>corePoolSize</td><td>æ ¸å¿ƒçº¿ç¨‹æ± å¤§å°</td></tr><tr><td>maximumPoolSize</td><td>æœ€å¤§çº¿ç¨‹æ± å¤§å°</td></tr><tr><td>keepAliveTime</td><td>çº¿ç¨‹æ± ä¸­è¶…è¿‡ corePoolSize æ•°ç›®çš„ç©ºé—²çº¿ç¨‹æœ€å¤§å­˜æ´»æ—¶é—´ï¼›</td></tr><tr><td>TimeUnit</td><td>keepAliveTime æ—¶é—´å•ä½</td></tr><tr><td>workQueue</td><td>é˜»å¡ä»»åŠ¡é˜Ÿåˆ—</td></tr><tr><td>threadFactory</td><td>æ–°å»ºçº¿ç¨‹å·¥å‚</td></tr><tr><td>RejectedExecutionHandler</td><td>æ‹’ç»ç­–ç•¥ã€‚å½“æäº¤ä»»åŠ¡æ•°è¶…è¿‡ maxmumPoolSize+workQueue ä¹‹å’Œæ—¶ï¼Œä»»åŠ¡ä¼šäº¤ç»™RejectedExecutionHandler æ¥å¤„ç†</td></tr></tbody></table><h4 id="2ã€çº¿ç¨‹å¤„ç†ä»»åŠ¡è¿‡ç¨‹ï¼š"><a href="#2ã€çº¿ç¨‹å¤„ç†ä»»åŠ¡è¿‡ç¨‹ï¼š" class="headerlink" title="2ã€çº¿ç¨‹å¤„ç†ä»»åŠ¡è¿‡ç¨‹ï¼š"></a><strong>2ã€çº¿ç¨‹å¤„ç†ä»»åŠ¡è¿‡ç¨‹ï¼š</strong></h4><img src="https://s0.lgstatic.com/i/image3/M01/78/50/Cgq2xl5zjxGAXOA-AABF0Dv8GMI518.png" alt="img" style="zoom: 67%;" /><ol><li>å½“çº¿ç¨‹æ± å°äºcorePoolSizeï¼Œæ–°æäº¤ä»»åŠ¡å°†åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œå³ä½¿æ­¤æ—¶çº¿ç¨‹æ± ä¸­å­˜åœ¨ç©ºé—²çº¿ç¨‹ã€‚</li><li>å½“çº¿ç¨‹æ± è¾¾åˆ°corePoolSizeæ—¶ï¼Œæ–°æäº¤ä»»åŠ¡å°†è¢«æ”¾å…¥ workQueue ä¸­ï¼Œç­‰å¾…çº¿ç¨‹æ± ä¸­ä»»åŠ¡è°ƒåº¦æ‰§è¡Œã€‚</li><li>å½“workQueueå·²æ»¡ï¼Œä¸” maximumPoolSize å¤§äº corePoolSize æ—¶ï¼Œæ–°æäº¤ä»»åŠ¡ä¼šåˆ›å»ºæ–°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚</li><li>å½“æäº¤ä»»åŠ¡æ•°è¶…è¿‡ maximumPoolSize æ—¶ï¼Œæ–°æäº¤ä»»åŠ¡ç”± RejectedExecutionHandler å¤„ç†ã€‚</li><li>å½“çº¿ç¨‹æ± ä¸­è¶…è¿‡corePoolSize çº¿ç¨‹ï¼Œç©ºé—²æ—¶é—´è¾¾åˆ° keepAliveTime æ—¶ï¼Œå…³é—­ç©ºé—²çº¿ç¨‹ ã€‚</li></ol><h4 id="3ã€çº¿ç¨‹æ‹’ç»ç­–ç•¥"><a href="#3ã€çº¿ç¨‹æ‹’ç»ç­–ç•¥" class="headerlink" title="3ã€çº¿ç¨‹æ‹’ç»ç­–ç•¥"></a><strong>3ã€çº¿ç¨‹æ‹’ç»ç­–ç•¥</strong></h4><p>â€‹çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å·²ç»ç”¨å®Œäº†ï¼Œæ— æ³•ç»§ç»­ä¸ºæ–°ä»»åŠ¡æœåŠ¡ï¼ŒåŒæ—¶ï¼Œç­‰å¾…é˜Ÿåˆ—ä¹Ÿå·²ç»æ’æ»¡äº†ï¼Œå†ä¹Ÿå¡ä¸ä¸‹æ–°ä»»åŠ¡äº†ã€‚è¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦æ‹’ç»ç­–ç•¥æœºåˆ¶åˆç†çš„å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚</p><p>JDK å†…ç½®çš„æ‹’ç»ç­–ç•¥å¦‚ä¸‹ï¼š</p><p>â€‹<strong>AbortPolicyï¼š</strong>ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œé˜»æ­¢ç³»ç»Ÿæ­£å¸¸è¿è¡Œã€‚å¯ä»¥æ ¹æ®ä¸šåŠ¡é€»è¾‘é€‰æ‹©é‡è¯•æˆ–è€…æ”¾å¼ƒæäº¤ç­‰ç­–ç•¥ã€‚</p><p>â€‹<strong>CallerRunsPolicy ï¼š</strong>åªè¦çº¿ç¨‹æ± æœªå…³é—­ï¼Œè¯¥ç­–ç•¥ç›´æ¥åœ¨è°ƒç”¨è€…çº¿ç¨‹ä¸­ï¼Œè¿è¡Œå½“å‰è¢«ä¸¢å¼ƒçš„ä»»åŠ¡ã€‚</p><p>â€‹ä¸ä¼šé€ æˆä»»åŠ¡ä¸¢å¤±ï¼ŒåŒæ—¶å‡ç¼“æäº¤ä»»åŠ¡çš„é€Ÿåº¦ï¼Œç»™æ‰§è¡Œä»»åŠ¡ç¼“å†²æ—¶é—´ã€‚</p><p>â€‹<strong>DiscardOldestPolicy ï¼š</strong>ä¸¢å¼ƒæœ€è€çš„ä¸€ä¸ªè¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯å³å°†è¢«æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¹¶å°è¯•å†æ¬¡æäº¤å½“å‰ä»»åŠ¡ã€‚</p><p>â€‹<strong>DiscardPolicy ï¼š</strong>è¯¥ç­–ç•¥é»˜é»˜åœ°ä¸¢å¼ƒæ— æ³•å¤„ç†çš„ä»»åŠ¡ï¼Œä¸äºˆä»»ä½•å¤„ç†ã€‚å¦‚æœå…è®¸ä»»åŠ¡ä¸¢å¤±ï¼Œè¿™æ˜¯æœ€å¥½çš„ä¸€ç§æ–¹æ¡ˆã€‚</p><h4 id="4ã€Execuorsç±»å®ç°çº¿ç¨‹æ± "><a href="#4ã€Execuorsç±»å®ç°çº¿ç¨‹æ± " class="headerlink" title="4ã€Execuorsç±»å®ç°çº¿ç¨‹æ± "></a><strong>4ã€Execuorsç±»å®ç°çº¿ç¨‹æ± </strong></h4><img src="https://s0.lgstatic.com/i/image3/M01/63/5A/CgpOIF4z1EiAFjNQAAAtVe5xjgQ999.png" alt="img" style="zoom: 50%;" /><ul><li><strong>newSingleThreadExecutor()ï¼š</strong>åªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œä»»åŠ¡æ˜¯é¡ºåºæ‰§è¡Œï¼Œé€‚ç”¨äºä¸€ä¸ªä¸€ä¸ªä»»åŠ¡æ‰§è¡Œçš„åœºæ™¯</li><li><strong>newCachedThreadPool()ï¼š</strong>çº¿ç¨‹æ± é‡Œæœ‰å¾ˆå¤šçº¿ç¨‹éœ€è¦åŒæ—¶æ‰§è¡Œï¼Œ60så†…å¤ç”¨ï¼Œé€‚ç”¨æ‰§è¡Œå¾ˆå¤šçŸ­æœŸå¼‚æ­¥çš„å°ç¨‹åºæˆ–è€…è´Ÿè½½è¾ƒè½»çš„æœåŠ¡</li><li><strong>newFixedThreadPool()ï¼š</strong>æ‹¥æœ‰å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± ï¼Œå¦‚æœæ²¡æœ‰ä»»åŠ¡æ‰§è¡Œï¼Œé‚£ä¹ˆçº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾…ï¼Œé€‚ç”¨æ‰§è¡Œé•¿æœŸçš„ä»»åŠ¡ã€‚</li><li><strong>newScheduledThreadPool()ï¼š</strong>ç”¨æ¥è°ƒåº¦å³å°†æ‰§è¡Œçš„ä»»åŠ¡çš„çº¿ç¨‹æ± </li><li>**newWorkStealingPool()**ï¼šåº•å±‚é‡‡ç”¨forkjoinçš„Dequeï¼Œé‡‡ç”¨ç‹¬ç«‹çš„ä»»åŠ¡é˜Ÿåˆ—å¯ä»¥å‡å°‘ç«äº‰åŒæ—¶åŠ å¿«ä»»åŠ¡å¤„ç†</li><li></li><li><img src="https://s0.lgstatic.com/i/image2/M01/AF/80/CgoB5l3kzomAckv5AAAxf6FCPco696.png" alt="img" style="zoom:50%;" /></li></ul><p><strong>å› ä¸ºä»¥ä¸Šæ–¹å¼éƒ½å­˜åœ¨å¼Šç«¯ï¼š</strong></p><p>â€‹FixedThreadPool å’Œ SingleThreadExecutor ï¼š å…è®¸è¯·æ±‚çš„<strong>é˜Ÿåˆ—â»“åº¦</strong>ä¸º Integer.MAX_VALUEï¼Œä¼šå¯¼è‡´OOMã€‚<br>â€‹CachedThreadPool å’Œ ScheduledThreadPool ï¼š å…è®¸åˆ›å»ºçš„<strong>çº¿ç¨‹æ•°é‡</strong>ä¸º Integer.MAX_VALUEï¼Œä¼šå¯¼è‡´OOMã€‚</p><p>æ‰‹åŠ¨åˆ›å»ºçš„çº¿ç¨‹æ± åº•å±‚ä½¿ç”¨çš„æ˜¯ArrayBlockingQueueå¯ä»¥é˜²æ­¢OOMã€‚</p><h4 id="5ã€çº¿ç¨‹æ± å¤§å°è®¾ç½®"><a href="#5ã€çº¿ç¨‹æ± å¤§å°è®¾ç½®" class="headerlink" title="5ã€çº¿ç¨‹æ± å¤§å°è®¾ç½®"></a><strong>5ã€çº¿ç¨‹æ± å¤§å°è®¾ç½®</strong></h4><ul><li>CPU å¯†é›†å‹ï¼ˆn+1ï¼‰</li></ul><p>â€‹CPU å¯†é›†çš„æ„æ€æ˜¯è¯¥ä»»åŠ¡éœ€è¦å¤§é‡çš„è¿ç®—ï¼Œè€Œæ²¡æœ‰é˜»å¡ï¼ŒCPU ä¸€ç›´å…¨é€Ÿè¿è¡Œã€‚</p><p>â€‹CPU å¯†é›†å‹ä»»åŠ¡å°½å¯èƒ½çš„å°‘çš„çº¿ç¨‹æ•°é‡ï¼Œä¸€èˆ¬ä¸º CPU æ ¸æ•° + 1 ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ã€‚</p><ul><li>IO å¯†é›†å‹ï¼ˆ2*nï¼‰</li></ul><p>â€‹ç”±äº IO å¯†é›†å‹ä»»åŠ¡çº¿ç¨‹å¹¶ä¸æ˜¯ä¸€ç›´åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œå¯ä»¥å¤šåˆ†é…ä¸€ç‚¹çº¿ç¨‹æ•°ï¼Œå¦‚ CPU * 2 </p><p>â€‹ä¹Ÿå¯ä»¥ä½¿ç”¨å…¬å¼ï¼šCPU æ ¸å¿ƒæ•° *ï¼ˆ1+å¹³å‡ç­‰å¾…æ—¶é—´&#x2F;å¹³å‡å·¥ä½œæ—¶é—´ï¼‰ã€‚</p><h3 id="çº¿ç¨‹å®‰å…¨"><a href="#çº¿ç¨‹å®‰å…¨" class="headerlink" title="çº¿ç¨‹å®‰å…¨"></a>çº¿ç¨‹å®‰å…¨</h3><h4 id="1ã€ä¹è§‚é”ï¼ŒCASæ€æƒ³"><a href="#1ã€ä¹è§‚é”ï¼ŒCASæ€æƒ³" class="headerlink" title="1ã€ä¹è§‚é”ï¼ŒCASæ€æƒ³"></a><strong>1ã€ä¹è§‚é”ï¼ŒCASæ€æƒ³</strong></h4><p><strong>javaä¹è§‚é”æœºåˆ¶ï¼š</strong></p><p>â€‹ä¹è§‚é”ä½“ç°çš„æ˜¯æ‚²è§‚é”çš„åé¢ã€‚å®ƒæ˜¯ä¸€ç§ç§¯æçš„æ€æƒ³ï¼Œå®ƒæ€»æ˜¯è®¤ä¸ºæ•°æ®æ˜¯ä¸ä¼šè¢«ä¿®æ”¹çš„ï¼Œæ‰€ä»¥æ˜¯ä¸ä¼šå¯¹æ•°æ®ä¸Šé”çš„ã€‚ä½†æ˜¯ä¹è§‚é”åœ¨æ›´æ–°çš„æ—¶å€™ä¼šå»åˆ¤æ–­æ•°æ®æ˜¯å¦è¢«æ›´æ–°è¿‡ã€‚ä¹è§‚é”çš„å®ç°æ–¹æ¡ˆä¸€èˆ¬æœ‰ä¸¤ç§ï¼ˆç‰ˆæœ¬å·æœºåˆ¶å’ŒCASï¼‰ã€‚ä¹è§‚é”é€‚ç”¨äº<strong>è¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œè¿™æ ·å¯ä»¥æé«˜ç³»ç»Ÿçš„å¹¶å‘é‡</strong>ã€‚åœ¨Javaä¸­ <strong>java.util.concurrent.atomic</strong>ä¸‹çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é”çš„ä¸€ç§å®ç°æ–¹å¼CASå®ç°çš„ã€‚</p><p>ã€€ã€€ä¹è§‚é”ï¼Œå¤§å¤šæ˜¯åŸºäºæ•°æ®ç‰ˆæœ¬  (Version)è®°å½•æœºåˆ¶å®ç°ã€‚å³ä¸ºæ•°æ®å¢åŠ ä¸€ä¸ªç‰ˆæœ¬æ ‡è¯†ï¼Œåœ¨åŸºäºæ•°æ®åº“è¡¨çš„ç‰ˆæœ¬è§£å†³æ–¹æ¡ˆä¸­ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡ä¸ºæ•°æ®åº“è¡¨å¢åŠ ä¸€ä¸ª â€œversionâ€ å­—æ®µæ¥ å®ç°ã€‚ è¯»å–å‡ºæ•°æ®æ—¶ï¼Œå°†æ­¤ç‰ˆæœ¬å·ä¸€åŒè¯»å‡ºï¼Œä¹‹åæ›´æ–°æ—¶ï¼Œå¯¹æ­¤ç‰ˆæœ¬å·åŠ ä¸€ã€‚æ­¤æ—¶ï¼Œå°†æ äº¤æ•°æ®çš„ç‰ˆæœ¬æ•°æ®ä¸æ•°æ®åº“è¡¨å¯¹åº”è®°å½•çš„å½“å‰ç‰ˆæœ¬ä¿¡æ¯è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœæäº¤çš„æ•°æ® ç‰ˆæœ¬å·å¤§äºæ•°æ®åº“è¡¨å½“å‰ç‰ˆæœ¬å·ï¼Œåˆ™äºˆä»¥æ›´æ–°ï¼Œå¦åˆ™è®¤ä¸ºæ˜¯è¿‡æœŸæ•°æ®ã€‚</p><p><strong>CASæ€æƒ³ï¼š</strong></p><p>â€‹CASå°±æ˜¯compare and swapï¼ˆ<strong>æ¯”è¾ƒäº¤æ¢</strong>ï¼‰ï¼Œæ˜¯ä¸€ç§å¾ˆå‡ºåçš„æ— é”çš„ç®—æ³•ï¼Œå°±æ˜¯å¯ä»¥ä¸ä½¿ç”¨é”æœºåˆ¶å®ç°çº¿ç¨‹é—´çš„åŒæ­¥ã€‚ä½¿ç”¨CASçº¿ç¨‹æ˜¯ä¸ä¼šè¢«é˜»å¡çš„ï¼Œæ‰€ä»¥åˆç§°ä¸ºéé˜»å¡åŒæ­¥ã€‚CASç®—æ³•æ¶‰åŠåˆ°ä¸‰ä¸ªæ“ä½œï¼š</p><p>â€‹éœ€è¦è¯»å†™å†…å­˜å€¼Vï¼›è¿›è¡Œæ¯”è¾ƒçš„å€¼Aï¼›å‡†å¤‡å†™å…¥çš„å€¼B</p><p>â€‹å½“ä¸”ä»…å½“Vçš„å€¼ç­‰äºAçš„å€¼ç­‰äºVçš„å€¼çš„æ—¶å€™ï¼Œæ‰ç”¨Bçš„å€¼å»æ›´æ–°Vçš„å€¼ï¼Œå¦åˆ™ä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œï¼ˆæ¯”è¾ƒå’Œæ›¿æ¢æ˜¯ä¸€ä¸ªåŸå­æ“ä½œ-Aå’ŒVæ¯”è¾ƒï¼ŒVå’ŒBæ›¿æ¢ï¼‰ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ä¸€ä¸ª<strong>è‡ªæ—‹æ“ä½œ</strong>ï¼Œå³<strong>ä¸æ–­é‡è¯•</strong></p><p><strong>ç¼ºç‚¹ï¼š</strong></p><p>â€‹<a href="https://www.zhihu.com/question/23281499/answer/854522984">ABAé—®é¢˜-çŸ¥ä¹</a></p><p>â€‹é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œå¾ˆå®¹æ˜“å‘ç”Ÿå¹¶å‘å†²çªï¼Œå¦‚æœCASä¸€ç›´å¤±è´¥ï¼Œé‚£ä¹ˆå°±ä¼šä¸€ç›´é‡è¯•ï¼Œæµªè´¹CPUèµ„æº</p><p><strong>åŸå­æ€§ï¼š</strong></p><p>â€‹åŠŸèƒ½é™åˆ¶CASæ˜¯èƒ½ä¿è¯å•ä¸ªå˜é‡çš„æ“ä½œæ˜¯åŸå­æ€§çš„ï¼Œåœ¨Javaä¸­è¦é…åˆä½¿ç”¨volatileå…³é”®å­—æ¥ä¿è¯çº¿ç¨‹çš„å®‰å…¨ï¼›å½“æ¶‰åŠåˆ°å¤šä¸ªå˜é‡çš„æ—¶å€™CASæ— èƒ½ä¸ºåŠ›ï¼›é™¤æ­¤ä¹‹å¤–CASå®ç°éœ€è¦ç¡¬ä»¶å±‚é¢çš„æ”¯æŒï¼Œåœ¨Javaçš„æ™®é€šç”¨æˆ·ä¸­æ— æ³•ç›´æ¥ä½¿ç”¨ï¼Œåªèƒ½<strong>å€ŸåŠ©atomicåŒ…ä¸‹çš„åŸå­ç±»</strong>å®ç°ï¼Œçµæ´»æ€§å—åˆ°äº†é™åˆ¶</p><h4 id="2ã€synchronizedåº•å±‚å®ç°"><a href="#2ã€synchronizedåº•å±‚å®ç°" class="headerlink" title="2ã€synchronizedåº•å±‚å®ç°"></a><strong>2ã€synchronizedåº•å±‚å®ç°</strong></h4><p><strong>ä½¿ç”¨æ–¹æ³•ï¼š</strong>ä¸»è¦çš„ä¸‰ç§ä½¿â½¤â½…å¼</p><p>â€‹<strong>ä¿®é¥°å®ä¾‹â½…æ³•:</strong> ä½œâ½¤äºå½“å‰å¯¹è±¡å®ä¾‹åŠ é”ï¼Œè¿›â¼ŠåŒæ­¥ä»£ç å‰è¦è·å¾—å½“å‰å¯¹è±¡å®ä¾‹çš„é”</p><p>â€‹<strong>ä¿®é¥°é™æ€â½…æ³•:</strong> ä¹Ÿå°±æ˜¯ç»™å½“å‰ç±»åŠ é”ï¼Œä¼šä½œâ½¤äºç±»çš„æ‰€æœ‰å¯¹è±¡å®ä¾‹ï¼Œå› ä¸ºé™æ€æˆå‘˜ä¸å±äºä»»ä½•â¼€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œæ˜¯ç±»æˆå‘˜ã€‚</p><p>â€‹<strong>ä¿®é¥°ä»£ç å—:</strong> æŒ‡å®šåŠ é”å¯¹è±¡ï¼Œå¯¹ç»™å®šå¯¹è±¡åŠ é”ï¼Œè¿›â¼ŠåŒæ­¥ä»£ç åº“å‰è¦è·å¾—ç»™å®šå¯¹è±¡çš„é”ã€‚</p><p>â€‹<strong>æ€»ç»“ï¼š</strong>synchronizedé”ä½çš„èµ„æºåªæœ‰ä¸¤ç±»ï¼šä¸€ä¸ªæ˜¯<strong>å¯¹è±¡</strong>ï¼Œä¸€ä¸ªæ˜¯<strong>ç±»</strong>ã€‚</p><p><strong>åº•å±‚å®ç°ï¼š</strong></p><p>â€‹å¯¹è±¡å¤´æ˜¯æˆ‘ä»¬éœ€è¦å…³æ³¨çš„é‡ç‚¹ï¼Œå®ƒæ˜¯synchronizedå®ç°é”çš„åŸºç¡€ï¼Œå› ä¸ºsynchronizedç”³è¯·é”ã€ä¸Šé”ã€é‡Šæ”¾é”éƒ½ä¸å¯¹è±¡å¤´æœ‰å…³ã€‚å¯¹è±¡å¤´ä¸»è¦ç»“æ„æ˜¯ç”±<code>Mark Word</code> ç»„æˆï¼Œ<strong>å…¶ä¸­<code>Mark Word</code>å­˜å‚¨å¯¹è±¡çš„hashCodeã€é”ä¿¡æ¯æˆ–åˆ†ä»£å¹´é¾„æˆ–GCæ ‡å¿—ç­‰ä¿¡æ¯</strong>ã€‚</p><p>â€‹é”ä¹Ÿåˆ†ä¸åŒçŠ¶æ€ï¼ŒJDK6ä¹‹å‰åªæœ‰ä¸¤ä¸ªçŠ¶æ€ï¼šæ— é”ã€æœ‰é”ï¼ˆé‡é‡çº§é”ï¼‰ï¼Œè€Œåœ¨JDK6ä¹‹åå¯¹synchronizedè¿›è¡Œäº†ä¼˜åŒ–ï¼Œæ–°å¢äº†ä¸¤ç§çŠ¶æ€ï¼Œæ€»å…±å°±æ˜¯å››ä¸ªçŠ¶æ€ï¼š<strong>æ— é”çŠ¶æ€ã€åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”</strong>ï¼Œå…¶ä¸­æ— é”å°±æ˜¯ä¸€ç§çŠ¶æ€äº†ã€‚é”çš„ç±»å‹å’ŒçŠ¶æ€åœ¨å¯¹è±¡å¤´<code>Mark Word</code>ä¸­éƒ½æœ‰è®°å½•ï¼Œåœ¨ç”³è¯·é”ã€é”å‡çº§ç­‰è¿‡ç¨‹ä¸­JVMéƒ½éœ€è¦è¯»å–å¯¹è±¡çš„<code>Mark Word</code>æ•°æ®ã€‚</p><p>â€‹åŒæ­¥ä»£ç å—æ˜¯åˆ©ç”¨ monitorenter å’Œ monitorexit æŒ‡ä»¤å®ç°çš„ï¼Œè€ŒåŒæ­¥æ–¹æ³•åˆ™æ˜¯åˆ©ç”¨ flags å®ç°çš„ã€‚</p><h4 id="3ã€ReenTrantLockåº•å±‚å®ç°"><a href="#3ã€ReenTrantLockåº•å±‚å®ç°" class="headerlink" title="3ã€ReenTrantLockåº•å±‚å®ç°"></a><strong>3ã€ReenTrantLockåº•å±‚å®ç°</strong></h4><p>â€‹ç”±äºReentrantLockæ˜¯java.util.concurrentåŒ…ä¸‹æä¾›çš„ä¸€å¥—äº’æ–¥é”ï¼Œç›¸æ¯”Synchronizedï¼ŒReentrantLockç±»æä¾›äº†ä¸€äº›é«˜çº§åŠŸèƒ½</p><p><strong>ä½¿ç”¨æ–¹æ³•ï¼š</strong></p><p>â€‹åŸºäºAPIå±‚é¢çš„äº’æ–¥é”ï¼Œéœ€è¦lock()å’Œunlock()æ–¹æ³•é…åˆtry&#x2F;finallyè¯­å¥å—æ¥å®Œæˆ</p><p><strong>åº•å±‚å®ç°ï¼š</strong></p><p>â€‹ReenTrantLockçš„å®ç°æ˜¯ä¸€ç§è‡ªæ—‹é”ï¼Œé€šè¿‡å¾ªç¯è°ƒç”¨CASæ“ä½œæ¥å®ç°åŠ é”ã€‚å®ƒçš„æ€§èƒ½æ¯”è¾ƒå¥½ä¹Ÿæ˜¯å› ä¸ºé¿å…äº†ä½¿çº¿ç¨‹è¿›å…¥å†…æ ¸æ€çš„é˜»å¡çŠ¶æ€ã€‚æƒ³å°½åŠæ³•é¿å…çº¿ç¨‹è¿›å…¥å†…æ ¸çš„é˜»å¡çŠ¶æ€æ˜¯æˆ‘ä»¬å»åˆ†æå’Œç†è§£é”è®¾è®¡çš„å…³é”®é’¥åŒ™ã€‚</p><p><strong>å’ŒsynchronizedåŒºåˆ«ï¼š</strong></p><p>â€‹1ã€<strong>åº•å±‚å®ç°</strong>ï¼šsynchronized æ˜¯<strong>JVM</strong>å±‚é¢çš„é”ï¼Œæ˜¯<strong>Javaå…³é”®å­—</strong>ï¼Œé€šè¿‡monitorå¯¹è±¡æ¥å®Œæˆï¼ˆmonitorenterä¸monitorexitï¼‰ï¼ŒReentrantLock æ˜¯ä»jdk1.5ä»¥æ¥ï¼ˆjava.util.concurrent.locks.Lockï¼‰æä¾›çš„<strong>APIå±‚é¢</strong>çš„é”ã€‚</p><p>â€‹2ã€<strong>å®ç°åŸç†****ï¼šsynchronized çš„å®ç°æ¶‰åŠåˆ°</strong>é”çš„å‡çº§<strong>ï¼Œå…·ä½“ä¸ºæ— é”ã€åå‘é”ã€è‡ªæ—‹é”ã€å‘OSç”³è¯·é‡é‡çº§é”ï¼›ReentrantLockå®ç°åˆ™æ˜¯é€šè¿‡åˆ©ç”¨</strong>CAS**ï¼ˆCompareAndSwapï¼‰è‡ªæ—‹æœºåˆ¶ä¿è¯çº¿ç¨‹æ“ä½œçš„åŸå­æ€§å’Œvolatileä¿è¯æ•°æ®å¯è§æ€§ä»¥å®ç°é”çš„åŠŸèƒ½ã€‚</p><p>â€‹3ã€<strong>æ˜¯å¦å¯æ‰‹åŠ¨é‡Šæ”¾ï¼š</strong>synchronized ä¸éœ€è¦ç”¨æˆ·å»æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œsynchronized ä»£ç æ‰§è¡Œå®Œåç³»ç»Ÿä¼šè‡ªåŠ¨è®©çº¿ç¨‹é‡Šæ”¾å¯¹é”çš„å ç”¨ï¼› ReentrantLockåˆ™éœ€è¦ç”¨æˆ·å»æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œå¦‚æœæ²¡æœ‰æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œå°±å¯èƒ½å¯¼è‡´<strong>æ­»é”ç°è±¡</strong>ã€‚</p><p>â€‹4ã€<strong>æ˜¯å¦å¯ä¸­æ–­</strong>synchronizedæ˜¯ä¸å¯ä¸­æ–­ç±»å‹çš„é”ï¼Œé™¤éåŠ é”çš„ä»£ç ä¸­å‡ºç°å¼‚å¸¸æˆ–æ­£å¸¸æ‰§è¡Œå®Œæˆï¼› ReentrantLockåˆ™å¯ä»¥ä¸­æ–­ï¼Œå¯é€šè¿‡trylock(long timeout,TimeUnit unit)è®¾ç½®è¶…æ—¶æ–¹æ³•æˆ–è€…å°†lockInterruptibly()æ”¾åˆ°ä»£ç å—ä¸­ï¼Œè°ƒç”¨interruptæ–¹æ³•è¿›è¡Œä¸­æ–­ã€‚</p><p>â€‹5ã€<strong>æ˜¯å¦å…¬å¹³é”</strong>synchronizedä¸ºéå…¬å¹³é” ReentrantLockåˆ™å³å¯ä»¥é€‰å…¬å¹³é”ä¹Ÿå¯ä»¥é€‰éå…¬å¹³é”ï¼Œé€šè¿‡æ„é€ æ–¹æ³•new ReentrantLockæ—¶ä¼ å…¥booleanå€¼è¿›è¡Œé€‰æ‹©ï¼Œä¸ºç©ºé»˜è®¤falseéå…¬å¹³é”ï¼Œtrueä¸ºå…¬å¹³é”,å…¬å¹³é”æ€§èƒ½éå¸¸ä½ã€‚</p><h4 id="4ã€å…¬å¹³é”å’Œéå…¬å¹³é”åŒºåˆ«"><a href="#4ã€å…¬å¹³é”å’Œéå…¬å¹³é”åŒºåˆ«" class="headerlink" title="4ã€å…¬å¹³é”å’Œéå…¬å¹³é”åŒºåˆ«"></a><strong>4ã€å…¬å¹³é”å’Œéå…¬å¹³é”åŒºåˆ«</strong></h4><p><strong>å…¬å¹³é”ï¼š</strong></p><p>â€‹å…¬å¹³é”è‡ªç„¶æ˜¯éµå¾ª<strong>FIFO</strong>ï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰åŸåˆ™çš„ï¼Œå…ˆåˆ°çš„çº¿ç¨‹ä¼šä¼˜å…ˆè·å–èµ„æºï¼Œååˆ°çš„ä¼šè¿›è¡Œæ’é˜Ÿç­‰å¾…</p><p>â€‹<strong>ä¼˜ç‚¹ï¼š</strong>æ‰€æœ‰çš„çº¿ç¨‹éƒ½èƒ½å¾—åˆ°èµ„æºï¼Œä¸ä¼šé¥¿æ­»åœ¨é˜Ÿåˆ—ä¸­ã€‚é€‚åˆå¤§ä»»åŠ¡</p><p>â€‹<strong>ç¼ºç‚¹ï¼š</strong>ååé‡ä¼šä¸‹é™ï¼Œé˜Ÿåˆ—é‡Œé¢é™¤äº†ç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼Œå…¶ä»–çš„çº¿ç¨‹éƒ½ä¼šé˜»å¡ï¼Œcpuå”¤é†’é˜»å¡çº¿ç¨‹çš„å¼€é”€å¤§</p><p><strong>éå…¬å¹³é”ï¼š</strong></p><p>â€‹å¤šä¸ªçº¿ç¨‹å»è·å–é”çš„æ—¶å€™ï¼Œä¼šç›´æ¥å»å°è¯•è·å–ï¼Œè·å–ä¸åˆ°ï¼Œå†å»è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œå¦‚æœèƒ½è·å–åˆ°ï¼Œå°±ç›´æ¥è·å–åˆ°é”ã€‚</p><p>â€‹<strong>ä¼˜ç‚¹ï¼š</strong>å¯ä»¥å‡å°‘CPUå”¤é†’çº¿ç¨‹çš„å¼€é”€ï¼Œæ•´ä½“çš„ååæ•ˆç‡ä¼šé«˜ç‚¹ï¼ŒCPUä¹Ÿä¸å¿…å–å”¤é†’æ‰€æœ‰çº¿ç¨‹ï¼Œä¼šå‡å°‘å”¤èµ·çº¿ç¨‹çš„æ•°é‡ã€‚</p><p>â€‹<strong>ç¼ºç‚¹ï¼š</strong>ä½ ä»¬å¯èƒ½ä¹Ÿå‘ç°äº†ï¼Œè¿™æ ·å¯èƒ½å¯¼è‡´é˜Ÿåˆ—ä¸­é—´çš„çº¿ç¨‹ä¸€ç›´è·å–ä¸åˆ°é”æˆ–è€…é•¿æ—¶é—´è·å–ä¸åˆ°é”</p><img src="https://s0.lgstatic.com/i/image3/M01/02/7D/Ciqah157DAiAK_DJAAC0JawhGp4730.png" alt="img" style="zoom:67%;" /><p><strong>å…¬å¹³é”æ•ˆç‡ä½åŸå› ï¼š</strong></p><p>â€‹å…¬å¹³é”è¦ç»´æŠ¤ä¸€ä¸ªé˜Ÿåˆ—ï¼Œåæ¥çš„çº¿ç¨‹è¦åŠ é”ï¼Œå³ä½¿é”ç©ºé—²ï¼Œä¹Ÿè¦å…ˆæ£€æŸ¥æœ‰æ²¡æœ‰å…¶ä»–çº¿ç¨‹åœ¨ waitï¼Œå¦‚æœæœ‰è‡ªå·±è¦æŒ‚èµ·ï¼ŒåŠ åˆ°é˜Ÿåˆ—åé¢ï¼Œç„¶åå”¤é†’é˜Ÿåˆ—æœ€å‰é¢çº¿ç¨‹ã€‚è¿™ç§æƒ…å†µä¸‹ç›¸æ¯”è¾ƒéå…¬å¹³é”å¤šäº†ä¸€æ¬¡<strong>æŒ‚èµ·å’Œå”¤é†’</strong>ã€‚</p><p>â€‹<strong>çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€</strong>ï¼Œå…¶å®å°±æ˜¯éå…¬å¹³é”æ•ˆç‡é«˜äºå…¬å¹³é”çš„åŸå› ï¼Œå› ä¸º<strong>éå…¬å¹³é”å‡å°‘äº†çº¿ç¨‹æŒ‚èµ·çš„å‡ ç‡</strong>ï¼Œåæ¥çš„çº¿ç¨‹æœ‰ä¸€å®šå‡ ç‡é€ƒç¦»è¢«æŒ‚èµ·çš„å¼€é”€ã€‚</p><h4 id="5ã€ä½¿ç”¨å±‚é¢é”ä¼˜åŒ–"><a href="#5ã€ä½¿ç”¨å±‚é¢é”ä¼˜åŒ–" class="headerlink" title="5ã€ä½¿ç”¨å±‚é¢é”ä¼˜åŒ–"></a><strong>5ã€ä½¿ç”¨å±‚é¢é”ä¼˜åŒ–</strong></h4><p>â€‹ã€1ã€‘<strong>å‡å°‘é”çš„æ—¶é—´ï¼š</strong><br>â€‹ä¸éœ€è¦åŒæ­¥æ‰§è¡Œçš„ä»£ç ï¼Œèƒ½ä¸æ”¾åœ¨åŒæ­¥å¿«é‡Œé¢æ‰§è¡Œå°±ä¸è¦æ”¾åœ¨åŒæ­¥å¿«å†…ï¼Œå¯ä»¥è®©é”å°½å¿«é‡Šæ”¾ï¼›</p><p>â€‹ã€2ã€‘<strong>å‡å°‘é”çš„ç²’åº¦ï¼š</strong><br>â€‹å®ƒçš„æ€æƒ³æ˜¯å°†ç‰©ç†ä¸Šçš„ä¸€ä¸ªé”ï¼Œæ‹†æˆé€»è¾‘ä¸Šçš„å¤šä¸ªé”ï¼Œå¢åŠ å¹¶è¡Œåº¦ï¼Œä»è€Œé™ä½é”ç«äº‰ã€‚å®ƒçš„æ€æƒ³ä¹Ÿæ˜¯ç”¨ç©ºé—´æ¥æ¢æ—¶é—´ï¼›javaä¸­å¾ˆå¤šæ•°æ®ç»“æ„éƒ½æ˜¯é‡‡ç”¨è¿™ç§æ–¹æ³•æé«˜å¹¶å‘æ“ä½œçš„æ•ˆç‡ï¼Œæ¯”å¦‚ï¼š</p><p>â€‹<strong>ConcurrentHashMapï¼š</strong></p><p>â€‹javaä¸­çš„ConcurrentHashMapåœ¨jdk1.8ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œä½¿ç”¨ä¸€ä¸ªSegment æ•°ç»„ï¼šSegment&lt; K,V &gt;[] segments</p><p>â€‹Segmentç»§æ‰¿è‡ªReenTrantLockï¼Œæ‰€ä»¥æ¯ä¸ªSegmentæ˜¯ä¸ªå¯é‡å…¥é”ï¼Œæ¯ä¸ªSegment æœ‰ä¸€ä¸ªHashEntry&lt; K,V &gt;æ•°ç»„ç”¨æ¥å­˜æ”¾æ•°æ®ï¼Œputæ“ä½œæ—¶ï¼Œå…ˆç¡®å®šå¾€å“ªä¸ªSegmentæ”¾æ•°æ®ï¼Œåªéœ€è¦é”å®šè¿™ä¸ªSegmentï¼Œæ‰§è¡Œputï¼Œå…¶å®ƒçš„Segmentä¸ä¼šè¢«é”å®šï¼›æ‰€ä»¥æ•°ç»„ä¸­æœ‰å¤šå°‘ä¸ªSegmentå°±å…è®¸åŒä¸€æ—¶åˆ»å¤šå°‘ä¸ªçº¿ç¨‹å­˜æ”¾æ•°æ®ï¼Œè¿™æ ·å¢åŠ äº†å¹¶å‘èƒ½åŠ›ã€‚</p><p>â€‹ã€3ã€‘<strong>é”ç²—åŒ–ï¼š</strong><br>â€‹å¤§éƒ¨åˆ†æƒ…å†µä¸‹æˆ‘ä»¬æ˜¯è¦è®©é”çš„ç²’åº¦æœ€å°åŒ–ï¼Œé”çš„ç²—åŒ–åˆ™æ˜¯è¦å¢å¤§é”çš„ç²’åº¦; </p><p>â€‹å‡å¦‚æœ‰ä¸€ä¸ªå¾ªç¯ï¼Œå¾ªç¯å†…çš„æ“ä½œéœ€è¦åŠ é”ï¼Œæˆ‘ä»¬åº”è¯¥æŠŠé”æ”¾åˆ°å¾ªç¯å¤–é¢ï¼Œå¦åˆ™æ¯æ¬¡è¿›å‡ºå¾ªç¯ï¼Œéƒ½è¿›å‡ºä¸€æ¬¡ä¸´ç•ŒåŒºï¼Œæ•ˆç‡æ˜¯éå¸¸å·®çš„ï¼›</p><p>â€‹ã€4ã€‘<strong>ä½¿ç”¨è¯»å†™é”ï¼š</strong></p><p>â€‹ReentrantReadWriteLock æ˜¯ä¸€ä¸ªè¯»å†™é”ï¼Œè¯»æ“ä½œåŠ è¯»é”ï¼Œå¯å¹¶å‘è¯»ï¼Œå†™æ“ä½œä½¿ç”¨å†™é”ï¼Œåªèƒ½å•çº¿ç¨‹å†™ï¼›</p><p>â€‹ã€5ã€‘<strong>ä½¿ç”¨CASï¼š</strong></p><p>â€‹å¦‚æœéœ€è¦åŒæ­¥çš„æ“ä½œæ‰§è¡Œé€Ÿåº¦éå¸¸å¿«ï¼Œå¹¶ä¸”çº¿ç¨‹ç«äº‰å¹¶ä¸æ¿€çƒˆï¼Œè¿™æ—¶å€™ä½¿ç”¨casæ•ˆç‡ä¼šæ›´é«˜ï¼Œå› ä¸ºåŠ é”ä¼šå¯¼è‡´çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¦‚æœä¸Šä¸‹æ–‡åˆ‡æ¢çš„è€—æ—¶æ¯”åŒæ­¥æ“ä½œæœ¬èº«æ›´è€—æ—¶ï¼Œä¸”çº¿ç¨‹å¯¹èµ„æºçš„ç«äº‰ä¸æ¿€çƒˆï¼Œä½¿ç”¨volatiled+casæ“ä½œä¼šæ˜¯éå¸¸é«˜æ•ˆçš„é€‰æ‹©ï¼›</p><h4 id="6ã€ç³»ç»Ÿå±‚é¢é”ä¼˜åŒ–"><a href="#6ã€ç³»ç»Ÿå±‚é¢é”ä¼˜åŒ–" class="headerlink" title="6ã€ç³»ç»Ÿå±‚é¢é”ä¼˜åŒ–"></a>6ã€ç³»ç»Ÿå±‚é¢é”ä¼˜åŒ–</h4><p><strong>è‡ªé€‚åº”è‡ªæ—‹é”ï¼š</strong></p><p>â€‹è‡ªæ—‹é”å¯ä»¥é¿å…ç­‰å¾…ç«äº‰é”è¿›å…¥é˜»å¡æŒ‚èµ·çŠ¶æ€è¢«å”¤é†’é€ æˆçš„<strong>å†…æ ¸æ€å’Œç”¨æˆ·æ€ä¹‹é—´çš„åˆ‡æ¢</strong>çš„æŸè€—ï¼Œå®ƒä»¬åªéœ€è¦ç­‰ä¸€ç­‰ï¼ˆè‡ªæ—‹ï¼‰ï¼Œä½†æ˜¯å¦‚æœé”è¢«å…¶ä»–çº¿ç¨‹é•¿æ—¶é—´å ç”¨ï¼Œä¸€ç›´ä¸é‡Šæ”¾CPUï¼Œæ­»ç­‰ä¼šå¸¦æ¥æ›´å¤šçš„æ€§èƒ½å¼€é”€ï¼›è‡ªæ—‹æ¬¡æ•°é»˜è®¤å€¼æ˜¯10</p><p>â€‹å¯¹ä¸Šé¢è‡ªæ—‹é”ä¼˜åŒ–æ–¹å¼çš„è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œå®ƒçš„è‡ªæ—‹çš„æ¬¡æ•°ä¸å†å›ºå®šï¼Œå…¶è‡ªæ—‹çš„æ¬¡æ•°ç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„<strong>è‡ªæ—‹æ—¶é—´åŠé”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€</strong>æ¥å†³å®šï¼Œè¿™å°±è§£å†³äº†è‡ªæ—‹é”å¸¦æ¥çš„ç¼ºç‚¹</p><p><strong>é”æ¶ˆé™¤ï¼š</strong></p><p>â€‹é”å‰Šé™¤æ˜¯æŒ‡è™šæ‹Ÿæœºå³æ—¶ç¼–è¯‘å™¨åœ¨è¿è¡Œæ—¶ï¼Œå¯¹ä¸€äº›ä»£ç ä¸Šè¦æ±‚åŒæ­¥ï¼Œä½†æ˜¯è¢«æ£€æµ‹åˆ°ä¸å¯èƒ½å­˜åœ¨å…±äº«æ•°æ®ç«äº‰çš„é”è¿›è¡Œå‰Šé™¤ã€‚Nettyä¸­æ— é”åŒ–è®¾è®¡pipelineä¸­channelhandlerä¼šè¿›è¡Œé”æ¶ˆé™¤çš„ä¼˜åŒ–ã€‚</p><p><strong>é”å‡çº§ï¼š</strong></p><p>â€‹<strong>åå‘é”ï¼š</strong></p><p>â€‹å¦‚æœçº¿ç¨‹å·²ç»å æœ‰è¿™ä¸ªé”ï¼Œå½“ä»–åœ¨æ¬¡è¯•å›¾å»è·å–è¿™ä¸ªé”çš„æ—¶å€™ï¼Œä»–ä¼šå·²æœ€å¿«çš„æ–¹å¼å»æ‹¿åˆ°è¿™ä¸ªé”ï¼Œè€Œä¸éœ€è¦åœ¨è¿›è¡Œä¸€äº›monitoræ“ä½œï¼Œå› ä¸ºåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹æ˜¯æ²¡æœ‰ç«äº‰çš„ï¼Œæ‰€ä»¥ä½¿ç”¨åå‘é”æ˜¯å¯ä»¥æé«˜æ€§èƒ½çš„ï¼›</p><p>â€‹<strong>è½»é‡çº§é”ï¼š</strong></p><p>â€‹åœ¨ç«äº‰ä¸æ¿€çƒˆçš„æƒ…å†µä¸‹ï¼Œé€šè¿‡CASé¿å…çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¯ä»¥æ˜¾è‘—çš„æé«˜æ€§èƒ½ã€‚</p><p>â€‹<strong>é‡é‡çº§é”ï¼š</strong></p><p>â€‹é‡é‡çº§é”çš„åŠ é”ã€è§£é”è¿‡ç¨‹é€ æˆçš„æŸè€—æ˜¯å›ºå®šçš„ï¼Œé‡é‡çº§é”é€‚åˆäºç«äº‰æ¿€çƒˆã€é«˜å¹¶å‘ã€åŒæ­¥å—æ‰§è¡Œæ—¶é—´é•¿çš„æƒ…å†µã€‚</p><h4 id="7ã€ThreadLocalåŸç†"><a href="#7ã€ThreadLocalåŸç†" class="headerlink" title="7ã€ThreadLocalåŸç†"></a><strong>7ã€ThreadLocalåŸç†</strong></h4><p><strong>ThreadLocalç®€ä»‹ï¼š</strong></p><p>â€‹é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åˆ›å»ºçš„å˜é‡æ˜¯å¯ä»¥è¢«ä»»ä½•â¼€ä¸ªçº¿ç¨‹è®¿é—®å¹¶ä¿®æ”¹çš„ã€‚å¦‚æœæƒ³å®ç°æ¯â¼€ä¸ªçº¿ç¨‹éƒ½æœ‰â¾ƒâ¼°çš„<br>ä¸“å±æœ¬åœ°å˜é‡è¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ JDKä¸­æä¾›çš„ ThreadLocal ç±»æ­£æ˜¯ä¸ºäº†è§£å†³è¿™æ ·çš„é—®é¢˜ã€‚ç±»ä¼¼æ“ä½œç³»ç»Ÿä¸­çš„TLAB</p><p><strong>åŸç†ï¼š</strong></p><p>â€‹é¦–å…ˆ ThreadLocal æ˜¯ä¸€ä¸ªæ³›å‹ç±»ï¼Œä¿è¯å¯ä»¥æ¥å—ä»»ä½•ç±»å‹çš„å¯¹è±¡ã€‚å› ä¸ºä¸€ä¸ªçº¿ç¨‹å†…å¯ä»¥å­˜åœ¨å¤šä¸ª ThreadLocal å¯¹è±¡ï¼Œæ‰€ä»¥å…¶å®æ˜¯ ThreadLocal å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª Map ï¼Œæ˜¯ ThreadLocal å®ç°çš„ä¸€ä¸ªå«åš ThreadLocalMap çš„é™æ€å†…éƒ¨ç±»ã€‚</p><p>â€‹æœ€ç»ˆçš„å˜é‡æ˜¯æ”¾åœ¨äº†å½“å‰çº¿ç¨‹çš„ <code>ThreadLocalMap</code> ä¸­ï¼Œå¹¶ä¸æ˜¯å­˜åœ¨ ThreadLocal ä¸Šï¼ŒThreadLocal å¯ä»¥ç†è§£ä¸ºåªæ˜¯ThreadLocalMapçš„å°è£…ï¼Œä¼ é€’äº†å˜é‡å€¼ã€‚</p><p>â€‹æˆ‘ä»¬ä½¿ç”¨çš„ get()ã€set() æ–¹æ³•å…¶å®éƒ½æ˜¯è°ƒç”¨äº†è¿™ä¸ªThreadLocalMapç±»å¯¹åº”çš„ get()ã€set() æ–¹æ³•ã€‚ä¾‹å¦‚ä¸‹é¢çš„ </p><p><strong>å¦‚ä½•ä½¿ç”¨ï¼š</strong></p><p>â€‹1ï¼‰å­˜å‚¨ç”¨æˆ·Session</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ThreadLocal</span> <span class="variable">threadSession</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>();</span><br></pre></td></tr></table></figure><p>â€‹2ï¼‰è§£å†³çº¿ç¨‹å®‰å…¨çš„é—®é¢˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;SimpleDateFormat&gt; format1 = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;SimpleDateFormat&gt;()</span><br></pre></td></tr></table></figure><p><strong>ThreadLocalå†…å­˜æ³„æ¼çš„åœºæ™¯</strong> </p><p>â€‹å®é™…ä¸Š ThreadLocalMap ä¸­ä½¿ç”¨çš„ key ä¸º ThreadLocal çš„å¼±å¼•ç”¨ï¼Œâ½½ value æ˜¯å¼ºå¼•â½¤ã€‚å¼±å¼•ç”¨çš„ç‰¹ç‚¹æ˜¯ï¼Œå¦‚æœè¿™ä¸ªå¯¹è±¡æŒæœ‰å¼±å¼•ç”¨ï¼Œé‚£ä¹ˆåœ¨ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶çš„æ—¶å€™å¿…ç„¶ä¼šè¢«æ¸…ç†æ‰ã€‚</p><p>â€‹æ‰€ä»¥å¦‚æœ ThreadLocal æ²¡æœ‰è¢«å¤–éƒ¨å¼ºå¼•ç”¨çš„æƒ…å†µä¸‹ï¼Œåœ¨åƒåœ¾å›æ”¶çš„æ—¶å€™ä¼šè¢«æ¸…ç†æ‰çš„ï¼Œè¿™æ ·ä¸€æ¥ ThreadLocalMapä¸­ä½¿ç”¨è¿™ä¸ª ThreadLocal çš„ key ä¹Ÿä¼šè¢«æ¸…ç†æ‰ã€‚ä½†æ˜¯ï¼Œvalue æ˜¯å¼ºå¼•ç”¨ï¼Œä¸ä¼šè¢«æ¸…ç†ï¼Œè¿™æ ·ä¸€æ¥å°±ä¼šå‡ºç° key ä¸º null çš„ valueã€‚ å‡å¦‚æˆ‘ä»¬ä¸åšä»»ä½•æªæ–½çš„è¯ï¼Œvalue æ°¸è¿œâ½†æ³•è¢«GC å›æ”¶ï¼Œå¦‚æœçº¿ç¨‹é•¿æ—¶é—´ä¸è¢«é”€æ¯ï¼Œå¯èƒ½ä¼šäº§â½£å†…å­˜æ³„éœ²ã€‚</p><img src="https://s0.lgstatic.com/i/image3/M01/68/C4/Cgq2xl5Pld-AHFhJAADLtGXmSxc833.png" alt="img" style="zoom:67%;" /><p>â€‹ThreadLocalMapå®ç°ä¸­å·²ç»è€ƒè™‘äº†è¿™ç§æƒ…å†µï¼Œåœ¨è°ƒç”¨ set()ã€get()ã€remove() æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šæ¸…ç†æ‰ key ä¸º null çš„è®°å½•ã€‚å¦‚æœè¯´ä¼šå‡ºç°å†…å­˜æ³„æ¼ï¼Œé‚£åªæœ‰åœ¨å‡ºç°äº† key ä¸º null çš„è®°å½•åï¼Œæ²¡æœ‰æ‰‹åŠ¨è°ƒç”¨ remove() æ–¹æ³•ï¼Œå¹¶ä¸”ä¹‹åä¹Ÿä¸å†è°ƒç”¨ get()ã€set()ã€remove() æ–¹æ³•çš„æƒ…å†µä¸‹ã€‚å› æ­¤ä½¿â½¤å®ŒThreadLocal â½…æ³•åï¼Œ<strong>æœ€å¥½â¼¿åŠ¨è°ƒâ½¤ remove() â½…æ³•</strong>ã€‚</p><h4 id="8ã€HashMapçº¿ç¨‹å®‰å…¨"><a href="#8ã€HashMapçº¿ç¨‹å®‰å…¨" class="headerlink" title="8ã€HashMapçº¿ç¨‹å®‰å…¨"></a><strong>8ã€HashMapçº¿ç¨‹å®‰å…¨</strong></h4><p>â€‹<strong>æ­»å¾ªç¯é€ æˆ CPU 100%</strong></p><p>â€‹HashMap æœ‰å¯èƒ½ä¼šå‘ç”Ÿæ­»å¾ªç¯å¹¶ä¸”é€ æˆ  CPU 100% ï¼Œè¿™ç§æƒ…å†µå‘ç”Ÿæœ€ä¸»è¦çš„åŸå› å°±æ˜¯åœ¨<strong>æ‰©å®¹</strong>çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯å†…éƒ¨<strong>æ–°å»ºæ–°çš„ HashMap</strong> çš„æ—¶å€™ï¼Œæ‰©å®¹çš„é€»è¾‘ä¼š<strong>åè½¬æ•£åˆ—æ¡¶ä¸­çš„èŠ‚ç‚¹é¡ºåº</strong>ï¼Œå½“æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œæ‰©å®¹çš„æ—¶å€™ï¼Œç”±äº HashMap å¹¶éçº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥å¦‚æœ<strong>ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶åè½¬çš„è¯ï¼Œä¾¿å¯èƒ½å½¢æˆä¸€ä¸ªå¾ªç¯</strong>ï¼Œå¹¶ä¸”è¿™ç§å¾ªç¯æ˜¯é“¾è¡¨çš„å¾ªç¯ï¼Œç›¸å½“äº A èŠ‚ç‚¹æŒ‡å‘ B èŠ‚ç‚¹ï¼ŒB èŠ‚ç‚¹åˆæŒ‡å›åˆ° A èŠ‚ç‚¹ï¼Œè¿™æ ·ä¸€æ¥ï¼Œåœ¨ä¸‹ä¸€æ¬¡æƒ³è¦è·å–è¯¥ key æ‰€å¯¹åº”çš„ value çš„æ—¶å€™ï¼Œä¾¿ä¼šåœ¨éå†é“¾è¡¨çš„æ—¶å€™å‘ç”Ÿæ°¸è¿œæ— æ³•éå†ç»“æŸçš„æƒ…å†µï¼Œä¹Ÿå°±å‘ç”Ÿ CPU 100% çš„æƒ…å†µã€‚</p><p>â€‹æ‰€ä»¥ç»¼ä¸Šæ‰€è¿°ï¼ŒHashMap æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œåœ¨å¤šçº¿ç¨‹ä½¿ç”¨åœºæ™¯ä¸­æ¨èä½¿ç”¨çº¿ç¨‹å®‰å…¨åŒæ—¶æ€§èƒ½æ¯”è¾ƒå¥½çš„ ConcurrentHashMapã€‚</p><h4 id="9ã€Stringä¸å¯å˜åŸå› "><a href="#9ã€Stringä¸å¯å˜åŸå› " class="headerlink" title="9ã€Stringä¸å¯å˜åŸå› "></a>9ã€Stringä¸å¯å˜åŸå› </h4><ol><li><p>å¯ä»¥ä½¿ç”¨<strong>å­—ç¬¦ä¸²å¸¸é‡æ± </strong>ï¼Œå¤šæ¬¡åˆ›å»ºåŒæ ·çš„å­—ç¬¦ä¸²ä¼šæŒ‡å‘åŒä¸€ä¸ªå†…å­˜åœ°å€</p></li><li><p>å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ç”¨ä½œ <strong>HashMap çš„ key</strong>ã€‚é€šå¸¸å»ºè®®æŠŠä¸å¯å˜å¯¹è±¡ä½œä¸º HashMapçš„ key</p></li><li><p>hashCodeç”Ÿæˆåå°±ä¸ä¼šæ”¹å˜ï¼Œä½¿ç”¨æ—¶æ— éœ€é‡æ–°è®¡ç®—</p></li><li><p>çº¿ç¨‹å®‰å…¨ï¼Œå› ä¸ºå…·å¤‡ä¸å˜æ€§çš„å¯¹è±¡ä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„</p></li></ol><h3 id="å†…å­˜æ¨¡å‹"><a href="#å†…å­˜æ¨¡å‹" class="headerlink" title="å†…å­˜æ¨¡å‹"></a>å†…å­˜æ¨¡å‹</h3><p>â€‹Java å†…å­˜æ¨¡å‹ï¼ˆJava Memory Modelï¼ŒJMMï¼‰å°±æ˜¯ä¸€ç§ç¬¦åˆå†…å­˜æ¨¡å‹è§„èŒƒçš„ï¼Œå±è”½äº†å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„è®¿é—®å·®å¼‚çš„ï¼Œä¿è¯äº† Java ç¨‹åºåœ¨å„ç§å¹³å°ä¸‹å¯¹å†…å­˜çš„è®¿é—®éƒ½èƒ½ä¿è¯æ•ˆæœä¸€è‡´çš„æœºåˆ¶åŠè§„èŒƒã€‚</p><p><img src="https://s0.lgstatic.com/i/image3/M01/7A/05/Cgq2xl54fTKALhevAAB_l3axT_o532.png" alt="img"></p><p>â€‹JMM æ˜¯ä¸€ç§è§„èŒƒï¼Œæ˜¯è§£å†³ç”±äºå¤šçº¿ç¨‹é€šè¿‡å…±äº«å†…å­˜è¿›è¡Œé€šä¿¡æ—¶ï¼Œå­˜åœ¨çš„æœ¬åœ°å†…å­˜æ•°æ®ä¸ä¸€è‡´ã€ç¼–è¯‘å™¨ä¼šå¯¹ä»£ç æŒ‡ä»¤é‡æ’åºã€å¤„ç†å™¨ä¼šå¯¹ä»£ç ä¹±åºæ‰§è¡Œç­‰å¸¦æ¥çš„é—®é¢˜ã€‚ç›®çš„æ˜¯ä¿è¯å¹¶å‘ç¼–ç¨‹åœºæ™¯ä¸­çš„åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§ã€‚</p><p><strong>åŸå­æ€§ï¼š</strong></p><p>â€‹åœ¨ Java ä¸­ï¼Œä¸ºäº†ä¿è¯åŸå­æ€§ï¼Œæä¾›äº†ä¸¤ä¸ªé«˜çº§çš„å­—èŠ‚ç æŒ‡ä»¤ Monitorenter å’Œ Monitorexitã€‚è¿™ä¸¤ä¸ªå­—èŠ‚ç ï¼Œåœ¨ Java ä¸­å¯¹åº”çš„å…³é”®å­—å°±æ˜¯ Synchronizedã€‚å› æ­¤ï¼Œåœ¨ Java ä¸­å¯ä»¥ä½¿ç”¨ Synchronized æ¥ä¿è¯æ–¹æ³•å’Œä»£ç å—å†…çš„æ“ä½œæ˜¯åŸå­æ€§çš„ã€‚</p><p><strong>å¯è§æ€§ï¼š</strong></p><p>â€‹Java ä¸­çš„ Volatile å…³é”®å­—ä¿®é¥°çš„å˜é‡åœ¨è¢«ä¿®æ”¹åå¯ä»¥ç«‹å³åŒæ­¥åˆ°ä¸»å†…å­˜ã€‚è¢«å…¶ä¿®é¥°çš„å˜é‡åœ¨æ¯æ¬¡ä½¿ç”¨ä¹‹å‰éƒ½ä»ä¸»å†…å­˜åˆ·æ–°ã€‚å› æ­¤ï¼Œå¯ä»¥ä½¿ç”¨ Volatile æ¥ä¿è¯å¤šçº¿ç¨‹æ“ä½œæ—¶å˜é‡çš„å¯è§æ€§ã€‚é™¤äº† Volatileï¼ŒJava ä¸­çš„ Synchronized å’Œ Final ä¸¤ä¸ªå…³é”®å­—ä¹Ÿå¯ä»¥å®ç°å¯è§æ€§ã€‚åªä¸è¿‡å®ç°æ–¹å¼ä¸åŒ</p><p><strong>æœ‰åºæ€§</strong></p><p>â€‹åœ¨ Java ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Synchronized å’Œ Volatile æ¥ä¿è¯å¤šçº¿ç¨‹ä¹‹é—´æ“ä½œçš„æœ‰åºæ€§ã€‚åŒºåˆ«ï¼šVolatile ç¦æ­¢æŒ‡ä»¤é‡æ’ã€‚Synchronized ä¿è¯åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€æ¡çº¿ç¨‹æ“ä½œã€‚</p><h4 id="1ã€volatileåº•å±‚å®ç°"><a href="#1ã€volatileåº•å±‚å®ç°" class="headerlink" title="1ã€volatileåº•å±‚å®ç°"></a><strong>1ã€volatileåº•å±‚å®ç°</strong></h4><p><strong>ä½œç”¨ï¼š</strong></p><p>â€‹ä¿è¯æ•°æ®çš„â€œå¯è§æ€§â€ï¼šè¢«volatileä¿®é¥°çš„å˜é‡èƒ½å¤Ÿä¿è¯æ¯ä¸ªçº¿ç¨‹èƒ½å¤Ÿè·å–è¯¥å˜é‡çš„æœ€æ–°å€¼ï¼Œä»è€Œé¿å…å‡ºç°æ•°æ®è„è¯»çš„ç°è±¡ã€‚</p><p>â€‹ç¦æ­¢æŒ‡ä»¤é‡æ’ï¼šåœ¨å¤šçº¿ç¨‹æ“ä½œæƒ…å†µä¸‹ï¼ŒæŒ‡ä»¤é‡æ’ä¼šå¯¼è‡´è®¡ç®—ç»“æœä¸ä¸€è‡´</p><p><strong>åº•å±‚å®ç°ï¼š</strong></p><p>â€‹â€œè§‚å¯ŸåŠ å…¥volatileå…³é”®å­—å’Œæ²¡æœ‰åŠ å…¥volatileå…³é”®å­—æ—¶æ‰€ç”Ÿæˆçš„æ±‡ç¼–ä»£ç å‘ç°ï¼ŒåŠ å…¥volatileå…³é”®å­—æ—¶ï¼Œä¼šå¤šå‡ºä¸€ä¸ªlockå‰ç¼€æŒ‡ä»¤â€</p><p>ã€€ã€€lockå‰ç¼€æŒ‡ä»¤å®é™…ä¸Šç›¸å½“äºä¸€ä¸ª<strong>å†…å­˜å±éšœ</strong>ï¼ˆä¹Ÿæˆå†…å­˜æ …æ ï¼‰ï¼Œå†…å­˜å±éšœä¼šæä¾›3ä¸ªåŠŸèƒ½ï¼š</p><p>ã€€ã€€1ï¼‰å®ƒç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ä¸ä¼šæŠŠå…¶åé¢çš„æŒ‡ä»¤æ’åˆ°å†…å­˜å±éšœä¹‹å‰çš„ä½ç½®ï¼Œä¹Ÿä¸ä¼šæŠŠå‰é¢çš„æŒ‡ä»¤æ’åˆ°å†…å­˜å±éšœçš„åé¢ï¼›</p><p>ã€€ã€€2ï¼‰å®ƒä¼šå¼ºåˆ¶å°†å¯¹ç¼“å­˜çš„ä¿®æ”¹æ“ä½œç«‹å³å†™å…¥ä¸»å­˜ï¼›</p><p>ã€€ã€€3ï¼‰å¦‚æœæ˜¯å†™æ“ä½œï¼Œå®ƒä¼šå¯¼è‡´å…¶ä»–CPUä¸­å¯¹åº”çš„ç¼“å­˜è¡Œæ— æ•ˆã€‚</p><p><strong>å•ä¾‹æ¨¡å¼ä¸­volatileçš„ä½œç”¨ï¼š</strong></p><p>é˜²æ­¢ä»£ç è¯»å–åˆ°instanceä¸ä¸ºnullæ—¶ï¼Œinstanceå¼•ç”¨çš„å¯¹è±¡æœ‰å¯èƒ½è¿˜æ²¡æœ‰å®Œæˆåˆå§‹åŒ–ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Singleton</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> <span class="type">Singleton</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="literal">null</span>;   <span class="comment">//ç¦æ­¢æŒ‡ä»¤é‡æ’</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(instance==<span class="literal">null</span>) &#123; <span class="comment">//å‡å°‘åŠ é”çš„æŸè€—</span></span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton.class) &#123;</span><br><span class="line">                <span class="keyword">if</span>(instance==<span class="literal">null</span>) <span class="comment">//ç¡®è®¤æ˜¯å¦åˆå§‹åŒ–å®Œæˆ</span></span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2ã€AQSæ€æƒ³"><a href="#2ã€AQSæ€æƒ³" class="headerlink" title="2ã€AQSæ€æƒ³"></a><strong>2ã€AQSæ€æƒ³</strong></h4><p>â€‹AQSçš„å…¨ç§°ä¸ºï¼ˆAbstractQueuedSynchronizerï¼‰æŠ½è±¡çš„é˜Ÿåˆ—å¼çš„åŒæ­¥å™¨ï¼Œæ˜¯â¼€ä¸ªâ½¤æ¥æ„å»ºé”å’ŒåŒæ­¥å™¨çš„æ¡†æ¶ï¼Œä½¿â½¤AQSèƒ½ç®€å•ä¸”â¾¼æ•ˆåœ°æ„é€ å‡ºåº”â½¤â¼´æ³›çš„â¼¤é‡çš„åŒæ­¥å™¨ï¼Œå¦‚ï¼šåŸºäºAQSå®ç°çš„lock, CountDownLatchã€CyclicBarrierã€Semaphoreéœ€è§£å†³çš„é—®é¢˜ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">çŠ¶æ€çš„åŸå­æ€§ç®¡ç†</span><br><span class="line">çº¿ç¨‹çš„é˜»å¡ä¸è§£é™¤é˜»å¡</span><br><span class="line">é˜Ÿåˆ—çš„ç®¡ç†</span><br></pre></td></tr></table></figure><p>â€‹AQSæ ¸â¼¼æ€æƒ³æ˜¯ï¼Œå¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºç©ºé—²ï¼Œåˆ™å°†å½“å‰è¯·æ±‚èµ„æºçš„çº¿ç¨‹è®¾ç½®ä¸ºæœ‰æ•ˆçš„â¼¯ä½œçº¿ç¨‹ï¼Œå¹¶ä¸”å°†å…±äº«èµ„æºè®¾ç½®ä¸ºé”å®šçŠ¶æ€ã€‚å¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºè¢«å â½¤ï¼Œé‚£ä¹ˆå°±éœ€è¦â¼€å¥—çº¿ç¨‹é˜»å¡ç­‰å¾…ä»¥åŠè¢«å”¤é†’æ—¶é”åˆ†é…çš„æœºåˆ¶ï¼Œè¿™ä¸ªæœºåˆ¶AQSæ˜¯â½¤<strong>CLHï¼ˆè™šæ‹Ÿçš„åŒå‘é˜Ÿåˆ—ï¼‰</strong>é˜Ÿåˆ—é”å®ç°çš„ï¼Œå³å°†æš‚æ—¶è·å–ä¸åˆ°é”çš„çº¿ç¨‹åŠ â¼Šåˆ°é˜Ÿåˆ—ä¸­ã€‚</p><p><strong>lockï¼š</strong></p><p>â€‹æ˜¯ä¸€ç§å¯é‡å…¥é”ï¼Œé™¤äº†èƒ½å®Œæˆ synchronized æ‰€èƒ½å®Œæˆçš„æ‰€æœ‰å·¥ä½œå¤–ï¼Œè¿˜æä¾›äº†è¯¸å¦‚å¯å“åº”ä¸­æ–­é”ã€å¯è½®è¯¢é”è¯·æ±‚ã€å®šæ—¶é”ç­‰é¿å…å¤šçº¿ç¨‹æ­»é”çš„æ–¹æ³•ã€‚é»˜è®¤ä¸ºéå…¬å¹³é”ï¼Œä½†å¯ä»¥åˆå§‹åŒ–ä¸ºå…¬å¹³é”ï¼› é€šè¿‡æ–¹æ³• lock()ä¸ unlock()æ¥è¿›è¡ŒåŠ é”ä¸è§£é”æ“ä½œï¼›</p><p><strong>CountDownLatchï¼š</strong></p><p>â€‹é€šè¿‡è®¡æ•°æ³•ï¼ˆå€’è®¡æ—¶å™¨ï¼‰ï¼Œè®©ä¸€äº›çº¿ç¨‹å µå¡ç›´åˆ°å¦ä¸€ä¸ªçº¿ç¨‹å®Œæˆä¸€ç³»åˆ—æ“ä½œåæ‰è¢«å”¤é†’ï¼›è¯¥â¼¯å…·é€šå¸¸â½¤æ¥æ§åˆ¶çº¿ç¨‹ç­‰å¾…ï¼Œå®ƒå¯ä»¥è®©æŸâ¼€ä¸ªçº¿ç¨‹ç­‰å¾…ç›´åˆ°å€’è®¡æ—¶ç»“æŸï¼Œå†å¼€å§‹æ‰§â¾ã€‚å…·ä½“å¯ä»¥ä½¿ç”¨countDownLatch.await()æ¥ç­‰å¾…ç»“æœã€‚å¤šç”¨äºå¤šçº¿ç¨‹ä¿¡æ¯æ±‡æ€»ã€‚</p><p><strong>CompletableFutureï¼š</strong></p><p>â€‹é€šè¿‡è®¾ç½®å‚æ•°ï¼Œå¯ä»¥å®ŒæˆCountDownLatchåŒæ ·çš„å¤šå¹³å°å“åº”é—®é¢˜ï¼Œä½†æ˜¯å¯ä»¥é’ˆå¯¹å…¶ä¸­éƒ¨åˆ†è¿”å›ç»“æœåšæ›´åŠ çµæ´»çš„å±•ç¤ºã€‚</p><p><strong>CyclicBarrierï¼š</strong></p><p>â€‹å­—é¢æ„æ€æ˜¯å¯å¾ªç¯(Cyclic)ä½¿ç”¨çš„å±éšœï¼ˆBarrierï¼‰ã€‚ä»–è¦åšçš„äº‹æƒ…æ˜¯ï¼Œè®©ä¸€ç»„çº¿ç¨‹åˆ°è¾¾ä¸€ä¸ªå±éšœï¼ˆä¹Ÿå¯ä»¥å«åŒæ­¥ç‚¹ï¼‰æ—¶è¢«é˜»å¡ï¼Œç›´åˆ°æœ€åä¸€ä¸ªçº¿ç¨‹åˆ°è¾¾å±éšœæ—¶ï¼Œå±éšœæ‰ä¼šå¼€é—¨ï¼Œæ‰€æœ‰è¢«å±éšœæ‹¦æˆªçš„çº¿ç¨‹æ‰ä¼šç»§ç»­å¹²æ´»ï¼Œçº¿ç¨‹è¿›å…¥å±éšœé€šè¿‡CyclicBarrierçš„await()æ–¹æ³•ã€‚å¯ä»¥ç”¨äºæ‰¹é‡å‘é€æ¶ˆæ¯é˜Ÿåˆ—ä¿¡æ¯ã€å¼‚æ­¥é™æµã€‚</p><p><strong>Semaphoreï¼š</strong></p><p>â€‹ä¿¡å·é‡ä¸»è¦ç”¨äºä¸¤ä¸ªç›®çš„ï¼Œä¸€ä¸ªæ˜¯ç”¨äºå¤šä¸ªå…±äº«èµ„æºçš„äº’æ–¥ä½œç”¨ï¼Œå¦ä¸€ä¸ªç”¨äºå¹¶å‘çº¿ç¨‹æ•°çš„æ§åˆ¶ã€‚SpringHystrixé™æµçš„æ€æƒ³</p><h4 id="3ã€happens-before"><a href="#3ã€happens-before" class="headerlink" title="3ã€happens-before"></a>3ã€happens-before</h4><p>â€‹ç”¨æ¥æè¿°å’Œå¯è§æ€§ç›¸å…³é—®é¢˜ï¼šå¦‚æœç¬¬ä¸€ä¸ªæ“ä½œ happens-before ç¬¬äºŒä¸ªæ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¯´ç¬¬ä¸€ä¸ªæ“ä½œå¯¹äºç¬¬äºŒä¸ªæ“ä½œæ˜¯å¯è§çš„</p><p>â€‹å¸¸è§çš„happens-beforeï¼švolatile ã€é”ã€çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸã€‚</p><h1 id="å››ã€MySQLç¯‡"><a href="#å››ã€MySQLç¯‡" class="headerlink" title="å››ã€MySQLç¯‡"></a>å››ã€MySQLç¯‡</h1><h3 id="WhyMysqlï¼Ÿ"><a href="#WhyMysqlï¼Ÿ" class="headerlink" title="WhyMysqlï¼Ÿ"></a>WhyMysqlï¼Ÿ</h3><p>NoSQLæ•°æ®åº“å››å¤§å®¶æ— </p><ul><li>åˆ—å­˜å‚¨ Hbase</li><li>K-Vå­˜å‚¨ Redis</li><li>å›¾åƒå­˜å‚¨ Neo4j</li><li>æ–‡æ¡£å­˜å‚¨ MongoDB</li></ul><p>äº‘å­˜å‚¨OSS</p><h4 id="æµ·é‡Aerospike"><a href="#æµ·é‡Aerospike" class="headerlink" title="æµ·é‡Aerospike"></a>æµ·é‡Aerospike</h4><p>â€‹Aerospikeï¼ˆç®€ç§°ASï¼‰æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ï¼Œå¯æ‰©å±•çš„é”®å€¼å­˜å‚¨çš„NoSQL<strong>æ•°æ®åº“</strong>ã€‚Tçº§åˆ«å¤§æ•°æ®é«˜å¹¶å‘çš„ç»“æ„åŒ–<strong>æ•°æ®å­˜å‚¨ï¼Œ</strong>é‡‡ç”¨æ··åˆæ¶æ„ï¼Œç´¢å¼•å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œè€Œæ•°æ®å¯å­˜å‚¨åœ¨æœºæ¢°ç¡¬ç›˜(HDD)æˆ–å›ºæ€ç¡¬ç›˜(SSD) ä¸Šï¼Œè¯»å†™æ“ä½œè¾¾å¾®å¦™çº§ï¼Œ99%çš„å“åº”å¯åœ¨1æ¯«ç§’å†…å®ç°ã€‚</p><table><thead><tr><th></th><th>Aerospike</th><th>Redis</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>Nosqlæ•°æ®åº“</td><td>ç¼“å­˜</td></tr><tr><td>çº¿ç¨‹æ•°</td><td>å¤šçº¿ç¨‹</td><td>å•çº¿ç¨‹</td></tr><tr><td>æ•°æ®åˆ†ç‰‡</td><td>è‡ªåŠ¨å¤„ç†ç›¸å½“äºåˆ†ç‰‡</td><td>æä¾›åˆ†ç‰‡ç®—æ³•ã€å¹³è¡¡å„åˆ†ç‰‡æ•°æ®</td></tr><tr><td>æ•°æ®æ‰©å®¹</td><td>åŠ¨æ€å¢åŠ æ•°æ®å·å¹³è¡¡æµé‡</td><td>éœ€åœæœº</td></tr><tr><td>æ•°æ®åŒæ­¥</td><td>è®¾ç½®å¤åˆ¶å› å­åå¯ä»¥é€æ˜çš„å®Œæˆæ•…éšœè½¬ç§»</td><td>æ‰‹åŠ¨æ•…éšœè½¬ç§»å’Œæ•°æ®åŒæ­¥</td></tr><tr><td>è½½ä½“</td><td>å†…å­˜å­˜å‚¨ç´¢å¼•+SSDå­˜å‚¨æ•°æ®</td><td>å†…å­˜</td></tr></tbody></table><p>â€‹Aerospikeä½œä¸ºä¸€ä¸ªå¤§å®¹é‡çš„NoSqlè§£å†³æ–¹æ¡ˆï¼Œé€‚åˆå¯¹<strong>å®¹é‡è¦æ±‚æ¯”è¾ƒå¤§ï¼ŒQPSç›¸å¯¹ä½</strong>ä¸€äº›çš„åœºæ™¯ï¼Œä¸»è¦ç”¨åœ¨å¹¿å‘Šè¡Œä¸šï¼Œ<strong>ä¸ªæ€§åŒ–æ¨èå‚å‘Š</strong>æ˜¯å»ºç«‹åœ¨äº†å’ŒæŒæ¡æ¶ˆè´¹è€…ç‹¬ç‰¹çš„åå¥½å’Œä¹ æ€§çš„åŸºç¡€ä¹‹ä¸Šï¼Œå¯¹æ¶ˆè´¹è€…çš„è´­ä¹°éœ€æ±‚åšå‡ºå‡†ç¡®çš„é¢„æµ‹æˆ–å¼•å¯¼ï¼Œåœ¨åˆé€‚çš„ä½ç½®ã€åˆé€‚çš„æ—¶é—´ï¼Œä»¥åˆé€‚çš„å½¢å¼å‘æ¶ˆè´¹è€…å‘ˆç°ä¸å…¶éœ€æ±‚é«˜åº¦å»åˆçš„å¹¿å‘Šï¼Œä»¥æ­¤æ¥ä¿ƒè¿›ç”¨æˆ·çš„æ¶ˆè´¹è¡Œä¸ºã€‚</p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gmam43b44bj30d90d4aa7.jpg" alt="image-20210103170039711" style="zoom:50%;" /><p>â€‹ï¼ˆETLæ•°æ®ä»“åº“æŠ€æœ¯ï¼‰æŠ½å–ï¼ˆextractï¼‰ã€è½¬æ¢ï¼ˆtransformï¼‰ã€åŠ è½½ï¼ˆloadï¼‰</p><ul><li><p>ç”¨æˆ·è¡Œä¸ºæ—¥å¿—æ”¶é›†ç³»ç»Ÿæ”¶é›†æ—¥å¿—ä¹‹åæ¨é€åˆ°ETLåšæ•°æ®çš„æ¸…æ´—å’Œè½¬æ¢</p></li><li><p>æŠŠETLè¿‡åçš„æ•°æ®å‘é€åˆ°æ¨èå¼•æ“è®¡ç®—æ¯ä¸ªæ¶ˆè´¹è€…çš„æ¨èç»“æœï¼Œå…¶ä¸­æ¨èé€»è¾‘åŒ…æ‹¬è§„åˆ™å’Œç®—æ³•ä¸¤éƒ¨åˆ†</p></li><li><p>æ”¶é›†ç”¨æˆ·æœ€è¿‘æµè§ˆã€æœ€é•¿åœç•™ç­‰ç‰¹å¾ï¼Œåˆ†æå•†å“ç›¸ä¼¼æ€§ã€ç”¨æˆ·ç›¸ä¼¼æ€§ã€ç›¸ä¼¼æ€§ç­‰ç®—æ³•ã€‚</p></li><li><p>æŠŠæ¨èå¼•æ“çš„ç»“æœå­˜å…¥Aerospikeé›†ç¾¤ä¸­ï¼Œå¹¶æä¾›ç»™å¹¿å‘ŠæŠ•æ”¾å¼•æ“å®æ—¶è·å–</p><p>åˆ†åˆ«é€šè¿‡HDFSå’ŒHBASEå¯¹æ—¥å¿—è¿›è¡Œç¦»çº¿å’Œå®æ—¶çš„åˆ†æï¼Œç„¶åæŠŠç”¨æˆ·ç”»åƒçš„æ ‡ç­¾(tag : ç¨‹åºçŒ¿ã€å®…ç”·â€¦)ç»“æœå­˜å…¥é«˜æ€§èƒ½çš„Nosqlæ•°æ®åº“Aerospikeä¸­ï¼ŒåŒæ—¶æŠŠæ•°æ®å¤‡ä»½åˆ°å¼‚åœ°æ•°æ®ä¸­å¿ƒã€‚å‰ç«¯å¹¿å‘ŠæŠ•æ”¾è¯·æ±‚é€šè¿‡å†³ç­–å¼•æ“ï¼ˆæŠ•æ”¾å¼•æ“ï¼‰å‘ç”¨æˆ·ç”»åƒæ•°æ®åº“ä¸­è¯»å–ç›¸åº”çš„ç”¨æˆ·ç”»åƒæ•°æ®ï¼Œç„¶åæ ¹æ®ç«ä»·ç®—æ³•å‡ºä»·è¿›è¡Œç«ä»·ã€‚ç«ä»·æˆåŠŸä¹‹åå°±å¯ä»¥å±•ç°å¹¿å‘Šäº†ã€‚è€Œåœ¨ç«ä»·æˆåŠŸä¹‹åï¼Œå…·ä½“ç»™ç”¨æˆ·å±•ç°ä»€ä¹ˆæ ·çš„å¹¿å‘Šï¼Œå°±æ˜¯æœ‰ä¸Šé¢è¯´çš„ä¸ªæ€§åŒ–æ¨èå¹¿å‘Šæ¥å®Œæˆçš„ã€‚</p></li></ul><table><thead><tr><th></th><th>Aerospike</th><th>Mysql</th></tr></thead><tbody><tr><td>åº“å</td><td>Namespace</td><td>Database</td></tr><tr><td>è¡¨å</td><td>Set</td><td>Table</td></tr><tr><td>è®°å½•</td><td>Bin</td><td>Column</td></tr><tr><td>å­—æ®µ</td><td>Record</td><td>Row</td></tr><tr><td>ç´¢å¼•</td><td>key ã€ pk ã€kv</td><td>pk</td></tr></tbody></table><h4 id="å›¾è°±Neo4j"><a href="#å›¾è°±Neo4j" class="headerlink" title="å›¾è°±Neo4j"></a>å›¾è°±Neo4j</h4><blockquote><p>Neo4jæ˜¯ä¸€ä¸ªå¼€æºåŸºäºjavaå¼€å‘çš„å›¾å½¢noSqlæ•°æ®åº“ï¼Œå®ƒå°†ç»“æ„åŒ–æ•°æ®å­˜å‚¨åœ¨å›¾ä¸­è€Œä¸æ˜¯è¡¨ä¸­ã€‚å®ƒæ˜¯ä¸€ä¸ªåµŒå…¥å¼çš„ã€åŸºäºç£ç›˜çš„ã€å…·å¤‡å®Œå…¨çš„äº‹åŠ¡ç‰¹æ€§çš„JavaæŒä¹…åŒ–å¼•æ“ã€‚ç¨‹åºæ•°æ®æ˜¯åœ¨ä¸€ä¸ªé¢å‘å¯¹è±¡çš„ã€çµæ´»çš„ç½‘ç»œç»“æ„ä¸‹ï¼Œè€Œä¸æ˜¯ä¸¥æ ¼çš„è¡¨ä¸­ï¼Œä½†å…·å¤‡å®Œå…¨çš„äº‹åŠ¡ç‰¹æ€§ã€ä¼ä¸šçº§çš„æ•°æ®åº“çš„æ‰€æœ‰å¥½å¤„ã€‚</p></blockquote><p>ä¸€ç§åŸºäºå›¾çš„æ•°æ®ç»“æ„ï¼Œç”±èŠ‚ç‚¹(Node)å’Œè¾¹(Edge)ç»„æˆã€‚å…¶ä¸­èŠ‚ç‚¹å³å®ä½“ï¼Œç”±ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„IDæ ‡ç¤ºï¼Œè¾¹å°±æ˜¯å…³ç³»ç”¨äºè¿æ¥ä¸¤ä¸ªèŠ‚ç‚¹ã€‚é€šä¿—åœ°è®²ï¼ŒçŸ¥è¯†å›¾è°±å°±æ˜¯æŠŠæ‰€æœ‰ä¸åŒç§ç±»çš„ä¿¡æ¯ï¼Œè¿æ¥åœ¨ä¸€èµ·è€Œå¾—åˆ°çš„ä¸€ä¸ªå…³ç³»ç½‘ç»œã€‚çŸ¥è¯†å›¾è°±æä¾›äº†ä»â€œå…³ç³»â€çš„è§’åº¦å»åˆ†æé—®é¢˜çš„èƒ½åŠ›ã€‚</p><p>äº’è”ç½‘ã€å¤§æ•°æ®çš„èƒŒæ™¯ä¸‹ï¼Œè°·æ­Œã€ç™¾åº¦ã€æœç‹—ç­‰æœç´¢å¼•æ“çº·çº·åŸºäºè¯¥èƒŒæ™¯ï¼Œåˆ›å»ºè‡ªå·±çš„çŸ¥è¯†å›¾<strong>Knowledge Graphï¼ˆè°·æ­Œ</strong>ï¼‰ã€<strong>çŸ¥å¿ƒï¼ˆç™¾åº¦ï¼‰</strong>å’Œ<strong>çŸ¥ç«‹æ–¹ï¼ˆæœç‹—ï¼‰</strong>ï¼Œä¸»è¦ç”¨äºæ”¹è¿›æœç´¢è´¨é‡ã€‚</p><p>è‡ªå·±é¡¹ç›®ä¸»è¦ç”¨ä½œå¥½å‹æ¨èï¼Œå›¾æ•°æ®åº“(Graph database)æŒ‡çš„æ˜¯ä»¥å›¾æ•°æ®ç»“æ„çš„å½¢å¼æ¥å­˜å‚¨å’ŒæŸ¥è¯¢æ•°æ®çš„æ•°æ®åº“ã€‚å…³ç³»å›¾è°±ä¸­ï¼Œå…³ç³»çš„ç»„ç»‡å½¢å¼é‡‡ç”¨çš„å°±æ˜¯å›¾ç»“æ„ï¼Œæ‰€ä»¥éå¸¸é€‚åˆç”¨å›¾åº“è¿›è¡Œå­˜å‚¨ã€‚</p><ul><li><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gmaq0j9otdj30pz0en0vm.jpg" alt="image-20210103191540372"></p><p>ä¼˜åŠ¿æ€»ç»“:</p></li><li><p>æ€§èƒ½ä¸Šï¼Œä½¿ç”¨cqlæŸ¥è¯¢ï¼Œå¯¹é•¿ç¨‹å…³ç³»çš„æŸ¥è¯¢é€Ÿåº¦å¿«</p></li><li><p>æ“…äºå‘ç°éšè—çš„å…³ç³»ï¼Œä¾‹å¦‚é€šè¿‡åˆ¤æ–­å›¾ä¸Šä¸¤ç‚¹ä¹‹é—´æœ‰æ²¡æœ‰èµ°çš„é€šçš„è·¯å¾„ï¼Œå°±å¯ä»¥å‘ç°äº‹ç‰©é—´çš„å…³è”</p></li></ul><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gmaqc75y6bj30wc0d60u4.jpg" alt="image-20210103192653004"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŸ¥è¯¢ä¸‰å±‚çº§å…³ç³»èŠ‚ç‚¹å¦‚ä¸‹ï¼šwithå¯ä»¥å°†å‰é¢æŸ¥è¯¢ç»“æœä½œä¸ºåé¢æŸ¥è¯¢æ¡ä»¶</span></span><br><span class="line">match (na:Person)-[re]-(nb:Person) where na.name=<span class="string">&quot;æ—å©‰å„¿&quot;</span> WITH na,re,nb <span class="title function_">match</span> <span class="params">(nb:Person)</span>- [re2:Friends]-&gt;(nc:Person) <span class="keyword">return</span> na,re,nb,re2,nc</span><br><span class="line"><span class="comment">// ç›´æ¥æ‹¼æ¥å…³ç³»èŠ‚ç‚¹æŸ¥è¯¢</span></span><br><span class="line">match data=(na:Person&#123;name:<span class="string">&quot;èŒƒé—²&quot;</span>&#125;)-[re]-&gt;(nb:Person)-[re2]-&gt;(nc:Person) <span class="keyword">return</span> data</span><br><span class="line"><span class="comment">// ä½¿ç”¨æ·±åº¦è¿ç®—ç¬¦</span></span><br><span class="line">æ˜¾ç„¶ä½¿ç”¨ä»¥ä¸Šæ–¹å¼æ¯”è¾ƒç¹ç,å¯å˜æ•°é‡çš„å…³ç³»-&gt;èŠ‚ç‚¹å¯ä»¥ä½¿ç”¨-[:TYPE*minHops..maxHops]-ã€‚</span><br><span class="line">match data=(na:Person&#123;name:<span class="string">&quot;èŒƒé—²&quot;</span>&#125;)-[*<span class="number">1.</span><span class="number">.2</span>]-(nb:Person) <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure><h4 id="æ–‡æ¡£MongoDB"><a href="#æ–‡æ¡£MongoDB" class="headerlink" title="æ–‡æ¡£MongoDB"></a><strong>æ–‡æ¡£MongoDB</strong></h4><blockquote><p>MongoDB æ˜¯ä¸€ä¸ªåŸºäºåˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨çš„æ•°æ®åº“ï¼Œæ˜¯éå…³ç³»æ•°æ®åº“ä¸­åŠŸèƒ½æœ€ä¸°å¯Œã€æœ€åƒå…³ç³»æ•°æ®åº“çš„ã€‚åœ¨é«˜è´Ÿè½½çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡æ·»åŠ æ›´å¤šçš„èŠ‚ç‚¹ï¼Œå¯ä»¥ä¿è¯æœåŠ¡å™¨æ€§èƒ½ã€‚ç”± C++ ç¼–å†™ï¼Œå¯ä»¥ä¸º WEB åº”ç”¨æä¾›å¯æ‰©å±•ã€é«˜æ€§èƒ½ã€æ˜“éƒ¨ç½²çš„æ•°æ®å­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚</p></blockquote><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gmaqyp75qsj312q0i8q5f.jpg" alt="image-20210103194830654" style="zoom:80%;" /><p><strong>ä»€ä¹ˆæ˜¯BSON</strong></p><blockquote><p>{key:value,key2:value2}å’ŒJsonç±»ä¼¼ï¼Œæ˜¯ä¸€ç§äºŒè¿›åˆ¶å½¢å¼çš„å­˜å‚¨æ ¼å¼ï¼Œæ”¯æŒå†…åµŒçš„æ–‡æ¡£å¯¹è±¡å’Œæ•°ç»„å¯¹è±¡ï¼Œä½†æ˜¯BSONæœ‰JSONæ²¡æœ‰çš„ä¸€äº›æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚ valueåŒ…æ‹¬å­—ç¬¦ä¸²,double,Array,DateBSONå¯ä»¥åšä¸ºç½‘ç»œæ•°æ®äº¤æ¢çš„ä¸€ç§å­˜å‚¨å½¢å¼,å®ƒçš„ä¼˜ç‚¹æ˜¯çµæ´»æ€§é«˜ï¼Œä½†å®ƒçš„ç¼ºç‚¹æ˜¯ç©ºé—´åˆ©ç”¨ç‡ä¸æ˜¯å¾ˆç†æƒ³ã€‚</p></blockquote><p>BSONæœ‰ä¸‰ä¸ªç‰¹ç‚¹ï¼šè½»é‡æ€§ã€å¯éå†æ€§ã€é«˜æ•ˆæ€§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/* æŸ¥è¯¢ find() æ–¹æ³•å¯ä»¥ä¼ å…¥å¤šä¸ªé”®(key)ï¼Œæ¯ä¸ªé”®(key)ä»¥é€—å·éš”å¼€*/</span><br><span class="line">db.collection.find(&#123;key1:value1, key2:value2&#125;).pretty()</span><br><span class="line">/* æ›´æ–° $set ï¼šè®¾ç½®å­—æ®µå€¼ $unset :åˆ é™¤æŒ‡å®šå­—æ®µ $incï¼šå¯¹ä¿®æ”¹çš„å€¼è¿›è¡Œè‡ªå¢*/</span><br><span class="line">db.collection.update(&#123;where&#125;,&#123;$set:&#123;å­—æ®µå:å€¼&#125;&#125;,&#123;multi:true&#125;)</span><br><span class="line">/* åˆ é™¤ justOne :å¦‚æœè®¾ä¸ºtrueï¼Œåªåˆ é™¤ä¸€ä¸ªæ–‡æ¡£ï¼Œé»˜è®¤falseï¼Œåˆ é™¤æ‰€æœ‰åŒ¹é…æ¡ä»¶çš„æ–‡æ¡£*/</span><br><span class="line">db.collection.remove(&#123;where&#125;, &#123;justOne: &lt;boolean&gt;, writeConcern: &lt;å›æ‰§&gt; &#125; )</span><br></pre></td></tr></table></figure><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li><p><strong>æ–‡æ¡£ç»“æ„çš„å­˜å‚¨æ–¹å¼ï¼Œèƒ½å¤Ÿæ›´ä¾¿æ·çš„è·å–æ•°æ®ã€‚</strong></p><p>å¯¹äºä¸€ä¸ªå±‚çº§å¼çš„æ•°æ®ç»“æ„æ¥è¯´ï¼Œä½¿ç”¨æ‰å¹³å¼çš„ï¼Œè¡¨çŠ¶çš„ç»“æ„æ¥æŸ¥è¯¢ä¿å­˜æ•°æ®éå¸¸çš„å›°éš¾ã€‚</p></li><li><p><strong>å†…ç½®GridFSï¼Œæ”¯æŒå¤§å®¹é‡çš„å­˜å‚¨ã€‚</strong></p><p>GridFSæ˜¯ä¸€ä¸ªå‡ºè‰²çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œæ”¯æŒæµ·é‡çš„æ•°æ®å­˜å‚¨ï¼Œæ»¡è¶³å¯¹å¤§æ•°æ®é›†çš„å¿«é€ŸèŒƒå›´æŸ¥è¯¢ã€‚</p></li><li><p><strong>æ€§èƒ½ä¼˜è¶Š</strong></p><p>åƒä¸‡çº§åˆ«çš„æ–‡æ¡£å¯¹è±¡ï¼Œè¿‘10Gçš„æ•°æ®ï¼Œå¯¹æœ‰ç´¢å¼•çš„IDçš„æŸ¥è¯¢ ä¸ä¼šæ¯”mysqlæ…¢ï¼Œè€Œå¯¹éç´¢å¼•å­—æ®µçš„æŸ¥è¯¢ï¼Œåˆ™æ˜¯å…¨é¢èƒœå‡ºã€‚ mysqlå®é™…æ— æ³•èƒœä»»å¤§æ•°æ®é‡ä¸‹ä»»æ„å­—æ®µçš„æŸ¥è¯¢ï¼Œè€Œmongodbçš„æŸ¥è¯¢æ€§èƒ½å®åœ¨ç‰›é€¼ã€‚å†™å…¥æ€§èƒ½åŒæ ·å¾ˆä»¤äººæ»¡æ„ï¼ŒåŒæ ·å†™å…¥ç™¾ä¸‡çº§åˆ«çš„æ•°æ®ï¼ŒmongodbåŸºæœ¬10åˆ†é’Ÿä»¥ä¸‹å¯ä»¥è§£å†³ã€‚</p></li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>ä¸æ”¯æŒäº‹åŠ¡</li><li>ç£ç›˜å ç”¨ç©ºé—´å¤§</li></ul><p>MySQL 8.0 ç‰ˆæœ¬</p><p><strong>1. æ€§èƒ½</strong>ï¼šMySQL 8.0 çš„é€Ÿåº¦è¦æ¯” MySQL 5.7 å¿« 2 å€ã€‚</p><p><strong>2. NoSQL</strong>ï¼šMySQL ä» 5.7 ç‰ˆæœ¬å¼€å§‹æä¾› NoSQL å­˜å‚¨åŠŸèƒ½ï¼Œåœ¨ 8.0 ç‰ˆæœ¬ä¸­nosqlå¾—åˆ°äº†æ›´å¤§çš„æ”¹è¿›ã€‚</p><p><strong>3. çª—å£å‡½æ•°</strong>ï¼šå®ç°è‹¥å¹²æ–°çš„æŸ¥è¯¢æ–¹å¼ã€‚çª—å£å‡½æ•°ä¸ SUM()ã€COUNT() è¿™ç§é›†åˆå‡½æ•°ç±»ä¼¼ï¼Œä½†å®ƒä¸ä¼šå°†å¤šè¡ŒæŸ¥è¯¢ç»“æœåˆå¹¶ä¸ºä¸€è¡Œï¼Œè€Œæ˜¯å°†ç»“æœæ”¾å›å¤šè¡Œå½“ä¸­ï¼Œå³çª—å£å‡½æ•°ä¸éœ€è¦ GROUP BYã€‚</p><p><strong>4. éšè—ç´¢å¼•</strong>ï¼šåœ¨ MySQL 8.0 ä¸­ï¼Œç´¢å¼•å¯ä»¥è¢«â€œéšè—â€å’Œâ€œæ˜¾ç¤ºâ€ã€‚å½“å¯¹ç´¢å¼•è¿›è¡Œéšè—æ—¶ï¼Œå®ƒä¸ä¼šè¢«æŸ¥è¯¢ä¼˜åŒ–å™¨æ‰€ä½¿ç”¨ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªç‰¹æ€§ç”¨äºæ€§èƒ½è°ƒè¯•ï¼Œä¾‹å¦‚æˆ‘ä»¬å…ˆéšè—ä¸€ä¸ªç´¢å¼•ï¼Œç„¶åè§‚å¯Ÿå…¶å¯¹æ•°æ®åº“çš„å½±å“ã€‚å¦‚æœæ•°æ®åº“æ€§èƒ½æœ‰æ‰€ä¸‹é™ï¼Œè¯´æ˜è¿™ä¸ªç´¢å¼•æ˜¯æœ‰ç”¨çš„ï¼Œç„¶åå°†å…¶â€œæ¢å¤æ˜¾ç¤ºâ€å³å¯ï¼›å¦‚æœæ•°æ®åº“æ€§èƒ½çœ‹ä¸å‡ºå˜åŒ–ï¼Œè¯´æ˜è¿™ä¸ªç´¢å¼•æ˜¯å¤šä½™çš„ï¼Œå¯ä»¥è€ƒè™‘åˆ æ‰ã€‚</p><h4 id="äº‘å­˜å‚¨"><a href="#äº‘å­˜å‚¨" class="headerlink" title="äº‘å­˜å‚¨"></a><strong>äº‘å­˜å‚¨</strong></h4><table><thead><tr><th></th><th>OSS</th><th>è‡ªå»º</th></tr></thead><tbody><tr><td>å¯é æ€§</td><td>å¯ç”¨æ€§ä¸ä½äº99.995%<br />æ•°æ®è®¾è®¡æŒä¹…æ€§ä¸ä½äº99.9999999999%ï¼ˆ12ä¸ª9ï¼‰</td><td>å—é™äºç¡¬ä»¶å¯é æ€§ï¼Œæ˜“å‡ºé—®é¢˜ï¼Œä¸€æ—¦å‡ºç°ç£ç›˜åé“ï¼Œå®¹æ˜“å‡ºç°ä¸å¯é€†è½¬çš„æ•°æ®ä¸¢å¤±ã€‚äººå·¥æ•°æ®æ¢å¤å›°éš¾ã€è€—æ—¶ã€è€—åŠ›ã€‚</td></tr><tr><td>å®‰å…¨</td><td>æœåŠ¡ç«¯åŠ å¯†ã€å®¢æˆ·ç«¯åŠ å¯†ã€é˜²ç›—é“¾ã€IPé»‘ç™½åå•ç­‰ã€‚å¤šç”¨æˆ·èµ„æºéš”ç¦»æœºåˆ¶ï¼Œæ”¯æŒå¼‚åœ°å®¹ç¾æœºåˆ¶ã€‚</td><td>éœ€è¦å¦å¤–è´­ä¹°æ¸…æ´—å’Œé»‘æ´è®¾å¤‡ã€‚éœ€è¦å•ç‹¬å®ç°å®‰å…¨æœºåˆ¶ã€‚</td></tr><tr><td>æˆæœ¬</td><td>å¤šçº¿BGPéª¨å¹²ç½‘ç»œï¼Œæ— å¸¦å®½é™åˆ¶ï¼Œä¸Šè¡Œæµé‡å…è´¹ã€‚æ— éœ€è¿ç»´äººå‘˜ä¸æ‰˜ç®¡è´¹ç”¨ï¼Œ0æˆæœ¬è¿ç»´ã€‚</td><td>å•çº¿æˆ–åŒçº¿æ¥å…¥é€Ÿåº¦æ…¢ï¼Œæœ‰å¸¦å®½é™åˆ¶ï¼Œå³°å€¼æ—¶æœŸéœ€äººå·¥æ‰©å®¹ã€‚éœ€ä¸“äººè¿ç»´ï¼Œæˆæœ¬é«˜ã€‚</td></tr></tbody></table><p><strong>ä½¿ç”¨æ­¥éª¤</strong></p><p>â€‹1ã€å¼€é€šæœåŠ¡</p><p>â€‹2ã€åˆ›å»ºå­˜å‚¨ç©ºé—´</p><p>â€‹3ã€ä¸Šä¼ æ–‡ä»¶ã€ä¸‹è½½æ–‡ä»¶ã€åˆ é™¤æ–‡ä»¶</p><p>â€‹4ã€åŸŸåç»‘å®šã€æ—¥å¿—è®°å½•</p><p>â€‹5ã€æ ¹æ®å¼€æ”¾æ¥å£è¿›è¡Œé‰´æƒè®¿é—®</p><p><strong>åŠŸèƒ½</strong></p><p>â€‹å›¾ç‰‡ç¼–è¾‘ï¼ˆè£å‰ªã€æ¨¡ç³Šã€æ°´å°ï¼‰</p><p>â€‹è§†é¢‘æˆªå›¾</p><p>â€‹éŸ³é¢‘è½¬ç ã€è§†é¢‘ä¿®å¤</p><p><strong>CDNåŠ é€Ÿ</strong></p><p>â€‹å¯¹è±¡å­˜å‚¨OSSä¸é˜¿é‡Œäº‘CDNæœåŠ¡ç»“åˆï¼Œå¯ä¼˜åŒ–é™æ€çƒ­ç‚¹æ–‡ä»¶ä¸‹è½½åŠ é€Ÿçš„åœºæ™¯ï¼ˆå³åŒä¸€åœ°åŒºå¤§é‡ç”¨æˆ·åŒæ—¶ä¸‹è½½åŒä¸€ä¸ªé™æ€æ–‡ä»¶çš„åœºæ™¯ï¼‰ã€‚å¯ä»¥å°†OSSçš„å­˜å‚¨ç©ºé—´ï¼ˆBucketï¼‰ä½œä¸ºæºç«™ï¼Œåˆ©ç”¨é˜¿é‡Œäº‘CDNå°†æºå†…å®¹å‘å¸ƒåˆ°è¾¹ç¼˜èŠ‚ç‚¹ã€‚å½“å¤§é‡ç»ˆç«¯ç”¨æˆ·é‡å¤è®¿é—®åŒä¸€æ–‡ä»¶æ—¶ï¼Œå¯ä»¥ç›´æ¥ä»è¾¹ç¼˜èŠ‚ç‚¹è·å–å·²ç¼“å­˜çš„æ•°æ®ï¼Œæé«˜è®¿é—®çš„å“åº”é€Ÿåº¦</p><h4 id="FastDFS"><a href="#FastDFS" class="headerlink" title="FastDFS"></a><strong>FastDFS</strong></h4><blockquote><p><strong>å¼€æºçš„è½»é‡çº§åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ</strong>ã€‚å®ƒå¯¹æ–‡ä»¶è¿›è¡Œç®¡ç†ï¼ŒåŠŸèƒ½åŒ…æ‹¬ï¼š<strong>æ–‡ä»¶å­˜å‚¨ã€æ–‡ä»¶åŒæ­¥ã€æ–‡ä»¶è®¿é—®</strong>ï¼ˆæ–‡ä»¶ä¸Šä¼ ã€æ–‡ä»¶ä¸‹è½½ï¼‰ç­‰ï¼Œè§£å†³äº†<strong>å¤§å®¹é‡å­˜å‚¨å’Œè´Ÿè½½å‡è¡¡</strong>çš„é—®é¢˜ã€‚ä½¿ç”¨FastDFSå¾ˆå®¹æ˜“æ­å»ºä¸€å¥—é«˜æ€§èƒ½çš„æ–‡ä»¶æœåŠ¡å™¨é›†ç¾¤æä¾›æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ç­‰æœåŠ¡ã€‚å¦‚<strong>ç›¸å†Œç½‘ç«™ã€è§†é¢‘ç½‘ç«™</strong>ç­‰</p></blockquote><p><strong>æ‰©å±•èƒ½åŠ›:</strong> æ”¯æŒæ°´å¹³æ‰©å±•ï¼Œå¯ä»¥åŠ¨æ€æ‰©å®¹ï¼›</p><p><strong>é«˜å¯ç”¨æ€§:</strong> ä¸€æ˜¯æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„å¯ç”¨æ€§ï¼ŒäºŒæ˜¯æ•°æ®çš„å®Œæ•´å’Œä¸€è‡´æ€§ï¼›</p><p><strong>å¼¹æ€§å­˜å‚¨:</strong> å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€è¦çµæ´»åœ°å¢åˆ å­˜å‚¨æ± ä¸­çš„èµ„æºï¼Œè€Œä¸éœ€è¦ä¸­æ–­ç³»ç»Ÿè¿è¡Œã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gmfhjkvo59j30zu0b4dib.jpg" alt="image-20210107221022658"></p><p>ç‰¹æ€§</p><ul><li>å’Œæµè¡Œçš„web serveræ— ç¼è¡”æ¥ï¼ŒFastDFSå·²æä¾›apacheå’Œnginxæ‰©å±•æ¨¡å—</li><li>æ–‡ä»¶IDç”±FastDFSç”Ÿæˆï¼Œä½œä¸ºæ–‡ä»¶è®¿é—®å‡­è¯ï¼ŒFastDFSä¸éœ€è¦ä¼ ç»Ÿçš„name server</li><li>åˆ†ç»„å­˜å‚¨ï¼Œçµæ´»ç®€æ´ã€å¯¹ç­‰ç»“æ„ï¼Œä¸å­˜åœ¨å•ç‚¹</li><li>æ–‡ä»¶ä¸åˆ†å—å­˜å‚¨ï¼Œä¸Šä¼ çš„æ–‡ä»¶å’ŒOSæ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶ä¸€ä¸€å¯¹åº”</li><li>ä¸­ã€å°æ–‡ä»¶å‡å¯ä»¥å¾ˆå¥½æ”¯æŒï¼Œæ”¯æŒæµ·é‡å°æ–‡ä»¶å­˜å‚¨</li><li>æ”¯æŒç›¸åŒå†…å®¹çš„æ–‡ä»¶åªä¿å­˜ä¸€ä»½ï¼ŒèŠ‚çº¦ç£ç›˜ç©ºé—´</li><li>æ”¯æŒå¤šå—ç£ç›˜ï¼Œæ”¯æŒå•ç›˜æ•°æ®æ¢å¤</li><li>æ”¯æŒåœ¨çº¿æ‰©å®¹ æ”¯æŒä¸»ä»æ–‡ä»¶</li><li>ä¸‹è½½æ–‡ä»¶æ”¯æŒå¤šçº¿ç¨‹æ–¹å¼ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ </li></ul><p><strong>ç»„æˆ</strong></p><ul><li><p><strong>å®¢æˆ·ç«¯ï¼ˆclientï¼‰</strong></p><p>é€šè¿‡ä¸“æœ‰æ¥å£ï¼Œä½¿ç”¨TCP&#x2F;IPåè®®ä¸è·Ÿè¸ªå™¨æœåŠ¡å™¨æˆ–å­˜å‚¨èŠ‚ç‚¹è¿›è¡Œæ•°æ®äº¤äº’ã€‚</p></li><li><p><strong>è·Ÿè¸ªå™¨ï¼ˆtrackerï¼‰</strong> </p><p>Trackerserverä½œç”¨æ˜¯è´Ÿè½½å‡è¡¡å’Œè°ƒåº¦ï¼Œé€šè¿‡Tracker serveråœ¨æ–‡ä»¶ä¸Šä¼ æ—¶å¯ä»¥æ ¹æ®ç­–ç•¥æ‰¾åˆ°æ–‡ä»¶ä¸Šä¼ çš„åœ°å€ã€‚Trackeråœ¨è®¿é—®ä¸Šèµ·è´Ÿè½½å‡è¡¡çš„ä½œç”¨ã€‚</p></li><li><p><strong>å­˜å‚¨èŠ‚ç‚¹ï¼ˆstorageï¼‰</strong></p><p>Storageserverä½œç”¨æ˜¯æ–‡ä»¶å­˜å‚¨ï¼Œå®¢æˆ·ç«¯ä¸Šä¼ çš„æ–‡ä»¶æœ€ç»ˆå­˜å‚¨åœ¨StorageæœåŠ¡å™¨ä¸Šï¼ŒStorage server<strong>æ²¡æœ‰å®ç°è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿè€Œæ˜¯åˆ©ç”¨æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿæ¥ç®¡ç†æ–‡ä»¶</strong>ã€‚å­˜å‚¨èŠ‚ç‚¹ä¸­çš„æœåŠ¡å™¨å‡å¯ä»¥<strong>éšæ—¶å¢åŠ æˆ–ä¸‹çº¿è€Œä¸ä¼šå½±å“çº¿ä¸ŠæœåŠ¡</strong>ã€‚</p></li></ul><p><strong>ä¸Šä¼ </strong></p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gmfhvk0wwzj30ue0h4dlw.jpg" alt="image-20210107222155291" style="zoom:50%;" /><p><strong>ä¸‹è½½</strong></p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gmfhww8zmfj30uw0g6n37.jpg" alt="image-20210107222312338" style="zoom:50%;" /><p><strong>æ–­ç‚¹ç»­ä¼ </strong></p><p>â€‹ç»­ä¼ æ¶‰åŠåˆ°çš„æ–‡ä»¶å¤§å°MD5ä¸ä¼šæ”¹å˜ã€‚ç»­ä¼ æµç¨‹ä¸æ–‡ä»¶ä¸Šä¼ ç±»ä¼¼ï¼Œå…ˆ<strong>å®šä½åˆ°æºstorage</strong>ï¼Œå®Œæˆå®Œæ•´æˆ–éƒ¨åˆ†ä¸Šä¼ ï¼Œå†<strong>é€šè¿‡binlogè¿›è¡ŒåŒgroupå†…serveræ–‡ä»¶åŒæ­¥</strong>ã€‚</p><p><strong>é…ç½®ä¼˜åŒ–</strong></p><p>é…ç½®æ–‡ä»¶ï¼štracker.conf å’Œ storage.conf </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// FastDFSé‡‡ç”¨å†…å­˜æ± çš„åšæ³•ã€‚ </span></span><br><span class="line"><span class="comment">// v5.04å¯¹é¢„åˆ†é…é‡‡ç”¨å¢é‡æ–¹å¼ï¼Œtrackerä¸€æ¬¡é¢„åˆ†é… 1024ä¸ªï¼Œstorageä¸€æ¬¡é¢„åˆ†é…256ä¸ªã€‚ </span></span><br><span class="line">max_connections = <span class="number">10240</span></span><br><span class="line"><span class="comment">// æ ¹æ®å®é™…éœ€è¦å°† max_connections è®¾ç½®ä¸ºä¸€ä¸ªè¾ƒå¤§çš„æ•°å€¼ï¼Œæ¯”å¦‚ 10240 ç”šè‡³æ›´å¤§ã€‚</span></span><br><span class="line"><span class="comment">// åŒæ—¶éœ€è¦å°†ä¸€ä¸ªè¿›ç¨‹å…è®¸æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°è°ƒå¤§</span></span><br><span class="line">vi /etc/security/limits.conf é‡å¯ç³»ç»Ÿç”Ÿæ•ˆ </span><br><span class="line">* soft nofile <span class="number">65535</span> </span><br><span class="line">* hard nofile <span class="number">65535</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">work_threads = <span class="number">4</span> </span><br><span class="line"><span class="comment">// è¯´æ˜ï¼šä¸ºäº†é¿å…CPUä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ï¼Œä»¥åŠä¸å¿…è¦çš„èµ„æºæ¶ˆè€—ï¼Œä¸å»ºè®®å°†æœ¬å‚æ•°è®¾ç½®å¾—è¿‡å¤§ã€‚</span></span><br><span class="line"><span class="comment">// å…¬å¼ä¸ºï¼š work_threads + (reader_threads + writer_threads) = CPUæ•°</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¹äºå•ç›˜æŒ‚è½½æ–¹å¼ï¼Œç£ç›˜è¯»å†™çº¿ç¨‹åˆ† åˆ«è®¾ç½®ä¸º 1å³å¯ </span></span><br><span class="line"><span class="comment">// å¦‚æœç£ç›˜åšäº†RAIDï¼Œé‚£ä¹ˆéœ€è¦é…Œæƒ…åŠ å¤§è¯»å†™çº¿ç¨‹æ•°ï¼Œè¿™æ ·æ‰èƒ½æœ€å¤§ç¨‹åº¦åœ°å‘æŒ¥ç£ç›˜æ€§èƒ½</span></span><br><span class="line">disk_rw_separatedï¼šç£ç›˜è¯»å†™æ˜¯å¦åˆ†ç¦» </span><br><span class="line">disk_reader_threadsï¼šå•ä¸ªç£ç›˜è¯»çº¿ç¨‹æ•° </span><br><span class="line">disk_writer_threadsï¼šå•ä¸ªç£ç›˜å†™çº¿ç¨‹æ•° </span><br></pre></td></tr></table></figure><p><strong>é¿å…é‡å¤</strong></p><p>â€‹å¦‚ä½•é¿å…æ–‡ä»¶é‡å¤ä¸Šä¼  è§£å†³æ–¹æ¡ˆ ä¸Šä¼ æˆåŠŸåè®¡ç®—æ–‡ä»¶å¯¹åº”çš„MD5ç„¶å<strong>å­˜å…¥MySQL</strong>,æ·»åŠ æ–‡ä»¶æ—¶æŠŠ<strong>æ–‡ä»¶MD5å’Œä¹‹å‰å­˜å…¥MYSQLä¸­çš„å­˜å‚¨çš„ä¿¡æ¯å¯¹æ¯”</strong> ã€‚DigestUtils.md5DigestAsHex(bytes)ã€‚</p><h3 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h3><h4 id="1ã€äº‹åŠ¡4å¤§ç‰¹æ€§"><a href="#1ã€äº‹åŠ¡4å¤§ç‰¹æ€§" class="headerlink" title="1ã€äº‹åŠ¡4å¤§ç‰¹æ€§"></a><strong>1ã€äº‹åŠ¡4å¤§ç‰¹æ€§</strong></h4><p><strong>äº‹åŠ¡4å¤§ç‰¹æ€§ï¼š</strong>åŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§</p><p>â€‹<strong>åŸâ¼¦æ€§ï¼š</strong> äº‹åŠ¡æ˜¯æœ€â¼©çš„æ‰§â¾å•ä½ï¼Œä¸å…è®¸åˆ†å‰²ã€‚äº‹åŠ¡çš„åŸâ¼¦æ€§ç¡®ä¿åŠ¨ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨ä¸æ‰§è¡Œ</p><p>â€‹<strong>ä¸€è‡´æ€§ï¼š</strong> æ‰§â¾äº‹åŠ¡å‰åï¼Œæ•°æ®ä¿æŒâ¼€è‡´ï¼Œå¤šä¸ªäº‹åŠ¡å¯¹åŒâ¼€ä¸ªæ•°æ®è¯»å–çš„ç»“æœæ˜¯ç›¸åŒçš„ï¼›</p><p>â€‹<strong>éš”ç¦»æ€§ï¼š</strong> å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œâ¼€ä¸ªâ½¤æˆ·çš„äº‹åŠ¡ä¸è¢«å…¶ä»–äº‹åŠ¡æ‰€â¼²æ‰°ï¼Œå„å¹¶å‘äº‹åŠ¡ä¹‹é—´æ•°æ®åº“æ˜¯ç‹¬â½´çš„ï¼›</p><p>â€‹<strong>æŒä¹…æ€§ï¼š</strong> â¼€ä¸ªäº‹åŠ¡è¢«æäº¤ä¹‹åã€‚å®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜æ˜¯æŒä¹…çš„ï¼Œå³ä½¿æ•°æ®åº“å‘â½£æ•…éšœä¹Ÿä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚</p><p><strong>å®ç°ä¿è¯ï¼š</strong></p><p>â€‹MySQLçš„å­˜å‚¨å¼•æ“InnoDBä½¿ç”¨é‡åšæ—¥å¿—ä¿è¯ä¸€è‡´æ€§ä¸æŒä¹…æ€§ï¼Œå›æ»šæ—¥å¿—ä¿è¯åŸå­æ€§ï¼Œä½¿ç”¨å„ç§é”æ¥ä¿è¯éš”ç¦»æ€§ã€‚</p><h4 id="2ã€äº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#2ã€äº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="2ã€äº‹åŠ¡éš”ç¦»çº§åˆ«"></a><strong>2ã€äº‹åŠ¡éš”ç¦»çº§åˆ«</strong></h4><p><strong>è¯»æœªæäº¤ï¼š</strong>æœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œå…è®¸è¯»å–å°šæœªæäº¤çš„æ•°æ®å˜æ›´ï¼Œå¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ã€‚</p><p><strong>è¯»å·²æäº¤ï¼š</strong>å…è®¸è¯»å–å¹¶å‘äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œå¯ä»¥é˜»â½Œè„è¯»ï¼Œä½†æ˜¯å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ä»æœ‰å¯èƒ½å‘â½£ã€‚</p><p><strong>å¯é‡å¤è¯»ï¼š</strong>åŒâ¼€å­—æ®µçš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯â¼€è‡´çš„ï¼Œé™¤â¾®æ•°æ®æ˜¯è¢«æœ¬èº«äº‹åŠ¡â¾ƒâ¼°æ‰€ä¿®æ”¹ï¼Œå¯ä»¥é˜»â½Œè„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä¼šæœ‰å¹»è¯»ã€‚</p><p><strong>ä¸²è¡ŒåŒ–ï¼š</strong>æœ€â¾¼çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨æœä»ACIDçš„éš”ç¦»çº§åˆ«ã€‚æ‰€æœ‰çš„äº‹åŠ¡ä¾æ¬¡é€ä¸ªæ‰§â¾ï¼Œè¿™æ ·äº‹åŠ¡ä¹‹é—´å°±å®Œå…¨ä¸å¯èƒ½äº§â½£â¼²æ‰°ã€‚</p><table><thead><tr><th>éš”ç¦»çº§åˆ«</th><th>å¹¶å‘é—®é¢˜</th></tr></thead><tbody><tr><td>è¯»æœªæäº¤</td><td>å¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»</td></tr><tr><td>è¯»å·²æäº¤</td><td>å¯èƒ½ä¼šå¯¼è‡´å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»</td></tr><tr><td>å¯é‡å¤è¯»</td><td>å¯èƒ½ä¼šå¯¼è‡´å¹»è¯»</td></tr><tr><td>å¯ä¸²è¡ŒåŒ–</td><td>ä¸ä¼šäº§â½£â¼²æ‰°</td></tr></tbody></table><p>ms</p><h4 id="3ã€é»˜è®¤éš”ç¦»çº§åˆ«-RR"><a href="#3ã€é»˜è®¤éš”ç¦»çº§åˆ«-RR" class="headerlink" title="3ã€é»˜è®¤éš”ç¦»çº§åˆ«-RR"></a><strong>3ã€é»˜è®¤éš”ç¦»çº§åˆ«-RR</strong></h4><p><strong>é»˜è®¤éš”ç¦»çº§åˆ«ï¼š</strong>å¯é‡å¤è¯»ï¼›</p><p>â€‹åŒâ¼€å­—æ®µçš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯â¼€è‡´çš„ï¼Œé™¤â¾®æ•°æ®æ˜¯è¢«æœ¬èº«äº‹åŠ¡â¾ƒâ¼°æ‰€ä¿®æ”¹ï¼›</p><p>â€‹å¯é‡å¤è¯»æ˜¯æœ‰å¯èƒ½å‡ºç°å¹»è¯»çš„ï¼Œå¦‚æœè¦ä¿è¯ç»å¯¹çš„å®‰å…¨åªèƒ½æŠŠéš”ç¦»çº§åˆ«è®¾ç½®æˆSERIALIZABLEï¼›è¿™æ ·æ‰€æœ‰äº‹åŠ¡éƒ½åªèƒ½é¡ºåºæ‰§è¡Œï¼Œè‡ªç„¶ä¸ä¼šå› ä¸ºå¹¶å‘æœ‰ä»€ä¹ˆå½±å“äº†ï¼Œä½†æ˜¯æ€§èƒ½ä¼šä¸‹é™è®¸å¤šã€‚</p><p>â€‹ç¬¬äºŒç§æ–¹å¼ï¼Œä½¿ç”¨MVCCè§£å†³<strong>å¿«ç…§è¯»å¹»è¯»é—®é¢˜</strong>ï¼ˆå¦‚ç®€å•selectï¼‰ï¼Œè¯»å–çš„ä¸æ˜¯æœ€æ–°çš„æ•°æ®ã€‚ç»´æŠ¤ä¸€ä¸ªå­—æ®µä½œä¸ºversionï¼Œè¿™æ ·å¯ä»¥æ§åˆ¶åˆ°æ¯æ¬¡åªèƒ½æœ‰ä¸€ä¸ªäººæ›´æ–°ä¸€ä¸ªç‰ˆæœ¬ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select id from table_xx where id = ? and version = V</span><br><span class="line">update id from table_xx where id = ? and version = V+1</span><br></pre></td></tr></table></figure><p>â€‹ç¬¬ä¸‰ç§æ–¹å¼ï¼Œå¦‚æœéœ€è¦è¯»æœ€æ–°çš„æ•°æ®ï¼Œå¯ä»¥é€šè¿‡GapLock+Next-KeyLockå¯ä»¥è§£å†³<strong>å½“å‰è¯»å¹»è¯»é—®é¢˜</strong>ï¼Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select id from table_xx where id &gt; 100 for update;</span><br><span class="line">select id from table_xx where id &gt; 100 lock in share mode;</span><br></pre></td></tr></table></figure><h4 id="4ã€RRå’ŒRCä½¿ç”¨åœºæ™¯"><a href="#4ã€RRå’ŒRCä½¿ç”¨åœºæ™¯" class="headerlink" title="4ã€RRå’ŒRCä½¿ç”¨åœºæ™¯"></a><strong>4ã€RRå’ŒRCä½¿ç”¨åœºæ™¯</strong></h4><p>â€‹äº‹åŠ¡éš”ç¦»çº§åˆ«RC(read commit)å’ŒRRï¼ˆrepeatable readï¼‰ä¸¤ç§äº‹åŠ¡éš”ç¦»çº§åˆ«åŸºäºå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶MVCC(multi-version concurrency controlï¼‰æ¥å®ç°ã€‚</p><table><thead><tr><th></th><th>RC</th><th>RR</th></tr></thead><tbody><tr><td>å®ç°</td><td>å¤šæ¡æŸ¥è¯¢è¯­å¥ä¼šåˆ›å»ºå¤šä¸ªä¸åŒçš„ReadView</td><td>ä»…éœ€è¦ä¸€ä¸ªç‰ˆæœ¬çš„ReadView</td></tr><tr><td>ç²’åº¦</td><td>è¯­å¥çº§è¯»ä¸€è‡´æ€§</td><td>äº‹åŠ¡çº§è¯»ä¸€è‡´æ€§</td></tr><tr><td>å‡†ç¡®æ€§</td><td>æ¯æ¬¡è¯­å¥æ‰§è¡Œæ—¶é—´ç‚¹çš„æ•°æ®</td><td>ç¬¬ä¸€æ¡è¯­å¥æ‰§è¡Œæ—¶é—´ç‚¹çš„æ•°æ®</td></tr></tbody></table><h4 id="5ã€è¡Œé”ï¼Œè¡¨é”ï¼Œæ„å‘é”"><a href="#5ã€è¡Œé”ï¼Œè¡¨é”ï¼Œæ„å‘é”" class="headerlink" title="5ã€è¡Œé”ï¼Œè¡¨é”ï¼Œæ„å‘é”"></a><strong>5ã€è¡Œé”ï¼Œè¡¨é”ï¼Œæ„å‘é”</strong></h4><p><strong>InnoDBâ½€æŒâ¾çº§é”(row-level locking)å’Œè¡¨çº§é”,é»˜è®¤ä¸ºâ¾çº§é”</strong></p><p>â€‹InnoDBæŒ‰ç…§ä¸åŒçš„åˆ†ç±»çš„é”ï¼š</p><p>â€‹å…±äº«&#x2F;æ’å®ƒé”(Shared and Exclusive Locks)ï¼šè¡Œçº§åˆ«é”ï¼Œ</p><p>â€‹æ„å‘é”(Intention Locks)ï¼Œè¡¨çº§åˆ«é”</p><p>â€‹é—´éš™é”(Gap Locks)ï¼Œé”å®šä¸€ä¸ªåŒºé—´</p><p>â€‹è®°å½•é”(Record Locks)ï¼Œé”å®šä¸€ä¸ªè¡Œè®°å½•</p><p><strong>è¡¨çº§é”ï¼šï¼ˆä¸²è¡ŒåŒ–ï¼‰</strong></p><p>â€‹Mysqlä¸­é”å®š ç²’åº¦æœ€å¤§çš„ä¸€ç§é”ï¼Œå¯¹å½“å‰æ“ä½œçš„æ•´å¼ è¡¨åŠ é”ï¼Œå®ç°ç®€å• ï¼Œèµ„æºæ¶ˆè€—ä¹Ÿæ¯”è¾ƒå°‘ï¼ŒåŠ é”å¿«ï¼Œä¸ä¼šå‡ºç°æ­»é” ã€‚å…¶é”å®šç²’åº¦æœ€å¤§ï¼Œè§¦å‘é”å†²çªçš„æ¦‚ç‡æœ€é«˜ï¼Œå¹¶å‘åº¦æœ€ä½ï¼ŒMyISAMå’Œ InnoDBå¼•æ“éƒ½æ”¯æŒè¡¨çº§é”ã€‚</p><p><strong>è¡Œçº§é”ï¼šï¼ˆRRã€RCï¼‰</strong></p><p>â€‹Mysqlä¸­é”å®š ç²’åº¦æœ€å° çš„ä¸€ç§é”ï¼Œåªé’ˆå¯¹å½“å‰æ“ä½œçš„è¡Œè¿›è¡ŒåŠ é”ã€‚ è¡Œçº§é”èƒ½å¤§å¤§å‡å°‘æ•°æ®åº“æ“ä½œçš„å†²çªã€‚å…¶åŠ é”ç²’åº¦æœ€å°ï¼Œå¹¶å‘åº¦é«˜ï¼Œä½†åŠ é”çš„å¼€é”€ä¹Ÿæœ€å¤§ï¼ŒåŠ é”æ…¢ï¼Œä¼šå‡ºç°æ­»é”ã€‚ InnoDBæ”¯æŒçš„è¡Œçº§é”ï¼ŒåŒ…æ‹¬å¦‚ä¸‹å‡ ç§ï¼š</p><p>â€‹<strong>è®°å½•é”ï¼ˆRecord Lockï¼‰:</strong> å¯¹ç´¢å¼•é¡¹åŠ é”ï¼Œé”å®š<strong>ç¬¦åˆæ¡ä»¶çš„è¡Œ</strong>ã€‚å…¶ä»–äº‹åŠ¡ä¸èƒ½ä¿®æ”¹å’Œåˆ é™¤åŠ é”é¡¹ï¼›</p><p>â€‹<strong>é—´éš™é”ï¼ˆGap Lockï¼‰:</strong> å¯¹ç´¢å¼•é¡¹ä¹‹é—´çš„â€œé—´éš™â€åŠ é”ï¼Œé”å®š<strong>è®°å½•çš„èŒƒå›´</strong>ï¼Œä¸åŒ…å«ç´¢å¼•é¡¹æœ¬èº«ï¼Œå…¶ä»–äº‹åŠ¡ä¸èƒ½åœ¨é”èŒƒå›´å†…æ’å…¥æ•°æ®ã€‚</p><p>â€‹<strong>Next-key Lockï¼š</strong> é”å®šç´¢å¼•é¡¹æœ¬èº«å’Œç´¢å¼•èŒƒå›´ã€‚å³Record Lockå’ŒGap Lockçš„ç»“åˆã€‚å¯è§£å†³å¹»è¯»é—®é¢˜ã€‚</p><p>InnoDB æ”¯æŒå¤šç²’åº¦é”ï¼ˆmultiple granularity lockingï¼‰ï¼Œå®ƒå…è®¸è¡Œçº§é”ä¸è¡¨çº§é”å…±å­˜ï¼Œè€Œæ„å‘é”å°±æ˜¯å…¶ä¸­çš„ä¸€ç§è¡¨é”ã€‚</p><p><strong>å…±äº«é”</strong>ï¼ˆ shared lock, S ï¼‰é”å…è®¸æŒæœ‰é”è¯»å–è¡Œçš„äº‹åŠ¡ã€‚åŠ é”æ—¶å°†è‡ªå·±å’Œå­èŠ‚ç‚¹å…¨åŠ Sé”ï¼Œçˆ¶èŠ‚ç‚¹ç›´åˆ°è¡¨å¤´å…¨åŠ ISé”</p><p><strong>æ’ä»–é”</strong>ï¼ˆ exclusive lockï¼Œ X ï¼‰é”å…è®¸æŒæœ‰é”ä¿®æ”¹è¡Œçš„äº‹åŠ¡ã€‚ åŠ é”æ—¶å°†è‡ªå·±å’Œå­èŠ‚ç‚¹å…¨åŠ Xé”ï¼Œçˆ¶èŠ‚ç‚¹ç›´åˆ°è¡¨å¤´å…¨åŠ IXé”  </p><p><strong>æ„å‘å…±äº«é”</strong>ï¼ˆintention shared lock, ISï¼‰ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ <strong>å…±äº«é”</strong>ï¼ˆSé”ï¼‰</p><p><strong>æ„å‘æ’ä»–é”</strong>ï¼ˆintention exclusive lock, IXï¼‰ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ <strong>æ’ä»–é”</strong>ï¼ˆXé”ï¼‰</p><table><thead><tr><th>äº’æ–¥æ€§</th><th>å…±äº«é”ï¼ˆSï¼‰</th><th>æ’å®ƒé”ï¼ˆXï¼‰</th><th>æ„å‘å…±äº«é”IS</th><th>æ„å‘æ’ä»–é”IX</th></tr></thead><tbody><tr><td>å…±äº«é”ï¼ˆSï¼‰</td><td>âœ…</td><td>âŒ</td><td>âœ…</td><td>âŒ</td></tr><tr><td>æ’å®ƒé”ï¼ˆXï¼‰</td><td>âŒ</td><td>âŒ</td><td>âŒ</td><td>âŒ</td></tr><tr><td>æ„å‘å…±äº«é”IS</td><td>âœ…</td><td>âŒ</td><td>âœ…</td><td>âœ…</td></tr><tr><td>æ„å‘æ’ä»–é”IX</td><td>âŒ</td><td>âŒ</td><td>âœ…</td><td>âœ…</td></tr></tbody></table><h4 id="6ã€MVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶"><a href="#6ã€MVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶" class="headerlink" title="6ã€MVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶"></a><strong>6ã€MVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</strong></h4><p>â€‹MVCCæ˜¯ä¸€ç§å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶æœºåˆ¶ï¼Œé€šè¿‡äº‹åŠ¡çš„å¯è§æ€§çœ‹åˆ°è‡ªå·±é¢„æœŸçš„æ•°æ®ï¼Œèƒ½é™ä½å…¶ç³»ç»Ÿå¼€é”€.ï¼ˆRCå’ŒRRçº§åˆ«å·¥ä½œï¼‰</p><p>â€‹InnoDBçš„MVCC,æ˜¯é€šè¿‡åœ¨æ¯è¡Œè®°å½•åé¢ä¿å­˜ç³»ç»Ÿç‰ˆæœ¬å·(å¯ä»¥ç†è§£ä¸ºäº‹åŠ¡çš„ID)ï¼Œæ¯å¼€å§‹ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œç³»ç»Ÿç‰ˆæœ¬å·å°±ä¼šè‡ªåŠ¨é€’å¢ï¼Œäº‹åŠ¡å¼€å§‹æ—¶åˆ»çš„ç³»ç»Ÿç‰ˆæœ¬å·ä¼šä½œä¸ºäº‹åŠ¡çš„IDã€‚è¿™æ ·å¯ä»¥ç¡®ä¿äº‹åŠ¡è¯»å–çš„è¡Œï¼Œè¦ä¹ˆæ˜¯åœ¨äº‹åŠ¡å¼€å§‹å‰å·²ç»å­˜åœ¨çš„ï¼Œè¦ä¹ˆæ˜¯äº‹åŠ¡è‡ªèº«æ’å…¥æˆ–è€…ä¿®æ”¹è¿‡çš„ï¼Œé˜²æ­¢å¹»è¯»çš„äº§ç”Ÿã€‚</p><p>â€‹1.MVCCæ‰‹æ®µåªé€‚ç”¨äºMsyqléš”ç¦»çº§åˆ«ä¸­çš„è¯»å·²æäº¤ï¼ˆRead committedï¼‰å’Œå¯é‡å¤è¯»ï¼ˆRepeatable Readï¼‰.</p><p>â€‹2.Read uncimmittedç”±äºå­˜åœ¨è„è¯»ï¼Œå³èƒ½è¯»åˆ°æœªæäº¤äº‹åŠ¡çš„æ•°æ®è¡Œï¼Œæ‰€ä»¥ä¸é€‚ç”¨MVCC.</p><p>â€‹3.ç®€å•çš„selectå¿«ç…§åº¦ä¸ä¼šåŠ é”ï¼Œåˆ æ”¹åŠselect for updateç­‰éœ€è¦å½“å‰è¯»çš„åœºæ™¯ä¼šåŠ é”</p><p>â€‹åŸå› æ˜¯MVCCçš„åˆ›å»ºç‰ˆæœ¬å’Œåˆ é™¤ç‰ˆæœ¬åªè¦åœ¨äº‹åŠ¡æäº¤åæ‰ä¼šäº§ç”Ÿã€‚å®¢è§‚ä¸Šï¼Œmysqlä½¿ç”¨çš„æ˜¯ä¹è§‚é”çš„ä¸€æ•´å®ç°æ–¹å¼ï¼Œå°±æ˜¯æ¯è¡Œéƒ½æœ‰ç‰ˆæœ¬å·ï¼Œä¿å­˜æ—¶æ ¹æ®ç‰ˆæœ¬å·å†³å®šæ˜¯å¦æˆåŠŸã€‚Innodbçš„MVCCä½¿ç”¨åˆ°çš„å¿«ç…§å­˜å‚¨åœ¨Undoæ—¥å¿—ä¸­ï¼Œè¯¥æ—¥å¿—é€šè¿‡å›æ»šæŒ‡é’ˆæŠŠä¸€ä¸ªæ•°æ®è¡Œæ‰€æœ‰å¿«ç…§è¿æ¥èµ·æ¥ã€‚</p><p><strong>ç‰ˆæœ¬é“¾</strong></p><p>åœ¨InnoDBå¼•æ“è¡¨ä¸­ï¼Œå®ƒçš„èšç°‡ç´¢å¼•è®°å½•ä¸­æœ‰ä¸¤ä¸ªå¿…è¦çš„éšè—åˆ—ï¼š</p><p><strong>trx_id</strong></p><p>è¿™ä¸ªidç”¨æ¥å­˜å‚¨çš„æ¯æ¬¡å¯¹æŸæ¡èšç°‡ç´¢å¼•è®°å½•è¿›è¡Œä¿®æ”¹çš„æ—¶å€™çš„äº‹åŠ¡idã€‚</p><p><strong>roll_pointer</strong></p><p>æ¯æ¬¡å¯¹å“ªæ¡èšç°‡ç´¢å¼•è®°å½•æœ‰ä¿®æ”¹çš„æ—¶å€™ï¼Œéƒ½ä¼šæŠŠè€ç‰ˆæœ¬å†™å…¥undoæ—¥å¿—ä¸­ã€‚è¿™ä¸ªroll_pointerå°±æ˜¯å­˜äº†ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒæŒ‡å‘è¿™æ¡èšç°‡ç´¢å¼•è®°å½•çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„ä½ç½®ï¼Œé€šè¿‡å®ƒæ¥è·å¾—ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„è®°å½•ä¿¡æ¯ã€‚(æ³¨æ„æ’å…¥æ“ä½œçš„undoæ—¥å¿—æ²¡æœ‰è¿™ä¸ªå±æ€§ï¼Œå› ä¸ºå®ƒæ²¡æœ‰è€ç‰ˆæœ¬)</p><p>æ¯æ¬¡ä¿®æ”¹éƒ½ä¼šåœ¨ç‰ˆæœ¬é“¾ä¸­è®°å½•ã€‚<strong>SELECTå¯ä»¥å»ç‰ˆæœ¬é“¾ä¸­æ‹¿è®°å½•ï¼Œè¿™å°±å®ç°äº†è¯»-å†™ï¼Œå†™-è¯»çš„å¹¶å‘æ‰§è¡Œï¼Œ</strong>æå‡äº†ç³»ç»Ÿçš„æ€§èƒ½ã€‚</p><h3 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h3><h4 id="1ã€Innodbå’ŒMyisamå¼•æ“"><a href="#1ã€Innodbå’ŒMyisamå¼•æ“" class="headerlink" title="1ã€Innodbå’ŒMyisamå¼•æ“"></a><strong>1ã€Innodbå’ŒMyisamå¼•æ“</strong></h4><p><strong>Myisamï¼š</strong>æ”¯æŒè¡¨é”ï¼Œé€‚åˆè¯»å¯†é›†çš„åœºæ™¯ï¼Œä¸æ”¯æŒå¤–é”®ï¼Œä¸æ”¯æŒäº‹åŠ¡ï¼Œç´¢å¼•ä¸æ•°æ®åœ¨ä¸åŒçš„æ–‡ä»¶</p><p><strong>Innodbï¼š</strong>æ”¯æŒè¡Œã€è¡¨é”ï¼Œé»˜è®¤ä¸ºè¡Œé”ï¼Œé€‚åˆå¹¶å‘åœºæ™¯ï¼Œæ”¯æŒå¤–é”®ï¼Œæ”¯æŒäº‹åŠ¡ï¼Œç´¢å¼•ä¸æ•°æ®åŒä¸€æ–‡ä»¶</p><h4 id="2ã€å“ˆå¸Œç´¢å¼•"><a href="#2ã€å“ˆå¸Œç´¢å¼•" class="headerlink" title="2ã€å“ˆå¸Œç´¢å¼•"></a><strong>2ã€å“ˆå¸Œç´¢å¼•</strong></h4><p>â€‹å“ˆå¸Œç´¢å¼•ç”¨ç´¢å¼•åˆ—çš„å€¼è®¡ç®—è¯¥å€¼çš„hashCodeï¼Œç„¶ååœ¨hashCodeç›¸åº”çš„ä½ç½®å­˜æ‰§è¯¥å€¼æ‰€åœ¨è¡Œæ•°æ®çš„ç‰©ç†ä½ç½®ï¼Œå› ä¸ºä½¿ç”¨æ•£åˆ—ç®—æ³•ï¼Œå› æ­¤è®¿é—®é€Ÿåº¦éå¸¸å¿«ï¼Œä½†æ˜¯ä¸€ä¸ªå€¼åªèƒ½å¯¹åº”ä¸€ä¸ªhashCodeï¼Œè€Œä¸”æ˜¯æ•£åˆ—çš„åˆ†å¸ƒæ–¹å¼ï¼Œå› æ­¤å“ˆå¸Œç´¢å¼•ä¸æ”¯æŒèŒƒå›´æŸ¥æ‰¾å’Œæ’åºçš„åŠŸèƒ½</p><h4 id="3ã€B-æ ‘ç´¢å¼•"><a href="#3ã€B-æ ‘ç´¢å¼•" class="headerlink" title="3ã€B+æ ‘ç´¢å¼•"></a><strong>3ã€B+æ ‘ç´¢å¼•</strong></h4><p><strong>ä¼˜ç‚¹ï¼š</strong></p><p>â€‹B+æ ‘çš„ç£ç›˜è¯»å†™ä»£ä»·ä½ï¼Œæ›´å°‘çš„æŸ¥è¯¢æ¬¡æ•°ï¼ŒæŸ¥è¯¢æ•ˆç‡æ›´åŠ ç¨³å®šï¼Œæœ‰åˆ©äºå¯¹æ•°æ®åº“çš„æ‰«æ</p><p>â€‹B+æ ‘æ˜¯Bæ ‘çš„å‡çº§ç‰ˆï¼ŒB+æ ‘åªæœ‰å¶èŠ‚ç‚¹å­˜æ”¾æ•°æ®ï¼Œå…¶ä½™èŠ‚ç‚¹ç”¨æ¥ç´¢å¼•ã€‚ç´¢å¼•èŠ‚ç‚¹å¯ä»¥å…¨éƒ¨åŠ å…¥å†…å­˜ï¼Œå¢åŠ æŸ¥è¯¢æ•ˆç‡ï¼Œå¶å­èŠ‚ç‚¹å¯ä»¥åšåŒå‘é“¾è¡¨ï¼Œä»è€Œ<strong>æé«˜èŒƒå›´æŸ¥æ‰¾çš„æ•ˆç‡ï¼Œå¢åŠ çš„ç´¢å¼•çš„èŒƒå›´</strong></p><p>â€‹åœ¨å¤§è§„æ¨¡æ•°æ®å­˜å‚¨çš„æ—¶å€™ï¼Œçº¢é»‘æ ‘å¾€å¾€å‡ºç°ç”±äº<strong>æ ‘çš„æ·±åº¦è¿‡å¤§</strong>è€Œé€ æˆç£ç›˜IOè¯»å†™è¿‡äºé¢‘ç¹ï¼Œè¿›è€Œå¯¼è‡´æ•ˆç‡ä½ä¸‹çš„æƒ…å†µã€‚æ‰€ä»¥ï¼Œåªè¦æˆ‘ä»¬é€šè¿‡æŸç§è¾ƒå¥½çš„æ ‘ç»“æ„å‡å°‘æ ‘çš„ç»“æ„å°½é‡å‡å°‘æ ‘çš„é«˜åº¦ï¼ŒBæ ‘ä¸B+æ ‘å¯ä»¥æœ‰å¤šä¸ªå­å¥³ï¼Œä»å‡ ååˆ°ä¸Šåƒï¼Œå¯ä»¥é™ä½æ ‘çš„é«˜åº¦ã€‚</p><p>â€‹<strong>ç£ç›˜é¢„è¯»åŸç†</strong>ï¼šå°†ä¸€ä¸ªèŠ‚ç‚¹çš„å¤§å°è®¾ä¸ºç­‰äºä¸€ä¸ªé¡µï¼Œè¿™æ ·æ¯ä¸ªèŠ‚ç‚¹åªéœ€è¦ä¸€æ¬¡I&#x2F;Oå°±å¯ä»¥å®Œå…¨è½½å…¥ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œåœ¨å®é™…å®ç°B-Treeè¿˜éœ€è¦ä½¿ç”¨å¦‚ä¸‹æŠ€å·§ï¼šæ¯æ¬¡æ–°å»ºèŠ‚ç‚¹æ—¶ï¼Œç›´æ¥ç”³è¯·ä¸€ä¸ªé¡µçš„ç©ºé—´ï¼Œè¿™æ ·å°±ä¿è¯<strong>ä¸€ä¸ªèŠ‚ç‚¹ç‰©ç†ä¸Šä¹Ÿå­˜å‚¨åœ¨ä¸€ä¸ªé¡µé‡Œ</strong>ï¼ŒåŠ ä¹‹è®¡ç®—æœºå­˜å‚¨åˆ†é…éƒ½æ˜¯æŒ‰é¡µå¯¹é½çš„ï¼Œå°±å®ç°äº†ä¸€ä¸ªnodeåªéœ€ä¸€æ¬¡I&#x2F;Oã€‚</p><h4 id="4ã€åˆ›å»ºç´¢å¼•"><a href="#4ã€åˆ›å»ºç´¢å¼•" class="headerlink" title="4ã€åˆ›å»ºç´¢å¼•"></a>4ã€åˆ›å»ºç´¢å¼•</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span>  [<span class="keyword">UNIQUE</span> <span class="operator">|</span> FULLTEXT]  INDEX  ç´¢å¼•å <span class="keyword">ON</span>  è¡¨å(å­—æ®µå) [<span class="keyword">USING</span> ç´¢å¼•æ–¹æ³•]ï¼›</span><br><span class="line"></span><br><span class="line">è¯´æ˜ï¼š</span><br><span class="line"><span class="keyword">UNIQUE</span>:å¯é€‰ã€‚è¡¨ç¤ºç´¢å¼•ä¸ºå”¯ä¸€æ€§ç´¢å¼•ã€‚</span><br><span class="line">FULLTEXT:å¯é€‰ã€‚è¡¨ç¤ºç´¢å¼•ä¸ºå…¨æ–‡ç´¢å¼•ã€‚</span><br><span class="line">INDEXå’ŒKEY:ç”¨äºæŒ‡å®šå­—æ®µä¸ºç´¢å¼•ï¼Œä¸¤è€…é€‰æ‹©å…¶ä¸­ä¹‹ä¸€å°±å¯ä»¥äº†ï¼Œä½œç”¨æ˜¯ä¸€æ ·çš„ã€‚</span><br><span class="line">ç´¢å¼•å:å¯é€‰ã€‚ç»™åˆ›å»ºçš„ç´¢å¼•å–ä¸€ä¸ªæ–°åç§°ã€‚</span><br><span class="line">å­—æ®µå<span class="number">1</span>:æŒ‡å®šç´¢å¼•å¯¹åº”çš„å­—æ®µçš„åç§°ï¼Œè¯¥å­—æ®µå¿…é¡»æ˜¯å‰é¢å®šä¹‰å¥½çš„å­—æ®µã€‚</span><br><span class="line">æ³¨ï¼šç´¢å¼•æ–¹æ³•é»˜è®¤ä½¿ç”¨B<span class="operator">+</span>TREEã€‚</span><br></pre></td></tr></table></figure><h4 id="5ã€èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•"><a href="#5ã€èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•" class="headerlink" title="5ã€èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•"></a><strong>5ã€èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•</strong></h4><p>â€‹<strong>èšç°‡ç´¢å¼•ï¼š</strong>å°†æ•°æ®å­˜å‚¨ä¸ç´¢å¼•æ”¾åˆ°äº†ä¸€å—ï¼Œç´¢å¼•ç»“æ„çš„å¶å­èŠ‚ç‚¹ä¿å­˜äº†è¡Œæ•°æ®ï¼ˆ<strong>ä¸»é”®ç´¢å¼•</strong>ï¼‰</p><p>â€‹<strong>éèšç°‡ç´¢å¼•ï¼š</strong>å°†æ•°æ®ä¸ç´¢å¼•åˆ†å¼€å­˜å‚¨ï¼Œç´¢å¼•ç»“æ„çš„å¶å­èŠ‚ç‚¹æŒ‡å‘äº†æ•°æ®å¯¹åº”çš„ä½ç½®ï¼ˆ<strong>è¾…åŠ©ç´¢å¼•</strong>ï¼‰</p><p>â€‹èšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å°±æ˜¯æ•°æ®èŠ‚ç‚¹ï¼Œè€Œéèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä»ç„¶æ˜¯ç´¢å¼•èŠ‚ç‚¹ï¼Œåªä¸è¿‡æœ‰æŒ‡å‘å¯¹åº”æ•°æ®å—çš„æŒ‡é’ˆã€‚</p><h4 id="6ã€æœ€å·¦å‰ç¼€é—®é¢˜"><a href="#6ã€æœ€å·¦å‰ç¼€é—®é¢˜" class="headerlink" title="6ã€æœ€å·¦å‰ç¼€é—®é¢˜"></a>6ã€æœ€å·¦å‰ç¼€é—®é¢˜</h4><p>â€‹æœ€å·¦å‰ç¼€åŸåˆ™ä¸»è¦ä½¿ç”¨åœ¨è”åˆç´¢å¼•ä¸­ï¼Œè”åˆç´¢å¼•çš„B+Treeæ˜¯æŒ‰ç…§ç¬¬ä¸€ä¸ªå…³é”®å­—è¿›è¡Œç´¢å¼•æ’åˆ—çš„ã€‚</p><p>â€‹è”åˆç´¢å¼•çš„åº•å±‚æ˜¯ä¸€é¢—B+æ ‘ï¼Œåªä¸è¿‡è”åˆç´¢å¼•çš„B+æ ‘èŠ‚ç‚¹ä¸­å­˜å‚¨çš„æ˜¯é”®å€¼ã€‚ç”±äºæ„å»ºä¸€æ£µB+æ ‘åªèƒ½æ ¹æ®ä¸€ä¸ªå€¼æ¥ç¡®å®šç´¢å¼•å…³ç³»ï¼Œæ‰€ä»¥æ•°æ®åº“ä¾èµ–è”åˆç´¢å¼•æœ€å·¦çš„å­—æ®µæ¥æ„å»ºã€‚</p><p>â€‹é‡‡ç”¨&gt;ã€&lt;ç­‰è¿›è¡ŒåŒ¹é…éƒ½ä¼šå¯¼è‡´åé¢çš„åˆ—æ— æ³•èµ°ç´¢å¼•ï¼Œå› ä¸ºé€šè¿‡ä»¥ä¸Šæ–¹å¼åŒ¹é…åˆ°çš„æ•°æ®æ˜¯ä¸å¯çŸ¥çš„ã€‚</p><h3 id="SQLæŸ¥è¯¢"><a href="#SQLæŸ¥è¯¢" class="headerlink" title="SQLæŸ¥è¯¢"></a>SQLæŸ¥è¯¢</h3><h4 id="1ã€SQLè¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹"><a href="#1ã€SQLè¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="1ã€SQLè¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹"></a><strong>1ã€SQLè¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹</strong></h4><p><strong>æŸ¥è¯¢è¯­å¥ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from student  A where A.age=&#x27;18&#x27; and A.name=&#x27;å¼ ä¸‰&#x27;;</span><br></pre></td></tr></table></figure><img src="http://s0.lgstatic.com/i/image2/M01/8B/0F/CgotOV14ySKAMxohAAH2VHcAzkE612.png" alt="img" style="zoom: 67%;" /><p>ç»“åˆä¸Šé¢çš„è¯´æ˜ï¼Œæˆ‘ä»¬åˆ†æä¸‹è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæµç¨‹ï¼š</p><p>â‘ é€šè¿‡å®¢æˆ·ç«¯&#x2F;æœåŠ¡å™¨é€šä¿¡åè®®ä¸ MySQL å»ºç«‹è¿æ¥ã€‚å¹¶æŸ¥è¯¢æ˜¯å¦æœ‰æƒé™</p><p>â‘¡Mysql8.0ä¹‹å‰å¼€çœ‹æ˜¯å¦å¼€å¯ç¼“å­˜ï¼Œå¼€å¯äº† Query Cache ä¸”å‘½ä¸­å®Œå…¨ç›¸åŒçš„ SQL è¯­å¥ï¼Œåˆ™å°†æŸ¥è¯¢ç»“æœç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯ï¼›</p><p>â‘¢ç”±è§£æå™¨è¿›è¡Œè¯­æ³•è¯­ä¹‰è§£æï¼Œå¹¶ç”Ÿæˆè§£ææ ‘ã€‚å¦‚æŸ¥è¯¢æ˜¯selectã€è¡¨åtb_studentã€æ¡ä»¶æ˜¯id&#x3D;â€™1â€™</p><p>â‘£æŸ¥è¯¢ä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’ã€‚æ ¹æ®ç´¢å¼•çœ‹çœ‹æ˜¯å¦å¯ä»¥ä¼˜åŒ–</p><p>â‘¤æŸ¥è¯¢æ‰§è¡Œå¼•æ“æ‰§è¡Œ SQL è¯­å¥ï¼Œæ ¹æ®å­˜å‚¨å¼•æ“ç±»å‹ï¼Œå¾—åˆ°æŸ¥è¯¢ç»“æœã€‚è‹¥å¼€å¯äº† Query Cacheï¼Œåˆ™ç¼“å­˜ï¼Œå¦åˆ™ç›´æ¥è¿”å›ã€‚</p><h4 id="2ã€å›è¡¨æŸ¥è¯¢å’Œè¦†ç›–ç´¢å¼•"><a href="#2ã€å›è¡¨æŸ¥è¯¢å’Œè¦†ç›–ç´¢å¼•" class="headerlink" title="2ã€å›è¡¨æŸ¥è¯¢å’Œè¦†ç›–ç´¢å¼•"></a><strong>2ã€å›è¡¨æŸ¥è¯¢å’Œè¦†ç›–ç´¢å¼•</strong></h4><p><strong>æ™®é€šç´¢å¼•</strong>ï¼ˆå”¯ä¸€ç´¢å¼•+è”åˆç´¢å¼•+å…¨æ–‡ç´¢å¼•ï¼‰éœ€è¦æ‰«æä¸¤éç´¢å¼•æ ‘</p><p>ï¼ˆ1ï¼‰å…ˆé€šè¿‡æ™®é€šç´¢å¼•å®šä½åˆ°ä¸»é”®å€¼id&#x3D;5ï¼›</p><p>ï¼ˆ2ï¼‰åœ¨é€šè¿‡èšé›†ç´¢å¼•å®šä½åˆ°è¡Œè®°å½•ï¼›</p><p>è¿™å°±æ˜¯æ‰€è°“çš„<strong>å›è¡¨æŸ¥è¯¢</strong>ï¼Œå…ˆå®šä½ä¸»é”®å€¼ï¼Œå†å®šä½è¡Œè®°å½•ï¼Œå®ƒçš„æ€§èƒ½è¾ƒæ‰«ä¸€éç´¢å¼•æ ‘æ›´ä½ã€‚</p><p><strong>è¦†ç›–ç´¢å¼•</strong>ï¼šä¸»é”®ç´¢å¼•&#x3D;&#x3D;èšç°‡ç´¢å¼•&#x3D;&#x3D;è¦†ç›–ç´¢å¼•</p><p>â€‹å¦‚æœwhereæ¡ä»¶çš„åˆ—å’Œè¿”å›çš„æ•°æ®åœ¨ä¸€ä¸ªç´¢å¼•ä¸­ï¼Œé‚£ä¹ˆä¸éœ€è¦å›æŸ¥è¡¨ï¼Œé‚£ä¹ˆå°±å«è¦†ç›–ç´¢å¼•ã€‚</p><p><strong>å®ç°è¦†ç›–ç´¢å¼•</strong>ï¼šå¸¸è§çš„æ–¹æ³•æ˜¯ï¼Œå°†è¢«æŸ¥è¯¢çš„å­—æ®µï¼Œå»ºç«‹åˆ°è”åˆç´¢å¼•é‡Œå»ã€‚</p><h4 id="3ã€ExplainåŠä¼˜åŒ–"><a href="#3ã€ExplainåŠä¼˜åŒ–" class="headerlink" title="3ã€ExplainåŠä¼˜åŒ–"></a>3ã€ExplainåŠä¼˜åŒ–</h4><p>å‚è€ƒï¼š<a href="https://www.jianshu.com/p/8fab76bbf448">https://www.jianshu.com/p/8fab76bbf448</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from staff;</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+-------+</span><br><span class="line">| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra |</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+-------+</span><br><span class="line">|  1 | SIMPLE      | staff | ALL  | NULL          | ç´¢å¼•  | NULL    | NULL |    2 | NULL  |</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+-------+</span><br><span class="line">1 row in set</span><br></pre></td></tr></table></figure><p><strong>ç´¢å¼•ä¼˜åŒ–ï¼š</strong></p><p>â€‹â‘ æœ€å·¦å‰ç¼€ç´¢å¼•ï¼šlikeåªç”¨äºâ€™string%â€™ï¼Œè¯­å¥ä¸­çš„&#x3D;å’Œinä¼šåŠ¨æ€è°ƒæ•´é¡ºåº</p><p>â€‹â‘¡å”¯ä¸€ç´¢å¼•ï¼šå”¯ä¸€é”®åŒºåˆ†åº¦åœ¨0.1ä»¥ä¸Š</p><p>â€‹â‘¢æ— æ³•ä½¿ç”¨ç´¢å¼•ï¼š!&#x3D;  ã€is null ã€ orã€&gt;&lt; ã€ï¼ˆ<strong>5.7ä»¥åæ ¹æ®æ•°é‡è‡ªåŠ¨åˆ¤å®šï¼‰in ã€not in</strong></p><p>â€‹â‘£è”åˆç´¢å¼•ï¼šé¿å…select * ï¼ŒæŸ¥è¯¢åˆ—ä½¿ç”¨è¦†ç›–ç´¢å¼•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT uid From user Where gid = 2 order by ctime asc limit 10</span><br><span class="line">ALTER TABLE user add index idx_gid_ctime_uid(gid,ctime,uid) #åˆ›å»ºè”åˆè¦†ç›–ç´¢å¼•ï¼Œé¿å…å›è¡¨æŸ¥è¯¢</span><br></pre></td></tr></table></figure><p><strong>è¯­å¥ä¼˜åŒ–ï¼š</strong></p><p>â€‹â‘ charå›ºå®šé•¿åº¦æŸ¥è¯¢æ•ˆç‡é«˜ï¼Œvarcharç¬¬ä¸€ä¸ªå­—èŠ‚è®°å½•æ•°æ®é•¿åº¦</p><p>â€‹â‘¡åº”è¯¥é’ˆå¯¹Explainä¸­Rowså¢åŠ ç´¢å¼•</p><p>â€‹â‘¢group&#x2F;order byå­—æ®µå‡ä¼šæ¶‰åŠç´¢å¼•</p><p>â€‹â‘£Limitä¸­åˆ†é¡µæŸ¥è¯¢ä¼šéšç€startå€¼å¢å¤§è€Œå˜ç¼“æ…¢ï¼Œé€šè¿‡å­æŸ¥è¯¢+è¡¨è¿æ¥è§£å†³</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> mytbl <span class="keyword">order</span> <span class="keyword">by</span> id limit <span class="number">100000</span>,<span class="number">10</span>  æ”¹è¿›åçš„<span class="keyword">SQL</span>è¯­å¥å¦‚ä¸‹ï¼š</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> mytbl <span class="keyword">where</span> id <span class="operator">&gt;=</span> ( <span class="keyword">select</span> id <span class="keyword">from</span> mytbl <span class="keyword">order</span> <span class="keyword">by</span> id limit <span class="number">100000</span>,<span class="number">1</span> ) limit <span class="number">10</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> mytbl <span class="keyword">inner</span> ori <span class="keyword">join</span> (<span class="keyword">select</span> id <span class="keyword">from</span> mytbl <span class="keyword">order</span> <span class="keyword">by</span> id limit <span class="number">100000</span>,<span class="number">10</span>) <span class="keyword">as</span> tmp <span class="keyword">on</span> tmp.id<span class="operator">=</span>ori.id;</span><br></pre></td></tr></table></figure><p>â€‹â‘¤countä¼šè¿›è¡Œå…¨è¡¨æ‰«æï¼Œå¦‚æœä¼°ç®—å¯ä»¥ä½¿ç”¨explain</p><p>â€‹â‘¥deleteåˆ é™¤è¡¨æ—¶ä¼šå¢åŠ å¤§é‡undoå’Œredoæ—¥å¿—ï¼Œ ç¡®å®šåˆ é™¤å¯ä½¿ç”¨trancate</p><p><strong>è¡¨ç»“æ„ä¼˜åŒ–ï¼š</strong></p><p>â€‹â‘ å•åº“ä¸è¶…è¿‡200å¼ è¡¨</p><p>â€‹â‘¡å•è¡¨ä¸è¶…è¿‡500wæ•°æ®</p><p>â€‹â‘¢å•è¡¨ä¸è¶…è¿‡40åˆ—</p><p>â€‹â‘£å•è¡¨ç´¢å¼•ä¸è¶…è¿‡5ä¸ª</p><p><strong>æ•°æ®åº“èŒƒå¼</strong> ï¼š</p><p>â€‹â‘ ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰åˆ—ä¸å¯åˆ†å‰²</p><p>â€‹â‘¡ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰å±æ€§å®Œå…¨ä¾èµ–äºä¸»é”® [ æ¶ˆé™¤éƒ¨åˆ†å­å‡½æ•°ä¾èµ– ]</p><p>â€‹â‘¢ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰å±æ€§ä¸ä¾èµ–äºå…¶å®ƒéä¸»å±æ€§ [ æ¶ˆé™¤ä¼ é€’ä¾èµ– ]</p><p><strong>é…ç½®ä¼˜åŒ–ï¼š</strong></p><p>â€‹é…ç½®è¿æ¥æ•°ã€ç¦ç”¨Swapã€å¢åŠ å†…å­˜ã€å‡çº§SSDç¡¬ç›˜</p><h4 id="4ã€JOINæŸ¥è¯¢"><a href="#4ã€JOINæŸ¥è¯¢" class="headerlink" title="4ã€JOINæŸ¥è¯¢"></a>4ã€JOINæŸ¥è¯¢</h4><img src="https://image-static.segmentfault.com/276/780/2767807589-5c122586a23c4_articlex" style="align:left;zoom: 60%;" /><p><strong>left join(å·¦è”æ¥)</strong> è¿”å›åŒ…æ‹¬å·¦è¡¨ä¸­çš„æ‰€æœ‰è®°å½•å’Œå³è¡¨ä¸­å…³è”å­—æ®µç›¸ç­‰çš„è®°å½• </p><p><strong>right join(å³è”æ¥)</strong> è¿”å›åŒ…æ‹¬å³è¡¨ä¸­çš„æ‰€æœ‰è®°å½•å’Œå·¦è¡¨ä¸­å…³è”å­—æ®µç›¸ç­‰çš„è®°å½•</p><p><strong>inner join(ç­‰å€¼è¿æ¥)</strong> åªè¿”å›ä¸¤ä¸ªè¡¨ä¸­å…³è”å­—æ®µç›¸ç­‰çš„è¡Œ</p><h3 id="é›†ç¾¤"><a href="#é›†ç¾¤" class="headerlink" title="é›†ç¾¤"></a><strong>é›†ç¾¤</strong></h3><h4 id="1ã€ä¸»ä»å¤åˆ¶è¿‡ç¨‹"><a href="#1ã€ä¸»ä»å¤åˆ¶è¿‡ç¨‹" class="headerlink" title="1ã€ä¸»ä»å¤åˆ¶è¿‡ç¨‹"></a>1ã€ä¸»ä»å¤åˆ¶è¿‡ç¨‹</h4><p><strong>MySQlä¸»ä»å¤åˆ¶ï¼š</strong></p><ul><li><strong>åŸç†</strong>ï¼šå°†ä¸»æœåŠ¡å™¨çš„binlogæ—¥å¿—å¤åˆ¶åˆ°ä»æœåŠ¡å™¨ä¸Šæ‰§è¡Œä¸€éï¼Œè¾¾åˆ°ä¸»ä»æ•°æ®çš„ä¸€è‡´çŠ¶æ€ã€‚</li><li><strong>è¿‡ç¨‹</strong>ï¼šä»åº“å¼€å¯ä¸€ä¸ªI&#x2F;Oçº¿ç¨‹ï¼Œå‘ä¸»åº“è¯·æ±‚Binlogæ—¥å¿—ã€‚ä¸»èŠ‚ç‚¹å¼€å¯ä¸€ä¸ªbinlog dumpçº¿ç¨‹ï¼Œæ£€æŸ¥è‡ªå·±çš„äºŒè¿›åˆ¶æ—¥å¿—ï¼Œå¹¶å‘é€ç»™ä»èŠ‚ç‚¹ï¼›ä»åº“å°†æ¥æ”¶åˆ°çš„æ•°æ®ä¿å­˜åˆ°ä¸­ç»§æ—¥å¿—ï¼ˆRelay logï¼‰ä¸­ï¼Œå¦å¤–å¼€å¯ä¸€ä¸ªSQLçº¿ç¨‹ï¼ŒæŠŠRelayä¸­çš„æ“ä½œåœ¨è‡ªèº«æœºå™¨ä¸Šæ‰§è¡Œä¸€é</li><li><strong>ä¼˜ç‚¹</strong>ï¼š<ul><li>ä½œä¸ºå¤‡ç”¨æ•°æ®åº“ï¼Œå¹¶ä¸”ä¸å½±å“ä¸šåŠ¡</li><li>å¯åšè¯»å†™åˆ†ç¦»ï¼Œä¸€ä¸ªå†™åº“ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªè¯»åº“ï¼Œåœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œå……åˆ†å‘æŒ¥æœåŠ¡å™¨å’Œæ•°æ®åº“çš„æ€§èƒ½ï¼Œä½†è¦ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§</li></ul></li></ul><p><strong>binlogè®°å½•æ ¼å¼ï¼š</strong>statementã€rowã€mixed</p><p>â€‹åŸºäºè¯­å¥statementçš„å¤åˆ¶ã€åŸºäºè¡Œrowçš„å¤åˆ¶ã€åŸºäºè¯­å¥å’Œè¡Œï¼ˆmixï¼‰çš„å¤åˆ¶ã€‚å…¶ä¸­åŸºäºrowçš„å¤åˆ¶æ–¹å¼æ›´èƒ½ä¿è¯ä¸»ä»åº“æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä½†æ—¥å¿—é‡è¾ƒå¤§ï¼Œåœ¨è®¾ç½®æ—¶è€ƒè™‘ç£ç›˜çš„ç©ºé—´é—®é¢˜</p><h4 id="2ã€æ•°æ®ä¸€è‡´æ€§é—®é¢˜"><a href="#2ã€æ•°æ®ä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="2ã€æ•°æ®ä¸€è‡´æ€§é—®é¢˜"></a>2ã€æ•°æ®ä¸€è‡´æ€§é—®é¢˜</h4><p>â€œä¸»ä»å¤åˆ¶æœ‰å»¶æ—¶â€ï¼Œè¿™ä¸ªå»¶æ—¶æœŸé—´è¯»å–ä»åº“ï¼Œå¯èƒ½è¯»åˆ°ä¸ä¸€è‡´çš„æ•°æ®ã€‚</p><p><strong>ç¼“å­˜è®°å½•å†™keyæ³•ï¼š</strong></p><p>â€‹åœ¨cacheé‡Œè®°å½•å“ªäº›è®°å½•å‘ç”Ÿè¿‡çš„å†™è¯·æ±‚ï¼Œæ¥è·¯ç”±è¯»ä¸»åº“è¿˜æ˜¯è¯»ä»åº“</p><p><strong>å¼‚æ­¥å¤åˆ¶ï¼š</strong></p><p>â€‹åœ¨å¼‚æ­¥å¤åˆ¶ä¸­ï¼Œä¸»åº“æ‰§è¡Œå®Œæ“ä½œåï¼Œå†™å…¥binlogæ—¥å¿—åï¼Œå°±è¿”å›å®¢æˆ·ç«¯ï¼Œè¿™ä¸€åŠ¨ä½œå°±ç»“æŸäº†ï¼Œå¹¶ä¸ä¼šéªŒè¯ä»åº“æœ‰æ²¡æœ‰æ”¶åˆ°ï¼Œå®Œä¸å®Œæ•´ï¼Œæ‰€ä»¥è¿™æ ·å¯èƒ½<strong>ä¼šé€ æˆæ•°æ®çš„ä¸ä¸€è‡´</strong>ã€‚</p><p><strong>åŠåŒæ­¥å¤åˆ¶ï¼š</strong></p><p>â€‹å½“ä¸»åº“æ¯æäº¤ä¸€ä¸ªäº‹åŠ¡åï¼Œä¸ä¼šç«‹å³è¿”å›ï¼Œè€Œæ˜¯ç­‰å¾…å…¶ä¸­ä¸€ä¸ªä»åº“æ¥æ”¶åˆ°Binlogå¹¶æˆåŠŸå†™å…¥Relay-logä¸­æ‰è¿”å›å®¢æˆ·ç«¯ï¼Œé€šè¿‡ä¸€ä»½åœ¨ä¸»åº“çš„Binlogï¼Œå¦ä¸€ä»½åœ¨å…¶ä¸­ä¸€ä¸ªä»åº“çš„Relay-logï¼Œå¯ä»¥ä¿è¯äº†æ•°æ®çš„å®‰å…¨æ€§å’Œä¸€è‡´æ€§ã€‚</p><p><strong>å…¨åŒæ­¥å¤åˆ¶ï¼š</strong></p><p>â€‹æŒ‡å½“ä¸»åº“æ‰§è¡Œå®Œä¸€ä¸ªäº‹åŠ¡ï¼Œæ‰€æœ‰çš„ä»åº“éƒ½æ‰§è¡Œäº†è¯¥äº‹åŠ¡æ‰è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å› ä¸ºéœ€è¦ç­‰å¾…æ‰€æœ‰ä»åº“æ‰§è¡Œå®Œè¯¥äº‹åŠ¡æ‰èƒ½è¿”å›ï¼Œæ‰€ä»¥å…¨åŒæ­¥å¤åˆ¶çš„<strong>æ€§èƒ½å¿…ç„¶ä¼šæ”¶åˆ°ä¸¥é‡çš„å½±å“</strong>ã€‚</p><h4 id="3ã€é›†ç¾¤æ¶æ„"><a href="#3ã€é›†ç¾¤æ¶æ„" class="headerlink" title="3ã€é›†ç¾¤æ¶æ„"></a>3ã€é›†ç¾¤æ¶æ„</h4><p> <strong>Keepalived + VIP + MySQL ä¸»ä»&#x2F;åŒä¸»</strong></p><p>â€‹å½“å†™èŠ‚ç‚¹ Master db1 å‡ºç°æ•…éšœæ—¶ï¼Œç”± MMM Monitor æˆ– Keepalived è§¦å‘åˆ‡æ¢è„šæœ¬ï¼Œå°† VIP æ¼‚ç§»åˆ°å¯ç”¨çš„ Master db2 ä¸Šã€‚å½“å‡ºç°ç½‘ç»œæŠ–åŠ¨æˆ–ç½‘ç»œåˆ†åŒºæ—¶ï¼ŒMMM Monitor ä¼šè¯¯åˆ¤ï¼Œä¸¥é‡æ—¶æ¥å›åˆ‡æ¢å†™ VIP å¯¼è‡´é›†ç¾¤åŒå†™ï¼Œå½“æ•°æ®å¤åˆ¶å»¶è¿Ÿæ—¶ï¼Œåº”ç”¨ç¨‹åºä¼šå‡ºç°æ•°æ®é”™ä¹±æˆ–æ•°æ®å†²çªçš„æ•…éšœã€‚æœ‰æ•ˆé¿å…å•ç‚¹å¤±æ•ˆçš„æ¶æ„å°±æ˜¯é‡‡ç”¨å…±äº«å­˜å‚¨ï¼Œå•ç‚¹æ•…éšœåˆ‡æ¢å¯ä»¥é€šè¿‡åˆ†å¸ƒå¼å“¨å…µç³»ç»Ÿç›‘æ§ã€‚</p><img src="http://s0.lgstatic.com/i/image2/M01/89/48/CgoB5l12KuGALf-cAAGuHVmMkHs743.png" alt="img" style="zoom: 67%;" /><p> <strong>æ¶æ„é€‰å‹ï¼š</strong>MMM é›†ç¾¤  -&gt; MHAé›†ç¾¤ -&gt; MHA+Arksentinelã€‚</p><img src="http://s0.lgstatic.com/i/image2/M01/89/68/CgotOV12KuKAe_HOAABl-wRATa0772.png" alt="img"  /><h4 id="4ã€æ•…éšœè½¬ç§»å’Œæ¢å¤"><a href="#4ã€æ•…éšœè½¬ç§»å’Œæ¢å¤" class="headerlink" title="4ã€æ•…éšœè½¬ç§»å’Œæ¢å¤"></a>4ã€æ•…éšœè½¬ç§»å’Œæ¢å¤</h4><p><strong>è½¬ç§»æ–¹å¼åŠæ¢å¤æ–¹æ³•</strong></p><pre><code>1. è™šæ‹ŸIPæˆ–DNSæœåŠ¡ ï¼ˆKeepalived +VIP/DNS  å’Œ MMM æ¶æ„ï¼‰</code></pre><p>â€‹é—®é¢˜ï¼šåœ¨è™šæ‹Ÿ IP è¿ç»´è¿‡ç¨‹ä¸­ï¼Œåˆ·æ–°ARPè¿‡ç¨‹ä¸­æœ‰æ—¶ä¼šå‡ºç°ä¸€ä¸ª VIP ç»‘å®šåœ¨å¤šå°æœåŠ¡å™¨åŒæ—¶æä¾›è¿æ¥çš„é—®é¢˜ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¦é¿å…ä½¿ç”¨ Keepalived+VIP å’Œ MMM æ¶æ„çš„åŸå› ä¹‹ä¸€ï¼Œå› ä¸ºå®ƒå¤„ç†ä¸äº†è¿™ç±»é—®é¢˜è€Œå¯¼è‡´é›†ç¾¤å¤šç‚¹å†™å…¥ã€‚</p><pre><code>2. æå‡å¤‡åº“ä¸ºä¸»åº“ï¼ˆMHAã€QMHAï¼‰</code></pre><p>â€‹å°è¯•å°†åŸ Master è®¾ç½® read_only ä¸º onï¼Œé¿å…é›†ç¾¤å¤šç‚¹å†™å…¥ã€‚å€ŸåŠ© binlog server ä¿ç•™ Master çš„ Binlogï¼›å½“å‡ºç°æ•°æ®å»¶è¿Ÿæ—¶ï¼Œå†æå‡ Slave ä¸ºæ–° Master ä¹‹å‰éœ€è¦è¿›è¡Œæ•°æ®è¡¥é½ï¼Œå¦åˆ™ä¼šä¸¢å¤±æ•°æ®ã€‚</p><h3 id="é¢è¯•é¢˜-1"><a href="#é¢è¯•é¢˜-1" class="headerlink" title="é¢è¯•é¢˜"></a>é¢è¯•é¢˜</h3><h4 id="åˆ†åº“åˆ†è¡¨"><a href="#åˆ†åº“åˆ†è¡¨" class="headerlink" title="åˆ†åº“åˆ†è¡¨"></a>åˆ†åº“åˆ†è¡¨</h4><h5 id="å¦‚ä½•è¿›è¡Œåˆ†åº“åˆ†è¡¨"><a href="#å¦‚ä½•è¿›è¡Œåˆ†åº“åˆ†è¡¨" class="headerlink" title="å¦‚ä½•è¿›è¡Œåˆ†åº“åˆ†è¡¨"></a>å¦‚ä½•è¿›è¡Œåˆ†åº“åˆ†è¡¨</h5><blockquote><p><strong>åˆ†è¡¨</strong>ç”¨æˆ·idè¿›è¡Œåˆ†è¡¨ï¼Œæ¯ä¸ªè¡¨æ§åˆ¶åœ¨300ä¸‡æ•°æ®ã€‚</p><p><strong>åˆ†åº“</strong>æ ¹æ®ä¸šåŠ¡åœºæ™¯å’Œåœ°åŸŸåˆ†åº“ï¼Œæ¯ä¸ªåº“å¹¶å‘ä¸è¶…è¿‡2000</p></blockquote><p><strong>Sharding-jdbc</strong> è¿™ç§ client å±‚æ–¹æ¡ˆçš„<strong>ä¼˜ç‚¹åœ¨äºä¸ç”¨éƒ¨ç½²ï¼Œè¿ç»´æˆæœ¬ä½ï¼Œä¸éœ€è¦ä»£ç†å±‚çš„äºŒæ¬¡è½¬å‘è¯·æ±‚ï¼Œæ€§èƒ½å¾ˆé«˜</strong>ï¼Œä½†æ˜¯å„ä¸ªç³»ç»Ÿéƒ½éœ€è¦<strong>è€¦åˆ</strong> Sharding-jdbc çš„ä¾èµ–ï¼Œå‡çº§æ¯”è¾ƒéº»çƒ¦</p><p><strong>Mycat</strong> è¿™ç§ proxy å±‚æ–¹æ¡ˆçš„<strong>ç¼ºç‚¹åœ¨äºéœ€è¦éƒ¨ç½²</strong>ï¼Œè‡ªå·±è¿ç»´ä¸€å¥—ä¸­é—´ä»¶ï¼Œè¿ç»´æˆæœ¬é«˜ï¼Œä½†æ˜¯<strong>å¥½å¤„åœ¨äºå¯¹äºå„ä¸ªé¡¹ç›®æ˜¯é€æ˜çš„</strong>ï¼Œå¦‚æœé‡åˆ°å‡çº§ä¹‹ç±»çš„éƒ½æ˜¯è‡ªå·±ä¸­é—´ä»¶é‚£é‡Œæå°±è¡Œäº†</p><p><strong>æ°´å¹³æ‹†åˆ†</strong>ï¼šä¸€ä¸ªè¡¨æ”¾åˆ°å¤šä¸ªåº“ï¼Œåˆ†æ‹…é«˜å¹¶å‘ï¼ŒåŠ å¿«æŸ¥è¯¢é€Ÿåº¦</p><ul><li><strong>id</strong>ä¿è¯ä¸šåŠ¡åœ¨å…³è”å¤šå¼ è¡¨æ—¶å¯ä»¥åœ¨åŒä¸€åº“ä¸Šæ“ä½œ</li><li><strong>range</strong>æ–¹ä¾¿æ‰©å®¹å’Œæ•°æ®ç»Ÿè®¡</li><li><strong>hash</strong>å¯ä»¥ä½¿å¾—æ•°æ®æ›´åŠ å¹³å‡</li></ul><p><strong>å‚ç›´æ‹†åˆ†</strong>ï¼šä¸€ä¸ªè¡¨æ‹†æˆå¤šä¸ªè¡¨ï¼Œå¯ä»¥å°†ä¸€äº›å†·æ•°æ®æ‹†åˆ†åˆ°å†—ä½™åº“ä¸­</p><blockquote><p>ä¸æ˜¯å†™ç“¶é¢ˆä¼˜å…ˆè¿›è¡Œåˆ†è¡¨</p></blockquote><ul><li><p>åˆ†åº“æ•°æ®é—´çš„æ•°æ®æ— æ³•å†é€šè¿‡æ•°æ®åº“ç›´æ¥æŸ¥è¯¢äº†ã€‚ä¼šäº§ç”Ÿæ·±åˆ†é¡µçš„é—®é¢˜</p></li><li><p>åˆ†åº“è¶Šå¤šï¼Œå‡ºç°é—®é¢˜çš„å¯èƒ½æ€§è¶Šå¤§ï¼Œç»´æŠ¤æˆæœ¬ä¹Ÿå˜å¾—æ›´é«˜ã€‚</p></li><li><p>åˆ†åº“åæ— æ³•ä¿éšœè·¨åº“é—´äº‹åŠ¡ï¼Œåªèƒ½å€ŸåŠ©å…¶ä»–ä¸­é—´ä»¶å®ç°æœ€ç»ˆä¸€è‡´æ€§ã€‚</p></li></ul><p>åˆ†åº“é¦–å…ˆéœ€è€ƒè™‘æ»¡è¶³ä¸šåŠ¡æœ€æ ¸å¿ƒçš„åœºæ™¯ï¼š</p><p>1ã€è®¢å•æ•°æ®æŒ‰<strong>ç”¨æˆ·</strong>åˆ†åº“ï¼Œå¯ä»¥<strong>æå‡ç”¨æˆ·çš„å…¨æµç¨‹ä½“éªŒ</strong></p><p>2ã€è¶…çº§å®¢æˆ·å¯¼è‡´<strong>æ•°æ®å€¾æ–œ</strong>å¯ä»¥ä½¿ç”¨æœ€ç»†ç²’åº¦å”¯ä¸€æ ‡è¯†è¿›è¡Œhashæ‹†åˆ†</p><p>3ã€æŒ‰ç…§æœ€ç»†ç²’åº¦å¦‚è®¢å•å·æ‹†åˆ†ä»¥åï¼Œæ•°æ®åº“å°±æ— æ³•è¿›è¡Œå•åº“æ’é‡äº†</p><p>ä¸‰ä¸ªé—®é¢˜ï¼š</p><ul><li><p>å¯ŒæŸ¥è¯¢ï¼šé‡‡ç”¨åˆ†åº“åˆ†è¡¨ä¹‹åï¼Œå¦‚ä½•æ»¡è¶³è·¨è¶Šåˆ†åº“çš„æŸ¥è¯¢ï¼Ÿ<strong>ä½¿ç”¨ES</strong>çš„å®½è¡¨</p><p>å€ŸåŠ©<strong>åˆ†åº“ç½‘å…³+åˆ†åº“ä¸šåŠ¡</strong>è™½ç„¶èƒ½å¤Ÿå®ç°<strong>å¤šç»´åº¦æŸ¥è¯¢çš„èƒ½åŠ›</strong>ï¼Œä½†æ•´ä½“ä¸Šæ€§èƒ½ä¸ä½³ä¸”å¯¹æ­£å¸¸çš„å†™å…¥è¯·æ±‚æœ‰ä¸€å®šçš„å½±å“ã€‚ä¸šç•Œåº”å¯¹<strong>å¤šç»´åº¦å®æ—¶æŸ¥è¯¢</strong>çš„æœ€å¸¸è§æ–¹å¼ä¾¿æ˜¯å€ŸåŠ© <strong>ElasticSearch</strong></p></li><li><p>æ•°æ®å€¾æ–œï¼šæ•°æ®åˆ†åº“åŸºç¡€ä¸Šå†è¿›è¡Œåˆ†è¡¨</p></li><li><p>åˆ†å¸ƒå¼äº‹åŠ¡ï¼šè·¨å¤šåº“çš„ä¿®æ”¹åŠå¤šä¸ªå¾®æœåŠ¡é—´çš„å†™æ“ä½œå¯¼è‡´çš„åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ï¼Ÿ</p></li><li><p>æ·±åˆ†é¡µé—®é¢˜ï¼šæŒ‰æ¸¸æ ‡æŸ¥è¯¢ï¼Œæˆ–è€…å«æ¯æ¬¡æŸ¥è¯¢éƒ½å¸¦ä¸Šä¸Šä¸€æ¬¡æŸ¥è¯¢ç»è¿‡æ’åºåçš„æœ€å¤§ ID</p></li></ul><h4 id="å¦‚ä½•å°†è€æ•°æ®è¿›è¡Œè¿ç§»"><a href="#å¦‚ä½•å°†è€æ•°æ®è¿›è¡Œè¿ç§»" class="headerlink" title="å¦‚ä½•å°†è€æ•°æ®è¿›è¡Œè¿ç§»"></a>å¦‚ä½•å°†è€æ•°æ®è¿›è¡Œè¿ç§»</h4><p><strong>åŒå†™ä¸ä¸­æ–­è¿ç§»</strong></p><ul><li>çº¿ä¸Šç³»ç»Ÿé‡Œæ‰€æœ‰å†™åº“çš„åœ°æ–¹ï¼Œå¢åˆ æ”¹æ“ä½œï¼Œ<strong>é™¤äº†å¯¹è€åº“å¢åˆ æ”¹ï¼Œéƒ½åŠ ä¸Šå¯¹æ–°åº“çš„å¢åˆ æ”¹</strong></li><li>ç³»ç»Ÿéƒ¨ç½²ä»¥åï¼Œè¿˜éœ€è¦è·‘ç¨‹åºè¯»è€åº“æ•°æ®å†™æ–°åº“ï¼Œå†™çš„æ—¶å€™éœ€è¦åˆ¤æ–­updateTime</li><li>å¾ªç¯æ‰§è¡Œï¼Œç›´è‡³ä¸¤ä¸ªåº“çš„æ•°æ®å®Œå…¨ä¸€è‡´ï¼Œæœ€åé‡æ–°éƒ¨ç½²åˆ†åº“åˆ†è¡¨çš„ä»£ç å°±è¡Œäº†</li></ul><h4 id="ç³»ç»Ÿæ€§èƒ½çš„è¯„ä¼°åŠæ‰©å®¹"><a href="#ç³»ç»Ÿæ€§èƒ½çš„è¯„ä¼°åŠæ‰©å®¹" class="headerlink" title="ç³»ç»Ÿæ€§èƒ½çš„è¯„ä¼°åŠæ‰©å®¹"></a>ç³»ç»Ÿæ€§èƒ½çš„è¯„ä¼°åŠæ‰©å®¹</h4><p>å’Œå®¶äº²ç›®å‰æœ‰1äº¿ç”¨æˆ·ï¼šåœºæ™¯ 10ä¸‡å†™å¹¶å‘ï¼Œ100ä¸‡è¯»å¹¶å‘ï¼Œ60äº¿æ•°æ®é‡</p><p>è®¾è®¡æ—¶è€ƒè™‘æé™æƒ…å†µï¼Œ32åº“*32è¡¨~64ä¸ªè¡¨ï¼Œä¸€å…±1000 ~ 2000å¼ è¡¨</p><ul><li><p>æ”¯æŒ<strong>3ä¸‡</strong>çš„å†™å¹¶å‘ï¼Œé…åˆMQå®ç°æ¯ç§’10ä¸‡çš„å†™å…¥é€Ÿåº¦</p></li><li><p>è¯»å†™åˆ†ç¦»<strong>6ä¸‡</strong>è¯»å¹¶å‘ï¼Œé…åˆåˆ†å¸ƒå¼ç¼“å­˜æ¯ç§’100è¯»å¹¶å‘</p></li><li><p>2000å¼ è¡¨æ¯å¼ 300ä¸‡ï¼Œå¯ä»¥æœ€å¤šå†™å…¥60äº¿çš„æ•°æ®</p></li><li><p>32å¼ ç”¨æˆ·è¡¨ï¼Œæ”¯æ’‘äº¿çº§ç”¨æˆ·ï¼Œåç»­æœ€å¤šä¹Ÿå°±æ‰©å®¹ä¸€æ¬¡</p></li></ul><p><strong>åŠ¨æ€æ‰©å®¹çš„æ­¥éª¤</strong></p><ol><li>æ¨èæ˜¯ 32 åº“ * 32 è¡¨ï¼Œå¯¹äºæˆ‘ä»¬å…¬å¸æ¥è¯´ï¼Œå¯èƒ½å‡ å¹´éƒ½å¤Ÿäº†ã€‚</li><li>é…ç½®è·¯ç”±çš„è§„åˆ™ï¼Œuid % 32 &#x3D; åº“ï¼Œuid &#x2F; 32 % 32 &#x3D; è¡¨</li><li>æ‰©å®¹çš„æ—¶å€™ï¼Œç”³è¯·å¢åŠ æ›´å¤šçš„æ•°æ®åº“æœåŠ¡å™¨ï¼Œå‘ˆå€æ•°æ‰©å®¹</li><li>ç”± DBA è´Ÿè´£å°†åŸå…ˆæ•°æ®åº“æœåŠ¡å™¨çš„åº“ï¼Œè¿ç§»åˆ°æ–°çš„æ•°æ®åº“æœåŠ¡å™¨ä¸Šå»</li><li>ä¿®æ”¹ä¸€ä¸‹é…ç½®ï¼Œé‡æ–°å‘å¸ƒç³»ç»Ÿï¼Œä¸Šçº¿ï¼ŒåŸå…ˆçš„è·¯ç”±è§„åˆ™å˜éƒ½ä¸ç”¨å˜</li><li>ç›´æ¥å¯ä»¥åŸºäº n å€çš„æ•°æ®åº“æœåŠ¡å™¨çš„èµ„æºï¼Œç»§ç»­è¿›è¡Œçº¿ä¸Šç³»ç»Ÿçš„æä¾›æœåŠ¡ã€‚</li></ol><h4 id="å¦‚ä½•ç”Ÿæˆè‡ªå¢çš„idä¸»é”®"><a href="#å¦‚ä½•ç”Ÿæˆè‡ªå¢çš„idä¸»é”®" class="headerlink" title="å¦‚ä½•ç”Ÿæˆè‡ªå¢çš„idä¸»é”®"></a>å¦‚ä½•ç”Ÿæˆè‡ªå¢çš„idä¸»é”®</h4><ul><li>ä½¿ç”¨rediså¯ä»¥</li><li>å¹¶å‘ä¸é«˜å¯ä»¥å•ç‹¬èµ·ä¸€ä¸ª<strong>æœåŠ¡</strong>ï¼Œç”Ÿæˆè‡ªå¢id</li><li>è®¾ç½®æ•°æ®åº“<strong>step</strong>è‡ªå¢æ­¥é•¿å¯ä»¥æ”¯æ’‘æ°´å¹³ä¼¸ç¼©</li><li>UUIDé€‚åˆæ–‡ä»¶åã€ç¼–å·ï¼Œä½†æ˜¯<strong>ä¸é€‚åˆåšä¸»é”®</strong></li><li><strong>snowflakeé›ªèŠ±ç®—æ³•</strong>ï¼Œç»¼åˆäº†<strong>41æ—¶é—´</strong>ï¼ˆmsï¼‰ã€<strong>10æœºå™¨</strong>ã€<strong>12åºåˆ—å·</strong>ï¼ˆmså†…è‡ªå¢ï¼‰</li></ul><p>å…¶ä¸­æœºå™¨é¢„ç•™çš„10bitå¯ä»¥æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡åœºæ™¯é…ç½®</p><h3 id="çº¿ä¸Šæ•…éšœåŠä¼˜åŒ–"><a href="#çº¿ä¸Šæ•…éšœåŠä¼˜åŒ–" class="headerlink" title="çº¿ä¸Šæ•…éšœåŠä¼˜åŒ–"></a>çº¿ä¸Šæ•…éšœåŠä¼˜åŒ–</h3><h4 id="æ›´æ–°å¤±è´¥-ä¸»ä»åŒæ­¥å»¶æ—¶"><a href="#æ›´æ–°å¤±è´¥-ä¸»ä»åŒæ­¥å»¶æ—¶" class="headerlink" title="æ›´æ–°å¤±è´¥ | ä¸»ä»åŒæ­¥å»¶æ—¶"></a>æ›´æ–°å¤±è´¥ | ä¸»ä»åŒæ­¥å»¶æ—¶</h4><p>ä»¥å‰çº¿ä¸Šç¡®å®å¤„ç†è¿‡å› ä¸ºä¸»ä»åŒæ­¥å»¶æ—¶é—®é¢˜è€Œå¯¼è‡´çš„çº¿ä¸Šçš„ bugï¼Œå±äºå°å‹çš„ç”Ÿäº§äº‹æ•…ã€‚</p><p>æ˜¯è¿™ä¸ªä¹ˆåœºæ™¯ã€‚æœ‰ä¸ªåŒå­¦æ˜¯è¿™æ ·å†™ä»£ç é€»è¾‘çš„ã€‚å…ˆæ’å…¥ä¸€æ¡æ•°æ®ï¼Œå†æŠŠå®ƒæŸ¥å‡ºæ¥ï¼Œç„¶åæ›´æ–°è¿™æ¡æ•°æ®ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒé«˜å³°æœŸï¼Œå†™å¹¶å‘è¾¾åˆ°äº† 2000&#x2F;sï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä¸»ä»å¤åˆ¶å»¶æ—¶å¤§æ¦‚æ˜¯åœ¨å°å‡ åæ¯«ç§’ã€‚çº¿ä¸Šä¼šå‘ç°ï¼Œæ¯å¤©æ€»æœ‰é‚£ä¹ˆä¸€äº›æ•°æ®ï¼Œæˆ‘ä»¬æœŸæœ›æ›´æ–°ä¸€äº›é‡è¦çš„æ•°æ®çŠ¶æ€ï¼Œä½†åœ¨é«˜å³°æœŸæ—¶å€™å´æ²¡æ›´æ–°ã€‚ç”¨æˆ·è·Ÿå®¢æœåé¦ˆï¼Œè€Œå®¢æœå°±ä¼šåé¦ˆç»™æˆ‘ä»¬ã€‚</p><p>æˆ‘ä»¬é€šè¿‡ MySQL å‘½ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show slave status</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ <code>Seconds_Behind_Master</code> ï¼Œå¯ä»¥çœ‹åˆ°ä»åº“å¤åˆ¶ä¸»åº“çš„æ•°æ®è½åäº†å‡  msã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä¸»ä»å»¶è¿Ÿè¾ƒä¸ºä¸¥é‡ï¼Œæœ‰ä»¥ä¸‹è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>åˆ†åº“ï¼Œæ‹†åˆ†ä¸ºå¤šä¸ªä¸»åº“ï¼Œæ¯ä¸ªä¸»åº“çš„å†™å¹¶å‘å°±å‡å°‘äº†å‡ å€ï¼Œä¸»ä»å»¶è¿Ÿå¯ä»¥å¿½ç•¥ä¸è®¡ã€‚</li><li>é‡å†™ä»£ç ï¼Œå†™ä»£ç çš„åŒå­¦ï¼Œè¦æ…é‡ï¼Œæ’å…¥æ•°æ®æ—¶ç«‹é©¬æŸ¥è¯¢å¯èƒ½æŸ¥ä¸åˆ°ã€‚</li><li>å¦‚æœç¡®å®æ˜¯å­˜åœ¨å¿…é¡»å…ˆæ’å…¥ï¼Œç«‹é©¬è¦æ±‚å°±æŸ¥è¯¢åˆ°ï¼Œç„¶åç«‹é©¬å°±è¦åè¿‡æ¥æ‰§è¡Œä¸€äº›æ“ä½œï¼Œå¯¹è¿™ä¸ªæŸ¥è¯¢<strong>è®¾ç½®ç›´è¿ä¸»åº“</strong>æˆ–è€…<strong>å»¶è¿ŸæŸ¥è¯¢</strong>ã€‚ä¸»ä»å¤åˆ¶å»¶è¿Ÿä¸€èˆ¬ä¸ä¼šè¶…è¿‡50ms</li></ul><h4 id="åº”ç”¨å´©æºƒ-åˆ†åº“åˆ†è¡¨ä¼˜åŒ–"><a href="#åº”ç”¨å´©æºƒ-åˆ†åº“åˆ†è¡¨ä¼˜åŒ–" class="headerlink" title="åº”ç”¨å´©æºƒ | åˆ†åº“åˆ†è¡¨ä¼˜åŒ–"></a><strong>åº”ç”¨å´©æºƒ | åˆ†åº“åˆ†è¡¨ä¼˜åŒ–</strong></h4><p>â€‹æˆ‘ä»¬æœ‰ä¸€ä¸ªçº¿ä¸Šé€šè¡Œè®°å½•çš„è¡¨ï¼Œç”±äºæ•°æ®é‡è¿‡å¤§ï¼Œè¿›è¡Œäº†åˆ†åº“åˆ†è¡¨ï¼Œå½“æ—¶åˆ†åº“åˆ†è¡¨åˆæœŸç»å¸¸äº§ç”Ÿä¸€äº›é—®é¢˜ã€‚å…¸å‹çš„å°±æ˜¯é€šè¡Œè®°å½•æŸ¥è¯¢ä¸­ä½¿ç”¨äº†æ·±åˆ†é¡µï¼Œé€šè¿‡ä¸€äº›å·¥å…·å¦‚MATã€Jstackè¿½è¸ªåˆ°æ˜¯ç”±äºsharding-jdbcå†…éƒ¨å¼•ç”¨é€ æˆçš„ã€‚</p><p>â€‹é€šè¡Œè®°å½•æ•°æ®è¢«å­˜æ”¾åœ¨ä¸¤ä¸ªåº“ä¸­ã€‚å¦‚æœæ²¡æœ‰æä¾›<strong>åˆ‡åˆ†é”®</strong>ï¼ŒæŸ¥è¯¢è¯­å¥å°±ä¼šè¢«åˆ†å‘åˆ°æ‰€æœ‰çš„æ•°æ®åº“ä¸­ï¼Œæ¯”å¦‚æŸ¥è¯¢è¯­å¥æ˜¯ limit 10ã€offset 1000ï¼Œæœ€ç»ˆç»“æœåªéœ€è¦è¿”å› 10 æ¡è®°å½•ï¼Œä½†æ˜¯æ•°æ®åº“ä¸­é—´ä»¶è¦å®Œæˆè¿™ç§è®¡ç®—ï¼Œåˆ™éœ€è¦ (1000+10)*2&#x3D;2020 æ¡è®°å½•æ¥å®Œæˆè¿™ä¸ªè®¡ç®—è¿‡ç¨‹ã€‚å¦‚æœ offset çš„å€¼è¿‡å¤§ï¼Œä½¿ç”¨çš„å†…å­˜å°±ä¼šæš´æ¶¨ã€‚è™½ç„¶ sharding-jdbc ä½¿ç”¨å½’å¹¶ç®—æ³•è¿›è¡Œäº†ä¸€äº›ä¼˜åŒ–ï¼Œä½†åœ¨å®é™…åœºæ™¯ä¸­ï¼Œæ·±åˆ†é¡µä»ç„¶å¼•èµ·äº†<strong>å†…å­˜å’Œæ€§èƒ½</strong>é—®é¢˜ã€‚</p><p>â€‹è¿™ç§åœ¨ä¸­é—´èŠ‚ç‚¹è¿›è¡Œ<strong>å½’å¹¶èšåˆ</strong>çš„æ“ä½œï¼Œåœ¨åˆ†å¸ƒå¼æ¡†æ¶ä¸­éå¸¸å¸¸è§ã€‚æ¯”å¦‚åœ¨ ElasticSearch ä¸­ï¼Œå°±å­˜åœ¨ç›¸ä¼¼çš„æ•°æ®è·å–é€»è¾‘ï¼Œ<strong>ä¸åŠ é™åˆ¶çš„æ·±åˆ†é¡µ</strong>ï¼ŒåŒæ ·ä¼šé€ æˆ ES çš„å†…å­˜é—®é¢˜ã€‚</p><p><strong>ä¸šç•Œè§£å†³æ–¹æ¡ˆï¼š</strong></p><p><strong>æ–¹æ³•ä¸€ï¼šå…¨å±€è§†é‡æ³•</strong></p><p>ï¼ˆ1ï¼‰å°†order by time offset X limit Yï¼Œæ”¹å†™æˆorder by time offset 0 limit X+Y</p><p>ï¼ˆ2ï¼‰æœåŠ¡å±‚å¯¹å¾—åˆ°çš„N*(X+Y)æ¡æ•°æ®è¿›è¡Œå†…å­˜æ’åºï¼Œå†…å­˜æ’åºåå†å–åç§»é‡Xåçš„Yæ¡è®°å½•</p><p>è¿™ç§æ–¹æ³•éšç€ç¿»é¡µçš„è¿›è¡Œï¼Œæ€§èƒ½è¶Šæ¥è¶Šä½ã€‚</p><p><strong>æ–¹æ³•äºŒï¼šä¸šåŠ¡æŠ˜è¡·æ³•-ç¦æ­¢è·³é¡µæŸ¥è¯¢</strong></p><p>ï¼ˆ1ï¼‰ç”¨æ­£å¸¸çš„æ–¹æ³•å–å¾—ç¬¬ä¸€é¡µæ•°æ®ï¼Œå¹¶å¾—åˆ°ç¬¬ä¸€é¡µè®°å½•çš„time_max</p><p>ï¼ˆ2ï¼‰æ¯æ¬¡ç¿»é¡µï¼Œå°†order by time offset X limit Yï¼Œæ”¹å†™æˆorder by time where time&gt;$time_max limit Y</p><p>ä»¥ä¿è¯æ¯æ¬¡åªè¿”å›ä¸€é¡µæ•°æ®ï¼Œæ€§èƒ½ä¸ºå¸¸é‡ã€‚</p><p><strong>æ–¹æ³•ä¸‰ï¼šä¸šåŠ¡æŠ˜è¡·æ³•-å…è®¸æ¨¡ç³Šæ•°æ®</strong></p><p>ï¼ˆ1ï¼‰å°†order by time offset X limit Yï¼Œæ”¹å†™æˆorder by time offset X&#x2F;N limit Y&#x2F;N</p><p><strong>æ–¹æ³•å››ï¼šäºŒæ¬¡æŸ¥è¯¢æ³•</strong></p><p>ï¼ˆ1ï¼‰å°†order by time offset X limit Yï¼Œæ”¹å†™æˆorder by time offset X&#x2F;N limit Y</p><p>ï¼ˆ2ï¼‰æ‰¾åˆ°æœ€å°å€¼time_min</p><p>ï¼ˆ3ï¼‰betweenäºŒæ¬¡æŸ¥è¯¢ï¼Œorder by time between $time_min and $time_i_max</p><p>ï¼ˆ4ï¼‰è®¾ç½®è™šæ‹Ÿtime_minï¼Œæ‰¾åˆ°time_minåœ¨å„ä¸ªåˆ†åº“çš„offsetï¼Œä»è€Œå¾—åˆ°time_minåœ¨å…¨å±€çš„offset</p><p>ï¼ˆ5ï¼‰å¾—åˆ°äº†time_minåœ¨å…¨å±€çš„offsetï¼Œè‡ªç„¶å¾—åˆ°äº†å…¨å±€çš„offset X limit Y</p><h4 id="æŸ¥è¯¢å¼‚å¸¸-SQL-è°ƒä¼˜"><a href="#æŸ¥è¯¢å¼‚å¸¸-SQL-è°ƒä¼˜" class="headerlink" title="æŸ¥è¯¢å¼‚å¸¸ | SQL è°ƒä¼˜"></a>æŸ¥è¯¢å¼‚å¸¸ | SQL è°ƒä¼˜</h4><p>åˆ†åº“åˆ†è¡¨å‰ï¼Œæœ‰ä¸€æ®µç”¨ç”¨æˆ·åæ¥æŸ¥è¯¢æŸä¸ªç”¨æˆ·çš„ SQL è¯­å¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selectÂ *Â <span class="keyword">from</span>Â userÂ whereÂ nameÂ =Â <span class="string">&quot;xxx&quot;</span>Â <span class="keyword">and</span>Â community=<span class="string">&quot;other&quot;</span>;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†è¾¾åˆ°åŠ¨æ€æ‹¼æ¥çš„æ•ˆæœï¼Œè¿™å¥ SQL è¯­å¥è¢«ä¸€ä½åŒäº‹è¿›è¡Œäº†å¦‚ä¸‹ä¿®æ”¹ã€‚ä»–çš„æœ¬æ„æ˜¯ï¼Œå½“ name æˆ–è€… community ä¼ å…¥ä¸ºç©ºçš„æ—¶å€™ï¼ŒåŠ¨æ€å»æ‰è¿™äº›æŸ¥è¯¢æ¡ä»¶ã€‚è¿™ç§å†™æ³•ï¼Œåœ¨ MyBaits çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œä¹Ÿéå¸¸å¸¸è§ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™ç§å†™æ³•æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºç»“æœé›†åˆæ˜¯å¯ä»¥æ§åˆ¶çš„ã€‚ä½†éšç€ç³»ç»Ÿçš„è¿è¡Œï¼Œç”¨æˆ·è¡¨çš„è®°å½•è¶Šæ¥è¶Šå¤šï¼Œå½“ä¼ å…¥çš„ name å’Œ community å…¨éƒ¨ä¸ºç©ºæ—¶ï¼Œæ‚²å‰§çš„äº‹æƒ…å‘ç”Ÿäº†:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selectÂ *Â fromÂ userÂ whereÂ 1=1</span><br></pre></td></tr></table></figure><p>æ•°æ®åº“ä¸­çš„æ‰€æœ‰è®°å½•ï¼Œéƒ½ä¼šè¢«æŸ¥è¯¢å‡ºæ¥ï¼Œè½½å…¥åˆ° JVM çš„å†…å­˜ä¸­ã€‚ç”±äºæ•°æ®åº“è®°å½•å®åœ¨å¤ªå¤šï¼Œç›´æ¥æŠŠå†…å­˜ç»™æ’‘çˆ†äº†ã€‚ç”±äºè¿™ç§åŸå› å¼•èµ·çš„å†…å­˜æº¢å‡ºï¼Œå‘ç”Ÿçš„é¢‘ç‡éå¸¸é«˜ï¼Œæ¯”å¦‚å¯¼å…¥Excelæ–‡ä»¶æ—¶ã€‚</p><p>é€šå¸¸çš„è§£å†³æ–¹å¼æ˜¯<strong>å¼ºè¡ŒåŠ å…¥åˆ†é¡µåŠŸèƒ½</strong>ï¼Œæˆ–è€…å¯¹ä¸€äº›<strong>å¿…å¡«çš„å‚æ•°è¿›è¡Œæ ¡éªŒ</strong></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gobovqjvijj30zd0lctbp.jpg" alt="img"></p><p><strong>Controller å±‚</strong></p><p>ç°åœ¨å¾ˆå¤šé¡¹ç›®éƒ½é‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œæ‰€ä»¥ Controller å±‚çš„æ–¹æ³•ï¼Œä¸€èˆ¬ä½¿ç”¨ @ResponseBody æ³¨è§£ï¼ŒæŠŠæŸ¥è¯¢çš„ç»“æœï¼Œè§£ææˆ JSON æ•°æ®è¿”å›ã€‚è¿™åœ¨æ•°æ®é›†éå¸¸å¤§çš„æƒ…å†µä¸‹ï¼Œä¼šå ç”¨å¾ˆå¤šå†…å­˜èµ„æºã€‚å‡å¦‚ç»“æœé›†åœ¨è§£ææˆ JSON ä¹‹å‰ï¼Œå ç”¨çš„å†…å­˜æ˜¯ 10MBï¼Œé‚£ä¹ˆåœ¨è§£æè¿‡ç¨‹ä¸­ï¼Œæœ‰å¯èƒ½ä¼šä½¿ç”¨ 20M æˆ–è€…æ›´å¤šçš„å†…å­˜</p><p>å› æ­¤ï¼Œä¿æŒç»“æœé›†çš„ç²¾ç®€ï¼Œæ˜¯éå¸¸æœ‰å¿…è¦çš„ï¼Œè¿™ä¹Ÿæ˜¯ DTOï¼ˆData Transfer Objectï¼‰å­˜åœ¨çš„å¿…è¦ã€‚äº’è”ç½‘ç¯å¢ƒä¸æ€•å°ç»“æœé›†çš„é«˜å¹¶å‘è¯·æ±‚ï¼Œå´éå¸¸ææƒ§å¤§ç»“æœé›†çš„è€—æ—¶è¯·æ±‚ï¼Œè¿™æ˜¯å…¶ä¸­ä¸€æ–¹é¢çš„åŸå› ã€‚</p><p><strong>Service å±‚</strong></p><p>Service å±‚ç”¨äºå¤„ç†å…·ä½“çš„ä¸šåŠ¡ï¼Œæ›´åŠ è´´åˆä¸šåŠ¡çš„åŠŸèƒ½éœ€æ±‚ã€‚ä¸€ä¸ª Serviceï¼Œå¯èƒ½ä¼šè¢«å¤šä¸ª Controller å±‚æ‰€ä½¿ç”¨ï¼Œä¹Ÿå¯èƒ½ä¼šä½¿ç”¨å¤šä¸ª dao ç»“æ„çš„æŸ¥è¯¢ç»“æœè¿›è¡Œè®¡ç®—ã€æ‹¼è£…ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>Â <span class="title function_">getUserSize</span><span class="params">()</span>Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â List&lt;User&gt;Â usersÂ =Â dao.getAllUser();</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">return</span>Â <span class="literal">null</span>Â ==Â usersÂ ?Â <span class="number">0</span>Â :Â users.size();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç reviewä¸­å‘ç°äº†å®šæ—¶ç‚¸å¼¹ï¼Œè¿™ç§åœ¨æ•°æ®é‡è¾¾åˆ°ä¸€å®šç¨‹åº¦åï¼Œæ‰ä¼šæš´éœ²é—®é¢˜ã€‚</p><p><strong>ORM å±‚</strong></p><p>æ¯”å¦‚ä½¿ç”¨Mybatisæ—¶ï¼Œæœ‰ä¸€ä¸ªæ‰¹é‡å¯¼å…¥æœåŠ¡ï¼Œåœ¨ MyBatis æ‰§è¡Œæ‰¹é‡æ’å…¥çš„æ—¶å€™ï¼Œç«Ÿç„¶äº§ç”Ÿäº†å†…å­˜æº¢å‡ºï¼ŒæŒ‰é“ç†è¿™ç§æ’å…¥æ“ä½œæ˜¯ä¸ä¼šå¼•èµ·é¢å¤–å†…å­˜å ç”¨çš„ï¼Œæœ€åé€šè¿‡æºç è¿½è¸ªåˆ°äº†é—®é¢˜ã€‚</p><p>è¿™æ˜¯å› ä¸º MyBatis å¾ªç¯å¤„ç† batch çš„æ—¶å€™ï¼Œæ“ä½œå¯¹è±¡æ˜¯æ•°ç»„ï¼Œè€Œæˆ‘ä»¬åœ¨æ¥å£å®šä¹‰çš„æ—¶å€™ï¼Œä½¿ç”¨çš„æ˜¯ Listï¼›å½“ä¼ å…¥ä¸€ä¸ªéå¸¸å¤§çš„ List æ—¶ï¼Œå®ƒéœ€è¦è°ƒç”¨ List çš„ toArray æ–¹æ³•å°†åˆ—è¡¨è½¬æ¢æˆæ•°ç»„ï¼ˆæµ…æ‹·è´ï¼‰ï¼›åœ¨æœ€åçš„æ‹¼è£…é˜¶æ®µï¼Œåˆä½¿ç”¨äº† StringBuilder æ¥æ‹¼æ¥æœ€ç»ˆçš„ SQLï¼Œæ‰€ä»¥å®é™…ä½¿ç”¨çš„å†…å­˜è¦æ¯” List å¤šå¾ˆå¤šã€‚</p><p>äº‹å®è¯æ˜ï¼Œä¸è®ºæ˜¯æ’å…¥æ“ä½œè¿˜æ˜¯æŸ¥è¯¢åŠ¨ä½œï¼Œåªè¦æ¶‰åŠçš„æ•°æ®é›†éå¸¸å¤§ï¼Œå°±å®¹æ˜“å‡ºç°é—®é¢˜ã€‚ç”±äºé¡¹ç›®ä¸­ä¼—å¤šæ¡†æ¶çš„å¼•å…¥ï¼Œæƒ³è¦åˆ†æè¿™äº›å…·ä½“çš„å†…å­˜å ç”¨ï¼Œå°±å˜å¾—éå¸¸å›°éš¾ã€‚æ‰€ä»¥ä¿æŒå°æ‰¹é‡æ“ä½œå’Œç»“æœé›†çš„å¹²å‡€ï¼Œæ˜¯ä¸€ä¸ªéå¸¸å¥½çš„ä¹ æƒ¯ã€‚</p><h1 id="äº”ã€Redisç¯‡"><a href="#äº”ã€Redisç¯‡" class="headerlink" title="äº”ã€Redisç¯‡"></a><strong>äº”ã€Redisç¯‡</strong></h1><h3 id="WhyRedis"><a href="#WhyRedis" class="headerlink" title="WhyRedis"></a>WhyRedis</h3><p>â€‹é€Ÿåº¦å¿«ï¼Œå®Œå…¨åŸºäºå†…å­˜ï¼Œä½¿ç”¨Cè¯­è¨€å®ç°ï¼Œç½‘ç»œå±‚ä½¿ç”¨epollè§£å†³é«˜å¹¶å‘é—®é¢˜ï¼Œå•çº¿ç¨‹æ¨¡å‹é¿å…äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢åŠç«äº‰æ¡ä»¶ï¼›</p><table><thead><tr><th></th><th>GuavaCache</th><th>Tair</th><th>EVCache</th><th>Aerospike</th></tr></thead><tbody><tr><td>ç±»åˆ«</td><td>æœ¬åœ°JVMç¼“å­˜</td><td>åˆ†å¸ƒå¼ç¼“å­˜</td><td>åˆ†å¸ƒå¼ç¼“å­˜</td><td>åˆ†å¸ƒå¼nosqlæ•°æ®åº“</td></tr><tr><td>åº”ç”¨</td><td>æœ¬åœ°ç¼“å­˜</td><td>æ·˜å®</td><td>Netflixã€AWS</td><td>å¹¿å‘Š</td></tr><tr><td>æ€§èƒ½</td><td>éå¸¸é«˜</td><td>è¾ƒé«˜</td><td>å¾ˆé«˜</td><td>è¾ƒé«˜</td></tr><tr><td>æŒä¹…åŒ–</td><td>æ— </td><td>æœ‰</td><td>æœ‰</td><td>æœ‰</td></tr><tr><td>é›†ç¾¤</td><td>æ— </td><td>çµæ´»é…ç½®</td><td>æœ‰</td><td>è‡ªåŠ¨æ‰©å®¹</td></tr></tbody></table><p>â€‹ä¸ä¼ ç»Ÿæ•°æ®åº“ä¸åŒçš„æ˜¯ Redis çš„æ•°æ®æ˜¯å­˜åœ¨å†…å­˜ä¸­çš„ï¼Œæ‰€ä»¥è¯»å†™é€Ÿåº¦éå¸¸å¿«ï¼Œå› æ­¤ redis è¢«å¹¿æ³›åº”ç”¨äºç¼“å­˜æ–¹å‘ï¼Œæ¯ç§’å¯ä»¥å¤„ç†è¶…è¿‡ 10ä¸‡æ¬¡è¯»å†™æ“ä½œï¼Œæ˜¯å·²çŸ¥æ€§èƒ½æœ€å¿«çš„Key-Value DBã€‚å¦å¤–ï¼ŒRedis ä¹Ÿç»å¸¸ç”¨æ¥åšåˆ†å¸ƒå¼é”ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒRedis æ”¯æŒäº‹åŠ¡ ã€æŒä¹…åŒ–ã€LUAè„šæœ¬ã€LRUé©±åŠ¨äº‹ä»¶ã€å¤šç§é›†ç¾¤æ–¹æ¡ˆã€‚</p><h4 id="1ã€ç®€å•é«˜æ•ˆ"><a href="#1ã€ç®€å•é«˜æ•ˆ" class="headerlink" title="1ã€ç®€å•é«˜æ•ˆ"></a>1ã€ç®€å•é«˜æ•ˆ</h4><p>â€‹1ï¼‰å®Œå…¨åŸºäºå†…å­˜ï¼Œç»å¤§éƒ¨åˆ†è¯·æ±‚æ˜¯çº¯ç²¹çš„å†…å­˜æ“ä½œã€‚æ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼Œç±»ä¼¼äº HashMapï¼ŒæŸ¥æ‰¾å’Œæ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1)ï¼›</p><p>â€‹2ï¼‰æ•°æ®ç»“æ„ç®€å•ï¼Œå¯¹æ•°æ®æ“ä½œä¹Ÿç®€å•ï¼ŒRedis ä¸­çš„æ•°æ®ç»“æ„æ˜¯ä¸“é—¨è¿›è¡Œè®¾è®¡çš„ï¼›</p><p>â€‹3ï¼‰é‡‡ç”¨å•çº¿ç¨‹ï¼Œé¿å…äº†å¤šçº¿ç¨‹ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«äº‰æ¡ä»¶ï¼Œä¸å­˜åœ¨åŠ é”é‡Šæ”¾é”æ“ä½œï¼Œå‡å°‘äº†å› ä¸ºé”ç«äº‰å¯¼è‡´çš„æ€§èƒ½æ¶ˆè€—ï¼›ï¼ˆ6.0ä»¥åå¤šçº¿ç¨‹ï¼‰</p><p>â€‹4ï¼‰ä½¿ç”¨EPOLLå¤šè·¯ I&#x2F;O å¤ç”¨æ¨¡å‹ï¼Œéé˜»å¡ IOï¼›</p><p>â€‹5ï¼‰ä½¿ç”¨åº•å±‚æ¨¡å‹ä¸åŒï¼Œå®ƒä»¬ä¹‹é—´åº•å±‚å®ç°æ–¹å¼ä»¥åŠä¸å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡çš„åº”ç”¨åè®®ä¸ä¸€æ ·ï¼ŒRedis ç›´æ¥è‡ªå·±æ„å»ºäº† VM æœºåˆ¶ ï¼Œå› ä¸ºä¸€èˆ¬çš„ç³»ç»Ÿè°ƒç”¨ç³»ç»Ÿå‡½æ•°çš„è¯ï¼Œä¼šæµªè´¹ä¸€å®šçš„æ—¶é—´å»ç§»åŠ¨å’Œè¯·æ±‚ï¼›</p><h4 id="2ã€Memcache"><a href="#2ã€Memcache" class="headerlink" title="2ã€Memcache"></a>2ã€Memcache</h4><table><thead><tr><th>redis</th><th>Memcached</th></tr></thead><tbody><tr><td>å†…å­˜é«˜é€Ÿæ•°æ®åº“</td><td>é«˜æ€§èƒ½åˆ†å¸ƒå¼å†…å­˜ç¼“å­˜æ•°æ®åº“</td></tr><tr><td>æ”¯æŒhashã€listã€setã€zsetã€stringç»“æ„</td><td>åªæ”¯æŒkey-valueç»“æ„</td></tr><tr><td>å°†å¤§éƒ¨åˆ†æ•°æ®æ”¾åˆ°å†…å­˜</td><td>å…¨éƒ¨æ•°æ®æ”¾åˆ°å†…å­˜ä¸­</td></tr><tr><td>æ”¯æŒæŒä¹…åŒ–ã€ä¸»ä»å¤åˆ¶å¤‡ä»½</td><td>ä¸æ”¯æŒæ•°æ®æŒä¹…åŒ–åŠæ•°æ®å¤‡ä»½</td></tr><tr><td>æ•°æ®ä¸¢å¤±å¯é€šè¿‡AOFæ¢å¤</td><td>æŒ‚æ‰åï¼Œæ•°æ®ä¸å¯æ¢å¤</td></tr><tr><td>å•çº¿ç¨‹ï¼ˆ2~4ä¸‡TPSï¼‰</td><td>å¤šçº¿ç¨‹ï¼ˆ20-40ä¸‡TPSï¼‰</td></tr></tbody></table><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p><p>â€‹1ã€å¦‚æœæœ‰æŒä¹…æ–¹é¢çš„éœ€æ±‚æˆ–å¯¹æ•°æ®ç±»å‹å’Œå¤„ç†æœ‰è¦æ±‚çš„åº”è¯¥é€‰æ‹©redisã€‚<br>â€‹2ã€å¦‚æœç®€å•çš„key&#x2F;value å­˜å‚¨åº”è¯¥é€‰æ‹©memcachedã€‚</p><h4 id="3ã€Tair"><a href="#3ã€Tair" class="headerlink" title="3ã€Tair"></a>3ã€Tair</h4><p>â€‹Tair(Taobao Pair)æ˜¯æ·˜å®å¼€å‘çš„åˆ†å¸ƒå¼Key-Valueå­˜å‚¨å¼•æ“ï¼Œæ—¢å¯ä»¥åšç¼“å­˜ä¹Ÿå¯ä»¥åšæ•°æ®æºï¼ˆä¸‰ç§å¼•æ“åˆ‡æ¢ï¼‰</p><ul><li>MDBï¼ˆMemcacheï¼‰å±äºå†…å­˜å‹äº§å“,æ”¯æŒkvå’Œç±»hashMapç»“æ„,æ€§èƒ½æœ€ä¼˜</li><li>RDBï¼ˆRedisï¼‰æ”¯æŒList.Set.Zsetç­‰å¤æ‚çš„æ•°æ®ç»“æ„,æ€§èƒ½æ¬¡ä¹‹,å¯æä¾›ç¼“å­˜å’ŒæŒä¹…åŒ–å­˜å‚¨ä¸¤ç§æ¨¡å¼</li><li>LDBï¼ˆlevelDBï¼‰å±äºæŒä¹…åŒ–äº§å“,æ”¯æŒkvå’Œç±»hashmapç»“æ„,æ€§èƒ½è¾ƒå‰ä¸¤è€…ç¨ä½,ä½†æŒä¹…åŒ–å¯é æ€§æœ€é«˜</li></ul><p><strong>åˆ†å¸ƒå¼ç¼“å­˜</strong></p><p>å¤§è®¿é—®å°‘é‡ä¸´æ—¶æ•°æ®çš„å­˜å‚¨ï¼ˆkbå·¦å³ï¼‰</p><p>ç”¨äºç¼“å­˜ï¼Œé™ä½å¯¹åç«¯æ•°æ®åº“çš„è®¿é—®å‹åŠ›</p><p>sessionåœºæ™¯</p><p>é«˜é€Ÿè®¿é—®æŸäº›æ•°æ®ç»“æ„çš„åº”ç”¨å’Œè®¡ç®—ï¼ˆrdbï¼‰</p><p><strong>æ•°æ®æºå­˜å‚¨</strong></p><p>å¿«é€Ÿè¯»å–æ•°æ®ï¼ˆfdbï¼‰</p><p>æŒç»­å¤§æ•°æ®é‡çš„å­˜å…¥è¯»å–ï¼ˆldbï¼‰ï¼Œäº¤æ˜“å¿«ç…§</p><p>é«˜é¢‘åº¦çš„æ›´æ–°è¯»å–ï¼ˆldbï¼‰ï¼Œåº“å­˜</p><p><strong>ç—›ç‚¹</strong>ï¼šredisé›†ç¾¤ä¸­ï¼Œæƒ³å€Ÿç”¨ç¼“å­˜èµ„æºå¿…é¡»å¾—æŒ‡æ˜redisæœåŠ¡å™¨åœ°å€å»è¦ã€‚è¿™å°±å¢åŠ äº†ç¨‹åºçš„ç»´æŠ¤å¤æ‚åº¦ã€‚å› ä¸ºredisæœåŠ¡å™¨å¾ˆå¯èƒ½æ˜¯éœ€è¦é¢‘ç¹å˜åŠ¨çš„ã€‚æ‰€ä»¥äººå®¶æ·˜å®å°±æƒ³å•Šï¼Œä¸ºä»€ä¹ˆä¸èƒ½åƒæ“ä½œåˆ†å¸ƒå¼æ•°æ®åº“æˆ–è€…hadoopé‚£æ ·ã€‚å¢åŠ ä¸€ä¸ªä¸­å¤®èŠ‚ç‚¹ï¼Œè®©ä»–å»ä»£ç†æ‰€æœ‰äº‹æƒ…ã€‚åœ¨tairä¸­ç¨‹åºåªè¦è·Ÿtairä¸­å¿ƒèŠ‚ç‚¹äº¤äº’å°±OKäº†ã€‚åŒæ—¶tairé‡Œè¿˜æœ‰é…ç½®æœåŠ¡å™¨æ¦‚å¿µã€‚åˆå…å»äº†åƒæ“ä½œhadoopé‚£æ ·ï¼Œè¿˜å¾—æ¯å°hadoopä¸€å¥—ä¸€æ¨¡ä¸€æ ·é…ç½®æ–‡ä»¶ã€‚æ”¹é…ç½®æ–‡ä»¶å¾—æ•´ä¸ªé›†ç¾¤éƒ½è·Ÿç€æ”¹ã€‚</p><h4 id="4ã€Guava"><a href="#4ã€Guava" class="headerlink" title="4ã€Guava"></a>4ã€Guava</h4><p>â€‹åˆ†å¸ƒå¼ç¼“å­˜ä¸€è‡´æ€§æ›´å¥½ä¸€ç‚¹ï¼Œç”¨äºé›†ç¾¤ç¯å¢ƒä¸‹å¤šèŠ‚ç‚¹ä½¿ç”¨åŒä¸€ä»½ç¼“å­˜çš„æƒ…å†µï¼›æœ‰ç½‘ç»œIOï¼Œååç‡ä¸ç¼“å­˜çš„æ•°æ®å¤§å°æœ‰è¾ƒå¤§å…³ç³»ï¼›</p><p>â€‹æœ¬åœ°ç¼“å­˜éå¸¸é«˜æ•ˆï¼Œæœ¬åœ°ç¼“å­˜ä¼šå ç”¨å †å†…å­˜ï¼Œå½±å“åƒåœ¾å›æ”¶ã€å½±å“ç³»ç»Ÿæ€§èƒ½ã€‚</p><p><strong>æœ¬åœ°ç¼“å­˜è®¾è®¡ï¼š</strong></p><p>â€‹ä»¥ Java ä¸ºä¾‹ï¼Œä½¿ç”¨è‡ªå¸¦çš„ map æˆ–è€… guava å®ç°çš„æ˜¯æœ¬åœ°ç¼“å­˜ï¼Œæœ€ä¸»è¦çš„ç‰¹ç‚¹æ˜¯è½»é‡ä»¥åŠå¿«é€Ÿï¼Œç”Ÿå‘½å‘¨æœŸéšç€ jvm çš„é”€æ¯è€Œç»“æŸï¼Œå¹¶ä¸”åœ¨å¤šå®ä¾‹çš„æƒ…å†µï¼Œæ¯ä¸ªå®ä¾‹éƒ½éœ€è¦å„è‡ªä¿å­˜ä¸€ä»½ç¼“å­˜ï¼Œç¼“å­˜ä¸å…·æœ‰ä¸€è‡´æ€§ã€‚</p><p><strong>è§£å†³ç¼“å­˜è¿‡æœŸï¼š</strong></p><p>â€‹1ã€å°†ç¼“å­˜è¿‡æœŸæ—¶é—´è°ƒä¸ºæ°¸ä¹…</p><p>â€‹2ã€å°†ç¼“å­˜å¤±æ•ˆæ—¶é—´åˆ†æ•£å¼€ï¼Œä¸è¦å°†ç¼“å­˜æ—¶é—´é•¿åº¦éƒ½è®¾ç½®æˆä¸€æ ·ï¼›æ¯”å¦‚æˆ‘ä»¬å¯ä»¥åœ¨åŸæœ‰çš„å¤±æ•ˆæ—¶é—´åŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ªéšæœºå€¼ï¼Œè¿™æ ·æ¯ä¸€ä¸ªç¼“å­˜çš„è¿‡æœŸæ—¶é—´çš„é‡å¤ç‡å°±ä¼šé™ä½ï¼Œå°±å¾ˆéš¾å¼•å‘é›†ä½“å¤±æ•ˆçš„äº‹ä»¶ã€‚</p><p><strong>è§£å†³å†…å­˜æº¢å‡ºï¼š</strong></p><p>â€‹<strong>ç¬¬ä¸€æ­¥</strong>ï¼Œä¿®æ”¹JVMå¯åŠ¨å‚æ•°ï¼Œç›´æ¥å¢åŠ å†…å­˜ã€‚(-Xmsï¼Œ-Xmxå‚æ•°ä¸€å®šä¸è¦å¿˜è®°åŠ ã€‚)</p><p>ã€€<strong>ç¬¬äºŒæ­¥</strong>ï¼Œæ£€æŸ¥é”™è¯¯æ—¥å¿—ï¼ŒæŸ¥çœ‹â€œOutOfMemoryâ€é”™è¯¯å‰æ˜¯å¦æœ‰å…¶å®ƒå¼‚å¸¸æˆ–é”™è¯¯ã€‚</p><p>ã€€<strong>ç¬¬ä¸‰æ­¥</strong>ï¼Œå¯¹ä»£ç è¿›è¡Œèµ°æŸ¥å’Œåˆ†æï¼Œæ‰¾å‡ºå¯èƒ½å‘ç”Ÿå†…å­˜æº¢å‡ºçš„ä½ç½®ã€‚</p><p><strong>Google Guava Cache</strong> </p><p><strong>è‡ªå·±è®¾è®¡æœ¬åœ°ç¼“å­˜ç—›ç‚¹ï¼š</strong></p><ul><li>ä¸èƒ½æŒ‰ç…§ä¸€å®šçš„è§„åˆ™æ·˜æ±°æ•°æ®ï¼Œå¦‚ LRUï¼ŒLFUï¼ŒFIFO ç­‰ã€‚</li><li>æ¸…é™¤æ•°æ®æ—¶çš„å›è°ƒé€šçŸ¥</li><li>å¹¶å‘å¤„ç†èƒ½åŠ›å·®ï¼Œé’ˆå¯¹å¹¶å‘å¯ä»¥ä½¿ç”¨CurrentHashMapï¼Œä½†ç¼“å­˜çš„å…¶ä»–åŠŸèƒ½éœ€è¦è‡ªè¡Œå®ç°</li><li>ç¼“å­˜è¿‡æœŸå¤„ç†ï¼Œç¼“å­˜æ•°æ®åŠ è½½åˆ·æ–°ç­‰éƒ½éœ€è¦æ‰‹å·¥å®ç°</li></ul><p><strong>Guava Cache çš„åœºæ™¯ï¼š</strong></p><ul><li>å¯¹æ€§èƒ½æœ‰éå¸¸é«˜çš„è¦æ±‚</li><li>ä¸ç»å¸¸å˜åŒ–ï¼Œå ç”¨å†…å­˜ä¸å¤§</li><li>æœ‰è®¿é—®æ•´ä¸ªé›†åˆçš„éœ€æ±‚</li><li>æ•°æ®å…è®¸ä¸å®æ—¶ä¸€è‡´</li></ul><p><strong>Guava Cache çš„ä¼˜åŠ¿</strong>ï¼š</p><ul><li>ç¼“å­˜è¿‡æœŸå’Œæ·˜æ±°æœºåˆ¶</li></ul><p>åœ¨GuavaCacheä¸­å¯ä»¥è®¾ç½®Keyçš„è¿‡æœŸæ—¶é—´ï¼ŒåŒ…æ‹¬è®¿é—®è¿‡æœŸå’Œåˆ›å»ºè¿‡æœŸã€‚GuavaCacheåœ¨ç¼“å­˜å®¹é‡è¾¾åˆ°æŒ‡å®šå¤§å°æ—¶ï¼Œé‡‡ç”¨LRUçš„æ–¹å¼ï¼Œå°†ä¸å¸¸ä½¿ç”¨çš„é”®å€¼ä»Cacheä¸­åˆ é™¤</p><ul><li>å¹¶å‘å¤„ç†èƒ½åŠ›</li></ul><p>GuavaCacheç±»ä¼¼CurrentHashMapï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚æä¾›äº†è®¾ç½®å¹¶å‘çº§åˆ«çš„apiï¼Œä½¿å¾—ç¼“å­˜æ”¯æŒå¹¶å‘çš„å†™å…¥å’Œè¯»å–ï¼Œé‡‡ç”¨åˆ†ç¦»é”æœºåˆ¶ï¼Œåˆ†ç¦»é”èƒ½å¤Ÿå‡å°é”åŠ›åº¦ï¼Œæå‡å¹¶å‘èƒ½åŠ›ï¼Œåˆ†ç¦»é”æ˜¯åˆ†æ‹†é”å®šï¼ŒæŠŠä¸€ä¸ªé›†åˆçœ‹åˆ†æˆè‹¥å¹²partition, æ¯ä¸ªpartitonä¸€æŠŠé”ã€‚æ›´æ–°é”å®š</p><ul><li>é˜²æ­¢ç¼“å­˜å‡»ç©¿</li></ul><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨ç¼“å­˜ä¸­æŸ¥è¯¢æŸä¸ªkeyï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æŸ¥æºæ•°æ®ï¼Œå¹¶å›å¡«ç¼“å­˜ã€‚ï¼ˆCache Aside Patternï¼‰åœ¨é«˜å¹¶å‘ä¸‹ä¼šå‡ºç°ï¼Œå¤šæ¬¡æŸ¥æºå¹¶é‡å¤å›å¡«ç¼“å­˜ï¼Œå¯èƒ½ä¼šé€ æˆæºçš„å®•æœºï¼ˆDBï¼‰ï¼Œæ€§èƒ½ä¸‹é™ GuavaCacheå¯ä»¥åœ¨CacheLoaderçš„loadæ–¹æ³•ä¸­åŠ ä»¥æ§åˆ¶ï¼Œå¯¹åŒä¸€ä¸ªkeyï¼Œåªè®©ä¸€ä¸ªè¯·æ±‚å»è¯»æºå¹¶å›å¡«ç¼“å­˜ï¼Œå…¶ä»–è¯·æ±‚é˜»å¡ç­‰å¾…ã€‚ï¼ˆç›¸å½“äºé›†æˆæ•°æ®æºï¼Œæ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨ï¼‰</p><ul><li>ç›‘æ§ç¼“å­˜åŠ è½½&#x2F;å‘½ä¸­æƒ…å†µ</li></ul><p>ç»Ÿè®¡</p><p><strong>é—®é¢˜ï¼š</strong></p><p>â€‹OOM-&gt;è®¾ç½®è¿‡æœŸæ—¶é—´ã€ä½¿ç”¨å¼±å¼•ç”¨ã€é…ç½®è¿‡æœŸç­–ç•¥</p><h4 id="5ã€EVCache"><a href="#5ã€EVCache" class="headerlink" title="5ã€EVCache"></a>5ã€EVCache</h4><p>EVCacheæ˜¯ä¸€ä¸ªNetflflixï¼ˆç½‘é£ï¼‰å…¬å¸å¼€æºã€å¿«é€Ÿçš„åˆ†å¸ƒå¼ç¼“å­˜ï¼Œæ˜¯åŸºäºMemcachedçš„å†…å­˜å­˜å‚¨å®ç°çš„ï¼Œç”¨ä»¥æ„å»ºè¶…å¤§å®¹é‡ã€é«˜æ€§èƒ½ã€ä½å»¶æ—¶ã€è·¨åŒºåŸŸçš„å…¨çƒå¯ç”¨çš„ç¼“å­˜æ•°æ®å±‚ã€‚</p><p>Eï¼šEphemeralï¼šæ•°æ®å­˜å‚¨æ˜¯çŸ­æš‚çš„ï¼Œæœ‰è‡ªèº«çš„å­˜æ´»æ—¶é—´</p><p>Vï¼šVolatileï¼šæ•°æ®å¯ä»¥åœ¨ä»»ä½•æ—¶å€™æ¶ˆå¤±</p><p>EVCacheå…¸å‹åœ°é€‚åˆå¯¹å¼ºä¸€è‡´æ€§æ²¡æœ‰å¿…é¡»è¦æ±‚çš„åœºåˆ</p><p>å…¸å‹ç”¨ä¾‹ï¼šNetflflixå‘ç”¨æˆ·æ¨èç”¨æˆ·æ„Ÿå…´è¶£çš„ç”µå½±</p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gmapdnh0yaj30ku0aigmc.jpg" alt="image-20210103185340548" style="zoom:50%;" /><p><strong>EVCacheé›†ç¾¤</strong>åœ¨å³°å€¼æ¯ç§’å¯ä»¥å¤„ç†<strong>200kb</strong>çš„è¯·æ±‚ï¼Œ</p><p>Netflflixç”Ÿäº§ç³»ç»Ÿä¸­éƒ¨ç½²çš„EVCacheç»å¸¸è¦å¤„ç†è¶…è¿‡<strong>æ¯ç§’3000ä¸‡ä¸ª</strong>è¯·æ±‚ï¼Œå­˜å‚¨æ•°åäº¿ä¸ªå¯¹è±¡ï¼Œ</p><p>è·¨æ•°åƒå°memcachedæœåŠ¡å™¨ã€‚æ•´ä¸ªEVCacheé›†ç¾¤<strong>æ¯å¤©å¤„ç†è¿‘2ä¸‡äº¿ä¸ª</strong>è¯·æ±‚ã€‚</p><p>EVCacheé›†ç¾¤å“åº”å¹³å‡å»¶æ—¶å¤§çº¦æ˜¯1-5æ¯«ç§’ï¼Œæœ€å¤šä¸ä¼šè¶…è¿‡20æ¯«ç§’ã€‚</p><p>EVCacheé›†ç¾¤çš„ç¼“å­˜å‘½ä¸­ç‡åœ¨99%å·¦å³ã€‚</p><p><strong>å…¸å‹éƒ¨ç½²</strong></p><p>EVCache æ˜¯çº¿æ€§æ‰©å±•çš„ï¼Œå¯ä»¥åœ¨ä¸€åˆ†é’Ÿä¹‹å†…å®Œæˆæ‰©å®¹ï¼Œåœ¨å‡ åˆ†é’Ÿä¹‹å†…å®Œæˆè´Ÿè½½å‡è¡¡å’Œç¼“å­˜é¢„çƒ­ã€‚</p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gmapg99q8lj30ix0f3jrw.jpg" alt="image-20210103185611516" style="zoom:50%;" /><p>1ã€é›†ç¾¤å¯åŠ¨æ—¶ï¼ŒEVCacheå‘æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼ˆZookeeperã€Eurekaï¼‰æ³¨å†Œå„ä¸ªå®ä¾‹</p><p>2ã€åœ¨webåº”ç”¨å¯åŠ¨æ—¶ï¼ŒæŸ¥è¯¢å‘½åæœåŠ¡ä¸­çš„EVCacheæœåŠ¡å™¨åˆ—è¡¨ï¼Œå¹¶å»ºç«‹è¿æ¥ã€‚</p><p>3ã€å®¢æˆ·ç«¯é€šè¿‡keyä½¿ç”¨ä¸€è‡´æ€§hashç®—æ³•ï¼Œå°†æ•°æ®åˆ†ç‰‡åˆ°é›†ç¾¤ä¸Šã€‚</p><h4 id="6ã€ETCD"><a href="#6ã€ETCD" class="headerlink" title="6ã€ETCD"></a>6ã€ETCD</h4><p>â€‹<strong>å’ŒZookeeperä¸€æ ·ï¼ŒCPæ¨¡å‹è¿½æ±‚æ•°æ®ä¸€è‡´æ€§ï¼Œ</strong>è¶Šæ¥è¶Šå¤šçš„ç³»ç»Ÿå¼€å§‹ç”¨å®ƒä¿å­˜å…³é”®æ•°æ®ã€‚æ¯”å¦‚ï¼Œç§’æ€ç³»ç»Ÿç»å¸¸ç”¨å®ƒ<strong>ä¿å­˜å„èŠ‚ç‚¹ä¿¡</strong>æ¯ï¼Œä»¥ä¾¿æ§åˆ¶æ¶ˆè´¹ MQ çš„æœåŠ¡æ•°é‡ã€‚è¿˜æœ‰äº›ä¸šåŠ¡ç³»ç»Ÿçš„<strong>é…ç½®æ•°æ®</strong>ï¼Œä¹Ÿä¼šé€šè¿‡ etcd å®æ—¶åŒæ­¥ç»™ä¸šåŠ¡ç³»ç»Ÿçš„å„èŠ‚ç‚¹ï¼Œæ¯”å¦‚ï¼Œç§’æ€ç®¡ç†åå°ä¼šä½¿ç”¨ etcd å°†ç§’æ€æ´»åŠ¨çš„<strong>é…ç½®æ•°æ®å®æ—¶åŒæ­¥ç»™ç§’æ€ API æœåŠ¡å„èŠ‚ç‚¹</strong>ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gx2tg9qs00j30ta0g40vc.jpg" alt="image-20210418174251742"></p><h3 id="Redisåº•å±‚"><a href="#Redisåº•å±‚" class="headerlink" title="Redisåº•å±‚"></a>Redisåº•å±‚</h3><h4 id="1ã€redisæ•°æ®ç±»å‹"><a href="#1ã€redisæ•°æ®ç±»å‹" class="headerlink" title="1ã€redisæ•°æ®ç±»å‹"></a>1ã€redisæ•°æ®ç±»å‹</h4><table><thead><tr><th>ç±»å‹</th><th>åº•å±‚</th><th>åº”ç”¨åœºæ™¯</th><th>ç¼–ç ç±»å‹</th></tr></thead><tbody><tr><td>String</td><td>SDSæ•°ç»„</td><td>å¸–å­ã€è¯„è®ºã€çƒ­ç‚¹æ•°æ®ã€è¾“å…¥ç¼“å†²</td><td>RAW &lt;&lt; EMBSTR &lt;&lt; INT</td></tr><tr><td>List</td><td>QuickList</td><td>è¯„è®ºåˆ—è¡¨ã€å•†å“åˆ—è¡¨ã€å‘å¸ƒä¸è®¢é˜…ã€æ…¢æŸ¥è¯¢ã€ç›‘è§†å™¨</td><td>LINKEDLIST &lt;&lt; ZIPLIST</td></tr><tr><td>Set</td><td>intSet</td><td>é€‚åˆäº¤é›†ã€å¹¶é›†ã€æŸ¥é›†æ“ä½œï¼Œä¾‹å¦‚æœ‹å‹å…³ç³»</td><td>HT &lt;&lt; INSET</td></tr><tr><td>Zset</td><td>è·³è·ƒè¡¨</td><td>å»é‡åæ’åºï¼Œé€‚åˆæ’ååœºæ™¯</td><td>SKIPLIST &lt;&lt; ZIPLIST</td></tr><tr><td>Hash</td><td>å“ˆå¸Œ</td><td>ç»“æ„åŒ–æ•°æ®ï¼Œæ¯”å¦‚å­˜å‚¨å¯¹è±¡</td><td>HT &lt;&lt; ZIPLIST</td></tr><tr><td>Stream</td><td>ç´§å‡‘åˆ—è¡¨</td><td>æ¶ˆæ¯é˜Ÿåˆ—</td><td></td></tr></tbody></table><h4 id="2ã€ç›¸å…³API"><a href="#2ã€ç›¸å…³API" class="headerlink" title="2ã€ç›¸å…³API"></a><strong>2ã€ç›¸å…³API</strong></h4><blockquote><p><a href="http://redisdoc.com/">http://redisdoc.com</a></p></blockquote><table><thead><tr><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td>String</td><td>SET</td><td>SETNX</td><td>SETEX</td><td>GET</td><td>GETSET</td><td>INCR</td><td>DECR</td><td>MSET</td><td>MGET</td></tr><tr><td>Hash</td><td>HSET</td><td>HSETNX</td><td>HGET</td><td>HDEL</td><td>HLEN</td><td>HMSET</td><td>HMGET</td><td>HKEYS</td><td>HGETALL</td></tr><tr><td>LIST</td><td>LPUSH</td><td>LPOP</td><td>RPUSH</td><td>RPOP</td><td>LINDEX</td><td>LREM</td><td>LRANGE</td><td>LLEN</td><td>RPOPLPUSH</td></tr><tr><td>ZSET</td><td>ZADD</td><td>ZREM</td><td>ZSCORE</td><td>ZCARD</td><td>ZRANGE</td><td>ZRANK</td><td>ZREVRANK</td><td></td><td>ZREVRANGE</td></tr><tr><td>SET</td><td>SADD</td><td>SREM</td><td>SISMEMBER</td><td>SCARD</td><td>SINTER</td><td>SUNION</td><td>SDIFF</td><td>SPOP</td><td>SMEMBERS</td></tr><tr><td>äº‹åŠ¡</td><td>MULTI</td><td>EXEC</td><td>DISCARD</td><td>WATCH</td><td>UNWATCH</td><td></td><td></td><td></td><td></td></tr></tbody></table><h4 id="3ã€redisåº•å±‚ç»“æ„"><a href="#3ã€redisåº•å±‚ç»“æ„" class="headerlink" title="3ã€redisåº•å±‚ç»“æ„"></a>3ã€redisåº•å±‚ç»“æ„</h4><p><strong>SDSæ•°ç»„ç»“æ„</strong>ï¼Œç”¨äºå­˜å‚¨å­—ç¬¦ä¸²å’Œæ•´å‹æ•°æ®åŠè¾“å…¥ç¼“å†²ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">struct sdshdr&#123; </span><br><span class="line">  <span class="type">int</span> len;<span class="comment">//è®°å½•bufæ•°ç»„ä¸­å·²ä½¿ç”¨å­—èŠ‚çš„æ•°é‡ </span></span><br><span class="line">  <span class="type">int</span> free; <span class="comment">//è®°å½• buf æ•°ç»„ä¸­æœªä½¿ç”¨å­—èŠ‚çš„æ•°é‡ </span></span><br><span class="line">  <span class="type">char</span> buf[];<span class="comment">//å­—ç¬¦æ•°ç»„ï¼Œç”¨äºä¿å­˜å­—ç¬¦ä¸²</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è·³è·ƒè¡¨</strong>ï¼šå°†æœ‰åºé“¾è¡¨ä¸­çš„éƒ¨åˆ†èŠ‚ç‚¹åˆ†å±‚ï¼Œæ¯ä¸€å±‚éƒ½æ˜¯ä¸€ä¸ªæœ‰åºé“¾è¡¨ã€‚</p><p>â€‹1ã€å¯ä»¥å¿«é€ŸæŸ¥æ‰¾åˆ°éœ€è¦çš„èŠ‚ç‚¹ O(logn) ï¼Œé¢å¤–å­˜å‚¨äº†ä¸€å€çš„ç©ºé—´</p><p>â€‹2ã€å¯ä»¥åœ¨O(1)çš„æ—¶é—´å¤æ‚åº¦ä¸‹ï¼Œå¿«é€Ÿè·å¾—è·³è·ƒè¡¨çš„å¤´èŠ‚ç‚¹ã€å°¾ç»“ç‚¹ã€é•¿åº¦å’Œé«˜åº¦ã€‚</p><p><strong>å­—å…¸dict:</strong> åˆç§°æ•£åˆ—è¡¨(hash)ï¼Œæ˜¯ç”¨æ¥å­˜å‚¨é”®å€¼å¯¹çš„ä¸€ç§æ•°æ®ç»“æ„ã€‚ </p><p>â€‹Redisæ•´ä¸ªæ•°æ®åº“æ˜¯ç”¨å­—å…¸æ¥å­˜å‚¨çš„(K-Vç»“æ„) â€”Hash+æ•°ç»„+é“¾è¡¨</p><p>â€‹Rediså­—å…¸å®ç°åŒ…æ‹¬:**å­—å…¸(dict)ã€Hashè¡¨(dictht)ã€Hashè¡¨èŠ‚ç‚¹(dictEntry)**ã€‚</p><p>â€‹å­—å…¸è¾¾åˆ°å­˜å‚¨ä¸Šé™(é˜ˆå€¼ 0.75)ï¼Œéœ€è¦rehash(æ‰©å®¹)</p><p>â€‹1ã€åˆæ¬¡ç”³è¯·é»˜è®¤å®¹é‡ä¸º4ä¸ªdictEntryï¼Œéåˆæ¬¡ç”³è¯·ä¸ºå½“å‰hashè¡¨å®¹é‡çš„ä¸€å€ã€‚</p><p>â€‹2ã€rehashidx&#x3D;0è¡¨ç¤ºè¦è¿›è¡Œrehashæ“ä½œã€‚</p><p>â€‹3ã€æ–°å¢åŠ çš„æ•°æ®åœ¨æ–°çš„hashè¡¨h[1] ã€ä¿®æ”¹ã€åˆ é™¤ã€æŸ¥è¯¢åœ¨è€hashè¡¨h[0]</p><p>â€‹4ã€å°†è€çš„hashè¡¨h[0]çš„æ•°æ®é‡æ–°è®¡ç®—ç´¢å¼•å€¼åå…¨éƒ¨è¿ç§»åˆ°æ–°çš„hashè¡¨h[1]ä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º rehashã€‚</p><p>â€‹<strong>æ¸è¿›å¼rehash</strong></p><pre><code> ç”±äºå½“æ•°æ®é‡å·¨å¤§æ—¶rehashçš„è¿‡ç¨‹æ˜¯éå¸¸ç¼“æ…¢çš„ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œä¼˜åŒ–ã€‚ å¯æ ¹æ®æœåŠ¡å™¨ç©ºé—²ç¨‹åº¦æ‰¹é‡rehashéƒ¨åˆ†èŠ‚ç‚¹</code></pre><p><strong>å‹ç¼©åˆ—è¡¨zipList</strong></p><p>â€‹å‹ç¼©åˆ—è¡¨(ziplist)æ˜¯ç”±ä¸€ç³»åˆ—ç‰¹æ®Šç¼–ç çš„è¿ç»­å†…å­˜å—ç»„æˆçš„é¡ºåºå‹æ•°æ®ç»“æ„ï¼ŒèŠ‚çœå†…å®¹</p><p>â€‹<strong>sorted-setå’Œhashå…ƒç´ ä¸ªæ•°å°‘</strong>ä¸”æ˜¯å°æ•´æ•°æˆ–çŸ­å­—ç¬¦ä¸²(ç›´æ¥ä½¿ç”¨) </p><p>â€‹listç”¨å¿«é€Ÿé“¾è¡¨(quicklist)æ•°æ®ç»“æ„å­˜å‚¨ï¼Œè€Œ<strong>å¿«é€Ÿé“¾è¡¨æ˜¯åŒå‘åˆ—è¡¨ä¸å‹ç¼©åˆ—è¡¨</strong>çš„ç»„åˆã€‚(é—´æ¥ä½¿ç”¨)</p><p><strong>æ•´æ•°é›†åˆintSet</strong></p><p>â€‹æ•´æ•°é›†åˆ(intset)æ˜¯ä¸€ä¸ªæœ‰åºçš„(æ•´æ•°å‡åº)ã€å­˜å‚¨æ•´æ•°çš„è¿ç»­å­˜å‚¨ç»“æ„ã€‚ </p><p>â€‹å½“Redisé›†åˆç±»å‹çš„å…ƒç´ éƒ½æ˜¯æ•´æ•°å¹¶ä¸”éƒ½å¤„åœ¨64ä½æœ‰ç¬¦å·æ•´æ•°èŒƒå›´å†…(2^64)ï¼Œä½¿ç”¨è¯¥ç»“æ„ä½“å­˜å‚¨ã€‚</p><p><strong>å¿«é€Ÿåˆ—è¡¨quickList</strong></p><p>â€‹å¿«é€Ÿåˆ—è¡¨(quicklist)æ˜¯Redisåº•å±‚é‡è¦çš„æ•°æ®ç»“æ„ã€‚æ˜¯Redis3.2åˆ—è¡¨çš„åº•å±‚å®ç°ã€‚</p><p>â€‹(åœ¨Redis3.2ä¹‹å‰ï¼ŒRedisé‡‡ ç”¨åŒå‘é“¾è¡¨(adlist)å’Œå‹ç¼©åˆ—è¡¨(ziplist)å®ç°ã€‚)</p><p><strong>Redis Stream</strong>çš„åº•å±‚ä¸»è¦ä½¿ç”¨äº†listpack(ç´§å‡‘åˆ—è¡¨)å’ŒRaxæ ‘(åŸºæ•°æ ‘)ã€‚</p><p>â€‹<strong>listpack</strong>è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨çš„åºåˆ—åŒ–ï¼Œlistpackå¯ç”¨äºå­˜å‚¨å­—ç¬¦ä¸²æˆ–æ•´æ•°ã€‚ç”¨äºå­˜å‚¨streamçš„æ¶ˆæ¯å†… å®¹ã€‚</p><p>â€‹<strong>Raxæ ‘</strong>æ˜¯ä¸€ä¸ªæœ‰åºå­—å…¸æ ‘ (åŸºæ•°æ ‘ Radix Tree)ï¼ŒæŒ‰ç…§ key çš„å­—å…¸åºæ’åˆ—ï¼Œæ”¯æŒå¿«é€Ÿåœ°å®šä½ã€æ’å…¥å’Œåˆ é™¤æ“ ä½œã€‚</p><h4 id="4ã€Zsetåº•å±‚å®ç°"><a href="#4ã€Zsetåº•å±‚å®ç°" class="headerlink" title="4ã€Zsetåº•å±‚å®ç°"></a>4ã€Zsetåº•å±‚å®ç°</h4><p>â€‹è·³è¡¨(skip List)æ˜¯ä¸€ç§éšæœºåŒ–çš„æ•°æ®ç»“æ„ï¼ŒåŸºäºå¹¶è”çš„é“¾è¡¨ï¼Œå®ç°ç®€å•ï¼Œæ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾çš„å¤æ‚åº¦å‡ä¸ºO(logN)ã€‚ç®€å•è¯´æ¥è·³è¡¨ä¹Ÿæ˜¯é“¾è¡¨çš„ä¸€ç§ï¼Œåªä¸è¿‡å®ƒåœ¨é“¾è¡¨çš„åŸºç¡€ä¸Šå¢åŠ äº†è·³è·ƒåŠŸèƒ½ï¼Œæ­£æ˜¯è¿™ä¸ªè·³è·ƒçš„åŠŸèƒ½ï¼Œä½¿å¾—åœ¨æŸ¥æ‰¾å…ƒç´ æ—¶ï¼Œè·³è¡¨èƒ½å¤Ÿæä¾›O(logN)çš„æ—¶é—´å¤æ‚åº¦</p><p>â€‹Zset<strong>æ•°æ®é‡å°‘çš„æ—¶å€™ä½¿ç”¨å‹ç¼©é“¾è¡¨ziplist</strong>å®ç°ï¼Œæœ‰åºé›†åˆä½¿ç”¨ç´§æŒ¨åœ¨ä¸€èµ·çš„å‹ç¼©åˆ—è¡¨èŠ‚ç‚¹æ¥ä¿å­˜ï¼Œç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¿å­˜memberï¼Œç¬¬äºŒä¸ªä¿å­˜scoreã€‚ziplistå†…çš„é›†åˆå…ƒç´ æŒ‰scoreä»å°åˆ°å¤§æ’åºï¼Œscoreè¾ƒå°çš„æ’åœ¨è¡¨å¤´ä½ç½®ã€‚ <strong>æ•°æ®é‡å¤§çš„æ—¶å€™ä½¿ç”¨è·³è·ƒåˆ—è¡¨skiplistå’Œå“ˆå¸Œè¡¨hash_map</strong>ç»“åˆå®ç°ï¼ŒæŸ¥æ‰¾åˆ é™¤æ’å…¥çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(longN)</p><p>â€‹Redisä½¿ç”¨è·³è¡¨è€Œä¸ä½¿ç”¨çº¢é»‘æ ‘ï¼Œæ˜¯å› ä¸ºè·³è¡¨çš„ç´¢å¼•ç»“æ„åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ›´åŠ å¿«é€Ÿï¼Œæ–¹ä¾¿æŒä¹…åŒ–ã€‚</p><p><strong>æœç´¢</strong></p><p>â€‹è·³è·ƒè¡¨æŒ‰ score ä»å°åˆ°å¤§ä¿å­˜æ‰€æœ‰é›†åˆå…ƒç´ ï¼ŒæŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦ä¸ºå¹³å‡ <em>O(logN)ï¼Œæœ€å O(N) ã€‚</em></p><p><strong>æ’å…¥</strong></p><p>â€ƒâ€ƒé€‰ç”¨é“¾è¡¨ä½œä¸ºåº•å±‚ç»“æ„æ”¯æŒï¼Œä¸ºäº†é«˜æ•ˆåœ°åŠ¨æ€å¢åˆ ã€‚å› ä¸ºè·³è¡¨åº•å±‚çš„å•é“¾è¡¨æ˜¯æœ‰åºçš„ï¼Œä¸ºäº†ç»´æŠ¤è¿™ç§æœ‰åºæ€§ï¼Œåœ¨æ’å…¥å‰éœ€è¦éå†é“¾è¡¨ï¼Œæ‰¾åˆ°è¯¥æ’å…¥çš„ä½ç½®ï¼Œå•é“¾è¡¨éå†æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(n)ï¼ŒåŒç†å¯å¾—ï¼Œè·³è¡¨çš„éå†ä¹Ÿæ˜¯éœ€è¦éå†ç´¢å¼•æ•°ï¼Œæ‰€ä»¥æ˜¯O(logn)ã€‚</p><p><strong>åˆ é™¤</strong></p><p>â€ƒâ€ƒå¦‚æœè¯¥èŠ‚ç‚¹è¿˜åœ¨ç´¢å¼•ä¸­ï¼Œåˆ é™¤æ—¶ä¸ä»…è¦åˆ é™¤å•é“¾è¡¨ä¸­çš„èŠ‚ç‚¹ï¼Œè¿˜è¦åˆ é™¤ç´¢å¼•ä¸­çš„èŠ‚ç‚¹ï¼›å•é“¾è¡¨åœ¨çŸ¥é“åˆ é™¤çš„èŠ‚ç‚¹æ˜¯è°æ—¶ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼Œä½†é’ˆå¯¹å•é“¾è¡¨æ¥è¯´ï¼Œåˆ é™¤æ—¶éƒ½éœ€è¦æ‹¿åˆ°å‰é©±èŠ‚ç‚¹O(logN)æ‰å¯æ”¹å˜å¼•ç”¨å…³ç³»ä»è€Œåˆ é™¤ç›®æ ‡èŠ‚ç‚¹ã€‚</p><h3 id="Rediså¯ç”¨æ€§"><a href="#Rediså¯ç”¨æ€§" class="headerlink" title="Rediså¯ç”¨æ€§"></a><strong>Rediså¯ç”¨æ€§</strong></h3><h4 id="1ã€redisæŒä¹…åŒ–"><a href="#1ã€redisæŒä¹…åŒ–" class="headerlink" title="1ã€redisæŒä¹…åŒ–"></a>1ã€redisæŒä¹…åŒ–</h4><p>æŒä¹…åŒ–å°±æ˜¯æŠŠå†…å­˜ä¸­çš„æ•°æ®æŒä¹…åŒ–åˆ°æœ¬åœ°ç£ç›˜ï¼Œé˜²æ­¢æœåŠ¡å™¨å®•æœºäº†å†…å­˜æ•°æ®ä¸¢å¤±</p><p>Redis æä¾›ä¸¤ç§æŒä¹…åŒ–æœºåˆ¶ <strong>RDBï¼ˆé»˜è®¤ï¼‰</strong> å’Œ <strong>AOF æœºåˆ¶</strong>ï¼ŒRedis4.0ä»¥åé‡‡ç”¨æ··åˆæŒä¹…åŒ–ï¼Œç”¨ AOF æ¥<strong>ä¿è¯æ•°æ®ä¸ä¸¢å¤±</strong>ï¼Œä½œä¸ºæ•°æ®æ¢å¤çš„ç¬¬ä¸€é€‰æ‹©; ç”¨ RDB æ¥åšä¸åŒç¨‹åº¦çš„<strong>å†·å¤‡</strong></p><p><strong>RDBï¼š</strong>æ˜¯Redis DataBaseç¼©å†™å¿«ç…§</p><p>â€‹RDBæ˜¯Redisé»˜è®¤çš„æŒä¹…åŒ–æ–¹å¼ã€‚æŒ‰ç…§ä¸€å®šçš„æ—¶é—´å°†å†…å­˜çš„æ•°æ®ä»¥å¿«ç…§çš„å½¢å¼ä¿å­˜åˆ°ç¡¬ç›˜ä¸­ï¼Œå¯¹åº”äº§ç”Ÿçš„æ•°æ®æ–‡ä»¶ä¸ºdump.rdbã€‚é€šè¿‡é…ç½®æ–‡ä»¶ä¸­çš„saveå‚æ•°æ¥å®šä¹‰å¿«ç…§çš„å‘¨æœŸã€‚</p><p>â€‹<strong>ä¼˜ç‚¹ï¼š</strong></p><p>â€‹1ï¼‰åªæœ‰ä¸€ä¸ªæ–‡ä»¶ dump.rdbï¼Œæ–¹ä¾¿æŒä¹…åŒ–ï¼›</p><p>â€‹2ï¼‰å®¹ç¾æ€§å¥½ï¼Œä¸€ä¸ªæ–‡ä»¶å¯ä»¥ä¿å­˜åˆ°å®‰å…¨çš„ç£ç›˜ã€‚</p><p>â€‹3ï¼‰æ€§èƒ½æœ€å¤§åŒ–ï¼Œfork å­è¿›ç¨‹æ¥è¿›è¡ŒæŒä¹…åŒ–å†™æ“ä½œï¼Œè®©ä¸»è¿›ç¨‹ç»§ç»­å¤„ç†å‘½ä»¤ï¼Œåªå­˜åœ¨æ¯«ç§’çº§ä¸å“åº”è¯·æ±‚ã€‚</p><p>â€‹4ï¼‰ç›¸å¯¹äºæ•°æ®é›†å¤§æ—¶ï¼Œæ¯” AOF çš„å¯åŠ¨æ•ˆç‡æ›´é«˜ã€‚</p><p>â€‹<strong>ç¼ºç‚¹ï¼š</strong></p><p>â€‹æ•°æ®å®‰å…¨æ€§ä½ï¼ŒRDB æ˜¯é—´éš”ä¸€æ®µæ—¶é—´è¿›è¡ŒæŒä¹…åŒ–ï¼Œå¦‚æœæŒä¹…åŒ–ä¹‹é—´ redis å‘ç”Ÿæ•…éšœï¼Œä¼šå‘ç”Ÿæ•°æ®ä¸¢å¤±ã€‚</p><p><strong>AOFï¼šæŒä¹…åŒ–</strong></p><p>â€‹AOFæŒä¹…åŒ–(å³Append Only FileæŒä¹…åŒ–)ï¼Œåˆ™æ˜¯å°†Redisæ‰§è¡Œçš„æ¯æ¬¡å†™å‘½ä»¤è®°å½•åˆ°å•ç‹¬çš„æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œå½“é‡å¯Redisä¼šé‡æ–°å°†æŒä¹…åŒ–çš„æ—¥å¿—ä¸­æ–‡ä»¶æ¢å¤æ•°æ®ã€‚</p><p>â€‹<strong>ä¼˜ç‚¹ï¼š</strong></p><p>â€‹1ï¼‰æ•°æ®å®‰å…¨ï¼Œaof æŒä¹…åŒ–å¯ä»¥é…ç½® appendfsync å±æ€§ï¼Œæœ‰ alwaysï¼Œæ¯è¿›è¡Œä¸€æ¬¡ å‘½ä»¤æ“ä½œå°±è®°å½•åˆ° aof æ–‡ä»¶ä¸­ä¸€æ¬¡ã€‚</p><p>â€‹2ï¼‰é€šè¿‡ append æ¨¡å¼å†™æ–‡ä»¶ï¼Œå³ä½¿ä¸­é€”æœåŠ¡å™¨å®•æœºï¼Œå¯ä»¥é€šè¿‡ redis-check-aof å·¥å…·è§£å†³æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚</p><p><strong>ç¼ºç‚¹ï¼š</strong></p><p>â€‹1ï¼‰AOF æ–‡ä»¶æ¯” RDB æ–‡ä»¶å¤§ï¼Œä¸”æ¢å¤é€Ÿåº¦æ…¢ã€‚</p><p>â€‹2ï¼‰æ•°æ®é›†å¤§çš„æ—¶å€™ï¼Œæ¯” rdb å¯åŠ¨æ•ˆç‡ä½ã€‚</p><h4 id="2ã€redisäº‹åŠ¡"><a href="#2ã€redisäº‹åŠ¡" class="headerlink" title="2ã€redisäº‹åŠ¡"></a>2ã€redisäº‹åŠ¡</h4><p>â€‹äº‹åŠ¡æ˜¯ä¸€ä¸ªå•ç‹¬çš„éš”ç¦»æ“ä½œï¼šäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ã€‚äº‹åŠ¡æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼šäº‹åŠ¡ä¸­çš„å‘½ä»¤è¦ä¹ˆå…¨éƒ¨è¢«æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨éƒ½ä¸æ‰§è¡Œã€‚</p><p><strong>Redisäº‹åŠ¡çš„æ¦‚å¿µ</strong></p><p>â€‹Redis äº‹åŠ¡çš„æœ¬è´¨æ˜¯é€šè¿‡MULTIã€EXECã€WATCHç­‰ä¸€ç»„å‘½ä»¤çš„é›†åˆã€‚äº‹åŠ¡æ”¯æŒä¸€æ¬¡æ‰§è¡Œå¤šä¸ªå‘½ä»¤ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸­æ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«åºåˆ—åŒ–ã€‚åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ï¼Œä¼šæŒ‰ç…§é¡ºåºä¸²è¡ŒåŒ–æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„å‘½ä»¤ï¼Œå…¶ä»–å®¢æˆ·ç«¯æäº¤çš„å‘½ä»¤è¯·æ±‚ä¸ä¼šæ’å…¥åˆ°äº‹åŠ¡æ‰§è¡Œå‘½ä»¤åºåˆ—ä¸­ã€‚æ€»ç»“è¯´ï¼šredisäº‹åŠ¡å°±æ˜¯ä¸€æ¬¡æ€§ã€é¡ºåºæ€§ã€æ’ä»–æ€§çš„æ‰§è¡Œä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„ä¸€ç³»åˆ—å‘½ä»¤ã€‚</p><p>Redisçš„äº‹åŠ¡æ€»æ˜¯å…·æœ‰ACIDä¸­çš„<strong>ä¸€è‡´æ€§å’Œéš”ç¦»æ€§</strong>ï¼Œå…¶ä»–ç‰¹æ€§æ˜¯ä¸æ”¯æŒçš„ã€‚å½“æœåŠ¡å™¨è¿è¡Œåœ¨AOFæŒä¹…åŒ–æ¨¡å¼ä¸‹ï¼Œå¹¶ä¸”appendfsyncé€‰é¡¹çš„å€¼ä¸ºalwaysæ—¶ï¼Œäº‹åŠ¡ä¹Ÿå…·æœ‰è€ä¹…æ€§ã€‚</p><p>Redisäº‹åŠ¡åŠŸèƒ½æ˜¯é€šè¿‡MULTIã€EXECã€DISCARDå’ŒWATCH å››ä¸ªåŸè¯­å®ç°çš„</p><p><strong>äº‹åŠ¡å‘½ä»¤ï¼š</strong></p><p><strong>MULTIï¼š</strong>ç”¨äºå¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œå®ƒæ€»æ˜¯è¿”å›OKã€‚MULTIæ‰§è¡Œä¹‹åï¼Œå®¢æˆ·ç«¯å¯ä»¥ç»§ç»­å‘æœåŠ¡å™¨å‘é€ä»»æ„å¤šæ¡å‘½ä»¤ï¼Œè¿™äº›å‘½ä»¤ä¸ä¼šç«‹å³è¢«æ‰§è¡Œï¼Œè€Œæ˜¯è¢«æ”¾åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œå½“EXECå‘½ä»¤è¢«è°ƒç”¨æ—¶ï¼Œæ‰€æœ‰é˜Ÿåˆ—ä¸­çš„å‘½ä»¤æ‰ä¼šè¢«æ‰§è¡Œã€‚</p><p><strong>EXECï¼š</strong>æ‰§è¡Œæ‰€æœ‰äº‹åŠ¡å—å†…çš„å‘½ä»¤ã€‚è¿”å›äº‹åŠ¡å—å†…æ‰€æœ‰å‘½ä»¤çš„è¿”å›å€¼ï¼ŒæŒ‰å‘½ä»¤æ‰§è¡Œçš„å…ˆåé¡ºåºæ’åˆ—ã€‚å½“æ“ä½œè¢«æ‰“æ–­æ—¶ï¼Œè¿”å›ç©ºå€¼ nil ã€‚</p><p><strong>WATCH ï¼š</strong>æ˜¯ä¸€ä¸ªä¹è§‚é”ï¼Œå¯ä»¥ä¸º Redis äº‹åŠ¡æä¾› check-and-set ï¼ˆCASï¼‰è¡Œä¸ºã€‚å¯ä»¥ç›‘æ§ä¸€ä¸ªæˆ–å¤šä¸ªé”®ï¼Œä¸€æ—¦å…¶ä¸­æœ‰ä¸€ä¸ªé”®è¢«ä¿®æ”¹ï¼ˆæˆ–åˆ é™¤ï¼‰ï¼Œä¹‹åçš„äº‹åŠ¡å°±ä¸ä¼šæ‰§è¡Œï¼Œç›‘æ§ä¸€ç›´æŒç»­åˆ°EXECå‘½ä»¤ã€‚ï¼ˆ<strong>ç§’æ€åœºæ™¯</strong>ï¼‰</p><p><strong>DISCARDï¼š</strong>è°ƒç”¨è¯¥å‘½ä»¤ï¼Œå®¢æˆ·ç«¯å¯ä»¥æ¸…ç©ºäº‹åŠ¡é˜Ÿåˆ—ï¼Œå¹¶æ”¾å¼ƒæ‰§è¡Œäº‹åŠ¡ï¼Œä¸”å®¢æˆ·ç«¯ä¼šä»äº‹åŠ¡çŠ¶æ€ä¸­é€€å‡ºã€‚</p><p><strong>UNWATCH</strong>ï¼šå‘½ä»¤å¯ä»¥å–æ¶ˆwatchå¯¹æ‰€æœ‰keyçš„ç›‘æ§ã€‚</p><h4 id="3ã€rediså¤±æ•ˆç­–ç•¥"><a href="#3ã€rediså¤±æ•ˆç­–ç•¥" class="headerlink" title="3ã€rediså¤±æ•ˆç­–ç•¥"></a>3ã€rediså¤±æ•ˆç­–ç•¥</h4><p><strong>å†…å­˜æ·˜æ±°ç­–ç•¥</strong></p><p>1ï¼‰å…¨å±€çš„é”®ç©ºé—´é€‰æ‹©æ€§ç§»é™¤</p><p>â€‹<strong>noeviction</strong>ï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œæ–°å†™å…¥æ“ä½œä¼šæŠ¥é”™ã€‚ï¼ˆå­—å…¸åº“å¸¸ç”¨ï¼‰</p><p>â€‹<strong>allkeys-lru</strong>ï¼šåœ¨é”®ç©ºé—´ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„keyã€‚ï¼ˆç¼“å­˜å¸¸ç”¨ï¼‰</p><p>â€‹<strong>allkeys-random</strong>ï¼šåœ¨é”®ç©ºé—´ä¸­ï¼Œéšæœºç§»é™¤æŸä¸ªkeyã€‚</p><p>2ï¼‰è®¾ç½®è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´é€‰æ‹©æ€§ç§»é™¤</p><p>â€‹<strong>volatile-lru</strong>ï¼šåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„keyã€‚</p><p>â€‹<strong>volatile-random</strong>ï¼šåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼Œéšæœºç§»é™¤æŸä¸ªkeyã€‚</p><p>â€‹<strong>volatile-ttl</strong>ï¼šåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼Œæœ‰æ›´æ—©è¿‡æœŸæ—¶é—´çš„keyä¼˜å…ˆç§»é™¤ã€‚</p><p><strong>ç¼“å­˜å¤±æ•ˆç­–ç•¥</strong></p><p>â€‹<strong>å®šæ—¶æ¸…é™¤ï¼š</strong>é’ˆå¯¹æ¯ä¸ªè®¾ç½®è¿‡æœŸæ—¶é—´çš„keyéƒ½åˆ›å»ºæŒ‡å®šå®šæ—¶å™¨</p><p>â€‹<strong>æƒ°æ€§æ¸…é™¤ï¼š</strong>è®¿é—®æ—¶åˆ¤æ–­ï¼Œå¯¹å†…å­˜ä¸å‹å¥½</p><p>â€‹<strong>å®šæ—¶æ‰«ææ¸…é™¤ï¼š</strong>å®šæ—¶100mséšæœº20ä¸ªæ£€æŸ¥è¿‡æœŸçš„å­—å…¸ï¼Œè‹¥å­˜åœ¨25%ä»¥ä¸Šåˆ™ç»§ç»­å¾ªç¯åˆ é™¤ã€‚</p><h4 id="4ã€redisè¯»å†™æ¨¡å¼"><a href="#4ã€redisè¯»å†™æ¨¡å¼" class="headerlink" title="4ã€redisè¯»å†™æ¨¡å¼"></a>4ã€redisè¯»å†™æ¨¡å¼</h4><p>â€‹<strong>CacheAsideæ—è·¯ç¼“å­˜</strong></p><p>å†™è¯·æ±‚æ›´æ–°æ•°æ®åº“ååˆ é™¤ç¼“å­˜æ•°æ®ã€‚è¯»è¯·æ±‚ä¸å‘½ä¸­æŸ¥è¯¢æ•°æ®åº“ï¼ŒæŸ¥è¯¢å®Œæˆå†™å…¥ç¼“å­˜</p><img src="https://img-blog.csdnimg.cn/20200806194316539.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x6eF92aWN0b3J5,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom: 15%;" /><img src="https://img-blog.csdnimg.cn/20200806194300826.png" style="zoom: 15%;" /><p>â€‹ä¸šåŠ¡ç«¯å¤„ç†æ‰€æœ‰æ•°æ®è®¿é—®ç»†èŠ‚ï¼ŒåŒæ—¶åˆ©ç”¨ <strong>Lazy è®¡ç®—</strong>çš„æ€æƒ³ï¼Œæ›´æ–° DB åï¼Œç›´æ¥åˆ é™¤ cache å¹¶é€šè¿‡ DB æ›´æ–°ï¼Œç¡®ä¿æ•°æ®ä»¥ DB ç»“æœä¸ºå‡†ï¼Œåˆ™å¯ä»¥å¤§å¹…é™ä½ cache å’Œ DB ä¸­æ•°æ®ä¸ä¸€è‡´çš„æ¦‚ç‡</p><p>â€‹å¦‚æœæ²¡æœ‰ä¸“é—¨çš„å­˜å‚¨æœåŠ¡ï¼ŒåŒæ—¶æ˜¯å¯¹<strong>æ•°æ®ä¸€è‡´æ€§è¦æ±‚æ¯”è¾ƒé«˜çš„ä¸šåŠ¡ï¼Œæˆ–è€…æ˜¯ç¼“å­˜æ•°æ®æ›´æ–°æ¯”è¾ƒå¤æ‚çš„ä¸šåŠ¡</strong>ï¼Œé€‚åˆä½¿ç”¨ Cache Aside æ¨¡å¼ã€‚å¦‚å¾®åšå‘å±•åˆæœŸï¼Œä¸å°‘ä¸šåŠ¡é‡‡ç”¨è¿™ç§æ¨¡å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å»¶è¿ŸåŒåˆ ï¼Œç”¨ä»¥ä¿è¯æœ€ç»ˆä¸€è‡´æ€§,é˜²æ­¢å°æ¦‚ç‡æ—§æ•°æ®è¯»è¯·æ±‚åœ¨ç¬¬ä¸€æ¬¡åˆ é™¤åæ›´æ–°æ•°æ®åº“</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(String key,Object data)</span>&#123;</span><br><span class="line">redis.delKey(key);</span><br><span class="line">db.updateData(data);</span><br><span class="line">Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">redis.delKey(key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é«˜å¹¶å‘ä¸‹ä¿è¯ç»å¯¹çš„ä¸€è‡´ï¼Œå…ˆåˆ ç¼“å­˜å†æ›´æ–°æ•°æ®ï¼Œéœ€è¦ç”¨åˆ°<strong>å†…å­˜é˜Ÿåˆ—åšå¼‚æ­¥ä¸²è¡ŒåŒ–</strong>ã€‚éé«˜å¹¶å‘åœºæ™¯ï¼Œå…ˆæ›´æ–°æ•°æ®å†åˆ é™¤ç¼“å­˜ï¼Œ<strong>å»¶è¿ŸåŒåˆ </strong>ç­–ç•¥åŸºæœ¬æ»¡è¶³äº†</p><ul><li>å…ˆæ›´æ–°dbååˆ é™¤redisï¼šåˆ é™¤rediså¤±è´¥åˆ™å‡ºç°é—®é¢˜</li><li>å…ˆåˆ redisåæ›´æ–°dbï¼šåˆ é™¤redisç¬é—´ï¼Œæ—§æ•°æ®è¢«å›å¡«redis</li><li>å…ˆåˆ redisåæ›´æ–°dbä¼‘çœ ååˆ redisï¼šåŒç¬¬äºŒç‚¹ï¼Œä¼‘çœ ååˆ é™¤redis å¯èƒ½å®•æœº</li><li>javaå†…éƒ¨jvmé˜Ÿåˆ—ï¼šä¸é€‚ç”¨åˆ†å¸ƒå¼åœºæ™¯ä¸”é™ä½å¹¶å‘</li></ul><p>â€‹<strong>Read&#x2F;Write Though</strong>ï¼ˆè¯»å†™ç©¿é€ï¼‰</p><p>â€‹<strong>å…ˆæŸ¥è¯¢</strong>ç¼“å­˜ä¸­æ•°æ®æ˜¯å¦å­˜åœ¨,å¦‚æœå­˜åœ¨åˆ™ç›´æ¥è¿”å›,å¦‚æœ<strong>ä¸å­˜åœ¨</strong>,åˆ™ç”±<strong>ç¼“å­˜ç»„ä»¶è´Ÿè´£ä»æ•°æ®åº“ä¸­åŒæ­¥åŠ è½½æ•°æ®.</strong></p><p>â€‹<img src="https://img-blog.csdnimg.cn/20200806194334623.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x6eF92aWN0b3J5,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom: 50%;" /></p><p>â€‹å…ˆæŸ¥è¯¢è¦<strong>å†™å…¥çš„æ•°æ®åœ¨ç¼“å­˜ä¸­</strong>æ˜¯å¦å·²ç»å­˜åœ¨,å¦‚æœå·²ç»å­˜åœ¨,åˆ™<strong>æ›´æ–°ç¼“å­˜ä¸­çš„æ•°æ®</strong>ï¼Œå¹¶ä¸”ç”±<strong>ç¼“å­˜ç»„ä»¶åŒæ­¥æ›´æ–°</strong>åˆ°æ•°æ®åº“ä¸­ã€‚</p><p>â€‹<img src="https://img-blog.csdnimg.cn/20200806194346642.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x6eF92aWN0b3J5,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom: 50%" /></p><p>â€‹ç”¨æˆ·<strong>è¯»æ“ä½œ</strong>è¾ƒå¤š.ç›¸è¾ƒäºCache asideè€Œè¨€æ›´é€‚åˆç¼“å­˜ä¸€è‡´çš„åœºæ™¯ã€‚ä½¿ç”¨ç®€å•å±è”½äº†<strong>åº•å±‚æ•°æ®åº“çš„æ“ä½œ</strong>,åªæ˜¯æ“ä½œç¼“å­˜.</p><p><strong>åœºæ™¯ï¼š</strong></p><p>å¾®åš Feed çš„ Outbox Vectorï¼ˆå³ç”¨æˆ·æœ€æ–°å¾®åšåˆ—è¡¨ï¼‰å°±é‡‡ç”¨è¿™ç§æ¨¡å¼ã€‚ä¸€äº›ç²‰ä¸è¾ƒå°‘ä¸”ä¸æ´»è·ƒçš„ç”¨æˆ·å‘è¡¨å¾®åšåï¼ŒVector æœåŠ¡ä¼šé¦–å…ˆæŸ¥è¯¢ Vector Cacheï¼Œå¦‚æœ cache ä¸­æ²¡æœ‰è¯¥ç”¨æˆ·çš„ Outbox è®°å½•ï¼Œåˆ™ä¸å†™è¯¥ç”¨æˆ·çš„ cache æ•°æ®ï¼Œç›´æ¥æ›´æ–° DB åå°±è¿”å›ï¼Œåªæœ‰ cache ä¸­å­˜åœ¨æ‰ä¼šé€šè¿‡ CAS æŒ‡ä»¤è¿›è¡Œæ›´æ–°ã€‚</p><p>â€‹</p><p><strong>Write Behind Cachingï¼ˆå¼‚æ­¥ç¼“å­˜å†™å…¥ï¼‰</strong></p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gorlsg74i6j31950e3dhs.jpg" alt="img" style="zoom:35%;" /><p>æ¯”å¦‚å¯¹ä¸€äº›è®¡æ•°ä¸šåŠ¡ï¼Œä¸€æ¡ <strong>Feed è¢«ç‚¹èµ</strong> 1ä¸‡ æ¬¡ï¼Œå¦‚æœæ›´æ–° 1ä¸‡ æ¬¡ DB ä»£ä»·å¾ˆå¤§ï¼Œè€Œåˆå¹¶æˆä¸€æ¬¡è¯·æ±‚ç›´æ¥åŠ  1ä¸‡ï¼Œåˆ™æ˜¯ä¸€ä¸ªéå¸¸è½»é‡çš„æ“ä½œã€‚ä½†è¿™ç§æ¨¡å‹æœ‰ä¸ªæ˜¾è‘—çš„ç¼ºç‚¹ï¼Œå³æ•°æ®çš„ä¸€è‡´æ€§å˜å·®ï¼Œç”šè‡³åœ¨ä¸€äº›æç«¯åœºæ™¯ä¸‹å¯èƒ½ä¼šä¸¢å¤±æ•°æ®ã€‚</p><h4 id="5ã€å¤šçº§ç¼“å­˜"><a href="#5ã€å¤šçº§ç¼“å­˜" class="headerlink" title="5ã€å¤šçº§ç¼“å­˜"></a>5ã€å¤šçº§ç¼“å­˜</h4><p><strong>æµè§ˆå™¨æœ¬åœ°å†…å­˜ç¼“å­˜ï¼š</strong>ä¸“é¢˜æ´»åŠ¨ï¼Œä¸€æ—¦ä¸Šçº¿ï¼Œåœ¨æ´»åŠ¨æœŸé—´æ˜¯ä¸ä¼šéšæ„å˜æ›´çš„ã€‚</p><p><strong>æµè§ˆå™¨æœ¬åœ°ç£ç›˜ç¼“å­˜ï¼š</strong>Logoç¼“å­˜ï¼Œå¤§å›¾ç‰‡æ‡’åŠ è½½</p><p><strong>æœåŠ¡ç«¯æœ¬åœ°å†…å­˜ç¼“å­˜ï¼š</strong>ç”±äºæ²¡æœ‰æŒä¹…åŒ–ï¼Œé‡å¯æ—¶å¿…å®šä¼šè¢«ç©¿é€</p><p><strong>æœåŠ¡ç«¯ç½‘ç»œå†…å­˜ç¼“å­˜</strong>ï¼šRedisç­‰ï¼Œé’ˆå¯¹ç©¿é€çš„æƒ…å†µä¸‹å¯ä»¥ç»§ç»­åˆ†å±‚ï¼Œå¿…é¡»ä¿è¯æ•°æ®åº“ä¸è¢«å‹å®</p><p><strong>ä¸ºä»€ä¹ˆä¸æ˜¯ä½¿ç”¨æœåŠ¡å™¨æœ¬åœ°ç£ç›˜åšç¼“å­˜ï¼Ÿ</strong></p><p>â€‹å½“ç³»ç»Ÿå¤„ç†å¤§é‡ç£ç›˜ IO æ“ä½œçš„æ—¶å€™ï¼Œç”±äº CPU å’Œå†…å­˜çš„é€Ÿåº¦è¿œé«˜äºç£ç›˜ï¼Œå¯èƒ½å¯¼è‡´ CPU è€—è´¹å¤ªå¤šæ—¶é—´ç­‰å¾…ç£ç›˜è¿”å›å¤„ç†çš„ç»“æœã€‚å¯¹äºè¿™éƒ¨åˆ† CPU åœ¨ IO ä¸Šçš„å¼€é”€ï¼Œæˆ‘ä»¬ç§°ä¸º <strong>iowait</strong></p><h3 id="Redisä¸ƒå¤§ç»å…¸é—®é¢˜"><a href="#Redisä¸ƒå¤§ç»å…¸é—®é¢˜" class="headerlink" title="Redisä¸ƒå¤§ç»å…¸é—®é¢˜"></a>Redisä¸ƒå¤§ç»å…¸é—®é¢˜</h3><h4 id="1ã€ç¼“å­˜é›ªå´©"><a href="#1ã€ç¼“å­˜é›ªå´©" class="headerlink" title="1ã€ç¼“å­˜é›ªå´©"></a>1ã€ç¼“å­˜é›ªå´©</h4><p>â€‹æŒ‡ç¼“å­˜åŒä¸€æ—¶é—´å¤§é¢ç§¯çš„å¤±æ•ˆï¼Œæ‰€ä»¥ï¼Œåé¢çš„è¯·æ±‚éƒ½ä¼šè½åˆ°æ•°æ®åº“ä¸Šï¼Œé€ æˆæ•°æ®åº“çŸ­æ—¶é—´å†…æ‰¿å—å¤§é‡è¯·æ±‚è€Œå´©æ‰ã€‚</p><p>â€‹<strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><ul><li><p><strong>Redis é«˜å¯ç”¨</strong>ï¼Œä¸»ä»+å“¨å…µï¼ŒRedis clusterï¼Œé¿å…å…¨ç›˜å´©æºƒ</p></li><li><p>æœ¬åœ° ehcache ç¼“å­˜ + hystrix <strong>é™æµ&amp;é™çº§</strong>ï¼Œé¿å… MySQL è¢«æ‰“æ­»</p></li><li><p>ç¼“å­˜æ•°æ®çš„<strong>è¿‡æœŸæ—¶é—´è®¾ç½®éšæœº</strong>ï¼Œé˜²æ­¢åŒä¸€æ—¶é—´å¤§é‡æ•°æ®è¿‡æœŸç°è±¡å‘ç”Ÿã€‚</p></li><li><p><strong>é€»è¾‘ä¸Šæ°¸ä¸è¿‡æœŸ</strong>ç»™æ¯ä¸€ä¸ªç¼“å­˜æ•°æ®å¢åŠ ç›¸åº”çš„<strong>ç¼“å­˜æ ‡è®°</strong>ï¼Œç¼“å­˜æ ‡è®°å¤±æ•ˆåˆ™æ›´æ–°æ•°æ®ç¼“å­˜</p></li><li><p><strong>å¤šçº§ç¼“å­˜</strong>ï¼Œå¤±æ•ˆæ—¶é€šè¿‡äºŒçº§æ›´æ–°ä¸€çº§ï¼Œç”±ç¬¬ä¸‰æ–¹æ’ä»¶æ›´æ–°äºŒçº§ç¼“å­˜ã€‚</p></li></ul><h4 id="2ã€ç¼“å­˜ç©¿é€"><a href="#2ã€ç¼“å­˜ç©¿é€" class="headerlink" title="2ã€ç¼“å­˜ç©¿é€"></a><strong>2ã€ç¼“å­˜ç©¿é€</strong></h4><p>â€‹<a href="https://blog.csdn.net/lin777lin/article/details/105666839">https://blog.csdn.net/lin777lin/article/details/105666839</a></p><p>â€‹ç¼“å­˜ç©¿é€æ˜¯æŒ‡ç¼“å­˜å’Œæ•°æ®åº“ä¸­éƒ½æ²¡æœ‰çš„æ•°æ®ï¼Œå¯¼è‡´æ‰€æœ‰çš„è¯·æ±‚éƒ½è½åˆ°æ•°æ®åº“ä¸Šï¼Œé€ æˆæ•°æ®åº“çŸ­æ—¶é—´å†…æ‰¿å—å¤§é‡è¯·æ±‚è€Œå´©æ‰ã€‚</p><p>â€‹<strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><p>â€‹1ï¼‰<strong>æ¥å£å±‚å¢åŠ æ ¡éªŒ</strong>ï¼Œå¦‚ç”¨æˆ·é‰´æƒæ ¡éªŒï¼ŒidåšåŸºç¡€æ ¡éªŒï¼Œid&lt;&#x3D;0çš„ç›´æ¥æ‹¦æˆªï¼›</p><p>â€‹2ï¼‰ä»ç¼“å­˜å–ä¸åˆ°çš„æ•°æ®ï¼Œåœ¨æ•°æ®åº“ä¸­ä¹Ÿæ²¡æœ‰å–åˆ°ï¼Œè¿™æ—¶ä¹Ÿå¯ä»¥å°†<strong>key-valueå¯¹å†™ä¸ºkey-null</strong>ï¼Œç¼“å­˜æœ‰æ•ˆæ—¶é—´å¯ä»¥è®¾ç½®çŸ­ç‚¹ï¼Œå¦‚30ç§’ã€‚è¿™æ ·å¯ä»¥é˜²æ­¢æ”»å‡»ç”¨æˆ·åå¤ç”¨åŒä¸€ä¸ªidæš´åŠ›æ”»å‡»ï¼›</p><p>â€‹3ï¼‰é‡‡ç”¨<strong>å¸ƒéš†è¿‡æ»¤å™¨</strong>ï¼Œå°†æ‰€æœ‰å¯èƒ½å­˜åœ¨çš„æ•°æ®å“ˆå¸Œåˆ°ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ bitmap ä¸­ï¼Œä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ä¼šè¢«è¿™ä¸ª bitmap æ‹¦æˆªæ‰ï¼Œä»è€Œé¿å…äº†å¯¹åº•å±‚å­˜å‚¨ç³»ç»Ÿçš„æŸ¥è¯¢å‹åŠ›ã€‚ï¼ˆå®å¯é”™æ€ä¸€åƒä¸å¯æ”¾è¿‡ä¸€äººï¼‰</p><h4 id="3ã€ç¼“å­˜å‡»ç©¿"><a href="#3ã€ç¼“å­˜å‡»ç©¿" class="headerlink" title="3ã€ç¼“å­˜å‡»ç©¿"></a><strong>3ã€ç¼“å­˜å‡»ç©¿</strong></h4><p>â€‹è¿™æ—¶ç”±äºå¹¶å‘ç”¨æˆ·ç‰¹åˆ«å¤šï¼ŒåŒæ—¶è¯»ç¼“å­˜æ²¡è¯»åˆ°æ•°æ®ï¼ŒåˆåŒæ—¶å»æ•°æ®åº“å»å–æ•°æ®ï¼Œå¼•èµ·æ•°æ®åº“å‹åŠ›ç¬é—´å¢å¤§ï¼Œé€ æˆè¿‡å¤§å‹åŠ›ã€‚å’Œç¼“å­˜é›ªå´©ä¸åŒçš„æ˜¯ï¼Œç¼“å­˜å‡»ç©¿æŒ‡å¹¶å‘æŸ¥åŒä¸€æ¡æ•°æ®ï¼Œç¼“å­˜é›ªå´©æ˜¯ä¸åŒæ•°æ®éƒ½è¿‡æœŸäº†ï¼Œå¾ˆå¤šæ•°æ®éƒ½æŸ¥ä¸åˆ°ä»è€ŒæŸ¥æ•°æ®åº“</p><p>â€‹<strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><p>â€‹1ï¼‰è®¾ç½®<strong>çƒ­ç‚¹æ•°æ®æ°¸è¿œä¸è¿‡æœŸ</strong>ï¼Œå¼‚æ­¥çº¿ç¨‹å¤„ç†ã€‚</p><p>â€‹2ï¼‰åŠ <strong>å†™å›æ“ä½œåŠ äº’æ–¥é”</strong>ï¼ŒæŸ¥è¯¢å¤±è´¥é»˜è®¤å€¼å¿«é€Ÿè¿”å›ã€‚</p><p>â€‹3ï¼‰ç¼“å­˜é¢„çƒ­</p><p>â€‹ç³»ç»Ÿä¸Šçº¿åï¼Œå°†ç›¸å…³<strong>å¯é¢„æœŸï¼ˆä¾‹å¦‚æ’è¡Œæ¦œï¼‰</strong>çƒ­ç‚¹æ•°æ®ç›´æ¥åŠ è½½åˆ°ç¼“å­˜ã€‚</p><p>â€‹å†™ä¸€ä¸ªç¼“å­˜åˆ·æ–°é¡µé¢ï¼Œæ‰‹åŠ¨æ“ä½œçƒ­ç‚¹æ•°æ®<strong>ï¼ˆä¾‹å¦‚å¹¿å‘Šæ¨å¹¿ï¼‰</strong>ä¸Šä¸‹çº¿ã€‚</p><h4 id="4ã€æ•°æ®ä¸ä¸€è‡´"><a href="#4ã€æ•°æ®ä¸ä¸€è‡´" class="headerlink" title="4ã€æ•°æ®ä¸ä¸€è‡´"></a>4ã€æ•°æ®ä¸ä¸€è‡´</h4><p>â€‹åœ¨ç¼“å­˜æœºå™¨çš„å¸¦å®½è¢«æ‰“æ»¡ï¼Œæˆ–è€…æœºæˆ¿ç½‘ç»œå‡ºç°æ³¢åŠ¨æ—¶ï¼Œç¼“å­˜æ›´æ–°å¤±è´¥ï¼Œæ–°æ•°æ®æ²¡æœ‰å†™å…¥ç¼“å­˜ï¼Œå°±ä¼šå¯¼è‡´ç¼“å­˜å’Œ DB çš„æ•°æ®ä¸ä¸€è‡´ã€‚ç¼“å­˜ rehash æ—¶ï¼ŒæŸä¸ªç¼“å­˜æœºå™¨åå¤å¼‚å¸¸ï¼Œå¤šæ¬¡ä¸Šä¸‹çº¿ï¼Œæ›´æ–°è¯·æ±‚å¤šæ¬¡ rehashã€‚è¿™æ ·ï¼Œä¸€ä»½æ•°æ®å­˜åœ¨å¤šä¸ªèŠ‚ç‚¹ï¼Œä¸”æ¯æ¬¡ rehash åªæ›´æ–°æŸä¸ªèŠ‚ç‚¹ï¼Œå¯¼è‡´ä¸€äº›ç¼“å­˜èŠ‚ç‚¹äº§ç”Ÿè„æ•°æ®ã€‚</p><ul><li><p>Cache æ›´æ–°å¤±è´¥åï¼Œå¯ä»¥è¿›è¡Œé‡è¯•ï¼Œåˆ™å°†é‡è¯•å¤±è´¥çš„ key å†™å…¥mqï¼Œå¾…ç¼“å­˜è®¿é—®æ¢å¤åï¼Œå°†è¿™äº› key ä»ç¼“å­˜åˆ é™¤ã€‚è¿™äº› key åœ¨å†æ¬¡è¢«æŸ¥è¯¢æ—¶ï¼Œé‡æ–°ä» DB åŠ è½½ï¼Œä»è€Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§</p></li><li><p>ç¼“å­˜æ—¶é—´é€‚å½“è°ƒçŸ­ï¼Œè®©ç¼“å­˜æ•°æ®åŠæ—©è¿‡æœŸåï¼Œç„¶åä» DB é‡æ–°åŠ è½½ï¼Œç¡®ä¿æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚</p></li><li><p>ä¸é‡‡ç”¨ rehash æ¼‚ç§»ç­–ç•¥ï¼Œè€Œé‡‡ç”¨ç¼“å­˜åˆ†å±‚ç­–ç•¥ï¼Œå°½é‡é¿å…è„æ•°æ®äº§ç”Ÿã€‚</p></li></ul><h4 id="5ã€æ•°æ®å¹¶å‘ç«äº‰"><a href="#5ã€æ•°æ®å¹¶å‘ç«äº‰" class="headerlink" title="5ã€æ•°æ®å¹¶å‘ç«äº‰"></a>5ã€æ•°æ®å¹¶å‘ç«äº‰</h4><p>â€‹æ•°æ®å¹¶å‘ç«äº‰åœ¨å¤§æµé‡ç³»ç»Ÿä¹Ÿæ¯”è¾ƒå¸¸è§ï¼Œæ¯”å¦‚è½¦ç¥¨ç³»ç»Ÿï¼Œå¦‚æœæŸä¸ªç«è½¦è½¦æ¬¡ç¼“å­˜ä¿¡æ¯è¿‡æœŸï¼Œä½†ä»ç„¶æœ‰å¤§é‡ç”¨æˆ·åœ¨æŸ¥è¯¢è¯¥è½¦æ¬¡ä¿¡æ¯ã€‚åˆæ¯”å¦‚å¾®åšç³»ç»Ÿä¸­ï¼Œå¦‚æœæŸæ¡å¾®åšæ­£å¥½è¢«ç¼“å­˜æ·˜æ±°ï¼Œä½†è¿™æ¡å¾®åšä»ç„¶æœ‰å¤§é‡çš„è½¬å‘ã€è¯„è®ºã€èµã€‚ä¸Šè¿°æƒ…å†µéƒ½ä¼šé€ æˆå¹¶å‘ç«äº‰è¯»å–çš„é—®é¢˜ã€‚</p><ul><li>â€‹åŠ <strong>å†™å›æ“ä½œåŠ äº’æ–¥é”</strong>ï¼ŒæŸ¥è¯¢å¤±è´¥é»˜è®¤å€¼å¿«é€Ÿè¿”å›ã€‚</li><li>â€‹å¯¹ç¼“å­˜æ•°æ®ä¿æŒå¤šä¸ªå¤‡ä»½ï¼Œå‡å°‘å¹¶å‘ç«äº‰çš„æ¦‚ç‡</li></ul><p>â€‹</p><h4 id="6ã€çƒ­ç‚¹keyé—®é¢˜"><a href="#6ã€çƒ­ç‚¹keyé—®é¢˜" class="headerlink" title="6ã€çƒ­ç‚¹keyé—®é¢˜"></a>6ã€çƒ­ç‚¹keyé—®é¢˜</h4><p>â€‹æ˜æ˜Ÿç»“å©šã€ç¦»å©šã€å‡ºè½¨è¿™ç§ç‰¹æ®Šçªå‘äº‹ä»¶ï¼Œæ¯”å¦‚å¥¥è¿ã€æ˜¥èŠ‚è¿™äº›é‡å¤§æ´»åŠ¨æˆ–èŠ‚æ—¥ï¼Œè¿˜æ¯”å¦‚ç§’æ€ã€åŒ12ã€618 ç­‰çº¿ä¸Šä¿ƒé”€æ´»åŠ¨ï¼Œéƒ½å¾ˆå®¹æ˜“å‡ºç° Hot key çš„æƒ…å†µã€‚</p><p>å¦‚ä½•æå‰å‘ç°HotKeyï¼Ÿ</p><ul><li>å¯¹äºé‡è¦èŠ‚å‡æ—¥ã€çº¿ä¸Šä¿ƒé”€æ´»åŠ¨è¿™äº›æå‰å·²çŸ¥çš„äº‹æƒ…ï¼Œå¯ä»¥æå‰è¯„ä¼°å‡ºå¯èƒ½çš„çƒ­ key æ¥ã€‚</li><li>è€Œå¯¹äºçªå‘äº‹ä»¶ï¼Œæ— æ³•æå‰è¯„ä¼°ï¼Œå¯ä»¥<strong>é€šè¿‡ Sparkï¼Œå¯¹åº”æµä»»åŠ¡è¿›è¡Œå®æ—¶åˆ†æ</strong>ï¼ŒåŠæ—¶å‘ç°æ–°å‘å¸ƒçš„çƒ­ç‚¹ keyã€‚è€Œå¯¹äºä¹‹å‰å·²å‘å‡ºçš„äº‹æƒ…ï¼Œé€æ­¥å‘é…µæˆä¸ºçƒ­ key çš„ï¼Œåˆ™å¯ä»¥é€šè¿‡ Hadoop å¯¹æ‰¹å¤„ç†ä»»åŠ¡ç¦»çº¿è®¡ç®—ï¼Œæ‰¾å‡ºæœ€è¿‘å†å²æ•°æ®ä¸­çš„é«˜é¢‘çƒ­ keyã€‚</li></ul><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><ul><li><p>è¿™ n ä¸ª key åˆ†æ•£å­˜åœ¨å¤šä¸ªç¼“å­˜èŠ‚ç‚¹ï¼Œç„¶å client ç«¯è¯·æ±‚æ—¶ï¼Œéšæœºè®¿é—®å…¶ä¸­æŸä¸ªåç¼€çš„ hotkeyï¼Œè¿™æ ·å°±å¯ä»¥æŠŠçƒ­ key çš„è¯·æ±‚æ‰“æ•£ï¼Œé¿å…ä¸€ä¸ªç¼“å­˜èŠ‚ç‚¹è¿‡è½½</p></li><li><p>ç¼“å­˜é›†ç¾¤å¯ä»¥å•èŠ‚ç‚¹è¿›è¡Œä¸»ä»å¤åˆ¶å’Œå‚ç›´æ‰©å®¹</p></li><li><p>åˆ©ç”¨åº”ç”¨å†…çš„å‰ç½®ç¼“å­˜ï¼Œä½†æ˜¯éœ€æ³¨æ„éœ€è¦è®¾ç½®ä¸Šé™</p></li><li><p>å»¶è¿Ÿä¸æ•æ„Ÿï¼Œå®šæ—¶åˆ·æ–°ï¼Œå®æ—¶æ„ŸçŸ¥ç”¨ä¸»åŠ¨åˆ·æ–°</p></li><li><p>å’Œç¼“å­˜ç©¿é€ä¸€æ ·ï¼Œé™åˆ¶é€ƒé€¸æµé‡ï¼Œå•è¯·æ±‚è¿›è¡Œæ•°æ®å›æºå¹¶åˆ·æ–°å‰ç½®</p></li><li><p>æ— è®ºå¦‚ä½•è®¾è®¡ï¼Œæœ€åéƒ½è¦å†™ä¸€ä¸ªå…œåº•é€»è¾‘ï¼Œåƒä¸‡çº§æµé‡è¯´æ¥å°±æ¥</p></li></ul><h4 id="7ã€BigKeyé—®é¢˜"><a href="#7ã€BigKeyé—®é¢˜" class="headerlink" title="7ã€BigKeyé—®é¢˜"></a>7ã€BigKeyé—®é¢˜</h4><p>â€‹æ¯”å¦‚äº’è”ç½‘ç³»ç»Ÿä¸­éœ€è¦ä¿å­˜ç”¨æˆ·æœ€æ–° 1ä¸‡ ä¸ªç²‰ä¸çš„ä¸šåŠ¡ï¼Œæ¯”å¦‚ä¸€ä¸ªç”¨æˆ·ä¸ªäººä¿¡æ¯ç¼“å­˜ï¼ŒåŒ…æ‹¬åŸºæœ¬èµ„æ–™ã€å…³ç³»å›¾è°±è®¡æ•°ã€å‘ feed ç»Ÿè®¡ç­‰ã€‚å¾®åšçš„ feed å†…å®¹ç¼“å­˜ä¹Ÿå¾ˆå®¹æ˜“å‡ºç°ï¼Œä¸€èˆ¬ç”¨æˆ·å¾®åšåœ¨ 140 å­—ä»¥å†…ï¼Œä½†å¾ˆå¤šç”¨æˆ·ä¹Ÿä¼šå‘è¡¨ 1åƒ å­—ç”šè‡³æ›´é•¿çš„å¾®åšå†…å®¹ï¼Œè¿™äº›é•¿å¾®åšä¹Ÿå°±æˆäº†å¤§ key</p><ul><li>é¦–å…ˆRedisåº•å±‚æ•°æ®ç»“æ„é‡Œï¼Œæ ¹æ®Valueçš„ä¸åŒï¼Œä¼šè¿›è¡Œæ•°æ®ç»“æ„çš„é‡æ–°é€‰æ‹©</li><li>å¯ä»¥æ‰©å±•æ–°çš„æ•°æ®ç»“æ„ï¼Œè¿›è¡Œåºåˆ—åŒ–æ„å»ºï¼Œç„¶åé€šè¿‡ restore ä¸€æ¬¡æ€§å†™å…¥</li><li>å°†å¤§ key åˆ†æ‹†ä¸ºå¤šä¸ª keyï¼Œè®¾ç½®è¾ƒé•¿çš„è¿‡æœŸæ—¶é—´</li></ul><h3 id="Redisåˆ†åŒºå®¹é”™"><a href="#Redisåˆ†åŒºå®¹é”™" class="headerlink" title="Redisåˆ†åŒºå®¹é”™"></a>Redisåˆ†åŒºå®¹é”™</h3><h4 id="1ã€redisæ•°æ®åˆ†åŒº"><a href="#1ã€redisæ•°æ®åˆ†åŒº" class="headerlink" title="1ã€redisæ•°æ®åˆ†åŒº"></a><strong>1ã€redisæ•°æ®åˆ†åŒº</strong></h4><p><strong>Hashï¼šï¼ˆä¸ç¨³å®šï¼‰</strong></p><p>â€‹å®¢æˆ·ç«¯åˆ†ç‰‡ï¼šå“ˆå¸Œ+å–ä½™</p><p>â€‹èŠ‚ç‚¹ä¼¸ç¼©ï¼šæ•°æ®èŠ‚ç‚¹å…³ç³»å˜åŒ–ï¼Œå¯¼è‡´æ•°æ®è¿ç§»</p><p>â€‹è¿ç§»æ•°é‡å’Œæ·»åŠ èŠ‚ç‚¹æ•°é‡æœ‰å…³ï¼šå»ºè®®ç¿»å€æ‰©å®¹</p><p>â€‹ä¸€ä¸ªç®€å•ç›´è§‚çš„æƒ³æ³•æ˜¯ç›´æ¥ç”¨Hashæ¥è®¡ç®—ï¼Œä»¥Keyåšå“ˆå¸Œåå¯¹èŠ‚ç‚¹æ•°å–æ¨¡ã€‚å¯ä»¥çœ‹å‡ºï¼Œåœ¨keyè¶³å¤Ÿåˆ†æ•£çš„æƒ…å†µä¸‹ï¼Œå‡åŒ€æ€§å¯ä»¥è·å¾—ï¼Œä½†ä¸€æ—¦æœ‰èŠ‚ç‚¹åŠ å…¥æˆ–é€€å‡ºï¼Œæ‰€æœ‰çš„åŸæœ‰èŠ‚ç‚¹éƒ½ä¼šå—åˆ°å½±å“ï¼Œç¨³å®šæ€§æ— ä»è°ˆèµ·ã€‚</p><p><strong>ä¸€è‡´æ€§Hashï¼šï¼ˆä¸å‡è¡¡ï¼‰</strong></p><p>â€‹å®¢æˆ·ç«¯åˆ†ç‰‡ï¼šå“ˆå¸Œ+é¡ºæ—¶é’ˆï¼ˆä¼˜åŒ–å–ä½™ï¼‰</p><p>â€‹èŠ‚ç‚¹ä¼¸ç¼©ï¼šåªå½±å“é‚»è¿‘èŠ‚ç‚¹ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰æ•°æ®è¿ç§»</p><p>â€‹ç¿»å€ä¼¸ç¼©ï¼šä¿è¯æœ€å°è¿ç§»æ•°æ®å’Œè´Ÿè½½å‡è¡¡</p><p>â€‹ä¸€è‡´æ€§Hashå¯ä»¥å¾ˆå¥½çš„è§£å†³ç¨³å®šé—®é¢˜ï¼Œå¯ä»¥å°†æ‰€æœ‰çš„å­˜å‚¨èŠ‚ç‚¹æ’åˆ—åœ¨æ”¶å°¾ç›¸æ¥çš„Hashç¯ä¸Šï¼Œæ¯ä¸ªkeyåœ¨è®¡ç®—Hashåä¼šé¡ºæ—¶é’ˆæ‰¾åˆ°å…ˆé‡åˆ°çš„ä¸€ç»„å­˜å‚¨èŠ‚ç‚¹å­˜æ”¾ã€‚è€Œå½“æœ‰èŠ‚ç‚¹åŠ å…¥æˆ–é€€å‡ºæ—¶ï¼Œä»…å½±å“è¯¥èŠ‚ç‚¹åœ¨Hashç¯ä¸Šé¡ºæ—¶é’ˆç›¸é‚»çš„åç»­èŠ‚ç‚¹ï¼Œå°†æ•°æ®ä»è¯¥èŠ‚ç‚¹æ¥æ”¶æˆ–è€…ç»™äºˆã€‚ä½†è¿™åˆå¸¦æ¥å‡åŒ€æ€§çš„é—®é¢˜ï¼Œå³ä½¿å¯ä»¥å°†å­˜å‚¨èŠ‚ç‚¹ç­‰è·æ’åˆ—ï¼Œä¹Ÿä¼šåœ¨<strong>å­˜å‚¨èŠ‚ç‚¹ä¸ªæ•°å˜åŒ–æ—¶å¸¦æ¥æ•°æ®çš„ä¸å‡åŒ€</strong>ã€‚</p><p><strong>Codisçš„Hashæ§½</strong></p><p>â€‹Codis å°†æ‰€æœ‰çš„ key é»˜è®¤åˆ’åˆ†ä¸º 1024 ä¸ªæ§½ä½(slot)ï¼Œå®ƒé¦–å…ˆå¯¹å®¢æˆ·ç«¯ä¼ è¿‡æ¥çš„ key è¿›è¡Œ crc32 è¿ç®—è®¡ç®— å“ˆå¸Œå€¼ï¼Œå†å°† hash åçš„æ•´æ•°å€¼å¯¹ 1024 è¿™ä¸ªæ•´æ•°è¿›è¡Œå–æ¨¡å¾—åˆ°ä¸€ä¸ªä½™æ•°ï¼Œè¿™ä¸ªä½™æ•°å°±æ˜¯å¯¹åº” key çš„æ§½ä½ã€‚</p><p><strong>RedisCluster</strong></p><p>â€‹Redis-clusteræŠŠæ‰€æœ‰çš„ç‰©ç†èŠ‚ç‚¹æ˜ å°„åˆ°[0-16383]ä¸ª<strong>slot</strong>ä¸Š,å¯¹keyé‡‡ç”¨crc16ç®—æ³•å¾—åˆ°hashå€¼åå¯¹16384å–æ¨¡ï¼ŒåŸºæœ¬ä¸Šé‡‡ç”¨å¹³å‡åˆ†é…å’Œè¿ç»­åˆ†é…çš„æ–¹å¼ã€‚</p><h4 id="2ã€ä¸»ä»æ¨¡å¼-ç®€å•"><a href="#2ã€ä¸»ä»æ¨¡å¼-ç®€å•" class="headerlink" title="2ã€ä¸»ä»æ¨¡å¼&#x3D;ç®€å•"></a><strong>2ã€ä¸»ä»æ¨¡å¼&#x3D;ç®€å•</strong></h4><p>â€‹ä¸»ä»æ¨¡å¼æœ€å¤§çš„ä¼˜ç‚¹æ˜¯<strong>éƒ¨ç½²ç®€å•</strong>ï¼Œæœ€å°‘<strong>ä¸¤ä¸ªèŠ‚ç‚¹ä¾¿å¯ä»¥æ„æˆä¸»ä»æ¨¡å¼</strong>ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡<strong>è¯»å†™åˆ†ç¦»é¿å…è¯»å’Œå†™åŒæ—¶ä¸å¯ç”¨</strong>ã€‚ä¸è¿‡ï¼Œä¸€æ—¦ Master èŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œä¸»ä»èŠ‚ç‚¹å°±<strong>æ— æ³•è‡ªåŠ¨åˆ‡æ¢</strong>ï¼Œç›´æ¥å¯¼è‡´ SLA ä¸‹é™ã€‚æ‰€ä»¥ï¼Œä¸»ä»æ¨¡å¼ä¸€èˆ¬<strong>é€‚åˆä¸šåŠ¡å‘å±•åˆæœŸï¼Œå¹¶å‘é‡ä½ï¼Œè¿ç»´æˆæœ¬ä½</strong>çš„æƒ…å†µ</p><img src="https://s0.lgstatic.com/i/image/M00/80/25/Ciqc1F_QgPOAaL8TAAC5EiNlvo4795.png" alt="Drawing 1.png" style="zoom:50%;" /><p><strong>ä¸»ä»å¤åˆ¶åŸç†ï¼š</strong></p><p>â€‹â‘ é€šè¿‡ä»æœåŠ¡å™¨å‘é€åˆ°PSYNCå‘½ä»¤ç»™ä¸»æœåŠ¡å™¨</p><p>â€‹â‘¡å¦‚æœæ˜¯é¦–æ¬¡è¿æ¥ï¼Œè§¦å‘ä¸€æ¬¡<strong>å…¨é‡å¤åˆ¶</strong>ã€‚æ­¤æ—¶ä¸»èŠ‚ç‚¹ä¼šå¯åŠ¨ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œç”Ÿæˆ RDB å¿«ç…§æ–‡ä»¶</p><p>â€‹â‘¢ä¸»èŠ‚ç‚¹ä¼šå°†è¿™ä¸ª RDB å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œslave ä¼šå…ˆå†™å…¥æœ¬åœ°ç£ç›˜ï¼Œå†ä»æœ¬åœ°ç£ç›˜åŠ è½½åˆ°å†…å­˜ä¸­</p><p>â€‹â‘£masterä¼šå°†æ­¤è¿‡ç¨‹ä¸­çš„å†™å‘½ä»¤å†™å…¥ç¼“å­˜ï¼Œä»èŠ‚ç‚¹<strong>å®æ—¶åŒæ­¥</strong>è¿™äº›æ•°æ®</p><p>â€‹â‘¤å¦‚æœç½‘ç»œæ–­å¼€äº†è¿æ¥ï¼Œè‡ªåŠ¨é‡è¿åä¸»èŠ‚ç‚¹é€šè¿‡å‘½ä»¤ä¼ æ’­<strong>å¢é‡å¤åˆ¶</strong>ç»™ä»èŠ‚ç‚¹éƒ¨åˆ†ç¼ºå°‘çš„æ•°æ®</p><p><strong>ç¼ºç‚¹</strong></p><p>â€‹æ‰€æœ‰çš„slaveèŠ‚ç‚¹æ•°æ®çš„å¤åˆ¶å’ŒåŒæ­¥éƒ½ç”±masterèŠ‚ç‚¹æ¥å¤„ç†ï¼Œä¼šç…§æˆmasterèŠ‚ç‚¹å‹åŠ›å¤ªå¤§ï¼Œä½¿ç”¨ä¸»ä»ä»ç»“æ„æ¥è§£å†³ï¼Œredis4.0ä¸­å¼•å…¥psync2 è§£å†³äº†slaveé‡å¯åä»ç„¶å¯ä»¥å¢é‡åŒæ­¥ã€‚</p><h4 id="3ã€å“¨å…µæ¨¡å¼-è¯»å¤š"><a href="#3ã€å“¨å…µæ¨¡å¼-è¯»å¤š" class="headerlink" title="3ã€å“¨å…µæ¨¡å¼&#x3D;è¯»å¤š"></a>3ã€<strong>å“¨å…µæ¨¡å¼</strong>&#x3D;è¯»å¤š</h4><p>â€‹ç”±ä¸€ä¸ªæˆ–å¤šä¸ªsentinelå®ä¾‹ç»„æˆsentinelé›†ç¾¤å¯ä»¥ç›‘è§†ä¸€ä¸ªæˆ–å¤šä¸ªä¸»æœåŠ¡å™¨å’Œå¤šä¸ªä»æœåŠ¡å™¨ã€‚<strong>å“¨å…µæ¨¡å¼é€‚åˆè¯»è¯·æ±‚è¿œå¤šäºå†™è¯·æ±‚çš„ä¸šåŠ¡åœºæ™¯ï¼Œæ¯”å¦‚åœ¨ç§’æ€ç³»ç»Ÿ</strong>ä¸­ç”¨æ¥ç¼“å­˜æ´»åŠ¨ä¿¡æ¯ã€‚ å¦‚æœå†™è¯·æ±‚è¾ƒå¤šï¼Œå½“é›†ç¾¤ Slave èŠ‚ç‚¹æ•°é‡å¤šäº†åï¼ŒMaster èŠ‚ç‚¹åŒæ­¥æ•°æ®çš„å‹åŠ›ä¼šéå¸¸å¤§ã€‚</p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gluq6vlvglj30nw0e076f.jpg" alt="image-20201220231241725" style="zoom:50%;" /><p>å½“ä¸»æœåŠ¡å™¨è¿›å…¥ä¸‹çº¿çŠ¶æ€æ—¶ï¼Œsentinelå¯ä»¥å°†è¯¥ä¸»æœåŠ¡å™¨ä¸‹çš„æŸä¸€ä»æœåŠ¡å™¨å‡çº§ä¸ºä¸»æœåŠ¡å™¨ç»§ç»­æä¾›æœåŠ¡ï¼Œä»è€Œä¿è¯redisçš„é«˜å¯ç”¨æ€§ã€‚</p><p><strong>æ£€æµ‹ä¸»è§‚ä¸‹çº¿çŠ¶æ€</strong></p><p>â€‹Sentinelæ¯ç§’ä¸€æ¬¡å‘æ‰€æœ‰ä¸å®ƒå»ºç«‹äº†å‘½ä»¤è¿æ¥çš„å®ä¾‹(ä¸»æœåŠ¡å™¨ã€ä»æœåŠ¡å™¨å’Œå…¶ä»–Sentinel)å‘é€PINGå‘½ ä»¤</p><p>â€‹å®ä¾‹åœ¨down-after-millisecondsæ¯«ç§’å†…è¿”å›æ— æ•ˆå›å¤Sentinelå°±ä¼šè®¤ä¸ºè¯¥å®ä¾‹ä¸»è§‚ä¸‹çº¿(<strong>SDown</strong>)</p><p><strong>æ£€æŸ¥å®¢è§‚ä¸‹çº¿çŠ¶æ€</strong></p><p>â€‹å½“ä¸€ä¸ªSentinelå°†ä¸€ä¸ªä¸»æœåŠ¡å™¨åˆ¤æ–­ä¸ºä¸»è§‚ä¸‹çº¿å ï¼ŒSentinelä¼šå‘ç›‘æ§è¿™ä¸ªä¸»æœåŠ¡å™¨çš„æ‰€æœ‰å…¶ä»–Sentinelå‘é€æŸ¥è¯¢ä¸»æœºçŠ¶æ€çš„å‘½ä»¤</p><p>â€‹å¦‚æœè¾¾åˆ°Sentinelé…ç½®ä¸­çš„quorumæ•°é‡çš„Sentinelå®ä¾‹éƒ½åˆ¤æ–­ä¸»æœåŠ¡å™¨ä¸ºä¸»è§‚ä¸‹çº¿ï¼Œåˆ™è¯¥ä¸»æœåŠ¡å™¨å°±ä¼šè¢«åˆ¤å®šä¸ºå®¢è§‚ä¸‹çº¿(<strong>ODown</strong>)ã€‚</p><p><strong>é€‰ä¸¾Leader Sentinel</strong> </p><p>â€‹å½“ä¸€ä¸ªä¸»æœåŠ¡å™¨è¢«åˆ¤å®šä¸ºå®¢è§‚ä¸‹çº¿åï¼Œç›‘è§†è¿™ä¸ªä¸»æœåŠ¡å™¨çš„æ‰€æœ‰Sentinelä¼šé€šè¿‡é€‰ä¸¾ç®—æ³•(raft)ï¼Œé€‰å‡ºä¸€ä¸ªLeader Sentinelå»æ‰§è¡Œ**failover(æ•…éšœè½¬ç§»)**æ“ä½œã€‚</p><p>â€‹<strong>Raftç®—æ³•</strong></p><p>â€‹Raftåè®®æ˜¯ç”¨æ¥è§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿä¸€è‡´æ€§é—®é¢˜çš„åè®®ã€‚ Raftåè®®æè¿°çš„èŠ‚ç‚¹å…±æœ‰ä¸‰ç§çŠ¶æ€:Leader, Follower, Candidateã€‚ Raftåè®®å°†æ—¶é—´åˆ‡åˆ†ä¸ºä¸€ä¸ªä¸ªçš„Term(ä»»æœŸ)ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç§â€œé€»è¾‘æ—¶é—´â€ã€‚ é€‰ä¸¾æµç¨‹:<br>     â‘ Rafté‡‡ç”¨å¿ƒè·³æœºåˆ¶è§¦å‘Leaderé€‰ä¸¾ç³»ç»Ÿå¯åŠ¨åï¼Œå…¨éƒ¨èŠ‚ç‚¹åˆå§‹åŒ–ä¸ºFollowerï¼Œtermä¸º0</p><p>â€‹ â‘¡èŠ‚ç‚¹å¦‚æœæ”¶åˆ°äº†RequestVoteæˆ–è€…AppendEntriesï¼Œå°±ä¼šä¿æŒè‡ªå·±çš„Followerèº«ä»½ </p><p>â€‹ â‘¢èŠ‚ç‚¹å¦‚æœä¸€æ®µæ—¶é—´å†…æ²¡æ”¶åˆ°AppendEntriesæ¶ˆæ¯ï¼Œåœ¨è¯¥èŠ‚ç‚¹çš„è¶…æ—¶æ—¶é—´å†…è¿˜æ²¡å‘ç°Leaderï¼ŒFollowerå°±ä¼šè½¬æ¢æˆCandidateï¼Œè‡ªå·±å¼€å§‹ç«é€‰Leaderã€‚ ä¸€æ—¦è½¬åŒ–ä¸ºCandidateï¼Œè¯¥èŠ‚ç‚¹ç«‹å³å¼€å§‹ä¸‹é¢å‡ ä»¶äº‹æƒ…:<br>â€‹â€“å¢åŠ è‡ªå·±çš„termï¼Œå¯åŠ¨ä¸€ä¸ªæ–°çš„å®šæ—¶å™¨<br>â€‹â€“ç»™è‡ªå·±æŠ•ä¸€ç¥¨ï¼Œå‘æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹å‘é€RequestVoteï¼Œå¹¶ç­‰å¾…å…¶ä»–èŠ‚ç‚¹çš„å›å¤ã€‚</p><p>â€‹ â‘£å¦‚æœåœ¨è®¡æ—¶å™¨è¶…æ—¶å‰ï¼ŒèŠ‚ç‚¹æ”¶åˆ°å¤šæ•°èŠ‚ç‚¹çš„åŒæ„æŠ•ç¥¨ï¼Œå°±è½¬æ¢æˆLeaderã€‚åŒæ—¶é€šè¿‡ AppendEntriesï¼Œå‘å…¶ä»–èŠ‚ç‚¹å‘é€é€šçŸ¥ã€‚</p><p>â€‹ â‘¤æ¯ä¸ªèŠ‚ç‚¹åœ¨ä¸€ä¸ªtermå†…åªèƒ½æŠ•ä¸€ç¥¨ï¼Œé‡‡å–å…ˆåˆ°å…ˆå¾—çš„ç­–ç•¥ï¼ŒCandidateæŠ•è‡ªå·±ï¼Œ Followerä¼šæŠ•ç»™ç¬¬ä¸€ä¸ªæ”¶åˆ°RequestVoteçš„èŠ‚ç‚¹ã€‚</p><p>â€‹ â‘¥Raftåè®®çš„å®šæ—¶å™¨é‡‡å–éšæœºè¶…æ—¶æ—¶é—´ï¼ˆé€‰ä¸¾çš„å…³é”®ï¼‰ï¼Œå…ˆè½¬ä¸ºCandidateçš„èŠ‚ç‚¹ä¼šå…ˆå‘èµ·æŠ•ç¥¨ï¼Œä»è€Œè·å¾—å¤šæ•°ç¥¨ã€‚</p><p><strong>ä¸»æœåŠ¡å™¨çš„é€‰æ‹©</strong></p><p>â€‹å½“é€‰ä¸¾å‡ºLeader Sentinelåï¼ŒLeader Sentinelä¼šæ ¹æ®ä»¥ä¸‹è§„åˆ™å»ä»æœåŠ¡å™¨ä¸­é€‰æ‹©å‡ºæ–°çš„ä¸»æœåŠ¡å™¨ã€‚</p><ol><li>è¿‡æ»¤æ‰ä¸»è§‚ã€å®¢è§‚ä¸‹çº¿çš„èŠ‚ç‚¹</li><li>é€‰æ‹©é…ç½®slave-priorityæœ€é«˜çš„èŠ‚ç‚¹ï¼Œå¦‚æœæœ‰åˆ™è¿”å›æ²¡æœ‰å°±ç»§ç»­é€‰æ‹©</li><li>é€‰æ‹©å‡ºå¤åˆ¶åç§»é‡æœ€å¤§çš„ç³»èŠ‚ç‚¹ï¼Œå› ä¸ºå¤åˆ¶åç§»é‡è¶Šå¤§åˆ™æ•°æ®å¤åˆ¶çš„è¶Šå®Œæ•´</li><li>é€‰æ‹©run_idæœ€å°çš„èŠ‚ç‚¹ï¼Œå› ä¸ºrun_idè¶Šå°è¯´æ˜é‡å¯æ¬¡æ•°è¶Šå°‘</li></ol><p><strong>æ•…éšœè½¬ç§»</strong></p><p>â€‹å½“Leader Sentinelå®Œæˆæ–°çš„ä¸»æœåŠ¡å™¨é€‰æ‹©åï¼ŒLeader Sentinelä¼šå¯¹ä¸‹çº¿çš„ä¸»æœåŠ¡å™¨æ‰§è¡Œæ•…éšœè½¬ç§»æ“ä½œï¼Œä¸»è¦æœ‰ä¸‰ä¸ªæ­¥éª¤:</p><p>â€‹1ã€å®ƒä¼šå°†å¤±æ•ˆ Master çš„å…¶ä¸­ä¸€ä¸ª Slave å‡çº§ä¸ºæ–°çš„ Master , å¹¶è®©å¤±æ•ˆ Master çš„å…¶ä»– Slave æ”¹ä¸ºå¤åˆ¶æ–°çš„ Master ;</p><p>â€‹2ã€å½“å®¢æˆ·ç«¯è¯•å›¾è¿æ¥å¤±æ•ˆçš„ Master æ—¶ï¼Œé›†ç¾¤ä¼šå‘å®¢æˆ·ç«¯è¿”å›æ–° Master çš„åœ°å€ï¼Œä½¿å¾—é›†ç¾¤å½“å‰çŠ¶æ€åªæœ‰ä¸€ä¸ªMasterã€‚</p><p>â€‹3ã€Master å’Œ Slave æœåŠ¡å™¨åˆ‡æ¢åï¼Œ Master çš„ redis.conf ã€ Slave çš„ redis.conf å’Œ sentinel.conf çš„é…ç½®æ–‡ä»¶çš„å†…å®¹éƒ½ä¼šå‘ç”Ÿç›¸åº”çš„æ”¹å˜ï¼Œå³ Master ä¸»æœåŠ¡å™¨çš„ redis.confé…ç½®æ–‡ä»¶ä¸­ä¼šå¤šä¸€è¡Œ replicaof çš„é…ç½®ï¼Œ sentinel.conf çš„ç›‘æ§ç›®æ ‡ä¼šéšä¹‹è°ƒæ¢ã€‚</p><h4 id="4ã€é›†ç¾¤æ¨¡å¼-å†™å¤š"><a href="#4ã€é›†ç¾¤æ¨¡å¼-å†™å¤š" class="headerlink" title="4ã€é›†ç¾¤æ¨¡å¼&#x3D;å†™å¤š"></a>4ã€é›†ç¾¤æ¨¡å¼&#x3D;å†™å¤š</h4><p>â€‹ä¸ºäº†é¿å…å•ä¸€èŠ‚ç‚¹è´Ÿè½½è¿‡é«˜å¯¼è‡´ä¸ç¨³å®šï¼Œé›†ç¾¤æ¨¡å¼é‡‡ç”¨<strong>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æˆ–è€…å“ˆå¸Œæ§½çš„æ–¹æ³•</strong>å°† Key åˆ†å¸ƒåˆ°å„ä¸ªèŠ‚ç‚¹ä¸Šã€‚å…¶ä¸­ï¼Œæ¯ä¸ª Master èŠ‚ç‚¹åè·Ÿè‹¥å¹²ä¸ª Slave èŠ‚ç‚¹ï¼Œç”¨äº<strong>å‡ºç°æ•…éšœæ—¶åšä¸»å¤‡åˆ‡æ¢</strong>ï¼Œå®¢æˆ·ç«¯å¯ä»¥<strong>è¿æ¥ä»»æ„ Master èŠ‚ç‚¹</strong>ï¼Œé›†ç¾¤å†…éƒ¨ä¼šæŒ‰ç…§<strong>ä¸åŒ key å°†è¯·æ±‚è½¬å‘åˆ°ä¸åŒçš„ Master</strong> èŠ‚ç‚¹</p><p>â€‹é›†ç¾¤æ¨¡å¼æ˜¯å¦‚ä½•å®ç°é«˜å¯ç”¨çš„å‘¢ï¼Ÿé›†ç¾¤å†…éƒ¨èŠ‚ç‚¹ä¹‹é—´ä¼š<strong>äº’ç›¸å®šæ—¶æ¢æµ‹</strong>å¯¹æ–¹æ˜¯å¦å­˜æ´»ï¼Œå¦‚æœå¤šæ•°èŠ‚ç‚¹åˆ¤æ–­æŸä¸ªèŠ‚ç‚¹æŒ‚äº†ï¼Œåˆ™ä¼šå°†å…¶è¸¢å‡ºé›†ç¾¤ï¼Œç„¶åä» <strong>Slave</strong> èŠ‚ç‚¹ä¸­é€‰ä¸¾å‡ºä¸€ä¸ªèŠ‚ç‚¹<strong>æ›¿è¡¥</strong>æŒ‚æ‰çš„ Master èŠ‚ç‚¹ã€‚<strong>æ•´ä¸ªåŸç†åŸºæœ¬å’Œå“¨å…µæ¨¡å¼ä¸€è‡´</strong></p><p>â€‹è™½ç„¶é›†ç¾¤æ¨¡å¼é¿å…äº† Master å•èŠ‚ç‚¹çš„é—®é¢˜ï¼Œä½†<strong>é›†ç¾¤å†…åŒæ­¥æ•°æ®æ—¶ä¼šå ç”¨ä¸€å®šçš„å¸¦å®½</strong>ã€‚æ‰€ä»¥ï¼Œåªæœ‰åœ¨<strong>å†™æ“ä½œæ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹äººä»¬æ‰ä½¿ç”¨é›†ç¾¤æ¨¡å¼</strong>ï¼Œå…¶ä»–å¤§å¤šæ•°æƒ…å†µï¼Œä½¿ç”¨<strong>å“¨å…µæ¨¡å¼</strong>éƒ½èƒ½æ»¡è¶³éœ€æ±‚</p><h4 id="5ã€åˆ†å¸ƒå¼é”"><a href="#5ã€åˆ†å¸ƒå¼é”" class="headerlink" title="5ã€åˆ†å¸ƒå¼é”"></a>5ã€åˆ†å¸ƒå¼é”</h4><p><strong>åˆ©ç”¨Watchå®ç°Redisä¹è§‚é”</strong></p><p>â€‹ä¹è§‚é”åŸºäºCAS(Compare And Swap)æ¯”è¾ƒå¹¶æ›¿æ¢æ€æƒ³ï¼Œä¸ä¼šäº§ç”Ÿé”ç­‰å¾…è€Œæ¶ˆè€—èµ„æºï¼Œä½†æ˜¯éœ€è¦åå¤çš„é‡è¯•ï¼Œä½†ä¹Ÿæ˜¯å› ä¸ºé‡è¯•çš„æœºåˆ¶ï¼Œèƒ½æ¯”è¾ƒå¿«çš„å“åº”ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨redisæ¥å®ç°ä¹è§‚é”<strong>ï¼ˆç§’æ€ï¼‰</strong>ã€‚å…·ä½“æ€è·¯å¦‚ä¸‹:</p><p>1ã€åˆ©ç”¨redisçš„watchåŠŸèƒ½ï¼Œç›‘æ§è¿™ä¸ªredisKeyçš„çŠ¶æ€å€¼<br>2ã€è·å–redisKeyçš„å€¼ï¼Œåˆ›å»ºredisäº‹åŠ¡ï¼Œç»™è¿™ä¸ªkeyçš„å€¼+1<br>3ã€æ‰§è¡Œè¿™ä¸ªäº‹åŠ¡ï¼Œå¦‚æœkeyçš„å€¼è¢«ä¿®æ”¹è¿‡åˆ™å›æ»šï¼Œkeyä¸åŠ 1</p><p><strong>åˆ©ç”¨setnxé˜²æ­¢åº“å­˜è¶…å–</strong><br>    åˆ†å¸ƒå¼é”æ˜¯æ§åˆ¶åˆ†å¸ƒå¼ç³»ç»Ÿä¹‹é—´åŒæ­¥è®¿é—®å…±äº«èµ„æºçš„ä¸€ç§æ–¹å¼ã€‚ åˆ©ç”¨Redisçš„å•çº¿ç¨‹ç‰¹æ€§å¯¹å…±äº«èµ„æºè¿›è¡Œä¸²è¡ŒåŒ–å¤„ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–é”æ¨èä½¿ç”¨setçš„æ–¹å¼</span></span><br><span class="line"><span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> jedis.set(lockKey, requestId, <span class="string">&quot;NX&quot;</span>, <span class="string">&quot;EX&quot;</span>, expireTime);</span><br><span class="line"><span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> jedis.setnx(lockKey, requestId); <span class="comment">//å¦‚çº¿ç¨‹æ­»æ‰ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•è·å–åˆ°é”</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é‡Šæ”¾é”ï¼ŒéåŸå­æ“ä½œï¼Œå¯èƒ½ä¼šé‡Šæ”¾å…¶ä»–çº¿ç¨‹åˆšåŠ ä¸Šçš„é”</span></span><br><span class="line"><span class="keyword">if</span> (requestId.equals(jedis.get(lockKey))) &#123; </span><br><span class="line">  jedis.del(lockKey);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ¨èä½¿ç”¨redis+luaè„šæœ¬</span></span><br><span class="line"><span class="type">String</span> <span class="variable">lua</span> <span class="operator">=</span> <span class="string">&quot;if redis.call(&#x27;get&#x27;,KEYS[1]) == ARGV[1] then return redis.call(&#x27;del&#x27;,KEYS[1]) else return 0 end&quot;</span>;</span><br><span class="line"><span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> jedis.eval(lua, Collections.singletonList(lockKey),</span><br></pre></td></tr></table></figure><p><strong>åˆ†å¸ƒå¼é”å­˜åœ¨çš„é—®é¢˜</strong>ï¼š</p><ul><li><strong>å®¢æˆ·ç«¯é•¿æ—¶é—´é˜»å¡å¯¼è‡´é”å¤±æ•ˆé—®é¢˜</strong></li></ul><p>â€‹è®¡ç®—æ—¶é—´å†…å¼‚æ­¥å¯åŠ¨å¦å¤–ä¸€ä¸ªçº¿ç¨‹å»æ£€æŸ¥çš„é—®é¢˜ï¼Œè¿™ä¸ªkeyæ˜¯å¦è¶…æ—¶ï¼Œå½“é”è¶…æ—¶æ—¶é—´å¿«åˆ°æœŸä¸”é€»è¾‘æœªæ‰§è¡Œå®Œï¼Œå»¶é•¿é”è¶…æ—¶æ—¶é—´ã€‚</p><ul><li><p>**RedisæœåŠ¡å™¨æ—¶é’Ÿæ¼‚ç§»é—®é¢˜å¯¼è‡´åŒæ—¶åŠ é”<br>redisçš„è¿‡æœŸæ—¶é—´æ˜¯ä¾èµ–ç³»ç»Ÿæ—¶é’Ÿçš„ï¼Œå¦‚æœæ—¶é’Ÿæ¼‚ç§»è¿‡å¤§æ—¶ ç†è®ºä¸Šæ˜¯å¯èƒ½å‡ºç°çš„ **ä¼šå½±å“åˆ°è¿‡æœŸæ—¶é—´çš„è®¡ç®—ã€‚</p></li><li><p><strong>å•ç‚¹å®ä¾‹æ•…éšœï¼Œé”æœªåŠæ—¶åŒæ­¥å¯¼è‡´ä¸¢å¤±</strong></p><p><strong>RedLockç®—æ³•</strong></p></li></ul><ol><li><p>è·å–å½“å‰æ—¶é—´æˆ³T0ï¼Œé…ç½®æ—¶é’Ÿæ¼‚ç§»è¯¯å·®T1</p></li><li><p>çŸ­æ—¶é—´å†…é€ä¸ªè·å–å…¨éƒ¨N&#x2F;2+1ä¸ªé”ï¼Œç»“æŸæ—¶é—´ç‚¹T2</p></li><li><p>å®é™…é”èƒ½ä½¿ç”¨çš„å¤„ç†æ—¶é•¿å˜ä¸ºï¼šTTL - ï¼ˆT2 - T0ï¼‰- T1</p><p>è¯¥æ–¹æ¡ˆé€šè¿‡å¤šèŠ‚ç‚¹æ¥<strong>é˜²æ­¢Redisçš„å•ç‚¹æ•…éšœ</strong>ï¼Œæ•ˆæœä¸€èˆ¬ï¼Œä¹Ÿæ— æ³•é˜²æ­¢ï¼š</p></li></ol><ul><li><p><strong>ä¸»ä»åˆ‡æ¢å¯¼è‡´çš„ä¸¤ä¸ªå®¢æˆ·ç«¯åŒæ—¶æŒæœ‰é”</strong></p><p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹<strong>æŒç»­æ—¶é—´æçŸ­</strong>ï¼Œè€Œä¸”ä½¿ç”¨<strong>Redlockåœ¨åˆ‡æ¢çš„ç¬é—´</strong>è·å–åˆ°èŠ‚ç‚¹çš„é”ï¼Œä¹Ÿå­˜åœ¨é—®é¢˜ã€‚å·²ç»æ˜¯æä½æ¦‚ç‡çš„æ—¶é—´ï¼Œæ— æ³•é¿å…ã€‚<strong>Redisåˆ†å¸ƒå¼é”é€‚åˆå¹‚ç­‰æ€§äº‹åŠ¡</strong>ï¼Œå¦‚æœä¸€å®šè¦<strong>ä¿è¯å®‰å…¨</strong>ï¼Œåº”è¯¥<strong>ä½¿ç”¨Zookeeperæˆ–è€…DB</strong>ï¼Œä½†æ˜¯ï¼Œ<strong>æ€§èƒ½ä¼šæ€¥å‰§ä¸‹é™</strong>ã€‚</p></li></ul><p><strong>ä¸zookeeperåˆ†å¸ƒå¼é”å¯¹æ¯”</strong></p><ul><li>redis åˆ†å¸ƒå¼é”ï¼Œå…¶å®<strong>éœ€è¦è‡ªå·±ä¸æ–­å»å°è¯•è·å–é”</strong>ï¼Œæ¯”è¾ƒæ¶ˆè€—æ€§èƒ½ã€‚</li><li>zk åˆ†å¸ƒå¼é”ï¼Œæ³¨å†Œä¸ªç›‘å¬å™¨å³å¯ï¼Œä¸éœ€è¦ä¸æ–­ä¸»åŠ¨å°è¯•è·å–é”ï¼ŒZKè·å–é”ä¼šæŒ‰ç…§åŠ é”çš„é¡ºåºï¼Œæ‰€ä»¥æ˜¯å…¬å¹³é”ï¼Œæ€§èƒ½å’Œmysqlå·®ä¸å¤šï¼Œå’Œrediså·®åˆ«å¤§</li></ul><p><strong>Redissionç”Ÿäº§ç¯å¢ƒçš„åˆ†å¸ƒå¼é”</strong></p><p>â€‹Redissonæ˜¯åŸºäºNIOçš„Nettyæ¡†æ¶ä¸Šçš„ä¸€ä¸ªJavaé©»å†…å­˜æ•°æ®ç½‘æ ¼(In-Memory Data Grid)åˆ†å¸ƒå¼é”å¼€æºç»„ä»¶ã€‚ </p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1glurlfrrp4j30qk0g876c.jpg" alt="image-20201221000119586" style="zoom:67%;" /><p>ä½†å½“ä¸šåŠ¡å¿…é¡»è¦æ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼Œå³ä¸å…è®¸é‡å¤è·å¾—é”ï¼Œæ¯”å¦‚é‡‘èåœºæ™¯(é‡å¤ä¸‹å•ï¼Œé‡å¤è½¬è´¦)ï¼Œ<strong>è¯·ä¸è¦ä½¿ç”¨redisåˆ†å¸ƒå¼é”</strong>ã€‚å¯ä»¥ä½¿ç”¨CPæ¨¡å‹å®ç°ï¼Œæ¯”å¦‚:<strong>zookeeperå’Œetcdã€‚</strong></p><table><thead><tr><th></th><th>Redis</th><th>zookeeper</th><th>etcd</th></tr></thead><tbody><tr><td>ä¸€è‡´æ€§ç®—æ³•</td><td>æ— </td><td>paxos(ZAB)</td><td>raft</td></tr><tr><td>CAP</td><td>AP</td><td>CP</td><td>CP</td></tr><tr><td>é«˜å¯ç”¨</td><td>ä¸»ä»é›†ç¾¤</td><td>n+1</td><td>n+1</td></tr><tr><td>å®ç°</td><td>setNX</td><td>createNode</td><td>restfulAPI</td></tr></tbody></table><h4 id="6ã€rediså¿ƒè·³æ£€æµ‹"><a href="#6ã€rediså¿ƒè·³æ£€æµ‹" class="headerlink" title="6ã€rediså¿ƒè·³æ£€æµ‹"></a>6ã€rediså¿ƒè·³æ£€æµ‹</h4><p>åœ¨å‘½ä»¤ä¼ æ’­é˜¶æ®µï¼Œä»æœåŠ¡å™¨é»˜è®¤ä¼šä»¥æ¯ç§’ä¸€æ¬¡çš„é¢‘ç‡å‘ä¸»æœåŠ¡å™¨å‘é€ACKå‘½ä»¤:</p><p>â€‹1ã€æ£€æµ‹ä¸»ä»çš„è¿æ¥çŠ¶æ€ æ£€æµ‹ä¸»ä»æœåŠ¡å™¨çš„ç½‘ç»œè¿æ¥çŠ¶æ€</p><p>â€‹lagçš„å€¼åº”è¯¥åœ¨0æˆ–1ä¹‹é—´è·³åŠ¨ï¼Œå¦‚æœè¶…è¿‡1åˆ™è¯´æ˜ä¸»ä»ä¹‹é—´çš„è¿æ¥æœ‰ æ•…éšœã€‚</p><p>â€‹2ã€è¾…åŠ©å®ç°min-slaves,Rediså¯ä»¥é€šè¿‡é…ç½®é˜²æ­¢ä¸»æœåŠ¡å™¨åœ¨ä¸å®‰å…¨çš„æƒ…å†µä¸‹æ‰§è¡Œå†™å‘½ä»¤</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">min-slaves-to-write</span> <span class="number">3</span> <span class="string">(min-replicas-to-write</span> <span class="number">3</span> <span class="string">)</span></span><br><span class="line"></span><br><span class="line"><span class="string">min-slaves-max-lag</span> <span class="number">10</span> <span class="string">(min-replicas-max-lag</span> <span class="number">10</span><span class="string">)</span></span><br></pre></td></tr></table></figure><p>â€‹ä¸Šé¢çš„é…ç½®è¡¨ç¤º:ä»æœåŠ¡å™¨çš„æ•°é‡å°‘äº3ä¸ªï¼Œæˆ–è€…ä¸‰ä¸ªä»æœåŠ¡å™¨çš„å»¶è¿Ÿ(lag)å€¼éƒ½å¤§äºæˆ–ç­‰äº10 ç§’æ—¶ï¼Œä¸»æœåŠ¡å™¨å°†æ‹’ç»æ‰§è¡Œå†™å‘½ä»¤ã€‚</p><p>â€‹3ã€æ£€æµ‹å‘½ä»¤ä¸¢å¤±ï¼Œå¢åŠ é‡ä¼ æœºåˆ¶</p><p>â€‹å¦‚æœå› ä¸ºç½‘ç»œæ•…éšœï¼Œä¸»æœåŠ¡å™¨ä¼ æ’­ç»™ä»æœåŠ¡å™¨çš„å†™å‘½ä»¤åœ¨åŠè·¯ä¸¢å¤±ï¼Œé‚£ä¹ˆå½“ä»æœåŠ¡å™¨å‘ä¸»æœåŠ¡å™¨å‘ é€REPLCONF ACKå‘½ä»¤æ—¶ï¼Œä¸»æœåŠ¡å™¨å°†å‘è§‰ä»æœåŠ¡å™¨å½“å‰çš„å¤åˆ¶åç§»é‡å°‘äºè‡ªå·±çš„å¤åˆ¶åç§»é‡ï¼Œ ç„¶åä¸»æœåŠ¡å™¨å°±ä¼šæ ¹æ®ä»æœåŠ¡å™¨æäº¤çš„å¤åˆ¶åç§»é‡ï¼Œåœ¨å¤åˆ¶ç§¯å‹ç¼“å†²åŒºé‡Œé¢æ‰¾åˆ°ä»æœåŠ¡å™¨ç¼ºå°‘çš„æ•°æ®ï¼Œå¹¶å°†è¿™äº›æ•°æ®é‡æ–°å‘é€ç»™ä»æœåŠ¡å™¨ã€‚</p><h3 id="Rediså®æˆ˜"><a href="#Rediså®æˆ˜" class="headerlink" title="Rediså®æˆ˜"></a>Rediså®æˆ˜</h3><h4 id="1ã€Redisä¼˜åŒ–"><a href="#1ã€Redisä¼˜åŒ–" class="headerlink" title="1ã€Redisä¼˜åŒ–"></a>1ã€Redisä¼˜åŒ–</h4><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gorm5m7b4gj30uy0hjwfp.jpg" alt="img"></p><p><strong>è¯»å†™æ–¹å¼</strong><br>    ç®€å•æ¥è¯´å°±æ˜¯ä¸ç”¨<strong>keys</strong>ç­‰ï¼Œç”¨<strong>rangeã€contains</strong>ä¹‹ç±»ã€‚æ¯”å¦‚ï¼Œç”¨æˆ·ç²‰ä¸æ•°ï¼Œå¤§ V çš„ç²‰ä¸æ›´æ˜¯é«˜è¾¾å‡ åƒä¸‡ç”šè‡³è¿‡äº¿ï¼Œå› æ­¤ï¼Œè·å–ç²‰ä¸åˆ—è¡¨åªèƒ½éƒ¨åˆ†è·å–ã€‚å¦å¤–åœ¨åˆ¤æ–­æŸç”¨æˆ·æ˜¯å¦å…³æ³¨äº†å¦å¤–ä¸€ä¸ªç”¨æˆ·æ—¶ï¼Œä¹Ÿåªéœ€è¦å…³æ³¨åˆ—è¡¨ä¸Šè¿›è¡Œæ£€æŸ¥åˆ¤æ–­ï¼Œç„¶åè¿”å› True&#x2F;False æˆ– 0&#x2F;1 çš„æ–¹å¼æ›´ä¸ºé«˜æ•ˆã€‚</p><p><strong>KV size</strong><br>    å¦‚æœå•ä¸ªä¸šåŠ¡çš„ KV size è¿‡å¤§ï¼Œéœ€è¦åˆ†æ‹†æˆå¤šä¸ª KV æ¥ç¼“å­˜ã€‚æ‹†åˆ†æ—¶åº”<strong>è€ƒè™‘è®¿é—®é¢‘ç‡</strong></p><p><strong>key çš„æ•°é‡</strong><br>    å¦‚æœæ•°æ®é‡å·¨å¤§ï¼Œåˆ™åœ¨ç¼“å­˜ä¸­å°½å¯èƒ½åªä¿ç•™é¢‘ç¹è®¿é—®çš„çƒ­æ•°æ®ï¼Œå¯¹äºå†·æ•°æ®ç›´æ¥è®¿é—® DBã€‚</p><p><strong>è¯»å†™å³°å€¼</strong><br>    å¦‚æœå°äº 10ä¸‡ çº§åˆ«ï¼Œç®€å•åˆ†æ‹†åˆ°ç‹¬ç«‹ Cache æ± å³å¯<br>    å¦‚æœè¾¾åˆ° 100ä¸‡ çº§çš„QPSï¼Œåˆ™éœ€è¦å¯¹ Cache è¿›è¡Œåˆ†å±‚å¤„ç†ï¼Œå¯ä»¥åŒæ—¶ä½¿ç”¨ Local-Cache é…åˆè¿œç¨‹ cacheï¼Œç”šè‡³è¿œç¨‹ç¼“å­˜å†…éƒ¨ç»§ç»­åˆ†å±‚å åŠ åˆ†æ± è¿›è¡Œå¤„ç†ã€‚<strong>ï¼ˆå¤šçº§ç¼“å­˜ï¼‰</strong></p><p><strong>å‘½ä¸­ç‡</strong><br>    ç¼“å­˜çš„å‘½ä¸­ç‡å¯¹æ•´ä¸ªæœåŠ¡ä½“ç³»çš„æ€§èƒ½å½±å“ç”šå¤§ã€‚å¯¹äºæ ¸å¿ƒé«˜å¹¶å‘è®¿é—®çš„ä¸šåŠ¡ï¼Œéœ€è¦é¢„ç•™è¶³å¤Ÿçš„å®¹é‡ï¼Œç¡®ä¿æ ¸å¿ƒä¸šåŠ¡ç¼“å­˜ç»´æŒè¾ƒé«˜çš„å‘½ä¸­ç‡ã€‚æ¯”å¦‚å¾®åšä¸­çš„ Feed Vector Cacheï¼ˆ<strong>çƒ­ç‚¹èµ„è®¯</strong>ï¼‰ï¼Œå¸¸å¹´çš„å‘½ä¸­ç‡é«˜è¾¾ 99.5% ä»¥ä¸Šã€‚ä¸ºäº†æŒç»­ä¿æŒç¼“å­˜çš„å‘½ä¸­ç‡ï¼Œç¼“å­˜ä½“ç³»éœ€è¦æŒç»­ç›‘æ§ï¼ŒåŠæ—¶è¿›è¡Œæ•…éšœå¤„ç†æˆ–æ•…éšœè½¬ç§»ã€‚åŒæ—¶åœ¨éƒ¨åˆ†ç¼“å­˜èŠ‚ç‚¹å¼‚å¸¸ã€å‘½ä¸­ç‡ä¸‹é™æ—¶ï¼Œæ•…éšœè½¬ç§»æ–¹æ¡ˆï¼Œéœ€è¦è€ƒè™‘æ˜¯é‡‡ç”¨ä¸€è‡´æ€§ Hash åˆ†å¸ƒçš„è®¿é—®æ¼‚ç§»ç­–ç•¥ï¼Œè¿˜æ˜¯é‡‡ç”¨æ•°æ®å¤šå±‚å¤‡ä»½ç­–ç•¥ã€‚</p><p><strong>è¿‡æœŸç­–ç•¥</strong></p><p>â€‹å¯ä»¥è®¾ç½®è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ï¼Œè®©å†· key è‡ªåŠ¨è¿‡æœŸï¼›ä¹Ÿå¯ä»¥è®© key å¸¦ä¸Šæ—¶é—´æˆ³ï¼ŒåŒæ—¶è®¾ç½®è¾ƒé•¿çš„è¿‡æœŸæ—¶é—´ï¼Œæ¯”å¦‚å¾ˆå¤šä¸šåŠ¡ç³»ç»Ÿå†…éƒ¨æœ‰è¿™æ ·ä¸€äº› keyï¼škey_20190801ã€‚</p><p><strong>ç¼“å­˜ç©¿é€æ—¶é—´</strong><br>    å¹³å‡ç¼“å­˜ç©¿é€åŠ è½½æ—¶é—´åœ¨æŸäº›ä¸šåŠ¡åœºæ™¯ä¸‹ä¹Ÿå¾ˆé‡è¦ï¼Œå¯¹äºä¸€äº›ç¼“å­˜ç©¿é€åï¼ŒåŠ è½½æ—¶é—´ç‰¹åˆ«é•¿æˆ–è€…éœ€è¦å¤æ‚è®¡ç®—çš„æ•°æ®ï¼Œè€Œä¸”è®¿é—®é‡è¿˜æ¯”è¾ƒå¤§çš„ä¸šåŠ¡æ•°æ®ï¼Œè¦é…ç½®æ›´å¤šå®¹é‡ï¼Œç»´æŒæ›´é«˜çš„å‘½ä¸­ç‡ï¼Œä»è€Œå‡å°‘ç©¿é€åˆ° DB çš„æ¦‚ç‡ï¼Œæ¥ç¡®ä¿æ•´ä¸ªç³»ç»Ÿçš„è®¿é—®æ€§èƒ½ã€‚</p><p><strong>ç¼“å­˜å¯è¿ç»´æ€§</strong><br>    å¯¹äºç¼“å­˜çš„å¯è¿ç»´æ€§è€ƒè™‘ï¼Œåˆ™éœ€è¦è€ƒè™‘ç¼“å­˜ä½“ç³»çš„é›†ç¾¤ç®¡ç†ï¼Œå¦‚ä½•è¿›è¡Œä¸€é”®æ‰©ç¼©å®¹ï¼Œå¦‚ä½•è¿›è¡Œç¼“å­˜ç»„ä»¶çš„å‡çº§å’Œå˜æ›´ï¼Œå¦‚ä½•å¿«é€Ÿå‘ç°å¹¶å®šä½é—®é¢˜ï¼Œå¦‚ä½•æŒç»­ç›‘æ§æŠ¥è­¦ï¼Œæœ€å¥½æœ‰ä¸€ä¸ªå®Œå–„çš„è¿ç»´å¹³å°ï¼Œå°†å„ç§è¿ç»´å·¥å…·è¿›è¡Œé›†æˆã€‚</p><p><strong>ç¼“å­˜å®‰å…¨æ€§</strong><br>    å¯¹äºç¼“å­˜çš„å®‰å…¨æ€§è€ƒè™‘ï¼Œä¸€æ–¹é¢å¯ä»¥é™åˆ¶æ¥æº IPï¼Œåªå…è®¸å†…ç½‘è®¿é—®ï¼ŒåŒæ—¶åŠ å¯†é‰´æƒè®¿é—®ã€‚</p><h4 id="2ã€Redisçƒ­å‡çº§"><a href="#2ã€Redisçƒ­å‡çº§" class="headerlink" title="2ã€Redisçƒ­å‡çº§"></a>2ã€Redisçƒ­å‡çº§</h4><blockquote><p>åœ¨ Redis éœ€è¦å‡çº§ç‰ˆæœ¬æˆ–ä¿®å¤ bug æ—¶ï¼Œå¦‚æœç›´æ¥é‡å¯å˜æ›´ï¼Œç”±äºéœ€è¦æ•°æ®æ¢å¤ï¼Œè¿™ä¸ªè¿‡ç¨‹éœ€è¦è¿‘ 10 åˆ†é’Ÿçš„æ—¶é—´ï¼Œæ—¶é—´è¿‡é•¿ï¼Œä¼šä¸¥é‡å½±å“ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚é¢å¯¹è¿™ç§é—®é¢˜ï¼Œå¯ä»¥å¯¹ Redis æ‰©å±•çƒ­å‡çº§åŠŸèƒ½ï¼Œä»è€Œåœ¨æ¯«ç§’çº§å®Œæˆå‡çº§æ“ä½œï¼Œå®Œå…¨ä¸å½±å“ä¸šåŠ¡è®¿é—®ã€‚</p></blockquote><p>çƒ­å‡çº§æ–¹æ¡ˆå¦‚ä¸‹ï¼Œé¦–å…ˆæ„å»ºä¸€ä¸ª Redis å£³ç¨‹åºï¼Œå°† redisServer çš„æ‰€æœ‰å±æ€§ï¼ˆåŒ…æ‹¬redisDbã€clientç­‰ï¼‰ä¿å­˜ä¸ºå…¨å±€å˜é‡ã€‚ç„¶åå°† Redis çš„å¤„ç†é€»è¾‘ä»£ç å…¨éƒ¨å°è£…åˆ°åŠ¨æ€è¿æ¥åº“ so æ–‡ä»¶ä¸­ã€‚Redis ç¬¬ä¸€æ¬¡å¯åŠ¨ï¼Œä»ç£ç›˜åŠ è½½æ¢å¤æ•°æ®ï¼Œåœ¨åç»­å‡çº§æ—¶ï¼Œé€šè¿‡æŒ‡ä»¤ï¼Œå£³ç¨‹åºé‡æ–°åŠ è½½ Redis æ–°çš„ redis-4.so åˆ° redis-5.so æ–‡ä»¶ï¼Œå³å¯å®ŒæˆåŠŸèƒ½å‡çº§ï¼Œæ¯«ç§’çº§å®Œæˆ Redis çš„ç‰ˆæœ¬å‡çº§ã€‚è€Œä¸”æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰ Client è¿æ¥ä»ç„¶ä¿ç•™ï¼Œåœ¨å‡çº§æˆåŠŸåï¼ŒåŸæœ‰ Client å¯ä»¥ç»§ç»­è¿›è¡Œè¯»å†™æ“ä½œï¼Œæ•´ä¸ªè¿‡ç¨‹å¯¹ä¸šåŠ¡å®Œå…¨é€æ˜ã€‚</p><h1 id="å…­ã€Kafkaç¯‡"><a href="#å…­ã€Kafkaç¯‡" class="headerlink" title="å…­ã€Kafkaç¯‡"></a>å…­ã€Kafkaç¯‡</h1><h3 id="Why-kafka"><a href="#Why-kafka" class="headerlink" title="Why kafka"></a>Why kafka</h3><p>æ¶ˆæ¯é˜Ÿåˆ—çš„ä½œç”¨ï¼š<strong>å¼‚æ­¥ã€å‰Šå³°å¡«è°·ã€è§£è€¦</strong></p><p><strong>ä¸­å°å‹å…¬å¸</strong>ï¼ŒæŠ€æœ¯å®åŠ›è¾ƒä¸ºä¸€èˆ¬ï¼ŒæŠ€æœ¯æŒ‘æˆ˜ä¸æ˜¯ç‰¹åˆ«é«˜ï¼Œç”¨ <strong>RabbitMQ</strong> ï¼ˆå¼€æºã€ç¤¾åŒºæ´»è·ƒï¼‰æ˜¯ä¸é”™çš„é€‰æ‹©ï¼›<strong>å¤§å‹å…¬å¸</strong>ï¼ŒåŸºç¡€æ¶æ„ç ”å‘å®åŠ›è¾ƒå¼ºï¼Œç”¨ <strong>RocketMQ</strong>ï¼ˆJavaäºŒæ¬¡å¼€å‘ï¼‰ æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚</p><p>å¦‚æœæ˜¯<strong>å¤§æ•°æ®é¢†åŸŸ</strong>çš„å®æ—¶è®¡ç®—ã€æ—¥å¿—é‡‡é›†ç­‰åœºæ™¯ï¼Œç”¨ <strong>Kafka</strong> æ˜¯ä¸šå†…æ ‡å‡†çš„ï¼Œç»å¯¹æ²¡é—®é¢˜ï¼Œç¤¾åŒºæ´»è·ƒåº¦å¾ˆé«˜ï¼Œç»å¯¹ä¸ä¼šé»„ï¼Œä½•å†µå‡ ä¹æ˜¯å…¨ä¸–ç•Œè¿™ä¸ªé¢†åŸŸçš„äº‹å®æ€§è§„èŒƒã€‚</p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gmfiyienm0j30zu0hago7.jpg" alt="image-20210107225921930" style="zoom:50%;" /><p><strong>RabbitMQ</strong></p><p>RabbitMQå¼€å§‹æ˜¯ç”¨åœ¨ç”µä¿¡ä¸šåŠ¡çš„å¯é é€šä¿¡çš„ï¼Œä¹Ÿæ˜¯å°‘æœ‰çš„å‡ æ¬¾<strong>æ”¯æŒAMQP</strong>åè®®çš„äº§å“ä¹‹ä¸€ã€‚</p><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li>è½»é‡çº§ï¼Œå¿«é€Ÿï¼Œéƒ¨ç½²ä½¿ç”¨æ–¹ä¾¿</li><li>æ”¯æŒçµæ´»çš„è·¯ç”±é…ç½®ã€‚RabbitMQä¸­ï¼Œåœ¨ç”Ÿäº§è€…å’Œé˜Ÿåˆ—ä¹‹é—´æœ‰ä¸€ä¸ªäº¤æ¢å™¨æ¨¡å—ã€‚æ ¹æ®é…ç½®çš„è·¯ç”±è§„åˆ™ï¼Œç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯å¯ä»¥å‘é€åˆ°ä¸åŒçš„é˜Ÿåˆ—ä¸­ã€‚è·¯ç”±è§„åˆ™å¾ˆçµæ´»ï¼Œè¿˜å¯ä»¥è‡ªå·±å®ç°ã€‚</li><li>RabbitMQçš„å®¢æˆ·ç«¯æ”¯æŒå¤§å¤šæ•°çš„ç¼–ç¨‹è¯­è¨€ï¼Œæ”¯æŒ<strong>AMQP</strong>åè®®ã€‚</li></ul><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gmfjicxzb2j30u80hx0uw.jpg" alt="image-20210107231826261" style="zoom:40%;" /><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li>å¦‚æœæœ‰å¤§é‡æ¶ˆæ¯å †ç§¯åœ¨é˜Ÿåˆ—ä¸­ï¼Œæ€§èƒ½ä¼šæ€¥å‰§ä¸‹é™</li><li>æ¯ç§’å¤„ç†å‡ ä¸‡åˆ°å‡ åä¸‡çš„æ¶ˆæ¯ã€‚å¦‚æœåº”ç”¨è¦æ±‚é«˜çš„æ€§èƒ½ï¼Œä¸è¦é€‰æ‹©RabbitMQã€‚ </li><li>RabbitMQæ˜¯Erlangå¼€å‘çš„ï¼ŒåŠŸèƒ½æ‰©å±•å’ŒäºŒæ¬¡å¼€å‘ä»£ä»·å¾ˆé«˜ã€‚</li></ul><p><strong>RocketMQ</strong></p><p>å€Ÿé‰´äº†Kafkaçš„è®¾è®¡å¹¶åšäº†å¾ˆå¤šæ”¹è¿›ï¼Œ<strong>å‡ ä¹å…·å¤‡äº†æ¶ˆæ¯é˜Ÿåˆ—åº”è¯¥å…·å¤‡çš„æ‰€æœ‰ç‰¹æ€§å’ŒåŠŸèƒ½</strong>ã€‚</p><ul><li>RocketMQä¸»è¦ç”¨äºæœ‰åºï¼Œäº‹åŠ¡ï¼Œæµè®¡ç®—ï¼Œæ¶ˆæ¯æ¨é€ï¼Œæ—¥å¿—æµå¤„ç†ï¼Œbinlogåˆ†å‘ç­‰åœºæ™¯ã€‚</li><li>ç»è¿‡äº†å†æ¬¡çš„åŒ11è€ƒéªŒï¼Œæ€§èƒ½ï¼Œç¨³å®šæ€§å¯é æ€§æ²¡çš„è¯´ã€‚</li><li>javaå¼€å‘ï¼Œé˜…è¯»æºä»£ç ã€æ‰©å±•ã€äºŒæ¬¡å¼€å‘å¾ˆæ–¹ä¾¿ã€‚</li><li>å¯¹ç”µå•†é¢†åŸŸçš„å“åº”å»¶è¿Ÿåšäº†å¾ˆå¤šä¼˜åŒ–ã€‚</li><li>æ¯ç§’å¤„ç†å‡ åä¸‡çš„æ¶ˆæ¯ï¼ŒåŒæ—¶å“åº”åœ¨æ¯«ç§’çº§ã€‚å¦‚æœåº”ç”¨å¾ˆå…³æ³¨å“åº”æ—¶é—´ï¼Œå¯ä»¥ä½¿ç”¨RocketMQã€‚</li><li>æ€§èƒ½æ¯”RabbitMQé«˜ä¸€ä¸ªæ•°é‡çº§ï¼Œã€‚</li><li>æ”¯æŒæ­»ä¿¡é˜Ÿåˆ—ï¼ŒDLX æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„ç‰¹æ€§ã€‚å®ƒå¯ä»¥å¤„ç†<strong>å¼‚å¸¸æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯ä¸èƒ½å¤Ÿè¢«æ¶ˆè´¹è€…æ­£ç¡®æ¶ˆè´¹è€Œè¢«ç½®å…¥æ­»ä¿¡é˜Ÿåˆ—ä¸­</strong>çš„æƒ…å†µï¼Œåç»­åˆ†æç¨‹åºå¯ä»¥é€šè¿‡æ¶ˆè´¹è¿™ä¸ªæ­»ä¿¡é˜Ÿåˆ—ä¸­çš„å†…å®¹æ¥åˆ†æå½“æ—¶æ‰€é‡åˆ°çš„å¼‚å¸¸æƒ…å†µï¼Œè¿›è€Œå¯ä»¥<strong>æ”¹å–„å’Œä¼˜åŒ–ç³»ç»Ÿ</strong>ã€‚</li></ul><p><strong>ç¼ºç‚¹</strong>ï¼š</p><p>â€‹è·Ÿå‘¨è¾¹ç³»ç»Ÿçš„æ•´åˆå’Œå…¼å®¹ä¸æ˜¯å¾ˆå¥½ã€‚</p><p><strong>Kafka</strong></p><p><strong>é«˜å¯ç”¨</strong>ï¼Œå‡ ä¹æ‰€æœ‰ç›¸å…³çš„å¼€æºè½¯ä»¶éƒ½æ”¯æŒï¼Œæ»¡è¶³å¤§å¤šæ•°çš„åº”ç”¨åœºæ™¯ï¼Œå°¤å…¶æ˜¯<strong>å¤§æ•°æ®å’Œæµè®¡ç®—</strong>é¢†åŸŸï¼Œ</p><ul><li>Kafkaé«˜æ•ˆï¼Œå¯ä¼¸ç¼©ï¼Œæ¶ˆæ¯æŒä¹…åŒ–ã€‚æ”¯æŒåˆ†åŒºã€å‰¯æœ¬å’Œå®¹é”™ã€‚</li><li>å¯¹æ‰¹å¤„ç†å’Œå¼‚æ­¥å¤„ç†åšäº†å¤§é‡çš„è®¾è®¡ï¼Œå› æ­¤Kafkaå¯ä»¥å¾—åˆ°éå¸¸é«˜çš„æ€§èƒ½ã€‚</li><li>æ¯ç§’å¤„ç†å‡ åä¸‡å¼‚æ­¥æ¶ˆæ¯æ¶ˆæ¯ï¼Œå¦‚æœå¼€å¯äº†å‹ç¼©ï¼Œæœ€ç»ˆå¯ä»¥è¾¾åˆ°æ¯ç§’å¤„ç†2000wæ¶ˆæ¯çš„çº§åˆ«ã€‚</li><li>ä½†æ˜¯ç”±äºæ˜¯å¼‚æ­¥çš„å’Œæ‰¹å¤„ç†çš„ï¼Œå»¶è¿Ÿä¹Ÿä¼šé«˜ï¼Œä¸é€‚åˆç”µå•†åœºæ™¯ã€‚</li></ul><h3 id="What-Kafka"><a href="#What-Kafka" class="headerlink" title="What Kafka"></a>What Kafka</h3><ul><li>Producer APIï¼šå…è®¸åº”ç”¨ç¨‹åºå°†è®°å½•æµå‘å¸ƒåˆ°ä¸€ä¸ªæˆ–å¤šä¸ªKafkaä¸»é¢˜ã€‚</li><li>Consumer APIï¼šå…è®¸åº”ç”¨ç¨‹åºè®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªä¸»é¢˜å¹¶å¤„ç†ä¸ºå…¶ç”Ÿæˆçš„è®°å½•æµã€‚</li><li>Streams APIï¼šå…è®¸åº”ç”¨ç¨‹åºå……å½“æµå¤„ç†å™¨ï¼Œå°†è¾“å…¥æµè½¬æ¢ä¸ºè¾“å‡ºæµã€‚</li></ul><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gme95cirjfj31000kb41j.jpg" alt="image-20210106203420526" style="zoom: 40%;" /><p><strong>æ¶ˆæ¯Message</strong></p><p>â€‹Kafkaçš„æ•°æ®å•å…ƒç§°ä¸ºæ¶ˆæ¯ã€‚å¯ä»¥æŠŠæ¶ˆæ¯çœ‹æˆæ˜¯æ•°æ®åº“é‡Œçš„ä¸€ä¸ªâ€œæ•°æ®è¡Œâ€æˆ–ä¸€æ¡â€œè®°å½•â€ã€‚</p><p><strong>æ‰¹æ¬¡</strong></p><p>â€‹ä¸ºäº†æé«˜æ•ˆç‡ï¼Œæ¶ˆæ¯è¢«åˆ†æ‰¹å†™å…¥Kafkaã€‚æé«˜ååé‡å´åŠ å¤§äº†å“åº”æ—¶é—´</p><p><strong>ä¸»é¢˜Topic</strong></p><p>â€‹é€šè¿‡ä¸»é¢˜è¿›è¡Œåˆ†ç±»ï¼Œç±»ä¼¼æ•°æ®åº“ä¸­çš„è¡¨ï¼Œ</p><p><strong>åˆ†åŒºPartition</strong></p><p>â€‹Topicå¯ä»¥è¢«åˆ†æˆè‹¥å¹²åˆ†åŒºåˆ†å¸ƒäºkafkaé›†ç¾¤ä¸­ï¼Œæ–¹ä¾¿æ‰©å®¹</p><p>â€‹å•ä¸ªåˆ†åŒºå†…æ˜¯æœ‰åºçš„ï¼Œpartitionè®¾ç½®ä¸ºä¸€æ‰èƒ½ä¿è¯å…¨å±€æœ‰åº</p><p><strong>å‰¯æœ¬Replicas</strong></p><p>â€‹æ¯ä¸ªä¸»é¢˜è¢«åˆ†ä¸ºè‹¥å¹²ä¸ªåˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºæœ‰å¤šä¸ªå‰¯æœ¬ã€‚</p><p><strong>ç”Ÿäº§è€…Producer</strong></p><p>â€‹ç”Ÿäº§è€…åœ¨é»˜è®¤æƒ…å†µä¸‹æŠŠ<strong>æ¶ˆæ¯å‡è¡¡åœ°åˆ†å¸ƒ</strong>åˆ°ä¸»é¢˜çš„æ‰€æœ‰åˆ†åŒºä¸Šï¼š</p><ul><li>ç›´æ¥æŒ‡å®šæ¶ˆæ¯çš„åˆ†åŒº</li><li>æ ¹æ®æ¶ˆæ¯çš„keyæ•£åˆ—å–æ¨¡å¾—å‡ºåˆ†åŒº</li><li>è½®è¯¢æŒ‡å®šåˆ†åŒºã€‚</li></ul><p><strong>æ¶ˆè´¹è€…Comsumer</strong></p><p>â€‹æ¶ˆè´¹è€…é€šè¿‡<strong>åç§»é‡</strong>æ¥åŒºåˆ†å·²ç»è¯»è¿‡çš„æ¶ˆæ¯ï¼Œä»è€Œæ¶ˆè´¹æ¶ˆæ¯ã€‚æŠŠæ¯ä¸ªåˆ†åŒºæœ€åè¯»å–çš„æ¶ˆæ¯åç§»é‡ä¿å­˜åœ¨Zookeeper æˆ–Kafkaä¸Šï¼Œå¦‚æœæ¶ˆè´¹è€…å…³é—­æˆ–é‡å¯ï¼Œå®ƒçš„<strong>è¯»å–çŠ¶æ€ä¸ä¼šä¸¢å¤±</strong>ã€‚</p><p><strong>æ¶ˆè´¹ç»„ComsumerGroup</strong></p><p>â€‹æ¶ˆè´¹ç»„ä¿è¯<strong>æ¯ä¸ªåˆ†åŒºåªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…</strong>ä½¿ç”¨ï¼Œé¿å…é‡å¤æ¶ˆè´¹ã€‚å¦‚æœç¾¤ç»„å†…ä¸€ä¸ª<strong>æ¶ˆè´¹è€…å¤±æ•ˆ</strong>ï¼Œæ¶ˆè´¹ç»„é‡Œçš„å…¶ä»–æ¶ˆè´¹è€…å¯ä»¥<strong>æ¥ç®¡å¤±æ•ˆæ¶ˆè´¹è€…çš„å·¥ä½œå†å¹³è¡¡</strong>ï¼Œé‡æ–°åˆ†åŒº</p><p><strong>èŠ‚ç‚¹Broker</strong></p><p>â€‹è¿æ¥ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œ<strong>å•ä¸ª</strong>broker<strong>å¯ä»¥è½»æ¾å¤„ç†</strong>æ•°åƒä¸ªåˆ†åŒº<strong>ä»¥åŠ</strong>æ¯ç§’ç™¾ä¸‡çº§çš„æ¶ˆæ¯é‡ã€‚</p><ul><li>brokeræ¥æ”¶æ¥è‡ªç”Ÿäº§è€…çš„æ¶ˆæ¯ï¼Œä¸ºæ¶ˆæ¯è®¾ç½®åç§»é‡ï¼Œå¹¶æäº¤<strong>æ¶ˆæ¯åˆ°ç£ç›˜ä¿å­˜</strong>ã€‚</li><li>brokerä¸ºæ¶ˆè´¹è€…æä¾›æœåŠ¡ï¼Œå“åº”è¯»å–åˆ†åŒºçš„è¯·æ±‚ï¼Œ<strong>è¿”å›å·²ç»æäº¤åˆ°ç£ç›˜ä¸Šçš„æ¶ˆæ¯</strong>ã€‚</li></ul><p><strong>é›†ç¾¤</strong></p><p>â€‹æ¯éš”åˆ†åŒºéƒ½æœ‰ä¸€ä¸ª<strong>é¦–é¢†</strong>ï¼Œå½“åˆ†åŒºè¢«åˆ†é…ç»™å¤šä¸ªbrokeræ—¶ï¼Œä¼šé€šè¿‡é¦–é¢†è¿›è¡Œ<strong>åˆ†åŒºå¤åˆ¶</strong>ã€‚</p><p><strong>ç”Ÿäº§è€…Offset</strong></p><p>â€‹æ¶ˆæ¯å†™å…¥çš„æ—¶å€™ï¼Œæ¯ä¸€ä¸ªåˆ†åŒºéƒ½æœ‰ä¸€ä¸ªoffsetï¼Œå³æ¯ä¸ªåˆ†åŒºçš„æœ€æ–°æœ€å¤§çš„offsetã€‚</p><p><strong>æ¶ˆè´¹è€…Offset</strong></p><p>â€‹ä¸åŒæ¶ˆè´¹ç»„ä¸­çš„æ¶ˆè´¹è€…å¯ä»¥é’ˆå¯¹ä¸€ä¸ªåˆ†åŒºå­˜å‚¨ä¸åŒçš„Offsetï¼Œäº’ä¸å½±å“</p><p><strong>LogSegment</strong></p><ul><li>ä¸€ä¸ªåˆ†åŒºç”±å¤šä¸ªLogSegmentç»„æˆï¼Œ</li><li>ä¸€ä¸ªLogSegmentç”±<code>.log .index .timeindex</code>ç»„æˆ</li><li><code>.log</code>è¿½åŠ æ˜¯é¡ºåºå†™å…¥çš„ï¼Œæ–‡ä»¶åæ˜¯ä»¥æ–‡ä»¶ä¸­ç¬¬ä¸€æ¡messageçš„offsetæ¥å‘½åçš„</li><li><code>.Index</code>è¿›è¡Œæ—¥å¿—åˆ é™¤çš„æ—¶å€™å’Œæ•°æ®æŸ¥æ‰¾çš„æ—¶å€™å¯ä»¥å¿«é€Ÿå®šä½ã€‚</li><li><code>.timeStamp</code>åˆ™æ ¹æ®<strong>æ—¶é—´æˆ³æŸ¥æ‰¾å¯¹åº”çš„åç§»é‡</strong>ã€‚</li></ul><h3 id="How-Kafka"><a href="#How-Kafka" class="headerlink" title="How Kafka"></a>How Kafka</h3><p><strong>ä¼˜ç‚¹</strong></p><ul><li><strong>é«˜ååé‡</strong>ï¼šå•æœºæ¯ç§’å¤„ç†å‡ åä¸Šç™¾ä¸‡çš„æ¶ˆæ¯é‡ã€‚å³ä½¿å­˜å‚¨äº†TBåŠæ¶ˆæ¯ï¼Œä¹Ÿä¿æŒç¨³å®šçš„æ€§èƒ½ã€‚<ul><li><strong>é›¶æ‹·è´</strong> å‡å°‘å†…æ ¸æ€åˆ°ç”¨æˆ·æ€çš„æ‹·è´ï¼Œç£ç›˜é€šè¿‡sendfileå®ç°<strong>DMA</strong> æ‹·è´Socket buffer</li><li><strong>é¡ºåºè¯»å†™</strong> å……åˆ†åˆ©ç”¨ç£ç›˜é¡ºåºè¯»å†™çš„è¶…é«˜æ€§èƒ½</li><li><strong>é¡µç¼“å­˜mmap</strong>ï¼Œå°†ç£ç›˜æ–‡ä»¶<strong>æ˜ å°„</strong>åˆ°å†…å­˜, ç”¨æˆ·é€šè¿‡ä¿®æ”¹å†…å­˜å°±èƒ½ä¿®æ”¹ç£ç›˜æ–‡ä»¶ã€‚</li></ul></li><li><strong>é«˜æ€§èƒ½</strong>ï¼šå•èŠ‚ç‚¹æ”¯æŒä¸Šåƒä¸ªå®¢æˆ·ç«¯ï¼Œå¹¶ä¿è¯é›¶åœæœºå’Œé›¶æ•°æ®ä¸¢å¤±ã€‚</li><li><strong>æŒä¹…åŒ–</strong>ï¼šå°†æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚é€šè¿‡å°†æ•°æ®æŒä¹…åŒ–åˆ°ç¡¬ç›˜ä»¥åŠreplicationé˜²æ­¢æ•°æ®ä¸¢å¤±ã€‚</li><li><strong>åˆ†å¸ƒå¼ç³»ç»Ÿ</strong>ï¼Œæ˜“æ‰©å±•ã€‚æ‰€æœ‰çš„ç»„ä»¶å‡ä¸ºåˆ†å¸ƒå¼çš„ï¼Œæ— éœ€åœæœºå³å¯æ‰©å±•æœºå™¨ã€‚</li><li><strong>å¯é æ€§</strong> - Kafkaæ˜¯åˆ†å¸ƒå¼ï¼Œåˆ†åŒºï¼Œå¤åˆ¶å’Œå®¹é”™çš„ã€‚</li><li><strong>å®¢æˆ·ç«¯çŠ¶æ€ç»´æŠ¤</strong>ï¼šæ¶ˆæ¯è¢«å¤„ç†çš„çŠ¶æ€æ˜¯åœ¨Consumerç«¯ç»´æŠ¤ï¼Œå½“å¤±è´¥æ—¶èƒ½è‡ªåŠ¨å¹³è¡¡ã€‚</li></ul><p><strong>åº”ç”¨åœºæ™¯</strong></p><ul><li><strong>æ—¥å¿—æ”¶é›†ï¼š</strong>ç”¨Kafkaå¯ä»¥æ”¶é›†å„ç§æœåŠ¡çš„Logï¼Œé€šè¿‡å¤§æ•°æ®å¹³å°è¿›è¡Œå¤„ç†ï¼›</li><li><strong>æ¶ˆæ¯ç³»ç»Ÿï¼š</strong>è§£è€¦ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ã€ç¼“å­˜æ¶ˆæ¯ç­‰ï¼›</li><li><strong>ç”¨æˆ·æ´»åŠ¨è·Ÿè¸ªï¼š</strong>Kafkaç»å¸¸è¢«ç”¨æ¥è®°å½•Webç”¨æˆ·æˆ–è€…Appç”¨æˆ·çš„å„ç§æ´»åŠ¨ï¼Œå¦‚æµè§ˆç½‘é¡µã€æœç´¢ã€ç‚¹å‡»ç­‰æ´»åŠ¨ï¼Œè¿™äº›æ´»åŠ¨ä¿¡æ¯è¢«å„ä¸ªæœåŠ¡å™¨å‘å¸ƒåˆ°Kafkaçš„Topicä¸­ï¼Œç„¶åæ¶ˆè´¹è€…é€šè¿‡è®¢é˜…è¿™äº›Topicæ¥åš<strong>è¿è¥æ•°æ®</strong>çš„å®æ—¶çš„ç›‘æ§åˆ†æï¼Œä¹Ÿå¯ä¿å­˜åˆ°æ•°æ®åº“ï¼›</li></ul><h3 id="ç”Ÿäº§æ¶ˆè´¹åŸºæœ¬æµç¨‹"><a href="#ç”Ÿäº§æ¶ˆè´¹åŸºæœ¬æµç¨‹" class="headerlink" title="ç”Ÿäº§æ¶ˆè´¹åŸºæœ¬æµç¨‹"></a><strong>ç”Ÿäº§æ¶ˆè´¹åŸºæœ¬æµç¨‹</strong></h3><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gmeb1cw09gj313m0kgwgb.jpg" alt="image-20210106213944461" style="zoom:40%;" /><ol><li><p>Produceråˆ›å»ºæ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªSenderçº¿ç¨‹å¹¶è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚</p></li><li><p>ç”Ÿäº§çš„æ¶ˆæ¯å…ˆç»è¿‡æ‹¦æˆªå™¨-&gt;åºåˆ—åŒ–å™¨-&gt;åˆ†åŒºå™¨ï¼Œç„¶åå°†æ¶ˆæ¯ç¼“å­˜åœ¨ç¼“å†²åŒºã€‚</p></li><li><p>æ‰¹æ¬¡å‘é€çš„æ¡ä»¶ä¸ºï¼šç¼“å†²åŒºæ•°æ®å¤§å°è¾¾åˆ°<strong>batch.size</strong>æˆ–è€…<strong>linger.ms</strong>è¾¾åˆ°ä¸Šé™ã€‚</p></li><li><p>æ‰¹æ¬¡å‘é€åï¼Œå‘å¾€æŒ‡å®šåˆ†åŒºï¼Œç„¶åè½ç›˜åˆ°brokerï¼›</p><ul><li><p><strong>acks&#x3D;0</strong>åªè¦å°†æ¶ˆæ¯æ”¾åˆ°ç¼“å†²åŒºï¼Œå°±è®¤ä¸ºæ¶ˆæ¯å·²ç»å‘é€å®Œæˆã€‚</p></li><li><p><strong>acks&#x3D;1</strong>è¡¨ç¤ºæ¶ˆæ¯<strong>åªéœ€è¦å†™åˆ°ä¸»åˆ†åŒº</strong>å³å¯ã€‚åœ¨è¯¥æƒ…å½¢ä¸‹ï¼Œå¦‚æœä¸»åˆ†åŒºæ”¶åˆ°æ¶ˆæ¯ç¡®è®¤ä¹‹åå°±å®•æœºäº†ï¼Œè€Œå‰¯æœ¬åˆ†åŒºè¿˜æ²¡æ¥å¾—åŠåŒæ­¥è¯¥æ¶ˆæ¯ï¼Œåˆ™è¯¥æ¶ˆæ¯ä¸¢å¤±ã€‚</p></li><li><p><strong>acks&#x3D;all ï¼ˆé»˜è®¤ï¼‰</strong>é¦–é¢†åˆ†åŒºä¼šç­‰å¾…<strong>æ‰€æœ‰çš„ISRå‰¯æœ¬åˆ†åŒºç¡®è®¤è®°å½•</strong>ã€‚è¯¥å¤„ç†ä¿è¯äº†åªè¦æœ‰ä¸€ä¸ªISRå‰¯æœ¬åˆ†åŒºå­˜æ´»ï¼Œæ¶ˆæ¯å°±ä¸ä¼šä¸¢å¤±ã€‚</p></li></ul></li><li><p>å¦‚æœç”Ÿäº§è€…é…ç½®äº†<strong>retrireså‚æ•°å¤§äº0å¹¶ä¸”æœªæ”¶åˆ°ç¡®è®¤</strong>ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯ä¼šå¯¹è¯¥æ¶ˆæ¯è¿›è¡Œé‡è¯•ã€‚</p></li><li><p>è½ç›˜åˆ°brokeræˆåŠŸï¼Œè¿”å›ç”Ÿäº§å…ƒæ•°æ®ç»™ç”Ÿäº§è€…ã€‚</p></li></ol><p><strong>Leaderé€‰ä¸¾</strong></p><ul><li><p>Kafkaä¼šåœ¨Zookeeperä¸Šé’ˆå¯¹æ¯ä¸ªTopicç»´æŠ¤ä¸€ä¸ªç§°ä¸ºISRï¼ˆin-sync replicaï¼‰çš„é›†åˆ</p></li><li><p>å½“é›†åˆä¸­å‰¯æœ¬éƒ½è·ŸLeaderä¸­çš„å‰¯æœ¬åŒæ­¥äº†ä¹‹åï¼Œkafkaæ‰ä¼šè®¤ä¸ºæ¶ˆæ¯å·²æäº¤</p></li><li><p>åªæœ‰è¿™äº›è·ŸLeaderä¿æŒåŒæ­¥çš„Followeræ‰åº”è¯¥è¢«é€‰ä½œæ–°çš„Leader</p></li><li><p>å‡è®¾æŸä¸ªtopicæœ‰N+1ä¸ªå‰¯æœ¬ï¼Œkafkaå¯ä»¥å®¹å¿Nä¸ªæœåŠ¡å™¨ä¸å¯ç”¨ï¼Œå†—ä½™åº¦è¾ƒä½</p><p>å¦‚æœISRä¸­çš„å‰¯æœ¬éƒ½ä¸¢å¤±äº†ï¼Œåˆ™ï¼š</p><ul><li>å¯ä»¥ç­‰å¾…ISRä¸­çš„å‰¯æœ¬ä»»ä½•ä¸€ä¸ªæ¢å¤ï¼Œæ¥ç€å¯¹å¤–æä¾›æœåŠ¡ï¼Œéœ€è¦æ—¶é—´ç­‰å¾…</li><li>ä»OSRä¸­é€‰å‡ºä¸€ä¸ªå‰¯æœ¬åšLeaderå‰¯æœ¬ï¼Œæ­¤æ—¶ä¼šé€ æˆæ•°æ®ä¸¢å¤±</li></ul></li></ul><p><strong>å‰¯æœ¬æ¶ˆæ¯åŒæ­¥</strong></p><p>â€‹é¦–å…ˆï¼ŒFollower å‘é€ FETCH è¯·æ±‚ç»™ Leaderã€‚æ¥ç€ï¼ŒLeader ä¼šè¯»å–åº•å±‚æ—¥å¿—æ–‡ä»¶ä¸­çš„æ¶ˆ æ¯æ•°æ®ï¼Œå†æ›´æ–°å®ƒå†…å­˜ä¸­çš„ Follower å‰¯æœ¬çš„ LEO å€¼ï¼Œæ›´æ–°ä¸º FETCH è¯·æ±‚ä¸­çš„ fetchOffset å€¼ã€‚æœ€åï¼Œå°è¯•æ›´æ–°åˆ†åŒºé«˜æ°´ä½å€¼ã€‚Follower æ¥æ”¶åˆ° FETCH å“åº”ä¹‹åï¼Œä¼šæŠŠæ¶ˆæ¯å†™å…¥åˆ°åº•å±‚æ—¥å¿—ï¼Œæ¥ç€æ›´æ–° LEO å’Œ HW å€¼ã€‚</p><p><strong>ç›¸å…³æ¦‚å¿µ</strong>ï¼š<strong>LEO</strong>å’Œ<strong>HW</strong>ã€‚</p><ul><li>LEOï¼šå³æ—¥å¿—æœ«ç«¯ä½ç§»(log end offset)ï¼Œè®°å½•äº†è¯¥å‰¯æœ¬æ—¥å¿—ä¸­ä¸‹ä¸€æ¡æ¶ˆæ¯çš„ä½ç§»å€¼ã€‚å¦‚æœLEO&#x3D;10ï¼Œé‚£ä¹ˆè¡¨ç¤ºè¯¥å‰¯æœ¬ä¿å­˜äº†10æ¡æ¶ˆæ¯ï¼Œä½ç§»å€¼èŒƒå›´æ˜¯[0, 9]</li><li>HWï¼šæ°´ä½å€¼HWï¼ˆhigh watermarkï¼‰å³å·²å¤‡ä»½ä½ç§»ã€‚å¯¹äºåŒä¸€ä¸ªå‰¯æœ¬å¯¹è±¡è€Œè¨€ï¼Œå…¶HWå€¼ä¸ä¼šå¤§äºLEOå€¼ã€‚å°äºç­‰äºHWå€¼çš„æ‰€æœ‰æ¶ˆæ¯éƒ½è¢«è®¤ä¸ºæ˜¯â€œå·²å¤‡ä»½â€çš„ï¼ˆreplicatedï¼‰</li></ul><p><strong>Rebalance</strong></p><ul><li>ç»„æˆå‘˜æ•°é‡å‘ç”Ÿå˜åŒ–</li><li>è®¢é˜…ä¸»é¢˜æ•°é‡å‘ç”Ÿå˜åŒ–</li><li>è®¢é˜…ä¸»é¢˜çš„åˆ†åŒºæ•°å‘ç”Ÿå˜åŒ–</li></ul><p>leaderé€‰ä¸¾å®Œæˆåï¼Œå½“ä»¥ä¸Šä¸‰ç§æƒ…å†µå‘ç”Ÿæ—¶ï¼ŒLeaderæ ¹æ®é…ç½®çš„<strong>RangeAssignor</strong>å¼€å§‹åˆ†é…æ¶ˆè´¹æ–¹æ¡ˆï¼Œå³å“ªä¸ªconsumerè´Ÿè´£æ¶ˆè´¹å“ªäº›topicçš„å“ªäº›partitionã€‚ä¸€æ—¦å®Œæˆåˆ†é…ï¼Œleaderä¼šå°†è¿™ä¸ªæ–¹æ¡ˆå°è£…è¿›<strong>SyncGroup</strong>è¯·æ±‚ä¸­å‘ç»™coordinatorï¼Œéleaderä¹Ÿä¼šå‘SyncGroupè¯·æ±‚ï¼Œåªæ˜¯å†…å®¹ä¸ºç©ºã€‚coordinatoræ¥æ”¶åˆ°åˆ†é…æ–¹æ¡ˆä¹‹åä¼šæŠŠæ–¹æ¡ˆå¡è¿›SyncGroupçš„responseä¸­å‘ç»™å„ä¸ªconsumerã€‚è¿™æ ·ç»„å†…çš„æ‰€æœ‰æˆå‘˜å°±éƒ½çŸ¥é“è‡ªå·±åº”è¯¥æ¶ˆè´¹å“ªäº›åˆ†åŒºäº†ã€‚</p><p><strong>åˆ†åŒºåˆ†é…ç®—æ³•RangeAssignor</strong></p><ul><li><p>åŸç†æ˜¯æŒ‰ç…§æ¶ˆè´¹è€…æ€»æ•°å’Œåˆ†åŒºæ€»æ•°è¿›è¡Œæ•´é™¤è¿ç®—å¹³å‡åˆ†é…ç»™æ‰€æœ‰çš„æ¶ˆè´¹è€…ã€‚</p></li><li><p>è®¢é˜…Topicçš„æ¶ˆè´¹è€…æŒ‰ç…§åç§°çš„å­—å…¸åºæ’åºï¼Œåˆ†å‡åˆ†é…ï¼Œå‰©ä¸‹çš„å­—å…¸åºä»å‰å¾€ååˆ†é…</p></li></ul><p><strong>å¢åˆ æ”¹æŸ¥</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kafka-topics.sh --zookeeper localhost:2181/myKafka --create --topic topic_x </span><br><span class="line">--partitions 1 --replication-factor 1</span><br><span class="line">kafka-topics.sh --zookeeper localhost:2181/myKafka --delete --topic topic_x</span><br><span class="line">kafka-topics.sh --zookeeper localhost:2181/myKafka --alter --topic topic_x</span><br><span class="line">--config max.message.bytes=1048576</span><br><span class="line">kafka-topics.sh --zookeeper localhost:2181/myKafka --describe --topic topic_x</span><br></pre></td></tr></table></figure><p><strong>å¦‚ä½•æŸ¥çœ‹åç§»é‡ä¸º23çš„æ¶ˆæ¯ï¼Ÿ</strong></p><p>é€šè¿‡æŸ¥è¯¢è·³è·ƒè¡¨<code>ConcurrentSkipListMap</code>ï¼Œå®šä½åˆ°åœ¨00000000000000000000.index ï¼Œé€šè¿‡äºŒåˆ†æ³•åœ¨åç§»é‡ç´¢å¼•æ–‡ä»¶ä¸­æ‰¾åˆ°ä¸å¤§äº 23 çš„<strong>æœ€å¤§ç´¢å¼•é¡¹</strong>ï¼Œå³offset 20 é‚£æ ï¼Œç„¶åä»æ—¥å¿—åˆ†æ®µæ–‡ä»¶ä¸­çš„ç‰©ç†ä½ç½®ä¸º320 å¼€å§‹é¡ºåºæŸ¥æ‰¾åç§»é‡ä¸º 23 çš„æ¶ˆæ¯ã€‚</p><img src="https://img-blog.csdnimg.cn/20191230225447849.PNG?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMjMzNzA2,size_16,color_FFFFFF,t_70" alt="img" style="zoom:50%;" /><p><strong>åˆ‡åˆ†æ–‡ä»¶</strong></p><ul><li><strong>å¤§å°åˆ†ç‰‡</strong> å½“å‰æ—¥å¿—åˆ†æ®µæ–‡ä»¶çš„å¤§å°è¶…è¿‡äº† broker ç«¯å‚æ•° <code>log.segment.bytes</code> é…ç½®çš„å€¼</li><li><strong>æ—¶é—´åˆ†ç‰‡</strong> å½“å‰æ—¥å¿—åˆ†æ®µä¸­æ¶ˆæ¯çš„æœ€å¤§æ—¶é—´æˆ³ä¸ç³»ç»Ÿçš„æ—¶é—´æˆ³çš„å·®å€¼å¤§äº<code>log.roll.ms</code>é…ç½®çš„å€¼</li><li><strong>ç´¢å¼•åˆ†ç‰‡</strong> åç§»é‡æˆ–æ—¶é—´æˆ³ç´¢å¼•æ–‡ä»¶å¤§å°è¾¾åˆ°brokerç«¯ <code>log.index.size.max.bytes</code>é…ç½®çš„å€¼</li><li><strong>åç§»åˆ†ç‰‡</strong> è¿½åŠ çš„æ¶ˆæ¯çš„åç§»é‡ä¸å½“å‰æ—¥å¿—åˆ†æ®µçš„åç§»é‡ä¹‹é—´çš„å·®å€¼å¤§äº Integer.MAX_VALUE</li></ul><h3 id="ä¸€è‡´æ€§"><a href="#ä¸€è‡´æ€§" class="headerlink" title="ä¸€è‡´æ€§"></a>ä¸€è‡´æ€§</h3><p><strong>å¹‚ç­‰æ€§</strong></p><p>ä¿è¯åœ¨æ¶ˆæ¯é‡å‘çš„æ—¶å€™ï¼Œæ¶ˆè´¹è€…ä¸ä¼šé‡å¤å¤„ç†ã€‚å³ä½¿åœ¨<strong>æ¶ˆè´¹è€…æ”¶åˆ°é‡å¤æ¶ˆæ¯çš„æ—¶å€™ï¼Œé‡å¤å¤„ç†</strong>ï¼Œä¹Ÿ</p><p>è¦<strong>ä¿è¯æœ€ç»ˆç»“æœçš„ä¸€è‡´æ€§</strong>ã€‚æ‰€è°“å¹‚ç­‰æ€§ï¼Œæ•°å­¦æ¦‚å¿µå°±æ˜¯ï¼š f(f(x)) &#x3D; f(x) </p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gmefdeas1vj315i0bgmya.jpg" alt="image-20210107000942286"></p><p><strong>å¦‚ä½•å®ç°ï¼Ÿ</strong></p><p>â€‹æ·»åŠ å”¯ä¸€IDï¼Œç±»ä¼¼äºæ•°æ®åº“çš„ä¸»é”®ï¼Œç”¨äºå”¯ä¸€æ ‡è®°ä¸€ä¸ªæ¶ˆæ¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ProducerIDï¼š#åœ¨æ¯ä¸ªæ–°çš„Produceråˆå§‹åŒ–æ—¶ï¼Œä¼šè¢«åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„PID</span><br><span class="line">SequenceNumberï¼š#å¯¹äºæ¯ä¸ªPIDå‘é€æ•°æ®çš„æ¯ä¸ªTopicéƒ½å¯¹åº”ä¸€ä¸ªä»0å¼€å§‹å•è°ƒé€’å¢çš„SNå€¼</span><br></pre></td></tr></table></figure><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gmefjpeet8j317e0cgmyp.jpg" alt="image-20210107001546404" style="zoom:80%;" /><p><strong>å¦‚ä½•é€‰ä¸¾</strong></p><ol><li>ä½¿ç”¨ Zookeeper çš„<strong>åˆ†å¸ƒå¼é”é€‰ä¸¾æ§åˆ¶å™¨</strong>ï¼Œå¹¶åœ¨èŠ‚ç‚¹åŠ å…¥é›†ç¾¤æˆ–é€€å‡ºé›†ç¾¤æ—¶é€šçŸ¥æ§åˆ¶å™¨ã€‚</li><li>æ§åˆ¶å™¨è´Ÿè´£åœ¨èŠ‚ç‚¹åŠ å…¥æˆ–ç¦»å¼€é›†ç¾¤æ—¶è¿›è¡Œåˆ†åŒºLeaderé€‰ä¸¾ã€‚</li><li>æ§åˆ¶å™¨ä½¿ç”¨epoch<code>å¿½ç•¥å°çš„çºªå…ƒ</code>æ¥é¿å…<strong>è„‘è£‚</strong>ï¼šä¸¤ä¸ªèŠ‚ç‚¹åŒæ—¶è®¤ä¸ºè‡ªå·±æ˜¯å½“å‰çš„æ§åˆ¶å™¨ã€‚</li></ol><h3 id="å¯ç”¨æ€§"><a href="#å¯ç”¨æ€§" class="headerlink" title="å¯ç”¨æ€§"></a>å¯ç”¨æ€§</h3><ul><li>åˆ›å»ºTopicçš„æ—¶å€™å¯ä»¥æŒ‡å®š â€“replication-factor 3 ï¼Œè¡¨ç¤ºä¸è¶…è¿‡brokerçš„å‰¯æœ¬æ•°</li><li>åªæœ‰Leaderæ˜¯è´Ÿè´£è¯»å†™çš„èŠ‚ç‚¹ï¼ŒFollowerå®šæœŸåœ°åˆ°Leaderä¸ŠPullæ•°æ®ã€‚</li><li>ISRæ˜¯Leaderè´Ÿè´£ç»´æŠ¤çš„ä¸å…¶ä¿æŒåŒæ­¥çš„Replicaåˆ—è¡¨ï¼Œå³å½“å‰æ´»è·ƒçš„å‰¯æœ¬åˆ—è¡¨ã€‚å¦‚æœä¸€ä¸ªFollowè½åå¤ªå¤šï¼ŒLeaderä¼šå°†å®ƒä»ISRä¸­ç§»é™¤ã€‚é€‰ä¸¾æ—¶ä¼˜å…ˆä»ISRä¸­æŒ‘é€‰Followerã€‚ </li><li>è®¾ç½® acks&#x3D;all ã€‚Leaderæ”¶åˆ°äº†ISRä¸­æ‰€æœ‰Replicaçš„ACKï¼Œæ‰å‘Producerå‘é€ACKã€‚</li></ul><h3 id="é¢è¯•é¢˜-2"><a href="#é¢è¯•é¢˜-2" class="headerlink" title="é¢è¯•é¢˜"></a>é¢è¯•é¢˜</h3><h4 id="çº¿ä¸Šé—®é¢˜rebalance"><a href="#çº¿ä¸Šé—®é¢˜rebalance" class="headerlink" title="çº¿ä¸Šé—®é¢˜rebalance"></a><strong>çº¿ä¸Šé—®é¢˜rebalance</strong></h4><blockquote><p>å› é›†ç¾¤æ¶æ„å˜åŠ¨å¯¼è‡´çš„æ¶ˆè´¹ç»„å†…é‡å¹³è¡¡ï¼Œå¦‚æœkafkaé›†å†…èŠ‚ç‚¹è¾ƒå¤šï¼Œæ¯”å¦‚æ•°ç™¾ä¸ªï¼Œé‚£é‡å¹³è¡¡å¯èƒ½ä¼šè€—æ—¶å¯¼è‡´<strong>æ•°åˆ†é’Ÿåˆ°æ•°å°æ—¶</strong>ï¼Œæ­¤æ—¶kafkaåŸºæœ¬å¤„äºä¸å¯ç”¨çŠ¶æ€ï¼Œå¯¹kafkaçš„TPSå½±å“æå¤§</p></blockquote><p>äº§ç”Ÿçš„åŸå› ï¼š</p><ul><li><p>ç»„æˆå‘˜æ•°é‡å‘ç”Ÿå˜åŒ–</p></li><li><p>è®¢é˜…ä¸»é¢˜æ•°é‡å‘ç”Ÿå˜åŒ–</p></li><li><p>è®¢é˜…ä¸»é¢˜çš„åˆ†åŒºæ•°å‘ç”Ÿå˜åŒ–</p><p><strong>ç»„æˆå‘˜å´©æºƒå’Œç»„æˆå‘˜ä¸»åŠ¨ç¦»å¼€æ˜¯ä¸¤ä¸ªä¸åŒçš„åœºæ™¯ã€‚</strong>å› ä¸ºåœ¨å´©æºƒæ—¶æˆå‘˜å¹¶ä¸ä¼šä¸»åŠ¨åœ°å‘ŠçŸ¥coordinatoræ­¤äº‹ï¼Œcoordinatoræœ‰å¯èƒ½éœ€è¦ä¸€ä¸ªå®Œæ•´çš„session.timeoutå‘¨æœŸ(å¿ƒè·³å‘¨æœŸ)æ‰èƒ½æ£€æµ‹åˆ°è¿™ç§å´©æºƒï¼Œè¿™å¿…ç„¶ä¼šé€ æˆconsumerçš„æ»åã€‚å¯ä»¥è¯´ç¦»å¼€ç»„æ˜¯ä¸»åŠ¨åœ°å‘èµ·rebalanceï¼›è€Œå´©æºƒåˆ™æ˜¯è¢«åŠ¨åœ°å‘èµ·rebalanceã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gooe9o07fvj30p00btju1.jpg" alt="img"></p></li></ul><p>è§£å†³æ–¹æ¡ˆï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">åŠ å¤§è¶…æ—¶æ—¶é—´</span> <span class="string">session.timout.ms=6s</span></span><br><span class="line"><span class="attr">åŠ å¤§å¿ƒè·³é¢‘ç‡</span> <span class="string">heartbeat.interval.ms=2s</span></span><br><span class="line"><span class="attr">å¢é•¿æ¨é€é—´éš”</span> <span class="string">max.poll.interval.ms=t+1 minutes</span></span><br></pre></td></tr></table></figure><p><a href="">è¿™äº›å¹´ï¼Œä¸ºäº†è¿›é˜¿é‡ŒèƒŒè¿‡çš„é¢è¯•é¢˜</a></p><h4 id="ZooKeeper-çš„ä½œç”¨"><a href="#ZooKeeper-çš„ä½œç”¨" class="headerlink" title="ZooKeeper çš„ä½œç”¨"></a>ZooKeeper çš„ä½œç”¨</h4><p>ç›®å‰ï¼ŒKafka ä½¿ç”¨ ZooKeeper å­˜æ”¾é›†ç¾¤å…ƒæ•°æ®ã€æˆå‘˜ç®¡ç†ã€Controller é€‰ä¸¾ï¼Œä»¥åŠå…¶ä»–ä¸€äº›ç®¡ç†ç±»ä»»åŠ¡ã€‚ä¹‹åï¼Œç­‰ KIP-500 ææ¡ˆå®Œæˆåï¼ŒKafka å°†å®Œå…¨ä¸å†ä¾èµ–äº ZooKeeperã€‚</p><ul><li><strong>å­˜æ”¾å…ƒæ•°æ®</strong>æ˜¯æŒ‡ä¸»é¢˜åˆ†åŒºçš„æ‰€æœ‰æ•°æ®éƒ½ä¿å­˜åœ¨ ZooKeeper ä¸­ï¼Œå…¶ä»–â€œäººâ€éƒ½è¦ä¸å®ƒä¿æŒå¯¹é½ã€‚</li><li><strong>æˆå‘˜ç®¡ç†</strong>æ˜¯æŒ‡ Broker èŠ‚ç‚¹çš„æ³¨å†Œã€æ³¨é”€ä»¥åŠå±æ€§å˜æ›´ç­‰ ã€‚</li><li><strong>Controller é€‰ä¸¾</strong>æ˜¯æŒ‡é€‰ä¸¾é›†ç¾¤ Controllerï¼ŒåŒ…æ‹¬ä½†ä¸é™äºä¸»é¢˜åˆ é™¤ã€å‚æ•°é…ç½®ç­‰ã€‚</li></ul><p>ä¸€è¨€ä»¥è”½ä¹‹:<strong>KIP-500 ï¼Œæ˜¯ä½¿ç”¨ç¤¾åŒºè‡ªç ”çš„åŸºäº Raft çš„å…±è¯†ç®—æ³•ï¼Œå®ç° Controller è‡ªé€‰ä¸¾</strong>ã€‚</p><p>åŒæ ·æ˜¯å­˜å‚¨å…ƒæ•°æ®ï¼Œè¿™å‡ å¹´<strong>åŸºäºRaftç®—æ³•çš„etcd</strong>è®¤å¯åº¦è¶Šæ¥è¶Šé«˜</p><p>â€‹è¶Šæ¥è¶Šå¤šçš„ç³»ç»Ÿå¼€å§‹ç”¨å®ƒä¿å­˜å…³é”®æ•°æ®ã€‚æ¯”å¦‚ï¼Œ<strong>ç§’æ€ç³»ç»Ÿç»å¸¸ç”¨å®ƒä¿å­˜å„èŠ‚ç‚¹ä¿¡æ¯</strong>ï¼Œä»¥ä¾¿æ§åˆ¶æ¶ˆè´¹ MQ çš„æœåŠ¡æ•°é‡ã€‚è¿˜æœ‰äº›<strong>ä¸šåŠ¡ç³»ç»Ÿçš„é…ç½®æ•°æ®</strong>ï¼Œä¹Ÿä¼šé€šè¿‡ etcd å®æ—¶<strong>åŒæ­¥ç»™ä¸šåŠ¡ç³»ç»Ÿçš„å„èŠ‚ç‚¹</strong>ï¼Œæ¯”å¦‚ï¼Œç§’æ€ç®¡ç†åå°ä¼šä½¿ç”¨ etcd å°†<strong>ç§’æ€æ´»åŠ¨çš„é…ç½®æ•°æ®å®æ—¶åŒæ­¥ç»™ç§’æ€ API æœåŠ¡å„èŠ‚ç‚¹</strong>ã€‚</p><h4 id="Replicaå‰¯æœ¬çš„ä½œç”¨"><a href="#Replicaå‰¯æœ¬çš„ä½œç”¨" class="headerlink" title="Replicaå‰¯æœ¬çš„ä½œç”¨"></a>Replicaå‰¯æœ¬çš„ä½œç”¨</h4><p><strong>Kafka åªæœ‰ Leader å‰¯æœ¬æ‰èƒ½ å¯¹å¤–æä¾›è¯»å†™æœåŠ¡ï¼Œå“åº” Clients ç«¯çš„è¯·æ±‚ã€‚Follower å‰¯æœ¬åªæ˜¯é‡‡ç”¨æ‹‰(PULL)çš„æ–¹ å¼ï¼Œè¢«åŠ¨åœ°åŒæ­¥ Leader å‰¯æœ¬ä¸­çš„æ•°æ®ï¼Œå¹¶ä¸”åœ¨ Leader å‰¯æœ¬æ‰€åœ¨çš„ Broker å®•æœºåï¼Œéšæ—¶å‡†å¤‡åº”è˜ Leader å‰¯æœ¬ã€‚</strong></p><ul><li><strong>è‡ª Kafka 2.4 ç‰ˆæœ¬å¼€å§‹</strong>ï¼Œç¤¾åŒºå¯ä»¥é€šè¿‡é…ç½®å‚æ•°ï¼Œå…è®¸ Follower å‰¯æœ¬æœ‰é™åº¦åœ°æä¾›è¯»æœåŠ¡ã€‚</li><li>ä¹‹å‰ç¡®ä¿ä¸€è‡´æ€§çš„ä¸»è¦æ‰‹æ®µæ˜¯é«˜æ°´ä½æœºåˆ¶ï¼Œ ä½†é«˜æ°´ä½å€¼æ— æ³•ä¿è¯ Leader è¿ç»­å˜æ›´åœºæ™¯ä¸‹çš„æ•°æ®ä¸€è‡´æ€§ï¼Œå› æ­¤ï¼Œç¤¾åŒºå¼•å…¥äº† <strong>Leader Epoch</strong> æœºåˆ¶ï¼Œæ¥ä¿®å¤é«˜æ°´ä½å€¼çš„å¼Šç«¯ã€‚</li></ul><h4 id="ä¸ºä»€ä¹ˆä¸æ”¯æŒè¯»å†™åˆ†ç¦»"><a href="#ä¸ºä»€ä¹ˆä¸æ”¯æŒè¯»å†™åˆ†ç¦»" class="headerlink" title="ä¸ºä»€ä¹ˆä¸æ”¯æŒè¯»å†™åˆ†ç¦»?"></a>ä¸ºä»€ä¹ˆä¸æ”¯æŒè¯»å†™åˆ†ç¦»?</h4><ul><li><p><strong>è‡ª Kafka 2.4 ä¹‹å</strong>ï¼ŒKafka æä¾›äº†æœ‰é™åº¦çš„è¯»å†™åˆ†ç¦»ã€‚</p></li><li><p><strong>åœºæ™¯ä¸é€‚ç”¨</strong>ã€‚è¯»å†™åˆ†ç¦»é€‚ç”¨äºé‚£ç§è¯»è´Ÿè½½å¾ˆå¤§ï¼Œè€Œå†™æ“ä½œç›¸å¯¹ä¸é¢‘ç¹çš„åœºæ™¯ã€‚</p></li><li><p><strong>åŒæ­¥æœºåˆ¶</strong>ã€‚Kafka é‡‡ç”¨ PULL æ–¹å¼å®ç° Follower çš„åŒæ­¥ï¼ŒåŒæ—¶å¤åˆ¶å»¶è¿Ÿè¾ƒå¤§ã€‚</p></li></ul><h4 id="å¦‚ä½•é˜²æ­¢é‡å¤æ¶ˆè´¹"><a href="#å¦‚ä½•é˜²æ­¢é‡å¤æ¶ˆè´¹" class="headerlink" title="å¦‚ä½•é˜²æ­¢é‡å¤æ¶ˆè´¹"></a>å¦‚ä½•é˜²æ­¢é‡å¤æ¶ˆè´¹</h4><ul><li>ä»£ç å±‚é¢æ¯æ¬¡æ¶ˆè´¹éœ€æäº¤offset</li><li>é€šè¿‡Mysqlçš„<strong>å”¯ä¸€é”®çº¦æŸ</strong>ï¼Œç»“åˆRedisæŸ¥çœ‹<strong>idæ˜¯å¦è¢«æ¶ˆè´¹</strong>ï¼Œå­˜Rediså¯ä»¥ç›´æ¥ä½¿ç”¨setæ–¹æ³•</li><li>é‡å¤§ä¸”å…è®¸è¯¯åˆ¤çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ä¹Ÿå¯ä»¥</li></ul><h4 id="å¦‚ä½•ä¿è¯æ•°æ®ä¸ä¼šä¸¢å¤±"><a href="#å¦‚ä½•ä¿è¯æ•°æ®ä¸ä¼šä¸¢å¤±" class="headerlink" title="å¦‚ä½•ä¿è¯æ•°æ®ä¸ä¼šä¸¢å¤±"></a><strong>å¦‚ä½•ä¿è¯æ•°æ®ä¸ä¼šä¸¢å¤±</strong></h4><ul><li><strong>ç”Ÿäº§è€…</strong>ç”Ÿäº§æ¶ˆæ¯å¯ä»¥é€šè¿‡comfirmé…ç½®<strong>ack&#x3D;all</strong>è§£å†³</li><li><strong>Broker</strong>åŒæ­¥è¿‡ç¨‹ä¸­leaderå®•æœºå¯ä»¥é€šè¿‡é…ç½®<strong>ISRå‰¯æœ¬+é‡è¯•</strong>è§£å†³</li><li><strong>æ¶ˆè´¹è€…</strong>ä¸¢å¤±å¯ä»¥<strong>å…³é—­è‡ªåŠ¨æäº¤</strong>offsetåŠŸèƒ½ï¼Œç³»ç»Ÿå¤„ç†å®Œæˆæ—¶æäº¤offset</li></ul><h4 id="å¦‚ä½•ä¿è¯é¡ºåºæ¶ˆè´¹"><a href="#å¦‚ä½•ä¿è¯é¡ºåºæ¶ˆè´¹" class="headerlink" title="å¦‚ä½•ä¿è¯é¡ºåºæ¶ˆè´¹"></a><strong>å¦‚ä½•ä¿è¯é¡ºåºæ¶ˆè´¹</strong></h4><ul><li>å• topicï¼Œå•partitionï¼Œå• consumerï¼Œå•çº¿ç¨‹æ¶ˆè´¹ï¼Œååé‡ä½ï¼Œä¸æ¨è</li><li><strong>å¦‚åªéœ€ä¿è¯å•keyæœ‰åº</strong>ï¼Œä¸ºæ¯ä¸ªkeyç”³è¯·å•ç‹¬å†…å­˜ queueï¼Œæ¯ä¸ªçº¿ç¨‹åˆ†åˆ«æ¶ˆè´¹ä¸€ä¸ªå†…å­˜ queue å³å¯ï¼Œè¿™æ ·å°±èƒ½ä¿è¯å•keyï¼ˆä¾‹å¦‚ç”¨æˆ·idã€æ´»åŠ¨idï¼‰é¡ºåºæ€§ã€‚</li></ul><h4 id="ã€çº¿ä¸Šã€‘å¦‚ä½•è§£å†³ç§¯å‹æ¶ˆè´¹"><a href="#ã€çº¿ä¸Šã€‘å¦‚ä½•è§£å†³ç§¯å‹æ¶ˆè´¹" class="headerlink" title="ã€çº¿ä¸Šã€‘å¦‚ä½•è§£å†³ç§¯å‹æ¶ˆè´¹"></a>ã€çº¿ä¸Šã€‘å¦‚ä½•è§£å†³ç§¯å‹æ¶ˆè´¹</h4><ul><li><strong>ä¿®å¤consumer</strong>ï¼Œä½¿å…¶å…·å¤‡æ¶ˆè´¹èƒ½åŠ›ï¼Œå¹¶ä¸”æ‰©å®¹Nå°</li><li>å†™ä¸€ä¸ª<strong>åˆ†å‘çš„ç¨‹åº</strong>ï¼Œå°†Topicå‡åŒ€åˆ†å‘åˆ°ä¸´æ—¶Topicä¸­</li><li>åŒæ—¶<strong>èµ·Nå°consumer</strong>ï¼Œæ¶ˆè´¹ä¸åŒçš„<strong>ä¸´æ—¶Topic</strong></li></ul><h4 id="å¦‚ä½•é¿å…æ¶ˆæ¯ç§¯å‹"><a href="#å¦‚ä½•é¿å…æ¶ˆæ¯ç§¯å‹" class="headerlink" title="å¦‚ä½•é¿å…æ¶ˆæ¯ç§¯å‹"></a>å¦‚ä½•é¿å…æ¶ˆæ¯ç§¯å‹</h4><ul><li>æé«˜æ¶ˆè´¹å¹¶è¡Œåº¦</li><li>æ‰¹é‡æ¶ˆè´¹</li><li>å‡å°‘ç»„ä»¶IOçš„äº¤äº’æ¬¡æ•°</li><li>ä¼˜å…ˆçº§æ¶ˆè´¹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (maxOffset - curOffset &gt; <span class="number">100000</span>) &#123;</span><br><span class="line">  <span class="comment">// TODO æ¶ˆæ¯å †ç§¯æƒ…å†µçš„ä¼˜å…ˆå¤„ç†é€»è¾‘</span></span><br><span class="line">  <span class="comment">// æœªå¤„ç†çš„æ¶ˆæ¯å¯ä»¥é€‰æ‹©ä¸¢å¼ƒæˆ–è€…æ‰“æ—¥å¿—</span></span><br><span class="line">  <span class="keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// TODO æ­£å¸¸æ¶ˆè´¹è¿‡ç¨‹</span></span><br><span class="line"><span class="keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</span><br></pre></td></tr></table></figure><h4 id="å¦‚ä½•è®¾è®¡æ¶ˆæ¯é˜Ÿåˆ—"><a href="#å¦‚ä½•è®¾è®¡æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="å¦‚ä½•è®¾è®¡æ¶ˆæ¯é˜Ÿåˆ—"></a>å¦‚ä½•è®¾è®¡æ¶ˆæ¯é˜Ÿåˆ—</h4><p>éœ€è¦æ”¯æŒå¿«é€Ÿæ°´å¹³æ‰©å®¹ï¼Œbroker+partitionï¼Œpartitionæ”¾ä¸åŒçš„æœºå™¨ä¸Šï¼Œå¢åŠ æœºå™¨æ—¶å°†æ•°æ®æ ¹æ®topicåšè¿ç§»ï¼Œåˆ†å¸ƒå¼éœ€è¦è€ƒè™‘ä¸€è‡´æ€§ã€å¯ç”¨æ€§ã€åˆ†åŒºå®¹é”™æ€§</p><ul><li><strong>ä¸€è‡´æ€§ï¼š</strong>ç”Ÿäº§è€…çš„æ¶ˆæ¯ç¡®è®¤ã€æ¶ˆè´¹è€…çš„å¹‚ç­‰æ€§ã€Brokerçš„æ•°æ®åŒæ­¥</li><li><strong>å¯ç”¨æ€§ï¼š</strong>æ•°æ®å¦‚ä½•ä¿è¯ä¸ä¸¢ä¸é‡ã€æ•°æ®å¦‚ä½•æŒä¹…åŒ–ã€æŒä¹…åŒ–æ—¶å¦‚ä½•è¯»å†™</li><li><strong>åˆ†åŒºå®¹é”™ï¼š</strong>é‡‡ç”¨ä½•ç§é€‰ä¸¾æœºåˆ¶ã€å¦‚ä½•è¿›è¡Œå¤šå‰¯æœ¬åŒæ­¥</li><li><strong>æµ·é‡æ•°æ®ï¼š</strong>å¦‚ä½•è§£å†³æ¶ˆæ¯ç§¯å‹ã€æµ·é‡Topicæ€§èƒ½ä¸‹é™</li></ul><p>æ€§èƒ½ä¸Šï¼Œå¯ä»¥å€Ÿé‰´<strong>æ—¶é—´è½®ã€é›¶æ‹·è´ã€IOå¤šè·¯å¤ç”¨ã€é¡ºåºè¯»å†™ã€å‹ç¼©æ‰¹å¤„ç†</strong></p><h1 id="ä¸ƒã€Springç¯‡"><a href="#ä¸ƒã€Springç¯‡" class="headerlink" title="ä¸ƒã€Springç¯‡"></a>ä¸ƒã€Springç¯‡</h1><h3 id="è®¾è®¡æ€æƒ³-Beans"><a href="#è®¾è®¡æ€æƒ³-Beans" class="headerlink" title="è®¾è®¡æ€æƒ³&amp;Beans"></a>è®¾è®¡æ€æƒ³&amp;Beans</h3><h4 id="1ã€IOC-æ§åˆ¶åè½¬"><a href="#1ã€IOC-æ§åˆ¶åè½¬" class="headerlink" title="1ã€IOC æ§åˆ¶åè½¬"></a><strong>1ã€IOC æ§åˆ¶åè½¬</strong></h4><p>â€‹IoCï¼ˆInverse of Control:æ§åˆ¶åè½¬ï¼‰æ˜¯â¼€ç§è®¾è®¡æ€æƒ³ï¼Œå°±æ˜¯å°†åŸæœ¬åœ¨ç¨‹åºä¸­â¼¿åŠ¨åˆ›å»ºå¯¹è±¡çš„æ§åˆ¶æƒï¼Œäº¤ç”±Springæ¡†æ¶æ¥ç®¡ç†ã€‚ IoC åœ¨å…¶ä»–è¯­â¾”ä¸­ä¹Ÿæœ‰åº”â½¤ï¼Œå¹¶â¾® Spring ç‰¹æœ‰ã€‚ </p><p>â€‹IoC å®¹å™¨æ˜¯ Springâ½¤æ¥å®ç° IoC çš„è½½ä½“ï¼Œ IoC å®¹å™¨å®é™…ä¸Šå°±æ˜¯ä¸ªMapï¼ˆkeyï¼Œvalueï¼‰,Map ä¸­å­˜æ”¾çš„æ˜¯å„ç§å¯¹è±¡ã€‚å°†å¯¹è±¡ä¹‹é—´çš„ç›¸äº’ä¾èµ–å…³ç³»äº¤ç»™ IoC å®¹å™¨æ¥ç®¡ç†ï¼Œå¹¶ç”± IoC å®¹å™¨å®Œæˆå¯¹è±¡çš„æ³¨â¼Šã€‚è¿™æ ·å¯ä»¥å¾ˆâ¼¤ç¨‹åº¦ä¸Šç®€åŒ–åº”â½¤çš„å¼€å‘ï¼ŒæŠŠåº”â½¤ä»å¤æ‚çš„ä¾èµ–å…³ç³»ä¸­è§£æ”¾å‡ºæ¥ã€‚ IoC å®¹å™¨å°±åƒæ˜¯â¼€ä¸ªâ¼¯â¼šâ¼€æ ·ï¼Œå½“æˆ‘ä»¬éœ€è¦åˆ›å»ºâ¼€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œåªéœ€è¦é…ç½®å¥½é…ç½®â½‚ä»¶&#x2F;æ³¨è§£å³å¯ï¼Œå®Œå…¨ä¸â½¤è€ƒè™‘å¯¹è±¡æ˜¯å¦‚ä½•è¢«åˆ›å»ºå‡ºæ¥çš„ã€‚</p><p><strong>DI ä¾èµ–æ³¨å…¥</strong></p><p>â€‹DI:ï¼ˆDependancy Injectionï¼šä¾èµ–æ³¨å…¥)ç«™åœ¨å®¹å™¨çš„è§’åº¦ï¼Œå°†å¯¹è±¡åˆ›å»ºä¾èµ–çš„å…¶ä»–å¯¹è±¡æ³¨å…¥åˆ°å¯¹è±¡ä¸­ã€‚</p><h4 id="2ã€AOP-åŠ¨æ€ä»£ç†"><a href="#2ã€AOP-åŠ¨æ€ä»£ç†" class="headerlink" title="2ã€AOP åŠ¨æ€ä»£ç†"></a><strong>2ã€AOP åŠ¨æ€ä»£ç†</strong></h4><p>â€‹AOP(Aspect-Oriented Programming:â¾¯å‘åˆ‡â¾¯ç¼–ç¨‹)èƒ½å¤Ÿå°†é‚£äº›ä¸ä¸šåŠ¡â½†å…³ï¼Œå´ä¸ºä¸šåŠ¡æ¨¡å—æ‰€å…±åŒè°ƒâ½¤çš„é€»è¾‘æˆ–è´£ä»»ï¼ˆä¾‹å¦‚äº‹åŠ¡å¤„ç†ã€â½‡å¿—ç®¡ç†ã€æƒé™æ§åˆ¶ç­‰ï¼‰å°è£…èµ·æ¥ï¼Œä¾¿äºå‡å°‘ç³»ç»Ÿçš„é‡å¤ä»£ç ï¼Œé™ä½æ¨¡å—é—´çš„è€¦åˆåº¦ï¼Œå¹¶æœ‰åˆ©äºæœªæ¥çš„å¯æ‹“å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><p>â€‹Spring AOPå°±æ˜¯åŸºäºåŠ¨æ€ä»£ç†çš„ï¼Œå¦‚æœè¦ä»£ç†çš„å¯¹è±¡ï¼Œå®ç°äº†æŸä¸ªæ¥â¼ï¼Œé‚£ä¹ˆSpring AOPä¼šä½¿â½¤JDKProxyï¼Œå»åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œâ½½å¯¹äºæ²¡æœ‰å®ç°æ¥â¼çš„å¯¹è±¡ï¼Œå°±â½†æ³•ä½¿â½¤ JDK Proxy å»è¿›â¾ä»£ç†äº†ï¼Œè¿™æ—¶å€™Spring AOPä¼šä½¿â½¤åŸºäºasmæ¡†æ¶å­—èŠ‚æµçš„CglibåŠ¨æ€ä»£ç† ï¼Œè¿™æ—¶å€™Spring AOPä¼šä½¿â½¤ Cglib â½£æˆâ¼€ä¸ªè¢«ä»£ç†å¯¹è±¡çš„â¼¦ç±»æ¥ä½œä¸ºä»£ç†ã€‚</p><h4 id="3ã€Beanç”Ÿå‘½å‘¨æœŸ"><a href="#3ã€Beanç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="3ã€Beanç”Ÿå‘½å‘¨æœŸ"></a><strong>3ã€Beanç”Ÿå‘½å‘¨æœŸ</strong></h4><p><strong>å•ä¾‹å¯¹è±¡ï¼š</strong> singleton                    </p><p>æ€»ç»“ï¼šå•ä¾‹å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå’Œå®¹å™¨ç›¸åŒ        </p><p><strong>å¤šä¾‹å¯¹è±¡ï¼š</strong> prototype           </p><p>å‡ºç”Ÿï¼šä½¿ç”¨å¯¹è±¡æ—¶springæ¡†æ¶ä¸ºæˆ‘ä»¬åˆ›å»º            </p><p>æ´»ç€ï¼šå¯¹è±¡åªè¦æ˜¯åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å°±ä¸€ç›´æ´»ç€            </p><p>æ­»äº¡ï¼šå½“å¯¹è±¡é•¿æ—¶é—´ä¸ç”¨ä¸”æ²¡æœ‰å…¶å®ƒå¯¹è±¡å¼•ç”¨æ—¶ï¼Œç”±javaçš„åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶</p><img src="https://s0.lgstatic.com/i/image3/M01/89/0C/Cgq2xl6WvHqAdmt4AABGAn2eSiI631.png" alt="img" style="zoom:67%;" /><p>IOCå®¹å™¨åˆå§‹åŒ–åŠ è½½Beanæµç¨‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">refresh</span><span class="params">()</span> <span class="keyword">throws</span> BeansException, IllegalStateException &#123; <span class="keyword">synchronized</span> (<span class="built_in">this</span>.startupShutdownMonitor) &#123;</span><br><span class="line">  <span class="comment">// ç¬¬ä¸€æ­¥:åˆ·æ–°å‰çš„é¢„å¤„ç† </span></span><br><span class="line">  prepareRefresh();</span><br><span class="line">  <span class="comment">//ç¬¬äºŒæ­¥: è·å–BeanFactoryå¹¶æ³¨å†Œåˆ° BeanDefitionRegistry</span></span><br><span class="line">  <span class="type">ConfigurableListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> obtainFreshBeanFactory();</span><br><span class="line">  <span class="comment">// ç¬¬ä¸‰æ­¥:åŠ è½½BeanFactoryçš„é¢„å‡†å¤‡å·¥ä½œ(BeanFactoryè¿›è¡Œä¸€äº›è®¾ç½®ï¼Œæ¯”å¦‚contextçš„ç±»åŠ è½½å™¨ç­‰)</span></span><br><span class="line">  prepareBeanFactory(beanFactory);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// ç¬¬å››æ­¥:å®ŒæˆBeanFactoryå‡†å¤‡å·¥ä½œåçš„å‰ç½®å¤„ç†å·¥ä½œ </span></span><br><span class="line">    postProcessBeanFactory(beanFactory);</span><br><span class="line">    <span class="comment">// ç¬¬äº”æ­¥:å®ä¾‹åŒ–BeanFactoryPostProcessoræ¥å£çš„Bean </span></span><br><span class="line">    invokeBeanFactoryPostProcessors(beanFactory);</span><br><span class="line">    <span class="comment">// ç¬¬å…­æ­¥:æ³¨å†ŒBeanPostProcessoråç½®å¤„ç†å™¨ï¼Œåœ¨åˆ›å»ºbeançš„åæ‰§è¡Œ </span></span><br><span class="line">    registerBeanPostProcessors(beanFactory);</span><br><span class="line">    <span class="comment">// ç¬¬ä¸ƒæ­¥:åˆå§‹åŒ–MessageSourceç»„ä»¶(åšå›½é™…åŒ–åŠŸèƒ½;æ¶ˆæ¯ç»‘å®šï¼Œæ¶ˆæ¯è§£æ); </span></span><br><span class="line">    initMessageSource();</span><br><span class="line">    <span class="comment">// ç¬¬å…«æ­¥:æ³¨å†Œåˆå§‹åŒ–äº‹ä»¶æ´¾å‘å™¨ </span></span><br><span class="line">    initApplicationEventMulticaster();</span><br><span class="line">    <span class="comment">// ç¬¬ä¹æ­¥:å­ç±»é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨å®¹å™¨åˆ·æ–°çš„æ—¶å€™å¯ä»¥è‡ªå®šä¹‰é€»è¾‘ </span></span><br><span class="line">    onRefresh();</span><br><span class="line">    <span class="comment">// ç¬¬åæ­¥:æ³¨å†Œåº”ç”¨çš„ç›‘å¬å™¨ã€‚å°±æ˜¯æ³¨å†Œå®ç°äº†ApplicationListeneræ¥å£çš„ç›‘å¬å™¨</span></span><br><span class="line">    registerListeners();</span><br><span class="line">    <span class="comment">//ç¬¬åä¸€æ­¥:åˆå§‹åŒ–æ‰€æœ‰å‰©ä¸‹çš„éæ‡’åŠ è½½çš„å•ä¾‹bean åˆå§‹åŒ–åˆ›å»ºéæ‡’åŠ è½½æ–¹å¼çš„å•ä¾‹Beanå®ä¾‹(æœªè®¾ç½®å±æ€§)</span></span><br><span class="line">    finishBeanFactoryInitialization(beanFactory);</span><br><span class="line">    <span class="comment">//ç¬¬åäºŒæ­¥: å®Œæˆcontextçš„åˆ·æ–°ã€‚ä¸»è¦æ˜¯è°ƒç”¨LifecycleProcessorçš„onRefresh()æ–¹æ³•ï¼Œå®Œæˆåˆ›å»º</span></span><br><span class="line">    finishRefresh();</span><br><span class="line">&#125;</span><br><span class="line">  â€¦â€¦</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>æ€»ç»“ï¼š</p><p><strong>å››ä¸ªé˜¶æ®µ</strong></p><ul><li>å®ä¾‹åŒ– Instantiation</li><li>å±æ€§èµ‹å€¼ Populate</li><li>åˆå§‹åŒ– Initialization</li><li>é”€æ¯ Destruction</li></ul><p><strong>å¤šä¸ªæ‰©å±•ç‚¹</strong></p><ul><li>å½±å“å¤šä¸ªBean<ul><li>BeanPostProcessor</li><li>InstantiationAwareBeanPostProcessor</li></ul></li><li>å½±å“å•ä¸ªBean<ul><li>Aware</li></ul></li></ul><p><strong>å®Œæ•´æµç¨‹</strong>  </p><ol><li>å®ä¾‹åŒ–ä¸€ä¸ªBeanï¼ï¼ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„<strong>new</strong>ï¼›</li><li>æŒ‰ç…§Springä¸Šä¸‹æ–‡å¯¹å®ä¾‹åŒ–çš„Beanè¿›è¡Œé…ç½®ï¼ï¼<strong>ä¹Ÿå°±æ˜¯IOCæ³¨å…¥</strong>ï¼›</li><li>å¦‚æœè¿™ä¸ªBeanå·²ç»å®ç°äº†BeanNameAwareæ¥å£ï¼Œä¼šè°ƒç”¨å®ƒå®ç°çš„setBeanName(String)æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æ ¹æ®å°±æ˜¯Springé…ç½®æ–‡ä»¶ä¸­<strong>Beançš„idå’Œnameè¿›è¡Œä¼ é€’</strong></li><li>å¦‚æœè¿™ä¸ªBeanå·²ç»å®ç°äº†BeanFactoryAwareæ¥å£ï¼Œä¼šè°ƒç”¨å®ƒå®ç°setBeanFactory(BeanFactory)ä¹Ÿå°±æ˜¯Springé…ç½®æ–‡ä»¶é…ç½®çš„<strong>Springå·¥å‚è‡ªèº«è¿›è¡Œä¼ é€’</strong>ï¼›</li><li>å¦‚æœè¿™ä¸ªBeanå·²ç»å®ç°äº†ApplicationContextAwareæ¥å£ï¼Œä¼šè°ƒç”¨setApplicationContext(ApplicationContext)æ–¹æ³•ï¼Œå’Œ4ä¼ é€’çš„ä¿¡æ¯ä¸€æ ·ä½†æ˜¯å› ä¸ºApplicationContextæ˜¯BeanFactoryçš„å­æ¥å£ï¼Œæ‰€ä»¥<strong>æ›´åŠ çµæ´»</strong></li><li>å¦‚æœè¿™ä¸ªBeanå…³è”äº†BeanPostProcessoræ¥å£ï¼Œå°†ä¼šè°ƒç”¨postProcessBeforeInitialization()æ–¹æ³•ï¼ŒBeanPostProcessorç»å¸¸è¢«ç”¨ä½œæ˜¯Beanå†…å®¹çš„æ›´æ”¹ï¼Œç”±äºè¿™ä¸ªæ˜¯åœ¨Beanåˆå§‹åŒ–ç»“æŸæ—¶è°ƒç”¨é‚£ä¸ªçš„æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥è¢«åº”ç”¨äº<strong>å†…å­˜æˆ–ç¼“å­˜æŠ€</strong>æœ¯</li><li>å¦‚æœBeanåœ¨Springé…ç½®æ–‡ä»¶ä¸­é…ç½®äº†init-methodå±æ€§ä¼šè‡ªåŠ¨è°ƒç”¨å…¶é…ç½®çš„åˆå§‹åŒ–æ–¹æ³•ã€‚</li><li>å¦‚æœè¿™ä¸ªBeanå…³è”äº†BeanPostProcessoræ¥å£ï¼Œå°†ä¼šè°ƒç”¨postProcessAfterInitialization()ï¼Œ<strong>æ‰“å°æ—¥å¿—æˆ–è€…ä¸‰çº§ç¼“å­˜æŠ€æœ¯é‡Œé¢çš„beanå‡çº§</strong></li><li>ä»¥ä¸Šå·¥ä½œå®Œæˆä»¥åå°±å¯ä»¥åº”ç”¨è¿™ä¸ªBeanäº†ï¼Œé‚£è¿™ä¸ªBeanæ˜¯ä¸€ä¸ªSingletonçš„ï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬è°ƒç”¨åŒä¸€ä¸ªidçš„Beanä¼šæ˜¯åœ¨å†…å®¹åœ°å€ç›¸åŒçš„å®ä¾‹ï¼Œå½“ç„¶åœ¨Springé…ç½®æ–‡ä»¶ä¸­ä¹Ÿå¯ä»¥é…ç½®éSingletonï¼Œè¿™é‡Œæˆ‘ä»¬ä¸åšèµ˜è¿°ã€‚</li><li>å½“Beanä¸å†éœ€è¦æ—¶ï¼Œä¼šç»è¿‡æ¸…ç†é˜¶æ®µï¼Œå¦‚æœBeanå®ç°äº†DisposableBeanè¿™ä¸ªæ¥å£ï¼Œæˆ–è€…æ ¹æ®springé…ç½®çš„destroy-methodå±æ€§ï¼Œè°ƒç”¨å®ç°çš„destroy()æ–¹æ³•</li></ol><h4 id="4ã€Beanä½œç”¨åŸŸ"><a href="#4ã€Beanä½œç”¨åŸŸ" class="headerlink" title="4ã€Beanä½œç”¨åŸŸ"></a><strong>4</strong>ã€Beanä½œç”¨åŸŸ</h4><table><thead><tr><th>åç§°</th><th>ä½œç”¨åŸŸ</th></tr></thead><tbody><tr><td><strong>singleton</strong></td><td><strong>å•ä¾‹å¯¹è±¡ï¼Œé»˜è®¤å€¼çš„ä½œç”¨åŸŸ</strong></td></tr><tr><td><strong>prototype</strong></td><td><strong>æ¯æ¬¡è·å–éƒ½ä¼šåˆ›å»ºâ¼€ä¸ªæ–°çš„ bean å®ä¾‹</strong></td></tr><tr><td>request</td><td>æ¯â¼€æ¬¡HTTPè¯·æ±‚éƒ½ä¼šäº§â½£â¼€ä¸ªæ–°çš„beanï¼Œè¯¥beanä»…åœ¨å½“å‰HTTP requestå†…æœ‰æ•ˆã€‚</td></tr><tr><td>session</td><td>åœ¨ä¸€æ¬¡ HTTP session ä¸­ï¼Œå®¹å™¨å°†è¿”å›åŒä¸€ä¸ªå®ä¾‹</td></tr><tr><td>global-session</td><td>å°†å¯¹è±¡å­˜å…¥åˆ°webé¡¹ç›®é›†ç¾¤çš„sessionåŸŸä¸­,è‹¥ä¸å­˜åœ¨é›†ç¾¤,åˆ™global sessionç›¸å½“äºsession</td></tr></tbody></table><p>é»˜è®¤ä½œç”¨åŸŸæ˜¯singletonï¼Œå¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªbeanæ—¶ä¼šå­˜åœ¨çº¿ç¨‹ä¸å®‰å…¨é—®é¢˜</p><p><strong>ä¿éšœçº¿ç¨‹å®‰å…¨æ–¹æ³•ï¼š</strong></p><ol><li><p>åœ¨Beanå¯¹è±¡ä¸­å°½é‡é¿å…å®šä¹‰å¯å˜çš„æˆå‘˜å˜é‡ï¼ˆä¸å¤ªç°å®ï¼‰ã€‚</p></li><li><p>åœ¨ç±»ä¸­å®šä¹‰â¼€ä¸ªThreadLocalæˆå‘˜å˜é‡ï¼Œå°†éœ€è¦çš„å¯å˜æˆå‘˜å˜é‡ä¿å­˜åœ¨ ThreadLocal ä¸­</p></li></ol><p> <strong>ThreadLocal</strong>ï¼š</p><p>  â€‹æ¯ä¸ªçº¿ç¨‹ä¸­éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„ThreadLocalMapç±»å¯¹è±¡ï¼Œå¯ä»¥å°†çº¿ç¨‹è‡ªå·±çš„å¯¹è±¡ä¿æŒåˆ°å…¶ä¸­ï¼Œå„ç®¡å„çš„ï¼Œçº¿ç¨‹å¯ä»¥æ­£ç¡®çš„è®¿é—®åˆ°è‡ªå·±çš„å¯¹è±¡ã€‚</p><p>  â€‹å°†ä¸€ä¸ªå…±ç”¨çš„ThreadLocalé™æ€å®ä¾‹ä½œä¸ºkeyï¼Œå°†ä¸åŒå¯¹è±¡çš„å¼•ç”¨ä¿å­˜åˆ°ä¸åŒçº¿ç¨‹çš„ThreadLocalMapä¸­ï¼Œç„¶å<strong>åœ¨çº¿ç¨‹æ‰§è¡Œçš„å„å¤„é€šè¿‡è¿™ä¸ªé™æ€ThreadLocalå®ä¾‹çš„get()æ–¹æ³•å–å¾—è‡ªå·±çº¿ç¨‹ä¿å­˜çš„é‚£ä¸ªå¯¹è±¡</strong>ï¼Œé¿å…äº†å°†è¿™ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’çš„éº»çƒ¦ã€‚</p><h4 id="5ã€å¾ªç¯ä¾èµ–"><a href="#5ã€å¾ªç¯ä¾èµ–" class="headerlink" title="5ã€å¾ªç¯ä¾èµ–"></a>5ã€å¾ªç¯ä¾èµ–</h4><p>â€‹å¾ªç¯ä¾èµ–å…¶å®å°±æ˜¯å¾ªç¯å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªæˆ–è€…ä¸¤ä¸ªä»¥ä¸Šçš„ Bean äº’ç›¸æŒæœ‰å¯¹æ–¹ï¼Œæœ€ç»ˆå½¢æˆé—­ç¯ã€‚æ¯”å¦‚A ä¾èµ–äºBï¼ŒBåˆä¾èµ–äºA</p><p>Springä¸­å¾ªç¯ä¾èµ–åœºæ™¯æœ‰: </p><ul><li><p>prototype åŸå‹ beanå¾ªç¯ä¾èµ–</p></li><li><p>æ„é€ å™¨çš„å¾ªç¯ä¾èµ–ï¼ˆæ„é€ å™¨æ³¨å…¥ï¼‰</p></li><li><p>Field å±æ€§çš„å¾ªç¯ä¾èµ–ï¼ˆsetæ³¨å…¥ï¼‰</p><p>å…¶ä¸­ï¼Œæ„é€ å™¨çš„å¾ªç¯ä¾èµ–é—®é¢˜æ— æ³•è§£å†³ï¼Œåœ¨è§£å†³å±æ€§å¾ªç¯ä¾èµ–æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ‡’åŠ è½½ï¼Œspringé‡‡ç”¨çš„æ˜¯æå‰æš´éœ²å¯¹è±¡çš„æ–¹æ³•ã€‚</p></li></ul><p><strong>æ‡’åŠ è½½@Lazyè§£å†³å¾ªç¯ä¾èµ–é—®é¢˜</strong></p><p>â€‹Spring å¯åŠ¨çš„æ—¶å€™ä¼šæŠŠæ‰€æœ‰beanä¿¡æ¯(åŒ…æ‹¬XMLå’Œæ³¨è§£)è§£æè½¬åŒ–æˆSpringèƒ½å¤Ÿè¯†åˆ«çš„BeanDefinitionå¹¶å­˜åˆ°Hashmapé‡Œä¾›ä¸‹é¢çš„åˆå§‹åŒ–æ—¶ç”¨ï¼Œç„¶åå¯¹æ¯ä¸ª BeanDefinition è¿›è¡Œå¤„ç†ã€‚æ™®é€š Bean çš„åˆå§‹åŒ–æ˜¯åœ¨å®¹å™¨å¯åŠ¨åˆå§‹åŒ–é˜¶æ®µæ‰§è¡Œçš„ï¼Œè€Œè¢«lazy-init&#x3D;trueä¿®é¥°çš„ bean åˆ™æ˜¯åœ¨ä»å®¹å™¨é‡Œç¬¬ä¸€æ¬¡è¿›è¡Œ<strong>context.getBean() æ—¶è¿›è¡Œè§¦å‘</strong>ã€‚</p><p>â€‹     </p><p><strong>ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜</strong></p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1glv7ivru2lj31980qcn13.jpg" alt="å¾ªç¯ä¾èµ–é—®é¢˜" style="zoom: 33%;" /><ol><li><p>Springå®¹å™¨åˆå§‹åŒ–ClassAé€šè¿‡æ„é€ å™¨åˆå§‹åŒ–å¯¹è±¡åæå‰æš´éœ²åˆ°Springå®¹å™¨ä¸­çš„singletonFactorysï¼ˆä¸‰çº§ç¼“å­˜ä¸­ï¼‰ã€‚</p></li><li><p>ClassAè°ƒç”¨setClassBæ–¹æ³•ï¼ŒSpringé¦–å…ˆå°è¯•ä»å®¹å™¨ä¸­è·å–ClassBï¼Œæ­¤æ—¶ClassBä¸å­˜åœ¨Spring å®¹å™¨ä¸­ã€‚</p></li><li><p>Springå®¹å™¨åˆå§‹åŒ–ClassBï¼ŒClasssBé¦–å…ˆå°†è‡ªå·±æš´éœ²åœ¨ä¸‰çº§ç¼“å­˜ä¸­ï¼Œç„¶åä»Springå®¹å™¨ä¸€çº§ã€äºŒçº§ã€ä¸‰çº§ç¼“å­˜ä¸­ä¸€æ¬¡ä¸­è·å–ClassA ã€‚</p></li><li><p>è·å–åˆ°ClassAåå°†è‡ªå·±å®ä¾‹åŒ–æ”¾å…¥å•ä¾‹æ± ä¸­ï¼Œå®ä¾‹ ClassAé€šè¿‡Springå®¹å™¨è·å–åˆ°ClassBï¼Œå®Œæˆäº†è‡ªå·±å¯¹è±¡åˆå§‹åŒ–æ“ä½œã€‚</p></li><li><p>è¿™æ ·ClassAå’ŒClassBéƒ½å®Œæˆäº†å¯¹è±¡åˆå§‹åŒ–æ“ä½œï¼Œä»è€Œè§£å†³äº†å¾ªç¯ä¾èµ–é—®é¢˜ã€‚</p></li></ol><h3 id="Springæ³¨è§£"><a href="#Springæ³¨è§£" class="headerlink" title="Springæ³¨è§£"></a>Springæ³¨è§£</h3><h4 id="1ã€-SpringBoot"><a href="#1ã€-SpringBoot" class="headerlink" title="1ã€@SpringBoot"></a>1ã€@SpringBoot</h4><p>â€‹<strong>å£°æ˜beançš„æ³¨è§£</strong></p><p>â€‹<strong>@Component</strong> é€šâ½¤çš„æ³¨è§£ï¼Œå¯æ ‡æ³¨ä»»æ„ç±»ä¸º  Spring ç»„ä»¶</p><p>â€‹<strong>@Service</strong> åœ¨ä¸šåŠ¡é€»è¾‘å±‚ä½¿ç”¨ï¼ˆserviceå±‚ï¼‰</p><p>â€‹<strong>@Repository</strong> åœ¨æ•°æ®è®¿é—®å±‚ä½¿ç”¨ï¼ˆdaoå±‚ï¼‰</p><p>â€‹<strong>@Controller</strong> åœ¨å±•ç°å±‚ä½¿ç”¨ï¼Œæ§åˆ¶å™¨çš„å£°æ˜ï¼ˆcontrollerå±‚ï¼‰</p><p>â€‹<strong>æ³¨å…¥beançš„æ³¨è§£</strong></p><p>â€‹<strong>@Autowired</strong>ï¼šé»˜è®¤æŒ‰ç…§ç±»å‹æ¥è£…é…æ³¨å…¥ï¼Œ**@Qualifier**ï¼šå¯ä»¥æ”¹æˆåç§°</p><p>â€‹<strong>@Resource</strong>ï¼šé»˜è®¤æŒ‰ç…§åç§°æ¥è£…é…æ³¨å…¥ï¼ŒJDKçš„æ³¨è§£ï¼Œæ–°ç‰ˆæœ¬å·²ç»å¼ƒç”¨</p><p><strong>@Autowiredæ³¨è§£åŸç†</strong> </p><p>â€‹ @Autowiredçš„ä½¿ç”¨ç®€åŒ–äº†æˆ‘ä»¬çš„å¼€å‘ï¼Œ</p><p>â€‹å®ç° AutowiredAnnotationBeanPostProcessor ç±»ï¼Œè¯¥ç±»å®ç°äº† Spring æ¡†æ¶çš„ä¸€äº›æ‰©å±•æ¥å£ã€‚<br>â€‹å®ç° BeanFactoryAware æ¥å£ä½¿å…¶å†…éƒ¨æŒæœ‰äº† BeanFactoryï¼ˆå¯è½»æ¾çš„è·å–éœ€è¦ä¾èµ–çš„çš„ Beanï¼‰ã€‚<br>â€‹å®ç° MergedBeanDefinitionPostProcessor æ¥å£ï¼Œå®ä¾‹åŒ–Bean å‰è·å–åˆ° é‡Œé¢çš„ @Autowired ä¿¡æ¯å¹¶ç¼“å­˜ä¸‹æ¥ï¼›<br>â€‹å®ç° postProcessPropertyValues æ¥å£ï¼Œ å®ä¾‹åŒ–Bean åä»ç¼“å­˜å–å‡ºæ³¨è§£ä¿¡æ¯ï¼Œé€šè¿‡åå°„å°†ä¾èµ–å¯¹è±¡è®¾ç½®åˆ° Bean å±æ€§é‡Œé¢ã€‚</p><p><strong>@SpringBootApplication</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JpaApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(JpaApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>@SpringBootApplication</strong>æ³¨è§£ç­‰åŒäºä¸‹é¢ä¸‰ä¸ªæ³¨è§£ï¼š</p><ul><li><strong>@SpringBootConfigurationï¼š</strong> åº•å±‚æ˜¯<strong>Configuration</strong>æ³¨è§£ï¼Œè¯´ç™½äº†å°±æ˜¯æ”¯æŒ<strong>JavaConfig</strong>çš„æ–¹å¼æ¥è¿›è¡Œé…ç½®</li><li><strong>@EnableAutoConfigurationï¼š</strong>å¼€å¯<strong>è‡ªåŠ¨é…ç½®</strong>åŠŸèƒ½</li><li><strong>@ComponentScanï¼š</strong>å°±æ˜¯<strong>æ‰«æ</strong>æ³¨è§£ï¼Œé»˜è®¤æ˜¯æ‰«æ<strong>å½“å‰ç±»ä¸‹</strong>çš„package</li></ul><p>å…¶ä¸­<code>@EnableAutoConfiguration</code>æ˜¯å…³é”®(å¯ç”¨è‡ªåŠ¨é…ç½®)ï¼Œå†…éƒ¨å®é™…ä¸Šå°±å»åŠ è½½<code>META-INF/spring.factories</code>æ–‡ä»¶çš„ä¿¡æ¯ï¼Œç„¶åç­›é€‰å‡ºä»¥<code>EnableAutoConfiguration</code>ä¸ºkeyçš„æ•°æ®ï¼ŒåŠ è½½åˆ°IOCå®¹å™¨ä¸­ï¼Œå®ç°è‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼</p><p>å®ƒä¸»è¦åŠ è½½äº†@SpringBootApplicationæ³¨è§£ä¸»é…ç½®ç±»ï¼Œè¿™ä¸ª@SpringBootApplicationæ³¨è§£ä¸»é…ç½®ç±»é‡Œè¾¹æœ€ä¸»è¦çš„åŠŸèƒ½å°±æ˜¯SpringBootå¼€å¯äº†ä¸€ä¸ª@EnableAutoConfigurationæ³¨è§£çš„è‡ªåŠ¨é…ç½®åŠŸèƒ½ã€‚</p><p> <strong>@EnableAutoConfigurationä½œç”¨ï¼š</strong></p><p>å®ƒä¸»è¦åˆ©ç”¨äº†ä¸€ä¸ª</p><p>EnableAutoConfigurationImportSelectoré€‰æ‹©å™¨ç»™Springå®¹å™¨ä¸­æ¥å¯¼å…¥ä¸€äº›ç»„ä»¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(EnableAutoConfigurationImportSelector.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAutoConfiguration </span><br></pre></td></tr></table></figure><h4 id="2ã€-SpringMVC"><a href="#2ã€-SpringMVC" class="headerlink" title="2ã€@SpringMVC"></a><strong>2ã€@SpringMVC</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span> å£°æ˜è¯¥ç±»ä¸ºSpringMVCä¸­çš„Controller</span><br><span class="line"><span class="meta">@RequestMapping</span> ç”¨äºæ˜ å°„Webè¯·æ±‚</span><br><span class="line"><span class="meta">@ResponseBody</span> æ”¯æŒå°†è¿”å›å€¼æ”¾åœ¨responseå†…ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªé¡µé¢ï¼Œé€šå¸¸ç”¨æˆ·è¿”å›jsonæ•°æ®</span><br><span class="line"><span class="meta">@RequestBody</span> å…è®¸requestçš„å‚æ•°åœ¨requestä½“ä¸­ï¼Œè€Œä¸æ˜¯åœ¨ç›´æ¥è¿æ¥åœ¨åœ°å€åé¢ã€‚</span><br><span class="line"><span class="meta">@PathVariable</span> ç”¨äºæ¥æ”¶è·¯å¾„å‚æ•°</span><br><span class="line"><span class="meta">@RequestMapping(&quot;/hello/&#123;name&#125;&quot;)</span>ç”³æ˜çš„è·¯å¾„ï¼Œå°†æ³¨è§£æ”¾åœ¨å‚æ•°ä¸­å‰ï¼Œå³å¯è·å–è¯¥å€¼ï¼Œé€šå¸¸ä½œä¸ºRestfulçš„æ¥å£å®ç°æ–¹æ³•ã€‚</span><br></pre></td></tr></table></figure><p><strong>SpringMVCåŸç†</strong> </p><img src="https://img-blog.csdn.net/20181022224058617?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2F3YWtlX2xxaA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" style="zoom: 50%;" /><ol><li>å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰å‘é€è¯·æ±‚ï¼Œç›´æ¥è¯·æ±‚åˆ°  DispatcherServlet ã€‚</li><li>DispatcherServlet æ ¹æ®è¯·æ±‚ä¿¡æ¯è°ƒâ½¤  HandlerMapping ï¼Œè§£æè¯·æ±‚å¯¹åº”çš„  Handler ã€‚</li><li>è§£æåˆ°å¯¹åº”çš„  Handler ï¼ˆä¹Ÿå°±æ˜¯  Controller æ§åˆ¶å™¨ï¼‰åï¼Œå¼€å§‹ç”±HandlerAdapter é€‚é…å™¨å¤„ç†ã€‚</li><li>HandlerAdapter ä¼šæ ¹æ®  Handler æ¥è°ƒâ½¤çœŸæ­£çš„å¤„ç†å™¨å¼€å¤„ç†è¯·æ±‚ï¼Œå¹¶å¤„ç†ç›¸åº”çš„ä¸šåŠ¡é€»è¾‘ã€‚</li><li>å¤„ç†å™¨å¤„ç†å®Œä¸šåŠ¡åï¼Œä¼šè¿”å›â¼€ä¸ª  ModelAndView å¯¹è±¡ï¼Œ Model æ˜¯è¿”å›çš„æ•°æ®å¯¹è±¡</li><li>ViewResolver ä¼šæ ¹æ®é€»è¾‘  View æŸ¥æ‰¾å®é™…çš„  View ã€‚</li><li>DispaterServlet æŠŠè¿”å›çš„  Model ä¼ ç»™  View ï¼ˆè§†å›¾æ¸²æŸ“ï¼‰ã€‚</li><li>æŠŠ  View è¿”å›ç»™è¯·æ±‚è€…ï¼ˆæµè§ˆå™¨ï¼‰</li></ol><h4 id="3ã€-SpringMybatis"><a href="#3ã€-SpringMybatis" class="headerlink" title="3ã€@SpringMybatis"></a>3ã€@SpringMybatis</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Insert</span> ï¼š æ’å…¥sql ,å’Œxml insert sqlè¯­æ³•å®Œå…¨ä¸€æ ·</span><br><span class="line"><span class="meta">@Select</span> ï¼š æŸ¥è¯¢sql, å’Œxml select sqlè¯­æ³•å®Œå…¨ä¸€æ ·</span><br><span class="line"><span class="meta">@Update</span> ï¼š æ›´æ–°sql, å’Œxml update sqlè¯­æ³•å®Œå…¨ä¸€æ ·</span><br><span class="line"><span class="meta">@Delete</span> ï¼š åˆ é™¤sql, å’Œxml delete sqlè¯­æ³•å®Œå…¨ä¸€æ ·</span><br><span class="line"><span class="meta">@Param</span> ï¼š å…¥å‚</span><br><span class="line"><span class="meta">@Results</span> ï¼š è®¾ç½®ç»“æœé›†åˆ<span class="meta">@Result</span> ï¼š ç»“æœ</span><br><span class="line"><span class="meta">@ResultMap</span> ï¼š å¼•ç”¨ç»“æœé›†åˆ</span><br><span class="line"><span class="meta">@SelectKey</span> ï¼š è·å–æœ€æ–°æ’å…¥id </span><br></pre></td></tr></table></figure><p><strong>mybatiså¦‚ä½•é˜²æ­¢sqlæ³¨å…¥ï¼Ÿ</strong></p><p>â€‹ç®€å•çš„è¯´å°±æ˜¯#{}æ˜¯ç»è¿‡é¢„ç¼–è¯‘çš„ï¼Œæ˜¯å®‰å…¨çš„ï¼Œ**$<strong>{}æ˜¯æœªç»è¿‡é¢„ç¼–è¯‘çš„ï¼Œä»…ä»…æ˜¯å–å˜é‡çš„å€¼ï¼Œæ˜¯éå®‰å…¨çš„ï¼Œå­˜åœ¨SQLæ³¨å…¥ã€‚åœ¨ç¼–å†™mybatisçš„æ˜ å°„è¯­å¥æ—¶ï¼Œå°½é‡é‡‡ç”¨</strong>â€œ#{xxx}â€<strong>è¿™æ ·çš„æ ¼å¼ã€‚å¦‚æœéœ€è¦å®ç°åŠ¨æ€ä¼ å…¥è¡¨åã€åˆ—åï¼Œè¿˜éœ€è¦åšå¦‚ä¸‹ä¿®æ”¹ï¼šæ·»åŠ å±æ€§</strong>statementType&#x3D;â€STATEMENTâ€<strong>ï¼ŒåŒæ—¶sqlé‡Œçš„å±æœ‰å˜é‡å–å€¼éƒ½æ”¹æˆ</strong>${xxxx}**</p><p><strong>Mybatiså’ŒHibernateçš„åŒºåˆ«</strong> </p><p><strong>Hibernate æ¡†æ¶ï¼š</strong> </p><p>â€‹    <strong>Hibernate</strong>æ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç çš„å¯¹è±¡å…³ç³»æ˜ å°„æ¡†æ¶,å®ƒå¯¹JDBCè¿›è¡Œäº†éå¸¸è½»é‡çº§çš„å¯¹è±¡å°è£…,å»ºç«‹å¯¹è±¡ä¸æ•°æ®åº“è¡¨çš„æ˜ å°„ã€‚æ˜¯ä¸€ä¸ªå…¨è‡ªåŠ¨çš„ã€å®Œå…¨é¢å‘å¯¹è±¡çš„æŒä¹…å±‚æ¡†æ¶ã€‚</p><p><strong>Mybatisæ¡†æ¶ï¼š</strong></p><p>â€‹    <strong>Mybatis</strong>æ˜¯ä¸€ä¸ªå¼€æºå¯¹è±¡å…³ç³»æ˜ å°„æ¡†æ¶ï¼ŒåŸåï¼šibatis,2010å¹´ç”±è°·æ­Œæ¥ç®¡ä»¥åæ›´åã€‚æ˜¯ä¸€ä¸ªåŠè‡ªåŠ¨åŒ–çš„æŒä¹…å±‚æ¡†æ¶ã€‚</p><p><strong>åŒºåˆ«ï¼š</strong></p><p>  <strong>å¼€å‘æ–¹é¢</strong></p><p>â€‹    åœ¨é¡¹ç›®å¼€å‘è¿‡ç¨‹å½“ä¸­ï¼Œå°±é€Ÿåº¦è€Œè¨€ï¼š</p><p>â€‹      hibernateå¼€å‘ä¸­ï¼Œsqlè¯­å¥å·²ç»è¢«å°è£…ï¼Œç›´æ¥å¯ä»¥ä½¿ç”¨ï¼ŒåŠ å¿«ç³»ç»Ÿå¼€å‘ï¼›</p><p>â€‹      Mybatis å±äºåŠè‡ªåŠ¨åŒ–ï¼Œsqléœ€è¦æ‰‹å·¥å®Œæˆï¼Œç¨å¾®ç¹çï¼›</p><p>â€‹    ä½†æ˜¯ï¼Œå‡¡äº‹éƒ½ä¸æ˜¯ç»å¯¹çš„ï¼Œå¦‚æœå¯¹äºåºå¤§å¤æ‚çš„ç³»ç»Ÿé¡¹ç›®æ¥è¯´ï¼Œå¤æ‚è¯­å¥è¾ƒå¤šï¼Œhibernate å°±ä¸æ˜¯å¥½æ–¹æ¡ˆã€‚</p><p>  <strong>sqlä¼˜åŒ–æ–¹é¢</strong></p><p>â€‹    Hibernate è‡ªåŠ¨ç”Ÿæˆsql,æœ‰äº›è¯­å¥è¾ƒä¸ºç¹çï¼Œä¼šå¤šæ¶ˆè€—ä¸€äº›æ€§èƒ½ï¼›</p><p>â€‹    Mybatis æ‰‹åŠ¨ç¼–å†™sqlï¼Œå¯ä»¥é¿å…ä¸éœ€è¦çš„æŸ¥è¯¢ï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½ï¼›</p><p>  <strong>å¯¹è±¡ç®¡ç†æ¯”å¯¹</strong></p><p>â€‹    Hibernate æ˜¯å®Œæ•´çš„å¯¹è±¡-å…³ç³»æ˜ å°„çš„æ¡†æ¶ï¼Œå¼€å‘å·¥ç¨‹ä¸­ï¼Œæ— éœ€è¿‡å¤šå…³æ³¨åº•å±‚å®ç°ï¼Œåªè¦å»ç®¡ç†å¯¹è±¡å³å¯ï¼›</p><p>â€‹    Mybatis éœ€è¦è‡ªè¡Œç®¡ç†æ˜ å°„å…³ç³»ï¼›</p><h4 id="4ã€-Transactional"><a href="#4ã€-Transactional" class="headerlink" title="4ã€@Transactional"></a>4ã€@Transactional</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableTransactionManagement</span> </span><br><span class="line"><span class="meta">@Transactional</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„äº‹é¡¹ï¼š</p><p>â€‹â‘ äº‹åŠ¡å‡½æ•°ä¸­ä¸è¦å¤„ç†è€—æ—¶ä»»åŠ¡ï¼Œä¼šå¯¼è‡´é•¿æœŸå æœ‰æ•°æ®åº“è¿æ¥ã€‚</p><p>â€‹â‘¡äº‹åŠ¡å‡½æ•°ä¸­ä¸è¦å¤„ç†æ— å…³ä¸šåŠ¡ï¼Œé˜²æ­¢äº§ç”Ÿå¼‚å¸¸å¯¼è‡´äº‹åŠ¡å›æ»šã€‚</p><p><strong>äº‹åŠ¡ä¼ æ’­å±æ€§</strong></p><p><strong>1) REQUIREDï¼ˆé»˜è®¤å±æ€§ï¼‰</strong> å¦‚æœå­˜åœ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œåˆ™æ”¯æŒå½“å‰äº‹åŠ¡ã€‚å¦‚æœæ²¡æœ‰äº‹åŠ¡åˆ™å¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚ </p><ol start="2"><li><p>MANDATORY  æ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ã€‚ </p></li><li><p>NEVER  ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ </p></li><li><p>NOT_SUPPORTED  ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œæ“ä½œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚ </p></li><li><p>REQUIRES_NEW  æ–°å»ºäº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼ŒæŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚ </p></li><li><p>SUPPORTS  æ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œã€‚</p></li></ol><p><strong>7) NESTED</strong> ï¼ˆ<strong>å±€éƒ¨å›æ»š</strong>ï¼‰ æ”¯æŒå½“å‰äº‹åŠ¡ï¼Œæ–°å¢Savepointç‚¹ï¼Œä¸å½“å‰äº‹åŠ¡åŒæ­¥æäº¤æˆ–å›æ»šã€‚ <strong>åµŒå¥—äº‹åŠ¡ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µå°±æ˜¯å†…å±‚äº‹åŠ¡ä¾èµ–äºå¤–å±‚äº‹åŠ¡ã€‚å¤–å±‚äº‹åŠ¡å¤±è´¥æ—¶ï¼Œä¼šå›æ»šå†…å±‚äº‹åŠ¡æ‰€åšçš„åŠ¨ä½œã€‚è€Œå†…å±‚äº‹åŠ¡æ“ä½œå¤±è´¥å¹¶ä¸ä¼šå¼•èµ·å¤–å±‚äº‹åŠ¡çš„å›æ»šã€‚</strong></p><h3 id="Springæºç é˜…è¯»"><a href="#Springæºç é˜…è¯»" class="headerlink" title="Springæºç é˜…è¯»"></a>Springæºç é˜…è¯»</h3><h4 id="1ã€Springä¸­çš„è®¾è®¡æ¨¡å¼"><a href="#1ã€Springä¸­çš„è®¾è®¡æ¨¡å¼" class="headerlink" title="1ã€Springä¸­çš„è®¾è®¡æ¨¡å¼"></a><strong>1ã€Springä¸­çš„è®¾è®¡æ¨¡å¼</strong></h4><p>å‚è€ƒï¼š<a href="https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&mid=2247485303&idx=1&sn=9e4626a1e3f001f9b0d84a6fa0cff04a&chksm=cea248bcf9d5c1aaf48b67cc52bac74eb29d6037848d6cf213b0e5466f2d1fda970db700ba41&token=255050878&lang=zh_CN%23rd">springä¸­çš„è®¾è®¡æ¨¡å¼</a></p><p><strong>å•ä¾‹è®¾è®¡æ¨¡å¼ :</strong> Spring ä¸­çš„ Bean é»˜è®¤éƒ½æ˜¯å•ä¾‹çš„ã€‚</p><p><strong>â¼¯â¼šè®¾è®¡æ¨¡å¼ :</strong> Springä½¿â½¤â¼¯â¼šæ¨¡å¼é€šè¿‡  BeanFactory ã€ ApplicationContext åˆ›å»ºbean å¯¹è±¡ã€‚</p><p><strong>ä»£ç†è®¾è®¡æ¨¡å¼ :</strong> Spring AOP åŠŸèƒ½çš„å®ç°ã€‚</p><p><strong>è§‚å¯Ÿè€…æ¨¡å¼ï¼š</strong> Spring äº‹ä»¶é©±åŠ¨æ¨¡å‹å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼å¾ˆç»å…¸çš„â¼€ä¸ªåº”â½¤ã€‚</p><p><strong>é€‚é…å™¨æ¨¡å¼ï¼š</strong>Spring AOP çš„å¢å¼ºæˆ–é€šçŸ¥(Advice)ä½¿â½¤åˆ°äº†é€‚é…å™¨æ¨¡å¼ã€spring MVC ä¸­ä¹Ÿæ˜¯â½¤åˆ°äº†é€‚é…å™¨æ¨¡å¼é€‚é… Controller ã€‚</p><h1 id="å…«ã€SpringCloudç¯‡"><a href="#å…«ã€SpringCloudç¯‡" class="headerlink" title="å…«ã€SpringCloudç¯‡"></a>å…«ã€SpringCloudç¯‡</h1><h4 id="Why-SpringCloud"><a href="#Why-SpringCloud" class="headerlink" title="Why SpringCloud"></a>Why SpringCloud</h4><blockquote><p>â€‹Spring cloud æ˜¯ä¸€ç³»åˆ—æ¡†æ¶çš„æœ‰åºé›†åˆã€‚å®ƒåˆ©ç”¨ spring boot çš„å¼€å‘ä¾¿åˆ©æ€§å·§å¦™åœ°ç®€åŒ–äº†åˆ†å¸ƒå¼ç³»ç»ŸåŸºç¡€è®¾æ–½çš„å¼€å‘ï¼Œå¦‚<strong>æœåŠ¡å‘ç°æ³¨å†Œ</strong>ã€<strong>é…ç½®ä¸­å¿ƒ</strong>ã€<strong>æ¶ˆæ¯æ€»çº¿</strong>ã€<strong>è´Ÿè½½å‡è¡¡</strong>ã€<strong>æ–­è·¯å™¨</strong>ã€<strong>æ•°æ®ç›‘æ§</strong>ç­‰ï¼Œéƒ½å¯ä»¥ç”¨ spring boot çš„å¼€å‘é£æ ¼åšåˆ°ä¸€é”®å¯åŠ¨å’Œéƒ¨ç½²ã€‚</p></blockquote><table><thead><tr><th>SpringCloudï¼ˆå¾®æœåŠ¡è§£å†³æ–¹æ¡ˆï¼‰</th><th>Dubboï¼ˆåˆ†å¸ƒå¼æœåŠ¡æ²»ç†æ¡†æ¶ï¼‰</th></tr></thead><tbody><tr><td>Rest API ï¼ˆè½»é‡ã€çµæ´»ã€swaggerï¼‰</td><td>RPCè¿œç¨‹è°ƒç”¨ï¼ˆé«˜æ•ˆã€è€¦åˆï¼‰</td></tr><tr><td>Eurekaã€Nacos</td><td>Zookeeper</td></tr><tr><td>ä½¿ç”¨æ–¹ä¾¿</td><td>æ€§èƒ½å¥½</td></tr><tr><td>å³å°†æ¨å‡ºSpringCloud2.0</td><td>æ–­æ¡£5å¹´å17å¹´é‡å¯</td></tr></tbody></table><p>â€‹SpringBootæ˜¯Springæ¨å‡ºç”¨äºè§£å†³ä¼ ç»Ÿæ¡†æ¶é…ç½®æ–‡ä»¶å†—ä½™,è£…é…ç»„ä»¶ç¹æ‚çš„åŸºäºMavençš„è§£å†³æ–¹æ¡ˆ,<strong>æ—¨åœ¨å¿«é€Ÿæ­å»ºå•ä¸ªå¾®æœåŠ¡</strong>ï¼ŒSpringCloudæ˜¯ä¾èµ–äºSpringBootçš„,è€ŒSpringBootå¹¶ä¸æ˜¯ä¾èµ–ä¸SpringCloud,ç”šè‡³è¿˜å¯ä»¥å’ŒDubboè¿›è¡Œä¼˜ç§€çš„æ•´åˆå¼€å‘</p><p>â€‹MartinFlower æå‡ºçš„å¾®æœåŠ¡ä¹‹é—´æ˜¯é€šè¿‡RestFulApiè¿›è¡Œé€šä¿¡ï¼Œå…·ä½“å®ç°</p><ul><li>RestTemplateï¼šåŸºäºHTTPåè®®</li><li>Feignï¼šå°è£…äº†ribbonå’ŒHystrix ã€RestTemplate ç®€åŒ–äº†å®¢æˆ·ç«¯å¼€å‘å·¥ä½œé‡</li><li>RPCï¼šåŸºäºTCPåè®®ï¼Œåºåˆ—åŒ–å’Œä¼ è¾“æ•ˆç‡æå‡æ˜æ˜¾</li><li>MQï¼šå¼‚æ­¥è§£è€¦å¾®æœåŠ¡ä¹‹é—´çš„è°ƒç”¨</li></ul><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gmawejgpgwj30ht0bnt9d.jpg" alt="img" style="zoom:67%;" /><h4 id="Spring-Boot"><a href="#Spring-Boot" class="headerlink" title="Spring Boot"></a>Spring Boot</h4><blockquote><p>Spring Boot é€šè¿‡<strong>ç®€å•çš„æ­¥éª¤</strong>å°±å¯ä»¥åˆ›å»ºä¸€ä¸ª Spring åº”ç”¨ã€‚</p><p>Spring Boot ä¸º Spring æ•´åˆç¬¬ä¸‰æ–¹æ¡†æ¶æä¾›äº†<strong>å¼€ç®±å³ç”¨åŠŸèƒ½</strong>ã€‚</p><p>Spring Boot çš„æ ¸å¿ƒæ€æƒ³æ˜¯<strong>çº¦å®šå¤§äºé…ç½®</strong>ã€‚</p></blockquote><p><strong>Spring Boot è§£å†³çš„é—®é¢˜</strong></p><ul><li><p>æ­å»ºåç«¯æ¡†æ¶æ—¶éœ€è¦æ‰‹åŠ¨æ·»åŠ  Maven é…ç½®ï¼Œæ¶‰åŠå¾ˆå¤š XML é…ç½®æ–‡ä»¶ï¼Œå¢åŠ äº†æ­å»ºéš¾åº¦å’Œæ—¶é—´æˆæœ¬ã€‚</p></li><li><p>å°†é¡¹ç›®ç¼–è¯‘æˆ war åŒ…ï¼Œéƒ¨ç½²åˆ° Tomcat ä¸­ï¼Œé¡¹ç›®éƒ¨ç½²ä¾èµ– Tomcatï¼Œè¿™æ ·éå¸¸ä¸æ–¹ä¾¿ã€‚</p></li><li><p>åº”ç”¨ç›‘æ§åšçš„æ¯”è¾ƒç®€å•ï¼Œé€šå¸¸éƒ½æ˜¯é€šè¿‡ä¸€ä¸ªæ²¡æœ‰ä»»ä½•é€»è¾‘çš„æ¥å£æ¥åˆ¤æ–­åº”ç”¨çš„å­˜æ´»çŠ¶æ€ã€‚</p></li></ul><p><strong>Spring Boot ä¼˜ç‚¹</strong></p><p><strong>è‡ªåŠ¨è£…é…ï¼š</strong>Spring Boot ä¼šæ ¹æ®æŸäº›è§„åˆ™å¯¹æ‰€æœ‰é…ç½®çš„ Bean è¿›è¡Œåˆå§‹åŒ–ã€‚å¯ä»¥å‡å°‘äº†å¾ˆå¤šé‡å¤æ€§çš„å·¥ä½œã€‚</p><p>â€‹æ¯”å¦‚ä½¿ç”¨ MongoDB æ—¶ï¼Œåªéœ€åŠ å…¥ MongoDB çš„ Starter åŒ…ï¼Œç„¶åé…ç½®  çš„è¿æ¥ä¿¡æ¯ï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ MongoTemplate è‡ªåŠ¨è£…é…æ¥æ“ä½œæ•°æ®åº“äº†ã€‚ç®€åŒ–äº† Maven Jar åŒ…çš„ä¾èµ–ï¼Œé™ä½äº†çƒ¦çé…ç½®çš„å‡ºé”™å‡ ç‡ã€‚</p><p><strong>å†…åµŒå®¹å™¨ï¼š</strong>Spring Boot åº”ç”¨ç¨‹åºå¯ä»¥ä¸ç”¨éƒ¨ç½²åˆ°å¤–éƒ¨å®¹å™¨ä¸­ï¼Œæ¯”å¦‚ Tomcatã€‚</p><p>â€‹åº”ç”¨ç¨‹åºå¯ä»¥ç›´æ¥é€šè¿‡ Maven å‘½ä»¤ç¼–è¯‘æˆå¯æ‰§è¡Œçš„ jar åŒ…ï¼Œé€šè¿‡ java-jar å‘½ä»¤å¯åŠ¨å³å¯ï¼Œéå¸¸æ–¹ä¾¿ã€‚</p><p><strong>åº”ç”¨ç›‘æ§ï¼š</strong>Spring Boot ä¸­è‡ªå¸¦ç›‘æ§åŠŸèƒ½ Actuatorï¼Œå¯ä»¥å®ç°å¯¹ç¨‹åºå†…éƒ¨è¿è¡Œæƒ…å†µè¿›è¡Œç›‘æ§ï¼Œ</p><p>â€‹æ¯”å¦‚ Bean åŠ è½½æƒ…å†µã€ç¯å¢ƒå˜é‡ã€æ—¥å¿—ä¿¡æ¯ã€çº¿ç¨‹ä¿¡æ¯ç­‰ã€‚å½“ç„¶ä¹Ÿå¯ä»¥è‡ªå®šä¹‰è·Ÿä¸šåŠ¡ç›¸å…³çš„ç›‘æ§ï¼Œé€šè¿‡Actuator çš„ç«¯ç‚¹ä¿¡æ¯è¿›è¡Œæš´éœ²ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring-boot-starter-web          <span class="comment">//ç”¨äºå¿«é€Ÿæ„å»ºåŸºäº Spring MVC çš„ Web é¡¹ç›®ã€‚</span></span><br><span class="line">spring-boot-starter-data-redis   <span class="comment">//ç”¨äºå¿«é€Ÿæ•´åˆå¹¶æ“ä½œ Redisã€‚</span></span><br><span class="line">spring-boot-starter-data-mongodb <span class="comment">//ç”¨äºå¯¹ MongoDB çš„é›†æˆã€‚</span></span><br><span class="line">spring-boot-starter-data-jpa     <span class="comment">//ç”¨äºæ“ä½œ MySQLã€‚</span></span><br></pre></td></tr></table></figure><p><strong>è‡ªå®šä¹‰ä¸€ä¸ªStarter</strong></p><ol><li><p>åˆ›å»º Starter é¡¹ç›®ï¼Œå®šä¹‰ Starter éœ€è¦çš„é…ç½®ï¼ˆPropertiesï¼‰ç±»ï¼Œæ¯”å¦‚æ•°æ®åº“çš„è¿æ¥ä¿¡æ¯ï¼›</p></li><li><p>ç¼–å†™è‡ªåŠ¨é…ç½®ç±»ï¼Œè‡ªåŠ¨é…ç½®ç±»å°±æ˜¯è·å–é…ç½®ï¼Œæ ¹æ®é…ç½®æ¥è‡ªåŠ¨è£…é… Beanï¼›</p></li><li><p>ç¼–å†™ spring.factories æ–‡ä»¶åŠ è½½è‡ªåŠ¨é…ç½®ç±»ï¼ŒSpring å¯åŠ¨çš„æ—¶å€™ä¼šæ‰«æ spring.factories æ–‡ä»¶ï¼Œï¼›</p></li><li><p>ç¼–å†™é…ç½®æç¤ºæ–‡ä»¶ spring-configuration-metadata.jsonï¼ˆä¸æ˜¯å¿…é¡»çš„ï¼‰ï¼Œåœ¨æ·»åŠ é…ç½®çš„æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³è¦çŸ¥é“å…·ä½“çš„é…ç½®é¡¹æ˜¯ä»€ä¹ˆä½œç”¨ï¼Œå¯ä»¥é€šè¿‡ç¼–å†™æç¤ºæ–‡ä»¶æ¥æç¤ºï¼›</p></li><li><p>åœ¨é¡¹ç›®ä¸­å¼•å…¥è‡ªå®šä¹‰ Starter çš„ Maven ä¾èµ–ï¼Œå¢åŠ é…ç½®å€¼åå³å¯ä½¿ç”¨ã€‚</p></li></ol><p><strong>Spring Boot Admin</strong>ï¼ˆå°† actuator æä¾›çš„æ•°æ®è¿›è¡Œå¯è§†åŒ–ï¼‰</p><ul><li><p>æ˜¾ç¤ºåº”ç”¨ç¨‹åºçš„ç›‘æ§çŠ¶æ€ã€æŸ¥çœ‹ JVM å’Œçº¿ç¨‹ä¿¡æ¯</p></li><li><p>åº”ç”¨ç¨‹åºä¸Šä¸‹çº¿ç›‘æ§  </p></li><li><p>å¯è§†åŒ–çš„æŸ¥çœ‹æ—¥å¿—ã€åŠ¨æ€åˆ‡æ¢æ—¥å¿—çº§åˆ«</p></li><li><p>HTTP è¯·æ±‚ä¿¡æ¯è·Ÿè¸ªç­‰å®ç”¨åŠŸèƒ½</p></li></ul><h4 id="GateWay-Zuul"><a href="#GateWay-Zuul" class="headerlink" title="GateWay &#x2F; Zuul"></a>GateWay &#x2F; Zuul</h4><blockquote><p>GateWayâ½¬æ ‡æ˜¯å–ä»£Netflflix Zuulï¼Œå®ƒåŸºäºSpring5.0+SpringBoot2.0+WebFluxç­‰æŠ€æœ¯å¼€å‘ï¼Œæä¾›<strong>ç»Ÿâ¼€çš„è·¯ç”±</strong>â½…å¼ï¼ˆåå‘ä»£ç†ï¼‰å¹¶ä¸”åŸºäº <strong>Filter</strong>(å®šä¹‰è¿‡æ»¤å™¨å¯¹è¯·æ±‚è¿‡æ»¤ï¼Œå®Œæˆâ¼€äº›åŠŸèƒ½) é“¾çš„â½…å¼æä¾›äº†â½¹å…³åŸºæœ¬çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šé‰´æƒã€æµé‡æ§åˆ¶ã€ç†”æ–­ã€è·¯å¾„é‡å†™ã€â½‡å¿—ç›‘æ§ã€‚</p></blockquote><p><strong>ç»„æˆï¼š</strong></p><ul><li><p><strong>è·¯ç”±routeï¼š</strong> â½¹å…³æœ€åŸºç¡€çš„â¼¯ä½œå•å…ƒã€‚è·¯ç”±ç”±â¼€ä¸ªIDã€â¼€ä¸ªâ½¬æ ‡URLã€â¼€ç³»åˆ—çš„æ–­â¾”ï¼ˆåŒ¹é…æ¡ä»¶åˆ¤æ–­ï¼‰å’ŒFilterè¿‡æ»¤å™¨ç»„æˆã€‚å¦‚æœæ–­â¾”ä¸ºtrueï¼Œåˆ™åŒ¹é…è¯¥è·¯ç”±ã€‚</p></li><li><p><strong>æ–­â¾”predicatesï¼š</strong>å‚è€ƒäº†Java8ä¸­çš„æ–­â¾”Predicateï¼ŒåŒ¹é…Httpè¯·æ±‚ä¸­çš„æ‰€æœ‰å†…å®¹ï¼ˆç±»ä¼¼äºnginxä¸­çš„locationåŒ¹é…â¼€æ ·ï¼‰ï¼Œå¦‚æœæ–­â¾”ä¸è¯·æ±‚ç›¸åŒ¹é…åˆ™è·¯ç”±ã€‚</p></li><li><p><strong>è¿‡æ»¤å™¨filterï¼š</strong>æ ‡å‡†çš„Spring webFilterï¼Œä½¿â½¤è¿‡æ»¤å™¨åœ¨è¯·æ±‚ä¹‹å‰æˆ–è€…ä¹‹åæ‰§â¾ä¸šåŠ¡é€»è¾‘ã€‚</p><p>è¯·æ±‚å‰<code>pre</code>ç±»å‹è¿‡æ»¤å™¨ï¼šåš<strong>å‚æ•°æ ¡éªŒ</strong>ã€<strong>æƒé™æ ¡éªŒ</strong>ã€<strong>æµé‡ç›‘æ§</strong>ã€<strong>â½‡å¿—è¾“å‡º</strong>ã€<strong>åè®®è½¬æ¢</strong>ç­‰ï¼Œ</p><p>è¯·æ±‚å‰<code>post</code>ç±»å‹çš„è¿‡æ»¤å™¨ï¼šåš<strong>å“åº”å†…å®¹</strong>ã€<strong>å“åº”å¤´</strong>çš„ä¿®æ”¹ã€<strong>â½‡å¿—çš„è¾“å‡º</strong>ã€<strong>æµé‡ç›‘æ§</strong>ç­‰ã€‚</p></li></ul><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gmc49l9babj31do0n7n13.jpg" alt="image-20210105001419761" style="zoom: 50%;" /><p><strong>GateWayFilter</strong> åº”â½¤åˆ°å•ä¸ªè·¯ç”±è·¯ç”±ä¸Š ã€<strong>GlobalFilter</strong> åº”â½¤åˆ°æ‰€æœ‰çš„è·¯ç”±ä¸Š</p><h4 id="Eureka-Zookeeper"><a href="#Eureka-Zookeeper" class="headerlink" title="Eureka &#x2F; Zookeeper"></a>Eureka &#x2F; Zookeeper</h4><blockquote><p>æœåŠ¡æ³¨å†Œä¸­â¼¼æœ¬è´¨ä¸Šæ˜¯ä¸ºäº†è§£è€¦æœåŠ¡æä¾›è€…å’ŒæœåŠ¡æ¶ˆè´¹è€…ï¼Œä¸ºäº†â½€æŒå¼¹æ€§æ‰©ç¼©å®¹ç‰¹æ€§ï¼Œâ¼€ä¸ªå¾®æœåŠ¡çš„æä¾›è€…çš„æ•°é‡å’Œåˆ†å¸ƒå¾€å¾€æ˜¯åŠ¨æ€å˜åŒ–çš„ã€‚</p></blockquote><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gmawwm3k7bj30o80ecq3u.jpg" alt="image-20210103231405882" style="zoom: 50%;" /><table><thead><tr><th>åŒºåˆ«</th><th>Zookeeper</th><th>Eureka</th><th>Nacos</th></tr></thead><tbody><tr><td>CAP</td><td>CP</td><td>AP</td><td>CP&#x2F;APåˆ‡æ¢</td></tr><tr><td>å¯ç”¨æ€§</td><td>é€‰ä¸¾æœŸé—´ä¸å¯ç”¨</td><td>è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Œæ•°æ®ä¸æ˜¯æœ€æ–°çš„</td><td></td></tr><tr><td>ç»„æˆ</td><td>Leaderå’ŒFollower</td><td>èŠ‚ç‚¹å¹³ç­‰</td><td></td></tr><tr><td>ä¼˜åŠ¿</td><td>åˆ†å¸ƒå¼åè°ƒ</td><td>æ³¨å†Œä¸å‘ç°</td><td>æ³¨å†Œä¸­å¿ƒå’Œé…ç½®ä¸­å¿ƒ</td></tr><tr><td>åº•å±‚</td><td>è¿›ç¨‹</td><td>æœåŠ¡</td><td>JaråŒ…</td></tr></tbody></table><p><strong>Eureka</strong>é€šè¿‡<strong>â¼¼è·³æ£€æµ‹</strong>ã€<strong>å¥åº·æ£€æŸ¥</strong>å’Œ<strong>å®¢æˆ·ç«¯ç¼“å­˜</strong>ç­‰æœºåˆ¶ï¼Œæâ¾¼ç³»ç»Ÿçš„çµæ´»æ€§ã€å¯ä¼¸ç¼©æ€§å’Œå¯â½¤æ€§ã€‚</p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gmaxc493qyj30ji0a6mxx.jpg" alt="image-20210103232900353" style="zoom:67%;" /><ol><li>us-east-1cã€us-east-1dï¼Œus-east-1eä»£è¡¨ä¸åŒçš„æœºæˆ¿ï¼Œ<strong>æ¯â¼€ä¸ªEureka Serveréƒ½æ˜¯â¼€ä¸ªé›†ç¾¤</strong>ã€‚</li><li>Serviceä½œä¸ºæœåŠ¡æä¾›è€…å‘Eurekaä¸­æ³¨å†ŒæœåŠ¡ï¼ŒEurekaæ¥å—åˆ°æ³¨å†Œäº‹ä»¶ä¼šåœ¨<strong>é›†ç¾¤å’Œåˆ†åŒºä¸­è¿›â¾æ•°æ®åŒæ­¥</strong>ï¼ŒClientä½œä¸ºæ¶ˆè´¹ç«¯ï¼ˆæœåŠ¡æ¶ˆè´¹è€…ï¼‰å¯ä»¥ä»Eurekaä¸­è·å–åˆ°æœåŠ¡æ³¨å†Œä¿¡æ¯ï¼Œè¿›â¾æœåŠ¡è°ƒâ½¤ã€‚</li><li>å¾®æœåŠ¡å¯åŠ¨åï¼Œä¼šå‘¨æœŸæ€§åœ°å‘Eureka<strong>å‘é€â¼¼è·³</strong>ï¼ˆé»˜è®¤å‘¨æœŸä¸º30ç§’ï¼‰ä»¥ç»­çº¦â¾ƒâ¼°çš„ä¿¡æ¯</li><li>Eurekaåœ¨â¼€å®šæ—¶é—´å†…<strong>ï¼ˆé»˜è®¤90ç§’ï¼‰æ²¡æœ‰æ¥æ”¶</strong>åˆ°æŸä¸ªå¾®æœåŠ¡èŠ‚ç‚¹çš„â¼¼è·³ï¼ŒEurekaå°†ä¼šæ³¨é”€è¯¥å¾®æœåŠ¡èŠ‚ç‚¹</li><li>Eureka Client<strong>ä¼šç¼“å­˜Eureka Serverä¸­çš„ä¿¡æ¯</strong>ã€‚å³ä½¿æ‰€æœ‰çš„Eureka ServerèŠ‚ç‚¹éƒ½å®•æ‰ï¼ŒæœåŠ¡æ¶ˆè´¹è€…ä¾ç„¶å¯ä»¥ä½¿â½¤ç¼“å­˜ä¸­çš„ä¿¡æ¯æ‰¾åˆ°æœåŠ¡æä¾›è€…</li></ol><p><strong>Eurekaç¼“å­˜</strong></p><blockquote><p>æ–°æœåŠ¡ä¸Šçº¿åï¼ŒæœåŠ¡æ¶ˆè´¹è€…<strong>ä¸èƒ½ç«‹å³è®¿é—®</strong>åˆ°åˆšä¸Šçº¿çš„æ–°æœåŠ¡ï¼Œéœ€è¦è¿‡â¼€æ®µæ—¶é—´åæ‰èƒ½è®¿é—®ï¼Ÿæˆ–æ˜¯å°†æœåŠ¡ä¸‹çº¿åï¼ŒæœåŠ¡è¿˜æ˜¯ä¼šè¢«è°ƒâ½¤åˆ°ï¼Œâ¼€æ®µæ—¶å€™å<strong>æ‰å½»åº•åœâ½ŒæœåŠ¡</strong>ï¼Œè®¿é—®å‰æœŸä¼šå¯¼è‡´é¢‘ç¹æŠ¥é”™ï¼</p></blockquote><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gmaxmk97q0j30vw0j6gmu.jpg" alt="image-20210103233902439" style="zoom:50%;" /><p>â€‹æœåŠ¡æ³¨å†Œåˆ°æ³¨å†Œä¸­â¼¼åï¼ŒæœåŠ¡å®ä¾‹ä¿¡æ¯æ˜¯<strong>å­˜å‚¨åœ¨Registryè¡¨</strong>ä¸­çš„ï¼Œä¹Ÿå°±æ˜¯å†…å­˜ä¸­ã€‚ä½†Eurekaä¸ºäº†æâ¾¼å“åº”é€Ÿåº¦ï¼Œåœ¨å†…éƒ¨åšäº†ä¼˜åŒ–ï¼ŒåŠ â¼Šäº†ä¸¤å±‚çš„ç¼“å­˜ç»“æ„ï¼Œå°†Clientéœ€è¦çš„å®ä¾‹ä¿¡æ¯ï¼Œç›´æ¥ç¼“å­˜èµ·æ¥ï¼Œè·å–çš„æ—¶å€™ç›´æ¥ä»ç¼“å­˜ä¸­æ‹¿æ•°æ®ç„¶åå“åº”ç»™ Clientã€‚ </p><ul><li><p>ç¬¬â¼€å±‚ç¼“å­˜æ˜¯<strong>readOnlyCacheMap</strong>ï¼Œé‡‡â½¤<strong>ConcurrentHashMap</strong>æ¥å­˜å‚¨æ•°æ®çš„ï¼Œä¸»è¦è´Ÿè´£å®šæ—¶ä¸readWriteCacheMapè¿›â¾æ•°æ®åŒæ­¥ï¼Œé»˜è®¤åŒæ­¥æ—¶é—´ä¸º <strong>30</strong> ç§’â¼€æ¬¡ã€‚</p></li><li><p>ç¬¬â¼†å±‚ç¼“å­˜æ˜¯<strong>readWriteCacheMap</strong>ï¼Œé‡‡â½¤<strong>Guava</strong>æ¥å®ç°ç¼“å­˜ã€‚ç¼“å­˜è¿‡æœŸæ—¶é—´é»˜è®¤ä¸º<strong>180</strong>ç§’ï¼Œå½“æœåŠ¡<strong>ä¸‹çº¿ã€è¿‡æœŸã€æ³¨å†Œã€çŠ¶æ€å˜æ›´</strong>ç­‰æ“ä½œéƒ½ä¼šæ¸…é™¤æ­¤ç¼“å­˜ä¸­çš„æ•°æ®ã€‚</p></li><li><p>å¦‚æœä¸¤çº§ç¼“å­˜éƒ½æ— æ³•æŸ¥è¯¢ï¼Œä¼š<strong>è§¦å‘ç¼“å­˜çš„åŠ è½½</strong>ï¼Œä»å­˜å‚¨å±‚æ‹‰å–æ•°æ®åˆ°ç¼“å­˜ä¸­ï¼Œç„¶åå†è¿”å›ç»™ Clientã€‚</p><p>Eurekaä¹‹æ‰€ä»¥è®¾è®¡â¼†çº§ç¼“å­˜æœºåˆ¶ï¼Œä¹Ÿæ˜¯ä¸ºäº†<strong>æâ¾¼ Eureka Server çš„å“åº”é€Ÿåº¦</strong>ï¼Œç¼ºç‚¹æ˜¯ç¼“å­˜ä¼šå¯¼è‡´ Client<strong>è·å–ä¸åˆ°æœ€æ–°çš„æœåŠ¡å®ä¾‹ä¿¡æ¯</strong>ï¼Œç„¶åå¯¼è‡´â½†æ³•å¿«é€Ÿå‘ç°æ–°çš„æœåŠ¡å’Œå·²ä¸‹çº¿çš„æœåŠ¡ã€‚</p></li></ul><p><strong>è§£å†³æ–¹æ¡ˆ</strong></p><ul><li>æˆ‘ä»¬å¯ä»¥<strong>ç¼©çŸ­è¯»ç¼“å­˜çš„æ›´æ–°æ—¶é—´</strong>è®©æœåŠ¡å‘ç°å˜å¾—æ›´åŠ åŠæ—¶ï¼Œæˆ–è€…<strong>ç›´æ¥å°†åªè¯»ç¼“å­˜å…³é—­</strong>ï¼ŒåŒæ—¶å¯ä»¥ç¼©çŸ­å®¢æˆ·ç«¯å¦‚ribbonæœåŠ¡çš„å®šæ—¶åˆ·æ–°é—´éš”ï¼Œå¤šçº§ç¼“å­˜ä¹Ÿå¯¼è‡´Cå±‚â¾¯ï¼ˆæ•°æ®â¼€è‡´æ€§ï¼‰å¾ˆè–„å¼±ã€‚</li><li>Eureka Server ä¸­ä¼šæœ‰<strong>å®šæ—¶ä»»åŠ¡å»æ£€æµ‹å¤±æ•ˆ</strong>çš„æœåŠ¡ï¼Œå°†æœåŠ¡å®ä¾‹ä¿¡æ¯ä»æ³¨å†Œè¡¨ä¸­ç§»é™¤ï¼Œä¹Ÿå¯ä»¥å°†è¿™ä¸ªå¤±æ•ˆæ£€æµ‹çš„<strong>æ—¶é—´ç¼©çŸ­</strong>ï¼Œè¿™æ ·æœåŠ¡ä¸‹çº¿åå°±èƒ½å¤ŸåŠæ—¶ä»æ³¨å†Œè¡¨ä¸­æ¸…é™¤ã€‚</li></ul><p><strong>è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶å¼€å¯æ¡ä»¶</strong></p><ul><li>æœŸæœ›æœ€å°æ¯åˆ†é’Ÿèƒ½å¤Ÿç»­ç§Ÿçš„æ¬¡æ•°ï¼ˆå®ä¾‹* é¢‘ç‡ * æ¯”ä¾‹&#x3D;&#x3D;10* 2 *0.85ï¼‰</li><li>æœŸæœ›çš„æœåŠ¡å®ä¾‹æ•°é‡ï¼ˆ10ï¼‰</li></ul><p><strong>å¥åº·æ£€æŸ¥</strong></p><ul><li><p>Eureka Client ä¼šå®šæ—¶å‘é€å¿ƒè·³ç»™ Eureka Server æ¥è¯æ˜è‡ªå·±å¤„äºå¥åº·çš„çŠ¶æ€</p></li><li><p>é›†æˆSBAä»¥åå¯ä»¥æŠŠæ‰€æœ‰å¥åº·çŠ¶æ€ä¿¡æ¯ä¸€å¹¶è¿”å›ç»™eureka</p></li></ul><h4 id="Feign-Ribbon"><a href="#Feign-Ribbon" class="headerlink" title="Feign &#x2F; Ribbon"></a>Feign &#x2F; Ribbon</h4><ul><li>Feign å¯ä»¥ä¸ Eureka å’Œ Ribbon ç»„åˆä½¿ç”¨ä»¥æ”¯æŒè´Ÿè½½å‡è¡¡ï¼Œ</li><li>Feign å¯ä»¥ä¸ Hystrix ç»„åˆä½¿ç”¨ï¼Œæ”¯æŒç†”æ–­å›é€€</li><li>Feign å¯ä»¥ä¸ProtoBufå®ç°å¿«é€Ÿçš„RPCè°ƒç”¨</li></ul><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gmbxsh2rfnj30uo0fgmxz.jpg" alt="img" style="zoom:80%;" /><ul><li><p><strong>InvocationHandlerFactory ä»£ç†</strong></p><p>é‡‡ç”¨ JDK çš„åŠ¨æ€ä»£ç†æ–¹å¼ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œå½“æˆ‘ä»¬è°ƒç”¨è¿™ä¸ªæ¥å£ï¼Œå®é™…ä¸Šæ˜¯è¦å»è°ƒç”¨è¿œç¨‹çš„ HTTP API</p></li><li><p><strong>Contract å¥‘çº¦ç»„ä»¶</strong></p><p>æ¯”å¦‚è¯·æ±‚ç±»å‹æ˜¯ GET è¿˜æ˜¯ POSTï¼Œè¯·æ±‚çš„ URI æ˜¯ä»€ä¹ˆ</p></li><li><p><strong>Encoder ç¼–ç ç»„ä»¶ \ Decoder è§£ç ç»„ä»¶</strong></p><p>é€šè¿‡è¯¥ç»„ä»¶æˆ‘ä»¬å¯ä»¥å°†è¯·æ±‚ä¿¡æ¯é‡‡ç”¨æŒ‡å®šçš„ç¼–ç æ–¹å¼è¿›è¡Œç¼–è§£ç åä¼ è¾“</p></li><li><p><strong>Logger æ—¥å¿—è®°å½•</strong></p><p>è´Ÿè´£ Feign ä¸­è®°å½•æ—¥å¿—çš„ï¼Œå¯ä»¥æŒ‡å®š Logger çš„çº§åˆ«ä»¥åŠè‡ªå®šä¹‰æ—¥å¿—çš„è¾“å‡º</p></li><li><p><strong>Client è¯·æ±‚æ‰§è¡Œç»„ä»¶</strong></p><p>è´Ÿè´£ HTTP è¯·æ±‚æ‰§è¡Œçš„ç»„ä»¶ï¼ŒFeign ä¸­é»˜è®¤çš„ Client æ˜¯é€šè¿‡ JDK çš„ HttpURLConnection æ¥å‘èµ·è¯·æ±‚çš„ï¼Œåœ¨æ¯æ¬¡å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œéƒ½ä¼šåˆ›å»ºæ–°çš„ HttpURLConnection é“¾æ¥ï¼ŒFeign çš„æ€§èƒ½ä¼šå¾ˆå·®ï¼Œå¯ä»¥é€šè¿‡æ‰©å±•è¯¥æ¥å£ï¼Œä½¿ç”¨ Apache HttpClient ç­‰åŸºäºè¿æ¥æ± çš„é«˜æ€§èƒ½ HTTP å®¢æˆ·ç«¯ã€‚</p></li><li><p><strong>Retryer é‡è¯•ç»„ä»¶</strong></p><p>è´Ÿè´£é‡è¯•çš„ç»„ä»¶ï¼ŒFeign å†…ç½®äº†é‡è¯•å™¨ï¼Œå½“ HTTP è¯·æ±‚å‡ºç° IO å¼‚å¸¸æ—¶ï¼ŒFeign ä¼šé™å®šä¸€ä¸ªæœ€å¤§é‡è¯•æ¬¡æ•°æ¥è¿›è¡Œé‡è¯•æ“ä½œã€‚</p></li><li><p><strong>RequestInterceptor è¯·æ±‚æ‹¦æˆªå™¨</strong></p><p>å¯ä»¥ä¸º Feign æ·»åŠ å¤šä¸ªæ‹¦æˆªå™¨ï¼Œåœ¨è¯·æ±‚æ‰§è¡Œå‰è®¾ç½®ä¸€äº›æ‰©å±•çš„å‚æ•°ä¿¡æ¯ã€‚</p></li></ul><p><strong>Feignæœ€ä½³ä½¿ç”¨æŠ€å·§</strong></p><ul><li><p>ç»§æ‰¿ç‰¹æ€§</p></li><li><p>æ‹¦æˆªå™¨</p><p>æ¯”å¦‚æ·»åŠ æŒ‡å®šçš„è¯·æ±‚å¤´ä¿¡æ¯ï¼Œè¿™ä¸ªå¯ä»¥ç”¨åœ¨æœåŠ¡é—´ä¼ é€’æŸäº›ä¿¡æ¯çš„æ—¶å€™ã€‚</p></li><li><p>GET è¯·æ±‚å¤šå‚æ•°ä¼ é€’</p></li><li><p>æ—¥å¿—é…ç½®</p><p>FULL ä¼šè¾“å‡ºå…¨éƒ¨å®Œæ•´çš„è¯·æ±‚ä¿¡æ¯ã€‚</p></li><li><p>å¼‚å¸¸è§£ç å™¨</p><p>å¼‚å¸¸è§£ç å™¨ä¸­å¯ä»¥è·å–å¼‚å¸¸ä¿¡æ¯ï¼Œè€Œä¸æ˜¯ç®€å•çš„ä¸€ä¸ªcodeï¼Œç„¶åè½¬æ¢æˆå¯¹åº”çš„å¼‚å¸¸å¯¹è±¡è¿”å›ã€‚</p></li><li><p>æºç æŸ¥çœ‹æ˜¯å¦‚ä½•ç»§æ‰¿Hystrix</p><p>HystrixFeign.builder ä¸­å¯ä»¥çœ‹åˆ°ç»§æ‰¿äº† Feign çš„ Builderï¼Œå¢åŠ äº† Hystrixçš„SetterFactoryï¼Œ build æ–¹æ³•é‡Œï¼Œå¯¹ invocationHandlerFactory è¿›è¡Œäº†é‡å†™ï¼Œ create çš„æ—¶å€™<strong>è¿”å›HystrixInvocationHandler</strong>ï¼Œ åœ¨ invoke çš„æ—¶å€™<strong>ä¼šå°†è¯·æ±‚åŒ…è£…æˆ HystrixCommand</strong> å»æ‰§è¡Œï¼Œè¿™é‡Œå°±è‡ªç„¶çš„é›†æˆäº† Hystrix</p></li></ul><p><strong>Ribbon</strong></p><img src="http://s0.lgstatic.com/i/image2/M01/93/96/CgotOV2Nux-AO2PcAAEcl4M1Zi4629.png" alt="img" style="zoom: 50%;" /><p><strong>ä½¿ç”¨æ–¹å¼</strong></p><ul><li><p><strong>åŸç”Ÿ API</strong>ï¼ŒRibbon æ˜¯ Netflix å¼€æºçš„ï¼Œæ²¡æœ‰ä½¿ç”¨ Spring Cloudï¼Œéœ€è¦ä½¿ç”¨ Ribbon çš„åŸç”Ÿ APIã€‚</p></li><li><p><strong>Ribbon + RestTemplate</strong>ï¼Œæ•´åˆSpring Cloud åï¼Œå¯ä»¥åŸºäº RestTemplate æä¾›è´Ÿè½½å‡è¡¡çš„æœåŠ¡</p></li><li><p><strong>Ribbon + Feign</strong></p><img src="http://s0.lgstatic.com/i/image2/M01/93/76/CgoB5l2NuyCALoefAAAdV1DlSHY088.png" alt="img" style="zoom: 67%;" /></li></ul><p><strong>è´Ÿè½½å‡è¡¡ç®—æ³•</strong></p><ul><li><p>RoundRobinRule æ˜¯<strong>è½®è¯¢çš„ç®—æ³•</strong>ï¼ŒAå’ŒBè½®æµé€‰æ‹©ã€‚</p></li><li><p>RandomRule æ˜¯<strong>éšæœºç®—æ³•</strong>ï¼Œè¿™ä¸ªå°±æ¯”è¾ƒç®€å•äº†ï¼Œåœ¨æœåŠ¡åˆ—è¡¨ä¸­éšæœºé€‰å–ã€‚</p></li><li><p>BestAvailableRule é€‰æ‹©ä¸€ä¸ªæœ€<strong>å°çš„å¹¶å‘è¯·æ±‚ server</strong></p></li></ul><p><strong>è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç®—æ³•</strong></p><ul><li>å®ç° Irule æ¥å£</li><li>ç»§æ‰¿ AbstractLoadBalancerRule ç±»</li></ul><p><strong>è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ä½¿ç”¨åœºæ™¯</strong>ï¼ˆæ ¸å¿ƒï¼‰</p><ul><li><p><strong>ç°åº¦å‘å¸ƒ</strong></p><p>ç°åº¦å‘å¸ƒæ˜¯èƒ½å¤Ÿå¹³æ»‘è¿‡æ¸¡çš„ä¸€ç§å‘å¸ƒæ–¹å¼ï¼Œåœ¨å‘å¸ƒè¿‡ç¨‹ä¸­ï¼Œå…ˆå‘å¸ƒä¸€éƒ¨åˆ†åº”ç”¨ï¼Œè®©æŒ‡å®šçš„ç”¨æˆ·ä½¿ç”¨åˆšå‘å¸ƒçš„åº”ç”¨ï¼Œç­‰åˆ°æµ‹è¯•æ²¡æœ‰é—®é¢˜åï¼Œå†å°†å…¶ä»–çš„å…¨éƒ¨åº”ç”¨å‘å¸ƒã€‚å¦‚æœæ–°å‘å¸ƒçš„æœ‰é—®é¢˜ï¼Œåªéœ€è¦å°†è¿™éƒ¨åˆ†æ¢å¤å³å¯ï¼Œä¸ç”¨æ¢å¤æ‰€æœ‰çš„åº”ç”¨ã€‚</p></li><li><p><strong>å¤šç‰ˆæœ¬éš”ç¦»</strong></p><p>å¤šç‰ˆæœ¬éš”ç¦»è·Ÿç°åº¦å‘å¸ƒç±»ä¼¼ï¼Œä¸ºäº†å…¼å®¹æˆ–è€…è¿‡åº¦ï¼ŒæŸäº›åº”ç”¨ä¼šæœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œè¿™ä¸ªæ—¶å€™å¦‚ä½•ä¿è¯ 1.0 ç‰ˆæœ¬çš„å®¢æˆ·ç«¯ä¸ä¼šè°ƒç”¨åˆ° 1.1 ç‰ˆæœ¬çš„æœåŠ¡ï¼Œå°±æ˜¯æˆ‘ä»¬éœ€è¦è€ƒè™‘çš„é—®é¢˜ã€‚</p></li><li><p><strong>æ•…éšœéš”ç¦»</strong></p><p>å½“çº¿ä¸ŠæŸä¸ªå®ä¾‹å‘ç”Ÿæ•…éšœåï¼Œä¸ºäº†ä¸å½±å“ç”¨æˆ·ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šå…ˆç•™å­˜è¯æ®ï¼Œæ¯”å¦‚ï¼šçº¿ç¨‹ä¿¡æ¯ã€JVM ä¿¡æ¯ç­‰ï¼Œç„¶åå°†è¿™ä¸ªå®ä¾‹é‡å¯æˆ–ç›´æ¥åœæ­¢ã€‚ç„¶åçº¿ä¸‹æ ¹æ®ä¸€äº›ä¿¡æ¯åˆ†ææ•…éšœåŸå› ï¼Œå¦‚æœæˆ‘èƒ½åšåˆ°æ•…éšœéš”ç¦»ï¼Œå°±å¯ä»¥ç›´æ¥å°†å‡ºé—®é¢˜çš„å®ä¾‹éš”ç¦»ï¼Œä¸è®©æ­£å¸¸çš„ç”¨æˆ·è¯·æ±‚è®¿é—®åˆ°è¿™ä¸ªå‡ºé—®é¢˜çš„å®ä¾‹ï¼Œåªè®©æŒ‡å®šçš„ç”¨æˆ·è®¿é—®ï¼Œè¿™æ ·å°±å¯ä»¥å•ç‹¬ç”¨ç‰¹å®šçš„ç”¨æˆ·æ¥å¯¹è¿™ä¸ªå‡ºé—®é¢˜çš„å®ä¾‹è¿›è¡Œæµ‹è¯•ã€æ•…éšœåˆ†æç­‰ã€‚</p></li></ul><h4 id="Hystrix-Sentinel"><a href="#Hystrix-Sentinel" class="headerlink" title="Hystrix &#x2F; Sentinel"></a>Hystrix &#x2F; Sentinel</h4><p><strong>æœåŠ¡é›ªå´©åœºæ™¯</strong></p><p>è‡ªå·±å³æ˜¯æœåŠ¡æ¶ˆè´¹è€…ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æœåŠ¡æä¾›è€…ï¼ŒåŒæ­¥è°ƒç”¨ç­‰å¾…ç»“æœå¯¼è‡´èµ„æºè€—å°½</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong></p><p>æœåŠ¡æ–¹ï¼šæ‰©å®¹ã€é™æµï¼Œæ’æŸ¥ä»£ç é—®é¢˜ï¼Œå¢åŠ ç¡¬ä»¶ç›‘æ§</p><p>æ¶ˆè´¹æ–¹ï¼šä½¿ç”¨Hystrixèµ„æºéš”ç¦»ï¼Œç†”æ–­é™çº§ï¼Œå¿«é€Ÿå¤±è´¥</p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gmby7y9ykzj30wr0ehac5.jpg" alt="img" style="zoom:150%;" /><p><strong>Hystrixæ–­è·¯ä¿æŠ¤å™¨çš„ä½œç”¨</strong></p><ul><li><strong>å°è£…è¯·æ±‚</strong>ä¼šå°†ç”¨æˆ·çš„æ“ä½œè¿›è¡Œç»Ÿä¸€å°è£…ï¼Œç»Ÿä¸€å°è£…çš„ç›®çš„åœ¨äºè¿›è¡Œç»Ÿä¸€æ§åˆ¶ã€‚</li><li><strong>èµ„æºéš”ç¦»é™æµ</strong>ä¼šå°†å¯¹åº”çš„èµ„æºæŒ‰ç…§æŒ‡å®šçš„ç±»å‹è¿›è¡Œéš”ç¦»ï¼Œæ¯”å¦‚<strong>çº¿ç¨‹æ± </strong>å’Œ<strong>ä¿¡å·é‡</strong>ã€‚<ul><li>è®¡æ•°å™¨é™æµï¼Œä¾‹å¦‚5ç§’å†…æŠ€æœ¯1000è¯·æ±‚ï¼Œè¶…æ•°åé™æµï¼Œæœªè¶…æ•°é‡æ–°è®¡æ•°</li><li>æ»‘åŠ¨çª—å£é™æµï¼Œè§£å†³è®¡æ•°å™¨ä¸å¤Ÿç²¾ç¡®çš„é—®é¢˜ï¼ŒæŠŠä¸€ä¸ªçª—å£æ‹†åˆ†å¤šæ»šåŠ¨çª—å£</li><li>ä»¤ç‰Œæ¡¶é™æµï¼Œç±»ä¼¼æ™¯åŒºå”®ç¥¨ï¼Œå”®ç¥¨çš„é€Ÿåº¦æ˜¯å›ºå®šçš„ï¼Œæ‹¿åˆ°ä»¤ç‰Œæ‰èƒ½å»å¤„ç†è¯·æ±‚</li><li>æ¼æ¡¶é™æµï¼Œç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼Œå®ç°äº†æ’å®šé€Ÿåº¦å¤„ç†è¯·æ±‚ï¼Œèƒ½å¤Ÿç»å¯¹é˜²æ­¢çªå‘æµé‡</li></ul></li><li><strong>å¤±è´¥å›é€€</strong>å…¶å®æ˜¯ä¸€ä¸ªå¤‡ç”¨çš„æ–¹æ¡ˆï¼Œå°±æ˜¯è¯´å½“è¯·æ±‚å¤±è´¥åï¼Œæœ‰æ²¡æœ‰å¤‡ç”¨æ–¹æ¡ˆæ¥æ»¡è¶³è¿™ä¸ªè¯·æ±‚çš„éœ€æ±‚ã€‚</li><li><strong>æ–­è·¯å™¨</strong>è¿™ä¸ªæ˜¯<strong>æœ€æ ¸å¿ƒ</strong>çš„ï¼Œï¼Œå¦‚æœæ–­è·¯å™¨å¤„äºæ‰“å¼€çš„çŠ¶æ€ï¼Œé‚£ä¹ˆæ‰€æœ‰è¯·æ±‚éƒ½å°†å¤±è´¥ï¼Œæ‰§è¡Œå›é€€é€»è¾‘ã€‚å¦‚æœæ–­è·¯å™¨å¤„äºå…³é—­çŠ¶æ€ï¼Œé‚£ä¹ˆè¯·æ±‚å°†ä¼šè¢«æ­£å¸¸æ‰§è¡Œã€‚æœ‰äº›åœºæ™¯æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨<strong>æ‰“å¼€æ–­è·¯å™¨å¼ºåˆ¶é™çº§</strong>ã€‚</li><li><strong>æŒ‡æ ‡ç›‘æ§</strong>ä¼šå¯¹è¯·æ±‚çš„ç”Ÿ<strong>å‘½å‘¨æœŸè¿›è¡Œç›‘æ§</strong>ï¼Œè¯·æ±‚æˆåŠŸã€å¤±è´¥ã€è¶…æ—¶ã€æ‹’ç»ç­‰çŠ¶æ€ï¼Œéƒ½ä¼šè¢«ç›‘æ§èµ·æ¥ã€‚</li></ul><p><strong>Hystrixä½¿ç”¨ä¸Šé‡åˆ°çš„å‘</strong></p><ul><li><p>é…ç½®å¯ä»¥å¯¹æ¥<strong>é…ç½®ä¸­å¿ƒ</strong>è¿›è¡ŒåŠ¨æ€è°ƒæ•´</p><p>Hystrix çš„é…ç½®é¡¹éå¸¸å¤šï¼Œå¦‚æœä¸å¯¹æ¥é…ç½®ä¸­å¿ƒï¼Œæ‰€æœ‰çš„é…ç½®åªèƒ½åœ¨ä»£ç é‡Œä¿®æ”¹ï¼Œåœ¨é›†ç¾¤éƒ¨ç½²çš„éš¾ä»¥åº”å¯¹ç´§æ€¥æƒ…å†µï¼Œæˆ‘ä»¬é¡¹ç›®åªè®¾ç½®ä¸€ä¸ª CommandKeyï¼Œå…¶ä»–çš„éƒ½åœ¨é…ç½®ä¸­å¿ƒè¿›è¡ŒæŒ‡å®šï¼Œç´§æ€¥æƒ…å†µå¦‚éœ€éš”ç¦»éƒ¨åˆ†è¯·æ±‚æ—¶ï¼Œåªéœ€åœ¨é…ç½®ä¸­å¿ƒè¿›è¡Œä¿®æ”¹ä»¥åï¼Œå¼ºåˆ¶æ›´æ–°å³å¯ã€‚</p></li><li><p>å›é€€é€»è¾‘ä¸­å¯ä»¥<strong>æ‰‹åŠ¨åŸ‹ç‚¹</strong>æˆ–è€…é€šè¿‡<strong>è¾“å‡ºæ—¥å¿—</strong>è¿›è¡Œå‘Šè­¦</p><p>å½“è¯·æ±‚å¤±è´¥æˆ–è€…è¶…æ—¶ï¼Œä¼šæ‰§è¡Œå›é€€é€»è¾‘ï¼Œå¦‚æœæœ‰å¤§é‡çš„å›é€€ï¼Œåˆ™è¯æ˜æŸäº›æœåŠ¡å‡ºé—®é¢˜äº†ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥åœ¨å›é€€çš„é€»è¾‘ä¸­è¿›è¡ŒåŸ‹ç‚¹æ“ä½œï¼Œä¸ŠæŠ¥æ•°æ®ç»™ç›‘æ§ç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥è¾“å‡ºå›é€€çš„æ—¥å¿—ï¼Œç»Ÿä¸€ç”±æ—¥å¿—æ”¶é›†çš„ç¨‹åºå»è¿›è¡Œå¤„ç†ï¼Œè¿™äº›æ–¹å¼éƒ½å¯ä»¥å°†é—®é¢˜æš´éœ²å‡ºå»ï¼Œç„¶åé€šè¿‡å®æ—¶æ•°æ®åˆ†æè¿›è¡Œå‘Šè­¦æ“ä½œ</p></li><li><p>ç”¨ <strong>ThreadLocal</strong>é…åˆ<strong>çº¿ç¨‹æ± éš”ç¦»</strong>æ¨¡å¼éœ€å½“å¿ƒ</p><p>å½“æˆ‘ä»¬ç”¨äº†çº¿ç¨‹æ± éš”ç¦»æ¨¡å¼çš„æ—¶å€™ï¼Œè¢«éš”ç¦»çš„æ–¹æ³•ä¼šåŒ…è£…æˆä¸€ä¸ª Command ä¸¢å…¥åˆ°ç‹¬ç«‹çš„çº¿ç¨‹æ± ä¸­è¿›è¡Œæ‰§è¡Œï¼Œè¿™ä¸ªæ—¶å€™å°±æ˜¯ä» A çº¿ç¨‹åˆ‡æ¢åˆ°äº† B çº¿ç¨‹ï¼ŒThreadLocal çš„æ•°æ®å°±ä¼šä¸¢å¤±</p></li><li><p><strong>Gatewayä¸­</strong>å¤šç”¨ä¿¡å·é‡éš”ç¦»</p><p>ç½‘å…³æ˜¯æ‰€æœ‰è¯·æ±‚çš„å…¥å£ï¼Œè·¯ç”±çš„æœåŠ¡æ•°é‡ä¼šå¾ˆå¤šï¼Œå‡ åä¸ªåˆ°ä¸Šç™¾ä¸ªéƒ½æœ‰å¯èƒ½ï¼Œå¦‚æœç”¨çº¿ç¨‹æ± éš”ç¦»ï¼Œé‚£ä¹ˆéœ€è¦åˆ›å»ºä¸Šç™¾ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ± ï¼Œå¼€é”€å¤ªå¤§ï¼Œç”¨ä¿¡å·é‡éš”ç¦»å¼€é”€å°±å°å¾ˆå¤šï¼Œè¿˜èƒ½èµ·åˆ°é™æµçš„ä½œç”¨ã€‚</p></li></ul><p>[^å¸¸è§é—®é¢˜]: Hystrixçš„è¶…æ—¶æ—¶é—´è¦â¼¤äºRibbonçš„è¶…æ—¶æ—¶é—´ï¼Œå› ä¸ºHystrixå°†è¯·æ±‚åŒ…è£…äº†èµ·æ¥ï¼Œç‰¹åˆ«éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœRibbonå¼€å¯äº†é‡è¯•æœºåˆ¶ï¼Œâ½å¦‚é‡è¯•3 æ¬¡ï¼ŒRibbon çš„è¶…æ—¶ä¸º 1 ç§’ï¼Œé‚£ä¹ˆHystrix çš„è¶…æ—¶æ—¶é—´åº”è¯¥â¼¤äº 3 ç§’ï¼Œå¦åˆ™å°±ä¼šå‡ºç° Ribbon è¿˜åœ¨é‡è¯•ä¸­ï¼Œâ½½ Hystrix å·²ç»è¶…æ—¶çš„ç°è±¡ã€‚</p><p><strong>Sentinel</strong> </p><blockquote><p>Sentinelæ˜¯â¼€ä¸ªâ¾¯å‘äº‘åŸâ½£å¾®æœåŠ¡çš„æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ç»„ä»¶ã€‚</p><p>æ›¿ä»£Hystrixï¼Œé’ˆå¯¹é—®é¢˜ï¼šæœåŠ¡é›ªå´©ã€æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™æµ</p></blockquote><p>HystrixåŒºåˆ«ï¼š</p><ul><li>ç‹¬â½´å¯éƒ¨ç½²Dashboardï¼ˆåŸºäº Spring Boot å¼€å‘ï¼‰æ§åˆ¶å°ç»„ä»¶</li><li>ä¸ä¾èµ–ä»»ä½•æ¡†æ¶&#x2F;åº“ï¼Œå‡å°‘ä»£ç å¼€å‘ï¼Œé€šè¿‡UIç•Œâ¾¯é…ç½®å³å¯å®Œæˆç»†ç²’åº¦æ§åˆ¶</li></ul><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gmbza4zixbj30kl09sq4p.jpg" alt="image-20210104212151598" style="zoom:80%;" /><p><strong>ä¸°å¯Œçš„åº”â½¤åœºæ™¯</strong>ï¼šSentinel æ‰¿æ¥äº†é˜¿â¾¥å·´å·´è¿‘ 10 å¹´çš„åŒâ¼—â¼€â¼¤ä¿ƒæµé‡çš„æ ¸â¼¼åœºæ™¯ï¼Œä¾‹å¦‚ç§’æ€ã€æ¶ˆæ¯å‰Šå³°å¡«â¾•ã€é›†ç¾¤æµé‡æ§åˆ¶ã€å®æ—¶ç†”æ–­ä¸‹æ¸¸ä¸å¯â½¤åº”â½¤ç­‰ã€‚</p><p><strong>å®Œå¤‡çš„å®æ—¶ç›‘æ§</strong>ï¼šå¯ä»¥çœ‹åˆ°500 å°ä»¥ä¸‹è§„æ¨¡çš„é›†ç¾¤çš„æ±‡æ€»ä¹Ÿå¯ä»¥çœ‹åˆ°å•æœºçš„ç§’çº§æ•°æ®ã€‚</p><p><strong>â¼´æ³›çš„å¼€æºâ½£æ€ï¼š</strong>ä¸ SpringCloudã€Dubboçš„æ•´åˆã€‚æ‚¨åªéœ€è¦å¼•â¼Šç›¸åº”çš„ä¾èµ–å¹¶è¿›â¾ç®€å•çš„é…ç½®å³å¯å¿«é€Ÿåœ°æ¥â¼Š Sentinelã€‚</p><p><strong>åŒºåˆ«ï¼š</strong></p><ul><li>Sentinelä¸ä¼šåƒHystrixé‚£æ ·æ”¾è¿‡â¼€ä¸ªè¯·æ±‚å°è¯•â¾ƒæˆ‘ä¿®å¤ï¼Œå°±æ˜¯æ˜æ˜ç¡®ç¡®æŒ‰ç…§æ—¶é—´çª—â¼æ¥ï¼Œç†”æ–­è§¦å‘åï¼Œæ—¶é—´çª—â¼å†…æ‹’ç»è¯·æ±‚ï¼Œæ—¶é—´çª—â¼åå°±æ¢å¤ã€‚</li><li>Sentinel Dashboardä¸­æ·»åŠ çš„è§„åˆ™æ•°æ®å­˜å‚¨åœ¨å†…å­˜ï¼Œå¾®æœåŠ¡åœæ‰è§„åˆ™æ•°æ®å°±æ¶ˆå¤±ï¼Œåœ¨â½£äº§ç¯å¢ƒä¸‹ä¸åˆé€‚ã€‚å¯ä»¥å°†Sentinelè§„åˆ™æ•°æ®æŒä¹…åŒ–åˆ°Nacosé…ç½®ä¸­â¼¼ï¼Œè®©å¾®æœåŠ¡ä»Nacosè·å–ã€‚</li></ul><table><thead><tr><th>#</th><th>Sentinel</th><th>Hystrix</th></tr></thead><tbody><tr><td>éš”ç¦»ç­–ç•¥</td><td>ä¿¡å·é‡éš”ç¦»</td><td>çº¿ç¨‹æ± éš”ç¦»&#x2F;ä¿¡å·é‡éš”ç¦»</td></tr><tr><td>ç†”æ–­é™çº§ç­–ç•¥</td><td>åŸºäºå“åº”æ—¶é—´æˆ–å¤±è´¥æ¯”ç‡</td><td>åŸºäºå¤±è´¥æ¯”ç‡</td></tr><tr><td>å®æ—¶æŒ‡æ ‡å®ç°</td><td>æ»‘åŠ¨çª—å£</td><td>æ»‘åŠ¨çª—å£ï¼ˆåŸºäº RxJavaï¼‰</td></tr><tr><td>æ‰©å±•æ€§</td><td>å¤šä¸ªæ‰©å±•ç‚¹</td><td>æ’ä»¶çš„å½¢å¼</td></tr><tr><td>é™æµ</td><td>åŸºäº QPSï¼Œæ”¯æŒåŸºäºè°ƒç”¨å…³ç³»çš„é™æµ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>æµé‡æ•´å½¢</td><td>æ”¯æŒæ…¢å¯åŠ¨ã€åŒ€é€Ÿå™¨æ¨¡å¼</td><td>ä¸æ”¯æŒ</td></tr><tr><td>ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>æ§åˆ¶å°</td><td>å¼€ç®±å³ç”¨ï¼Œå¯é…ç½®è§„åˆ™ã€æŸ¥çœ‹ç§’çº§ç›‘æ§ã€æœºå™¨å‘ç°ç­‰</td><td>ä¸å®Œå–„</td></tr><tr><td>å¸¸è§æ¡†æ¶çš„é€‚é…</td><td>Servletã€Spring Cloudã€Dubboã€gRPC</td><td>Servletã€Spring Cloud Netflix</td></tr></tbody></table><h4 id="Config-Nacos"><a href="#Config-Nacos" class="headerlink" title="Config &#x2F; Nacos"></a>Config &#x2F; Nacos</h4><blockquote><p>Nacosæ˜¯é˜¿â¾¥å·´å·´å¼€æºçš„â¼€ä¸ªé’ˆå¯¹å¾®æœåŠ¡æ¶æ„ä¸­<strong>æœåŠ¡å‘ç°</strong>ã€<strong>é…ç½®ç®¡ç†</strong>å’Œ<strong>æœåŠ¡ç®¡ç†å¹³å°</strong>ã€‚</p><p>Nacoså°±æ˜¯<strong>æ³¨å†Œä¸­â¼¼+é…ç½®ä¸­â¼¼</strong>çš„ç»„åˆï¼ˆNacos&#x3D;Eureka+Confifig+Busï¼‰</p></blockquote><p><strong>Nacos</strong>åŠŸèƒ½ç‰¹æ€§</p><ul><li>æœåŠ¡å‘ç°ä¸å¥åº·æ£€æŸ¥</li><li>åŠ¨æ€é…ç½®ç®¡ç†</li><li>åŠ¨æ€DNSæœåŠ¡</li><li>æœåŠ¡å’Œå…ƒæ•°æ®ç®¡ç†</li></ul><p><strong>ä¿æŠ¤é˜ˆå€¼ï¼š</strong></p><p>å½“æœåŠ¡Aå¥åº·å®ä¾‹æ•°&#x2F;æ€»å®ä¾‹æ•° &lt; ä¿æŠ¤é˜ˆå€¼ çš„æ—¶å€™ï¼Œè¯´æ˜å¥åº·å®ä¾‹çœŸçš„ä¸å¤šäº†ï¼Œè¿™ä¸ªæ—¶å€™ä¿æŠ¤é˜ˆå€¼ä¼šè¢«è§¦å‘ï¼ˆçŠ¶æ€trueï¼‰ï¼Œnacoså°†ä¼šæŠŠè¯¥æœåŠ¡æ‰€æœ‰çš„å®ä¾‹ä¿¡æ¯ï¼ˆå¥åº·çš„+ä¸å¥åº·çš„ï¼‰å…¨éƒ¨æä¾›ç»™æ¶ˆè´¹è€…ï¼Œæ¶ˆè´¹è€…å¯èƒ½è®¿é—®åˆ°ä¸å¥åº·çš„å®ä¾‹ï¼Œè¯·æ±‚å¤±è´¥ï¼Œä½†è¿™æ ·ä¹Ÿâ½é€ æˆé›ªå´©è¦å¥½ï¼Œç‰ºç‰²äº†â¼€äº›è¯·æ±‚ï¼Œä¿è¯äº†æ•´ä¸ªç³»ç»Ÿçš„â¼€ä¸ªå¯â½¤ã€‚</p><p><strong>Nacos</strong> æ•°æ®æ¨¡å‹ï¼ˆé¢†åŸŸæ¨¡å‹ï¼‰</p><ul><li><strong>Namespace</strong> ä»£è¡¨ä¸åŒçš„ç¯å¢ƒï¼Œå¦‚å¼€å‘devã€æµ‹è¯•testã€â½£äº§ç¯å¢ƒprod</li><li><strong>Group</strong> ä»£è¡¨æŸé¡¹â½¬ï¼Œâ½å¦‚çˆªå“‡äº‘é¡¹â½¬</li><li><strong>Service</strong> æŸä¸ªé¡¹â½¬ä¸­å…·ä½“xxxæœåŠ¡</li><li><strong>DataId</strong> æŸä¸ªé¡¹â½¬ä¸­å…·ä½“çš„xxxé…ç½®â½‚ä»¶</li></ul><p>å¯ä»¥é€šè¿‡ Spring Cloud åŸâ½£æ³¨è§£ <code>@RefreshScope</code> å®ç°é…ç½®â¾ƒåŠ¨æ›´æ–°</p><h4 id="Bus-Stream"><a href="#Bus-Stream" class="headerlink" title="Bus &#x2F; Stream"></a>Bus &#x2F; Stream</h4><blockquote><p>Spring Cloud Stream æ¶ˆæ¯é©±åŠ¨ç»„ä»¶å¸®åŠ©æˆ‘ä»¬æ›´å¿«é€Ÿï¼Œæ›´â½…ä¾¿çš„å»æ„å»º<strong>æ¶ˆæ¯é©±åŠ¨</strong>å¾®æœåŠ¡çš„</p><p>æœ¬è´¨ï¼šå±è”½æ‰äº†åº•å±‚ä¸åŒ<strong>MQ</strong>æ¶ˆæ¯ä¸­é—´ä»¶ä¹‹é—´çš„å·®å¼‚ï¼Œç»Ÿâ¼€äº†<strong>MQ</strong>çš„ç¼–ç¨‹æ¨¡å‹ï¼Œé™ä½äº†å­¦ä¹ ã€å¼€å‘ã€ç»´æŠ¤<strong>MQ</strong>çš„æˆæœ¬ï¼Œâ½¬å‰â½€æŒRabbitã€Kafkaä¸¤ç§æ¶ˆæ¯</p></blockquote><h4 id="Sleuth-Zipkin"><a href="#Sleuth-Zipkin" class="headerlink" title="Sleuth &#x2F; Zipkin"></a><strong>Sleuth &#x2F; Zipkin</strong></h4><p><strong>å…¨é“¾è·¯è¿½è¸ª</strong></p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gmc3avezqrj30xb0lw76z.jpg" alt="image-20210104234058218" style="zoom:67%;" /><p><strong>Trace ID</strong>ï¼šå½“è¯·æ±‚å‘é€åˆ°åˆ†å¸ƒå¼ç³»ç»Ÿçš„â¼Šâ¼ç«¯ç‚¹æ—¶ï¼ŒSleuthä¸ºè¯¥è¯·æ±‚åˆ›å»ºâ¼€ä¸ªå”¯â¼€çš„è·Ÿè¸ªæ ‡è¯†Trace IDï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿå†…éƒ¨æµè½¬çš„æ—¶å€™ï¼Œæ¡†æ¶å§‹ç»ˆä¿æŒè¯¥å”¯â¼€æ ‡è¯†ï¼Œç›´åˆ°è¿”å›ç»™è¯·æ±‚â½…</p><p><strong>Span ID</strong>ï¼šä¸ºäº†ç»Ÿè®¡å„å¤„ç†å•å…ƒçš„æ—¶é—´å»¶è¿Ÿï¼Œå½“è¯·æ±‚åˆ°è¾¾å„ä¸ªæœåŠ¡ç»„ä»¶æ—¶ï¼Œä¹Ÿæ˜¯é€šè¿‡â¼€ä¸ªå”¯â¼€æ ‡è¯†SpanIDæ¥æ ‡è®°å®ƒçš„å¼€å§‹ï¼Œå…·ä½“è¿‡ç¨‹ä»¥åŠç»“æŸã€‚</p><p>Spring Cloud Sleuth ï¼ˆè¿½è¸ªæœåŠ¡æ¡†æ¶ï¼‰å¯ä»¥è¿½è¸ªæœåŠ¡ä¹‹é—´çš„è°ƒâ½¤ï¼ŒSleuthå¯ä»¥è®°å½•â¼€ä¸ªæœåŠ¡è¯·æ±‚ç»è¿‡å“ªäº›æœåŠ¡ã€æœåŠ¡å¤„ç†æ—¶â»“ç­‰ï¼Œæ ¹æ®è¿™äº›ï¼Œæˆ‘ä»¬èƒ½å¤Ÿç†æ¸…å„å¾®æœåŠ¡é—´çš„è°ƒâ½¤å…³ç³»åŠè¿›â¾é—®é¢˜è¿½è¸ªåˆ†æã€‚</p><p><strong>è€—æ—¶åˆ†æ</strong>ï¼šé€šè¿‡ Sleuth äº†è§£é‡‡æ ·è¯·æ±‚çš„è€—æ—¶ï¼Œåˆ†ææœåŠ¡æ€§èƒ½é—®é¢˜ï¼ˆå“ªäº›æœåŠ¡è°ƒâ½¤â½è¾ƒè€—æ—¶ï¼‰</p><p><strong>é“¾è·¯ä¼˜åŒ–</strong>ï¼šå‘ç°é¢‘ç¹è°ƒâ½¤çš„æœåŠ¡ï¼Œé’ˆå¯¹æ€§ä¼˜åŒ–ç­‰</p><p><strong>èšåˆå±•ç¤º</strong>ï¼šæ•°æ®ä¿¡æ¯å‘é€ç»™ Zipkin è¿›â¾èšåˆï¼Œåˆ©â½¤ Zipkin å­˜å‚¨å¹¶å±•ç¤ºæ•°æ®ã€‚</p><h3 id="å®‰å…¨è®¤è¯"><a href="#å®‰å…¨è®¤è¯" class="headerlink" title="å®‰å…¨è®¤è¯"></a><strong>å®‰å…¨è®¤è¯</strong></h3><ul><li><p>Session</p><p>è®¤è¯ä¸­æœ€å¸¸ç”¨çš„ä¸€ç§æ–¹å¼ï¼Œä¹Ÿæ˜¯æœ€ç®€å•çš„ã€‚å­˜åœ¨<strong>å¤šèŠ‚ç‚¹sessionä¸¢å¤±</strong>çš„æƒ…å†µï¼Œå¯é€šè¿‡<strong>nginxç²˜æ€§Cookie</strong>å’ŒRedisé›†ä¸­å¼Sessionå­˜å‚¨è§£å†³</p></li><li><p>HTTP Basic Authentication </p><p>æœåŠ¡ç«¯é’ˆå¯¹è¯·æ±‚å¤´ä¸­base64åŠ å¯†çš„Authorization å’Œç”¨æˆ·åå’Œå¯†ç è¿›è¡Œ<strong>æ ¡éªŒ</strong>ã€‚</p></li><li><p>Token</p><p>Session åªæ˜¯ä¸€ä¸ª keyï¼Œ<strong>ä¼šè¯ä¿¡æ¯å­˜å‚¨åœ¨åç«¯</strong>ã€‚è€Œ Token ä¸­ä¼šå­˜å‚¨ç”¨æˆ·çš„ä¿¡æ¯ï¼Œç„¶åé€šè¿‡åŠ å¯†ç®—æ³•è¿›è¡ŒåŠ å¯†ï¼Œåªæœ‰æœåŠ¡ç«¯æ‰èƒ½è§£å¯†ï¼Œ<strong>æœåŠ¡ç«¯æ‹¿åˆ° Token åè¿›è¡Œè§£å¯†è·å–ç”¨æˆ·ä¿¡æ¯</strong>ã€‚</p></li><li><p>JWTè®¤è¯</p></li></ul><blockquote><p>JWTï¼ˆJSON Web Tokenï¼‰ç”¨æˆ·æä¾›ç”¨æˆ·åå’Œå¯†ç ç»™è®¤è¯æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨éªŒè¯ç”¨æˆ·æäº¤ä¿¡æ¯çš„åˆæ³•æ€§ï¼›å¦‚æœéªŒè¯æˆåŠŸï¼Œä¼šäº§ç”Ÿå¹¶è¿”å›ä¸€ä¸ª Tokenï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨è¿™ä¸ª Token è®¿é—®æœåŠ¡å™¨ä¸Šå—ä¿æŠ¤çš„èµ„æºã€‚</p></blockquote><img src="http://s0.lgstatic.com/i/image2/M01/AB/87/CgotOV3WUG2ARl98AAD_xcd-ElM857.png" alt="img" style="zoom:70%;" /><ol><li>è®¤è¯æœåŠ¡æä¾›è®¤è¯çš„ APIï¼Œæ ¡éªŒç”¨æˆ·ä¿¡æ¯ï¼Œè¿”å›è®¤è¯ç»“æœ</li><li>é€šè¿‡JWTUtilsä¸­çš„RSAç®—æ³•ï¼Œç”ŸæˆJWT tokenï¼Œtokené‡Œå°è£…ç”¨æˆ·idå’Œæœ‰æ•ˆæœŸ</li><li>æœåŠ¡é—´å‚æ•°é€šè¿‡è¯·æ±‚å¤´è¿›è¡Œä¼ é€’ï¼ŒæœåŠ¡å†…éƒ¨é€šè¿‡ ThreadLocal è¿›è¡Œä¸Šä¸‹æ–‡ä¼ é€’ã€‚</li><li>Hystrixå¯¼è‡´ThreadLocalå¤±æ•ˆçš„é—®é¢˜å¯ä»¥é€šè¿‡ï¼Œé‡å†™ Hystrix çš„ Callable æ–¹æ³•ï¼Œä¼ é€’éœ€è¦çš„æ•°æ®ã€‚</li></ol><p><strong>Tokenæœ€ä½³å®è·µ</strong></p><ul><li><p>è®¾ç½®<strong>è¾ƒçŸ­ï¼ˆåˆç†ï¼‰çš„è¿‡æœŸæ—¶é—´</strong>ã€‚</p></li><li><p>æ³¨é”€çš„ Token <strong>åŠæ—¶æ¸…é™¤</strong>ï¼ˆæ”¾å…¥ Redis ä¸­åšä¸€å±‚è¿‡æ»¤ï¼‰ã€‚</p><p>è™½ç„¶ä¸èƒ½ä¿®æ”¹ Token çš„ä¿¡æ¯ï¼Œä½†æ˜¯èƒ½åœ¨éªŒè¯å±‚é¢åšä¸€å±‚è¿‡æ»¤æ¥è¿›è¡Œå¤„ç†ã€‚</p></li><li><p>ç›‘æ§ Token çš„<strong>ä½¿ç”¨é¢‘ç‡</strong>ã€‚</p><p>ä¸ºäº†é˜²æ­¢æ•°æ®è¢«åˆ«äººçˆ¬å–ï¼Œæœ€å¸¸è§çš„å°±æ˜¯ç›‘æ§ä½¿ç”¨é¢‘ç‡ï¼Œç¨‹åºå†™å‡ºæ¥çš„çˆ¬è™«ç¨‹åºè®¿é—®é¢‘ç‡æ˜¯æœ‰è¿¹å¯å¾ªçš„ </p></li><li><p>æ ¸å¿ƒåŠŸèƒ½æ•æ„Ÿæ“ä½œå¯ä»¥ä½¿ç”¨<strong>åŠ¨æ€éªŒè¯</strong>ï¼ˆéªŒè¯ç ï¼‰ã€‚</p><p>æ¯”å¦‚æç°çš„åŠŸèƒ½ï¼Œè¦æ±‚åœ¨æç°æ—¶å†æ¬¡è¿›è¡ŒéªŒè¯ç çš„éªŒè¯ï¼Œé˜²æ­¢ä¸æ˜¯æœ¬äººæ“ä½œã€‚</p></li><li><p><strong>ç½‘ç»œç¯å¢ƒã€æµè§ˆå™¨</strong>ä¿¡æ¯ç­‰è¯†åˆ«ã€‚</p><p>é“¶è¡Œ APP å¯¹ç¯å¢ƒæœ‰å¾ˆé«˜çš„è¦æ±‚ï¼Œä½¿ç”¨æ—¶å¦‚æœæ–­ç½‘ï¼ŒAPP ä¼šè‡ªåŠ¨é€€å‡ºï¼Œé‡æ–°ç™»å½•ï¼Œå› ä¸ºç½‘ç»œç¯å¢ƒè·Ÿä¹‹å‰ä½¿ç”¨çš„ä¸ä¸€æ ·äº†ï¼Œè¿˜æœ‰ä¸€äº›æµè§ˆå™¨çš„ä¿¡æ¯ä¹‹ç±»çš„åˆ¤æ–­ï¼Œè¿™äº›éƒ½æ˜¯å¯ä»¥ç”¨æ¥ä¿è¯åç«¯ API çš„å®‰å…¨ã€‚</p></li><li><p><strong>åŠ å¯†å¯†é’¥</strong>æ”¯æŒåŠ¨æ€ä¿®æ”¹ã€‚</p><p>å¦‚æœ Token çš„åŠ å¯†å¯†é’¥æ³„éœ²äº†ï¼Œä¹Ÿå°±æ„å‘³ç€åˆ«äººå¯ä»¥ä¼ªé€ ä½ çš„ Tokenï¼Œå¯ä»¥å°†å¯†é’¥å­˜å‚¨åœ¨é…ç½®ä¸­å¿ƒï¼Œä»¥æ”¯æŒåŠ¨æ€ä¿®æ”¹åˆ·æ–°ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å»ºè®®åœ¨æµé‡ä½å³°çš„æ—¶å€™å»åšæ›´æ¢çš„æ“ä½œï¼Œå¦åˆ™ Token å…¨éƒ¨å¤±æ•ˆï¼Œæ‰€æœ‰åœ¨çº¿çš„è¯·æ±‚éƒ½ä¼šé‡æ–°ç”³è¯· Tokenï¼Œå¹¶å‘é‡ä¼šæ¯”è¾ƒå¤§ã€‚</p></li></ul><h3 id="ç°åº¦å‘å¸ƒ"><a href="#ç°åº¦å‘å¸ƒ" class="headerlink" title="ç°åº¦å‘å¸ƒ"></a>ç°åº¦å‘å¸ƒ</h3><p><strong>ç—›ç‚¹ï¼š</strong></p><ul><li><p>æœåŠ¡æ•°é‡å¤šï¼Œä¸šåŠ¡å˜åŠ¨é¢‘ç¹ï¼Œä¸€å‘¨ä¸€å‘å¸ƒ</p></li><li><p>ç°åº¦å‘å¸ƒèƒ½é™ä½å‘å¸ƒå¤±è´¥é£é™©ï¼Œ<strong>å‡å°‘å½±å“èŒƒå›´</strong></p><p>é€šè¿‡ç°åº¦å‘å¸ƒï¼Œå…ˆè®©ä¸€éƒ¨åˆ†ç”¨æˆ·ä½“éªŒæ–°çš„æœåŠ¡ï¼Œæˆ–è€…åªè®©æµ‹è¯•äººå‘˜è¿›è¡Œæµ‹è¯•ï¼Œç­‰åŠŸèƒ½æ­£å¸¸åå†å…¨éƒ¨å‘å¸ƒï¼Œè¿™æ ·èƒ½é™ä½å‘å¸ƒå¤±è´¥å¸¦æ¥çš„å½±å“èŒƒå›´ã€‚ </p></li><li><p>å½“å‘å¸ƒå‡ºç°æ•…éšœæ—¶ï¼Œå¯ä»¥<strong>å¿«é€Ÿå›æ»š</strong>ï¼Œä¸å½±å“ç”¨æˆ·</p><p>ç°åº¦åå¦‚æœå‘ç°è¿™ä¸ªèŠ‚ç‚¹æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆåªéœ€å›æ»šè¿™ä¸ªèŠ‚ç‚¹å³å¯ï¼Œå½“ç„¶ä¸å›æ»šä¹Ÿæ²¡å…³ç³»ï¼Œé€šè¿‡ç°åº¦ç­–ç•¥éš”ç¦»ï¼Œä¹Ÿä¸ä¼šå½±å“æ­£å¸¸ç”¨æˆ·</p></li></ul><p>å¯ä»¥é€šè¿‡Ribbonçš„è´Ÿè½½å‡è¡¡ç­–ç•¥è¿›è¡Œç°åº¦å‘å¸ƒï¼Œå¯ä»¥ä½¿ç”¨æ›´å¯é çš„Discovery</p><p><strong>Discovery</strong></p><blockquote><p>åŸºäºDiscovery æœåŠ¡æ³¨å†Œå‘ç°ã€Ribbon è´Ÿè½½å‡è¡¡ã€Feign å’Œ RestTemplate è°ƒç”¨ç­‰ç»„ä»¶çš„ä¼ä¸šçº§å¾®æœåŠ¡å¼€æºè§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ç°åº¦å‘å¸ƒã€ç°åº¦è·¯ç”±ã€æœåŠ¡éš”ç¦»ç­‰åŠŸèƒ½</p></blockquote><img src="https://s0.lgstatic.com/i/image3/M01/54/41/CgpOIF3nXSaAB9bRAAE8rktrUyY037.png" alt="img" style="zoom:50%;" /><ol><li><p>é¦–å…ˆå°†éœ€è¦å‘å¸ƒçš„æœåŠ¡ä»è½¬å‘è¿‡ç¨‹ä¸­ç§»é™¤ï¼Œç­‰æµé‡å‰”é™¤ä¹‹åå†å‘å¸ƒã€‚</p></li><li><p>éƒ¨åˆ†æœºå™¨ä¸­çš„ç‰ˆæœ¬è¿›è¡Œå‡çº§ï¼Œç”¨æˆ·é»˜è®¤è¿˜æ˜¯è¯·æ±‚è€çš„æœåŠ¡ï¼Œé€šè¿‡ç‰ˆæœ¬æ¥æ”¯æŒæµ‹è¯•è¯·æ±‚ã€‚</p></li><li><p>æµ‹è¯•å®Œæˆä¹‹åï¼Œè®©æ–°çš„ç‰ˆæœ¬æ¥æ”¶æ­£å¸¸æµé‡ï¼Œç„¶åéƒ¨ç½²ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grayVersions = &#123;<span class="string">&quot;discovery-article-service&quot;</span>:[<span class="string">&quot;1.01&quot;</span>]&#125;</span><br></pre></td></tr></table></figure><h3 id="å¤šç‰ˆæœ¬éš”ç¦»"><a href="#å¤šç‰ˆæœ¬éš”ç¦»" class="headerlink" title="å¤šç‰ˆæœ¬éš”ç¦»"></a>å¤šç‰ˆæœ¬éš”ç¦»</h3><img src="https://s0.lgstatic.com/i/image3/M01/54/41/Cgq2xl3nXSeAZMTOAAE2sCaIhPE668.png" alt="img" style="zoom:50%;" /><p><strong>æœ¬åœ°å¤ç”¨æµ‹è¯•æœåŠ¡</strong>-Eureka Zoneäº®ç‚¹</p><p>â€‹<strong>region</strong> åœ°ç†ä¸Šçš„åˆ†åŒºï¼Œæ¯”å¦‚åŒ—äº¬ã€ä¸Šæµ·ç­‰</p><p>â€‹<strong>zone</strong> å¯ä»¥ç®€å•ç†è§£ä¸º region å†…çš„å…·ä½“æœºæˆ¿</p><p>â€‹åœ¨è°ƒç”¨çš„è¿‡ç¨‹ä¸­ä¼šä¼˜å…ˆé€‰æ‹©ç›¸åŒçš„ zone å‘èµ·è°ƒç”¨ï¼Œå½“æ‰¾ä¸åˆ°ç›¸åŒåç§°çš„ zone æ—¶ä¼šé€‰æ‹©å…¶ä»–çš„ zone è¿›è¡Œè°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§æ¥è§£å†³æœ¬åœ°éœ€è¦å¯åŠ¨å¤šä¸ªæœåŠ¡çš„é—®é¢˜ã€‚</p><p>[^]: å½“ä½ è®¿é—®ä¿®æ”¹çš„æœåŠ¡ A æ—¶ï¼Œè¿™ä¸ªæœåŠ¡ä¾èµ–äº† Bã€C ä¸¤ä¸ªæœåŠ¡ï¼ŒB å’Œ C æœ¬åœ°æ²¡æœ‰å¯åŠ¨ï¼ŒB å’Œ C æ‰¾ä¸åˆ°ç›¸åŒçš„ zone å°±ä¼šé€‰æ‹©å…¶ä»–çš„ zone è¿›è¡Œè°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯ä¼šè°ƒç”¨åˆ°æµ‹è¯•ç¯å¢ƒéƒ¨ç½²çš„ B å’Œ C æœåŠ¡ï¼Œè¿™æ ·ä¸€æ¥å°±è§£å†³äº†æœ¬åœ°éƒ¨ç½²å¤šä¸ªæœåŠ¡çš„é—®é¢˜ã€‚</p><h4 id="å„ç»„ä»¶è°ƒä¼˜"><a href="#å„ç»„ä»¶è°ƒä¼˜" class="headerlink" title="å„ç»„ä»¶è°ƒä¼˜"></a><strong>å„ç»„ä»¶è°ƒä¼˜</strong></h4><p>å½“ä½ å¯¹ç½‘å…³è¿›è¡Œå‹æµ‹æ—¶ï¼Œä¼šå‘ç°å¹¶å‘é‡ä¸€ç›´ä¸Šä¸å»ï¼Œé”™è¯¯ç‡ä¹Ÿå¾ˆé«˜ã€‚å› ä¸ºä½ ç”¨çš„æ˜¯é»˜è®¤é…ç½®ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦å»è°ƒæ•´é…ç½®ä»¥è¾¾åˆ°æœ€ä¼˜çš„æ•ˆæœã€‚</p><p>é¦–å…ˆæˆ‘ä»¬å¯ä»¥å¯¹å®¹å™¨è¿›è¡Œè°ƒä¼˜ï¼Œæœ€å¸¸è§çš„å°±æ˜¯<strong>å†…ç½®çš„ Tomcat</strong> å®¹å™¨äº†ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server.tomcat.accept-count <span class="comment">//è¯·æ±‚é˜Ÿåˆ—æ’é˜Ÿæ•°</span></span><br><span class="line">server.tomcat.max-threads <span class="comment">//æœ€å¤§çº¿ç¨‹æ•°</span></span><br><span class="line">server.tomcat.max-connections <span class="comment">//æœ€å¤§è¿æ¥æ•°</span></span><br></pre></td></tr></table></figure><p><strong>Hystrix</strong> çš„ä¿¡å·é‡ï¼ˆsemaphoreï¼‰éš”ç¦»æ¨¡å¼ï¼Œå¹¶å‘é‡ä¸Šä¸å»å¾ˆå¤§çš„åŸå› éƒ½åœ¨è¿™é‡Œï¼Œä¿¡å·é‡é»˜è®¤å€¼æ˜¯ 100ï¼Œä¹Ÿå°±æ˜¯æœ€å¤§å¹¶å‘åªæœ‰ 100ï¼Œè¶…è¿‡ 100 å°±å¾—ç­‰å¾…ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¿¡å·é‡</span></span><br><span class="line">zuul.semaphore.max-semaphores <span class="comment">//ä¿¡å·é‡ï¼šæœ€å¤§å¹¶å‘æ•°</span></span><br><span class="line"><span class="comment">//çº¿ç¨‹æ± </span></span><br><span class="line">hystrix.threadpool.<span class="keyword">default</span>.coreSize <span class="comment">//æœ€å¤§çº¿ç¨‹æ•°</span></span><br><span class="line">hystrix.threadpool.<span class="keyword">default</span>.maximumSize <span class="comment">//é˜Ÿåˆ—çš„å¤§</span></span><br><span class="line">hystrix.threadpool.<span class="keyword">default</span>.maxQueueSize <span class="comment">//ç­‰å‚æ•°</span></span><br></pre></td></tr></table></figure><p>é…ç½®<strong>Gateway</strong>å¹¶å‘ä¿¡æ¯ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gateway.host.max-per-route-connections <span class="comment">//æ¯ä¸ªè·¯ç”±çš„è¿æ¥æ•° </span></span><br><span class="line">gateway.host.max-total-connections <span class="comment">//æ€»è¿æ¥æ•°</span></span><br></pre></td></tr></table></figure><p>è°ƒæ•´<strong>Ribbon</strong> çš„å¹¶å‘é…ç½®ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ribbon.MaxConnectionsPerHost <span class="comment">//å•æœåŠ¡å¹¶å‘æ•°</span></span><br><span class="line">ribbon.MaxTotalConnections   <span class="comment">//æ€»å¹¶å‘æ•°</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹<strong>Feign</strong>é»˜è®¤çš„HttpURLConnection æ›¿æ¢æˆ httpclient æ¥æé«˜æ€§èƒ½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">feign.httpclient.max-connections-per-route<span class="comment">//æ¯ä¸ªè·¯ç”±çš„è¿æ¥æ•°</span></span><br><span class="line">feign.httpclient.max-connections <span class="comment">//æ€»è¿æ¥æ•°</span></span><br></pre></td></tr></table></figure><p>Gateway+é…ç½®ä¸­å¿ƒå®ç°åŠ¨æ€è·¯ç”±</p><p>Feign+é…ç½®ä¸­å¿ƒå®ç°åŠ¨æ€æ—¥å¿—</p><h1 id="ä¹ã€åˆ†å¸ƒå¼ç¯‡"><a href="#ä¹ã€åˆ†å¸ƒå¼ç¯‡" class="headerlink" title="ä¹ã€åˆ†å¸ƒå¼ç¯‡"></a><strong>ä¹ã€åˆ†å¸ƒå¼ç¯‡</strong></h1><blockquote><p>åˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯ä¸€ä¸ªç¡¬ä»¶æˆ–è½¯ä»¶ç»„ä»¶åˆ†å¸ƒåœ¨ä¸åŒçš„ç½‘ç»œè®¡ç®—æœºä¸Šï¼Œå½¼æ­¤ä¹‹é—´ä»…ä»…é€šè¿‡æ¶ˆæ¯ä¼ é€’è¿›è¡Œé€šä¿¡å’Œåè°ƒçš„ç³»ç»Ÿã€‚</p></blockquote><h3 id="å‘å±•å†ç¨‹"><a href="#å‘å±•å†ç¨‹" class="headerlink" title="å‘å±•å†ç¨‹"></a><strong>å‘å±•å†ç¨‹</strong></h3><ul><li><p>å…¥å£çº§è´Ÿè½½å‡è¡¡</p><ul><li>ç½‘å…³è´Ÿè½½å‡è¡¡</li><li>å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡</li></ul></li><li><p>å•åº”ç”¨æ¶æ„</p><ul><li>åº”ç”¨æœåŠ¡å’Œæ•°æ®æœåŠ¡åˆ†ç¦»</li><li>åº”ç”¨æœåŠ¡é›†ç¾¤</li><li>åº”ç”¨æœåŠ¡ä¸­å¿ƒåŒ–SAAS</li></ul></li><li><p>æ•°æ®åº“ä¸»å¤‡è¯»å†™åˆ†ç¦»</p><ul><li>å…¨æ–‡æœç´¢å¼•æ“åŠ å¿«æ•°æ®ç»Ÿè®¡</li><li>ç¼“å­˜é›†ç¾¤ç¼“è§£æ•°æ®åº“è¯»å‹åŠ›</li><li>åˆ†å¸ƒå¼æ¶ˆæ¯ä¸­é—´ä»¶ç¼“è§£æ•°æ®åº“å†™å‹åŠ›</li><li>æ•°æ®åº“æ°´å¹³æ‹†åˆ†é€‚åº”å¾®æœåŠ¡</li><li>æ•°æ®åº“å‚ç›´æ‹†åˆ†è§£å†³æ…¢æŸ¥è¯¢</li></ul></li><li><p>åˆ’åˆ†ä¸Šä¸‹æ–‡æ‹†åˆ†å¾®æœåŠ¡</p><ul><li>æœåŠ¡æ³¨å†Œå‘ç°ï¼ˆEurekaã€Nacosï¼‰</li><li>é…ç½®åŠ¨æ€æ›´æ–°ï¼ˆConfigã€Apolloï¼‰</li><li>ä¸šåŠ¡ç°åº¦å‘å¸ƒï¼ˆGatewayã€Feignï¼‰</li><li>ç»Ÿä¸€å®‰å…¨è®¤è¯ï¼ˆGatewayã€Authï¼‰</li><li>æœåŠ¡é™çº§é™æµï¼ˆHystrixã€Sentinelï¼‰</li><li>æ¥å£æ£€æŸ¥ç›‘æ§ï¼ˆActuatorã€Prometheusï¼‰</li><li>æœåŠ¡å…¨é“¾è·¯è¿½è¸ªï¼ˆSleuthã€Zipkinï¼‰</li></ul></li></ul><h3 id="CAP"><a href="#CAP" class="headerlink" title="CAP"></a>CAP</h3><ul><li><strong>ä¸€è‡´æ€§</strong>ï¼ˆ2PCã€3PCã€Paxosã€Raftï¼‰<ul><li>å¼ºä¸€è‡´æ€§ï¼š<strong>æ•°æ®åº“ä¸€è‡´æ€§</strong>ï¼Œç‰ºç‰²äº†æ€§èƒ½<ul><li><strong>ACID</strong>ï¼šåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§</li></ul></li><li>å¼±ä¸€è‡´æ€§ï¼š<strong>æ•°æ®åº“å’Œç¼“å­˜</strong>ï¼Œ<strong>å»¶è¿ŸåŒåˆ ã€é‡è¯•</strong></li><li>å•è°ƒè¯»ä¸€è‡´æ€§ï¼š<strong>ç¼“å­˜ä¸€è‡´æ€§</strong>ï¼ŒIDæˆ–è€…IPå“ˆå¸Œ</li><li>æœ€ç»ˆä¸€è‡´æ€§ï¼š<strong>è¾¹ç¼˜ä¸šåŠ¡</strong>ï¼Œæ¶ˆæ¯é˜Ÿåˆ—</li></ul></li><li><strong>å¯ç”¨æ€§</strong>ï¼ˆå¤šçº§ç¼“å­˜ã€è¯»å†™åˆ†ç¦»ï¼‰<ul><li><strong>BASE</strong> åŸºæœ¬å¯ç”¨ï¼šé™æµå¯¼è‡´å“åº”é€Ÿåº¦æ…¢ã€é™çº§å¯¼è‡´ç”¨æˆ·ä½“éªŒå·®<ul><li>Basically Availabe åŸºæœ¬å¯ç”¨  </li><li>Soft state è½¯çŠ¶æ€</li><li>Eventual Consistency æœ€ç»ˆä¸€è‡´æ€§</li></ul></li></ul></li><li>åˆ†åŒºå®¹å¿æ€§ï¼ˆä¸€è‡´æ€§Hashè§£å†³æ‰©ç¼©å®¹é—®é¢˜ï¼‰</li></ul><h3 id="ä¸€è‡´æ€§-1"><a href="#ä¸€è‡´æ€§-1" class="headerlink" title="ä¸€è‡´æ€§"></a>ä¸€è‡´æ€§</h3><h4 id="XAæ–¹æ¡ˆ"><a href="#XAæ–¹æ¡ˆ" class="headerlink" title="XAæ–¹æ¡ˆ"></a>XAæ–¹æ¡ˆ</h4><p><strong>2PC</strong>åè®®ï¼šä¸¤é˜¶æ®µæäº¤åè®®ï¼ŒPæ˜¯æŒ‡<strong>å‡†å¤‡</strong>é˜¶æ®µï¼ŒCæ˜¯æŒ‡<strong>æäº¤</strong>é˜¶æ®µ</p><ul><li>å‡†å¤‡é˜¶æ®µï¼šè¯¢é—®æ˜¯å¦å¯ä»¥å¼€å§‹ï¼Œå†™Undoã€Redoæ—¥å¿—ï¼Œæ”¶åˆ°å“åº”</li><li>æäº¤é˜¶æ®µï¼šæ‰§è¡ŒRedoæ—¥å¿—è¿›è¡Œ<strong>Commit</strong>ï¼Œæ‰§è¡ŒUndoæ—¥å¿—è¿›è¡Œ<strong>Rollback</strong></li></ul><p><strong>3PC</strong>åè®®ï¼šå°†æäº¤é˜¶æ®µåˆ†ä¸º<strong>CanCommit</strong>ã€<strong>PreCommit</strong>ã€<strong>DoCommit</strong>ä¸‰ä¸ªé˜¶æ®µ</p><p><strong>CanCommit</strong>ï¼šå‘é€canCommitè¯·æ±‚ï¼Œå¹¶å¼€å§‹ç­‰å¾…</p><p><strong>PreCommit</strong>ï¼šæ”¶åˆ°å…¨éƒ¨Yesï¼Œå†™Undoã€Redoæ—¥å¿—ã€‚è¶…æ—¶æˆ–è€…Noï¼Œåˆ™ä¸­æ–­</p><p><strong>DoCommit</strong>ï¼šæ‰§è¡ŒRedoæ—¥å¿—è¿›è¡Œ<strong>Commit</strong>ï¼Œæ‰§è¡ŒUndoæ—¥å¿—è¿›è¡Œ<strong>Rollback</strong> </p><p>åŒºåˆ«æ˜¯ç¬¬äºŒæ­¥ï¼Œå‚ä¸è€…<strong>è‡ªèº«å¢åŠ äº†è¶…æ—¶</strong>ï¼Œå¦‚æœ<strong>å¤±è´¥å¯ä»¥åŠæ—¶é‡Šæ”¾èµ„æº</strong></p><h4 id="Paxosç®—æ³•"><a href="#Paxosç®—æ³•" class="headerlink" title="Paxosç®—æ³•"></a><strong>Paxosç®—æ³•</strong></h4><blockquote><p>å¦‚ä½•åœ¨ä¸€ä¸ªå‘ç”Ÿå¼‚å¸¸çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¿«é€Ÿä¸”æ­£ç¡®åœ°åœ¨é›†ç¾¤å†…éƒ¨å¯¹æŸä¸ªæ•°æ®çš„å€¼è¾¾æˆä¸€è‡´</p></blockquote><p>â€‹å‚ä¸è€…ï¼ˆä¾‹å¦‚Kafkaï¼‰çš„ä¸€è‡´æ€§å¯ä»¥ç”±åè°ƒè€…ï¼ˆä¾‹å¦‚Zookeeperï¼‰æ¥ä¿è¯ï¼Œ<strong>åè°ƒè€…çš„ä¸€è‡´æ€§å°±åªèƒ½ç”±Paxosä¿è¯äº†</strong></p><p>Paxosç®—æ³•ä¸­çš„è§’è‰²ï¼š</p><ul><li><strong>Client</strong>ï¼šå®¢æˆ·ç«¯ã€ä¾‹å¦‚ï¼Œå¯¹åˆ†å¸ƒå¼æ–‡ä»¶æœåŠ¡å™¨ä¸­æ–‡ä»¶çš„å†™è¯·æ±‚ã€‚</li><li><strong>Proposer</strong>ï¼šææ¡ˆå‘èµ·è€…ï¼Œæ ¹æ®Acceptè¿”å›é€‰æ‹©æœ€å¤§Nå¯¹åº”çš„Vï¼Œå‘é€[N+1,V]</li><li><strong>Acceptor</strong>ï¼šå†³ç­–è€…ï¼ŒAcceptä»¥åä¼šæ‹’ç»å°äºNçš„ææ¡ˆï¼Œå¹¶æŠŠè‡ªå·±çš„[N,V]è¿”å›ç»™Proposer</li><li><strong>Learners</strong>ï¼šæœ€ç»ˆå†³ç­–çš„å­¦ä¹ è€…ã€å­¦ä¹ è€…å……å½“è¯¥åè®®çš„å¤åˆ¶å› ç´ </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç®—æ³•çº¦æŸ</span></span><br><span class="line">P1:ä¸€ä¸ªAcceptorå¿…é¡»æ¥å—å®ƒæ”¶åˆ°çš„ç¬¬ä¸€ä¸ªææ¡ˆã€‚</span><br><span class="line"><span class="comment">//è€ƒè™‘åˆ°åŠæ•°ä»¥ä¸Šæ‰ä½œæ•°ï¼Œä¸€ä¸ªAccpterå¾—æ¥å—å¤šä¸ªç›¸åŒvçš„ææ¡ˆ</span></span><br><span class="line">P2a:å¦‚æœæŸä¸ªvçš„ææ¡ˆè¢«acceptï¼Œé‚£ä¹ˆè¢«Acceptoræ¥å—ç¼–å·æ›´é«˜çš„ææ¡ˆå¿…é¡»ä¹Ÿæ˜¯v</span><br><span class="line">P2b:å¦‚æœæŸä¸ªvçš„ææ¡ˆè¢«acceptï¼Œé‚£ä¹ˆä»Proposalæå‡ºç¼–å·æ›´é«˜çš„ææ¡ˆå¿…é¡»ä¹Ÿæ˜¯v</span><br><span class="line"><span class="comment">//å¦‚ä½•ç¡®ä¿vçš„ææ¡ˆAccpterè¢«é€‰å®šåï¼ŒProposaléƒ½èƒ½æå‡ºç¼–å·æ›´é«˜çš„ææ¡ˆå‘¢</span></span><br><span class="line">é’ˆå¯¹ä»»æ„çš„[Mid,Vid]ï¼Œæœ‰åŠæ•°ä»¥ä¸Šçš„Accepteré›†åˆSï¼Œæ»¡è¶³ä»¥ä¸‹äºŒé€‰ä¸€ï¼š</span><br><span class="line">  Sä¸­æ¥å—çš„ææ¡ˆéƒ½å¤§äºMid</span><br><span class="line">  Sä¸­æ¥å—çš„ææ¡ˆè‹¥å°äºMidï¼Œç¼–å·æœ€å¤§çš„é‚£ä¸ªå€¼ä¸ºVid</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gmlato63bnj319m0u0wmi.jpg" alt="image-20210112225118095"></p><p>é¢è¯•é¢˜ï¼šå¦‚ä½•ä¿è¯Paxosç®—æ³•æ´»æ€§</p><p>â€‹å‡è®¾å­˜åœ¨è¿™æ ·ä¸€ç§æç«¯æƒ…å†µï¼Œæœ‰ä¸¤ä¸ªProposerä¾æ¬¡æå‡ºäº†ä¸€ç³»åˆ—ç¼–å·é€’å¢çš„ææ¡ˆï¼Œå¯¼è‡´æœ€ç»ˆé™·å…¥æ­»å¾ªç¯ï¼Œæ²¡æœ‰valueè¢«é€‰å®š</p><ul><li><strong>é€šè¿‡é€‰å–ä¸»Proposer</strong>ï¼Œè§„å®šåªæœ‰ä¸»Proposeræ‰èƒ½æå‡ºè®®æ¡ˆã€‚åªè¦ä¸»Proposerå’Œè¿‡åŠçš„Acceptorèƒ½å¤Ÿæ­£å¸¸ç½‘ç»œé€šä¿¡ï¼Œä¸»Proposeræå‡ºä¸€ä¸ªç¼–å·æ›´é«˜çš„ææ¡ˆï¼Œè¯¥ææ¡ˆç»ˆå°†ä¼šè¢«æ‰¹å‡†ã€‚</li><li>æ¯ä¸ªProposerå‘é€æäº¤ææ¡ˆçš„æ—¶é—´è®¾ç½®ä¸º<strong>ä¸€æ®µæ—¶é—´å†…éšæœº</strong>ï¼Œä¿è¯ä¸ä¼šä¸€ç›´æ­»å¾ªç¯</li></ul><h4 id="ZABç®—æ³•"><a href="#ZABç®—æ³•" class="headerlink" title="ZABç®—æ³•"></a><strong>ZABç®—æ³•</strong></h4><h4 id="Raftç®—æ³•"><a href="#Raftç®—æ³•" class="headerlink" title="Raftç®—æ³•"></a>Raftç®—æ³•</h4><blockquote><p>Raft æ˜¯ä¸€ç§ä¸ºäº†ç®¡ç†å¤åˆ¶æ—¥å¿—çš„ä¸€è‡´æ€§ç®—æ³•</p></blockquote><p>Raftä½¿ç”¨<strong>å¿ƒè·³æœºåˆ¶</strong>æ¥è§¦å‘é€‰ä¸¾ã€‚å½“serverå¯åŠ¨æ—¶ï¼Œåˆå§‹çŠ¶æ€éƒ½æ˜¯<strong>follower</strong>ã€‚æ¯ä¸€ä¸ªserveréƒ½æœ‰ä¸€ä¸ªå®šæ—¶å™¨ï¼Œè¶…æ—¶æ—¶é—´ä¸ºelection timeoutï¼ˆ<strong>ä¸€èˆ¬ä¸º150-300ms</strong>ï¼‰ï¼Œå¦‚æœæŸserver<strong>æ²¡æœ‰è¶…æ—¶çš„æƒ…å†µä¸‹æ”¶åˆ°</strong>æ¥è‡ªé¢†å¯¼è€…æˆ–è€…å€™é€‰è€…çš„ä»»ä½•æ¶ˆæ¯ï¼Œ<strong>å®šæ—¶å™¨é‡å¯</strong>ï¼Œå¦‚æœè¶…æ—¶ï¼Œå®ƒå°±<strong>å¼€å§‹ä¸€æ¬¡é€‰ä¸¾</strong>ã€‚</p><p><strong>Leaderå¼‚å¸¸</strong>ï¼šå¼‚å¸¸æœŸé—´Followerä¼šè¶…æ—¶é€‰ä¸¾ï¼Œå®ŒæˆåLeaderæ¯”è¾ƒå½¼æ­¤æ­¥é•¿</p><p><strong>Followerå¼‚å¸¸ï¼š</strong>æ¢å¤åç›´æ¥åŒæ­¥è‡³Leaderå½“å‰çŠ¶æ€</p><p><strong>å¤šä¸ªCandidateï¼š</strong>é€‰ä¸¾æ—¶å¤±è´¥ï¼Œå¤±è´¥åè¶…æ—¶ç»§ç»­é€‰ä¸¾</p><h4 id="æ•°æ®åº“å’ŒRedisçš„ä¸€è‡´æ€§"><a href="#æ•°æ®åº“å’ŒRedisçš„ä¸€è‡´æ€§" class="headerlink" title="æ•°æ®åº“å’ŒRedisçš„ä¸€è‡´æ€§"></a>æ•°æ®åº“å’ŒRedisçš„ä¸€è‡´æ€§</h4><p><strong>å…¨é‡ç¼“å­˜ä¿è¯é«˜æ•ˆè¯»å–</strong></p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gx2u2g0qkvj31500la0uf.jpg" alt="image-20211205121457205" style="zoom: 50%;" /><p>æ‰€æœ‰æ•°æ®éƒ½å­˜å‚¨åœ¨ç¼“å­˜é‡Œï¼Œè¯»æœåŠ¡åœ¨æŸ¥è¯¢æ—¶ä¸ä¼šå†é™çº§åˆ°æ•°æ®åº“é‡Œï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½å®Œå…¨ä¾èµ–ç¼“å­˜ã€‚æ­¤æ—¶ï¼Œå› é™çº§åˆ°æ•°æ®åº“å¯¼è‡´çš„æ¯›åˆºé—®é¢˜å°±è§£å†³äº†ã€‚ä½†å…¨é‡ç¼“å­˜å¹¶<strong>æ²¡æœ‰è§£å†³æ›´æ–°æ—¶çš„åˆ†å¸ƒå¼äº‹åŠ¡</strong>é—®é¢˜ï¼Œåè€ŒæŠŠé—®é¢˜æ”¾å¤§äº†ã€‚å› ä¸ºå…¨é‡ç¼“å­˜<strong>å¯¹æ•°æ®æ›´æ–°è¦æ±‚æ›´åŠ ä¸¥æ ¼</strong>ï¼Œè¦æ±‚æ‰€æœ‰æ•°æ®åº“<strong>å·²æœ‰æ•°æ®å’Œå®æ—¶æ›´æ–°</strong>çš„æ•°æ®å¿…é¡»å®Œå…¨åŒæ­¥è‡³ç¼“å­˜ï¼Œä¸èƒ½æœ‰é—æ¼ã€‚å¯¹äºæ­¤é—®é¢˜ï¼Œä¸€ç§æœ‰æ•ˆçš„æ–¹æ¡ˆæ˜¯é‡‡ç”¨<strong>è®¢é˜…æ•°æ®åº“çš„ Binlog</strong> å®ç°æ•°æ®åŒæ­¥</p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gx2u9jj094j31c60padiu.jpg" alt="image-20211205121611997" style="zoom:50%;" /><p>â€‹ç°åœ¨å¾ˆå¤šå¼€æºå·¥å…·ï¼ˆå¦‚<strong>é˜¿é‡Œçš„ Canal</strong>ç­‰ï¼‰å¯ä»¥æ¨¡æ‹Ÿä¸»ä»å¤åˆ¶çš„åè®®ã€‚é€šè¿‡æ¨¡æ‹Ÿåè®®è¯»å–ä¸»æ•°æ®åº“çš„ Binlog æ–‡ä»¶ï¼Œä»è€Œè·å–ä¸»åº“çš„æ‰€æœ‰å˜æ›´ã€‚å¯¹äºè¿™äº›å˜æ›´ï¼Œå®ƒä»¬å¼€æ”¾äº†å„ç§æ¥å£ä¾›ä¸šåŠ¡æœåŠ¡è·å–æ•°æ®ã€‚</p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gx2ugzh9ohj31hc0g00ud.jpg" alt="image-20211205121730145" style="zoom:50%;" /><p>â€‹å°† Binlog çš„ä¸­é—´ä»¶æŒ‚è½½è‡³ç›®æ ‡æ•°æ®åº“ä¸Šï¼Œå°±å¯ä»¥<strong>å®æ—¶è·å–è¯¥æ•°æ®åº“çš„æ‰€æœ‰å˜æ›´æ•°æ®</strong>ã€‚å¯¹è¿™äº›å˜æ›´æ•°æ®è§£æåï¼Œä¾¿å¯<strong>ç›´æ¥å†™å…¥ç¼“å­˜é‡Œ</strong>ã€‚ä¼˜ç‚¹è¿˜æœ‰ï¼š</p><ul><li><p>å¤§å¹…æå‡äº†è¯»å–çš„é€Ÿåº¦ï¼Œé™ä½äº†å»¶è¿Ÿ</p></li><li><p>Binlog çš„ä¸»ä»å¤åˆ¶æ˜¯åŸºäº <strong>ACK</strong> æœºåˆ¶ï¼Œ è§£å†³äº†åˆ†å¸ƒå¼äº‹åŠ¡çš„é—®é¢˜</p><p>å¦‚æœåŒæ­¥ç¼“å­˜å¤±è´¥äº†ï¼Œè¢«æ¶ˆè´¹çš„ Binlog ä¸ä¼šè¢«ç¡®è®¤ï¼Œä¸‹ä¸€æ¬¡ä¼šé‡å¤æ¶ˆè´¹ï¼Œæ•°æ®æœ€ç»ˆä¼šå†™å…¥ç¼“å­˜ä¸­</p></li></ul><p><strong>ç¼ºç‚¹</strong>ä¸å¯é¿å…ï¼š1ã€å¢åŠ å¤æ‚åº¦ 2ã€æ¶ˆè€—ç¼“å­˜èµ„æº 3ã€éœ€è¦ç­›é€‰å’Œå‹ç¼©æ•°æ® 4ã€æç«¯æƒ…å†µæ•°æ®ä¸¢å¤±</p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gx2u6ltwa4j314s0hs765.jpg" alt="image-20211205121850418" style="zoom:50%;" /><p>å¯ä»¥é€šè¿‡å¼‚æ­¥æ ¡å‡†æ–¹æ¡ˆè¿›è¡Œè¡¥é½ï¼Œä½†æ˜¯ä¼šæŸè€—æ•°æ®åº“æ€§èƒ½ã€‚ä½†æ˜¯æ­¤æ–¹æ¡ˆä¼šéšè—ä¸­é—´ä»¶ä½¿ç”¨é”™è¯¯çš„ç»†èŠ‚ï¼Œçº¿ä¸Šç¯å¢ƒå‰æœŸæ›´é‡è¦çš„æ˜¯è®°å½•æ—¥å¿—æ’æŸ¥åœ¨åšåç»­ä¼˜åŒ–ï¼Œä¸èƒ½æœ¬æœ«å€’ç½®ã€‚</p><h3 id="å¯ç”¨æ€§-1"><a href="#å¯ç”¨æ€§-1" class="headerlink" title="å¯ç”¨æ€§"></a>å¯ç”¨æ€§</h3><h4 id="å¿ƒè·³æ£€æµ‹"><a href="#å¿ƒè·³æ£€æµ‹" class="headerlink" title="å¿ƒè·³æ£€æµ‹"></a><strong>å¿ƒè·³æ£€æµ‹</strong></h4><blockquote><p>ä»¥<strong>å›ºå®šçš„é¢‘ç‡</strong>å‘å…¶ä»–èŠ‚ç‚¹æ±‡æŠ¥å½“å‰èŠ‚ç‚¹çŠ¶æ€çš„æ–¹å¼ã€‚æ”¶åˆ°å¿ƒè·³ï¼Œè¯´æ˜ç½‘ç»œå’ŒèŠ‚ç‚¹çš„çŠ¶æ€æ˜¯å¥åº·çš„ã€‚å¿ƒè·³æ±‡æŠ¥æ—¶ï¼Œä¸€èˆ¬ä¼šæºå¸¦ä¸€äº›é™„åŠ çš„<strong>çŠ¶æ€ã€å…ƒæ•°æ®ï¼Œä»¥ä¾¿ç®¡ç†</strong></p></blockquote><p><strong>å‘¨æœŸæ£€æµ‹å¿ƒè·³æœºåˆ¶</strong>ï¼šè¶…æ—¶æœªè¿”å›</p><p><strong>ç´¯è®¡å¤±æ•ˆæ£€æµ‹æœºåˆ¶</strong>ï¼šé‡è¯•è¶…æ¬¡æ•°</p><h4 id="å¤šæœºæˆ¿å®æ—¶çƒ­å¤‡"><a href="#å¤šæœºæˆ¿å®æ—¶çƒ­å¤‡" class="headerlink" title="å¤šæœºæˆ¿å®æ—¶çƒ­å¤‡"></a><strong>å¤šæœºæˆ¿å®æ—¶çƒ­å¤‡</strong></h4><img src="https://tva1.sinaimg.cn/large/008i3skNly1gx2ufbmlkmj31fw0mutc1.jpg" alt="image-20211205122631299" style="zoom:50%;" /><p>ä¸¤å¥—ç¼“å­˜é›†ç¾¤å¯ä»¥åˆ†åˆ«éƒ¨ç½²åˆ°ä¸åŒåŸå¸‚çš„æœºæˆ¿ã€‚è¯»æœåŠ¡ä¹Ÿç›¸åº”åœ°éƒ¨ç½²åˆ°ä¸åŒåŸå¸‚æˆ–ä¸åŒåˆ†åŒºã€‚åœ¨æ‰¿æ¥è¯·æ±‚æ—¶ï¼Œä¸åŒæœºæˆ¿æˆ–åˆ†åŒºçš„è¯»æœåŠ¡åªä¾èµ–åŒæ ·å±æ€§çš„ç¼“å­˜é›†ç¾¤ã€‚æ­¤æ–¹æ¡ˆæœ‰ä¸¤ä¸ªå¥½å¤„ã€‚</p><ol><li><strong>æå‡äº†æ€§èƒ½ã€‚</strong>è¯»æœåŠ¡ä¸è¦åˆ†å±‚ï¼Œè¯»æœåŠ¡è¦å°½å¯èƒ½åœ°å’Œç¼“å­˜æ•°æ®æºé è¿‘ã€‚</li><li><strong>å¢åŠ äº†å¯ç”¨ã€‚</strong>å½“å•æœºæˆ¿å‡ºç°æ•…éšœæ—¶ï¼Œå¯ä»¥ç§’çº§å°†æ‰€æœ‰æµé‡éƒ½åˆ‡æ¢è‡³å­˜æ´»çš„æœºæˆ¿æˆ–åˆ†åŒº</li></ol><p>æ­¤æ–¹æ¡ˆè™½ç„¶å¸¦æ¥äº†æ€§èƒ½å’Œå¯ç”¨æ€§çš„æå‡ï¼Œä½†ä»£ä»·æ˜¯èµ„æºæˆæœ¬çš„ä¸Šå‡ã€‚</p><h3 id="åˆ†åŒºå®¹é”™æ€§"><a href="#åˆ†åŒºå®¹é”™æ€§" class="headerlink" title="åˆ†åŒºå®¹é”™æ€§"></a>åˆ†åŒºå®¹é”™æ€§</h3><blockquote><p>åˆ†å¸ƒå¼ç³»ç»Ÿå¯¹äºé”™è¯¯åŒ…å®¹çš„èƒ½åŠ›</p></blockquote><p>é€šè¿‡é™æµã€é™çº§ã€å…œåº•ã€é‡è¯•ã€è´Ÿè½½å‡è¡¡ç­‰æ–¹å¼å¢å¼ºç³»ç»Ÿçš„å¥å£®æ€§</p><h4 id="æ—¥å¿—å¤åˆ¶"><a href="#æ—¥å¿—å¤åˆ¶" class="headerlink" title="æ—¥å¿—å¤åˆ¶"></a>æ—¥å¿—å¤åˆ¶</h4><p><img src="https://i.loli.net/2021/01/14/fmYEJy9N7Zjp2Xd.png" alt="image-20210114154435003"></p><ol><li><strong>Leader</strong>æŠŠæŒ‡ä»¤æ·»åŠ åˆ°æ—¥å¿—ä¸­ï¼Œå‘èµ· RPC ç»™å…¶ä»–çš„æœåŠ¡å™¨ï¼Œè®©ä»–ä»¬å¤åˆ¶è¿™æ¡ä¿¡æ¯</li><li><strong>Leader</strong>ä¼šä¸æ–­çš„é‡è¯•ï¼Œç›´åˆ°æ‰€æœ‰çš„ Followerå“åº”äº†ACKå¹¶å¤åˆ¶äº†æ‰€æœ‰çš„æ—¥å¿—æ¡ç›®</li><li>é€šçŸ¥æ‰€æœ‰çš„<strong>Follower</strong>æäº¤ï¼ŒåŒæ—¶Leaderè¯¥è¡¨è¿™æ¡æ—¥å¿—çš„çŠ¶æ€ï¼Œå¹¶è¿”å›ç»™å®¢æˆ·ç«¯</li></ol><h4 id="ä¸»å¤‡ï¼ˆMaster-Slaveï¼‰"><a href="#ä¸»å¤‡ï¼ˆMaster-Slaveï¼‰" class="headerlink" title="ä¸»å¤‡ï¼ˆMaster-Slaveï¼‰"></a><strong>ä¸»å¤‡ï¼ˆMaster-Slaveï¼‰</strong></h4><p>â€‹ä¸»æœºå®•æœºæ—¶ï¼Œå¤‡æœºæ¥ç®¡ä¸»æœºçš„ä¸€åˆ‡å·¥ä½œï¼Œä¸»æœºæ¢å¤æ­£å¸¸åï¼Œä»¥è‡ªåŠ¨ï¼ˆ<strong>çƒ­å¤‡</strong>ï¼‰æˆ–æ‰‹åŠ¨ï¼ˆ<strong>å†·å¤‡</strong>ï¼‰æ–¹å¼å°†æœåŠ¡åˆ‡æ¢åˆ°ä¸»æœºä¸Šè¿è¡Œï¼Œ<strong>Mysql</strong>å’Œ<strong>Redis</strong>ä¸­å¸¸ç”¨ã€‚</p><p>â€‹MySQLä¹‹é—´æ•°æ®å¤åˆ¶çš„åŸºç¡€æ˜¯<strong>äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶</strong>ï¼ˆbinary log fifileï¼‰ã€‚å®ƒçš„æ•°æ®åº“ä¸­æ‰€æœ‰æ“ä½œéƒ½ä¼šä»¥<strong>â€œäº‹ä»¶â€</strong>çš„æ–¹å¼è®°å½•åœ¨äºŒè¿›åˆ¶æ—¥å¿—ä¸­ï¼Œå…¶ä»–æ•°æ®åº“ä½œä¸ºslaveé€šè¿‡ä¸€ä¸ª<strong>I&#x2F;Oçº¿ç¨‹ä¸ä¸»æœåŠ¡å™¨ä¿æŒé€šä¿¡</strong>ï¼Œå¹¶<strong>ç›‘æ§</strong>masterçš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶çš„å˜åŒ–ï¼Œå¦‚æœå‘ç°masteräºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶<strong>å‘ç”Ÿå˜åŒ–</strong>ï¼Œåˆ™ä¼šæŠŠå˜åŒ–å¤åˆ¶åˆ°è‡ªå·±çš„<strong>ä¸­ç»§æ—¥å¿—</strong>ä¸­ï¼Œç„¶åslaveçš„ä¸€ä¸ªSQLçº¿ç¨‹ä¼šæŠŠç›¸å…³çš„â€œäº‹ä»¶â€<strong>æ‰§è¡Œ</strong>åˆ°è‡ªå·±çš„æ•°æ®åº“ä¸­ï¼Œä»¥æ­¤å®ç°ä»æ•°æ®åº“å’Œä¸»æ•°æ®åº“çš„<strong>ä¸€è‡´æ€§</strong>ï¼Œä¹Ÿå°±å®ç°äº†<strong>ä¸»ä»å¤åˆ¶</strong></p><h4 id="äº’å¤‡ï¼ˆActive-Activeï¼‰"><a href="#äº’å¤‡ï¼ˆActive-Activeï¼‰" class="headerlink" title="äº’å¤‡ï¼ˆActive-Activeï¼‰"></a><strong>äº’å¤‡ï¼ˆActive-Activeï¼‰</strong></h4><p>â€‹æŒ‡ä¸¤å°ä¸»æœº<strong>åŒæ—¶è¿è¡Œ</strong>å„è‡ªçš„æœåŠ¡å·¥ä½œä¸”<strong>ç›¸äº’ç›‘æµ‹</strong>æƒ…å†µã€‚åœ¨æ•°æ®åº“é«˜å¯ç”¨éƒ¨åˆ†ï¼Œå¸¸è§çš„äº’å¤‡æ˜¯<strong>MM</strong>æ¨¡å¼ã€‚MMæ¨¡å¼å³<strong>Multi-Master</strong>æ¨¡å¼ï¼ŒæŒ‡ä¸€ä¸ªç³»ç»Ÿå­˜åœ¨å¤šä¸ªmasterï¼Œæ¯ä¸ªmasteréƒ½å…·æœ‰<strong>read-write</strong>èƒ½åŠ›ï¼Œä¼šæ ¹æ®<strong>æ—¶é—´æˆ³</strong>æˆ–<strong>ä¸šåŠ¡é€»è¾‘</strong>åˆå¹¶ç‰ˆæœ¬ã€‚</p><h4 id="é›†ç¾¤ï¼ˆClusterï¼‰æ¨¡å¼"><a href="#é›†ç¾¤ï¼ˆClusterï¼‰æ¨¡å¼" class="headerlink" title="é›†ç¾¤ï¼ˆClusterï¼‰æ¨¡å¼"></a><strong>é›†ç¾¤ï¼ˆClusterï¼‰æ¨¡å¼</strong></h4><p>â€‹æ˜¯æŒ‡æœ‰å¤šä¸ªèŠ‚ç‚¹åœ¨è¿è¡Œï¼ŒåŒæ—¶å¯ä»¥é€šè¿‡ä¸»æ§èŠ‚ç‚¹<strong>åˆ†æ‹…æœåŠ¡</strong>è¯·æ±‚ã€‚å¦‚Zookeeperã€‚é›†ç¾¤æ¨¡å¼éœ€è¦è§£å†³ä¸»æ§èŠ‚ç‚¹<strong>æœ¬èº«çš„é«˜å¯ç”¨</strong>é—®é¢˜ï¼Œä¸€èˆ¬é‡‡ç”¨ä¸»å¤‡æ¨¡å¼ã€‚</p><h3 id="åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡"></a>åˆ†å¸ƒå¼äº‹åŠ¡</h3><h4 id="XAæ–¹æ¡ˆ-1"><a href="#XAæ–¹æ¡ˆ-1" class="headerlink" title="XAæ–¹æ¡ˆ"></a>XAæ–¹æ¡ˆ</h4><p><strong>ä¸¤é˜¶æ®µæäº¤</strong> | <strong>ä¸‰é˜¶æ®µæäº¤</strong></p><ul><li>å‡†å¤‡é˜¶æ®µçš„èµ„æºé”å®šï¼Œå­˜åœ¨æ€§èƒ½é—®é¢˜ï¼Œä¸¥é‡æ—¶ä¼šé€ æˆæ­»é”é—®é¢˜</li><li>æäº¤äº‹åŠ¡è¯·æ±‚åï¼Œå‡ºç°ç½‘ç»œå¼‚å¸¸ï¼Œéƒ¨åˆ†æ•°æ®æ”¶åˆ°å¹¶æ‰§è¡Œï¼Œä¼šé€ æˆä¸€è‡´æ€§é—®</li></ul><h4 id="TCCæ–¹æ¡ˆ"><a href="#TCCæ–¹æ¡ˆ" class="headerlink" title="TCCæ–¹æ¡ˆ"></a>TCCæ–¹æ¡ˆ</h4><p><strong>Try Confirm Cancel &#x2F; çŸ­äº‹åŠ¡</strong></p><ul><li><p><strong>Try</strong> é˜¶æ®µï¼šè¿™ä¸ªé˜¶æ®µè¯´çš„æ˜¯å¯¹å„ä¸ªæœåŠ¡çš„èµ„æºåšæ£€æµ‹ä»¥åŠå¯¹èµ„æºè¿›è¡Œ<strong>é”å®šæˆ–è€…é¢„ç•™</strong></p></li><li><p><strong>Confirm</strong> é˜¶æ®µï¼šè¿™ä¸ªé˜¶æ®µè¯´çš„æ˜¯åœ¨å„ä¸ªæœåŠ¡ä¸­<strong>æ‰§è¡Œå®é™…çš„æ“ä½œ</strong></p></li><li><p><strong>Cancel</strong> é˜¶æ®µï¼šå¦‚æœä»»ä½•ä¸€ä¸ªæœåŠ¡çš„ä¸šåŠ¡æ–¹æ³•æ‰§è¡Œå‡ºé”™ï¼Œé‚£ä¹ˆå°±éœ€è¦<strong>è¿›è¡Œè¡¥å¿</strong>&#x2F;å›æ»š</p></li></ul><h4 id="Sagaæ–¹æ¡ˆ"><a href="#Sagaæ–¹æ¡ˆ" class="headerlink" title="Sagaæ–¹æ¡ˆ"></a><strong>Sagaæ–¹æ¡ˆ</strong></h4><p>äº‹åŠ¡æ€§è¡¥å¿ &#x2F; é•¿äº‹åŠ¡</p><ul><li>æµç¨‹<strong>é•¿</strong>ã€æµç¨‹<strong>å¤š</strong>ã€è°ƒç”¨ç¬¬ä¸‰æ–¹ä¸šåŠ¡</li></ul><h4 id="æœ¬åœ°æ¶ˆæ¯è¡¨ï¼ˆeBayï¼‰"><a href="#æœ¬åœ°æ¶ˆæ¯è¡¨ï¼ˆeBayï¼‰" class="headerlink" title="æœ¬åœ°æ¶ˆæ¯è¡¨ï¼ˆeBayï¼‰"></a><strong>æœ¬åœ°æ¶ˆæ¯è¡¨ï¼ˆeBayï¼‰</strong></h4><h4 id="MQæœ€ç»ˆä¸€è‡´æ€§"><a href="#MQæœ€ç»ˆä¸€è‡´æ€§" class="headerlink" title="MQæœ€ç»ˆä¸€è‡´æ€§"></a><strong>MQæœ€ç»ˆä¸€è‡´æ€§</strong></h4><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gmr1k3dfbxj31h00pkjy8.jpg" alt="image-20210117220405706" style="zoom:50%;" /><p>æ¯”å¦‚é˜¿é‡Œçš„ RocketMQ å°±æ”¯æŒæ¶ˆæ¯äº‹åŠ¡ï¼ˆæ ¸å¿ƒï¼š<strong>åŒç«¯ç¡®è®¤ï¼Œé‡è¯•å¹‚ç­‰</strong>ï¼‰</p><ol><li>A**(è®¢å•)** ç³»ç»Ÿå…ˆå‘é€ä¸€ä¸ª <strong>prepared</strong> æ¶ˆæ¯åˆ° mqï¼Œprepared æ¶ˆæ¯å‘é€å¤±è´¥åˆ™å–æ¶ˆæ“ä½œä¸æ‰§è¡Œäº†</li><li>å‘é€æˆåŠŸåï¼Œé‚£ä¹ˆæ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼Œæ‰§è¡ŒæˆåŠŸå’Œå’Œå¤±è´¥å‘é€<strong>ç¡®è®¤å’Œå›æ»š</strong>æ¶ˆæ¯åˆ°mq</li><li>å¦‚æœå‘é€äº†ç¡®è®¤æ¶ˆæ¯ï¼Œé‚£ä¹ˆæ­¤æ—¶ B**(ä»“å‚¨)** ç³»ç»Ÿä¼šæ¥æ”¶åˆ°ç¡®è®¤æ¶ˆæ¯ï¼Œç„¶åæ‰§è¡Œæœ¬åœ°çš„äº‹åŠ¡</li><li>mq ä¼šè‡ªåŠ¨<strong>å®šæ—¶è½®è¯¢</strong>æ‰€æœ‰ prepared æ¶ˆæ¯å›è°ƒçš„æ¥å£ï¼Œç¡®è®¤äº‹åŠ¡æ‰§è¡ŒçŠ¶æ€</li><li>B çš„äº‹åŠ¡å¤±è´¥åè‡ªåŠ¨<strong>ä¸æ–­é‡è¯•</strong>ç›´åˆ°æˆåŠŸï¼Œè¾¾åˆ°ä¸€å®šæ¬¡æ•°åå‘é€æŠ¥è­¦ç”±äººå·¥æ¥<strong>æ‰‹å·¥å›æ»š</strong>å’Œ<strong>è¡¥å¿</strong></li></ol><h4 id="æœ€å¤§åŠªåŠ›é€šçŸ¥æ–¹æ¡ˆï¼ˆè®¢å•-ç§¯åˆ†ï¼‰"><a href="#æœ€å¤§åŠªåŠ›é€šçŸ¥æ–¹æ¡ˆï¼ˆè®¢å•-ç§¯åˆ†ï¼‰" class="headerlink" title="æœ€å¤§åŠªåŠ›é€šçŸ¥æ–¹æ¡ˆï¼ˆè®¢å• -&gt; ç§¯åˆ†ï¼‰"></a>æœ€å¤§åŠªåŠ›é€šçŸ¥æ–¹æ¡ˆï¼ˆè®¢å• -&gt; ç§¯åˆ†ï¼‰</h4><ol><li>ç³»ç»Ÿ A æœ¬åœ°äº‹åŠ¡æ‰§è¡Œå®Œä¹‹åï¼Œå‘é€ä¸ªæ¶ˆæ¯åˆ° MQï¼›</li><li>è¿™é‡Œä¼šæœ‰ä¸ªä¸“é—¨æ¶ˆè´¹ MQ çš„<strong>æœ€å¤§åŠªåŠ›é€šçŸ¥æœåŠ¡</strong>ï¼Œæ¥ç€è°ƒç”¨ç³»ç»Ÿ B çš„æ¥å£ï¼›</li><li>è¦æ˜¯ç³»ç»Ÿ B æ‰§è¡Œå¤±è´¥äº†ï¼Œå°±å®šæ—¶å°è¯•é‡æ–°è°ƒç”¨ç³»ç»Ÿ Bï¼Œ<strong>åå¤ N æ¬¡</strong>ï¼Œæœ€åè¿˜æ˜¯ä¸è¡Œå°±<strong>æ”¾å¼ƒ</strong></li></ol><p>ä½ æ‰¾ä¸€ä¸ªä¸¥æ ¼<strong>èµ„é‡‘</strong>è¦æ±‚ç»å¯¹ä¸èƒ½é”™çš„åœºæ™¯ï¼Œä½ å¯ä»¥è¯´ä½ æ˜¯ç”¨çš„ <strong>TCC æ–¹æ¡ˆ</strong>ï¼›</p><p>å¦‚æœæ˜¯ä¸€èˆ¬çš„åˆ†å¸ƒå¼äº‹åŠ¡åœºæ™¯ï¼Œä¾‹å¦‚<strong>ç§¯åˆ†</strong>æ•°æ®ï¼Œå¯ä»¥ç”¨å¯é æ¶ˆæ¯<strong>æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆ</strong></p><p>å¦‚æœåˆ†å¸ƒå¼åœºæ™¯<strong>å…è®¸ä¸ä¸€è‡´</strong>ï¼Œå¯ä»¥ä½¿ç”¨æœ€å¤§åŠªåŠ›é€šçŸ¥æ–¹æ¡ˆ</p><h3 id="é¢è¯•é¢˜-3"><a href="#é¢è¯•é¢˜-3" class="headerlink" title="é¢è¯•é¢˜"></a>é¢è¯•é¢˜</h3><h4 id="åˆ†å¸ƒå¼Sessionå®ç°æ–¹æ¡ˆ"><a href="#åˆ†å¸ƒå¼Sessionå®ç°æ–¹æ¡ˆ" class="headerlink" title="åˆ†å¸ƒå¼Sessionå®ç°æ–¹æ¡ˆ"></a>åˆ†å¸ƒå¼Sessionå®ç°æ–¹æ¡ˆ</h4><ul><li>åŸºäºJWTçš„Tokenï¼Œæ•°æ®ä»cacheæˆ–è€…æ•°æ®åº“ä¸­è·å–</li><li>åŸºäºTomcatçš„Redisï¼Œç®€å•é…ç½®confæ–‡ä»¶</li><li>åŸºäºSpringçš„Redisï¼Œæ”¯æŒSpringCloudå’ŒSpringb</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> é¢ç» </tag>
            
            <tag> é¢è¯•é¢˜ </tag>
            
            <tag> JavaåŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¸ƒéš†è¿‡æ»¤å™¨</title>
      <link href="/posts/9a0369ec.html"/>
      <url>/posts/9a0369ec.html</url>
      
        <content type="html"><![CDATA[<h1 id="å¸ƒéš†è¿‡æ»¤å™¨"><a href="#å¸ƒéš†è¿‡æ»¤å™¨" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨"></a>å¸ƒéš†è¿‡æ»¤å™¨</h1><p>æµ·é‡æ•°æ®å¤„ç†ä»¥åŠç¼“å­˜ç©¿é€è¿™ä¸¤ä¸ªåœºæ™¯è®©æˆ‘è®¤è¯†äº† å¸ƒéš†è¿‡æ»¤å™¨ ï¼Œæˆ‘æŸ¥é˜…äº†ä¸€äº›èµ„æ–™æ¥äº†è§£å®ƒï¼Œä½†æ˜¯å¾ˆå¤šç°æˆèµ„æ–™å¹¶ä¸æ»¡è¶³æˆ‘çš„éœ€æ±‚ï¼Œæ‰€ä»¥å°±å†³å®šè‡ªå·±æ€»ç»“ä¸€ç¯‡å…³äºå¸ƒéš†è¿‡æ»¤å™¨çš„æ–‡ç« ã€‚å¸Œæœ›é€šè¿‡è¿™ç¯‡æ–‡ç« è®©æ›´å¤šäººäº†è§£å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå¹¶ä¸”ä¼šå®é™…å»ä½¿ç”¨å®ƒï¼</p><p>ä¸‹é¢æˆ‘ä»¬å°†åˆ†ä¸ºå‡ ä¸ªæ–¹é¢æ¥ä»‹ç»å¸ƒéš†è¿‡æ»¤å™¨ï¼š</p><ol><li>ä»€ä¹ˆæ˜¯å¸ƒéš†è¿‡æ»¤å™¨ï¼Ÿ</li><li>å¸ƒéš†è¿‡æ»¤å™¨çš„åŸç†ä»‹ç»ã€‚</li><li>å¸ƒéš†è¿‡æ»¤å™¨ä½¿ç”¨åœºæ™¯ã€‚</li><li>é€šè¿‡ Java ç¼–ç¨‹æ‰‹åŠ¨å®ç°å¸ƒéš†è¿‡æ»¤å™¨ã€‚</li><li>åˆ©ç”¨ Google å¼€æºçš„ Guava ä¸­è‡ªå¸¦çš„å¸ƒéš†è¿‡æ»¤å™¨ã€‚</li><li>Redis ä¸­çš„å¸ƒéš†è¿‡æ»¤å™¨ã€‚</li></ol><span id="more"></span><h2 id="ä»€ä¹ˆæ˜¯å¸ƒéš†è¿‡æ»¤å™¨ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å¸ƒéš†è¿‡æ»¤å™¨ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å¸ƒéš†è¿‡æ»¤å™¨ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å¸ƒéš†è¿‡æ»¤å™¨ï¼Ÿ</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦äº†è§£å¸ƒéš†è¿‡æ»¤å™¨çš„æ¦‚å¿µã€‚</p><p>å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰æ˜¯ä¸€ä¸ªå«åš Bloom çš„è€å“¥äº 1970 å¹´æå‡ºçš„ã€‚æˆ‘ä»¬å¯ä»¥æŠŠå®ƒçœ‹ä½œç”±äºŒè¿›åˆ¶å‘é‡ï¼ˆæˆ–è€…è¯´ä½æ•°ç»„ï¼‰å’Œä¸€ç³»åˆ—éšæœºæ˜ å°„å‡½æ•°ï¼ˆå“ˆå¸Œå‡½æ•°ï¼‰ä¸¤éƒ¨åˆ†ç»„æˆçš„æ•°æ®ç»“æ„ã€‚ç›¸æ¯”äºæˆ‘ä»¬å¹³æ—¶å¸¸ç”¨çš„çš„ Listã€Map ã€Set ç­‰æ•°æ®ç»“æ„ï¼Œå®ƒå ç”¨ç©ºé—´æ›´å°‘å¹¶ä¸”æ•ˆç‡æ›´é«˜ï¼Œä½†æ˜¯ç¼ºç‚¹æ˜¯å…¶è¿”å›çš„ç»“æœæ˜¯æ¦‚ç‡æ€§çš„ï¼Œè€Œä¸æ˜¯éå¸¸å‡†ç¡®çš„ã€‚ç†è®ºæƒ…å†µä¸‹æ·»åŠ åˆ°é›†åˆä¸­çš„å…ƒç´ è¶Šå¤šï¼Œè¯¯æŠ¥çš„å¯èƒ½æ€§å°±è¶Šå¤§ã€‚å¹¶ä¸”ï¼Œå­˜æ”¾åœ¨å¸ƒéš†è¿‡æ»¤å™¨çš„æ•°æ®ä¸å®¹æ˜“åˆ é™¤ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021202205162212315.png" alt="å¸ƒéš†è¿‡æ»¤å™¨ç¤ºæ„å›¾"></p><p>ä½æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½åªå ç”¨ 1 bit ï¼Œå¹¶ä¸”æ¯ä¸ªå…ƒç´ åªèƒ½æ˜¯ 0 æˆ–è€… 1ã€‚è¿™æ ·ç”³è¯·ä¸€ä¸ª 100w ä¸ªå…ƒç´ çš„ä½æ•°ç»„åªå ç”¨ 1000000Bit &#x2F; 8 &#x3D; 125000 Byte &#x3D; 125000&#x2F;1024 kb â‰ˆ 122kb çš„ç©ºé—´ã€‚</p><p>æ€»ç»“ï¼š<strong>ä¸€ä¸ªåå« Bloom çš„äººæå‡ºäº†ä¸€ç§æ¥æ£€ç´¢å…ƒç´ æ˜¯å¦åœ¨ç»™å®šå¤§é›†åˆä¸­çš„æ•°æ®ç»“æ„ï¼Œè¿™ç§æ•°æ®ç»“æ„æ˜¯é«˜æ•ˆä¸”æ€§èƒ½å¾ˆå¥½çš„ï¼Œä½†ç¼ºç‚¹æ˜¯å…·æœ‰ä¸€å®šçš„é”™è¯¯è¯†åˆ«ç‡å’Œåˆ é™¤éš¾åº¦ã€‚å¹¶ä¸”ï¼Œç†è®ºæƒ…å†µä¸‹ï¼Œæ·»åŠ åˆ°é›†åˆä¸­çš„å…ƒç´ è¶Šå¤šï¼Œè¯¯æŠ¥çš„å¯èƒ½æ€§å°±è¶Šå¤§ã€‚</strong></p><h2 id="å¸ƒéš†è¿‡æ»¤å™¨çš„åŸç†ä»‹ç»"><a href="#å¸ƒéš†è¿‡æ»¤å™¨çš„åŸç†ä»‹ç»" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨çš„åŸç†ä»‹ç»"></a>å¸ƒéš†è¿‡æ»¤å™¨çš„åŸç†ä»‹ç»</h2><p><strong>å½“ä¸€ä¸ªå…ƒç´ åŠ å…¥å¸ƒéš†è¿‡æ»¤å™¨ä¸­çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</strong></p><ol><li>ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­çš„å“ˆå¸Œå‡½æ•°å¯¹å…ƒç´ å€¼è¿›è¡Œè®¡ç®—ï¼Œå¾—åˆ°å“ˆå¸Œå€¼ï¼ˆæœ‰å‡ ä¸ªå“ˆå¸Œå‡½æ•°å¾—åˆ°å‡ ä¸ªå“ˆå¸Œå€¼ï¼‰ã€‚</li><li>æ ¹æ®å¾—åˆ°çš„å“ˆå¸Œå€¼ï¼Œåœ¨ä½æ•°ç»„ä¸­æŠŠå¯¹åº”ä¸‹æ ‡çš„å€¼ç½®ä¸º 1ã€‚</li></ol><p><strong>å½“æˆ‘ä»¬éœ€è¦åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºå¸ƒéš†è¿‡æ»¤å™¨çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</strong></p><ol><li>å¯¹ç»™å®šå…ƒç´ å†æ¬¡è¿›è¡Œç›¸åŒçš„å“ˆå¸Œè®¡ç®—ï¼›</li><li>å¾—åˆ°å€¼ä¹‹ååˆ¤æ–­ä½æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ æ˜¯å¦éƒ½ä¸º 1ï¼Œå¦‚æœå€¼éƒ½ä¸º 1ï¼Œé‚£ä¹ˆè¯´æ˜è¿™ä¸ªå€¼åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œå¦‚æœå­˜åœ¨ä¸€ä¸ªå€¼ä¸ä¸º 1ï¼Œè¯´æ˜è¯¥å…ƒç´ ä¸åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ã€‚</li></ol><p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021202205162212356.png" alt="å¸ƒéš†è¿‡æ»¤å™¨hashè®¡ç®—"></p><p>å¦‚å›¾æ‰€ç¤ºï¼Œå½“å­—ç¬¦ä¸²å­˜å‚¨è¦åŠ å…¥åˆ°å¸ƒéš†è¿‡æ»¤å™¨ä¸­æ—¶ï¼Œè¯¥å­—ç¬¦ä¸²é¦–å…ˆç”±å¤šä¸ªå“ˆå¸Œå‡½æ•°ç”Ÿæˆä¸åŒçš„å“ˆå¸Œå€¼ï¼Œç„¶åå°†å¯¹åº”çš„ä½æ•°ç»„çš„ä¸‹æ ‡è®¾ç½®ä¸º 1ï¼ˆå½“ä½æ•°ç»„åˆå§‹åŒ–æ—¶ï¼Œæ‰€æœ‰ä½ç½®å‡ä¸º 0ï¼‰ã€‚å½“ç¬¬äºŒæ¬¡å­˜å‚¨ç›¸åŒå­—ç¬¦ä¸²æ—¶ï¼Œå› ä¸ºå…ˆå‰çš„å¯¹åº”ä½ç½®å·²è®¾ç½®ä¸º 1ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“çŸ¥é“æ­¤å€¼å·²ç»å­˜åœ¨ï¼ˆå»é‡éå¸¸æ–¹ä¾¿ï¼‰ã€‚</p><p>å¦‚æœæˆ‘ä»¬éœ€è¦åˆ¤æ–­æŸä¸ªå­—ç¬¦ä¸²æ˜¯å¦åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­æ—¶ï¼Œåªéœ€è¦å¯¹ç»™å®šå­—ç¬¦ä¸²å†æ¬¡è¿›è¡Œç›¸åŒçš„å“ˆå¸Œè®¡ç®—ï¼Œå¾—åˆ°å€¼ä¹‹ååˆ¤æ–­ä½æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ æ˜¯å¦éƒ½ä¸º 1ï¼Œå¦‚æœå€¼éƒ½ä¸º 1ï¼Œé‚£ä¹ˆè¯´æ˜è¿™ä¸ªå€¼åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œå¦‚æœå­˜åœ¨ä¸€ä¸ªå€¼ä¸ä¸º 1ï¼Œè¯´æ˜è¯¥å…ƒç´ ä¸åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ã€‚</p><p><strong>ä¸åŒçš„å­—ç¬¦ä¸²å¯èƒ½å“ˆå¸Œå‡ºæ¥çš„ä½ç½®ç›¸åŒï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬å¯ä»¥é€‚å½“å¢åŠ ä½æ•°ç»„å¤§å°æˆ–è€…è°ƒæ•´æˆ‘ä»¬çš„å“ˆå¸Œå‡½æ•°ã€‚</strong></p><p>ç»¼ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼š<strong>å¸ƒéš†è¿‡æ»¤å™¨è¯´æŸä¸ªå…ƒç´ å­˜åœ¨ï¼Œå°æ¦‚ç‡ä¼šè¯¯åˆ¤ã€‚å¸ƒéš†è¿‡æ»¤å™¨è¯´æŸä¸ªå…ƒç´ ä¸åœ¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå…ƒç´ ä¸€å®šä¸åœ¨ã€‚</strong></p><h2 id="å¸ƒéš†è¿‡æ»¤å™¨ä½¿ç”¨åœºæ™¯"><a href="#å¸ƒéš†è¿‡æ»¤å™¨ä½¿ç”¨åœºæ™¯" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨ä½¿ç”¨åœºæ™¯"></a>å¸ƒéš†è¿‡æ»¤å™¨ä½¿ç”¨åœºæ™¯</h2><ol><li>åˆ¤æ–­ç»™å®šæ•°æ®æ˜¯å¦å­˜åœ¨ï¼šæ¯”å¦‚åˆ¤æ–­ä¸€ä¸ªæ•°å­—æ˜¯å¦å­˜åœ¨äºåŒ…å«å¤§é‡æ•°å­—çš„æ•°å­—é›†ä¸­ï¼ˆæ•°å­—é›†å¾ˆå¤§ï¼Œ5 äº¿ä»¥ä¸Šï¼ï¼‰ã€ é˜²æ­¢ç¼“å­˜ç©¿é€ï¼ˆåˆ¤æ–­è¯·æ±‚çš„æ•°æ®æ˜¯å¦æœ‰æ•ˆé¿å…ç›´æ¥ç»•è¿‡ç¼“å­˜è¯·æ±‚æ•°æ®åº“ï¼‰ç­‰ç­‰ã€é‚®ç®±çš„åƒåœ¾é‚®ä»¶è¿‡æ»¤ã€é»‘åå•åŠŸèƒ½ç­‰ç­‰ã€‚</li><li>å»é‡ï¼šæ¯”å¦‚çˆ¬ç»™å®šç½‘å€çš„æ—¶å€™å¯¹å·²ç»çˆ¬å–è¿‡çš„ URL å»é‡ã€‚</li></ol><h2 id="ç¼–ç å®æˆ˜"><a href="#ç¼–ç å®æˆ˜" class="headerlink" title="ç¼–ç å®æˆ˜"></a>ç¼–ç å®æˆ˜</h2><h3 id="é€šè¿‡-Java-ç¼–ç¨‹æ‰‹åŠ¨å®ç°å¸ƒéš†è¿‡æ»¤å™¨"><a href="#é€šè¿‡-Java-ç¼–ç¨‹æ‰‹åŠ¨å®ç°å¸ƒéš†è¿‡æ»¤å™¨" class="headerlink" title="é€šè¿‡ Java ç¼–ç¨‹æ‰‹åŠ¨å®ç°å¸ƒéš†è¿‡æ»¤å™¨"></a>é€šè¿‡ Java ç¼–ç¨‹æ‰‹åŠ¨å®ç°å¸ƒéš†è¿‡æ»¤å™¨</h3><p>æˆ‘ä»¬ä¸Šé¢å·²ç»è¯´äº†å¸ƒéš†è¿‡æ»¤å™¨çš„åŸç†ï¼ŒçŸ¥é“äº†å¸ƒéš†è¿‡æ»¤å™¨çš„åŸç†ä¹‹åå°±å¯ä»¥è‡ªå·±æ‰‹åŠ¨å®ç°ä¸€ä¸ªäº†ã€‚</p><p>å¦‚æœä½ æƒ³è¦æ‰‹åŠ¨å®ç°ä¸€ä¸ªçš„è¯ï¼Œä½ éœ€è¦ï¼š</p><ol><li>ä¸€ä¸ªåˆé€‚å¤§å°çš„ä½æ•°ç»„ä¿å­˜æ•°æ®</li><li>å‡ ä¸ªä¸åŒçš„å“ˆå¸Œå‡½æ•°</li><li>æ·»åŠ å…ƒç´ åˆ°ä½æ•°ç»„ï¼ˆå¸ƒéš†è¿‡æ»¤å™¨ï¼‰çš„æ–¹æ³•å®ç°</li><li>åˆ¤æ–­ç»™å®šå…ƒç´ æ˜¯å¦å­˜åœ¨äºä½æ•°ç»„ï¼ˆå¸ƒéš†è¿‡æ»¤å™¨ï¼‰çš„æ–¹æ³•å®ç°ã€‚</li></ol><p>ä¸‹é¢ç»™å‡ºä¸€ä¸ªæˆ‘è§‰å¾—å†™çš„è¿˜ç®—ä¸é”™çš„ä»£ç ï¼ˆå‚è€ƒç½‘ä¸Šå·²æœ‰ä»£ç æ”¹è¿›å¾—åˆ°ï¼Œå¯¹äºæ‰€æœ‰ç±»å‹å¯¹è±¡çš†é€‚ç”¨ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.BitSet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBloomFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä½æ•°ç»„çš„å¤§å°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_SIZE</span> <span class="operator">=</span> <span class="number">2</span> &lt;&lt; <span class="number">24</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šè¿‡è¿™ä¸ªæ•°ç»„å¯ä»¥åˆ›å»º 6 ä¸ªä¸åŒçš„å“ˆå¸Œå‡½æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span>[] SEEDS = <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">3</span>, <span class="number">13</span>, <span class="number">46</span>, <span class="number">71</span>, <span class="number">91</span>, <span class="number">134</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä½æ•°ç»„ã€‚æ•°ç»„ä¸­çš„å…ƒç´ åªèƒ½æ˜¯ 0 æˆ–è€… 1</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">BitSet</span> <span class="variable">bits</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BitSet</span>(DEFAULT_SIZE);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å­˜æ”¾åŒ…å« hash å‡½æ•°çš„ç±»çš„æ•°ç»„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> SimpleHash[] func = <span class="keyword">new</span> <span class="title class_">SimpleHash</span>[SEEDS.length];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆå§‹åŒ–å¤šä¸ªåŒ…å« hash å‡½æ•°çš„ç±»çš„æ•°ç»„ï¼Œæ¯ä¸ªç±»ä¸­çš„ hash å‡½æ•°éƒ½ä¸ä¸€æ ·</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyBloomFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–å¤šä¸ªä¸åŒçš„ Hash å‡½æ•°</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; SEEDS.length; i++) &#123;</span><br><span class="line">            func[i] = <span class="keyword">new</span> <span class="title class_">SimpleHash</span>(DEFAULT_SIZE, SEEDS[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ å…ƒç´ åˆ°ä½æ•°ç»„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Object value)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (SimpleHash f : func) &#123;</span><br><span class="line">            bits.set(f.hash(value), <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­æŒ‡å®šå…ƒç´ æ˜¯å¦å­˜åœ¨äºä½æ•°ç»„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">contains</span><span class="params">(Object value)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">ret</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">for</span> (SimpleHash f : func) &#123;</span><br><span class="line">            ret = ret &amp;&amp; bits.get(f.hash(value));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é™æ€å†…éƒ¨ç±»ã€‚ç”¨äº hash æ“ä½œï¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SimpleHash</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> cap;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> seed;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">SimpleHash</span><span class="params">(<span class="type">int</span> cap, <span class="type">int</span> seed)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.cap = cap;</span><br><span class="line">            <span class="built_in">this</span>.seed = seed;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * è®¡ç®— hash å€¼</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hash</span><span class="params">(Object value)</span> &#123;</span><br><span class="line">            <span class="type">int</span> h;</span><br><span class="line">            <span class="keyword">return</span> (value == <span class="literal">null</span>) ? <span class="number">0</span> : Math.abs(seed * (cap - <span class="number">1</span>) &amp; ((h = value.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>)));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">value1</span> <span class="operator">=</span> <span class="string">&quot;https://javaguide.cn/&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">value2</span> <span class="operator">=</span> <span class="string">&quot;https://github.com/Snailclimb&quot;</span>;</span><br><span class="line"><span class="type">MyBloomFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyBloomFilter</span>();</span><br><span class="line">System.out.println(filter.contains(value1));</span><br><span class="line">System.out.println(filter.contains(value2));</span><br><span class="line">filter.add(value1);</span><br><span class="line">filter.add(value2);</span><br><span class="line">System.out.println(filter.contains(value1));</span><br><span class="line">System.out.println(filter.contains(value2));</span><br></pre></td></tr></table></figure><p>Output:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">false</span><br><span class="line">false</span><br><span class="line">true</span><br><span class="line">true</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">value1</span> <span class="operator">=</span> <span class="number">13423</span>;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">value2</span> <span class="operator">=</span> <span class="number">22131</span>;</span><br><span class="line"><span class="type">MyBloomFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyBloomFilter</span>();</span><br><span class="line">System.out.println(filter.contains(value1));</span><br><span class="line">System.out.println(filter.contains(value2));</span><br><span class="line">filter.add(value1);</span><br><span class="line">filter.add(value2);</span><br><span class="line">System.out.println(filter.contains(value1));</span><br><span class="line">System.out.println(filter.contains(value2));</span><br></pre></td></tr></table></figure><p>Output:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">false</span></span><br><span class="line"><span class="literal">false</span></span><br><span class="line"><span class="literal">true</span></span><br><span class="line"><span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="åˆ©ç”¨-Google-å¼€æºçš„-Guava-ä¸­è‡ªå¸¦çš„å¸ƒéš†è¿‡æ»¤å™¨"><a href="#åˆ©ç”¨-Google-å¼€æºçš„-Guava-ä¸­è‡ªå¸¦çš„å¸ƒéš†è¿‡æ»¤å™¨" class="headerlink" title="åˆ©ç”¨ Google å¼€æºçš„ Guava ä¸­è‡ªå¸¦çš„å¸ƒéš†è¿‡æ»¤å™¨"></a>åˆ©ç”¨ Google å¼€æºçš„ Guava ä¸­è‡ªå¸¦çš„å¸ƒéš†è¿‡æ»¤å™¨</h3><p>è‡ªå·±å®ç°çš„ç›®çš„ä¸»è¦æ˜¯ä¸ºäº†è®©è‡ªå·±ææ‡‚å¸ƒéš†è¿‡æ»¤å™¨çš„åŸç†ï¼ŒGuava ä¸­å¸ƒéš†è¿‡æ»¤å™¨çš„å®ç°ç®—æ˜¯æ¯”è¾ƒæƒå¨çš„ï¼Œæ‰€ä»¥å®é™…é¡¹ç›®ä¸­æˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨å®ç°ä¸€ä¸ªå¸ƒéš†è¿‡æ»¤å™¨ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®ä¸­å¼•å…¥ Guava çš„ä¾èµ–ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.google.guava&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;guava&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">28.0</span>-jre&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>å®é™…ä½¿ç”¨å¦‚ä¸‹ï¼š</p><p>æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæœ€å¤šå­˜æ”¾ æœ€å¤š 1500 ä¸ªæ•´æ•°çš„å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥å®¹å¿è¯¯åˆ¤çš„æ¦‚ç‡ä¸ºç™¾åˆ†ä¹‹ï¼ˆ0.01ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºå¸ƒéš†è¿‡æ»¤å™¨å¯¹è±¡</span></span><br><span class="line">BloomFilter&lt;Integer&gt; filter = BloomFilter.create(</span><br><span class="line">    Funnels.integerFunnel(),</span><br><span class="line">    <span class="number">1500</span>,</span><br><span class="line">    <span class="number">0.01</span>);</span><br><span class="line"><span class="comment">// åˆ¤æ–­æŒ‡å®šå…ƒç´ æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">System.out.println(filter.mightContain(<span class="number">1</span>));</span><br><span class="line">System.out.println(filter.mightContain(<span class="number">2</span>));</span><br><span class="line"><span class="comment">// å°†å…ƒç´ æ·»åŠ è¿›å¸ƒéš†è¿‡æ»¤å™¨</span></span><br><span class="line">filter.put(<span class="number">1</span>);</span><br><span class="line">filter.put(<span class="number">2</span>);</span><br><span class="line">System.out.println(filter.mightContain(<span class="number">1</span>));</span><br><span class="line">System.out.println(filter.mightContain(<span class="number">2</span>));</span><br></pre></td></tr></table></figure><p>åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œå½“ <code>mightContain()</code> æ–¹æ³•è¿”å› <em>true</em> æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ 99ï¼…ç¡®å®šè¯¥å…ƒç´ åœ¨è¿‡æ»¤å™¨ä¸­ï¼Œå½“è¿‡æ»¤å™¨è¿”å› <em>false</em> æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ 100ï¼…ç¡®å®šè¯¥å…ƒç´ ä¸å­˜åœ¨äºè¿‡æ»¤å™¨ä¸­ã€‚</p><p><strong>Guava æä¾›çš„å¸ƒéš†è¿‡æ»¤å™¨çš„å®ç°è¿˜æ˜¯å¾ˆä¸é”™çš„ï¼ˆæƒ³è¦è¯¦ç»†äº†è§£çš„å¯ä»¥çœ‹ä¸€ä¸‹å®ƒçš„æºç å®ç°ï¼‰ï¼Œä½†æ˜¯å®ƒæœ‰ä¸€ä¸ªé‡å¤§çš„ç¼ºé™·å°±æ˜¯åªèƒ½å•æœºä½¿ç”¨ï¼ˆå¦å¤–ï¼Œå®¹é‡æ‰©å±•ä¹Ÿä¸å®¹æ˜“ï¼‰ï¼Œè€Œç°åœ¨äº’è”ç½‘ä¸€èˆ¬éƒ½æ˜¯åˆ†å¸ƒå¼çš„åœºæ™¯ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ° Redis ä¸­çš„å¸ƒéš†è¿‡æ»¤å™¨äº†ã€‚</strong></p><h2 id="Redis-ä¸­çš„å¸ƒéš†è¿‡æ»¤å™¨"><a href="#Redis-ä¸­çš„å¸ƒéš†è¿‡æ»¤å™¨" class="headerlink" title="Redis ä¸­çš„å¸ƒéš†è¿‡æ»¤å™¨"></a>Redis ä¸­çš„å¸ƒéš†è¿‡æ»¤å™¨</h2><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p>Redis v4.0 ä¹‹åæœ‰äº† Moduleï¼ˆæ¨¡å—&#x2F;æ’ä»¶ï¼‰ åŠŸèƒ½ï¼ŒRedis Modules è®© Redis å¯ä»¥ä½¿ç”¨å¤–éƒ¨æ¨¡å—æ‰©å±•å…¶åŠŸèƒ½ ã€‚å¸ƒéš†è¿‡æ»¤å™¨å°±æ˜¯å…¶ä¸­çš„ Moduleã€‚è¯¦æƒ…å¯ä»¥æŸ¥çœ‹ Redis å®˜æ–¹å¯¹ Redis Modules çš„ä»‹ç» ï¼š<a href="https://redis.io/modules">https://redis.io/modules</a></p><p>å¦å¤–ï¼Œå®˜ç½‘æ¨èäº†ä¸€ä¸ª RedisBloom ä½œä¸º Redis å¸ƒéš†è¿‡æ»¤å™¨çš„ Moduleï¼Œåœ°å€ï¼š<a href="https://github.com/RedisBloom/RedisBloom">https://github.com/RedisBloom/RedisBloom</a><br>å…¶ä»–è¿˜æœ‰ï¼š</p><ul><li>redis-lua-scaling-bloom-filterï¼ˆlua è„šæœ¬å®ç°ï¼‰ï¼š<a href="https://github.com/erikdubbelboer/redis-lua-scaling-bloom-filter">https://github.com/erikdubbelboer/redis-lua-scaling-bloom-filter</a></li><li>pyreBloomï¼ˆPython ä¸­çš„å¿«é€Ÿ Redis å¸ƒéš†è¿‡æ»¤å™¨ï¼‰ ï¼š<a href="https://github.com/seomoz/pyreBloom">https://github.com/seomoz/pyreBloom</a></li><li>â€¦â€¦</li></ul><p>RedisBloom æä¾›äº†å¤šç§è¯­è¨€çš„å®¢æˆ·ç«¯æ”¯æŒï¼ŒåŒ…æ‹¬ï¼šPythonã€Javaã€JavaScript å’Œ PHPã€‚</p><h3 id="ä½¿ç”¨-Docker-å®‰è£…"><a href="#ä½¿ç”¨-Docker-å®‰è£…" class="headerlink" title="ä½¿ç”¨ Docker å®‰è£…"></a>ä½¿ç”¨ Docker å®‰è£…</h3><p>å¦‚æœæˆ‘ä»¬éœ€è¦ä½“éªŒ Redis ä¸­çš„å¸ƒéš†è¿‡æ»¤å™¨éå¸¸ç®€å•ï¼Œé€šè¿‡ Docker å°±å¯ä»¥äº†ï¼æˆ‘ä»¬ç›´æ¥åœ¨ Google æœç´¢ <strong>docker redis bloomfilter</strong> ç„¶ååœ¨æ’é™¤å¹¿å‘Šçš„ç¬¬ä¸€æ¡æœç´ ç»“æœå°±æ‰¾åˆ°äº†æˆ‘ä»¬æƒ³è¦çš„ç­”æ¡ˆï¼ˆè¿™æ˜¯æˆ‘å¹³å¸¸è§£å†³é—®é¢˜çš„ä¸€ç§æ–¹å¼ï¼Œåˆ†äº«ä¸€ä¸‹ï¼‰ï¼Œå…·ä½“åœ°å€ï¼š<a href="https://hub.docker.com/r/redislabs/rebloom/">https://hub.docker.com/r/redislabs/rebloom/</a> ï¼ˆä»‹ç»çš„å¾ˆè¯¦ç»† ï¼‰ã€‚</p><p><strong>å…·ä½“æ“ä½œå¦‚ä¸‹ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">âœ  ~ docker run -p 6379:6379 --name redis-redisbloom redislabs/rebloom:latest</span><br><span class="line">âœ  ~ docker exec -it redis-redisbloom bash</span><br><span class="line">root@21396d02c252:/data# redis-cli</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure><h3 id="å¸¸ç”¨å‘½ä»¤ä¸€è§ˆ"><a href="#å¸¸ç”¨å‘½ä»¤ä¸€è§ˆ" class="headerlink" title="å¸¸ç”¨å‘½ä»¤ä¸€è§ˆ"></a>å¸¸ç”¨å‘½ä»¤ä¸€è§ˆ</h3><blockquote><p>æ³¨æ„ï¼š key : å¸ƒéš†è¿‡æ»¤å™¨çš„åç§°ï¼Œitem : æ·»åŠ çš„å…ƒç´ ã€‚</p></blockquote><ol><li>**<code>BF.ADD</code>**ï¼šå°†å…ƒç´ æ·»åŠ åˆ°å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œå¦‚æœè¯¥è¿‡æ»¤å™¨å°šä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºè¯¥è¿‡æ»¤å™¨ã€‚æ ¼å¼ï¼š<code>BF.ADD &#123;key&#125; &#123;item&#125;</code>ã€‚</li><li><strong><code>BF.MADD</code></strong> : å°†ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ æ·»åŠ åˆ°â€œå¸ƒéš†è¿‡æ»¤å™¨â€ä¸­ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªå°šä¸å­˜åœ¨çš„è¿‡æ»¤å™¨ã€‚è¯¥å‘½ä»¤çš„æ“ä½œæ–¹å¼<code>BF.ADD</code>ä¸ä¹‹ç›¸åŒï¼Œåªä¸è¿‡å®ƒå…è®¸å¤šä¸ªè¾“å…¥å¹¶è¿”å›å¤šä¸ªå€¼ã€‚æ ¼å¼ï¼š<code>BF.MADD &#123;key&#125; &#123;item&#125; [item ...]</code> ã€‚</li><li><strong><code>BF.EXISTS</code></strong> : ç¡®å®šå…ƒç´ æ˜¯å¦åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­å­˜åœ¨ã€‚æ ¼å¼ï¼š<code>BF.EXISTS &#123;key&#125; &#123;item&#125;</code>ã€‚</li><li><strong><code>BF.MEXISTS</code></strong> ï¼š ç¡®å®šä¸€ä¸ªæˆ–è€…å¤šä¸ªå…ƒç´ æ˜¯å¦åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­å­˜åœ¨æ ¼å¼ï¼š<code>BF.MEXISTS &#123;key&#125; &#123;item&#125; [item ...]</code>ã€‚</li></ol><p>å¦å¤–ï¼Œ <code>BF. RESERVE</code> å‘½ä»¤éœ€è¦å•ç‹¬ä»‹ç»ä¸€ä¸‹ï¼š</p><p>è¿™ä¸ªå‘½ä»¤çš„æ ¼å¼å¦‚ä¸‹ï¼š</p><p><code>BF. RESERVE &#123;key&#125; &#123;error_rate&#125; &#123;capacity&#125; [EXPANSION expansion]</code> ã€‚</p><p>ä¸‹é¢ç®€å•ä»‹ç»ä¸€ä¸‹æ¯ä¸ªå‚æ•°çš„å…·ä½“å«ä¹‰ï¼š</p><ol><li>keyï¼šå¸ƒéš†è¿‡æ»¤å™¨çš„åç§°</li><li>error_rate : æœŸæœ›çš„è¯¯æŠ¥ç‡ã€‚è¯¥å€¼å¿…é¡»ä»‹äº 0 åˆ° 1 ä¹‹é—´ã€‚ä¾‹å¦‚ï¼Œå¯¹äºæœŸæœ›çš„è¯¯æŠ¥ç‡ 0.1ï¼…ï¼ˆ1000 ä¸­ä¸º 1ï¼‰ï¼Œerror_rate åº”è¯¥è®¾ç½®ä¸º 0.001ã€‚è¯¥æ•°å­—è¶Šæ¥è¿‘é›¶ï¼Œåˆ™æ¯ä¸ªé¡¹ç›®çš„å†…å­˜æ¶ˆè€—è¶Šå¤§ï¼Œå¹¶ä¸”æ¯ä¸ªæ“ä½œçš„ CPU ä½¿ç”¨ç‡è¶Šé«˜ã€‚</li><li>capacity: è¿‡æ»¤å™¨çš„å®¹é‡ã€‚å½“å®é™…å­˜å‚¨çš„å…ƒç´ ä¸ªæ•°è¶…è¿‡è¿™ä¸ªå€¼ä¹‹åï¼Œæ€§èƒ½å°†å¼€å§‹ä¸‹é™ã€‚å®é™…çš„é™çº§å°†å–å†³äºè¶…å‡ºé™åˆ¶çš„ç¨‹åº¦ã€‚éšç€è¿‡æ»¤å™¨å…ƒç´ æ•°é‡å‘ˆæŒ‡æ•°å¢é•¿ï¼Œæ€§èƒ½å°†çº¿æ€§ä¸‹é™ã€‚</li></ol><p>å¯é€‰å‚æ•°ï¼š</p><ul><li>expansionï¼šå¦‚æœåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å­è¿‡æ»¤å™¨ï¼Œåˆ™å…¶å¤§å°å°†æ˜¯å½“å‰è¿‡æ»¤å™¨çš„å¤§å°ä¹˜ä»¥<code>expansion</code>ã€‚é»˜è®¤æ‰©å±•å€¼ä¸º 2ã€‚è¿™æ„å‘³ç€æ¯ä¸ªåç»­å­è¿‡æ»¤å™¨å°†æ˜¯å‰ä¸€ä¸ªå­è¿‡æ»¤å™¨çš„ä¸¤å€ã€‚</li></ul><h3 id="å®é™…ä½¿ç”¨"><a href="#å®é™…ä½¿ç”¨" class="headerlink" title="å®é™…ä½¿ç”¨"></a>å®é™…ä½¿ç”¨</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; BF.ADD myFilter java</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; BF.ADD myFilter javaguide</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; BF.EXISTS myFilter java</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; BF.EXISTS myFilter javaguide</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; BF.EXISTS myFilter github</span><br><span class="line">(integer) 0</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> é¢ç» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2022é¢ç»</title>
      <link href="/posts/708d4d58.html"/>
      <url>/posts/708d4d58.html</url>
      
        <content type="html"><![CDATA[<hr><span id="more"></span><h2 id="é«˜ä»™ä¸€é¢"><a href="#é«˜ä»™ä¸€é¢" class="headerlink" title="é«˜ä»™ä¸€é¢"></a>é«˜ä»™ä¸€é¢</h2><ul><li><p>å¯¹è±¡ä¸€å®šæ˜¯åœ¨å †ä¸Šåˆ†é…çš„å—ï¼Ÿ</p><blockquote><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021202205122013107.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></blockquote></li><li><p>G1å’ŒCMSåƒåœ¾å›æ”¶å™¨çš„åŒºåˆ«ï¼Ÿ</p></li><li><p>çº¿ç¨‹æœ‰å‡ ç§çŠ¶æ€</p></li><li><p>åŠ äº†synchronizedçš„ä»£ç å—ä¸€å®šä¼šåŠ é”å—ï¼Ÿ</p></li><li><p>Thread.sleep(0)æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</p></li><li><p>åˆ†å¸ƒå¼é”æ€ä¹ˆå®ç°ï¼Ÿ</p></li><li><p>ä¸åœæœºå¦‚ä½•è¿ç§»æ•°æ®ï¼Ÿ</p></li><li><p>å¦‚ä½•ä¿è¯æ•°æ®åº“å’Œç¼“å­˜çš„ä¸€è‡´æ€§ï¼Ÿ</p></li></ul><h2 id="ä¸€çŸ¥æ™ºèƒ½"><a href="#ä¸€çŸ¥æ™ºèƒ½" class="headerlink" title="ä¸€çŸ¥æ™ºèƒ½"></a>ä¸€çŸ¥æ™ºèƒ½</h2><ul><li><p>MySQLçš„é”ï¼šæ’å®ƒé”ã€å…±äº«é”ï¼Œé€‚ç”¨åœºæ™¯</p><blockquote><p>æ’å®ƒé”ã€å…±äº«é”ï¼Œä»€ä¹ˆæ—¶å€™</p></blockquote></li><li><p>MySQLè¡Œé”å’Œè¡¨é”ï¼Œupdateæ˜¯è¡Œé”è¿˜æ˜¯è¡¨é”</p></li><li><p>MySQLä¸»ä»æ¶æ„å®¹ç¾æœºåˆ¶ï¼Œæœºå™¨æŒ‚æ‰äº†æ˜¯æ€ä¹ˆå¤„ç†ï¼Œä¸»ä»å»¶è¿Ÿäº†æ€ä¹ˆå¤„ç†</p></li><li><p>çº¿ä¸Šé—®é¢˜æ’æŸ¥</p><blockquote><p>CPUã€å†…å­˜è¿‡é«˜ï¼Œæ­»å¾ªç¯ï¼Œå†…å­˜æ³„æ¼ç­‰ç­‰</p></blockquote></li><li><p>Javaé”çš„ç§ç±»ï¼šæ‚²è§‚é”å’Œä¹è§‚é”ï¼Œä»¥åŠä½¿ç”¨åœºæ™¯</p></li><li><p>synchronizedçš„åŸç†</p></li><li><p>å¯é‡å…¥é”çš„åŸç†</p></li></ul><h2 id="æ¢è¿¹ç§‘æŠ€"><a href="#æ¢è¿¹ç§‘æŠ€" class="headerlink" title="æ¢è¿¹ç§‘æŠ€"></a>æ¢è¿¹ç§‘æŠ€</h2><ul><li><p>åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹å¼</p></li><li><p>Jdk9ã€11æ–°ç‰¹æ€§</p><blockquote><p>JDK9é»˜è®¤G1åƒåœ¾å›æ”¶å™¨ï¼›æ–°å¼•å…¥ZGC</p></blockquote></li><li><p>Javaå†…å­˜æ¨¡å‹</p></li><li><p>MQå¦‚ä½•è®¾è®¡èƒ½ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±</p><blockquote><p>ä»å‘é€ç«¯ï¼ˆbufferï¼‰ã€æœåŠ¡ç«¯ï¼ˆacksæœºåˆ¶ã€ISRæœºåˆ¶ï¼‰ã€æ¶ˆè´¹ç«¯ï¼ˆå…³é—­è‡ªåŠ¨æäº¤ï¼‰</p></blockquote></li><li><p>é›†ç¾¤é€‰ä¸¾ç®—æ³•</p><blockquote><p>RAFTåè®®ã€PAXOSåè®®ã€Zookeeperçš„FastLeaderElectionç®—æ³•</p></blockquote></li><li><p>Redisé€‰ä¸»ç”¨çš„ä»€ä¹ˆç®—æ³•ï¼Ÿ</p><blockquote><p>Raftç®—æ³•</p></blockquote></li><li><p>è®¢å•è¡¨å¦‚ä½•åˆ†åº“åˆ†è¡¨</p></li><li><p>é™æµç®—æ³•æœ‰å“ªäº›</p><blockquote><p>å›ºå®šæ»‘åŠ¨çª—å£ã€åŠ¨æ€æ»‘åŠ¨çª—å£ã€æ¼æ¡¶é™æµã€ä»¤ç‰Œæ¡¶é™æµ</p></blockquote></li></ul><h2 id="æ¢è¿¹äºŒé¢"><a href="#æ¢è¿¹äºŒé¢" class="headerlink" title="æ¢è¿¹äºŒé¢"></a>æ¢è¿¹äºŒé¢</h2><ul><li>DDDå’Œä¼ ç»Ÿå¼€å‘çš„åŒºåˆ«</li><li>åœºæ™¯é¢˜ï¼šç”¨æˆ·ä¸‹å•ï¼Œä¸‹å•æˆåŠŸä¼šæ‰£é™¤ä½™é¢å’Œçº¢åŒ…ï¼Œå¦‚æœå¤±è´¥äº†ï¼Œå¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§</li><li>å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†çš„åŒºåˆ«</li></ul><h2 id="èŒ„å­ç§‘æŠ€"><a href="#èŒ„å­ç§‘æŠ€" class="headerlink" title="èŒ„å­ç§‘æŠ€"></a>èŒ„å­ç§‘æŠ€</h2><ul><li><p>æœåŠ¡å¯ç”¨æ€§</p></li><li><p>redisä½¿ç”¨ä»€ä¹ˆé›†ç¾¤ï¼Œå¤šå°‘å°æœºå™¨ï¼›é›†ç¾¤æ¨¡å¼åŸç†ï¼ˆCRC16ï¼‰</p></li><li><p>500å°æœºå™¨æœ‰ä»€ä¹ˆé—®é¢˜</p><blockquote><p>å®ä¾‹ä¹‹é—´é€šè®¯ä¼šæœ‰å¾ˆå¤§çš„å¼€é”€ï¼Œå› ä¸ºé›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¿å­˜æ‰€æœ‰å“ˆå¸Œæ§½ä¸èŠ‚ç‚¹å¯¹åº”å…³ç³»ï¼ˆSlot æ˜ å°„åˆ°èŠ‚ç‚¹çš„è¡¨ï¼‰ï¼Œä»¥åŠè‡ªèº«çš„çŠ¶æ€ä¿¡æ¯ã€‚</p><p>gossipåè®®å¹¿æ’­æ–¹å¼ï¼ŒèŠ‚ç‚¹è¶Šå¤šï¼Œå¹¿æ’­é£æš´å¯¹äºç½‘ç»œä»¥åŠæœåŠ¡å™¨å‹åŠ›ä¹Ÿå°±è¶Šå¤§ã€‚</p><p>è™½ç„¶å¯ä»¥è®¾ç½®å¹¿æ’­æ¶ˆæ¯åŒæ­¥çš„è¶…æ—¶æ—¶é—´ï¼Œä½†æ˜¯èŠ‚ç‚¹å¢å¤šã€è¶…æ—¶æ—¶é—´å˜é•¿ä¹‹åï¼Œæ•°æ®ä¸€è‡´æ€§çš„æ¶ˆæ¯åŒæ­¥å»¶æ—¶ä¹Ÿä¼šæ›´å¤§ï¼Œå‡ºç°å…ƒæ•°æ®ä¸ä¸€è‡´çš„å¯èƒ½æ€§ä¹Ÿä¼šå¢åŠ ã€‚</p><p>redis å®˜æ–¹ç»™çš„ Redis Cluster çš„è§„æ¨¡ä¸Šé™æ˜¯ 1000 ä¸ªå®ä¾‹ã€‚</p><p>æ‰¹é‡æ“ä½œï¼ˆä¾‹å¦‚mgetç­‰ï¼‰æˆæœ¬å˜å¤§</p></blockquote></li><li><p>redisé›†ç¾¤æ‰¹é‡æ“ä½œï¼ˆå¦‚mgetï¼‰ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p><blockquote><p>éå†slot-nodeå…³ç³»ï¼Œä¾æ¬¡æ‰§è¡Œï¼Œæ¯”è¾ƒæµªè´¹æ€§èƒ½<br><a href="https://segmentfault.com/a/1190000040550883">æµ…è°ˆRedisé›†ç¾¤ä¸‹mgetçš„æ€§èƒ½é—®é¢˜ - SegmentFault æ€å¦</a></p></blockquote></li><li><p>redis clientå’Œé›†ç¾¤é€šè®¯è¿‡ç¨‹</p><blockquote><p>crc16(key)  -&gt; crc64</p></blockquote></li><li><p>redisä½¿ç”¨çš„å“ˆå¸Œç®—æ³•</p><blockquote><p>hash slot</p></blockquote></li><li><p>rediså†…å­˜æ»¡äº†å†™å…¥æ—¶ä¼šæ€ä¹ˆæ ·ï¼Œé»˜è®¤æ·˜æ±°ç­–ç•¥æ˜¯å•¥</p></li><li><p>rediså®•æœºå¯¹æœåŠ¡æœ‰ä»€ä¹ˆå½±å“ï¼Œå¦‚ä½•è§£å†³</p><blockquote><p>æœ¬åœ°ç¼“å­˜+é™æµ(hystrix)ï¼Œé˜²æ­¢æ•°æ®åº“è¢«æ‰“çˆ†</p></blockquote></li><li><p>æœ¬åœ°ç¼“å­˜å’Œredisçš„ä¸€è‡´æ€§å¦‚ä½•ä¿è¯</p><blockquote><p>etcdå¹¿æ’­</p></blockquote></li><li><p>rediså¦‚ä½•é€šè®¯çš„ï¼Œclusteræ¨¡å¼</p></li><li><p>zookeeperå’Œetcdçš„åŒºåˆ«</p></li><li><p>å¦‚ä½•ä¿è¯æœåŠ¡å¯ç”¨åº¦99.99%</p></li><li><p>mysql mvccåŸç†</p></li><li><p>ä¸ºä»€ä¹ˆé«˜å¹¶å‘æ—¶å€™æ¨èä½¿ç”¨å°äº‹åŠ¡</p><blockquote><p>undologå ç”¨ï¼›æ­»é”</p></blockquote></li><li><p>springäº‹åŠ¡å¤±æ•ˆ</p><blockquote><p>aopå¤±æ•ˆã€å¼‚æ­¥çº¿ç¨‹äº‹åŠ¡å¤±æ•ˆ</p></blockquote></li></ul><h2 id="ä»å¼¥ç§‘æŠ€"><a href="#ä»å¼¥ç§‘æŠ€" class="headerlink" title="ä»å¼¥ç§‘æŠ€"></a>ä»å¼¥ç§‘æŠ€</h2><ul><li><p>åˆ†åº“åˆ†è¡¨é—®é¢˜ï¼Œä»€ä¹ˆæ—¶å€™åˆ†åº“åˆ†è¡¨ï¼Œæ€ä¹ˆåˆ†</p></li><li><p>å¾®æœåŠ¡æ•°æ®ä¸€è‡´æ€§</p><blockquote><p>å¼ºä¸€è‡´æ€§ï¼›æœ€ç»ˆä¸€è‡´æ€§</p></blockquote></li><li><p>redisé›†ç¾¤æ¨¡å¼ï¼Œç¼“å­˜è¾ƒå¤šçš„è¯ï¼Ÿclusterå•ä¸ªèŠ‚ç‚¹å¯ä»¥åšä¸»ä»å—</p></li><li><p>MySQL ACIDæ˜¯å¦‚ä½•ä¿è¯çš„</p></li><li><p>MySQLçš„é”</p><blockquote><p>å…±äº«é”ã€ç‹¬å é”ï¼›è¡¨é”ã€è¡Œé”ï¼›é—´éš™é”</p></blockquote></li><li><p>Dubbo SPIæœºåˆ¶</p></li></ul><h2 id="å¿ƒçµå£¹ç‚¹é›¶"><a href="#å¿ƒçµå£¹ç‚¹é›¶" class="headerlink" title="å¿ƒçµå£¹ç‚¹é›¶"></a>å¿ƒçµå£¹ç‚¹é›¶</h2><ul><li><p>DDDçš„ä½¿ç”¨åœºæ™¯</p></li><li><p>DDDå¦‚ä½•åˆ’åˆ†ä¸šåŠ¡é¢†åŸŸçš„</p></li><li><p>è®¾è®¡æ¨¡å¼å‡ å¤§åŸåˆ™</p></li><li><p>è®¿é—®è€…æ¨¡å¼</p></li><li><p>JVMè°ƒä¼˜</p></li><li><p>å¤§æ•°æ®ååé€‚åˆä»€ä¹ˆåƒåœ¾å›æ”¶å™¨ï¼Ÿ</p></li><li><p>JVM 1Sèƒ½äº§ç”Ÿå¤šå°‘å¯¹è±¡</p><blockquote><p>å•æ ¸ï¼Œ1Sèƒ½äº§ç”Ÿäº¿ä¸‡çº§ï¼Œåƒåœ¾å›æ”¶å™¨1sèƒ½å›æ”¶80%</p></blockquote></li></ul><h2 id="å¤©ç¿¼äº‘"><a href="#å¤©ç¿¼äº‘" class="headerlink" title="å¤©ç¿¼äº‘"></a>å¤©ç¿¼äº‘</h2><ul><li><p>ç”Ÿæˆåˆ†å¸ƒå¼idçš„å‡ ç§æ–¹å¼</p></li><li><p>åˆ†å¸ƒå¼åœºæ™¯å¦‚ä½•ä¿è¯æ•°æ®å®‰å…¨ï¼ˆåˆ†å¸ƒå¼é”ï¼Œåˆ†å¸ƒå¼é”å¦‚ä½•é˜²æ­¢è¿‡æœŸã€å¦‚ä½•ç»­æœŸã€å¦‚æœç»­æœŸå¤±è´¥æ€ä¹ˆåŠï¼‰</p></li><li><p>Javaæœ¬åœ°é”ï¼Œå¦‚ä½•å®ç°ä¸€ä¸ªç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼ï¼Œå¦‚æœç”Ÿäº§é€Ÿåº¦å’Œæ¶ˆè´¹è€…é€Ÿåº¦ä¸å¯¹ç­‰æ€ä¹ˆåŠ</p></li><li><p>é¢‘ç¹åˆ›å»ºå¤§å¯¹è±¡çš„åœºæ™¯å¦‚ä½•ä¼˜åŒ–</p><blockquote><p>å†…å­˜å¤ç”¨ï¼Œæ€ä¹ˆæ‰èƒ½ç›´æ¥ç®¡ç†å†…å­˜ï¼Œä¸è®©ç›´æ¥å†…å­˜ç®¡ç†</p></blockquote></li><li><p>ä¿¡å·é‡æ˜¯å¹²å˜›çš„ï¼Œé€‚ç”¨åœºæ™¯</p></li><li><p>CountDownLatchè®¾ç½®ä¸º1å’Œæ‚²è§‚é”æœ‰å•¥åŒºåˆ«</p></li><li><p>ç½‘ç»œå­—èŠ‚åºåˆ—ï¼Œå¤§ç«¯ï¼Œå°ç«¯</p></li><li><p>TCPå’ŒIPæ˜¯å“ªä¸€å±‚çš„</p></li><li><p>IPåè®®æ˜¯å¹²å˜›çš„</p></li><li><p>ç”Ÿæˆnä¸ª1-nçš„éšæœºæ•°ï¼Œå¦‚ä½•ç”Ÿæˆæ•ˆç‡æœ€é«˜</p></li></ul><h2 id="ç±³å“ˆæ¸¸"><a href="#ç±³å“ˆæ¸¸" class="headerlink" title="ç±³å“ˆæ¸¸"></a>ç±³å“ˆæ¸¸</h2><ul><li><p>Dubboé»˜è®¤é€šä¿¡åè®®ï¼Œè¿˜æ”¯æŒå“ªäº›é€šä¿¡åè®®</p></li><li><p>Dubboé»˜è®¤åºåˆ—åŒ–åè®®</p></li><li><p>Dubboå¹¿æ’­è°ƒç”¨</p></li><li><p>æ³¨å†Œä¸­å¿ƒæœ‰å“ªäº›ï¼Œzkï¼Œeurkaã€nacoséƒ½æœ‰å•¥åŒºåˆ«</p></li><li><p>åˆ†å¸ƒå¼é”zkå’Œredisçš„åŒºåˆ«</p></li><li><p>zkåˆ†å¸ƒå¼é”çš„åŸç†</p></li><li><p>redisé›†ç¾¤é€šä¿¡åè®®ï¼ŒèŠ‚ç‚¹ä¹‹é—´å¦‚ä½•é€šä¿¡</p></li><li><p>selectã€pollã€epollåŒºåˆ«ï¼Œä¸ºä»€ä¹ˆè¦æœ‰epoll</p></li><li><p>redlockç®—æ³•</p></li><li><p>redisæ•°æ®ç»“æ„</p></li><li><p>mysqlé»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«</p></li><li><p>mysqlé—´éš™é”è§£å†³äº†ä»€ä¹ˆé—®é¢˜</p></li><li><p>ICPæ˜¯å¹²å˜›çš„</p></li><li><p>InnoDBèšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•åŒºåˆ«</p></li><li><p>ç´¢å¼•ä¼˜åŒ–</p></li><li><p>mysqlé«˜å¯ç”¨éƒ¨ç½²æ–¹æ¡ˆ</p></li><li><p>kafkaæ¶æ„</p></li><li><p>å¤šæ¶ˆè´¹è€…æ¶ˆè´¹åŸç†</p></li><li><p>partioné»˜è®¤å‡ ä¸ª</p><blockquote><p>kafkaè‡ªåŠ¨åˆ›å»ºtopicæ—¶è®¾ç½®é»˜è®¤çš„åˆ†åŒºå’Œå‰¯æœ¬æ•°ï¼š</p><p>åœ¨<code>server.properties</code>ä¸­é…ç½®ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è‡ªåŠ¨åˆ›å»ºä¸»é¢˜</span></span><br><span class="line"><span class="attr">auto.create.topics.enable</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"># é»˜è®¤ä¸»é¢˜çš„åˆ†åŒºæ•°</span></span><br><span class="line"><span class="attr">num.partitions</span>=<span class="string">8</span></span><br><span class="line"><span class="comment"># é»˜è®¤åˆ†åŒºå‰¯æœ¬</span></span><br><span class="line"><span class="attr">default.replication.factor</span>=<span class="string">3</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š<br><code>default.replication.factor</code>ï¼šé»˜è®¤åˆ†åŒºå‰¯æœ¬æ•°ä¸å¾—è¶…è¿‡kafkaèŠ‚ç‚¹æ•°ï¼ˆä½ æƒ³ï¼Œå‰¯æœ¬æ•°å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ”¾2ä»½ï¼Œæ„ä¹‰å°±æ²¡äº†ï¼‰</p><p>æ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦é…ç½®ï¼Œç„¶åé‡å¯å³å¯ã€‚</p></blockquote></li><li><p>system gcå’Œruntime gcåŒºåˆ«</p></li><li><p>system gcæ—¶æœºï¼ˆsafepointå’Œå®‰å…¨åŒºåŸŸï¼‰</p></li><li><p>cmsä½œä¸ºè€å¹´ä»£åƒåœ¾å›æ”¶å™¨ï¼Œä¸ºä»€ä¹ˆä¼šæ‰«ææ–°ç”Ÿä»£</p></li><li><p>æ–°ç”Ÿä»£åƒåœ¾å›æ”¶æœŸæœ‰å•¥ï¼Œæœ‰åªæ‰«æè€å¹´ä»£çš„åƒåœ¾å›æ”¶å™¨å—</p></li></ul><h2 id="è”šæ¥NIO"><a href="#è”šæ¥NIO" class="headerlink" title="è”šæ¥NIO"></a>è”šæ¥NIO</h2><ul><li><p><a href="https://leetcode.cn/problems/search-in-rotated-sorted-array/">33. æœç´¢æ—‹è½¬æ’åºæ•°ç»„</a></p></li><li><p>G1åƒåœ¾å›æ”¶å™¨çš„åŸç†ï¼Œå¦‚ä½•å›æ”¶åƒåœ¾ï¼Œå¦‚ä½•åˆ†region</p></li><li><p>synchronizedé”çš„åŸç†</p><blockquote><p>åº•å±‚æ˜¯ä½¿ç”¨monitor_enterä»¥åŠmonitor_exitå­—èŠ‚ç </p></blockquote></li><li><p>hashmapä¸ºä»€ä¹ˆè¦ç”¨çº¢é»‘æ ‘</p></li><li><p>ConcurrentHashMapæ˜¯å¦‚ä½•æ‰©å®¹çš„ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶putï¼Œæ­£å¥½é‡åˆ°æ‰©å®¹ä¸´ç•Œç‚¹ï¼Œä¼šåŒæ—¶è§¦å‘å—ï¼Ÿ</p></li><li><p>CompletableFutureå¼‚æ­¥åŸç†ï¼Œfuture.getè‡ªæ—‹çš„è¯ä¼šä¸ä¼šå¤ªæ¶ˆè€—æ€§èƒ½</p><blockquote></blockquote></li><li><p>ThreaLocalæ˜¯å¹²å˜›çš„ï¼Œä¸ºä»€ä¹ˆç”¨å®Œä¸€å®šè¦removeæ‰ï¼Œä¸removeä¼šæœ‰ä»€ä¹ˆé—®é¢˜</p><blockquote><p>å†…å­˜æ³„æ¼ï¼Œçº¿ç¨‹æ± æ•°æ®æ±¡æŸ“</p></blockquote></li><li><p>redis hashç»“æ„ï¼Œå¦‚ä½•æ‰©å®¹çš„ï¼ˆå¼‚æ­¥è¿˜æ˜¯åŒæ­¥ï¼‰ï¼Œå¦‚æœæ•°æ®é‡è¾ƒå¤§ï¼Œæ˜¯æ€ä¹ˆä¿è¯ä¸»çº¿ç¨‹ä¸å µå¡çš„</p><blockquote><p>åŒæ­¥æ‰©å®¹ï¼Œæ¸è¿›å¼è¿ç§»</p></blockquote></li><li><p>zsetè·³è¡¨çš„åŸç†</p></li><li><p>redis LRUæ·˜æ±°ç­–ç•¥æ˜¯å¦‚ä½•å®ç°çš„</p></li><li><p>redisè¿‡æœŸkeyæ˜¯å¦‚ä½•åˆ é™¤çš„ï¼ˆæƒ°æ€§åˆ é™¤å’Œå®šæ—¶åˆ é™¤ï¼‰ï¼Œå®šæ—¶åˆ é™¤å¦‚ä½•å®ç°çš„</p><blockquote><p>å®šæ—¶åˆ é™¤ç­–ç•¥ï¼šRedis é»˜è®¤ä¼šæ¯ç§’è¿›è¡Œåæ¬¡è¿‡æœŸæ‰«æï¼Œè¿‡æœŸæ‰«æä¸ä¼šéå†è¿‡æœŸå­—å…¸ä¸­æ‰€æœ‰çš„ keyï¼Œè€Œæ˜¯é‡‡ç”¨äº†ä¸€ç§ç®€å•çš„è´ªå¿ƒç­–ç•¥ã€‚</p><ol><li>ä»è¿‡æœŸå­—å…¸ä¸­éšæœº 20 ä¸ª keyï¼›</li><li>åˆ é™¤è¿™ 20 ä¸ª key ä¸­å·²ç»è¿‡æœŸçš„ keyï¼›</li><li>å¦‚æœè¿‡æœŸçš„ key æ¯”ç‡è¶…è¿‡ 1&#x2F;4ï¼Œé‚£å°±é‡å¤æ­¥éª¤ 1ï¼›</li></ol><p>åŒæ—¶ï¼Œä¸ºäº†ä¿è¯è¿‡æœŸæ‰«æä¸ä¼šå‡ºç°å¾ªç¯è¿‡åº¦ï¼Œå¯¼è‡´çº¿ç¨‹å¡æ­»ç°è±¡ï¼Œç®—æ³•è¿˜å¢åŠ äº†æ‰«ææ—¶<br>é—´çš„ä¸Šé™ï¼Œé»˜è®¤ä¸ä¼šè¶…è¿‡ 25msã€‚</p></blockquote></li><li><p>redis clusterï¼šä¸€ä¸ªkeyæ˜¯å¦‚ä½•æ‰¾åˆ°åœ¨å“ªå°æœºå™¨ä¸Šçš„ï¼›æ‰¹é‡æ“ä½œçš„åŸç†</p></li><li><p>redis CAPä¸­APæ˜¯é€šè¿‡ä»€ä¹ˆåè®®ä¿è¯çš„</p></li><li><p>kafka CPæ˜¯é€šè¿‡ä»€ä¹ˆåè®®ä¿è¯çš„</p></li><li><p>å»¶è¿Ÿæ¶ˆæ¯çš„åŸç†</p></li><li><p>æ•°æ®åº“ä¸ºä»€ä¹ˆæ¨èç”¨è‡ªå¢id</p></li><li><p>innoDBè¡Œé”æ˜¯æ€ä¹ˆåŠ é”çš„</p></li><li><p>ç§’æ€ç³»ç»Ÿè®¾è®¡</p></li><li><p>é™æµç®—æ³•</p></li><li><p>sentinelé™æµç­–ç•¥</p></li><li><p>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p></li><li><p>nacosåŸç†</p></li><li><p>http2.0æ–°ç‰¹æ€§<a href="https://juejin.cn/post/6844903984524705800">https://juejin.cn/post/6844903984524705800</a></p><blockquote><p>http1.0å’Œhttp1.1çš„ä¸»è¦åŒºåˆ«å¦‚ä¸‹ï¼š</p><ol><li>ç¼“å­˜å¤„ç†ï¼š1.1æ·»åŠ æ›´å¤šçš„ç¼“å­˜æ§åˆ¶ç­–ç•¥ï¼ˆå¦‚ï¼šEntity tagï¼ŒIf-Matchï¼‰</li><li>ç½‘ç»œè¿æ¥çš„ä¼˜åŒ–ï¼š1.1æ”¯æŒæ–­ç‚¹ç»­ä¼ </li><li>é”™è¯¯çŠ¶æ€ç çš„å¢å¤šï¼š1.1æ–°å¢äº†24ä¸ªé”™è¯¯çŠ¶æ€å“åº”ç ï¼Œä¸°å¯Œçš„é”™è¯¯ç æ›´åŠ æ˜ç¡®å„ä¸ªçŠ¶æ€</li><li>Hostå¤´å¤„ç†ï¼šæ”¯æŒHostå¤´åŸŸï¼Œä¸åœ¨ä»¥IPä¸ºè¯·æ±‚æ–¹æ ‡å¿—</li><li>é•¿è¿æ¥ï¼šå‡å°‘äº†å»ºç«‹å’Œå…³é—­è¿æ¥çš„æ¶ˆè€—å’Œå»¶è¿Ÿã€‚</li></ol><p>http1.1å’Œhttp2.0çš„ä¸»è¦åŒºåˆ«ï¼š</p><ol><li>æ–°çš„ä¼ è¾“æ ¼å¼ï¼š2.0ä½¿ç”¨äºŒè¿›åˆ¶æ ¼å¼ï¼Œ1.0ä¾ç„¶ä½¿ç”¨åŸºäºæ–‡æœ¬æ ¼å¼</li><li>å¤šè·¯å¤ç”¨ï¼šè¿æ¥å…±äº«ï¼Œä¸åŒçš„requestå¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªè¿æ¥ä¼ è¾“ï¼ˆæœ€åæ ¹æ®æ¯ä¸ªrequestä¸Šçš„idå·ç»„åˆ<br>æˆæ­£å¸¸çš„è¯·æ±‚ï¼‰</li><li>headerå‹ç¼©ï¼šç”±äº1.Xä¸­headerå¸¦æœ‰å¤§é‡çš„ä¿¡æ¯ï¼Œå¹¶ä¸”å¾—é‡å¤ä¼ è¾“ï¼Œ2.0ä½¿ç”¨encoderæ¥å‡å°‘éœ€è¦ä¼ è¾“<br>çš„hearderå¤§å°</li><li>æœåŠ¡ç«¯æ¨é€ï¼šåŒgoogleçš„SPDUYï¼ˆ1.0çš„ä¸€ç§å‡çº§ï¼‰ä¸€æ ·</li></ol></blockquote></li><li><p>æµè§ˆå™¨è¾“å…¥ä¸€ä¸ªURLï¼Œå…·ä½“å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</p><blockquote><p><strong>è¿‡ç¨‹ï¼š</strong>DNSè§£æã€TCPè¿æ¥ã€å‘é€HTTPè¯·æ±‚ã€æœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶è¿”å›HTTPæŠ¥æ–‡ã€æµè§ˆå™¨æ¸²æŸ“ã€ç»“æŸ</p><table><thead><tr><th>è¿‡ç¨‹</th><th>ä½¿ç”¨çš„åè®®</th></tr></thead><tbody><tr><td>1ã€æµè§ˆå™¨æŸ¥æ‰¾åŸŸåDNSçš„IPåœ°å€<br />DNSæŸ¥æ‰¾è¿‡ç¨‹ï¼ˆæµè§ˆå™¨ç¼“å­˜ã€è·¯ç”±å™¨ç¼“å­˜ã€DNSç¼“å­˜ï¼‰</td><td>DNSï¼šè·å–åŸŸåå¯¹åº”çš„ip</td></tr><tr><td>2ã€æ ¹æ®ipå»ºç«‹TCPè¿æ¥</td><td>TCPï¼šä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥</td></tr><tr><td>3ã€æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€HTTPè¯·æ±‚</td><td>HTTPï¼šå‘é€è¯·æ±‚</td></tr><tr><td>4ã€æœåŠ¡å™¨å“åº”HTTPå“åº”</td><td>HTTP</td></tr><tr><td>5ã€æµè§ˆå™¨è¿›è¡Œæ¸²æŸ“</td><td></td></tr></tbody></table></blockquote></li><li><p>HTTPSåŸç†</p><blockquote><p>1.é¦–å…ˆå®¢æˆ·ç«¯å…ˆç»™æœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚<br>2.æœåŠ¡å™¨å‘é€ä¸€ä¸ªSSLè¯ä¹¦ç»™å®¢æˆ·ç«¯ï¼Œå†…å®¹åŒ…æ‹¬ï¼šè¯ä¹¦çš„å‘å¸ƒæœºæ„ã€æœ‰æ•ˆæœŸã€æ‰€æœ‰è€…ã€ç­¾åä»¥åŠå…¬é’¥<br>3.å®¢æˆ·ç«¯å¯¹å‘æ¥çš„å…¬é’¥è¿›è¡ŒçœŸä¼ªæ ¡éªŒï¼Œæ ¡éªŒä¸ºçœŸåˆ™ä½¿ç”¨å…¬é’¥å¯¹å¯¹ç§°åŠ å¯†ç®—æ³•ä»¥åŠå¯¹ç§°å¯†é’¥è¿›è¡ŒåŠ å¯†<br>4.æœåŠ¡å™¨ç«¯ä½¿ç”¨ç§é’¥è¿›è¡Œè§£å¯†å¹¶ä½¿ç”¨å¯¹ç§°å¯†é’¥åŠ å¯†ç¡®è®¤ä¿¡æ¯å‘é€ç»™å®¢æˆ·ç«¯<br>5.éšåå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å°±ä½¿ç”¨å¯¹ç§°å¯†é’¥è¿›è¡Œä¿¡æ¯ä¼ è¾“</p></blockquote></li><li><p>éå¯¹ç§°åŠ å¯†å’Œå¯¹ç§°åŠ å¯†çš„åŸç†</p><blockquote><p><strong>å¯¹ç§°åŠ å¯†ç®—æ³•ï¼š</strong><br>åŒæ–¹æŒæœ‰ç›¸åŒçš„å¯†é’¥ï¼Œä¸”åŠ å¯†é€Ÿåº¦å¿«ï¼Œå…¸å‹å¯¹ç§°åŠ å¯†ç®—æ³•ï¼šDESã€AES</p><p><strong>éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼š</strong><br>å¯†é’¥æˆå¯¹å‡ºç°ï¼ˆç§é’¥ã€å…¬é’¥ï¼‰ï¼Œç§é’¥åªæœ‰è‡ªå·±çŸ¥é“ï¼Œä¸åœ¨ç½‘ç»œä¸­ä¼ è¾“ï¼›è€Œå…¬é’¥å¯ä»¥å…¬å¼€ã€‚ç›¸æ¯”å¯¹ç§°åŠ å¯†<br>é€Ÿåº¦è¾ƒæ…¢ï¼Œå…¸å‹çš„éå¯¹ç§°åŠ å¯†ç®—æ³•æœ‰ï¼šRSAã€DSA</p></blockquote></li></ul><h2 id="ç½‘æ˜“"><a href="#ç½‘æ˜“" class="headerlink" title="ç½‘æ˜“"></a>ç½‘æ˜“</h2><ul><li><p>é‡‘é¢ç±»çš„æ•°æ®å¦‚ä½•è¿ç§»</p></li><li><p>dubboæœåŠ¡æä¾›è€…çš„çº¿ç¨‹æ¨¡å‹ï¼ŒI&#x2F;Oçº¿ç¨‹æ˜¯åŸºäºçº¿ç¨‹æ± çš„å—</p></li><li><p>dubboæ³¨å†Œä¸­å¿ƒä¸å¯ç”¨ï¼Œå¦‚æœæœ¬åœ°è¯·æ±‚åˆ°äº†ä¸å¯ç”¨çš„æœºå™¨ï¼Œè¿™æ—¶å€™å¦‚ä½•ä¿è¯å¯ç”¨æ€§</p></li><li><p>dubboæœåŠ¡æ³¨å†Œå’Œbeanåˆå§‹åŒ–çš„å…ˆåé¡ºåºï¼Ÿä¼šä¸ä¼šå‡ºç°beanæ²¡æœ‰åŠ è½½å®Œï¼ŒæœåŠ¡å·²ç»æš´éœ²å‡ºå»çš„æƒ…å†µ</p></li><li><p>kafkaåŒä¸€ä¸ªtopicçš„æ•°æ®æ˜¯æ”¾åœ¨ä¸åŒbrokerä¸Šçš„å—ï¼Œæ˜¯æ€ä¹ˆé€‰å–partitionçš„</p></li><li><p>kafkaå‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œå¦‚ä½•é€šçŸ¥æ¶ˆè´¹è€…å»æ¶ˆè´¹çš„ï¼ˆæ¶ˆè´¹è€…å¦‚ä½•çŸ¥é“æ˜¯å¦å¯ä»¥æ¶ˆè´¹çš„ï¼‰</p></li><li><p>kafkaçš„offsetæ˜¯å¦‚ä½•ç»´æŠ¤çš„ï¼ˆoffsetçš„topicï¼‰ï¼Œä¸åŒçš„topicæ˜¯æ”¾åœ¨åŒä¸€ä¸ªoffset topicçš„å—</p><blockquote><p>åªæœ‰ä¸€ä¸ª_consumer_offsetä¸»é¢˜ï¼Œkeyæ˜¯Consumer Group, topic, partitionï¼ŒPayloadå­˜äº†Offset, metadata, timestamp</p><p><a href="https://juejin.cn/post/6844904016212656141">https://juejin.cn/post/6844904016212656141</a></p></blockquote></li><li><p>kafkaä¸€ä¸ªtopicï¼Œ5ä¸ªpartionï¼Œ3ä¸ªæ¶ˆè´¹è€…ï¼Œæ¶ˆè´¹è€…å¦‚ä½•åˆ†é…</p></li><li><p>ä¸‹é¢ä»£ç ä¼šå‘ç”Ÿèµ„æºç«äº‰å—ï¼ˆè¯•äº†ï¼šä¸ä¼šï¼‰</p><blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SyncTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">a</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">        Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">b</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">        Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="type">SyncTest</span> <span class="variable">syncTest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SyncTest</span>();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                syncTest.a();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                b();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote></li><li><p>äº‹åŠ¡å¤±æ•ˆåœºæ™¯ï¼Œä¸‹é¢ä»£ç åº”è¯¥æ˜¯ä¸ç”Ÿæ•ˆçš„ï¼Œ<a href="https://blog.csdn.net/dl962454/article/details/118275335">https://blog.csdn.net/dl962454/article/details/118275335</a></p><blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransactionServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">TransactionService</span> &#123;</span><br><span class="line"><span class="comment">//æ³¨å…¥daoå±‚å¯¹è±¡</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IUserDao iUserDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testA</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> num=iUserDao.updatePWDByUserName(<span class="string">&quot;hu&quot;</span>, <span class="string">&quot;3333&quot;</span>);</span><br><span class="line">        testB(<span class="string">&quot;ding&quot;</span>,<span class="string">&quot;3333&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">testB</span><span class="params">(String username, String newPassword)</span>  &#123;</span><br><span class="line">    </span><br><span class="line">        <span class="type">int</span> num=iUserDao.updatePWDByUserName(username, newPassword);</span><br><span class="line">        <span class="type">int</span> i=<span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨åŒä¸€ä¸ªç±»ä¸­çš„ä¸åŒæ–¹æ³•è°ƒç”¨ä¸­ï¼ŒAæ–¹æ³•è°ƒç”¨Bæ–¹æ³•ï¼ŒAä¸­æ— äº‹åŠ¡ï¼ŒBä¸­æœ‰äº‹åŠ¡ï¼Œæ­¤æ—¶äº‹åŠ¡ä¸ä¼šç”Ÿæ•ˆã€‚Springé‡‡ç”¨åŠ¨æ€ä»£ç†ï¼ˆAOPï¼‰å®ç°å¯¹beançš„ç®¡ç†å’Œåˆ‡ç‰‡ï¼Œå®ƒä¸ºæ¯ä¸ªclasséƒ½ä¼šç”Ÿæˆä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚åªæœ‰åœ¨ä»£ç†å¯¹è±¡ä¹‹é—´è°ƒç”¨æ—¶ï¼Œå¯ä»¥è§¦å‘åˆ‡é¢é€»è¾‘ã€‚è€ŒåŒä¸€ä¸ªclassä¸­ï¼Œæ–¹æ³•Aè°ƒç”¨æ–¹æ³•Bï¼Œä¸”æ–¹æ³•Aæ— äº‹åŠ¡ï¼Œè°ƒç”¨çš„æ˜¯åŸå¯¹è±¡çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯é€šè¿‡ä»£ç†å¯¹è±¡ï¼Œå› æ­¤Springæ— æ³•åˆ‡æ¢åˆ°è¿™æ¬¡è°ƒç”¨ï¼Œä¹Ÿå°±æ— æ³•é€šè¿‡æ³¨è§£ä¿è¯äº‹åŠ¡æ€§äº†ã€‚</p></blockquote></li><li><p>gc.logé‡Œé¢éƒ½æœ‰å•¥å†…å®¹</p></li><li><p>ygcä¼šSTWå—</p><blockquote><p>æ ¹æ®æ”¶é›†å™¨æ¥çš„å§ï¼Œç›®å‰å¹´è½»ä»£æ‰€æœ‰æ”¶é›†å™¨éƒ½ä¼šå‘ç”Ÿstwï¼Œä»æœ€å¼€å§‹çš„serialæ”¶é›†å™¨ï¼Œåˆ°ç°åœ¨çš„cmsæ”¶é›†å™¨ï¼Œè™½ç„¶ç°åœ¨è™šæ‹Ÿæœºå‚å•†å¯¹æ”¶é›†å™¨åšäº†ä¼˜åŒ–ï¼Œä½†æ˜¯stwè¿˜æ˜¯æ— æ³•å®Œå…¨é¿å…ï¼Œå¯¹ç›®å‰æ¥è¯´cmsçš„åœé¡¿æ—¶é—´æ˜¯å¯ä»¥æ¥å—çš„ï¼Œå¦‚æœç¨‹åºstwæ—¶é—´è¿‡ç¨‹ï¼Œè¿˜æ˜¯éœ€è¦ä»å…¶ä»–æ–¹é¢è€ƒè™‘ï¼Œä¾‹å¦‚ç¨‹åºæ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼ç­‰ï¼›</p></blockquote></li><li><p>é¡¹ç›®å¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹</p></li></ul><h2 id="å¤èŒ—"><a href="#å¤èŒ—" class="headerlink" title="å¤èŒ—"></a>å¤èŒ—</h2><ul><li>caffineå’ŒguavaåŒºåˆ«</li><li>äº‹åŠ¡æ¶ˆæ¯çš„åŸç†</li><li>etcdå’ŒMQå¹¿æ’­æœ‰ä»€ä¹ˆåŒºåˆ«</li></ul><h2 id="èŠ±æ——é‡‘è"><a href="#èŠ±æ——é‡‘è" class="headerlink" title="èŠ±æ——é‡‘è"></a>èŠ±æ——é‡‘è</h2><ul><li><p>æ±‚xçš„næ¬¡æ–¹ï¼Œä¸ä½¿ç”¨æ•°å­¦å…¬å¼</p></li><li><p>å–æ¨¡æ“ä½œæ€§èƒ½æœ€å¥½çš„</p><blockquote><p>x &amp; (n-1) </p></blockquote></li><li><p>æ³›å‹åŸºç±»ï¼Œå¦‚ä½•è‡ªåŠ¨å¯»æ‰¾å®ç°ç±»</p></li></ul><h2 id="æ™ºå·±æ±½è½¦"><a href="#æ™ºå·±æ±½è½¦" class="headerlink" title="æ™ºå·±æ±½è½¦"></a>æ™ºå·±æ±½è½¦</h2><ul><li><a href="https://leetcode-cn.com/problems/minimum-path-sum">64. æœ€å°è·¯å¾„å’Œ</a></li><li>å †å¤–å†…å­˜æ³„æ¼å¦‚ä½•æ’æŸ¥</li><li>K8sæ’æŸ¥oom kill</li><li>k8s podæ— é™é‡å¯å¦‚ä½•æ’æŸ¥</li><li>tcp time_wait è¿æ¥è¿‡å¤šæ’æŸ¥</li><li>redis bitmapä½¿ç”¨åœºæ™¯ã€ä¼˜åŠ¿ã€åŸç†</li></ul><h2 id="ä¼—å®‰ä¸€é¢"><a href="#ä¼—å®‰ä¸€é¢" class="headerlink" title="ä¼—å®‰ä¸€é¢"></a>ä¼—å®‰ä¸€é¢</h2><ul><li><p>æœ¬åœ°ç¼“å­˜å’Œredisä¸€è‡´æ€§</p></li><li><p>dockerè™šæ‹Ÿæœºï¼Œspringbootåº”ç”¨å†…å­˜ç¼“æ…¢å‡é«˜ï¼Œæµé‡æ­£å¸¸ï¼Œå¯èƒ½æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´çš„</p><blockquote><p>jvmå†…å­˜æº¢å‡ºæˆ–è€…å †å¤–å†…å­˜æº¢å‡º</p></blockquote></li><li><p>é™„è¿‘çš„äººæŠ€æœ¯å®ç°</p></li><li><p>kafkaé”™è¯¯é…ç½®å¯¼è‡´å†…å­˜æ³„æ¼</p></li><li><p>ç»™ä¸€äº¿ç”¨æˆ·å‘é€ä¼˜æƒ åˆ¸ï¼Œä¿è¯é€Ÿåº¦æœ€å¿«ï¼Œå¦‚ä½•è¯»å–å¦‚æ­¤å¤§çš„ç”¨æˆ·é‡</p></li></ul><h2 id="é˜¿ç»´å¡”"><a href="#é˜¿ç»´å¡”" class="headerlink" title="é˜¿ç»´å¡”"></a>é˜¿ç»´å¡”</h2><ul><li><p>ä¸€ä¸ªè¯·æ±‚ä»å‰ç«¯åˆ°æ•°æ®åº“çš„å®Œæ•´é“¾è·¯</p></li><li><p>dubboçš„ä¼˜ç¼ºç‚¹</p></li><li><p>å¦‚ä½•è®¾è®¡ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒ</p></li><li><p>ThreadLocalåŸç†</p></li><li><p>javaå¦‚ä½•åœæ­¢ä¸€ä¸ªçº¿ç¨‹</p><blockquote><p>interrupt</p></blockquote></li><li><p>çº¿ç¨‹åœ¨é˜»å¡çŠ¶æ€ä¸‹å¦‚ä½•åœæ­¢</p><blockquote><p>çº¿ç¨‹å¤–é¢interrupt + çº¿ç¨‹å†…éƒ¨åˆ¤æ–­Thread.isInterrupted()æ¥å¤„ç†</p></blockquote></li><li><p>ReentrantLockå¦‚ä½•åšåˆ°å¯é‡å…¥çš„</p></li><li><p>Listã€Setç­‰é›†åˆåº•å±‚å®ç°</p></li><li><p>äºŒå‰æ ‘çš„ä½œç”¨</p></li><li><p>SpringBooté»˜è®¤ä½œç”¨åŸŸï¼ˆå•ä¾‹ï¼‰ï¼Œä»€ä¹ˆæ—¶å€™ä¼šç”¨åˆ°å¤šä¾‹</p></li><li><p>Spring filterå’ŒintercepteråŒºåˆ«ï¼Œä»¥åŠå¸¸è§åº”ç”¨</p><blockquote></blockquote></li><li><p>ç”¨æ•°ç»„å®ç°ä¸€ä¸ªæ ˆï¼Œå‡ºæ ˆåè¿™ä¸ªå…ƒç´ ä¼šè¢«gcå›æ”¶æ‰å—ï¼Ÿä¸ºä»€ä¹ˆ</p></li><li><p>mysqlå­—æ®µä»€ä¹ˆæ—¶å€™ç”¨charï¼Œä»€ä¹ˆæ—¶å€™ç”¨varcharï¼Œå­—ç¬¦ä¸²å­—æ®µå¦‚ä½•åŠ ç´¢å¼•</p><blockquote></blockquote></li><li><p>redis zset</p></li><li><p>moogodbåº”ç”¨åœºæ™¯</p></li><li><p>å¼€å‘ä¸­å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œè´£ä»»é“¾ä¸€èˆ¬æ˜¯å¹²å˜›çš„</p></li><li><p>å•å…ƒæµ‹è¯•@beforeå’Œ@beforeClassåŒºåˆ«</p></li><li><p>JVMå¦‚ä½•è®¾ç½®å‚æ•°å°½å¯èƒ½åˆ›å»ºæ›´å¤šçš„çº¿ç¨‹</p></li><li><p>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p></li><li><p>redisè·³è¡¨åŸç†ï¼ŒæŸ¥æ‰¾å’Œä¿®æ”¹æ˜¯å¦‚ä½•æ“ä½œçš„ï¼Œä¸ºä»€ä¹ˆç”¨è·³è¡¨ï¼Œä¸ç”¨äºŒå‰æ ‘</p></li><li><p>ç”Ÿäº§redisè¶Šæ¥è¶Šæ…¢ï¼Œå¦‚ä½•æ’æŸ¥</p></li><li><p>redis bigkeyå¦‚ä½•æ²»ç†ï¼Œä¸­é—´ä»¶å±‚é¢</p></li><li><p>redis clusterå¯»å€è¿‡ç¨‹</p></li><li><p>redis clusterä¸ºä»€ä¹ˆæ˜¯65535ä¸ªæ§½ä½</p></li><li><p>redis clusterå¦‚æœhashå†²çªäº†æ€ä¹ˆåŠ</p></li><li><p>redis innodbå¼•æ“æ˜¯å¦‚ä½•è§£å†³å¹»è¯»çš„</p><blockquote><p>å¿«ç…§è¯»ï¼Œmvcc undolog</p></blockquote></li><li><p>mysqlè¡Œè®°å½•ä¸Šæœ‰å“ªäº›éšè—å­—æ®µ</p><blockquote><ul><li>trx_idï¼šæ¯æ¬¡äº‹åŠ¡å¯¹æŸæ¡èšç°‡ç´¢å¼•è®°å½•è¿›è¡Œæ”¹åŠ¨æ—¶å€™ï¼Œéƒ½ä¼šæŠŠè¯¥äº‹åŠ¡çš„äº‹åŠ¡idèµ‹å€¼ç»™trx_idåˆ—</li><li>roll_pointerï¼šæ¯æ¬¡ä¿®æ”¹å®Œï¼Œéƒ½ä¼šæŠŠæ—§ç‰ˆæœ¬å†™åˆ°undo_logé‡Œï¼Œè¿™ä¸ªéšè—åˆ—ç›¸å½“äºä¸€ä¸ªæŒ‡æ­£ï¼Œå¯ä»¥é€šè¿‡å®ƒæ¥æ‰¾åˆ°è®°å½•ä¿®æ”¹å‰çš„ä¿¡æ¯ã€‚</li></ul></blockquote></li><li><p>å½“å‰è¯»å¦‚ä½•å®ç°ï¼ˆåŠ é”ï¼‰ï¼Œä¸´é”®é”å’Œé—´éš™é”æœ‰ä»€ä¹ˆåŒºåˆ«</p></li><li><p>binlogå¥½redologéƒ½æ˜¯å¹²å•¥çš„</p></li><li><p>syncå’Œlockæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œå“ªä¸ªæ€§èƒ½å¥½</p></li><li><p>é”å‡çº§çš„è¿‡ç¨‹</p></li><li><p>èŠä¸€ä¸‹æ¯”è¾ƒå¥½çš„ä»£ç æˆ–è€…è®¾è®¡</p></li><li><p>é‡åˆ°çš„çº¿ä¸Šé—®é¢˜</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> é¢ç» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢ç» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>29è®²</title>
      <link href="/posts/22fa690f.html"/>
      <url>/posts/22fa690f.html</url>
      
        <content type="html"><![CDATA[<hr><h1 id="29-å †çš„åº”ç”¨ï¼šå¦‚ä½•å¿«é€Ÿè·å–åˆ°Top-10æœ€çƒ­é—¨çš„æœç´¢å…³é”®è¯ï¼Ÿ"><a href="#29-å †çš„åº”ç”¨ï¼šå¦‚ä½•å¿«é€Ÿè·å–åˆ°Top-10æœ€çƒ­é—¨çš„æœç´¢å…³é”®è¯ï¼Ÿ" class="headerlink" title="29 | å †çš„åº”ç”¨ï¼šå¦‚ä½•å¿«é€Ÿè·å–åˆ°Top 10æœ€çƒ­é—¨çš„æœç´¢å…³é”®è¯ï¼Ÿ"></a>29 | å †çš„åº”ç”¨ï¼šå¦‚ä½•å¿«é€Ÿè·å–åˆ°Top 10æœ€çƒ­é—¨çš„æœç´¢å…³é”®è¯ï¼Ÿ</h1><h2 id="å †çš„åº”ç”¨ä¸€ï¼šä¼˜å…ˆçº§é˜Ÿåˆ—"><a href="#å †çš„åº”ç”¨ä¸€ï¼šä¼˜å…ˆçº§é˜Ÿåˆ—" class="headerlink" title="å †çš„åº”ç”¨ä¸€ï¼šä¼˜å…ˆçº§é˜Ÿåˆ—"></a>å †çš„åº”ç”¨ä¸€ï¼šä¼˜å…ˆçº§é˜Ÿåˆ—</h2><h3 id="1-åˆå¹¶æœ‰åºå°æ–‡ä»¶"><a href="#1-åˆå¹¶æœ‰åºå°æ–‡ä»¶" class="headerlink" title="1. åˆå¹¶æœ‰åºå°æ–‡ä»¶"></a>1. åˆå¹¶æœ‰åºå°æ–‡ä»¶</h3><p>å‡è®¾æˆ‘ä»¬æœ‰ 100 ä¸ªå°æ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶çš„å¤§å°æ˜¯ 100MBï¼Œæ¯ä¸ªæ–‡ä»¶ä¸­å­˜å‚¨çš„éƒ½æ˜¯æœ‰åºçš„å­—ç¬¦ä¸²ã€‚æˆ‘ä»¬å¸Œæœ›å°†è¿™äº› 100 ä¸ªå°æ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªæœ‰åºçš„å¤§æ–‡ä»¶ã€‚è¿™é‡Œå°±ä¼šç”¨åˆ°ä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚</p><p>æ•´ä½“æ€è·¯æœ‰ç‚¹åƒå½’å¹¶æ’åºä¸­çš„åˆå¹¶å‡½æ•°ã€‚æˆ‘ä»¬ä»è¿™ 100 ä¸ªæ–‡ä»¶ä¸­ï¼Œå„å–ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ”¾å…¥æ•°ç»„ä¸­ï¼Œç„¶åæ¯”è¾ƒå¤§å°ï¼ŒæŠŠæœ€å°çš„é‚£ä¸ªå­—ç¬¦ä¸²æ”¾å…¥åˆå¹¶åçš„å¤§æ–‡ä»¶ä¸­ï¼Œå¹¶ä»æ•°ç»„ä¸­åˆ é™¤ã€‚</p><p>å‡è®¾ï¼Œè¿™ä¸ªæœ€å°çš„å­—ç¬¦ä¸²æ¥è‡ªäº 13.txt è¿™ä¸ªå°æ–‡ä»¶ï¼Œæˆ‘ä»¬å°±å†ä»è¿™ä¸ªå°æ–‡ä»¶å–ä¸‹ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ”¾åˆ°æ•°ç»„ä¸­ï¼Œé‡æ–°æ¯”è¾ƒå¤§å°ï¼Œå¹¶ä¸”é€‰æ‹©æœ€å°çš„æ”¾å…¥åˆå¹¶åçš„å¤§æ–‡ä»¶ï¼Œå°†å®ƒä»æ•°ç»„ä¸­åˆ é™¤ã€‚ä¾æ¬¡ç±»æ¨ï¼Œç›´åˆ°æ‰€æœ‰çš„æ–‡ä»¶ä¸­çš„æ•°æ®éƒ½æ”¾å…¥åˆ°å¤§æ–‡ä»¶ä¸ºæ­¢ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ç”¨æ•°ç»„è¿™ç§æ•°æ®ç»“æ„ï¼Œæ¥å­˜å‚¨ä»å°æ–‡ä»¶ä¸­å–å‡ºæ¥çš„å­—ç¬¦ä¸²ã€‚æ¯æ¬¡ä»æ•°ç»„ä¸­å–æœ€å°å­—ç¬¦ä¸²ï¼Œéƒ½éœ€è¦å¾ªç¯éå†æ•´ä¸ªæ•°ç»„ï¼Œæ˜¾ç„¶ï¼Œè¿™ä¸æ˜¯å¾ˆé«˜æ•ˆã€‚æœ‰æ²¡æœ‰æ›´åŠ é«˜æ•ˆæ–¹æ³•å‘¢ï¼Ÿ</p><p>è¿™é‡Œå°±å¯ä»¥ç”¨åˆ°ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯å †ã€‚æˆ‘ä»¬å°†ä»å°æ–‡ä»¶ä¸­å–å‡ºæ¥çš„å­—ç¬¦ä¸²æ”¾å…¥åˆ°å°é¡¶å †ä¸­ï¼Œé‚£å †é¡¶çš„å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯ä¼˜å…ˆçº§é˜Ÿåˆ—é˜Ÿé¦–çš„å…ƒç´ ï¼Œå°±æ˜¯æœ€å°çš„å­—ç¬¦ä¸²ã€‚æˆ‘ä»¬å°†è¿™ä¸ªå­—ç¬¦ä¸²æ”¾å…¥åˆ°å¤§æ–‡ä»¶ä¸­ï¼Œå¹¶å°†å…¶ä»å †ä¸­åˆ é™¤ã€‚ç„¶åå†ä»å°æ–‡ä»¶ä¸­å–å‡ºä¸‹ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ”¾å…¥åˆ°å †ä¸­ã€‚å¾ªç¯è¿™ä¸ªè¿‡ç¨‹ï¼Œå°±å¯ä»¥å°† 100 ä¸ªå°æ–‡ä»¶ä¸­çš„æ•°æ®ä¾æ¬¡æ”¾å…¥åˆ°å¤§æ–‡ä»¶ä¸­ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œåˆ é™¤å †é¡¶æ•°æ®å’Œå¾€å †ä¸­æ’å…¥æ•°æ®çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(logn)ï¼Œn è¡¨ç¤ºå †ä¸­çš„æ•°æ®ä¸ªæ•°ï¼Œè¿™é‡Œå°±æ˜¯ 100ã€‚æ˜¯ä¸æ˜¯æ¯”åŸæ¥æ•°ç»„å­˜å‚¨çš„æ–¹å¼é«˜æ•ˆäº†å¾ˆå¤šå‘¢ï¼Ÿ</p>]]></content>
      
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>28è®²</title>
      <link href="/posts/9a460e6a.html"/>
      <url>/posts/9a460e6a.html</url>
      
        <content type="html"><![CDATA[<hr><h1 id="28-å †å’Œå †æ’åºï¼šä¸ºä»€ä¹ˆè¯´å †æ’åºæ²¡æœ‰å¿«é€Ÿæ’åºå¿«ï¼Ÿ"><a href="#28-å †å’Œå †æ’åºï¼šä¸ºä»€ä¹ˆè¯´å †æ’åºæ²¡æœ‰å¿«é€Ÿæ’åºå¿«ï¼Ÿ" class="headerlink" title="28 | å †å’Œå †æ’åºï¼šä¸ºä»€ä¹ˆè¯´å †æ’åºæ²¡æœ‰å¿«é€Ÿæ’åºå¿«ï¼Ÿ"></a>28 | å †å’Œå †æ’åºï¼šä¸ºä»€ä¹ˆè¯´å †æ’åºæ²¡æœ‰å¿«é€Ÿæ’åºå¿«ï¼Ÿ</h1><h2 id="å¦‚ä½•ç†è§£â€œå †â€ï¼Ÿ"><a href="#å¦‚ä½•ç†è§£â€œå †â€ï¼Ÿ" class="headerlink" title="å¦‚ä½•ç†è§£â€œå †â€ï¼Ÿ"></a>å¦‚ä½•ç†è§£â€œå †â€ï¼Ÿ</h2><p>å‰é¢æˆ‘ä»¬æåˆ°ï¼Œå †æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ ‘ã€‚æˆ‘ä»¬ç°åœ¨å°±æ¥çœ‹çœ‹ï¼Œä»€ä¹ˆæ ·çš„æ ‘æ‰æ˜¯å †ã€‚æˆ‘ç½—åˆ—äº†ä¸¤ç‚¹è¦æ±‚ï¼Œåªè¦æ»¡è¶³è¿™ä¸¤ç‚¹ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå †ã€‚</p><ul><li>å †æ˜¯ä¸€ä¸ªå®Œå…¨äºŒå‰æ ‘ï¼›</li><li>å †ä¸­æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å¿…é¡»å¤§äºç­‰äºï¼ˆæˆ–å°äºç­‰äºï¼‰å…¶å­æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„å€¼ã€‚</li></ul><p>æˆ‘åˆ†åˆ«è§£é‡Šä¸€ä¸‹è¿™ä¸¤ç‚¹ã€‚</p><p>ç¬¬ä¸€ç‚¹ï¼Œå †å¿…é¡»æ˜¯ä¸€ä¸ªå®Œå…¨äºŒå‰æ ‘ã€‚è¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰è®²çš„å®Œå…¨äºŒå‰æ ‘çš„å®šä¹‰å—ï¼Ÿå®Œå…¨äºŒå‰æ ‘è¦æ±‚ï¼Œé™¤äº†æœ€åä¸€å±‚ï¼Œå…¶ä»–å±‚çš„èŠ‚ç‚¹ä¸ªæ•°éƒ½æ˜¯æ»¡çš„ï¼Œæœ€åä¸€å±‚çš„èŠ‚ç‚¹éƒ½é å·¦æ’åˆ—ã€‚</p><p>ç¬¬äºŒç‚¹ï¼Œå †ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹çš„å€¼å¿…é¡»å¤§äºç­‰äºï¼ˆæˆ–è€…å°äºç­‰äºï¼‰å…¶å­æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„å€¼ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ¢ä¸€ç§è¯´æ³•ï¼Œå †ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å¤§äºç­‰äºï¼ˆæˆ–è€…å°äºç­‰äºï¼‰å…¶å·¦å³å­èŠ‚ç‚¹çš„å€¼ã€‚è¿™ä¸¤ç§è¡¨è¿°æ˜¯ç­‰ä»·çš„ã€‚</p><p>å¯¹äºæ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å¤§äºç­‰äºå­æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹å€¼çš„å †ï¼Œæˆ‘ä»¬å«åšâ€œå¤§é¡¶å †â€ã€‚å¯¹äºæ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å°äºç­‰äºå­æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹å€¼çš„å †ï¼Œæˆ‘ä»¬å«åšâ€œå°é¡¶å †â€ã€‚</p><p>å®šä¹‰è§£é‡Šæ¸…æ¥šäº†ï¼Œä½ æ¥çœ‹çœ‹ï¼Œä¸‹é¢è¿™å‡ ä¸ªäºŒå‰æ ‘æ˜¯ä¸æ˜¯å †ï¼Ÿ</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021202108230804058.jpeg" alt="img"></p><p>å…¶ä¸­ç¬¬ 1 ä¸ªå’Œç¬¬ 2 ä¸ªæ˜¯å¤§é¡¶å †ï¼Œç¬¬ 3 ä¸ªæ˜¯å°é¡¶å †ï¼Œç¬¬ 4 ä¸ªä¸æ˜¯å †ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä»å›¾ä¸­è¿˜å¯ä»¥çœ‹å‡ºæ¥ï¼Œå¯¹äºåŒä¸€ç»„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºå¤šç§ä¸åŒå½¢æ€çš„å †ã€‚</p><span id="more"></span><h2 id="å¦‚ä½•å®ç°ä¸€ä¸ªå †ï¼Ÿ"><a href="#å¦‚ä½•å®ç°ä¸€ä¸ªå †ï¼Ÿ" class="headerlink" title="å¦‚ä½•å®ç°ä¸€ä¸ªå †ï¼Ÿ"></a>å¦‚ä½•å®ç°ä¸€ä¸ªå †ï¼Ÿ</h2><p>è¦å®ç°ä¸€ä¸ªå †ï¼Œæˆ‘ä»¬å…ˆè¦çŸ¥é“ï¼Œ<strong>å †éƒ½æ”¯æŒå“ªäº›æ“ä½œä»¥åŠå¦‚ä½•å­˜å‚¨ä¸€ä¸ªå †</strong>ã€‚</p><p>æˆ‘ä¹‹å‰è®²è¿‡ï¼Œå®Œå…¨äºŒå‰æ ‘æ¯”è¾ƒé€‚åˆç”¨æ•°ç»„æ¥å­˜å‚¨ã€‚ç”¨æ•°ç»„æ¥å­˜å‚¨å®Œå…¨äºŒå‰æ ‘æ˜¯éå¸¸èŠ‚çœå­˜å‚¨ç©ºé—´çš„ã€‚å› ä¸ºæˆ‘ä»¬ä¸éœ€è¦å­˜å‚¨å·¦å³å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå•çº¯åœ°é€šè¿‡æ•°ç»„çš„ä¸‹æ ‡ï¼Œå°±å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªèŠ‚ç‚¹çš„å·¦å³å­èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹ã€‚</p><p>æˆ‘ç”»äº†ä¸€ä¸ªç”¨æ•°ç»„å­˜å‚¨å †çš„ä¾‹å­ï¼Œä½ å¯ä»¥å…ˆçœ‹ä¸‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021202108230807648.jpeg" alt="img"></p><p>ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ•°ç»„ä¸­ä¸‹æ ‡ä¸º i çš„èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹ï¼Œå°±æ˜¯ä¸‹æ ‡ä¸º iâˆ—2 çš„èŠ‚ç‚¹ï¼Œå³å­èŠ‚ç‚¹å°±æ˜¯ä¸‹æ ‡ä¸º iâˆ—2+1 çš„èŠ‚ç‚¹ï¼Œçˆ¶èŠ‚ç‚¹å°±æ˜¯ä¸‹æ ‡ä¸º 2&#x2F;i çš„èŠ‚ç‚¹ã€‚</p><p>çŸ¥é“äº†å¦‚ä½•å­˜å‚¨ä¸€ä¸ªå †ï¼Œé‚£æˆ‘ä»¬å†æ¥çœ‹çœ‹ï¼Œå †ä¸Šçš„æ“ä½œæœ‰å“ªäº›å‘¢ï¼Ÿæˆ‘ç½—åˆ—äº†å‡ ä¸ªéå¸¸æ ¸å¿ƒçš„æ“ä½œï¼Œåˆ†åˆ«æ˜¯å¾€å †ä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ å’Œåˆ é™¤å †é¡¶å…ƒç´ ã€‚ï¼ˆå¦‚æœæ²¡æœ‰ç‰¹æ®Šè¯´æ˜ï¼Œæˆ‘ä¸‹é¢éƒ½æ˜¯æ‹¿å¤§é¡¶å †æ¥è®²è§£ï¼‰ã€‚</p><h3 id="1-å¾€å †ä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ "><a href="#1-å¾€å †ä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ " class="headerlink" title="1. å¾€å †ä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ "></a>1. å¾€å †ä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ </h3><p>å¾€å †ä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ åï¼Œæˆ‘ä»¬éœ€è¦ç»§ç»­æ»¡è¶³å †çš„ä¸¤ä¸ªç‰¹æ€§ã€‚</p><p>å¦‚æœæˆ‘ä»¬æŠŠæ–°æ’å…¥çš„å…ƒç´ æ”¾åˆ°å †çš„æœ€åï¼Œä½ å¯ä»¥çœ‹æˆ‘ç”»çš„è¿™ä¸ªå›¾ï¼Œæ˜¯ä¸æ˜¯ä¸ç¬¦åˆå †çš„ç‰¹æ€§äº†ï¼Ÿäºæ˜¯ï¼Œæˆ‘ä»¬å°±éœ€è¦è¿›è¡Œè°ƒæ•´ï¼Œè®©å…¶é‡æ–°æ»¡è¶³å †çš„ç‰¹æ€§ï¼Œè¿™ä¸ªè¿‡ç¨‹æˆ‘ä»¬èµ·äº†ä¸€ä¸ªåå­—ï¼Œå°±å«åš<strong>å †åŒ–</strong>ï¼ˆheapifyï¼‰ã€‚</p><p>å †åŒ–å®é™…ä¸Šæœ‰ä¸¤ç§ï¼Œä»ä¸‹å¾€ä¸Šå’Œä»ä¸Šå¾€ä¸‹ã€‚è¿™é‡Œæˆ‘å…ˆè®²<strong>ä»ä¸‹å¾€ä¸Š</strong>çš„å †åŒ–æ–¹æ³•ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021202108230812668.jpeg" alt="img"></p><p>å †åŒ–éå¸¸ç®€å•ï¼Œå°±æ˜¯é¡ºç€èŠ‚ç‚¹æ‰€åœ¨çš„è·¯å¾„ï¼Œå‘ä¸Šæˆ–è€…å‘ä¸‹ï¼Œå¯¹æ¯”ï¼Œç„¶åäº¤æ¢ã€‚</p><p>æˆ‘è¿™é‡Œç”»äº†ä¸€å¼ å †åŒ–çš„è¿‡ç¨‹åˆ†è§£å›¾ã€‚æˆ‘ä»¬å¯ä»¥è®©æ–°æ’å…¥çš„èŠ‚ç‚¹ä¸çˆ¶èŠ‚ç‚¹å¯¹æ¯”å¤§å°ã€‚å¦‚æœä¸æ»¡è¶³å­èŠ‚ç‚¹å°äºç­‰äºçˆ¶èŠ‚ç‚¹çš„å¤§å°å…³ç³»ï¼Œæˆ‘ä»¬å°±äº’æ¢ä¸¤ä¸ªèŠ‚ç‚¹ã€‚ä¸€ç›´é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°çˆ¶å­èŠ‚ç‚¹ä¹‹é—´æ»¡è¶³åˆšè¯´çš„é‚£ç§å¤§å°å…³ç³»ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021202108230812976.jpeg" alt="img"></p><p>æˆ‘å°†ä¸Šé¢è®²çš„å¾€å †ä¸­æ’å…¥æ•°æ®çš„è¿‡ç¨‹ï¼Œç¿»è¯‘æˆäº†ä»£ç ï¼Œä½ å¯ä»¥ç»“åˆç€ä¸€å—çœ‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Heap</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span>[] a; <span class="comment">// æ•°ç»„ï¼Œä»ä¸‹æ ‡1å¼€å§‹å­˜å‚¨æ•°æ®</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> n;  <span class="comment">// å †å¯ä»¥å­˜å‚¨çš„æœ€å¤§æ•°æ®ä¸ªæ•°</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> count; <span class="comment">// å †ä¸­å·²ç»å­˜å‚¨çš„æ•°æ®ä¸ªæ•°</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Heap</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">    a = <span class="keyword">new</span> <span class="title class_">int</span>[capacity + <span class="number">1</span>];</span><br><span class="line">    n = capacity;</span><br><span class="line">    count = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(<span class="type">int</span> data)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (count &gt;= n) <span class="keyword">return</span>; <span class="comment">// å †æ»¡äº†</span></span><br><span class="line">    ++count;</span><br><span class="line">    a[count] = data;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> count;</span><br><span class="line">    <span class="keyword">while</span> (i/<span class="number">2</span> &gt; <span class="number">0</span> &amp;&amp; a[i] &gt; a[i/<span class="number">2</span>]) &#123; <span class="comment">// è‡ªä¸‹å¾€ä¸Šå †åŒ–</span></span><br><span class="line">      swap(a, i, i/<span class="number">2</span>); <span class="comment">// swap()å‡½æ•°ä½œç”¨ï¼šäº¤æ¢ä¸‹æ ‡ä¸ºiå’Œi/2çš„ä¸¤ä¸ªå…ƒç´ </span></span><br><span class="line">      i = i/<span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="2-åˆ é™¤å †é¡¶å…ƒç´ "><a href="#2-åˆ é™¤å †é¡¶å…ƒç´ " class="headerlink" title="2. åˆ é™¤å †é¡¶å…ƒç´ "></a>2. åˆ é™¤å †é¡¶å…ƒç´ </h3><p>ä»å †çš„å®šä¹‰çš„ç¬¬äºŒæ¡ä¸­ï¼Œä»»ä½•èŠ‚ç‚¹çš„å€¼éƒ½å¤§äºç­‰äºï¼ˆæˆ–å°äºç­‰äºï¼‰å­æ ‘èŠ‚ç‚¹çš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå †é¡¶å…ƒç´ å­˜å‚¨çš„å°±æ˜¯å †ä¸­æ•°æ®çš„æœ€å¤§å€¼æˆ–è€…æœ€å°å€¼ã€‚</p><p>å‡è®¾æˆ‘ä»¬æ„é€ çš„æ˜¯å¤§é¡¶å †ï¼Œå †é¡¶å…ƒç´ å°±æ˜¯æœ€å¤§çš„å…ƒç´ ã€‚å½“æˆ‘ä»¬åˆ é™¤å †é¡¶å…ƒç´ ä¹‹åï¼Œå°±éœ€è¦æŠŠç¬¬äºŒå¤§çš„å…ƒç´ æ”¾åˆ°å †é¡¶ï¼Œé‚£ç¬¬äºŒå¤§å…ƒç´ è‚¯å®šä¼šå‡ºç°åœ¨å·¦å³å­èŠ‚ç‚¹ä¸­ã€‚ç„¶åæˆ‘ä»¬å†è¿­ä»£åœ°åˆ é™¤ç¬¬äºŒå¤§èŠ‚ç‚¹ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°å¶å­èŠ‚ç‚¹è¢«åˆ é™¤ã€‚</p><p>è¿™é‡Œæˆ‘ä¹Ÿç”»äº†ä¸€ä¸ªåˆ†è§£å›¾ã€‚ä¸è¿‡è¿™ç§æ–¹æ³•æœ‰ç‚¹é—®é¢˜ï¼Œå°±æ˜¯æœ€åå †åŒ–å‡ºæ¥çš„å †å¹¶ä¸æ»¡è¶³å®Œå…¨äºŒå‰æ ‘çš„ç‰¹æ€§ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021202108230813648.jpeg" alt="img"></p><p>å®é™…ä¸Šï¼Œæˆ‘ä»¬ç¨å¾®æ”¹å˜ä¸€ä¸‹æ€è·¯ï¼Œå°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä½ çœ‹æˆ‘ç”»çš„ä¸‹é¢è¿™å¹…å›¾ã€‚æˆ‘ä»¬æŠŠæœ€åä¸€ä¸ªèŠ‚ç‚¹æ”¾åˆ°å †é¡¶ï¼Œç„¶ååˆ©ç”¨åŒæ ·çš„çˆ¶å­èŠ‚ç‚¹å¯¹æ¯”æ–¹æ³•ã€‚å¯¹äºä¸æ»¡è¶³çˆ¶å­èŠ‚ç‚¹å¤§å°å…³ç³»çš„ï¼Œäº’æ¢ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”é‡å¤è¿›è¡Œè¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°çˆ¶å­èŠ‚ç‚¹ä¹‹é—´æ»¡è¶³å¤§å°å…³ç³»ä¸ºæ­¢ã€‚è¿™å°±æ˜¯<strong>ä»ä¸Šå¾€ä¸‹çš„å †åŒ–æ–¹æ³•</strong>ã€‚</p><p>å› ä¸ºæˆ‘ä»¬ç§»é™¤çš„æ˜¯æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œè€Œåœ¨å †åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œéƒ½æ˜¯äº¤æ¢æ“ä½œï¼Œä¸ä¼šå‡ºç°æ•°ç»„ä¸­çš„â€œç©ºæ´â€ï¼Œæ‰€ä»¥è¿™ç§æ–¹æ³•å †åŒ–ä¹‹åçš„ç»“æœï¼Œè‚¯å®šæ»¡è¶³å®Œå…¨äºŒå‰æ ‘çš„ç‰¹æ€§ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021202108230815478.jpeg" alt="img"></p><p>æˆ‘æŠŠä¸Šé¢çš„åˆ é™¤è¿‡ç¨‹åŒæ ·ä¹Ÿç¿»è¯‘æˆäº†ä»£ç ï¼Œè´´åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥ç»“åˆç€çœ‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeMax</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (count == <span class="number">0</span>) <span class="keyword">return</span> -<span class="number">1</span>; <span class="comment">// å †ä¸­æ²¡æœ‰æ•°æ®</span></span><br><span class="line">  a[<span class="number">1</span>] = a[count];</span><br><span class="line">  --count;</span><br><span class="line">  heapify(a, count, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">heapify</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> n, <span class="type">int</span> i)</span> &#123; <span class="comment">// è‡ªä¸Šå¾€ä¸‹å †åŒ–</span></span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">maxPos</span> <span class="operator">=</span> i;</span><br><span class="line">    <span class="keyword">if</span> (i*<span class="number">2</span> &lt;= n &amp;&amp; a[i] &lt; a[i*<span class="number">2</span>]) maxPos = i*<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (i*<span class="number">2</span>+<span class="number">1</span> &lt;= n &amp;&amp; a[maxPos] &lt; a[i*<span class="number">2</span>+<span class="number">1</span>]) maxPos = i*<span class="number">2</span>+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (maxPos == i) <span class="keyword">break</span>;</span><br><span class="line">    swap(a, i, maxPos);</span><br><span class="line">    i = maxPos;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªåŒ…å« n ä¸ªèŠ‚ç‚¹çš„å®Œå…¨äºŒå‰æ ‘ï¼Œæ ‘çš„é«˜åº¦ä¸ä¼šè¶…è¿‡ log2nã€‚å †åŒ–çš„è¿‡ç¨‹æ˜¯é¡ºç€èŠ‚ç‚¹æ‰€åœ¨è·¯å¾„æ¯”è¾ƒäº¤æ¢çš„ï¼Œæ‰€ä»¥å †åŒ–çš„æ—¶é—´å¤æ‚åº¦è·Ÿæ ‘çš„é«˜åº¦æˆæ­£æ¯”ï¼Œä¹Ÿå°±æ˜¯ O(logn)ã€‚æ’å…¥æ•°æ®å’Œåˆ é™¤å †é¡¶å…ƒç´ çš„ä¸»è¦é€»è¾‘å°±æ˜¯å †åŒ–ï¼Œæ‰€ä»¥ï¼Œå¾€å †ä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ å’Œåˆ é™¤å †é¡¶å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(logn)ã€‚</p><h2 id="å¦‚ä½•åŸºäºå †å®ç°æ’åºï¼Ÿ"><a href="#å¦‚ä½•åŸºäºå †å®ç°æ’åºï¼Ÿ" class="headerlink" title="å¦‚ä½•åŸºäºå †å®ç°æ’åºï¼Ÿ"></a>å¦‚ä½•åŸºäºå †å®ç°æ’åºï¼Ÿ</h2><p>å‰é¢æˆ‘ä»¬è®²è¿‡å¥½å‡ ç§æ’åºç®—æ³•ï¼Œæˆ‘ä»¬å†æ¥å›å¿†ä¸€ä¸‹ï¼Œæœ‰æ—¶é—´å¤æ‚åº¦æ˜¯ O(n^2) çš„å†’æ³¡æ’åºã€æ’å…¥æ’åºã€é€‰æ‹©æ’åºï¼Œæœ‰æ—¶é—´å¤æ‚åº¦æ˜¯ O(nlogn) çš„å½’å¹¶æ’åºã€å¿«é€Ÿæ’åºï¼Œè¿˜æœ‰çº¿æ€§æ’åºã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å€ŸåŠ©äºå †è¿™ç§æ•°æ®ç»“æ„å®ç°çš„æ’åºç®—æ³•ï¼Œå°±å«åšå †æ’åºã€‚è¿™ç§æ’åºæ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦éå¸¸ç¨³å®šï¼Œæ˜¯ O(nlogn)ï¼Œå¹¶ä¸”å®ƒè¿˜æ˜¯åŸåœ°æ’åºç®—æ³•ã€‚å¦‚æ­¤ä¼˜ç§€ï¼Œå®ƒæ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥æŠŠå †æ’åºçš„è¿‡ç¨‹å¤§è‡´åˆ†è§£æˆä¸¤ä¸ªå¤§çš„æ­¥éª¤ï¼Œ<strong>å»ºå †</strong>å’Œ<strong>æ’åº</strong>ã€‚</p><h3 id="1-å»ºå †"><a href="#1-å»ºå †" class="headerlink" title="1. å»ºå †"></a>1. å»ºå †</h3><p>æˆ‘ä»¬é¦–å…ˆå°†æ•°ç»„åŸåœ°å»ºæˆä¸€ä¸ªå †ã€‚æ‰€è°“â€œåŸåœ°â€å°±æ˜¯ï¼Œä¸å€ŸåŠ©å¦ä¸€ä¸ªæ•°ç»„ï¼Œå°±åœ¨åŸæ•°ç»„ä¸Šæ“ä½œã€‚å»ºå †çš„è¿‡ç¨‹ï¼Œæœ‰ä¸¤ç§æ€è·¯ã€‚</p><p>ç¬¬ä¸€ç§æ˜¯å€ŸåŠ©æˆ‘ä»¬å‰é¢è®²çš„ï¼Œåœ¨å †ä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ çš„æ€è·¯ã€‚å°½ç®¡æ•°ç»„ä¸­åŒ…å« n ä¸ªæ•°æ®ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å‡è®¾ï¼Œèµ·åˆå †ä¸­åªåŒ…å«ä¸€ä¸ªæ•°æ®ï¼Œå°±æ˜¯ä¸‹æ ‡ä¸º 1 çš„æ•°æ®ã€‚ç„¶åï¼Œæˆ‘ä»¬è°ƒç”¨å‰é¢è®²çš„æ’å…¥æ“ä½œï¼Œå°†ä¸‹æ ‡ä» 2 åˆ° n çš„æ•°æ®ä¾æ¬¡æ’å…¥åˆ°å †ä¸­ã€‚è¿™æ ·æˆ‘ä»¬å°±å°†åŒ…å« n ä¸ªæ•°æ®çš„æ•°ç»„ï¼Œç»„ç»‡æˆäº†å †ã€‚</p><p>ç¬¬äºŒç§å®ç°æ€è·¯ï¼Œè·Ÿç¬¬ä¸€ç§æˆªç„¶ç›¸åï¼Œä¹Ÿæ˜¯æˆ‘è¿™é‡Œè¦è¯¦ç»†è®²çš„ã€‚ç¬¬ä¸€ç§å»ºå †æ€è·¯çš„å¤„ç†è¿‡ç¨‹æ˜¯ä»å‰å¾€åå¤„ç†æ•°ç»„æ•°æ®ï¼Œå¹¶ä¸”æ¯ä¸ªæ•°æ®æ’å…¥å †ä¸­æ—¶ï¼Œéƒ½æ˜¯ä»ä¸‹å¾€ä¸Šå †åŒ–ã€‚è€Œç¬¬äºŒç§å®ç°æ€è·¯ï¼Œæ˜¯ä»åå¾€å‰å¤„ç†æ•°ç»„ï¼Œå¹¶ä¸”æ¯ä¸ªæ•°æ®éƒ½æ˜¯ä»ä¸Šå¾€ä¸‹å †åŒ–ã€‚</p><p>æˆ‘ä¸¾äº†ä¸€ä¸ªä¾‹å­ï¼Œå¹¶ä¸”ç”»äº†ä¸€ä¸ªç¬¬äºŒç§å®ç°æ€è·¯çš„å»ºå †åˆ†è§£æ­¥éª¤å›¾ï¼Œä½ å¯ä»¥çœ‹ä¸‹ã€‚å› ä¸ºå¶å­èŠ‚ç‚¹å¾€ä¸‹å †åŒ–åªèƒ½è‡ªå·±è·Ÿè‡ªå·±æ¯”è¾ƒï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥ä»æœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹å¼€å§‹ï¼Œä¾æ¬¡å †åŒ–å°±è¡Œäº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021202108230825569.jpeg" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021202108230825529.jpeg" alt="img"></p><p>å¯¹äºç¨‹åºå‘˜æ¥è¯´ï¼Œçœ‹ä»£ç å¯èƒ½æ›´å¥½ç†è§£ä¸€äº›ï¼Œæ‰€ä»¥ï¼Œæˆ‘å°†ç¬¬äºŒç§å®ç°æ€è·¯ç¿»è¯‘æˆäº†ä»£ç ï¼Œä½ å¯ä»¥çœ‹ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">buildHeap</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> n/<span class="number">2</span>; i &gt;= <span class="number">1</span>; --i) &#123;</span><br><span class="line">    heapify(a, n, i);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">heapify</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> n, <span class="type">int</span> i)</span> &#123;</span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">maxPos</span> <span class="operator">=</span> i;</span><br><span class="line">    <span class="keyword">if</span> (i*<span class="number">2</span> &lt;= n &amp;&amp; a[i] &lt; a[i*<span class="number">2</span>]) maxPos = i*<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (i*<span class="number">2</span>+<span class="number">1</span> &lt;= n &amp;&amp; a[maxPos] &lt; a[i*<span class="number">2</span>+<span class="number">1</span>]) maxPos = i*<span class="number">2</span>+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (maxPos == i) <span class="keyword">break</span>;</span><br><span class="line">    swap(a, i, maxPos);</span><br><span class="line">    i = maxPos;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ å¯èƒ½å·²ç»å‘ç°äº†ï¼Œåœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯¹ä¸‹æ ‡ä» 2n å¼€å§‹åˆ° 1 çš„æ•°æ®è¿›è¡Œå †åŒ–ï¼Œä¸‹æ ‡æ˜¯ 2&#x2F;n+1 åˆ° n çš„èŠ‚ç‚¹æ˜¯å¶å­èŠ‚ç‚¹ï¼Œæˆ‘ä»¬ä¸éœ€è¦å †åŒ–ã€‚å®é™…ä¸Šï¼Œå¯¹äºå®Œå…¨äºŒå‰æ ‘æ¥è¯´ï¼Œä¸‹æ ‡ä» 2&#x2F;n+1 åˆ° n çš„èŠ‚ç‚¹éƒ½æ˜¯å¶å­èŠ‚ç‚¹ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹ï¼Œå»ºå †æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘å‘¢ï¼Ÿ</p><p>æ¯ä¸ªèŠ‚ç‚¹å †åŒ–çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(logn)ï¼Œé‚£ 2n+1 ä¸ªèŠ‚ç‚¹å †åŒ–çš„æ€»æ—¶é—´å¤æ‚åº¦æ˜¯ä¸æ˜¯å°±æ˜¯ O(nlogn) å‘¢ï¼Ÿè¿™ä¸ªç­”æ¡ˆè™½ç„¶ä¹Ÿæ²¡é”™ï¼Œä½†æ˜¯è¿™ä¸ªå€¼è¿˜æ˜¯ä¸å¤Ÿç²¾ç¡®ã€‚å®é™…ä¸Šï¼Œå †æ’åºçš„å»ºå †è¿‡ç¨‹çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚æˆ‘å¸¦ä½ æ¨å¯¼ä¸€ä¸‹ã€‚</p><p>å› ä¸ºå¶å­èŠ‚ç‚¹ä¸éœ€è¦å †åŒ–ï¼Œæ‰€ä»¥éœ€è¦å †åŒ–çš„èŠ‚ç‚¹ä»å€’æ•°ç¬¬äºŒå±‚å¼€å§‹ã€‚æ¯ä¸ªèŠ‚ç‚¹å †åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦æ¯”è¾ƒå’Œäº¤æ¢çš„èŠ‚ç‚¹ä¸ªæ•°ï¼Œè·Ÿè¿™ä¸ªèŠ‚ç‚¹çš„é«˜åº¦ k æˆæ­£æ¯”ã€‚</p><p>æˆ‘æŠŠæ¯ä¸€å±‚çš„èŠ‚ç‚¹ä¸ªæ•°å’Œå¯¹åº”çš„é«˜åº¦ç”»äº†å‡ºæ¥ï¼Œä½ å¯ä»¥çœ‹çœ‹ã€‚æˆ‘ä»¬åªéœ€è¦å°†æ¯ä¸ªèŠ‚ç‚¹çš„é«˜åº¦æ±‚å’Œï¼Œå¾—å‡ºçš„å°±æ˜¯å»ºå †çš„æ—¶é—´å¤æ‚åº¦ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021202108230827411.jpeg" alt="img"></p><p>æˆ‘ä»¬å°†æ¯ä¸ªéå¶å­èŠ‚ç‚¹çš„é«˜åº¦æ±‚å’Œï¼Œå°±æ˜¯ä¸‹é¢è¿™ä¸ªå…¬å¼ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021202108230827199.jpeg" alt="img"></p><p>è¿™ä¸ªå…¬å¼çš„æ±‚è§£ç¨å¾®æœ‰ç‚¹æŠ€å·§ï¼Œä¸è¿‡æˆ‘ä»¬é«˜ä¸­åº”è¯¥éƒ½å­¦è¿‡ï¼šæŠŠå…¬å¼å·¦å³éƒ½ä¹˜ä»¥ 2ï¼Œå°±å¾—åˆ°å¦ä¸€ä¸ªå…¬å¼ S2ã€‚æˆ‘ä»¬å°† S2 é”™ä½å¯¹é½ï¼Œå¹¶ä¸”ç”¨ S2 å‡å» S1ï¼Œå¯ä»¥å¾—åˆ° Sã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021202108230827977.jpeg" alt="img"></p><p>S çš„ä¸­é—´éƒ¨åˆ†æ˜¯ä¸€ä¸ªç­‰æ¯”æ•°åˆ—ï¼Œæ‰€ä»¥æœ€åå¯ä»¥ç”¨ç­‰æ¯”æ•°åˆ—çš„æ±‚å’Œå…¬å¼æ¥è®¡ç®—ï¼Œæœ€ç»ˆçš„ç»“æœå°±æ˜¯ä¸‹é¢å›¾ä¸­ç”»çš„è¿™ä¸ªæ ·å­ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021202108230827939.jpeg" alt="img"></p><p>å› ä¸º h&#x3D;log2nï¼Œä»£å…¥å…¬å¼ Sï¼Œå°±èƒ½å¾—åˆ° S&#x3D;O(n)ï¼Œæ‰€ä»¥ï¼Œå»ºå †çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(n)ã€‚</p><h3 id="2-æ’åº"><a href="#2-æ’åº" class="headerlink" title="2. æ’åº"></a>2. æ’åº</h3><p>å»ºå †ç»“æŸä¹‹åï¼Œæ•°ç»„ä¸­çš„æ•°æ®å·²ç»æ˜¯æŒ‰ç…§å¤§é¡¶å †çš„ç‰¹æ€§æ¥ç»„ç»‡çš„ã€‚æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ å°±æ˜¯å †é¡¶ï¼Œä¹Ÿå°±æ˜¯æœ€å¤§çš„å…ƒç´ ã€‚æˆ‘ä»¬æŠŠå®ƒè·Ÿæœ€åä¸€ä¸ªå…ƒç´ äº¤æ¢ï¼Œé‚£æœ€å¤§å…ƒç´ å°±æ”¾åˆ°äº†ä¸‹æ ‡ä¸º n çš„ä½ç½®ã€‚</p><p>è¿™ä¸ªè¿‡ç¨‹æœ‰ç‚¹ç±»ä¼¼ä¸Šé¢è®²çš„â€œåˆ é™¤å †é¡¶å…ƒç´ â€çš„æ“ä½œï¼Œå½“å †é¡¶å…ƒç´ ç§»é™¤ä¹‹åï¼Œæˆ‘ä»¬æŠŠä¸‹æ ‡ä¸º n çš„å…ƒç´ æ”¾åˆ°å †é¡¶ï¼Œç„¶åå†é€šè¿‡å †åŒ–çš„æ–¹æ³•ï¼Œå°†å‰©ä¸‹çš„ nâˆ’1 ä¸ªå…ƒç´ é‡æ–°æ„å»ºæˆå †ã€‚å †åŒ–å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å†å–å †é¡¶çš„å…ƒç´ ï¼Œæ”¾åˆ°ä¸‹æ ‡æ˜¯ nâˆ’1 çš„ä½ç½®ï¼Œä¸€ç›´é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°æœ€åå †ä¸­åªå‰©ä¸‹æ ‡ä¸º 1 çš„ä¸€ä¸ªå…ƒç´ ï¼Œæ’åºå·¥ä½œå°±å®Œæˆäº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021202108230829755.jpeg" alt="img"></p><p>å †æ’åºçš„è¿‡ç¨‹ï¼Œæˆ‘ä¹Ÿç¿»è¯‘æˆäº†ä»£ç ã€‚ç»“åˆç€ä»£ç çœ‹ï¼Œä½ ç†è§£èµ·æ¥åº”è¯¥ä¼šæ›´åŠ å®¹æ˜“ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// nè¡¨ç¤ºæ•°æ®çš„ä¸ªæ•°ï¼Œæ•°ç»„aä¸­çš„æ•°æ®ä»ä¸‹æ ‡1åˆ°nçš„ä½ç½®ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">  buildHeap(a, n);</span><br><span class="line">  <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> n;</span><br><span class="line">  <span class="keyword">while</span> (k &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    swap(a, <span class="number">1</span>, k);</span><br><span class="line">    --k;</span><br><span class="line">    heapify(a, k, <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬å†æ¥åˆ†æä¸€ä¸‹å †æ’åºçš„æ—¶é—´å¤æ‚åº¦ã€ç©ºé—´å¤æ‚åº¦ä»¥åŠç¨³å®šæ€§ã€‚</p><p>æ•´ä¸ªå †æ’åºçš„è¿‡ç¨‹ï¼Œéƒ½åªéœ€è¦æä¸ªåˆ«ä¸´æ—¶å­˜å‚¨ç©ºé—´ï¼Œæ‰€ä»¥å †æ’åºæ˜¯åŸåœ°æ’åºç®—æ³•ã€‚å †æ’åºåŒ…æ‹¬å»ºå †å’Œæ’åºä¸¤ä¸ªæ“ä½œï¼Œå»ºå †è¿‡ç¨‹çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ï¼Œæ’åºè¿‡ç¨‹çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(nlogn)ï¼Œæ‰€ä»¥ï¼Œå †æ’åºæ•´ä½“çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(nlogn)ã€‚</p><p>å †æ’åºä¸æ˜¯ç¨³å®šçš„æ’åºç®—æ³•ï¼Œå› ä¸ºåœ¨æ’åºçš„è¿‡ç¨‹ï¼Œå­˜åœ¨å°†å †çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹è·Ÿå †é¡¶èŠ‚ç‚¹äº’æ¢çš„æ“ä½œï¼Œæ‰€ä»¥å°±æœ‰å¯èƒ½æ”¹å˜å€¼ç›¸åŒæ•°æ®çš„åŸå§‹ç›¸å¯¹é¡ºåºã€‚</p><p>ä»Šå¤©çš„å†…å®¹åˆ°æ­¤å°±è®²å®Œäº†ã€‚æˆ‘è¿™é‡Œè¦ç¨å¾®è§£é‡Šä¸€ä¸‹ï¼Œåœ¨å‰é¢çš„è®²è§£ä»¥åŠä»£ç ä¸­ï¼Œæˆ‘éƒ½å‡è®¾ï¼Œå †ä¸­çš„æ•°æ®æ˜¯ä»æ•°ç»„ä¸‹æ ‡ä¸º 1 çš„ä½ç½®å¼€å§‹å­˜å‚¨ã€‚é‚£å¦‚æœä» 0 å¼€å§‹å­˜å‚¨ï¼Œå®é™…ä¸Šå¤„ç†æ€è·¯æ˜¯æ²¡æœ‰ä»»ä½•å˜åŒ–çš„ï¼Œå”¯ä¸€å˜åŒ–çš„ï¼Œå¯èƒ½å°±æ˜¯ï¼Œä»£ç å®ç°çš„æ—¶å€™ï¼Œè®¡ç®—å­èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹çš„ä¸‹æ ‡çš„å…¬å¼æ”¹å˜äº†ã€‚</p><p>å¦‚æœèŠ‚ç‚¹çš„ä¸‹æ ‡æ˜¯ iï¼Œé‚£å·¦å­èŠ‚ç‚¹çš„ä¸‹æ ‡å°±æ˜¯ 2âˆ—i+1ï¼Œå³å­èŠ‚ç‚¹çš„ä¸‹æ ‡å°±æ˜¯ 2âˆ—i+2ï¼Œçˆ¶èŠ‚ç‚¹çš„ä¸‹æ ‡å°±æ˜¯ (i-1)&#x2F;2ã€‚</p><h2 id="è§£ç­”å¼€ç¯‡"><a href="#è§£ç­”å¼€ç¯‡" class="headerlink" title="è§£ç­”å¼€ç¯‡"></a>è§£ç­”å¼€ç¯‡</h2><p>ç°åœ¨æˆ‘ä»¬æ¥çœ‹å¼€ç¯‡çš„é—®é¢˜ï¼Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸ºä»€ä¹ˆå¿«é€Ÿæ’åºè¦æ¯”å †æ’åºæ€§èƒ½å¥½ï¼Ÿ</p><p>æˆ‘è§‰å¾—ä¸»è¦æœ‰ä¸¤æ–¹é¢çš„åŸå› ã€‚</p><p><strong>ç¬¬ä¸€ç‚¹ï¼Œå †æ’åºæ•°æ®è®¿é—®çš„æ–¹å¼æ²¡æœ‰å¿«é€Ÿæ’åºå‹å¥½</strong>ã€‚</p><p>å¯¹äºå¿«é€Ÿæ’åºæ¥è¯´ï¼Œæ•°æ®æ˜¯é¡ºåºè®¿é—®çš„ã€‚è€Œå¯¹äºå †æ’åºæ¥è¯´ï¼Œæ•°æ®æ˜¯è·³ç€è®¿é—®çš„ã€‚ æ¯”å¦‚ï¼Œå †æ’åºä¸­ï¼Œæœ€é‡è¦çš„ä¸€ä¸ªæ“ä½œå°±æ˜¯æ•°æ®çš„å †åŒ–ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œå¯¹å †é¡¶èŠ‚ç‚¹è¿›è¡Œå †åŒ–ï¼Œä¼šä¾æ¬¡è®¿é—®æ•°ç»„ä¸‹æ ‡æ˜¯ 1ï¼Œ2ï¼Œ4ï¼Œ8 çš„å…ƒç´ ï¼Œè€Œä¸æ˜¯åƒå¿«é€Ÿæ’åºé‚£æ ·ï¼Œå±€éƒ¨é¡ºåºè®¿é—®ï¼Œæ‰€ä»¥ï¼Œè¿™æ ·å¯¹ CPU ç¼“å­˜æ˜¯ä¸å‹å¥½çš„ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021202108230832920.jpeg" alt="img"></p><p><strong>ç¬¬äºŒç‚¹ï¼Œå¯¹äºåŒæ ·çš„æ•°æ®ï¼Œåœ¨æ’åºè¿‡ç¨‹ä¸­ï¼Œå †æ’åºç®—æ³•çš„æ•°æ®äº¤æ¢æ¬¡æ•°è¦å¤šäºå¿«é€Ÿæ’åº</strong>ã€‚</p><p>æˆ‘ä»¬åœ¨è®²æ’åºçš„æ—¶å€™ï¼Œæè¿‡ä¸¤ä¸ªæ¦‚å¿µï¼Œæœ‰åºåº¦å’Œé€†åºåº¦ã€‚å¯¹äºåŸºäºæ¯”è¾ƒçš„æ’åºç®—æ³•æ¥è¯´ï¼Œæ•´ä¸ªæ’åºè¿‡ç¨‹å°±æ˜¯ç”±ä¸¤ä¸ªåŸºæœ¬çš„æ“ä½œç»„æˆçš„ï¼Œæ¯”è¾ƒå’Œäº¤æ¢ï¼ˆæˆ–ç§»åŠ¨ï¼‰ã€‚å¿«é€Ÿæ’åºæ•°æ®äº¤æ¢çš„æ¬¡æ•°ä¸ä¼šæ¯”é€†åºåº¦å¤šã€‚</p><p>ä½†æ˜¯å †æ’åºçš„ç¬¬ä¸€æ­¥æ˜¯å»ºå †ï¼Œå»ºå †çš„è¿‡ç¨‹ä¼šæ‰“ä¹±æ•°æ®åŸæœ‰çš„ç›¸å¯¹å…ˆåé¡ºåºï¼Œå¯¼è‡´åŸæ•°æ®çš„æœ‰åºåº¦é™ä½ã€‚æ¯”å¦‚ï¼Œå¯¹äºä¸€ç»„å·²ç»æœ‰åºçš„æ•°æ®æ¥è¯´ï¼Œç»è¿‡å»ºå †ä¹‹åï¼Œæ•°æ®åè€Œå˜å¾—æ›´æ— åºäº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021202108230833773.jpeg" alt="img"></p><p>å¯¹äºç¬¬äºŒç‚¹ï¼Œä½ å¯ä»¥è‡ªå·±åšä¸ªè¯•éªŒçœ‹ä¸‹ã€‚æˆ‘ä»¬ç”¨ä¸€ä¸ªè®°å½•äº¤æ¢æ¬¡æ•°çš„å˜é‡ï¼Œåœ¨ä»£ç ä¸­ï¼Œæ¯æ¬¡äº¤æ¢çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯¹è¿™ä¸ªå˜é‡åŠ ä¸€ï¼Œæ’åºå®Œæˆä¹‹åï¼Œè¿™ä¸ªå˜é‡çš„å€¼å°±æ˜¯æ€»çš„æ•°æ®äº¤æ¢æ¬¡æ•°ã€‚è¿™æ ·ä½ å°±èƒ½å¾ˆç›´è§‚åœ°ç†è§£æˆ‘åˆšåˆšè¯´çš„ï¼Œå †æ’åºæ¯”å¿«é€Ÿæ’åºäº¤æ¢æ¬¡æ•°å¤šã€‚</p><h2 id="å†…å®¹å°ç»“"><a href="#å†…å®¹å°ç»“" class="headerlink" title="å†…å®¹å°ç»“"></a>å†…å®¹å°ç»“</h2><p>ä»Šå¤©æˆ‘ä»¬è®²äº†å †è¿™ç§æ•°æ®ç»“æ„ã€‚å †æ˜¯ä¸€ç§å®Œå…¨äºŒå‰æ ‘ã€‚å®ƒæœ€å¤§çš„ç‰¹æ€§æ˜¯ï¼šæ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å¤§äºç­‰äºï¼ˆæˆ–å°äºç­‰äºï¼‰å…¶å­æ ‘èŠ‚ç‚¹çš„å€¼ã€‚å› æ­¤ï¼Œå †è¢«åˆ†æˆäº†ä¸¤ç±»ï¼Œå¤§é¡¶å †å’Œå°é¡¶å †ã€‚</p><p>å †ä¸­æ¯”è¾ƒé‡è¦çš„ä¸¤ä¸ªæ“ä½œæ˜¯æ’å…¥ä¸€ä¸ªæ•°æ®å’Œåˆ é™¤å †é¡¶å…ƒç´ ã€‚è¿™ä¸¤ä¸ªæ“ä½œéƒ½è¦ç”¨åˆ°å †åŒ–ã€‚æ’å…¥ä¸€ä¸ªæ•°æ®çš„æ—¶å€™ï¼Œæˆ‘ä»¬æŠŠæ–°æ’å…¥çš„æ•°æ®æ”¾åˆ°æ•°ç»„çš„æœ€åï¼Œç„¶åä»ä¸‹å¾€ä¸Šå †åŒ–ï¼›åˆ é™¤å †é¡¶æ•°æ®çš„æ—¶å€™ï¼Œæˆ‘ä»¬æŠŠæ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ æ”¾åˆ°å †é¡¶ï¼Œç„¶åä»ä¸Šå¾€ä¸‹å †åŒ–ã€‚è¿™ä¸¤ä¸ªæ“ä½œæ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(logn)ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜è®²äº†å †çš„ä¸€ä¸ªç»å…¸åº”ç”¨ï¼Œå †æ’åºã€‚å †æ’åºåŒ…å«ä¸¤ä¸ªè¿‡ç¨‹ï¼Œå»ºå †å’Œæ’åºã€‚æˆ‘ä»¬å°†ä¸‹æ ‡ä» 2&#x2F;n åˆ° 1 çš„èŠ‚ç‚¹ï¼Œä¾æ¬¡è¿›è¡Œä»ä¸Šåˆ°ä¸‹çš„å †åŒ–æ“ä½œï¼Œç„¶åå°±å¯ä»¥å°†æ•°ç»„ä¸­çš„æ•°æ®ç»„ç»‡æˆå †è¿™ç§æ•°æ®ç»“æ„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¿­ä»£åœ°å°†å †é¡¶çš„å…ƒç´ æ”¾åˆ°å †çš„æœ«å°¾ï¼Œå¹¶å°†å †çš„å¤§å°å‡ä¸€ï¼Œç„¶åå†å †åŒ–ï¼Œé‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°å †ä¸­åªå‰©ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œæ•´ä¸ªæ•°ç»„ä¸­çš„æ•°æ®å°±éƒ½æœ‰åºæ’åˆ—äº†ã€‚</p><h2 id="è¯¾åæ€è€ƒ"><a href="#è¯¾åæ€è€ƒ" class="headerlink" title="è¯¾åæ€è€ƒ"></a>è¯¾åæ€è€ƒ</h2><ol><li><p>åœ¨è®²å †æ’åºå»ºå †çš„æ—¶å€™ï¼Œæˆ‘è¯´åˆ°ï¼Œå¯¹äºå®Œå…¨äºŒå‰æ ‘æ¥è¯´ï¼Œä¸‹æ ‡ä» n&#x2F;2+1 åˆ° n çš„éƒ½æ˜¯å¶å­èŠ‚ç‚¹ï¼Œè¿™ä¸ªç»“è®ºæ˜¯æ€ä¹ˆæ¨å¯¼å‡ºæ¥çš„å‘¢ï¼Ÿ</p><blockquote><p>ä½¿ç”¨æ•°ç»„å­˜å‚¨è¡¨ç¤ºå®Œå…¨äºŒå‰æ ‘æ—¶ï¼Œä»æ•°ç»„ä¸‹æ ‡ä¸º1å¼€å§‹å­˜å‚¨æ•°æ®ï¼Œæ•°ç»„ä¸‹æ ‡ä¸ºiçš„èŠ‚ç‚¹ï¼Œå·¦å­èŠ‚ç‚¹ä¸º2i, å³å­èŠ‚ç‚¹ä¸º2i + 1. è¿™ä¸ªç»“è®ºå¾ˆé‡è¦ï¼ˆå¯ä»¥ç”¨æ•°å­¦å½’çº³æ³•è¯æ˜)ï¼Œå°†æ­¤ç»“è®ºè®°ä¸ºã€åŸç†1ã€ï¼Œä»¥ä¸‹è¯æ˜ä¼šç”¨åˆ°è¿™ä¸ªåŸç†ã€‚</p><p>ä¸ºä»€ä¹ˆï¼Œå¯¹äºå®Œå…¨äºŒå‰æ ‘æ¥è¯´ï¼Œä¸‹æ ‡ä»n&#x2F;2 + 1 åˆ° nçš„èŠ‚ç‚¹éƒ½æ˜¯å¶å­èŠ‚ç‚¹ï¼Ÿ ä½¿ç”¨åè¯æ³•è¯æ˜å³å¯ï¼š</p><p>å¦‚æœä¸‹æ ‡ä¸ºn&#x2F;2 + 1çš„èŠ‚ç‚¹ä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œå³å®ƒå­˜åœ¨å­èŠ‚ç‚¹ï¼ŒæŒ‰ç…§ã€åŸç†1ã€ï¼Œå®ƒçš„å·¦å­èŠ‚ç‚¹ä¸ºï¼š2(n&#x2F;2 + 1) &#x3D; n + 2ï¼Œå¤§å®¶æ˜æ˜¾å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªæ•°å­—å·²ç»å¤§äºn + 1ï¼Œè¶…å‡ºäº†å®ç°å®Œå…¨äºŒå‰æ ‘æ‰€ç”¨æ•°ç»„çš„å¤§å°ï¼ˆæ•°ç»„ä¸‹æ ‡ä»1å¼€å§‹è®°å½•æ•°æ®ï¼Œå¯¹äºnä¸ªèŠ‚ç‚¹æ¥è¯´ï¼Œæ•°ç»„å¤§å°æ˜¯n + 1ï¼‰ï¼Œå·¦å­èŠ‚ç‚¹éƒ½å·²ç»è¶…å‡ºäº†æ•°ç»„å®¹é‡ï¼Œæ›´ä½•å†µå³å­èŠ‚ç‚¹ã€‚ä»¥æ­¤ç±»æ¨ï¼Œå¾ˆå®¹æ˜“å¾—å‡ºï¼šä¸‹æ ‡å¤§äºn&#x2F;2 + 1çš„èŠ‚ç‚¹è‚¯å®šéƒ½æ˜¯ä¹Ÿå¶å­èŠ‚ç‚¹äº†ï¼Œæ•…è€Œå¾—å‡ºç»“è®ºï¼šå¯¹äºå®Œå…¨äºŒå‰æ ‘æ¥è¯´ï¼Œä¸‹æ ‡ä»n&#x2F;2 + 1 åˆ° nçš„èŠ‚ç‚¹éƒ½æ˜¯å¶å­èŠ‚ç‚¹ã€‚</p></blockquote></li><li><p>æˆ‘ä»¬ä»Šå¤©è®²äº†å †çš„ä¸€ç§ç»å…¸åº”ç”¨ï¼Œå †æ’åºã€‚å…³äºå †ï¼Œä½ è¿˜èƒ½æƒ³åˆ°å®ƒçš„å…¶ä»–åº”ç”¨å—ï¼Ÿ</p><blockquote><p>å †çš„åº”ç”¨é™¤äº†å †æ’ä»¥å¤–ï¼Œè¿˜æœ‰å¦‚ä¸‹ä¸€äº›åº”ç”¨ï¼š</p><ol><li>ä»å¤§æ•°é‡çº§æ•°æ®ä¸­ç­›é€‰å‡ºtop n æ¡æ•°æ®ï¼› æ¯”å¦‚ï¼šä»å‡ åäº¿æ¡è®¢å•æ—¥å¿—ä¸­ç­›é€‰å‡ºé‡‘é¢é å‰çš„1000æ¡æ•°æ®</li><li>åœ¨ä¸€äº›åœºæ™¯ä¸­ï¼Œä¼šæ ¹æ®ä¸åŒä¼˜å…ˆçº§æ¥å¤„ç†ç½‘ç»œè¯·æ±‚ï¼Œæ­¤æ—¶ä¹Ÿå¯ä»¥ç”¨åˆ°ä¼˜å…ˆé˜Ÿåˆ—(ç”¨å †å®ç°çš„æ•°æ®ç»“æ„)ï¼›æ¯”å¦‚ï¼šç½‘ç»œæ¡†æ¶Volleyå°±ç”¨äº†Javaä¸­PriorityBlockingQueueï¼Œå½“ç„¶å®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„</li><li>å¯ä»¥ç”¨å †æ¥å®ç°å¤šè·¯å½’å¹¶ï¼Œä»è€Œå®ç°æœ‰åºï¼Œleetcodeä¸Šä¹Ÿæœ‰ç›¸å…³çš„ä¸€é¢˜ï¼šMerge K Sorted Lists</li></ol></blockquote></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>13è®²</title>
      <link href="/posts/ae7f3bb.html"/>
      <url>/posts/ae7f3bb.html</url>
      
        <content type="html"><![CDATA[<hr><h1 id="13-çº¿æ€§æ’åºï¼šå¦‚ä½•æ ¹æ®å¹´é¾„ç»™100ä¸‡ç”¨æˆ·æ•°æ®æ’åºï¼Ÿ"><a href="#13-çº¿æ€§æ’åºï¼šå¦‚ä½•æ ¹æ®å¹´é¾„ç»™100ä¸‡ç”¨æˆ·æ•°æ®æ’åºï¼Ÿ" class="headerlink" title="13 | çº¿æ€§æ’åºï¼šå¦‚ä½•æ ¹æ®å¹´é¾„ç»™100ä¸‡ç”¨æˆ·æ•°æ®æ’åºï¼Ÿ"></a>13 | çº¿æ€§æ’åºï¼šå¦‚ä½•æ ¹æ®å¹´é¾„ç»™100ä¸‡ç”¨æˆ·æ•°æ®æ’åºï¼Ÿ</h1><h2 id="æ¡¶æ’åºï¼ˆBucket-sortï¼‰"><a href="#æ¡¶æ’åºï¼ˆBucket-sortï¼‰" class="headerlink" title="æ¡¶æ’åºï¼ˆBucket sortï¼‰"></a>æ¡¶æ’åºï¼ˆBucket sortï¼‰</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹æ¡¶æ’åºã€‚æ¡¶æ’åºï¼Œé¡¾åæ€ä¹‰ï¼Œä¼šç”¨åˆ°â€œæ¡¶â€ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯å°†è¦æ’åºçš„æ•°æ®åˆ†åˆ°å‡ ä¸ªæœ‰åºçš„æ¡¶é‡Œï¼Œæ¯ä¸ªæ¡¶é‡Œçš„æ•°æ®å†å•ç‹¬è¿›è¡Œæ’åºã€‚æ¡¶å†…æ’å®Œåºä¹‹åï¼Œå†æŠŠæ¯ä¸ªæ¡¶é‡Œçš„æ•°æ®æŒ‰ç…§é¡ºåºä¾æ¬¡å–å‡ºï¼Œç»„æˆçš„åºåˆ—å°±æ˜¯æœ‰åºçš„äº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210809083534.jpeg" alt="img"></p><p>æ¡¶æ’åºçš„æ—¶é—´å¤æ‚åº¦ä¸ºä»€ä¹ˆæ˜¯ O(n) å‘¢ï¼Ÿæˆ‘ä»¬ä¸€å—å„¿æ¥åˆ†æä¸€ä¸‹ã€‚</p><p>å¦‚æœè¦æ’åºçš„æ•°æ®æœ‰ n ä¸ªï¼Œæˆ‘ä»¬æŠŠå®ƒä»¬å‡åŒ€åœ°åˆ’åˆ†åˆ° m ä¸ªæ¡¶å†…ï¼Œæ¯ä¸ªæ¡¶é‡Œå°±æœ‰ k&#x3D;n&#x2F;m ä¸ªå…ƒç´ ã€‚æ¯ä¸ªæ¡¶å†…éƒ¨ä½¿ç”¨å¿«é€Ÿæ’åºï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(k * logk)ã€‚m ä¸ªæ¡¶æ’åºçš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(m * k * logk)ï¼Œå› ä¸º k&#x3D;n&#x2F;mï¼Œæ‰€ä»¥æ•´ä¸ªæ¡¶æ’åºçš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(n*log(n&#x2F;m))ã€‚å½“æ¡¶çš„ä¸ªæ•° m æ¥è¿‘æ•°æ®ä¸ªæ•° n æ—¶ï¼Œlog(n&#x2F;m) å°±æ˜¯ä¸€ä¸ªéå¸¸å°çš„å¸¸é‡ï¼Œè¿™ä¸ªæ—¶å€™æ¡¶æ’åºçš„æ—¶é—´å¤æ‚åº¦æ¥è¿‘ O(n)ã€‚</p><span id="more"></span><h3 id="æ¡¶æ’åºçœ‹èµ·æ¥å¾ˆä¼˜ç§€ï¼Œé‚£å®ƒæ˜¯ä¸æ˜¯å¯ä»¥æ›¿ä»£æˆ‘ä»¬ä¹‹å‰è®²çš„æ’åºç®—æ³•å‘¢ï¼Ÿ"><a href="#æ¡¶æ’åºçœ‹èµ·æ¥å¾ˆä¼˜ç§€ï¼Œé‚£å®ƒæ˜¯ä¸æ˜¯å¯ä»¥æ›¿ä»£æˆ‘ä»¬ä¹‹å‰è®²çš„æ’åºç®—æ³•å‘¢ï¼Ÿ" class="headerlink" title="æ¡¶æ’åºçœ‹èµ·æ¥å¾ˆä¼˜ç§€ï¼Œé‚£å®ƒæ˜¯ä¸æ˜¯å¯ä»¥æ›¿ä»£æˆ‘ä»¬ä¹‹å‰è®²çš„æ’åºç®—æ³•å‘¢ï¼Ÿ"></a>æ¡¶æ’åºçœ‹èµ·æ¥å¾ˆä¼˜ç§€ï¼Œé‚£å®ƒæ˜¯ä¸æ˜¯å¯ä»¥æ›¿ä»£æˆ‘ä»¬ä¹‹å‰è®²çš„æ’åºç®—æ³•å‘¢ï¼Ÿ</h3><p>ç­”æ¡ˆå½“ç„¶æ˜¯å¦å®šçš„ã€‚ä¸ºäº†è®©ä½ è½»æ¾ç†è§£æ¡¶æ’åºçš„æ ¸å¿ƒæ€æƒ³ï¼Œæˆ‘åˆšæ‰åšäº†å¾ˆå¤šå‡è®¾ã€‚å®é™…ä¸Šï¼Œæ¡¶æ’åºå¯¹è¦æ’åºæ•°æ®çš„è¦æ±‚æ˜¯éå¸¸è‹›åˆ»çš„ã€‚</p><p>é¦–å…ˆï¼Œè¦æ’åºçš„æ•°æ®éœ€è¦å¾ˆå®¹æ˜“å°±èƒ½åˆ’åˆ†æˆ m ä¸ªæ¡¶ï¼Œå¹¶ä¸”ï¼Œæ¡¶ä¸æ¡¶ä¹‹é—´æœ‰ç€å¤©ç„¶çš„å¤§å°é¡ºåºã€‚è¿™æ ·æ¯ä¸ªæ¡¶å†…çš„æ•°æ®éƒ½æ’åºå®Œä¹‹åï¼Œæ¡¶ä¸æ¡¶ä¹‹é—´çš„æ•°æ®ä¸éœ€è¦å†è¿›è¡Œæ’åºã€‚</p><p>å…¶æ¬¡ï¼Œæ•°æ®åœ¨å„ä¸ªæ¡¶ä¹‹é—´çš„åˆ†å¸ƒæ˜¯æ¯”è¾ƒå‡åŒ€çš„ã€‚å¦‚æœæ•°æ®ç»è¿‡æ¡¶çš„åˆ’åˆ†ä¹‹åï¼Œæœ‰äº›æ¡¶é‡Œçš„æ•°æ®éå¸¸å¤šï¼Œæœ‰äº›éå¸¸å°‘ï¼Œå¾ˆä¸å¹³å‡ï¼Œé‚£æ¡¶å†…æ•°æ®æ’åºçš„æ—¶é—´å¤æ‚åº¦å°±ä¸æ˜¯å¸¸é‡çº§äº†ã€‚åœ¨æç«¯æƒ…å†µä¸‹ï¼Œå¦‚æœæ•°æ®éƒ½è¢«åˆ’åˆ†åˆ°ä¸€ä¸ªæ¡¶é‡Œï¼Œé‚£å°±é€€åŒ–ä¸º O(nlogn) çš„æ’åºç®—æ³•äº†ã€‚</p><p><strong>æ¡¶æ’åºæ¯”è¾ƒé€‚åˆç”¨åœ¨å¤–éƒ¨æ’åºä¸­</strong>ã€‚æ‰€è°“çš„å¤–éƒ¨æ’åºå°±æ˜¯æ•°æ®å­˜å‚¨åœ¨å¤–éƒ¨ç£ç›˜ä¸­ï¼Œæ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œå†…å­˜æœ‰é™ï¼Œæ— æ³•å°†æ•°æ®å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p><p>æ¯”å¦‚è¯´æˆ‘ä»¬æœ‰ 10GB çš„è®¢å•æ•°æ®ï¼Œæˆ‘ä»¬å¸Œæœ›æŒ‰è®¢å•é‡‘é¢ï¼ˆå‡è®¾é‡‘é¢éƒ½æ˜¯æ­£æ•´æ•°ï¼‰è¿›è¡Œæ’åºï¼Œä½†æ˜¯æˆ‘ä»¬çš„å†…å­˜æœ‰é™ï¼Œåªæœ‰å‡ ç™¾ MBï¼Œæ²¡åŠæ³•ä¸€æ¬¡æ€§æŠŠ 10GB çš„æ•°æ®éƒ½åŠ è½½åˆ°å†…å­˜ä¸­ã€‚è¿™ä¸ªæ—¶å€™è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>ç°åœ¨æˆ‘æ¥è®²ä¸€ä¸‹ï¼Œå¦‚ä½•å€ŸåŠ©æ¡¶æ’åºçš„å¤„ç†æ€æƒ³æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å…ˆæ‰«æä¸€éæ–‡ä»¶ï¼Œçœ‹è®¢å•é‡‘é¢æ‰€å¤„çš„æ•°æ®èŒƒå›´ã€‚å‡è®¾ç»è¿‡æ‰«æä¹‹åæˆ‘ä»¬å¾—åˆ°ï¼Œè®¢å•é‡‘é¢æœ€å°æ˜¯ 1 å…ƒï¼Œæœ€å¤§æ˜¯ 10 ä¸‡å…ƒã€‚æˆ‘ä»¬å°†æ‰€æœ‰è®¢å•æ ¹æ®é‡‘é¢åˆ’åˆ†åˆ° 100 ä¸ªæ¡¶é‡Œï¼Œç¬¬ä¸€ä¸ªæ¡¶æˆ‘ä»¬å­˜å‚¨é‡‘é¢åœ¨ 1 å…ƒåˆ° 1000 å…ƒä¹‹å†…çš„è®¢å•ï¼Œç¬¬äºŒæ¡¶å­˜å‚¨é‡‘é¢åœ¨ 1001 å…ƒåˆ° 2000 å…ƒä¹‹å†…çš„è®¢å•ï¼Œä»¥æ­¤ç±»æ¨ã€‚æ¯ä¸€ä¸ªæ¡¶å¯¹åº”ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”æŒ‰ç…§é‡‘é¢èŒƒå›´çš„å¤§å°é¡ºåºç¼–å·å‘½åï¼ˆ00ï¼Œ01ï¼Œ02â€¦99ï¼‰ã€‚</p><p>ç†æƒ³çš„æƒ…å†µä¸‹ï¼Œå¦‚æœè®¢å•é‡‘é¢åœ¨ 1 åˆ° 10 ä¸‡ä¹‹é—´å‡åŒ€åˆ†å¸ƒï¼Œé‚£è®¢å•ä¼šè¢«å‡åŒ€åˆ’åˆ†åˆ° 100 ä¸ªæ–‡ä»¶ä¸­ï¼Œæ¯ä¸ªå°æ–‡ä»¶ä¸­å­˜å‚¨å¤§çº¦ 100MB çš„è®¢å•æ•°æ®ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†è¿™ 100 ä¸ªå°æ–‡ä»¶ä¾æ¬¡æ”¾åˆ°å†…å­˜ä¸­ï¼Œç”¨å¿«æ’æ¥æ’åºã€‚ç­‰æ‰€æœ‰æ–‡ä»¶éƒ½æ’å¥½åºä¹‹åï¼Œæˆ‘ä»¬åªéœ€è¦æŒ‰ç…§æ–‡ä»¶ç¼–å·ï¼Œä»å°åˆ°å¤§ä¾æ¬¡è¯»å–æ¯ä¸ªå°æ–‡ä»¶ä¸­çš„è®¢å•æ•°æ®ï¼Œå¹¶å°†å…¶å†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œé‚£è¿™ä¸ªæ–‡ä»¶ä¸­å­˜å‚¨çš„å°±æ˜¯æŒ‰ç…§é‡‘é¢ä»å°åˆ°å¤§æ’åºçš„è®¢å•æ•°æ®äº†ã€‚</p><p>ä¸è¿‡ï¼Œä½ å¯èƒ½ä¹Ÿå‘ç°äº†ï¼Œè®¢å•æŒ‰ç…§é‡‘é¢åœ¨ 1 å…ƒåˆ° 10 ä¸‡å…ƒä¹‹é—´å¹¶ä¸ä¸€å®šæ˜¯å‡åŒ€åˆ†å¸ƒçš„ ï¼Œæ‰€ä»¥ 10GB è®¢å•æ•°æ®æ˜¯æ— æ³•å‡åŒ€åœ°è¢«åˆ’åˆ†åˆ° 100 ä¸ªæ–‡ä»¶ä¸­çš„ã€‚æœ‰å¯èƒ½æŸä¸ªé‡‘é¢åŒºé—´çš„æ•°æ®ç‰¹åˆ«å¤šï¼Œåˆ’åˆ†ä¹‹åå¯¹åº”çš„æ–‡ä»¶å°±ä¼šå¾ˆå¤§ï¼Œæ²¡æ³•ä¸€æ¬¡æ€§è¯»å…¥å†…å­˜ã€‚è¿™åˆè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>é’ˆå¯¹è¿™äº›åˆ’åˆ†ä¹‹åè¿˜æ˜¯æ¯”è¾ƒå¤§çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­åˆ’åˆ†ï¼Œæ¯”å¦‚ï¼Œè®¢å•é‡‘é¢åœ¨ 1 å…ƒåˆ° 1000 å…ƒä¹‹é—´çš„æ¯”è¾ƒå¤šï¼Œæˆ‘ä»¬å°±å°†è¿™ä¸ªåŒºé—´ç»§ç»­åˆ’åˆ†ä¸º 10 ä¸ªå°åŒºé—´ï¼Œ1 å…ƒåˆ° 100 å…ƒï¼Œ101 å…ƒåˆ° 200 å…ƒï¼Œ201 å…ƒåˆ° 300 å…ƒâ€¦.901 å…ƒåˆ° 1000 å…ƒã€‚å¦‚æœåˆ’åˆ†ä¹‹åï¼Œ101 å…ƒåˆ° 200 å…ƒä¹‹é—´çš„è®¢å•è¿˜æ˜¯å¤ªå¤šï¼Œæ— æ³•ä¸€æ¬¡æ€§è¯»å…¥å†…å­˜ï¼Œé‚£å°±ç»§ç»­å†åˆ’åˆ†ï¼Œç›´åˆ°æ‰€æœ‰çš„æ–‡ä»¶éƒ½èƒ½è¯»å…¥å†…å­˜ä¸ºæ­¢ã€‚</p><h2 id="è®¡æ•°æ’åºï¼ˆCounting-sortï¼‰"><a href="#è®¡æ•°æ’åºï¼ˆCounting-sortï¼‰" class="headerlink" title="è®¡æ•°æ’åºï¼ˆCounting sortï¼‰"></a>è®¡æ•°æ’åºï¼ˆCounting sortï¼‰</h2><p>æˆ‘ä¸ªäººè§‰å¾—ï¼Œ<strong>è®¡æ•°æ’åºå…¶å®æ˜¯æ¡¶æ’åºçš„ä¸€ç§ç‰¹æ®Šæƒ…å†µ</strong>ã€‚å½“è¦æ’åºçš„ n ä¸ªæ•°æ®ï¼Œæ‰€å¤„çš„èŒƒå›´å¹¶ä¸å¤§çš„æ—¶å€™ï¼Œæ¯”å¦‚æœ€å¤§å€¼æ˜¯ kï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠæ•°æ®åˆ’åˆ†æˆ k ä¸ªæ¡¶ã€‚æ¯ä¸ªæ¡¶å†…çš„æ•°æ®å€¼éƒ½æ˜¯ç›¸åŒçš„ï¼Œçœæ‰äº†æ¡¶å†…æ’åºçš„æ—¶é—´ã€‚</p><p>æˆ‘ä»¬éƒ½ç»å†è¿‡é«˜è€ƒï¼Œé«˜è€ƒæŸ¥åˆ†æ•°ç³»ç»Ÿä½ è¿˜è®°å¾—å—ï¼Ÿæˆ‘ä»¬æŸ¥åˆ†æ•°çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šæ˜¾ç¤ºæˆ‘ä»¬çš„æˆç»©ä»¥åŠæ‰€åœ¨çœçš„æ’åã€‚å¦‚æœä½ æ‰€åœ¨çš„çœæœ‰ 50 ä¸‡è€ƒç”Ÿï¼Œå¦‚ä½•é€šè¿‡æˆç»©å¿«é€Ÿæ’åºå¾—å‡ºåæ¬¡å‘¢ï¼Ÿ</p><p>è€ƒç”Ÿçš„æ»¡åˆ†æ˜¯ 900 åˆ†ï¼Œæœ€å°æ˜¯ 0 åˆ†ï¼Œè¿™ä¸ªæ•°æ®çš„èŒƒå›´å¾ˆå°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ†æˆ 901 ä¸ªæ¡¶ï¼Œå¯¹åº”åˆ†æ•°ä» 0 åˆ†åˆ° 900 åˆ†ã€‚æ ¹æ®è€ƒç”Ÿçš„æˆç»©ï¼Œæˆ‘ä»¬å°†è¿™ 50 ä¸‡è€ƒç”Ÿåˆ’åˆ†åˆ°è¿™ 901 ä¸ªæ¡¶é‡Œã€‚æ¡¶å†…çš„æ•°æ®éƒ½æ˜¯åˆ†æ•°ç›¸åŒçš„è€ƒç”Ÿï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦å†è¿›è¡Œæ’åºã€‚æˆ‘ä»¬åªéœ€è¦ä¾æ¬¡æ‰«ææ¯ä¸ªæ¡¶ï¼Œå°†æ¡¶å†…çš„è€ƒç”Ÿä¾æ¬¡è¾“å‡ºåˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œå°±å®ç°äº† 50 ä¸‡è€ƒç”Ÿçš„æ’åºã€‚å› ä¸ºåªæ¶‰åŠæ‰«æéå†æ“ä½œï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚</p><p>è®¡æ•°æ’åºçš„ç®—æ³•æ€æƒ³å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œè·Ÿæ¡¶æ’åºéå¸¸ç±»ä¼¼ï¼Œåªæ˜¯æ¡¶çš„å¤§å°ç²’åº¦ä¸ä¸€æ ·ã€‚<strong>ä¸è¿‡ï¼Œä¸ºä»€ä¹ˆè¿™ä¸ªæ’åºç®—æ³•å«â€œè®¡æ•°â€æ’åºå‘¢ï¼Ÿâ€œè®¡æ•°â€çš„å«ä¹‰æ¥è‡ªå“ªé‡Œå‘¢ï¼Ÿ</strong></p><p>æƒ³å¼„æ˜ç™½è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±è¦æ¥çœ‹è®¡æ•°æ’åºç®—æ³•çš„å®ç°æ–¹æ³•ã€‚æˆ‘è¿˜æ‹¿è€ƒç”Ÿé‚£ä¸ªä¾‹å­æ¥è§£é‡Šã€‚ä¸ºäº†æ–¹ä¾¿è¯´æ˜ï¼Œæˆ‘å¯¹æ•°æ®è§„æ¨¡åšäº†ç®€åŒ–ã€‚å‡è®¾åªæœ‰ 8 ä¸ªè€ƒç”Ÿï¼Œåˆ†æ•°åœ¨ 0 åˆ° 5 åˆ†ä¹‹é—´ã€‚è¿™ 8 ä¸ªè€ƒç”Ÿçš„æˆç»©æˆ‘ä»¬æ”¾åœ¨ä¸€ä¸ªæ•°ç»„ A[8]ä¸­ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š2ï¼Œ5ï¼Œ3ï¼Œ0ï¼Œ2ï¼Œ3ï¼Œ0ï¼Œ3ã€‚</p><p>è€ƒç”Ÿçš„æˆç»©ä» 0 åˆ° 5 åˆ†ï¼Œæˆ‘ä»¬ä½¿ç”¨å¤§å°ä¸º 6 çš„æ•°ç»„ C[6]è¡¨ç¤ºæ¡¶ï¼Œå…¶ä¸­ä¸‹æ ‡å¯¹åº”åˆ†æ•°ã€‚ä¸è¿‡ï¼ŒC[6]å†…å­˜å‚¨çš„å¹¶ä¸æ˜¯è€ƒç”Ÿï¼Œè€Œæ˜¯å¯¹åº”çš„è€ƒç”Ÿä¸ªæ•°ã€‚åƒæˆ‘åˆšåˆšä¸¾çš„é‚£ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬åªéœ€è¦éå†ä¸€éè€ƒç”Ÿåˆ†æ•°ï¼Œå°±å¯ä»¥å¾—åˆ° C[6]çš„å€¼ã€‚</p><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œåˆ†æ•°ä¸º 3 åˆ†çš„è€ƒç”Ÿæœ‰ 3 ä¸ªï¼Œå°äº 3 åˆ†çš„è€ƒç”Ÿæœ‰ 4 ä¸ªï¼Œæ‰€ä»¥ï¼Œæˆç»©ä¸º 3 åˆ†çš„è€ƒç”Ÿåœ¨æ’åºä¹‹åçš„æœ‰åºæ•°ç»„ R[8]ä¸­ï¼Œä¼šä¿å­˜ä¸‹æ ‡ 4ï¼Œ5ï¼Œ6 çš„ä½ç½®ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021202108090919720.jpeg" alt="img"></p><p>é‚£æˆ‘ä»¬å¦‚ä½•å¿«é€Ÿè®¡ç®—å‡ºï¼Œæ¯ä¸ªåˆ†æ•°çš„è€ƒç”Ÿåœ¨æœ‰åºæ•°ç»„ä¸­å¯¹åº”çš„å­˜å‚¨ä½ç½®å‘¢ï¼Ÿè¿™ä¸ªå¤„ç†æ–¹æ³•éå¸¸å·§å¦™ï¼Œå¾ˆä¸å®¹æ˜“æƒ³åˆ°ã€‚</p><p>æ€è·¯æ˜¯è¿™æ ·çš„ï¼šæˆ‘ä»¬å¯¹ C[6]æ•°ç»„é¡ºåºæ±‚å’Œï¼ŒC[6]å­˜å‚¨çš„æ•°æ®å°±å˜æˆäº†ä¸‹é¢è¿™æ ·å­ã€‚C[k]é‡Œå­˜å‚¨å°äºç­‰äºåˆ†æ•° k çš„è€ƒç”Ÿä¸ªæ•°ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021202108090919681.jpeg" alt="img"></p><p>æœ‰äº†å‰é¢çš„æ•°æ®å‡†å¤‡ä¹‹åï¼Œç°åœ¨æˆ‘å°±è¦è®²è®¡æ•°æ’åºä¸­æœ€å¤æ‚ã€æœ€éš¾ç†è§£çš„ä¸€éƒ¨åˆ†äº†ï¼Œè¯·é›†ä¸­ç²¾åŠ›è·Ÿç€æˆ‘çš„æ€è·¯ï¼</p><p>æˆ‘ä»¬ä»ååˆ°å‰ä¾æ¬¡æ‰«ææ•°ç»„ Aã€‚æ¯”å¦‚ï¼Œå½“æ‰«æåˆ° 3 æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä»æ•°ç»„ C ä¸­å–å‡ºä¸‹æ ‡ä¸º 3 çš„å€¼ 7ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼ŒåŒ…æ‹¬è‡ªå·±åœ¨å†…ï¼Œåˆ†æ•°å°äºç­‰äº 3 çš„è€ƒç”Ÿæœ‰ 7 ä¸ªï¼Œä¹Ÿå°±æ˜¯è¯´ 3 æ˜¯æ•°ç»„ R ä¸­çš„ç¬¬ 7 ä¸ªå…ƒç´ ï¼ˆä¹Ÿå°±æ˜¯æ•°ç»„ R ä¸­ä¸‹æ ‡ä¸º 6 çš„ä½ç½®ï¼‰ã€‚å½“ 3 æ”¾å…¥åˆ°æ•°ç»„ R ä¸­åï¼Œå°äºç­‰äº 3 çš„å…ƒç´ å°±åªå‰©ä¸‹äº† 6 ä¸ªäº†ï¼Œæ‰€ä»¥ç›¸åº”çš„ C[3]è¦å‡ 1ï¼Œå˜æˆ 6ã€‚</p><p>ä»¥æ­¤ç±»æ¨ï¼Œå½“æˆ‘ä»¬æ‰«æåˆ°ç¬¬ 2 ä¸ªåˆ†æ•°ä¸º 3 çš„è€ƒç”Ÿçš„æ—¶å€™ï¼Œå°±ä¼šæŠŠå®ƒæ”¾å…¥æ•°ç»„ R ä¸­çš„ç¬¬ 6 ä¸ªå…ƒç´ çš„ä½ç½®ï¼ˆä¹Ÿå°±æ˜¯ä¸‹æ ‡ä¸º 5 çš„ä½ç½®ï¼‰ã€‚å½“æˆ‘ä»¬æ‰«æå®Œæ•´ä¸ªæ•°ç»„ A åï¼Œæ•°ç»„ R å†…çš„æ•°æ®å°±æ˜¯æŒ‰ç…§åˆ†æ•°ä»å°åˆ°å¤§æœ‰åºæ’åˆ—çš„äº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021202108090920435.jpeg" alt="img"></p><p>ä¸Šé¢çš„è¿‡ç¨‹æœ‰ç‚¹å¤æ‚ï¼Œæˆ‘å†™æˆäº†ä»£ç ï¼Œä½ å¯ä»¥å¯¹ç…§ç€çœ‹ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¡æ•°æ’åºï¼Œaæ˜¯æ•°ç»„ï¼Œnæ˜¯æ•°ç»„å¤§å°ã€‚å‡è®¾æ•°ç»„ä¸­å­˜å‚¨çš„éƒ½æ˜¯éè´Ÿæ•´æ•°ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">countingSort</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (n &lt;= <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æŸ¥æ‰¾æ•°ç»„ä¸­æ•°æ®çš„èŒƒå›´</span></span><br><span class="line">  <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> a[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (max &lt; a[i]) &#123;</span><br><span class="line">      max = a[i];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span>[] c = <span class="keyword">new</span> <span class="title class_">int</span>[max + <span class="number">1</span>]; <span class="comment">// ç”³è¯·ä¸€ä¸ªè®¡æ•°æ•°ç»„cï¼Œä¸‹æ ‡å¤§å°[0,max]</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= max; ++i) &#123;</span><br><span class="line">    c[i] = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®¡ç®—æ¯ä¸ªå…ƒç´ çš„ä¸ªæ•°ï¼Œæ”¾å…¥cä¸­</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">    c[a[i]]++;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¾æ¬¡ç´¯åŠ </span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= max; ++i) &#123;</span><br><span class="line">    c[i] = c[i-<span class="number">1</span>] + c[i];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¸´æ—¶æ•°ç»„rï¼Œå­˜å‚¨æ’åºä¹‹åçš„ç»“æœ</span></span><br><span class="line">  <span class="type">int</span>[] r = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">  <span class="comment">// è®¡ç®—æ’åºçš„å…³é”®æ­¥éª¤ï¼Œæœ‰ç‚¹éš¾ç†è§£</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> c[a[i]]-<span class="number">1</span>;</span><br><span class="line">    r[index] = a[i];</span><br><span class="line">    c[a[i]]--;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†ç»“æœæ‹·è´ç»™aæ•°ç»„</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">    a[i] = r[i];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§åˆ©ç”¨å¦å¤–ä¸€ä¸ªæ•°ç»„æ¥è®¡æ•°çš„å®ç°æ–¹å¼æ˜¯ä¸æ˜¯å¾ˆå·§å¦™å‘¢ï¼Ÿè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¿™ç§æ’åºç®—æ³•å«è®¡æ•°æ’åºçš„åŸå› ã€‚ä¸è¿‡ï¼Œä½ åƒä¸‡ä¸è¦æ­»è®°ç¡¬èƒŒä¸Šé¢çš„æ’åºè¿‡ç¨‹ï¼Œé‡è¦çš„æ˜¯ç†è§£å’Œä¼šç”¨ã€‚</p><p>æˆ‘æ€»ç»“ä¸€ä¸‹ï¼Œ<strong>è®¡æ•°æ’åºåªèƒ½ç”¨åœ¨æ•°æ®èŒƒå›´ä¸å¤§çš„åœºæ™¯ä¸­ï¼Œå¦‚æœæ•°æ®èŒƒå›´ k æ¯”è¦æ’åºçš„æ•°æ® n å¤§å¾ˆå¤šï¼Œå°±ä¸é€‚åˆç”¨è®¡æ•°æ’åºäº†ã€‚è€Œä¸”ï¼Œè®¡æ•°æ’åºåªèƒ½ç»™éè´Ÿæ•´æ•°æ’åºï¼Œå¦‚æœè¦æ’åºçš„æ•°æ®æ˜¯å…¶ä»–ç±»å‹çš„ï¼Œè¦å°†å…¶åœ¨ä¸æ”¹å˜ç›¸å¯¹å¤§å°çš„æƒ…å†µä¸‹ï¼Œè½¬åŒ–ä¸ºéè´Ÿæ•´æ•°ã€‚</strong></p><p>æ¯”å¦‚ï¼Œè¿˜æ˜¯æ‹¿è€ƒç”Ÿè¿™ä¸ªä¾‹å­ã€‚å¦‚æœè€ƒç”Ÿæˆç»©ç²¾ç¡®åˆ°å°æ•°åä¸€ä½ï¼Œæˆ‘ä»¬å°±éœ€è¦å°†æ‰€æœ‰çš„åˆ†æ•°éƒ½å…ˆä¹˜ä»¥ 10ï¼Œè½¬åŒ–æˆæ•´æ•°ï¼Œç„¶åå†æ”¾åˆ° 9010 ä¸ªæ¡¶å†…ã€‚å†æ¯”å¦‚ï¼Œå¦‚æœè¦æ’åºçš„æ•°æ®ä¸­æœ‰è´Ÿæ•°ï¼Œæ•°æ®çš„èŒƒå›´æ˜¯[-1000, 1000]ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦å…ˆå¯¹æ¯ä¸ªæ•°æ®éƒ½åŠ  1000ï¼Œè½¬åŒ–æˆéè´Ÿæ•´æ•°ã€‚</p><h2 id="åŸºæ•°æ’åºï¼ˆRadix-sortï¼‰"><a href="#åŸºæ•°æ’åºï¼ˆRadix-sortï¼‰" class="headerlink" title="åŸºæ•°æ’åºï¼ˆRadix sortï¼‰"></a>åŸºæ•°æ’åºï¼ˆRadix sortï¼‰</h2><p>æˆ‘ä»¬å†æ¥çœ‹è¿™æ ·ä¸€ä¸ªæ’åºé—®é¢˜ã€‚å‡è®¾æˆ‘ä»¬æœ‰ 10 ä¸‡ä¸ªæ‰‹æœºå·ç ï¼Œå¸Œæœ›å°†è¿™ 10 ä¸‡ä¸ªæ‰‹æœºå·ç ä»å°åˆ°å¤§æ’åºï¼Œä½ æœ‰ä»€ä¹ˆæ¯”è¾ƒå¿«é€Ÿçš„æ’åºæ–¹æ³•å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬ä¹‹å‰è®²çš„å¿«æ’ï¼Œæ—¶é—´å¤æ‚åº¦å¯ä»¥åšåˆ° O(nlogn)ï¼Œè¿˜æœ‰æ›´é«˜æ•ˆçš„æ’åºç®—æ³•å—ï¼Ÿæ¡¶æ’åºã€è®¡æ•°æ’åºèƒ½æ´¾ä¸Šç”¨åœºå—ï¼Ÿæ‰‹æœºå·ç æœ‰ 11 ä½ï¼ŒèŒƒå›´å¤ªå¤§ï¼Œæ˜¾ç„¶ä¸é€‚åˆç”¨è¿™ä¸¤ç§æ’åºç®—æ³•ã€‚é’ˆå¯¹è¿™ä¸ªæ’åºé—®é¢˜ï¼Œæœ‰æ²¡æœ‰æ—¶é—´å¤æ‚åº¦æ˜¯ O(n) çš„ç®—æ³•å‘¢ï¼Ÿç°åœ¨æˆ‘å°±æ¥ä»‹ç»ä¸€ç§æ–°çš„æ’åºç®—æ³•ï¼ŒåŸºæ•°æ’åºã€‚</p><p>åˆšåˆšè¿™ä¸ªé—®é¢˜é‡Œæœ‰è¿™æ ·çš„è§„å¾‹ï¼šå‡è®¾è¦æ¯”è¾ƒä¸¤ä¸ªæ‰‹æœºå·ç  aï¼Œb çš„å¤§å°ï¼Œå¦‚æœåœ¨å‰é¢å‡ ä½ä¸­ï¼Œa æ‰‹æœºå·ç å·²ç»æ¯” b æ‰‹æœºå·ç å¤§äº†ï¼Œé‚£åé¢çš„å‡ ä½å°±ä¸ç”¨çœ‹äº†ã€‚</p><p>å€ŸåŠ©ç¨³å®šæ’åºç®—æ³•ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå·§å¦™çš„å®ç°æ€è·¯ã€‚è¿˜è®°å¾—æˆ‘ä»¬ç¬¬ 11 èŠ‚ä¸­ï¼Œåœ¨é˜è¿°æ’åºç®—æ³•çš„ç¨³å®šæ€§çš„æ—¶å€™ä¸¾çš„è®¢å•çš„ä¾‹å­å—ï¼Ÿæˆ‘ä»¬è¿™é‡Œä¹Ÿå¯ä»¥å€ŸåŠ©ç›¸åŒçš„å¤„ç†æ€è·¯ï¼Œå…ˆæŒ‰ç…§æœ€åä¸€ä½æ¥æ’åºæ‰‹æœºå·ç ï¼Œç„¶åï¼Œå†æŒ‰ç…§å€’æ•°ç¬¬äºŒä½é‡æ–°æ’åºï¼Œä»¥æ­¤ç±»æ¨ï¼Œæœ€åæŒ‰ç…§ç¬¬ä¸€ä½é‡æ–°æ’åºã€‚ç»è¿‡ 11 æ¬¡æ’åºä¹‹åï¼Œæ‰‹æœºå·ç å°±éƒ½æœ‰åºäº†ã€‚</p><p>æ‰‹æœºå·ç ç¨å¾®æœ‰ç‚¹é•¿ï¼Œç”»å›¾æ¯”è¾ƒä¸å®¹æ˜“çœ‹æ¸…æ¥šï¼Œæˆ‘ç”¨å­—ç¬¦ä¸²æ’åºçš„ä¾‹å­ï¼Œç”»äº†ä¸€å¼ åŸºæ•°æ’åºçš„è¿‡ç¨‹åˆ†è§£å›¾ï¼Œä½ å¯ä»¥çœ‹ä¸‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021202108090929945.jpeg" alt="img"></p><p>æ³¨æ„ï¼Œè¿™é‡ŒæŒ‰ç…§æ¯ä½æ¥æ’åºçš„æ’åºç®—æ³•è¦æ˜¯ç¨³å®šçš„ï¼Œå¦åˆ™è¿™ä¸ªå®ç°æ€è·¯å°±æ˜¯ä¸æ­£ç¡®çš„ã€‚å› ä¸ºå¦‚æœæ˜¯éç¨³å®šæ’åºç®—æ³•ï¼Œé‚£æœ€åä¸€æ¬¡æ’åºåªä¼šè€ƒè™‘æœ€é«˜ä½çš„å¤§å°é¡ºåºï¼Œå®Œå…¨ä¸ç®¡å…¶ä»–ä½çš„å¤§å°å…³ç³»ï¼Œé‚£ä¹ˆä½ä½çš„æ’åºå°±å®Œå…¨æ²¡æœ‰æ„ä¹‰äº†ã€‚</p><p>æ ¹æ®æ¯ä¸€ä½æ¥æ’åºï¼Œæˆ‘ä»¬å¯ä»¥ç”¨åˆšè®²è¿‡çš„æ¡¶æ’åºæˆ–è€…è®¡æ•°æ’åºï¼Œå®ƒä»¬çš„æ—¶é—´å¤æ‚åº¦å¯ä»¥åšåˆ° O(n)ã€‚å¦‚æœè¦æ’åºçš„æ•°æ®æœ‰ k ä½ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦ k æ¬¡æ¡¶æ’åºæˆ–è€…è®¡æ•°æ’åºï¼Œæ€»çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(k*n)ã€‚å½“ k ä¸å¤§çš„æ—¶å€™ï¼Œæ¯”å¦‚æ‰‹æœºå·ç æ’åºçš„ä¾‹å­ï¼Œk æœ€å¤§å°±æ˜¯ 11ï¼Œæ‰€ä»¥åŸºæ•°æ’åºçš„æ—¶é—´å¤æ‚åº¦å°±è¿‘ä¼¼äº O(n)ã€‚</p><p>å®é™…ä¸Šï¼Œæœ‰æ—¶å€™è¦æ’åºçš„æ•°æ®å¹¶ä¸éƒ½æ˜¯ç­‰é•¿çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬æ’åºç‰›æ´¥å­—å…¸ä¸­çš„ 20 ä¸‡ä¸ªè‹±æ–‡å•è¯ï¼Œæœ€çŸ­çš„åªæœ‰ 1 ä¸ªå­—æ¯ï¼Œæœ€é•¿çš„æˆ‘ç‰¹æ„å»æŸ¥äº†ä¸‹ï¼Œæœ‰ 45 ä¸ªå­—æ¯ï¼Œä¸­æ–‡ç¿»è¯‘æ˜¯å°˜è‚ºç—…ã€‚å¯¹äºè¿™ç§ä¸ç­‰é•¿çš„æ•°æ®ï¼ŒåŸºæ•°æ’åºè¿˜é€‚ç”¨å—ï¼Ÿ</p><p>å®é™…ä¸Šï¼Œ<strong>æˆ‘ä»¬å¯ä»¥æŠŠæ‰€æœ‰çš„å•è¯è¡¥é½åˆ°ç›¸åŒé•¿åº¦ï¼Œä½æ•°ä¸å¤Ÿçš„å¯ä»¥åœ¨åé¢è¡¥â€œ0â€</strong>ï¼Œå› ä¸ºæ ¹æ®ASCII å€¼ï¼Œæ‰€æœ‰å­—æ¯éƒ½å¤§äºâ€œ0â€ï¼Œæ‰€ä»¥è¡¥â€œ0â€ä¸ä¼šå½±å“åˆ°åŸæœ‰çš„å¤§å°é¡ºåºã€‚è¿™æ ·å°±å¯ä»¥ç»§ç»­ç”¨åŸºæ•°æ’åºäº†ã€‚</p><p>æˆ‘æ¥æ€»ç»“ä¸€ä¸‹ï¼Œ<strong>åŸºæ•°æ’åºå¯¹è¦æ’åºçš„æ•°æ®æ˜¯æœ‰è¦æ±‚çš„ï¼Œéœ€è¦å¯ä»¥åˆ†å‰²å‡ºç‹¬ç«‹çš„â€œä½â€æ¥æ¯”è¾ƒï¼Œè€Œä¸”ä½ä¹‹é—´æœ‰é€’è¿›çš„å…³ç³»ï¼Œå¦‚æœ a æ•°æ®çš„é«˜ä½æ¯” b æ•°æ®å¤§ï¼Œé‚£å‰©ä¸‹çš„ä½ä½å°±ä¸ç”¨æ¯”è¾ƒäº†ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ¯ä¸€ä½çš„æ•°æ®èŒƒå›´ä¸èƒ½å¤ªå¤§ï¼Œè¦å¯ä»¥ç”¨çº¿æ€§æ’åºç®—æ³•æ¥æ’åºï¼Œå¦åˆ™ï¼ŒåŸºæ•°æ’åºçš„æ—¶é—´å¤æ‚åº¦å°±æ— æ³•åšåˆ° O(n) äº†ã€‚</strong></p><h2 id="è§£ç­”å¼€ç¯‡"><a href="#è§£ç­”å¼€ç¯‡" class="headerlink" title="è§£ç­”å¼€ç¯‡"></a>è§£ç­”å¼€ç¯‡</h2><p>ä»Šå¤©çš„å†…å®¹å­¦å®Œäº†ã€‚æˆ‘ä»¬å†å›è¿‡å¤´æ¥çœ‹çœ‹å¼€ç¯‡çš„æ€è€ƒé¢˜ï¼šå¦‚ä½•æ ¹æ®å¹´é¾„ç»™ 100 ä¸‡ç”¨æˆ·æ’åºï¼Ÿç°åœ¨æ€è€ƒé¢˜æ˜¯ä¸æ˜¯å˜å¾—éå¸¸ç®€å•äº†å‘¢ï¼Ÿæˆ‘æ¥è¯´ä¸€ä¸‹æˆ‘çš„è§£å†³æ€è·¯ã€‚</p><p>å®é™…ä¸Šï¼Œæ ¹æ®å¹´é¾„ç»™ 100 ä¸‡ç”¨æˆ·æ’åºï¼Œå°±ç±»ä¼¼æŒ‰ç…§æˆç»©ç»™ 50 ä¸‡è€ƒç”Ÿæ’åºã€‚æˆ‘ä»¬å‡è®¾å¹´é¾„çš„èŒƒå›´æœ€å° 1 å²ï¼Œæœ€å¤§ä¸è¶…è¿‡ 120 å²ã€‚æˆ‘ä»¬å¯ä»¥éå†è¿™ 100 ä¸‡ç”¨æˆ·ï¼Œæ ¹æ®å¹´é¾„å°†å…¶åˆ’åˆ†åˆ°è¿™ 120 ä¸ªæ¡¶é‡Œï¼Œç„¶åä¾æ¬¡é¡ºåºéå†è¿™ 120 ä¸ªæ¡¶ä¸­çš„å…ƒç´ ã€‚è¿™æ ·å°±å¾—åˆ°äº†æŒ‰ç…§å¹´é¾„æ’åºçš„ 100 ä¸‡ç”¨æˆ·æ•°æ®ã€‚</p><h2 id="å†…å®¹å°ç»“"><a href="#å†…å®¹å°ç»“" class="headerlink" title="å†…å®¹å°ç»“"></a>å†…å®¹å°ç»“</h2><p>ä»Šå¤©ï¼Œæˆ‘ä»¬å­¦ä¹ äº† 3 ç§çº¿æ€§æ—¶é—´å¤æ‚åº¦çš„æ’åºç®—æ³•ï¼Œæœ‰æ¡¶æ’åºã€è®¡æ•°æ’åºã€åŸºæ•°æ’åºã€‚å®ƒä»¬å¯¹è¦æ’åºçš„æ•°æ®éƒ½æœ‰æ¯”è¾ƒè‹›åˆ»çš„è¦æ±‚ï¼Œåº”ç”¨ä¸æ˜¯éå¸¸å¹¿æ³›ã€‚ä½†æ˜¯å¦‚æœæ•°æ®ç‰¹å¾æ¯”è¾ƒç¬¦åˆè¿™äº›æ’åºç®—æ³•çš„è¦æ±‚ï¼Œåº”ç”¨è¿™äº›ç®—æ³•ï¼Œä¼šéå¸¸é«˜æ•ˆï¼Œçº¿æ€§æ—¶é—´å¤æ‚åº¦å¯ä»¥è¾¾åˆ° O(n)ã€‚</p><p>æ¡¶æ’åºå’Œè®¡æ•°æ’åºçš„æ’åºæ€æƒ³æ˜¯éå¸¸ç›¸ä¼¼çš„ï¼Œéƒ½æ˜¯é’ˆå¯¹èŒƒå›´ä¸å¤§çš„æ•°æ®ï¼Œå°†æ•°æ®åˆ’åˆ†æˆä¸åŒçš„æ¡¶æ¥å®ç°æ’åºã€‚åŸºæ•°æ’åºè¦æ±‚æ•°æ®å¯ä»¥åˆ’åˆ†æˆé«˜ä½ä½ï¼Œä½ä¹‹é—´æœ‰é€’è¿›å…³ç³»ã€‚æ¯”è¾ƒä¸¤ä¸ªæ•°ï¼Œæˆ‘ä»¬åªéœ€è¦æ¯”è¾ƒé«˜ä½ï¼Œé«˜ä½ç›¸åŒçš„å†æ¯”è¾ƒä½ä½ã€‚è€Œä¸”æ¯ä¸€ä½çš„æ•°æ®èŒƒå›´ä¸èƒ½å¤ªå¤§ï¼Œå› ä¸ºåŸºæ•°æ’åºç®—æ³•éœ€è¦å€ŸåŠ©æ¡¶æ’åºæˆ–è€…è®¡æ•°æ’åºæ¥å®Œæˆæ¯ä¸€ä¸ªä½çš„æ’åºå·¥ä½œã€‚</p><h2 id="è¯¾åæ€è€ƒ"><a href="#è¯¾åæ€è€ƒ" class="headerlink" title="è¯¾åæ€è€ƒ"></a>è¯¾åæ€è€ƒ</h2><p>æˆ‘ä»¬ä»Šå¤©è®²çš„éƒ½æ˜¯é’ˆå¯¹ç‰¹æ®Šæ•°æ®çš„æ’åºç®—æ³•ã€‚å®é™…ä¸Šï¼Œè¿˜æœ‰å¾ˆå¤šçœ‹ä¼¼æ˜¯æ’åºä½†åˆä¸éœ€è¦ä½¿ç”¨æ’åºç®—æ³•å°±èƒ½å¤„ç†çš„æ’åºé—®é¢˜ã€‚</p><p>å‡è®¾æˆ‘ä»¬ç°åœ¨éœ€è¦å¯¹ Dï¼Œaï¼ŒFï¼ŒBï¼Œcï¼ŒAï¼Œz è¿™ä¸ªå­—ç¬¦ä¸²è¿›è¡Œæ’åºï¼Œè¦æ±‚å°†å…¶ä¸­æ‰€æœ‰å°å†™å­—æ¯éƒ½æ’åœ¨å¤§å†™å­—æ¯çš„å‰é¢ï¼Œä½†å°å†™å­—æ¯å†…éƒ¨å’Œå¤§å†™å­—æ¯å†…éƒ¨ä¸è¦æ±‚æœ‰åºã€‚æ¯”å¦‚ç»è¿‡æ’åºä¹‹åä¸º aï¼Œcï¼Œzï¼ŒDï¼ŒFï¼ŒBï¼ŒAï¼Œè¿™ä¸ªå¦‚ä½•æ¥å®ç°å‘¢ï¼Ÿå¦‚æœå­—ç¬¦ä¸²ä¸­å­˜å‚¨çš„ä¸ä»…æœ‰å¤§å°å†™å­—æ¯ï¼Œè¿˜æœ‰æ•°å­—ã€‚è¦å°†å°å†™å­—æ¯çš„æ”¾åˆ°å‰é¢ï¼Œå¤§å†™å­—æ¯æ”¾åœ¨æœ€åï¼Œæ•°å­—æ”¾åœ¨ä¸­é—´ï¼Œä¸ç”¨æ’åºç®—æ³•ï¼Œåˆè¯¥æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ</p><blockquote></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é™æµç®—æ³•åŸç†åŠå®ç°</title>
      <link href="/posts/29743003.html"/>
      <url>/posts/29743003.html</url>
      
        <content type="html"><![CDATA[<hr><p>[TOC]</p><h2 id="é™æµçš„ç®—æ³•æœ‰å“ªäº›ï¼Ÿ"><a href="#é™æµçš„ç®—æ³•æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="é™æµçš„ç®—æ³•æœ‰å“ªäº›ï¼Ÿ"></a>é™æµçš„ç®—æ³•æœ‰å“ªäº›ï¼Ÿ</h2><p>æœ¬æ–‡ä»‹ç»å‡ ç§æœ€å¸¸ç”¨çš„é™æµç®—æ³•ï¼š</p><ul><li>å›ºå®šçª—å£è®¡æ•°å™¨ï¼›</li><li>æ»‘åŠ¨çª—å£è®¡æ•°å™¨ï¼›</li><li>æ¼æ¡¶ï¼›</li><li>ä»¤ç‰Œæ¡¶ã€‚</li></ul><h3 id="å›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³•"><a href="#å›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³•" class="headerlink" title="å›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³•"></a>å›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³•</h3><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210620222717.png" alt="å›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³•"></p><p>å›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³•æ¦‚å¿µå¦‚ä¸‹ï¼š</p><ul><li><p>å°†æ—¶é—´åˆ’åˆ†ä¸ºå¤šä¸ªçª—å£ï¼›</p></li><li><p>åœ¨æ¯ä¸ªçª—å£å†…æ¯æœ‰ä¸€æ¬¡è¯·æ±‚å°±å°†è®¡æ•°å™¨åŠ ä¸€ï¼›</p></li><li><p>å¦‚æœè®¡æ•°å™¨è¶…è¿‡äº†é™åˆ¶æ•°é‡ï¼Œåˆ™æœ¬çª—å£å†…æ‰€æœ‰çš„è¯·æ±‚éƒ½è¢«ä¸¢å¼ƒå½“æ—¶é—´åˆ°è¾¾ä¸‹ä¸€ä¸ªçª—å£æ—¶ï¼Œè®¡æ•°å™¨é‡ç½®ã€‚</p></li></ul><p>å›ºå®šçª—å£è®¡æ•°å™¨æ˜¯æœ€ä¸ºç®€å•çš„ç®—æ³•ï¼Œä½†è¿™ä¸ªç®—æ³•æœ‰æ—¶ä¼šè®©é€šè¿‡è¯·æ±‚é‡å…è®¸ä¸ºé™åˆ¶çš„ä¸¤å€ã€‚è€ƒè™‘å¦‚ä¸‹æƒ…å†µï¼šé™åˆ¶1ç§’å†…æœ€å¤šé€šè¿‡5ä¸ªè¯·æ±‚ï¼Œåœ¨ç¬¬ä¸€ä¸ªçª—å£çš„æœ€ååŠç§’å†…é€šè¿‡äº†5ä¸ªè¯·æ±‚ï¼Œç¬¬äºŒä¸ªçª—å£çš„å‰åŠç§’å†…åˆé€šè¿‡äº†5ä¸ªè¯·æ±‚ã€‚è¿™æ ·çœ‹æ¥å°±æ˜¯åœ¨1ç§’å†…é€šè¿‡äº†10ä¸ªè¯·æ±‚ã€‚ </p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210620222813.png" alt="å›¾ç‰‡"></p><h4 id="ä»£ç å®ç°ï¼š"><a href="#ä»£ç å®ç°ï¼š" class="headerlink" title="ä»£ç å®ç°ï¼š"></a>ä»£ç å®ç°ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æœ€å¤§è®¿é—®æ•°é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">limit</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¿é—®æ—¶é—´å·®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">timeout</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯·æ±‚æ—¶é—´</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> Long time;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½“å‰è®¡æ•°å™¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">AtomicInteger</span> <span class="variable">reqCount</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">limit</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–time</span></span><br><span class="line">        <span class="keyword">if</span> (time == <span class="literal">null</span>) &#123;</span><br><span class="line">            time = System.currentTimeMillis();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">now</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">if</span> (now &lt; time + timeout) &#123;</span><br><span class="line">            <span class="comment">// å•ä½æ—¶é—´å†…</span></span><br><span class="line">            reqCount.addAndGet(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> reqCount.get() &lt;= limit;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            time = now;</span><br><span class="line">            reqCount.set(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="æ»‘åŠ¨çª—å£è®¡æ•°å™¨ç®—æ³•"><a href="#æ»‘åŠ¨çª—å£è®¡æ•°å™¨ç®—æ³•" class="headerlink" title="æ»‘åŠ¨çª—å£è®¡æ•°å™¨ç®—æ³•"></a>æ»‘åŠ¨çª—å£è®¡æ•°å™¨ç®—æ³•</h3><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210620222921.png" alt="æ»‘åŠ¨çª—å£è®¡æ•°å™¨ç®—æ³•"></p><p>æ»‘åŠ¨çª—å£è®¡æ•°å™¨ç®—æ³•æ¦‚å¿µå¦‚ä¸‹ï¼š</p><ul><li>å°†æ—¶é—´åˆ’åˆ†ä¸ºå¤šä¸ªåŒºé—´ï¼›</li><li>åœ¨æ¯ä¸ªåŒºé—´å†…æ¯æœ‰ä¸€æ¬¡è¯·æ±‚å°±å°†è®¡æ•°å™¨åŠ ä¸€ç»´æŒä¸€ä¸ªæ—¶é—´çª—å£ï¼Œå æ®å¤šä¸ªåŒºé—´ï¼›</li><li>æ¯ç»è¿‡ä¸€ä¸ªåŒºé—´çš„æ—¶é—´ï¼Œåˆ™æŠ›å¼ƒæœ€è€çš„ä¸€ä¸ªåŒºé—´ï¼Œå¹¶çº³å…¥æœ€æ–°çš„ä¸€ä¸ªåŒºé—´ï¼›</li><li>å¦‚æœå½“å‰çª—å£å†…åŒºé—´çš„è¯·æ±‚è®¡æ•°æ€»å’Œè¶…è¿‡äº†é™åˆ¶æ•°é‡ï¼Œåˆ™æœ¬çª—å£å†…æ‰€æœ‰çš„è¯·æ±‚éƒ½è¢«ä¸¢å¼ƒã€‚</li></ul><p>æ»‘åŠ¨çª—å£è®¡æ•°å™¨æ˜¯é€šè¿‡å°†çª—å£å†ç»†åˆ†ï¼Œå¹¶ä¸”æŒ‰ç…§æ—¶é—´â€æ»‘åŠ¨â€ï¼Œè¿™ç§ç®—æ³•é¿å…äº†å›ºå®šçª—å£è®¡æ•°å™¨å¸¦æ¥çš„åŒå€çªå‘è¯·æ±‚ï¼Œä½†æ—¶é—´åŒºé—´çš„ç²¾åº¦è¶Šé«˜ï¼Œç®—æ³•æ‰€éœ€çš„ç©ºé—´å®¹é‡å°±è¶Šå¤§ã€‚</p><h4 id="ä»£ç å®ç°ï¼š-1"><a href="#ä»£ç å®ç°ï¼š-1" class="headerlink" title="ä»£ç å®ç°ï¼š"></a>ä»£ç å®ç°ï¼š</h4><h5 id="1-TreeMapç‰ˆ"><a href="#1-TreeMapç‰ˆ" class="headerlink" title="1.TreeMapç‰ˆ"></a>1.TreeMapç‰ˆ</h5><p>å› ä¸ºTreeMapæ²¡æœ‰çº¿ç¨‹å®‰å…¨ç‰ˆæœ¬ï¼Œæ‰€ä»¥ä½¿ç”¨synchronizedä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.TreeMap;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SlidingWindowRateLimiter</span> <span class="keyword">implements</span> <span class="title class_">MyRateLimiter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¯åˆ†é’Ÿé™åˆ¶è¯·æ±‚æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> permitsPerMinute;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ—¶é—´çª—å£é—´éš”ç§’æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> seconds;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¡æ•°å™¨, keyä¸ºå½“å‰çª—å£çš„å¼€å§‹æ—¶é—´å€¼æ¯«ç§’ï¼Œvalueä¸ºå½“å‰çª—å£çš„è®¡æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TreeMap&lt;Long, Integer&gt; counters;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SlidingWindowRateLimiter</span><span class="params">(<span class="type">long</span> permitsPerMinute, <span class="type">int</span> seconds)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.permitsPerMinute = permitsPerMinute;</span><br><span class="line">        <span class="built_in">this</span>.seconds = seconds;</span><br><span class="line">        <span class="built_in">this</span>.counters = <span class="keyword">new</span> <span class="title class_">TreeMap</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="type">boolean</span> <span class="title function_">tryAcquire</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–å½“å‰æ—¶é—´çš„æ‰€åœ¨çš„å­çª—å£å€¼</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">currentTimeMillis</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// è·å–å½“å‰çª—å£çš„è¯·æ±‚æ€»é‡</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">currentWindowCount</span> <span class="operator">=</span> getCurrentWindowCount(currentTimeMillis);</span><br><span class="line">        System.out.println(<span class="string">&quot;å½“å‰çª—å£è®¡æ•°ï¼š&quot;</span> + currentWindowCount);</span><br><span class="line">        <span class="keyword">if</span> (currentWindowCount &gt;= permitsPerMinute) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è®¡æ•°å™¨ + 1</span></span><br><span class="line">        saveCurrentTime(currentTimeMillis);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¡æ—¶å™¨ +1</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">saveCurrentTime</span><span class="params">(<span class="type">long</span> currentTimeMillis)</span> &#123;</span><br><span class="line">        counters.merge(currentTimeMillis, <span class="number">1</span>, Integer::sum);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å½“å‰çª—å£ä¸­çš„æ‰€æœ‰è¯·æ±‚æ•°ï¼ˆå¹¶åˆ é™¤æ‰€æœ‰æ— æ•ˆçš„å­çª—å£è®¡æ•°å™¨ï¼‰</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> currentTimesMills å½“å‰å­çª—å£æ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å½“å‰çª—å£ä¸­çš„è®¡æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">getCurrentWindowCount</span><span class="params">(<span class="type">long</span> currentTimesMills)</span> &#123;</span><br><span class="line">        <span class="comment">// è®¡ç®—å‡ºçª—å£çš„å¼€å§‹ä½ç½®æ—¶é—´</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> currentTimesMills - (seconds * <span class="number">1000L</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// éå†å½“å‰å­˜å‚¨çš„è®¡ç®—å™¨ï¼Œåˆ é™¤æ— æ•ˆçš„å­çª—å£è®¡æ•°å™¨ï¼Œå¹¶ç´¯åŠ å½“å‰çª—å£ä¸­çš„æ‰€æœ‰è®¡æ•°å™¨ä¹‹å’Œ</span></span><br><span class="line">        Iterator&lt;Map.Entry&lt;Long, Integer&gt;&gt; iterator = counters.entrySet().iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            Map.Entry&lt;Long, Integer&gt; entry = iterator.next();</span><br><span class="line">            <span class="type">Long</span> <span class="variable">time</span> <span class="operator">=</span> entry.getKey();</span><br><span class="line">            <span class="keyword">if</span> (time &lt; startTime) &#123;</span><br><span class="line">                iterator.remove();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                result += entry.getValue();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// å°†æ—¶é—´åˆ†ç‰‡ï¼Œsecondsæ˜¯æ—¶é—´çª—å£å¤§å°ï¼Œmaxä»£è¡¨secondsæ—¶é—´æœ€å¤§è®¿é—®ä¸Šé™</span></span><br><span class="line">        <span class="type">MyRateLimiter</span> <span class="variable">myRateLimiter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SlidingWindowRateLimiter</span>(<span class="number">10</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">requestCnt</span> <span class="operator">=</span> <span class="number">60</span>;</span><br><span class="line">        <span class="type">AtomicInteger</span> <span class="variable">successCnt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>();</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; requestCnt; i++) &#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> myRateLimiter.tryAcquire();</span><br><span class="line">            <span class="keyword">if</span> (result) &#123;</span><br><span class="line">                successCnt.incrementAndGet();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">String</span> <span class="variable">resultStr</span> <span class="operator">=</span> result ? <span class="string">&quot;è¯·æ±‚æˆåŠŸ&quot;</span> : <span class="string">&quot;è¯·æ±‚å¤±è´¥&quot;</span>;</span><br><span class="line">            <span class="type">long</span> <span class="variable">now</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">            System.out.println(<span class="string">&quot;ç¬¬&quot;</span> + (i + <span class="number">1</span>) + <span class="string">&quot;æ¬¡è¯·æ±‚ç»“æœï¼š&quot;</span> + resultStr + <span class="string">&quot;ï¼Œè€—æ—¶ï¼š&quot;</span> + (now - start));</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;å…¨éƒ¨è¯·æ±‚ç»“æŸï¼ŒæˆåŠŸç‡ï¼š&quot;</span> + (successCnt.get() * <span class="number">100</span> / requestCnt) + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="2-ConcurrentLinkedQueueç‰ˆ"><a href="#2-ConcurrentLinkedQueueç‰ˆ" class="headerlink" title="2.ConcurrentLinkedQueueç‰ˆ"></a>2.ConcurrentLinkedQueueç‰ˆ</h5><p>å› ä¸ºConcurrentLinkedQueueå·²ç»ä¿è¯äº†çº¿ç¨‹å®‰å…¨ï¼Œæ‰€ä»¥æ— éœ€åŠ é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentLinkedQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcurrentSlidingWindowRateLimiter</span> <span class="keyword">implements</span> <span class="title class_">MyRateLimiter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¯åˆ†é’Ÿé™åˆ¶è¯·æ±‚æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> permitsPerMinute;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ—¶é—´çª—å£é—´éš”ç§’æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> seconds;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿å­˜æ—¶é—´æˆ³çš„é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConcurrentLinkedQueue&lt;Long&gt; queue;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConcurrentSlidingWindowRateLimiter</span><span class="params">(<span class="type">long</span> permitsPerMinute, <span class="type">int</span> seconds)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.permitsPerMinute = permitsPerMinute;</span><br><span class="line">        <span class="built_in">this</span>.seconds = seconds;</span><br><span class="line">        <span class="built_in">this</span>.queue = <span class="keyword">new</span> <span class="title class_">ConcurrentLinkedQueue</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryAcquire</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">currentTimeMillis</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">currentWindowCount</span> <span class="operator">=</span> getCurrentWindowCount(currentTimeMillis);</span><br><span class="line">        System.out.println(<span class="string">&quot;å½“å‰çª—å£è®¡æ•°ï¼š&quot;</span> + currentWindowCount);</span><br><span class="line">        <span class="keyword">if</span> (currentWindowCount &gt;= permitsPerMinute) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ä¿å­˜å½“å‰æ—¶é—´åˆ°é˜Ÿåˆ—</span></span><br><span class="line">        saveCurrentTime(currentTimeMillis);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">saveCurrentTime</span><span class="params">(<span class="type">long</span> currentTimeMillis)</span> &#123;</span><br><span class="line">        queue.offer(currentTimeMillis);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">getCurrentWindowCount</span><span class="params">(<span class="type">long</span> currentTimesMills)</span> &#123;</span><br><span class="line">        <span class="comment">// è®¡ç®—å‡ºçª—å£çš„å¼€å§‹ä½ç½®æ—¶é—´</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> currentTimesMills - (seconds * <span class="number">1000L</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// éå†å½“å‰å­˜å‚¨çš„é˜Ÿåˆ—ï¼Œåˆ é™¤æ— æ•ˆçš„å…ƒç´ ï¼Œå¹¶ç´¯åŠ å½“å‰çª—å£ä¸­çš„æ‰€æœ‰è®¡æ•°å™¨ä¹‹å’Œ</span></span><br><span class="line">        Iterator&lt;Long&gt; iterator = queue.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            <span class="type">Long</span> <span class="variable">time</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">            <span class="keyword">if</span> (time &lt; startTime) &#123;</span><br><span class="line">                iterator.remove();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                result++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// å°†æ—¶é—´åˆ†ç‰‡ï¼Œsecondsæ˜¯æ—¶é—´çª—å£å¤§å°ï¼Œmaxä»£è¡¨secondsæ—¶é—´æœ€å¤§è®¿é—®ä¸Šé™</span></span><br><span class="line">        <span class="type">MyRateLimiter</span> <span class="variable">myRateLimiter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcurrentSlidingWindowRateLimiter</span>(<span class="number">10</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">requestCnt</span> <span class="operator">=</span> <span class="number">60</span>;</span><br><span class="line">        <span class="type">AtomicInteger</span> <span class="variable">successCnt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>();</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; requestCnt; i++) &#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> myRateLimiter.tryAcquire();</span><br><span class="line">            <span class="keyword">if</span> (result) &#123;</span><br><span class="line">                successCnt.incrementAndGet();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">String</span> <span class="variable">resultStr</span> <span class="operator">=</span> result ? <span class="string">&quot;è¯·æ±‚æˆåŠŸ&quot;</span> : <span class="string">&quot;è¯·æ±‚å¤±è´¥&quot;</span>;</span><br><span class="line">            <span class="type">long</span> <span class="variable">now</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">            System.out.println(<span class="string">&quot;ç¬¬&quot;</span> + (i + <span class="number">1</span>) + <span class="string">&quot;æ¬¡è¯·æ±‚ç»“æœï¼š&quot;</span> + resultStr + <span class="string">&quot;ï¼Œè€—æ—¶ï¼š&quot;</span> + (now - start));</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;å…¨éƒ¨è¯·æ±‚ç»“æŸï¼ŒæˆåŠŸç‡ï¼š&quot;</span> + (successCnt.get() * <span class="number">100</span> / requestCnt) + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="æ¼æ¡¶ç®—æ³•"><a href="#æ¼æ¡¶ç®—æ³•" class="headerlink" title="æ¼æ¡¶ç®—æ³•"></a>æ¼æ¡¶ç®—æ³•</h3><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210620202857.png" alt="æ¼æ¡¶ç®—æ³•"></p><p>æ¼æ¡¶ç®—æ³•æ¦‚å¿µå¦‚ä¸‹ï¼š</p><ul><li>å°†æ¯ä¸ªè¯·æ±‚è§†ä½œâ€æ°´æ»´â€æ”¾å…¥â€æ¼æ¡¶â€è¿›è¡Œå­˜å‚¨ï¼›</li><li>â€œæ¼æ¡¶â€ä»¥å›ºå®šé€Ÿç‡å‘å¤–â€æ¼â€å‡ºè¯·æ±‚æ¥æ‰§è¡Œå¦‚æœâ€æ¼æ¡¶â€ç©ºäº†åˆ™åœæ­¢â€æ¼æ°´â€ï¼›</li><li>å¦‚æœâ€æ¼æ¡¶â€æ»¡äº†åˆ™å¤šä½™çš„â€æ°´æ»´â€ä¼šè¢«ç›´æ¥ä¸¢å¼ƒã€‚</li></ul><p>æ¼æ¡¶ç®—æ³•å¤šä½¿ç”¨é˜Ÿåˆ—å®ç°ï¼ŒæœåŠ¡çš„è¯·æ±‚ä¼šå­˜åˆ°é˜Ÿåˆ—ä¸­ï¼ŒæœåŠ¡çš„æä¾›æ–¹åˆ™æŒ‰ç…§å›ºå®šçš„é€Ÿç‡ä»é˜Ÿåˆ—ä¸­å–å‡ºè¯·æ±‚å¹¶æ‰§è¡Œï¼Œè¿‡å¤šçš„è¯·æ±‚åˆ™æ”¾åœ¨é˜Ÿåˆ—ä¸­æ’é˜Ÿæˆ–ç›´æ¥æ‹’ç»ã€‚</p><p>æ¼æ¡¶ç®—æ³•çš„ç¼ºé™·ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå½“çŸ­æ—¶é—´å†…æœ‰å¤§é‡çš„çªå‘è¯·æ±‚æ—¶ï¼Œå³ä¾¿æ­¤æ—¶æœåŠ¡å™¨æ²¡æœ‰ä»»ä½•è´Ÿè½½ï¼Œæ¯ä¸ªè¯·æ±‚ä¹Ÿéƒ½å¾—åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ä¸€æ®µæ—¶é—´æ‰èƒ½è¢«å“åº”ã€‚</p><h4 id="ä»£ç å®ç°ï¼š-2"><a href="#ä»£ç å®ç°ï¼š-2" class="headerlink" title="ä»£ç å®ç°ï¼š"></a>ä»£ç å®ç°ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.Queue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ScheduledExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeakBucketRateLimiter</span> <span class="keyword">implements</span> <span class="title class_">MyRateLimiter</span> &#123;</span><br><span class="line">    <span class="comment">// æ¡¶çš„å®¹é‡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">double</span> capacity;</span><br><span class="line">    <span class="comment">// æ¼å‡ºé€Ÿç‡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">double</span> permitsPerSecond;</span><br><span class="line">    <span class="comment">// å‰©ä½™æ°´é‡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> leftWater;</span><br><span class="line">    <span class="comment">// ä¸Šæ¬¡æ³¨å…¥æ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="variable">timestamp</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LeakBucketRateLimiter</span><span class="params">(<span class="type">double</span> capacity, <span class="type">double</span> permitsPerSecond)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">        <span class="built_in">this</span>.permitsPerSecond = permitsPerSecond;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryAcquire</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// è®¡ç®—å‰©ä½™æµé‡</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">now</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// leftWateræœ‰å¯å·²ç»æ˜¯0ï¼Œæ‰€ä»¥å‡å®Œä¼šå˜æˆè´Ÿæ•°ï¼Œæ‰€ä»¥è¦å’Œ0å–ä¸ªæœ€å¤§å€¼</span></span><br><span class="line">        leftWater = Math.max(<span class="number">0</span>, leftWater - ((now - timestamp) / <span class="number">1000d</span> * permitsPerSecond));</span><br><span class="line">        System.out.println(<span class="string">&quot;leftWater = &quot;</span> + leftWater);</span><br><span class="line">        timestamp = now;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœæœªæ»¡ï¼Œåˆ™æ”¾è¡Œï¼›å¦åˆ™é™æµ</span></span><br><span class="line">        <span class="keyword">if</span> (leftWater &lt; capacity) &#123;</span><br><span class="line">            leftWater++;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testLeakBucketRateLimiter</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">ScheduledExecutorService</span> <span class="variable">scheduledExecutorService</span> <span class="operator">=</span> Executors.newSingleThreadScheduledExecutor();</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">singleThread</span> <span class="operator">=</span> Executors.newSingleThreadExecutor();</span><br><span class="line"></span><br><span class="line">        <span class="type">LeakBucketRateLimiter</span> <span class="variable">rateLimiter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LeakBucketRateLimiter</span>(<span class="number">20</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// å­˜å‚¨æµé‡çš„é˜Ÿåˆ—</span></span><br><span class="line">        Queue&lt;Integer&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿè¯·æ±‚  ä¸ç¡®å®šé€Ÿç‡æ³¨æ°´</span></span><br><span class="line">        singleThread.execute(() -&gt; &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                index++;</span><br><span class="line">                <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> rateLimiter.tryAcquire();</span><br><span class="line">                <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">                    queue.offer(index);</span><br><span class="line">                    System.out.println(index + <span class="string">&quot;--------æµé‡è¢«æ”¾è¡Œ----------&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    System.out.println(index + <span class="string">&quot;æµé‡è¢«é™åˆ¶&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep((<span class="type">long</span>) (Math.random() * <span class="number">1000</span>));</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿå¤„ç†è¯·æ±‚ å›ºå®šé€Ÿç‡æ¼æ°´</span></span><br><span class="line">        scheduledExecutorService.scheduleAtFixedRate(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (!queue.isEmpty()) &#123;</span><br><span class="line">                System.out.println(queue.poll() + <span class="string">&quot;è¢«å¤„ç†&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">0</span>, <span class="number">100</span>, TimeUnit.MILLISECONDS);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¿è¯ä¸»çº¿ç¨‹ä¸ä¼šé€€å‡º</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            Thread.sleep(<span class="number">10000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä»¤ç‰Œæ¡¶ç®—æ³•"><a href="#ä»¤ç‰Œæ¡¶ç®—æ³•" class="headerlink" title="ä»¤ç‰Œæ¡¶ç®—æ³•"></a>ä»¤ç‰Œæ¡¶ç®—æ³•</h3><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210620202929.png" alt="ä»¤ç‰Œæ¡¶ç®—æ³•"></p><p>ä»¤ç‰Œæ¡¶ç®—æ³•æ¦‚å¿µå¦‚ä¸‹ï¼š</p><ul><li>ä»¤ç‰Œä»¥å›ºå®šé€Ÿç‡ç”Ÿæˆï¼›</li><li>ç”Ÿæˆçš„ä»¤ç‰Œæ”¾å…¥ä»¤ç‰Œæ¡¶ä¸­å­˜æ”¾ï¼Œå¦‚æœä»¤ç‰Œæ¡¶æ»¡äº†åˆ™å¤šä½™çš„ä»¤ç‰Œä¼šç›´æ¥ä¸¢å¼ƒï¼Œå½“è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œä¼šå°è¯•ä»ä»¤ç‰Œæ¡¶ä¸­å–ä»¤ç‰Œï¼Œå–åˆ°äº†ä»¤ç‰Œçš„è¯·æ±‚å¯ä»¥æ‰§è¡Œï¼›</li><li>å¦‚æœæ¡¶ç©ºäº†ï¼Œé‚£ä¹ˆå°è¯•å–ä»¤ç‰Œçš„è¯·æ±‚ä¼šè¢«ç›´æ¥ä¸¢å¼ƒã€‚</li></ul><p>ä»¤ç‰Œæ¡¶ç®—æ³•æ—¢èƒ½å¤Ÿå°†æ‰€æœ‰çš„è¯·æ±‚å¹³å‡åˆ†å¸ƒåˆ°æ—¶é—´åŒºé—´å†…ï¼Œåˆèƒ½æ¥å—æœåŠ¡å™¨èƒ½å¤Ÿæ‰¿å—èŒƒå›´å†…çš„çªå‘è¯·æ±‚ï¼Œå› æ­¤æ˜¯ç›®å‰ä½¿ç”¨è¾ƒä¸ºå¹¿æ³›çš„ä¸€ç§é™æµç®—æ³•ã€‚</p><h4 id="ä»£ç å®ç°ï¼š-3"><a href="#ä»£ç å®ç°ï¼š-3" class="headerlink" title="ä»£ç å®ç°ï¼š"></a>ä»£ç å®ç°ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//todo å¾…è¡¥å……</span></span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol><li><a href="https://mp.weixin.qq.com/s?__biz=MzkwOTIxNDQ3OA==&mid=2247532784&idx=1&sn=4105e55673af275ea26701cb6070ab48&source=41#wechat_redirect">åˆ†å¸ƒå¼æœåŠ¡é™æµå®æˆ˜</a></li><li><a href="https://doocs.github.io/advanced-java/#/./docs/high-concurrency/huifer-how-to-limit-current">é™æµç®—æ³•å®ç°</a></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> é¢ç» </tag>
            
            <tag> é™æµç®—æ³•åŸç†åŠå®ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>11è®²</title>
      <link href="/posts/a0ee3b30.html"/>
      <url>/posts/a0ee3b30.html</url>
      
        <content type="html"><![CDATA[<hr><h1 id="11-æ’åºï¼ˆä¸Šï¼‰ï¼šä¸ºä»€ä¹ˆæ’å…¥æ’åºæ¯”å†’æ³¡æ’åºæ›´å—æ¬¢è¿ï¼Ÿ"><a href="#11-æ’åºï¼ˆä¸Šï¼‰ï¼šä¸ºä»€ä¹ˆæ’å…¥æ’åºæ¯”å†’æ³¡æ’åºæ›´å—æ¬¢è¿ï¼Ÿ" class="headerlink" title="11 | æ’åºï¼ˆä¸Šï¼‰ï¼šä¸ºä»€ä¹ˆæ’å…¥æ’åºæ¯”å†’æ³¡æ’åºæ›´å—æ¬¢è¿ï¼Ÿ"></a>11 | æ’åºï¼ˆä¸Šï¼‰ï¼šä¸ºä»€ä¹ˆæ’å…¥æ’åºæ¯”å†’æ³¡æ’åºæ›´å—æ¬¢è¿ï¼Ÿ</h1><p>æ’åºç®—æ³•å¤ªå¤šäº†ï¼Œæœ‰å¾ˆå¤šå¯èƒ½ä½ è¿åå­—éƒ½æ²¡å¬è¯´è¿‡ï¼Œæ¯”å¦‚çŒ´å­æ’åºã€ç¡çœ æ’åºã€é¢æ¡æ’åºç­‰ã€‚æˆ‘åªè®²ä¼—å¤šæ’åºç®—æ³•ä¸­çš„ä¸€å°æ’®ï¼Œä¹Ÿæ˜¯æœ€ç»å…¸çš„ã€æœ€å¸¸ç”¨çš„ï¼šå†’æ³¡æ’åºã€æ’å…¥æ’åºã€é€‰æ‹©æ’åºã€å½’å¹¶æ’åºã€å¿«é€Ÿæ’åºã€è®¡æ•°æ’åºã€åŸºæ•°æ’åºã€æ¡¶æ’åºã€‚æˆ‘æŒ‰ç…§æ—¶é—´å¤æ‚åº¦æŠŠå®ƒä»¬åˆ†æˆäº†ä¸‰ç±»ï¼Œåˆ†ä¸‰èŠ‚è¯¾æ¥è®²è§£ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210613203106.jpeg" alt="img"></p><p>å¸¦ç€é—®é¢˜å»å­¦ä¹ ï¼Œæ˜¯æœ€æœ‰æ•ˆçš„å­¦ä¹ æ–¹æ³•ã€‚æ‰€ä»¥æŒ‰ç…§æƒ¯ä¾‹ï¼Œæˆ‘è¿˜æ˜¯å…ˆç»™ä½ å‡ºä¸€ä¸ªæ€è€ƒé¢˜ï¼š<strong>æ’å…¥æ’åºå’Œå†’æ³¡æ’åºçš„æ—¶é—´å¤æ‚åº¦ç›¸åŒï¼Œéƒ½æ˜¯ O(n^2)ï¼Œåœ¨å®é™…çš„è½¯ä»¶å¼€å‘é‡Œï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬æ›´å€¾å‘äºä½¿ç”¨æ’å…¥æ’åºç®—æ³•è€Œä¸æ˜¯å†’æ³¡æ’åºç®—æ³•å‘¢ï¼Ÿ</strong></p><span id="more"></span><h2 id="å¦‚ä½•åˆ†æä¸€ä¸ªâ€œæ’åºç®—æ³•â€ï¼Ÿ"><a href="#å¦‚ä½•åˆ†æä¸€ä¸ªâ€œæ’åºç®—æ³•â€ï¼Ÿ" class="headerlink" title="å¦‚ä½•åˆ†æä¸€ä¸ªâ€œæ’åºç®—æ³•â€ï¼Ÿ"></a>å¦‚ä½•åˆ†æä¸€ä¸ªâ€œæ’åºç®—æ³•â€ï¼Ÿ</h2><h3 id="æ’åºç®—æ³•çš„æ‰§è¡Œæ•ˆç‡"><a href="#æ’åºç®—æ³•çš„æ‰§è¡Œæ•ˆç‡" class="headerlink" title="æ’åºç®—æ³•çš„æ‰§è¡Œæ•ˆç‡"></a>æ’åºç®—æ³•çš„æ‰§è¡Œæ•ˆç‡</h3><p>å¯¹äºæ’åºç®—æ³•æ‰§è¡Œæ•ˆç‡çš„åˆ†æï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šä»è¿™å‡ ä¸ªæ–¹é¢æ¥è¡¡é‡ï¼š</p><h4 id="1-æœ€å¥½æƒ…å†µã€æœ€åæƒ…å†µã€å¹³å‡æƒ…å†µæ—¶é—´å¤æ‚åº¦"><a href="#1-æœ€å¥½æƒ…å†µã€æœ€åæƒ…å†µã€å¹³å‡æƒ…å†µæ—¶é—´å¤æ‚åº¦" class="headerlink" title="1.æœ€å¥½æƒ…å†µã€æœ€åæƒ…å†µã€å¹³å‡æƒ…å†µæ—¶é—´å¤æ‚åº¦"></a>1.æœ€å¥½æƒ…å†µã€æœ€åæƒ…å†µã€å¹³å‡æƒ…å†µæ—¶é—´å¤æ‚åº¦</h4><p>æˆ‘ä»¬åœ¨åˆ†ææ’åºç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ—¶ï¼Œè¦åˆ†åˆ«ç»™å‡ºæœ€å¥½æƒ…å†µã€æœ€åæƒ…å†µã€å¹³å‡æƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä½ è¿˜è¦è¯´å‡ºæœ€å¥½ã€æœ€åæ—¶é—´å¤æ‚åº¦å¯¹åº”çš„è¦æ’åºçš„åŸå§‹æ•°æ®æ˜¯ä»€ä¹ˆæ ·çš„ã€‚</p><p>ä¸ºä»€ä¹ˆè¦åŒºåˆ†è¿™ä¸‰ç§æ—¶é—´å¤æ‚åº¦å‘¢ï¼Ÿç¬¬ä¸€ï¼Œæœ‰äº›æ’åºç®—æ³•ä¼šåŒºåˆ†ï¼Œä¸ºäº†å¥½å¯¹æ¯”ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€å¥½éƒ½åšä¸€ä¸‹åŒºåˆ†ã€‚ç¬¬äºŒï¼Œå¯¹äºè¦æ’åºçš„æ•°æ®ï¼Œæœ‰çš„æ¥è¿‘æœ‰åºï¼Œæœ‰çš„å®Œå…¨æ— åºã€‚æœ‰åºåº¦ä¸åŒçš„æ•°æ®ï¼Œå¯¹äºæ’åºçš„æ‰§è¡Œæ—¶é—´è‚¯å®šæ˜¯æœ‰å½±å“çš„ï¼Œæˆ‘ä»¬è¦çŸ¥é“æ’åºç®—æ³•åœ¨ä¸åŒæ•°æ®ä¸‹çš„æ€§èƒ½è¡¨ç°ã€‚</p><h4 id="2-æ—¶é—´å¤æ‚åº¦çš„ç³»æ•°ã€å¸¸æ•°-ã€ä½é˜¶"><a href="#2-æ—¶é—´å¤æ‚åº¦çš„ç³»æ•°ã€å¸¸æ•°-ã€ä½é˜¶" class="headerlink" title="2.æ—¶é—´å¤æ‚åº¦çš„ç³»æ•°ã€å¸¸æ•° ã€ä½é˜¶"></a>2.æ—¶é—´å¤æ‚åº¦çš„ç³»æ•°ã€å¸¸æ•° ã€ä½é˜¶</h4><p>æˆ‘ä»¬çŸ¥é“ï¼Œæ—¶é—´å¤æ‚åº¦åæ˜ çš„æ˜¯æ•°æ®è§„æ¨¡ n å¾ˆå¤§çš„æ—¶å€™çš„ä¸€ä¸ªå¢é•¿è¶‹åŠ¿ï¼Œæ‰€ä»¥å®ƒè¡¨ç¤ºçš„æ—¶å€™ä¼šå¿½ç•¥ç³»æ•°ã€å¸¸æ•°ã€ä½é˜¶ã€‚ä½†æ˜¯å®é™…çš„è½¯ä»¶å¼€å‘ä¸­ï¼Œæˆ‘ä»¬æ’åºçš„å¯èƒ½æ˜¯ 10 ä¸ªã€100 ä¸ªã€1000 ä¸ªè¿™æ ·è§„æ¨¡å¾ˆå°çš„æ•°æ®ï¼Œæ‰€ä»¥ï¼Œåœ¨å¯¹åŒä¸€é˜¶æ—¶é—´å¤æ‚åº¦çš„æ’åºç®—æ³•æ€§èƒ½å¯¹æ¯”çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±è¦æŠŠç³»æ•°ã€å¸¸æ•°ã€ä½é˜¶ä¹Ÿè€ƒè™‘è¿›æ¥ã€‚</p><h4 id="3-æ¯”è¾ƒæ¬¡æ•°å’Œäº¤æ¢ï¼ˆæˆ–ç§»åŠ¨ï¼‰æ¬¡æ•°"><a href="#3-æ¯”è¾ƒæ¬¡æ•°å’Œäº¤æ¢ï¼ˆæˆ–ç§»åŠ¨ï¼‰æ¬¡æ•°" class="headerlink" title="3.æ¯”è¾ƒæ¬¡æ•°å’Œäº¤æ¢ï¼ˆæˆ–ç§»åŠ¨ï¼‰æ¬¡æ•°"></a>3.æ¯”è¾ƒæ¬¡æ•°å’Œäº¤æ¢ï¼ˆæˆ–ç§»åŠ¨ï¼‰æ¬¡æ•°</h4><p>è¿™ä¸€èŠ‚å’Œä¸‹ä¸€èŠ‚è®²çš„éƒ½æ˜¯åŸºäºæ¯”è¾ƒçš„æ’åºç®—æ³•ã€‚åŸºäºæ¯”è¾ƒçš„æ’åºç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œä¼šæ¶‰åŠä¸¤ç§æ“ä½œï¼Œä¸€ç§æ˜¯å…ƒç´ æ¯”è¾ƒå¤§å°ï¼Œå¦ä¸€ç§æ˜¯å…ƒç´ äº¤æ¢æˆ–ç§»åŠ¨ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬åœ¨åˆ†ææ’åºç®—æ³•çš„æ‰§è¡Œæ•ˆç‡çš„æ—¶å€™ï¼Œåº”è¯¥æŠŠæ¯”è¾ƒæ¬¡æ•°å’Œäº¤æ¢ï¼ˆæˆ–ç§»åŠ¨ï¼‰æ¬¡æ•°ä¹Ÿè€ƒè™‘è¿›å»ã€‚</p><h3 id="æ’åºç®—æ³•çš„å†…å­˜æ¶ˆè€—"><a href="#æ’åºç®—æ³•çš„å†…å­˜æ¶ˆè€—" class="headerlink" title="æ’åºç®—æ³•çš„å†…å­˜æ¶ˆè€—"></a>æ’åºç®—æ³•çš„å†…å­˜æ¶ˆè€—</h3><p>æˆ‘ä»¬å‰é¢è®²è¿‡ï¼Œç®—æ³•çš„å†…å­˜æ¶ˆè€—å¯ä»¥é€šè¿‡ç©ºé—´å¤æ‚åº¦æ¥è¡¡é‡ï¼Œæ’åºç®—æ³•ä¹Ÿä¸ä¾‹å¤–ã€‚ä¸è¿‡ï¼Œé’ˆå¯¹æ’åºç®—æ³•çš„ç©ºé—´å¤æ‚åº¦ï¼Œæˆ‘ä»¬è¿˜å¼•å…¥äº†ä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼ŒåŸåœ°æ’åºï¼ˆSorted in placeï¼‰ã€‚åŸåœ°æ’åºç®—æ³•ï¼Œå°±æ˜¯ç‰¹æŒ‡ç©ºé—´å¤æ‚åº¦æ˜¯ O(1) çš„æ’åºç®—æ³•ã€‚æˆ‘ä»¬ä»Šå¤©è®²çš„ä¸‰ç§æ’åºç®—æ³•ï¼Œéƒ½æ˜¯åŸåœ°æ’åºç®—æ³•ã€‚</p><h3 id="æ’åºç®—æ³•çš„ç¨³å®šæ€§"><a href="#æ’åºç®—æ³•çš„ç¨³å®šæ€§" class="headerlink" title="æ’åºç®—æ³•çš„ç¨³å®šæ€§"></a>æ’åºç®—æ³•çš„ç¨³å®šæ€§</h3><p>ä»…ä»…ç”¨æ‰§è¡Œæ•ˆç‡å’Œå†…å­˜æ¶ˆè€—æ¥è¡¡é‡æ’åºç®—æ³•çš„å¥½åæ˜¯ä¸å¤Ÿçš„ã€‚é’ˆå¯¹æ’åºç®—æ³•ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„åº¦é‡æŒ‡æ ‡ï¼Œ<strong>ç¨³å®šæ€§</strong>ã€‚è¿™ä¸ªæ¦‚å¿µæ˜¯è¯´ï¼Œå¦‚æœå¾…æ’åºçš„åºåˆ—ä¸­å­˜åœ¨å€¼ç›¸ç­‰çš„å…ƒç´ ï¼Œç»è¿‡æ’åºä¹‹åï¼Œç›¸ç­‰å…ƒç´ ä¹‹é—´åŸæœ‰çš„å…ˆåé¡ºåºä¸å˜ã€‚</p><p>æˆ‘é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è§£é‡Šä¸€ä¸‹ã€‚æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ç»„æ•°æ® 2ï¼Œ9ï¼Œ3ï¼Œ4ï¼Œ8ï¼Œ3ï¼ŒæŒ‰ç…§å¤§å°æ’åºä¹‹åå°±æ˜¯ 2ï¼Œ3ï¼Œ3ï¼Œ4ï¼Œ8ï¼Œ9ã€‚</p><p>è¿™ç»„æ•°æ®é‡Œæœ‰ä¸¤ä¸ª 3ã€‚ç»è¿‡æŸç§æ’åºç®—æ³•æ’åºä¹‹åï¼Œå¦‚æœä¸¤ä¸ª 3 çš„å‰åé¡ºåºæ²¡æœ‰æ”¹å˜ï¼Œé‚£æˆ‘ä»¬å°±æŠŠè¿™ç§æ’åºç®—æ³•å«ä½œ<strong>ç¨³å®šçš„æ’åºç®—æ³•</strong>ï¼›å¦‚æœå‰åé¡ºåºå‘ç”Ÿå˜åŒ–ï¼Œé‚£å¯¹åº”çš„æ’åºç®—æ³•å°±å«ä½œ<strong>ä¸ç¨³å®šçš„æ’åºç®—æ³•</strong>ã€‚</p><p>ä½ å¯èƒ½è¦é—®äº†ï¼Œä¸¤ä¸ª 3 å“ªä¸ªåœ¨å‰ï¼Œå“ªä¸ªåœ¨åæœ‰ä»€ä¹ˆå…³ç³»å•Šï¼Œç¨³ä¸ç¨³å®šåˆæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿä¸ºä»€ä¹ˆè¦è€ƒå¯Ÿæ’åºç®—æ³•çš„ç¨³å®šæ€§å‘¢ï¼Ÿ</p><p>å¾ˆå¤šæ•°æ®ç»“æ„å’Œç®—æ³•è¯¾ç¨‹ï¼Œåœ¨è®²æ’åºçš„æ—¶å€™ï¼Œéƒ½æ˜¯ç”¨æ•´æ•°æ¥ä¸¾ä¾‹ï¼Œä½†åœ¨çœŸæ­£è½¯ä»¶å¼€å‘ä¸­ï¼Œæˆ‘ä»¬è¦æ’åºçš„å¾€å¾€ä¸æ˜¯å•çº¯çš„æ•´æ•°ï¼Œè€Œæ˜¯ä¸€ç»„å¯¹è±¡ï¼Œæˆ‘ä»¬éœ€è¦æŒ‰ç…§å¯¹è±¡çš„æŸä¸ª key æ¥æ’åºã€‚</p><p>æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬ç°åœ¨è¦ç»™ç”µå•†äº¤æ˜“ç³»ç»Ÿä¸­çš„â€œè®¢å•â€æ’åºã€‚è®¢å•æœ‰ä¸¤ä¸ªå±æ€§ï¼Œä¸€ä¸ªæ˜¯ä¸‹å•æ—¶é—´ï¼Œå¦ä¸€ä¸ªæ˜¯è®¢å•é‡‘é¢ã€‚å¦‚æœæˆ‘ä»¬ç°åœ¨æœ‰ 10 ä¸‡æ¡è®¢å•æ•°æ®ï¼Œæˆ‘ä»¬å¸Œæœ›æŒ‰ç…§é‡‘é¢ä»å°åˆ°å¤§å¯¹è®¢å•æ•°æ®æ’åºã€‚å¯¹äºé‡‘é¢ç›¸åŒçš„è®¢å•ï¼Œæˆ‘ä»¬å¸Œæœ›æŒ‰ç…§ä¸‹å•æ—¶é—´ä»æ—©åˆ°æ™šæœ‰åºã€‚å¯¹äºè¿™æ ·ä¸€ä¸ªæ’åºéœ€æ±‚ï¼Œæˆ‘ä»¬æ€ä¹ˆæ¥åšå‘¢ï¼Ÿ</p><p>æœ€å…ˆæƒ³åˆ°çš„æ–¹æ³•æ˜¯ï¼šæˆ‘ä»¬å…ˆæŒ‰ç…§é‡‘é¢å¯¹è®¢å•æ•°æ®è¿›è¡Œæ’åºï¼Œç„¶åï¼Œå†éå†æ’åºä¹‹åçš„è®¢å•æ•°æ®ï¼Œå¯¹äºæ¯ä¸ªé‡‘é¢ç›¸åŒçš„å°åŒºé—´å†æŒ‰ç…§ä¸‹å•æ—¶é—´æ’åºã€‚è¿™ç§æ’åºæ€è·¯ç†è§£èµ·æ¥ä¸éš¾ï¼Œä½†æ˜¯å®ç°èµ·æ¥ä¼šå¾ˆå¤æ‚ã€‚</p><p>å€ŸåŠ©ç¨³å®šæ’åºç®—æ³•ï¼Œè¿™ä¸ªé—®é¢˜å¯ä»¥éå¸¸ç®€æ´åœ°è§£å†³ã€‚è§£å†³æ€è·¯æ˜¯è¿™æ ·çš„ï¼šæˆ‘ä»¬å…ˆæŒ‰ç…§ä¸‹å•æ—¶é—´ç»™è®¢å•æ’åºï¼Œæ³¨æ„æ˜¯æŒ‰ç…§ä¸‹å•æ—¶é—´ï¼Œä¸æ˜¯é‡‘é¢ã€‚æ’åºå®Œæˆä¹‹åï¼Œæˆ‘ä»¬ç”¨ç¨³å®šæ’åºç®—æ³•ï¼ŒæŒ‰ç…§è®¢å•é‡‘é¢é‡æ–°æ’åºã€‚ä¸¤éæ’åºä¹‹åï¼Œæˆ‘ä»¬å¾—åˆ°çš„è®¢å•æ•°æ®å°±æ˜¯æŒ‰ç…§é‡‘é¢ä»å°åˆ°å¤§æ’åºï¼Œé‡‘é¢ç›¸åŒçš„è®¢å•æŒ‰ç…§ä¸‹å•æ—¶é—´ä»æ—©åˆ°æ™šæ’åºçš„ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p><strong>ç¨³å®šæ’åºç®—æ³•å¯ä»¥ä¿æŒé‡‘é¢ç›¸åŒçš„ä¸¤ä¸ªå¯¹è±¡ï¼Œåœ¨æ’åºä¹‹åçš„å‰åé¡ºåºä¸å˜</strong>ã€‚ç¬¬ä¸€æ¬¡æ’åºä¹‹åï¼Œæ‰€æœ‰çš„è®¢å•æŒ‰ç…§ä¸‹å•æ—¶é—´ä»æ—©åˆ°æ™šæœ‰åºäº†ã€‚åœ¨ç¬¬äºŒæ¬¡æ’åºä¸­ï¼Œæˆ‘ä»¬ç”¨çš„æ˜¯ç¨³å®šçš„æ’åºç®—æ³•ï¼Œæ‰€ä»¥ç»è¿‡ç¬¬äºŒæ¬¡æ’åºä¹‹åï¼Œç›¸åŒé‡‘é¢çš„è®¢å•ä»ç„¶ä¿æŒä¸‹å•æ—¶é—´ä»æ—©åˆ°æ™šæœ‰åºã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210613203939.jpeg" alt="img"></p><h2 id="å†’æ³¡æ’åºï¼ˆBubble-Sortï¼‰"><a href="#å†’æ³¡æ’åºï¼ˆBubble-Sortï¼‰" class="headerlink" title="å†’æ³¡æ’åºï¼ˆBubble Sortï¼‰"></a>å†’æ³¡æ’åºï¼ˆBubble Sortï¼‰</h2><p>å†’æ³¡æ’åºåªä¼šæ“ä½œç›¸é‚»çš„ä¸¤ä¸ªæ•°æ®ã€‚æ¯æ¬¡å†’æ³¡æ“ä½œéƒ½ä¼šå¯¹ç›¸é‚»çš„ä¸¤ä¸ªå…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œçœ‹æ˜¯å¦æ»¡è¶³å¤§å°å…³ç³»è¦æ±‚ã€‚å¦‚æœä¸æ»¡è¶³å°±è®©å®ƒä¿©äº’æ¢ã€‚ä¸€æ¬¡å†’æ³¡ä¼šè®©è‡³å°‘ä¸€ä¸ªå…ƒç´ ç§»åŠ¨åˆ°å®ƒåº”è¯¥åœ¨çš„ä½ç½®ï¼Œé‡å¤ n æ¬¡ï¼Œå°±å®Œæˆäº† n ä¸ªæ•°æ®çš„æ’åºå·¥ä½œã€‚</p><p>æˆ‘ç”¨ä¸€ä¸ªä¾‹å­ï¼Œå¸¦ä½ çœ‹ä¸‹å†’æ³¡æ’åºçš„æ•´ä¸ªè¿‡ç¨‹ã€‚æˆ‘ä»¬è¦å¯¹ä¸€ç»„æ•°æ® 4ï¼Œ5ï¼Œ6ï¼Œ3ï¼Œ2ï¼Œ1ï¼Œä»å°åˆ°å¤§è¿›è¡Œæ’åºã€‚ç¬¬ä¸€æ¬¡å†’æ³¡æ“ä½œçš„è¯¦ç»†è¿‡ç¨‹å°±æ˜¯è¿™æ ·ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210613204009.jpeg" alt="img"></p><p>å¯ä»¥çœ‹å‡ºï¼Œç»è¿‡ä¸€æ¬¡å†’æ³¡æ“ä½œä¹‹åï¼Œ6 è¿™ä¸ªå…ƒç´ å·²ç»å­˜å‚¨åœ¨æ­£ç¡®çš„ä½ç½®ä¸Šã€‚è¦æƒ³å®Œæˆæ‰€æœ‰æ•°æ®çš„æ’åºï¼Œæˆ‘ä»¬åªè¦è¿›è¡Œ 6 æ¬¡è¿™æ ·çš„å†’æ³¡æ“ä½œå°±è¡Œäº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210613204017.jpeg" alt="img"></p><p>å®é™…ä¸Šï¼Œåˆšè®²çš„å†’æ³¡è¿‡ç¨‹è¿˜å¯ä»¥ä¼˜åŒ–ã€‚å½“æŸæ¬¡å†’æ³¡æ“ä½œå·²ç»æ²¡æœ‰æ•°æ®äº¤æ¢æ—¶ï¼Œè¯´æ˜å·²ç»è¾¾åˆ°å®Œå…¨æœ‰åºï¼Œä¸ç”¨å†ç»§ç»­æ‰§è¡Œåç»­çš„å†’æ³¡æ“ä½œã€‚æˆ‘è¿™é‡Œè¿˜æœ‰å¦å¤–ä¸€ä¸ªä¾‹å­ï¼Œè¿™é‡Œé¢ç»™ 6 ä¸ªå…ƒç´ æ’åºï¼Œåªéœ€è¦ 4 æ¬¡å†’æ³¡æ“ä½œå°±å¯ä»¥äº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210613204025.jpeg" alt="img"></p><p>å†’æ³¡æ’åºç®—æ³•çš„åŸç†æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œå…·ä½“çš„ä»£ç æˆ‘è´´åˆ°ä¸‹é¢ï¼Œä½ å¯ä»¥ç»“åˆç€ä»£ç æ¥çœ‹æˆ‘å‰é¢è®²çš„åŸç†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å†’æ³¡æ’åºï¼Œaè¡¨ç¤ºæ•°ç»„ï¼Œnè¡¨ç¤ºæ•°ç»„å¤§å°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bubbleSort</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (n &lt;= <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">    <span class="comment">// æå‰é€€å‡ºå†’æ³¡å¾ªç¯çš„æ ‡å¿—ä½</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; n - i - <span class="number">1</span>; ++j) &#123;</span><br><span class="line">      <span class="keyword">if</span> (a[j] &gt; a[j+<span class="number">1</span>]) &#123; <span class="comment">// äº¤æ¢</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> a[j];</span><br><span class="line">        a[j] = a[j+<span class="number">1</span>];</span><br><span class="line">        a[j+<span class="number">1</span>] = tmp;</span><br><span class="line">        flag = <span class="literal">true</span>;  <span class="comment">// è¡¨ç¤ºæœ‰æ•°æ®äº¤æ¢      </span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!flag) <span class="keyword">break</span>;  <span class="comment">// æ²¡æœ‰æ•°æ®äº¤æ¢ï¼Œæå‰é€€å‡º</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œç»“åˆåˆšæ‰æˆ‘åˆ†ææ’åºç®—æ³•çš„ä¸‰ä¸ªæ–¹é¢ï¼Œæˆ‘æœ‰ä¸‰ä¸ªé—®é¢˜è¦é—®ä½ ã€‚</p><h3 id="ç¬¬ä¸€ï¼Œå†’æ³¡æ’åºæ˜¯åŸåœ°æ’åºç®—æ³•å—ï¼Ÿ"><a href="#ç¬¬ä¸€ï¼Œå†’æ³¡æ’åºæ˜¯åŸåœ°æ’åºç®—æ³•å—ï¼Ÿ" class="headerlink" title="ç¬¬ä¸€ï¼Œå†’æ³¡æ’åºæ˜¯åŸåœ°æ’åºç®—æ³•å—ï¼Ÿ"></a>ç¬¬ä¸€ï¼Œå†’æ³¡æ’åºæ˜¯åŸåœ°æ’åºç®—æ³•å—ï¼Ÿ</h3><p>å†’æ³¡çš„è¿‡ç¨‹åªæ¶‰åŠç›¸é‚»æ•°æ®çš„äº¤æ¢æ“ä½œï¼Œåªéœ€è¦å¸¸é‡çº§çš„ä¸´æ—¶ç©ºé—´ï¼Œæ‰€ä»¥å®ƒçš„ç©ºé—´å¤æ‚åº¦ä¸º O(1)ï¼Œæ˜¯ä¸€ä¸ªåŸåœ°æ’åºç®—æ³•ã€‚</p><h3 id="ç¬¬äºŒï¼Œå†’æ³¡æ’åºæ˜¯ç¨³å®šçš„æ’åºç®—æ³•å—ï¼Ÿ"><a href="#ç¬¬äºŒï¼Œå†’æ³¡æ’åºæ˜¯ç¨³å®šçš„æ’åºç®—æ³•å—ï¼Ÿ" class="headerlink" title="ç¬¬äºŒï¼Œå†’æ³¡æ’åºæ˜¯ç¨³å®šçš„æ’åºç®—æ³•å—ï¼Ÿ"></a>ç¬¬äºŒï¼Œå†’æ³¡æ’åºæ˜¯ç¨³å®šçš„æ’åºç®—æ³•å—ï¼Ÿ</h3><p>åœ¨å†’æ³¡æ’åºä¸­ï¼Œåªæœ‰äº¤æ¢æ‰å¯ä»¥æ”¹å˜ä¸¤ä¸ªå…ƒç´ çš„å‰åé¡ºåºã€‚ä¸ºäº†ä¿è¯å†’æ³¡æ’åºç®—æ³•çš„ç¨³å®šæ€§ï¼Œå½“æœ‰ç›¸é‚»çš„ä¸¤ä¸ªå…ƒç´ å¤§å°ç›¸ç­‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸åšäº¤æ¢ï¼Œç›¸åŒå¤§å°çš„æ•°æ®åœ¨æ’åºå‰åä¸ä¼šæ”¹å˜é¡ºåºï¼Œæ‰€ä»¥å†’æ³¡æ’åºæ˜¯ç¨³å®šçš„æ’åºç®—æ³•ã€‚</p><h3 id="ç¬¬ä¸‰ï¼Œå†’æ³¡æ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ"><a href="#ç¬¬ä¸‰ï¼Œå†’æ³¡æ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ" class="headerlink" title="ç¬¬ä¸‰ï¼Œå†’æ³¡æ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ"></a>ç¬¬ä¸‰ï¼Œå†’æ³¡æ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ</h3><p>æœ€å¥½æƒ…å†µä¸‹ï¼Œè¦æ’åºçš„æ•°æ®å·²ç»æ˜¯æœ‰åºçš„äº†ï¼Œæˆ‘ä»¬åªéœ€è¦è¿›è¡Œä¸€æ¬¡å†’æ³¡æ“ä½œï¼Œå°±å¯ä»¥ç»“æŸäº†ï¼Œæ‰€ä»¥æœ€å¥½æƒ…å†µæ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚è€Œæœ€åçš„æƒ…å†µæ˜¯ï¼Œè¦æ’åºçš„æ•°æ®åˆšå¥½æ˜¯å€’åºæ’åˆ—çš„ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œ n æ¬¡å†’æ³¡æ“ä½œï¼Œæ‰€ä»¥æœ€åæƒ…å†µæ—¶é—´å¤æ‚åº¦ä¸º O(n^2)ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210613204155.jpeg" alt="img"></p><p>æœ€å¥½ã€æœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦å¾ˆå®¹æ˜“åˆ†æï¼Œé‚£å¹³å‡æƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚æ˜¯å¤šå°‘å‘¢ï¼Ÿæˆ‘ä»¬å‰é¢è®²è¿‡ï¼Œå¹³å‡æ—¶é—´å¤æ‚åº¦å°±æ˜¯åŠ æƒå¹³å‡æœŸæœ›æ—¶é—´å¤æ‚åº¦ï¼Œåˆ†æçš„æ—¶å€™è¦ç»“åˆæ¦‚ç‡è®ºçš„çŸ¥è¯†ã€‚</p><p>å¯¹äºåŒ…å« n ä¸ªæ•°æ®çš„æ•°ç»„ï¼Œè¿™ n ä¸ªæ•°æ®å°±æœ‰ n! ç§æ’åˆ—æ–¹å¼ã€‚ä¸åŒçš„æ’åˆ—æ–¹å¼ï¼Œå†’æ³¡æ’åºæ‰§è¡Œçš„æ—¶é—´è‚¯å®šæ˜¯ä¸åŒçš„ã€‚æ¯”å¦‚æˆ‘ä»¬å‰é¢ä¸¾çš„é‚£ä¸¤ä¸ªä¾‹å­ï¼Œå…¶ä¸­ä¸€ä¸ªè¦è¿›è¡Œ 6 æ¬¡å†’æ³¡ï¼Œè€Œå¦ä¸€ä¸ªåªéœ€è¦ 4 æ¬¡ã€‚å¦‚æœç”¨æ¦‚ç‡è®ºæ–¹æ³•å®šé‡åˆ†æå¹³å‡æ—¶é—´å¤æ‚åº¦ï¼Œæ¶‰åŠçš„æ•°å­¦æ¨ç†å’Œè®¡ç®—å°±ä¼šå¾ˆå¤æ‚ã€‚æˆ‘è¿™é‡Œè¿˜æœ‰ä¸€ç§æ€è·¯ï¼Œé€šè¿‡â€œ<strong>æœ‰åºåº¦</strong>â€å’Œâ€œ<strong>é€†åºåº¦</strong>â€è¿™ä¸¤ä¸ªæ¦‚å¿µæ¥è¿›è¡Œåˆ†æã€‚</p><p><strong>æœ‰åºåº¦</strong>æ˜¯æ•°ç»„ä¸­å…·æœ‰æœ‰åºå…³ç³»çš„å…ƒç´ å¯¹çš„ä¸ªæ•°ã€‚æœ‰åºå…ƒç´ å¯¹ç”¨æ•°å­¦è¡¨è¾¾å¼è¡¨ç¤ºå°±æ˜¯è¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æœ‰åºå…ƒç´ å¯¹ï¼ša[i] &lt;= a[j], å¦‚æœi &lt; jã€‚</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210613205428.jpeg" alt="img"></p><p>åŒç†ï¼Œå¯¹äºä¸€ä¸ªå€’åºæ’åˆ—çš„æ•°ç»„ï¼Œæ¯”å¦‚ 6ï¼Œ5ï¼Œ4ï¼Œ3ï¼Œ2ï¼Œ1ï¼Œæœ‰åºåº¦æ˜¯ 0ï¼›å¯¹äºä¸€ä¸ªå®Œå…¨æœ‰åºçš„æ•°ç»„ï¼Œæ¯”å¦‚ 1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œ6ï¼Œæœ‰åºåº¦å°±æ˜¯ <em><em>n</em>(n-1)&#x2F;2</em>*ï¼Œä¹Ÿå°±æ˜¯ 15ã€‚æˆ‘ä»¬æŠŠè¿™ç§å®Œå…¨æœ‰åºçš„æ•°ç»„çš„æœ‰åºåº¦å«ä½œ<strong>æ»¡æœ‰åºåº¦</strong>ã€‚</p><p>é€†åºåº¦çš„å®šä¹‰æ­£å¥½è·Ÿæœ‰åºåº¦ç›¸åï¼ˆé»˜è®¤ä»å°åˆ°å¤§ä¸ºæœ‰åºï¼‰ï¼Œæˆ‘æƒ³ä½ åº”è¯¥å·²ç»æƒ³åˆ°äº†ã€‚å…³äºé€†åºåº¦ï¼Œæˆ‘å°±ä¸ä¸¾ä¾‹å­è®²äº†ã€‚ä½ å¯ä»¥å¯¹ç…§æˆ‘è®²çš„æœ‰åºåº¦çš„ä¾‹å­è‡ªå·±çœ‹ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">é€†åºå…ƒç´ å¯¹ï¼ša[i] &gt; a[j], å¦‚æœi &lt; jã€‚</span><br></pre></td></tr></table></figure><p>å…³äºè¿™ä¸‰ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¾—åˆ°ä¸€ä¸ªå…¬å¼ï¼š<strong>é€†åºåº¦ &#x3D; æ»¡æœ‰åºåº¦ - æœ‰åºåº¦</strong>ã€‚æˆ‘ä»¬æ’åºçš„è¿‡ç¨‹å°±æ˜¯ä¸€ç§å¢åŠ æœ‰åºåº¦ï¼Œå‡å°‘é€†åºåº¦çš„è¿‡ç¨‹ï¼Œæœ€åè¾¾åˆ°æ»¡æœ‰åºåº¦ï¼Œå°±è¯´æ˜æ’åºå®Œæˆäº†ã€‚</p><p>æˆ‘è¿˜æ˜¯æ‹¿å‰é¢ä¸¾çš„é‚£ä¸ªå†’æ³¡æ’åºçš„ä¾‹å­æ¥è¯´æ˜ã€‚è¦æ’åºçš„æ•°ç»„çš„åˆå§‹çŠ¶æ€æ˜¯ 4ï¼Œ5ï¼Œ6ï¼Œ3ï¼Œ2ï¼Œ1 ï¼Œå…¶ä¸­ï¼Œæœ‰åºå…ƒç´ å¯¹æœ‰ (4ï¼Œ5) (4ï¼Œ6)(5ï¼Œ6)ï¼Œæ‰€ä»¥æœ‰åºåº¦æ˜¯ 3ã€‚n&#x3D;6ï¼Œæ‰€ä»¥æ’åºå®Œæˆä¹‹åç»ˆæ€çš„æ»¡æœ‰åºåº¦ä¸º n*(n-1)&#x2F;2&#x3D;15ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210613205527.jpeg" alt="img"></p><p>å†’æ³¡æ’åºåŒ…å«ä¸¤ä¸ªæ“ä½œåŸå­ï¼Œ<strong>æ¯”è¾ƒ</strong>å’Œ<strong>äº¤æ¢</strong>ã€‚æ¯äº¤æ¢ä¸€æ¬¡ï¼Œæœ‰åºåº¦å°±åŠ  1ã€‚ä¸ç®¡ç®—æ³•æ€ä¹ˆæ”¹è¿›ï¼Œäº¤æ¢æ¬¡æ•°æ€»æ˜¯ç¡®å®šçš„ï¼Œå³ä¸º<em><em>é€†åºåº¦ï¼Œä¹Ÿå°±æ˜¯n</em>(n-1)&#x2F;2â€“åˆå§‹æœ‰åºåº¦</em>*ã€‚æ­¤ä¾‹ä¸­å°±æ˜¯ 15â€“3&#x3D;12ï¼Œè¦è¿›è¡Œ 12 æ¬¡äº¤æ¢æ“ä½œã€‚</p><p>å¯¹äºåŒ…å« n ä¸ªæ•°æ®çš„æ•°ç»„è¿›è¡Œå†’æ³¡æ’åºï¼Œå¹³å‡äº¤æ¢æ¬¡æ•°æ˜¯å¤šå°‘å‘¢ï¼Ÿæœ€åæƒ…å†µä¸‹ï¼Œåˆå§‹çŠ¶æ€çš„æœ‰åºåº¦æ˜¯ 0ï¼Œæ‰€ä»¥è¦è¿›è¡Œ n*(n-1)&#x2F;2 æ¬¡äº¤æ¢ã€‚æœ€å¥½æƒ…å†µä¸‹ï¼Œåˆå§‹çŠ¶æ€çš„æœ‰åºåº¦æ˜¯ n*(n-1)&#x2F;2ï¼Œå°±ä¸éœ€è¦è¿›è¡Œäº¤æ¢ã€‚æˆ‘ä»¬å¯ä»¥å–ä¸ªä¸­é—´å€¼ n*(n-1)&#x2F;4ï¼Œæ¥è¡¨ç¤ºåˆå§‹æœ‰åºåº¦æ—¢ä¸æ˜¯å¾ˆé«˜ä¹Ÿä¸æ˜¯å¾ˆä½çš„å¹³å‡æƒ…å†µã€‚</p><p>æ¢å¥è¯è¯´ï¼Œå¹³å‡æƒ…å†µä¸‹ï¼Œéœ€è¦ n*(n-1)&#x2F;4 æ¬¡äº¤æ¢æ“ä½œï¼Œæ¯”è¾ƒæ“ä½œè‚¯å®šè¦æ¯”äº¤æ¢æ“ä½œå¤šï¼Œè€Œå¤æ‚åº¦çš„ä¸Šé™æ˜¯ O(n^2)ï¼Œæ‰€ä»¥å¹³å‡æƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(n^2)ã€‚ </p><h2 id="æ’å…¥æ’åºï¼ˆInsertion-Sortï¼‰"><a href="#æ’å…¥æ’åºï¼ˆInsertion-Sortï¼‰" class="headerlink" title="æ’å…¥æ’åºï¼ˆInsertion Sortï¼‰"></a>æ’å…¥æ’åºï¼ˆInsertion Sortï¼‰</h2><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªé—®é¢˜ã€‚ä¸€ä¸ªæœ‰åºçš„æ•°ç»„ï¼Œæˆ‘ä»¬å¾€é‡Œé¢æ·»åŠ ä¸€ä¸ªæ–°çš„æ•°æ®åï¼Œå¦‚ä½•ç»§ç»­ä¿æŒæ•°æ®æœ‰åºå‘¢ï¼Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬åªè¦éå†æ•°ç»„ï¼Œæ‰¾åˆ°æ•°æ®åº”è¯¥æ’å…¥çš„ä½ç½®å°†å…¶æ’å…¥å³å¯ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210613204351.jpeg" alt="img"></p><p>è¿™æ˜¯ä¸€ä¸ªåŠ¨æ€æ’åºçš„è¿‡ç¨‹ï¼Œå³åŠ¨æ€åœ°å¾€æœ‰åºé›†åˆä¸­æ·»åŠ æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ç§æ–¹æ³•ä¿æŒé›†åˆä¸­çš„æ•°æ®ä¸€ç›´æœ‰åºã€‚è€Œå¯¹äºä¸€ç»„é™æ€æ•°æ®ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å€Ÿé‰´ä¸Šé¢è®²çš„æ’å…¥æ–¹æ³•ï¼Œæ¥è¿›è¡Œæ’åºï¼Œäºæ˜¯å°±æœ‰äº†æ’å…¥æ’åºç®—æ³•ã€‚</p><p>é‚£<strong>æ’å…¥æ’åºå…·ä½“æ˜¯å¦‚ä½•å€ŸåŠ©ä¸Šé¢çš„æ€æƒ³æ¥å®ç°æ’åºçš„å‘¢</strong>ï¼Ÿ</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å°†æ•°ç»„ä¸­çš„æ•°æ®åˆ†ä¸ºä¸¤ä¸ªåŒºé—´ï¼Œ<strong>å·²æ’åºåŒºé—´</strong>å’Œ<strong>æœªæ’åºåŒºé—´</strong>ã€‚åˆå§‹å·²æ’åºåŒºé—´åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œå°±æ˜¯æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚æ’å…¥ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯å–æœªæ’åºåŒºé—´ä¸­çš„å…ƒç´ ï¼Œåœ¨å·²æ’åºåŒºé—´ä¸­æ‰¾åˆ°åˆé€‚çš„æ’å…¥ä½ç½®å°†å…¶æ’å…¥ï¼Œå¹¶ä¿è¯å·²æ’åºåŒºé—´æ•°æ®ä¸€ç›´æœ‰åºã€‚é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°æœªæ’åºåŒºé—´ä¸­å…ƒç´ ä¸ºç©ºï¼Œç®—æ³•ç»“æŸã€‚</p><p>å¦‚å›¾æ‰€ç¤ºï¼Œè¦æ’åºçš„æ•°æ®æ˜¯ 4ï¼Œ5ï¼Œ6ï¼Œ1ï¼Œ3ï¼Œ2ï¼Œå…¶ä¸­å·¦ä¾§ä¸ºå·²æ’åºåŒºé—´ï¼Œå³ä¾§æ˜¯æœªæ’åºåŒºé—´ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210613204424.jpeg" alt="img"></p><p>æ’å…¥æ’åºä¹ŸåŒ…å«ä¸¤ç§æ“ä½œï¼Œä¸€ç§æ˜¯<strong>å…ƒç´ çš„æ¯”è¾ƒ</strong>ï¼Œä¸€ç§æ˜¯<strong>å…ƒç´ çš„ç§»åŠ¨</strong>ã€‚å½“æˆ‘ä»¬éœ€è¦å°†ä¸€ä¸ªæ•°æ® a æ’å…¥åˆ°å·²æ’åºåŒºé—´æ—¶ï¼Œéœ€è¦æ‹¿ a ä¸å·²æ’åºåŒºé—´çš„å…ƒç´ ä¾æ¬¡æ¯”è¾ƒå¤§å°ï¼Œæ‰¾åˆ°åˆé€‚çš„æ’å…¥ä½ç½®ã€‚æ‰¾åˆ°æ’å…¥ç‚¹ä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†æ’å…¥ç‚¹ä¹‹åçš„å…ƒç´ é¡ºåºå¾€åç§»åŠ¨ä¸€ä½ï¼Œè¿™æ ·æ‰èƒ½è…¾å‡ºä½ç½®ç»™å…ƒç´  a æ’å…¥ã€‚</p><p>å¯¹äºä¸åŒçš„æŸ¥æ‰¾æ’å…¥ç‚¹æ–¹æ³•ï¼ˆä»å¤´åˆ°å°¾ã€ä»å°¾åˆ°å¤´ï¼‰ï¼Œå…ƒç´ çš„æ¯”è¾ƒæ¬¡æ•°æ˜¯æœ‰åŒºåˆ«çš„ã€‚ä½†å¯¹äºä¸€ä¸ªç»™å®šçš„åˆå§‹åºåˆ—ï¼Œç§»åŠ¨æ“ä½œçš„æ¬¡æ•°æ€»æ˜¯å›ºå®šçš„ï¼Œå°±ç­‰äºé€†åºåº¦ã€‚</p><p>ä¸ºä»€ä¹ˆè¯´ç§»åŠ¨æ¬¡æ•°å°±ç­‰äºé€†åºåº¦å‘¢ï¼Ÿæˆ‘æ‹¿åˆšæ‰çš„ä¾‹å­ç”»äº†ä¸€ä¸ªå›¾è¡¨ï¼Œä½ ä¸€çœ‹å°±æ˜ç™½äº†ã€‚æ»¡æœ‰åºåº¦æ˜¯ n*(n-1)&#x2F;2&#x3D;15ï¼Œåˆå§‹åºåˆ—çš„æœ‰åºåº¦æ˜¯ 5ï¼Œæ‰€ä»¥é€†åºåº¦æ˜¯ 10ã€‚æ’å…¥æ’åºä¸­ï¼Œæ•°æ®ç§»åŠ¨çš„ä¸ªæ•°æ€»å’Œä¹Ÿç­‰äº 10&#x3D;3+3+4ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210613204456.jpeg" alt="img"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ’å…¥æ’åºï¼Œaè¡¨ç¤ºæ•°ç»„ï¼Œnè¡¨ç¤ºæ•°ç»„å¤§å°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertionSort</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (n &lt;= <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> a[i];</span><br><span class="line">    <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i - <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// æŸ¥æ‰¾æ’å…¥çš„ä½ç½®</span></span><br><span class="line">    <span class="keyword">for</span> (; j &gt;= <span class="number">0</span>; --j) &#123;</span><br><span class="line">      <span class="keyword">if</span> (a[j] &gt; value) &#123;</span><br><span class="line">        a[j+<span class="number">1</span>] = a[j];  <span class="comment">// æ•°æ®ç§»åŠ¨</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    a[j+<span class="number">1</span>] = value; <span class="comment">// æ’å…¥æ•°æ®</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹ç‚¹ç¨å¾®å¤æ‚çš„ä¸œè¥¿ã€‚æˆ‘è¿™é‡Œè¿˜æ˜¯æœ‰ä¸‰ä¸ªé—®é¢˜è¦é—®ä½ ã€‚</p><h3 id="ç¬¬ä¸€ï¼Œæ’å…¥æ’åºæ˜¯åŸåœ°æ’åºç®—æ³•å—ï¼Ÿ"><a href="#ç¬¬ä¸€ï¼Œæ’å…¥æ’åºæ˜¯åŸåœ°æ’åºç®—æ³•å—ï¼Ÿ" class="headerlink" title="ç¬¬ä¸€ï¼Œæ’å…¥æ’åºæ˜¯åŸåœ°æ’åºç®—æ³•å—ï¼Ÿ"></a>ç¬¬ä¸€ï¼Œæ’å…¥æ’åºæ˜¯åŸåœ°æ’åºç®—æ³•å—ï¼Ÿ</h3><p>ä»å®ç°è¿‡ç¨‹å¯ä»¥å¾ˆæ˜æ˜¾åœ°çœ‹å‡ºï¼Œæ’å…¥æ’åºç®—æ³•çš„è¿è¡Œå¹¶ä¸éœ€è¦é¢å¤–çš„å­˜å‚¨ç©ºé—´ï¼Œæ‰€ä»¥ç©ºé—´å¤æ‚åº¦æ˜¯ O(1)ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸåœ°æ’åºç®—æ³•ã€‚</p><h3 id="ç¬¬äºŒï¼Œæ’å…¥æ’åºæ˜¯ç¨³å®šçš„æ’åºç®—æ³•å—ï¼Ÿ"><a href="#ç¬¬äºŒï¼Œæ’å…¥æ’åºæ˜¯ç¨³å®šçš„æ’åºç®—æ³•å—ï¼Ÿ" class="headerlink" title="ç¬¬äºŒï¼Œæ’å…¥æ’åºæ˜¯ç¨³å®šçš„æ’åºç®—æ³•å—ï¼Ÿ"></a>ç¬¬äºŒï¼Œæ’å…¥æ’åºæ˜¯ç¨³å®šçš„æ’åºç®—æ³•å—ï¼Ÿ</h3><p>åœ¨æ’å…¥æ’åºä¸­ï¼Œå¯¹äºå€¼ç›¸åŒçš„å…ƒç´ ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©å°†åé¢å‡ºç°çš„å…ƒç´ ï¼Œæ’å…¥åˆ°å‰é¢å‡ºç°å…ƒç´ çš„åé¢ï¼Œè¿™æ ·å°±å¯ä»¥ä¿æŒåŸæœ‰çš„å‰åé¡ºåºä¸å˜ï¼Œæ‰€ä»¥æ’å…¥æ’åºæ˜¯ç¨³å®šçš„æ’åºç®—æ³•ã€‚</p><h3 id="ç¬¬ä¸‰ï¼Œæ’å…¥æ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ"><a href="#ç¬¬ä¸‰ï¼Œæ’å…¥æ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ" class="headerlink" title="ç¬¬ä¸‰ï¼Œæ’å…¥æ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ"></a>ç¬¬ä¸‰ï¼Œæ’å…¥æ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ</h3><p>å¦‚æœè¦æ’åºçš„æ•°æ®å·²ç»æ˜¯æœ‰åºçš„ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦æ¬ç§»ä»»ä½•æ•°æ®ã€‚å¦‚æœæˆ‘ä»¬ä»å°¾åˆ°å¤´åœ¨æœ‰åºæ•°æ®ç»„é‡Œé¢æŸ¥æ‰¾æ’å…¥ä½ç½®ï¼Œæ¯æ¬¡åªéœ€è¦æ¯”è¾ƒä¸€ä¸ªæ•°æ®å°±èƒ½ç¡®å®šæ’å…¥çš„ä½ç½®ã€‚æ‰€ä»¥è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€å¥½æ˜¯æ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚æ³¨æ„ï¼Œè¿™é‡Œæ˜¯<strong>ä»å°¾åˆ°å¤´éå†å·²ç»æœ‰åºçš„æ•°æ®</strong>ã€‚</p><p>å¦‚æœæ•°ç»„æ˜¯å€’åºçš„ï¼Œæ¯æ¬¡æ’å…¥éƒ½ç›¸å½“äºåœ¨æ•°ç»„çš„ç¬¬ä¸€ä¸ªä½ç½®æ’å…¥æ–°çš„æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦ç§»åŠ¨å¤§é‡çš„æ•°æ®ï¼Œæ‰€ä»¥æœ€åæƒ…å†µæ—¶é—´å¤æ‚åº¦ä¸º O(n^2)ã€‚</p><p>è¿˜è®°å¾—æˆ‘ä»¬åœ¨æ•°ç»„ä¸­æ’å…¥ä¸€ä¸ªæ•°æ®çš„å¹³å‡æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘å—ï¼Ÿæ²¡é”™ï¼Œæ˜¯ O(n)ã€‚æ‰€ä»¥ï¼Œå¯¹äºæ’å…¥æ’åºæ¥è¯´ï¼Œæ¯æ¬¡æ’å…¥æ“ä½œéƒ½ç›¸å½“äºåœ¨æ•°ç»„ä¸­æ’å…¥ä¸€ä¸ªæ•°æ®ï¼Œå¾ªç¯æ‰§è¡Œ n æ¬¡æ’å…¥æ“ä½œï¼Œæ‰€ä»¥å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º O(n^2)ã€‚</p><h2 id="é€‰æ‹©æ’åºï¼ˆSelection-Sortï¼‰"><a href="#é€‰æ‹©æ’åºï¼ˆSelection-Sortï¼‰" class="headerlink" title="é€‰æ‹©æ’åºï¼ˆSelection Sortï¼‰"></a>é€‰æ‹©æ’åºï¼ˆSelection Sortï¼‰</h2><p>é€‰æ‹©æ’åºç®—æ³•çš„å®ç°æ€è·¯æœ‰ç‚¹ç±»ä¼¼æ’å…¥æ’åºï¼Œä¹Ÿåˆ†å·²æ’åºåŒºé—´å’Œæœªæ’åºåŒºé—´ã€‚ä½†æ˜¯é€‰æ‹©æ’åºæ¯æ¬¡ä¼šä»æœªæ’åºåŒºé—´ä¸­æ‰¾åˆ°æœ€å°çš„å…ƒç´ ï¼Œå°†å…¶æ”¾åˆ°å·²æ’åºåŒºé—´çš„æœ«å°¾ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210613204633.jpeg" alt="img"></p><p>é€‰æ‹©æ’åºç©ºé—´å¤æ‚åº¦ä¸º O(1)ï¼Œæ˜¯ä¸€ç§åŸåœ°æ’åºç®—æ³•ã€‚é€‰æ‹©æ’åºçš„æœ€å¥½æƒ…å†µæ—¶é—´å¤æ‚åº¦ã€æœ€åæƒ…å†µå’Œå¹³å‡æƒ…å†µæ—¶é—´å¤æ‚åº¦éƒ½ä¸º O(n^2)ã€‚ä½ å¯ä»¥è‡ªå·±æ¥åˆ†æçœ‹çœ‹ã€‚</p><p>é‚£é€‰æ‹©æ’åºæ˜¯ç¨³å®šçš„æ’åºç®—æ³•å—ï¼Ÿè¿™ä¸ªé—®é¢˜æˆ‘ç€é‡æ¥è¯´ä¸€ä¸‹ã€‚</p><p>ç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œé€‰æ‹©æ’åºæ˜¯ä¸€ç§ä¸ç¨³å®šçš„æ’åºç®—æ³•ã€‚ä»æˆ‘å‰é¢ç”»çš„é‚£å¼ å›¾ä¸­ï¼Œä½ å¯ä»¥çœ‹å‡ºæ¥ï¼Œé€‰æ‹©æ’åºæ¯æ¬¡éƒ½è¦æ‰¾å‰©ä½™æœªæ’åºå…ƒç´ ä¸­çš„æœ€å°å€¼ï¼Œå¹¶å’Œå‰é¢çš„å…ƒç´ äº¤æ¢ä½ç½®ï¼Œè¿™æ ·ç ´åäº†ç¨³å®šæ€§ã€‚</p><p>æ¯”å¦‚ 5ï¼Œ8ï¼Œ5ï¼Œ2ï¼Œ9 è¿™æ ·ä¸€ç»„æ•°æ®ï¼Œä½¿ç”¨é€‰æ‹©æ’åºç®—æ³•æ¥æ’åºçš„è¯ï¼Œç¬¬ä¸€æ¬¡æ‰¾åˆ°æœ€å°å…ƒç´  2ï¼Œä¸ç¬¬ä¸€ä¸ª 5 äº¤æ¢ä½ç½®ï¼Œé‚£ç¬¬ä¸€ä¸ª 5 å’Œä¸­é—´çš„ 5 é¡ºåºå°±å˜äº†ï¼Œæ‰€ä»¥å°±ä¸ç¨³å®šäº†ã€‚æ­£æ˜¯å› æ­¤ï¼Œç›¸å¯¹äºå†’æ³¡æ’åºå’Œæ’å…¥æ’åºï¼Œé€‰æ‹©æ’åºå°±ç¨å¾®é€Šè‰²äº†ã€‚</p><h2 id="è§£ç­”å¼€ç¯‡"><a href="#è§£ç­”å¼€ç¯‡" class="headerlink" title="è§£ç­”å¼€ç¯‡"></a>è§£ç­”å¼€ç¯‡</h2><p>åŸºæœ¬çš„çŸ¥è¯†éƒ½è®²å®Œäº†ï¼Œæˆ‘ä»¬æ¥çœ‹å¼€ç¯‡çš„é—®é¢˜ï¼šå†’æ³¡æ’åºå’Œæ’å…¥æ’åºçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(n^2)ï¼Œéƒ½æ˜¯åŸåœ°æ’åºç®—æ³•ï¼Œä¸ºä»€ä¹ˆæ’å…¥æ’åºè¦æ¯”å†’æ³¡æ’åºæ›´å—æ¬¢è¿å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å‰é¢åˆ†æå†’æ³¡æ’åºå’Œæ’å…¥æ’åºçš„æ—¶å€™è®²åˆ°ï¼Œå†’æ³¡æ’åºä¸ç®¡æ€ä¹ˆä¼˜åŒ–ï¼Œå…ƒç´ äº¤æ¢çš„æ¬¡æ•°æ˜¯ä¸€ä¸ªå›ºå®šå€¼ï¼Œæ˜¯åŸå§‹æ•°æ®çš„é€†åºåº¦ã€‚æ’å…¥æ’åºæ˜¯åŒæ ·çš„ï¼Œä¸ç®¡æ€ä¹ˆä¼˜åŒ–ï¼Œå…ƒç´ ç§»åŠ¨çš„æ¬¡æ•°ä¹Ÿç­‰äºåŸå§‹æ•°æ®çš„é€†åºåº¦ã€‚</p><p>ä½†æ˜¯ï¼Œä»ä»£ç å®ç°ä¸Šæ¥çœ‹ï¼Œå†’æ³¡æ’åºçš„æ•°æ®äº¤æ¢è¦æ¯”æ’å…¥æ’åºçš„æ•°æ®ç§»åŠ¨è¦å¤æ‚ï¼Œå†’æ³¡æ’åºéœ€è¦ 3 ä¸ªèµ‹å€¼æ“ä½œï¼Œè€Œæ’å…¥æ’åºåªéœ€è¦ 1 ä¸ªã€‚æˆ‘ä»¬æ¥çœ‹è¿™æ®µæ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">å†’æ³¡æ’åºä¸­æ•°æ®çš„äº¤æ¢æ“ä½œï¼š</span><br><span class="line"><span class="keyword">if</span> (a[j] &gt; a[j+<span class="number">1</span>]) &#123; <span class="comment">// äº¤æ¢</span></span><br><span class="line">   <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> a[j];</span><br><span class="line">   a[j] = a[j+<span class="number">1</span>];</span><br><span class="line">   a[j+<span class="number">1</span>] = tmp;</span><br><span class="line">   flag = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">æ’å…¥æ’åºä¸­æ•°æ®çš„ç§»åŠ¨æ“ä½œï¼š</span><br><span class="line"><span class="keyword">if</span> (a[j] &gt; value) &#123;</span><br><span class="line">  a[j+<span class="number">1</span>] = a[j];  <span class="comment">// æ•°æ®ç§»åŠ¨</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æŠŠæ‰§è¡Œä¸€ä¸ªèµ‹å€¼è¯­å¥çš„æ—¶é—´ç²—ç•¥åœ°è®¡ä¸ºå•ä½æ—¶é—´ï¼ˆunit_timeï¼‰ï¼Œç„¶ååˆ†åˆ«ç”¨å†’æ³¡æ’åºå’Œæ’å…¥æ’åºå¯¹åŒä¸€ä¸ªé€†åºåº¦æ˜¯ K çš„æ•°ç»„è¿›è¡Œæ’åºã€‚ç”¨å†’æ³¡æ’åºï¼Œéœ€è¦ K æ¬¡äº¤æ¢æ“ä½œï¼Œæ¯æ¬¡éœ€è¦ 3 ä¸ªèµ‹å€¼è¯­å¥ï¼Œæ‰€ä»¥äº¤æ¢æ“ä½œæ€»è€—æ—¶å°±æ˜¯ 3*K å•ä½æ—¶é—´ã€‚è€Œæ’å…¥æ’åºä¸­æ•°æ®ç§»åŠ¨æ“ä½œåªéœ€è¦ K ä¸ªå•ä½æ—¶é—´ã€‚</p><h2 id="å†…å®¹å°ç»“"><a href="#å†…å®¹å°ç»“" class="headerlink" title="å†…å®¹å°ç»“"></a>å†…å®¹å°ç»“</h2><p>è¦æƒ³åˆ†æã€è¯„ä»·ä¸€ä¸ªæ’åºç®—æ³•ï¼Œéœ€è¦ä»æ‰§è¡Œæ•ˆç‡ã€å†…å­˜æ¶ˆè€—å’Œç¨³å®šæ€§ä¸‰ä¸ªæ–¹é¢æ¥çœ‹ã€‚å› æ­¤ï¼Œè¿™ä¸€èŠ‚ï¼Œæˆ‘å¸¦ä½ åˆ†æäº†ä¸‰ç§æ—¶é—´å¤æ‚åº¦æ˜¯ O(n^2) çš„æ’åºç®—æ³•ï¼Œå†’æ³¡æ’åºã€æ’å…¥æ’åºã€é€‰æ‹©æ’åºã€‚ä½ éœ€è¦é‡ç‚¹æŒæ¡çš„æ˜¯å®ƒä»¬çš„åˆ†ææ–¹æ³•ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210613204826.jpeg" alt="img"></p>]]></content>
      
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kafkaé¢è¯•é¢˜</title>
      <link href="/posts/32ecfb01.html"/>
      <url>/posts/32ecfb01.html</url>
      
        <content type="html"><![CDATA[<hr><h2 id="kafkaå…¥é—¨"><a href="#kafkaå…¥é—¨" class="headerlink" title="kafkaå…¥é—¨"></a>kafkaå…¥é—¨</h2><h3 id="æ•´ä½“æ¶æ„å›¾"><a href="#æ•´ä½“æ¶æ„å›¾" class="headerlink" title="æ•´ä½“æ¶æ„å›¾"></a>æ•´ä½“æ¶æ„å›¾</h3><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210529223532.png" alt="image"></p><h3 id="topic"><a href="#topic" class="headerlink" title="topic"></a>topic</h3><p>topicå¯ä»¥ç®€å•è®¤ä¸ºæ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—åšä¸åŒçš„äº‹æƒ…ï¼Œé˜Ÿåˆ—ä¹‹é—´ç›¸å¯¹éš”ç¦»ï¼›æ¯ä¸ªé˜Ÿåˆ—éƒ½æœ‰ä¸åŒçš„åå­—ï¼Œè¿™æ ·æˆ‘ä»¬å°±çŸ¥é“å¾€å“ªä¸ªé˜Ÿåˆ—ä¸¢æ•°æ®ï¼Œä¹ŸçŸ¥é“ä»å“ªä¸ªé˜Ÿåˆ—æ‹¿æ•°æ®äº†ã€‚æˆ‘ä»¬å¯ä»¥æœ‰å¤šä¸ªç”Ÿäº§è€…**å¾€åŒä¸€ä¸ªé˜Ÿåˆ—(topic)<strong>ä¸¢æ•°æ®ï¼Œå¤šä¸ªæ¶ˆè´¹è€…</strong>ä»åŒä¸€ä¸ªé˜Ÿåˆ—(topic)**æ‹¿æ•°æ®</p><h3 id="partition"><a href="#partition" class="headerlink" title="partition"></a>partition</h3><p>ä¸ºäº†æé«˜æ¯ä¸ªé˜Ÿåˆ—ï¼ˆtopicï¼‰çš„<strong>ååé‡</strong>ï¼Œkafkaä¼šæŠŠtopicè¿›è¡Œåˆ†åŒº(<strong>Partition</strong>)ã€‚æ¯ä¸ªtopicåŒ…å«å¤šä¸ªåˆ†åŒºã€‚</p><p>æ‰€ä»¥ï¼Œç”Ÿäº§è€…å®é™…ä¸Šæ˜¯å¾€ä¸€ä¸ªtopicåä¸º<code>sonder</code>ä¸­çš„åˆ†åŒº(<strong>Partition</strong>)ä¸¢æ•°æ®ï¼Œæ¶ˆè´¹è€…å®é™…ä¸Šæ˜¯ä»ä¸€ä¸ªtopicåä¸º<code>sonder</code>çš„åˆ†åŒº(<strong>Partition</strong>)å–æ•°æ®</p><h3 id="broker"><a href="#broker" class="headerlink" title="broker"></a>broker</h3><p>ä¸€å°KafkaæœåŠ¡å™¨å«åš<strong>Broker</strong>ï¼ŒKafkaé›†ç¾¤å°±æ˜¯å¤šå°KafkaæœåŠ¡å™¨ï¼š</p><p>ä¸€ä¸ªtopicä¼šåˆ†ä¸ºå¤šä¸ªpartitionï¼Œå®é™…ä¸Špartitionä¼š<strong>åˆ†å¸ƒ</strong>åœ¨ä¸åŒçš„brokerä¸­ï¼Œä¸¾ä¸ªä¾‹å­ï¼š</p><p>ç”Ÿäº§è€…å¾€ä¸€ä¸ªtopicé‡Œé¢ä¸¢æ•°æ®ï¼Œå®é™…ä¸Šæ•°æ®ä¼šåœ¨partitionä¸­ï¼Œpartitionä¼šåˆ†å¸ƒåœ¨ä¸åŒçš„<strong>broker</strong>ï¼ˆæœåŠ¡å™¨ï¼‰ä¸Šã€‚</p><p>ç”±æ­¤å¾—çŸ¥ï¼š<strong>Kafkaæ˜¯å¤©ç„¶åˆ†å¸ƒå¼çš„</strong>ã€‚</p><h3 id="æ¶ˆè´¹è€…å’Œæ¶ˆè´¹è€…ç»„"><a href="#æ¶ˆè´¹è€…å’Œæ¶ˆè´¹è€…ç»„" class="headerlink" title="æ¶ˆè´¹è€…å’Œæ¶ˆè´¹è€…ç»„"></a>æ¶ˆè´¹è€…å’Œæ¶ˆè´¹è€…ç»„</h3><p>æ—¢ç„¶æ•°æ®æ˜¯ä¿å­˜åœ¨partitionä¸­çš„ï¼Œé‚£ä¹ˆæ¶ˆè´¹è€…å®é™…ä¸Šä¹Ÿæ˜¯ä»partitionä¸­å–æ•°æ®ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210529221224.jpeg" alt="å›¾ç‰‡"></p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210529221549.png" alt="img"></p><p>ä½¿ç”¨ Consumer high level API æ—¶ï¼ŒåŒä¸€ Topic çš„ä¸€æ¡æ¶ˆæ¯åªèƒ½è¢«åŒä¸€ä¸ª Consumer Group å†…çš„ä¸€ä¸ª Consumer æ¶ˆè´¹ï¼Œä½†å¤šä¸ª Consumer Group å¯åŒæ—¶æ¶ˆè´¹è¿™ä¸€æ¶ˆæ¯ã€‚</p><p>è¿™æ˜¯ Kafka ç”¨æ¥å®ç°ä¸€ä¸ª Topic æ¶ˆæ¯çš„å¹¿æ’­ï¼ˆå‘ç»™æ‰€æœ‰çš„ Consumerï¼‰å’Œå•æ’­ï¼ˆå‘ç»™æŸä¸€ä¸ª Consumerï¼‰çš„æ‰‹æ®µã€‚ä¸€ä¸ª Topic å¯ä»¥å¯¹åº”å¤šä¸ª Consumer Groupã€‚å¦‚æœéœ€è¦å®ç°å¹¿æ’­ï¼Œåªè¦æ¯ä¸ª Consumer æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ Group å°±å¯ä»¥äº†ã€‚è¦å®ç°å•æ’­åªè¦æ‰€æœ‰çš„ Consumer åœ¨åŒä¸€ä¸ª Group é‡Œã€‚ç”¨ Consumer Group è¿˜å¯ä»¥å°† Consumer è¿›è¡Œè‡ªç”±çš„åˆ†ç»„è€Œä¸éœ€è¦å¤šæ¬¡å‘é€æ¶ˆæ¯åˆ°ä¸åŒçš„ Topicã€‚</p><p>å¤šä¸ªæ¶ˆè´¹è€…ç»„æˆä¸€ä¸ªæ¶ˆè´¹è€…ç»„ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…ç»„ä¹‹é—´ç›¸äº’ç‹¬ç«‹ã€‚<strong>åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­çš„ä¸åŒæ¶ˆè´¹è€…ä¸èƒ½åŒæ—¶æ¶ˆè´¹åŒä¸€ä¸ªåˆ†åŒºçš„æ•°æ®</strong>ã€‚ä½†ä¸åŒçš„æ¶ˆè´¹è€…ç»„å¯ä»¥æ¶ˆè´¹ç›¸åŒçš„åˆ†åŒºçš„æ•°æ®ï¼ˆå¹¿æ’­æ¶ˆè´¹ï¼‰ã€‚</p><p>æ¯ä¸ªæ¶ˆè´¹è€…ç»„å”¯ä¸€å¯¹åº”ä¸€ä¸ªtopicï¼Œä¸€ä¸ªtopicä¸‹é¢å¯èƒ½æœ‰å¤šä¸ªæ¶ˆè´¹è€…ç»„ï¼Œè¿™æ ·å°±å®ç°äº†å¹¿æ’­æ¶ˆè´¹ã€‚</p><blockquote><p>æ³¨æ„ï¼šå¦‚æœæ¶ˆè´¹è€…ä¸æŒ‡å®šæ¶ˆè´¹è€…ç»„ï¼Œé‚£ä¹ˆå°†ä¼šä½¿ç”¨é»˜è®¤çš„æ¶ˆè´¹è€…ç»„ï¼Œæ¯ä¸ªtopicéƒ½æœ‰ä¸€ä¸ªé»˜è®¤æ¶ˆè´¹è€…ç»„ã€‚</p></blockquote><p>å…³äºæ¶ˆè´¹è€…æ•°é‡ï¼Œè¦æ³¨æ„å‡ ç‚¹ï¼š</p><ul><li>å¦‚æœæ¶ˆè´¹è€…ç»„ä¸­çš„æŸä¸ªæ¶ˆè´¹è€…æŒ‚äº†ï¼Œé‚£ä¹ˆå…¶ä¸­ä¸€ä¸ªæ¶ˆè´¹è€…å¯èƒ½å°±è¦æ¶ˆè´¹ä¸¤ä¸ªpartitionäº†</li><li>å¦‚æœåªæœ‰ä¸‰ä¸ªpartitionï¼Œè€Œæ¶ˆè´¹è€…ç»„æœ‰4ä¸ªæ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆä¸€ä¸ªæ¶ˆè´¹è€…ä¼šç©ºé—²ï¼ˆä¸€ä¸ªåˆ†åŒºä¸ä¼šè¢«ä¸¤ä¸ªæ¶ˆè´¹è€…åŒæ—¶æ¶ˆè´¹ï¼‰</li><li>å¦‚æœå¤šåŠ å…¥ä¸€ä¸ª<strong>æ¶ˆè´¹è€…ç»„</strong>ï¼Œæ— è®ºæ˜¯æ–°å¢çš„æ¶ˆè´¹è€…ç»„è¿˜æ˜¯åŸæœ¬çš„æ¶ˆè´¹è€…ç»„ï¼Œéƒ½èƒ½æ¶ˆè´¹topicçš„å…¨éƒ¨æ•°æ®ã€‚ï¼ˆæ¶ˆè´¹è€…ç»„ä¹‹é—´ä»é€»è¾‘ä¸Šå®ƒä»¬æ˜¯<strong>ç‹¬ç«‹</strong>çš„ï¼‰</li></ul><h2 id="é«˜å¯ç”¨"><a href="#é«˜å¯ç”¨" class="headerlink" title="é«˜å¯ç”¨"></a>é«˜å¯ç”¨</h2><h3 id="Kafkaåˆ†åŒºå¦‚æœå‡ºç°æ•…éšœæ€ä¹ˆåŠï¼Ÿ"><a href="#Kafkaåˆ†åŒºå¦‚æœå‡ºç°æ•…éšœæ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="Kafkaåˆ†åŒºå¦‚æœå‡ºç°æ•…éšœæ€ä¹ˆåŠï¼Ÿ"></a>Kafkaåˆ†åŒºå¦‚æœå‡ºç°æ•…éšœæ€ä¹ˆåŠï¼Ÿ</h3><p>ç°åœ¨æˆ‘ä»¬å·²ç»çŸ¥é“äº†å¾€topicé‡Œè¾¹ä¸¢æ•°æ®ï¼Œå®é™…ä¸Šè¿™äº›æ•°æ®ä¼šåˆ†åˆ°ä¸åŒçš„partitionä¸Šï¼Œè¿™äº›partitionå­˜åœ¨ä¸åŒçš„brokerä¸Šã€‚åˆ†å¸ƒå¼è‚¯å®šä¼šå¸¦æ¥é—®é¢˜ï¼šâ€œä¸‡ä¸€å…¶ä¸­ä¸€å°broker(KafkaæœåŠ¡å™¨)å‡ºç°ç½‘ç»œæŠ–åŠ¨æˆ–è€…æŒ‚äº†ï¼Œæ€ä¹ˆåŠï¼Ÿâ€</p><p>Kafkaæ˜¯è¿™æ ·åšçš„ï¼šæˆ‘ä»¬æ•°æ®å­˜åœ¨ä¸åŒçš„partitionä¸Šï¼Œé‚£kafkaå°±æŠŠè¿™äº›partitionåš<strong>å¤‡ä»½</strong>ï¼ˆreplicaï¼‰ã€‚æ¯”å¦‚ï¼Œç°åœ¨æˆ‘ä»¬æœ‰ä¸‰ä¸ªpartitionï¼Œåˆ†åˆ«å­˜åœ¨ä¸‰å°brokerä¸Šã€‚æ¯ä¸ªpartitionéƒ½ä¼šå¤‡ä»½ï¼Œè¿™äº›å¤‡ä»½æ•£è½åœ¨<strong>ä¸åŒ</strong>çš„brokerä¸Šã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210529215119.webp" alt="å›¾ç‰‡"></p><p>çº¢è‰²å—çš„partitionä»£è¡¨çš„æ˜¯<strong>ä¸»</strong>åˆ†åŒºï¼Œç´«è‰²çš„partitionå—ä»£è¡¨çš„æ˜¯<strong>å¤‡ä»½</strong>åˆ†åŒºã€‚ç”Ÿäº§è€…å¾€topicä¸¢æ•°æ®ï¼Œæ˜¯ä¸<strong>ä¸»</strong>åˆ†åŒºäº¤äº’ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹topicçš„æ•°æ®ï¼Œä¹Ÿæ˜¯ä¸ä¸»åˆ†åŒºäº¤äº’ã€‚</p><p><strong>å¤‡ä»½åˆ†åŒºä»…ä»…ç”¨ä½œäºå¤‡ä»½ï¼Œä¸åšè¯»å†™ã€‚</strong>å¦‚æœæŸä¸ªBrokeræŒ‚äº†ï¼Œé‚£å°±ä¼šé€‰ä¸¾å‡ºå…¶ä»–Brokerçš„partitionæ¥ä½œä¸ºä¸»åˆ†åŒºï¼Œè¿™å°±å®ç°äº†<strong>é«˜å¯ç”¨</strong>ã€‚</p><h3 id="ISRï¼ˆin-sync-replicaï¼‰æœºåˆ¶"><a href="#ISRï¼ˆin-sync-replicaï¼‰æœºåˆ¶" class="headerlink" title="ISRï¼ˆin-sync-replicaï¼‰æœºåˆ¶"></a>ISRï¼ˆin-sync-replicaï¼‰æœºåˆ¶</h3><h2 id="å¯é æ€§"><a href="#å¯é æ€§" class="headerlink" title="å¯é æ€§"></a>å¯é æ€§</h2><h3 id="Kafkaæ¶ˆæ¯å¯é æ€§æ˜¯å¦‚ä½•ä¿è¯çš„ï¼Ÿ"><a href="#Kafkaæ¶ˆæ¯å¯é æ€§æ˜¯å¦‚ä½•ä¿è¯çš„ï¼Ÿ" class="headerlink" title="Kafkaæ¶ˆæ¯å¯é æ€§æ˜¯å¦‚ä½•ä¿è¯çš„ï¼Ÿ"></a>Kafkaæ¶ˆæ¯å¯é æ€§æ˜¯å¦‚ä½•ä¿è¯çš„ï¼Ÿ</h3><p><strong>Acksæœºåˆ¶</strong>ï¼š</p><ul><li><strong>0</strong>ï¼šä¸è¿›è¡Œæ¶ˆæ¯æ¥æ”¶æ˜¯å¦æˆåŠŸçš„ç¡®è®¤ï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œä¼šä¸¢å¤±æ•°æ®ã€‚</li><li><strong>1</strong>ï¼šå½“Leaderå‰¯æœ¬æ¥æ”¶æˆåŠŸåï¼Œè¿”å›æ¥æ”¶æˆåŠŸç¡®è®¤ä¿¡æ¯ï¼Œä¸»å¤‡åˆ‡æ¢å¯èƒ½ä¼šä¸¢å¤±æ•°æ®ã€‚</li><li><strong>-1ï¼ˆallï¼‰</strong>ï¼šå½“Leaderå’ŒFollowerå‰¯æœ¬éƒ½æ¥æ”¶æˆåŠŸåï¼Œè¿”å›æ¥æ”¶æˆåŠŸçš„ç¡®è®¤ä¿¡æ¯ã€‚</li></ul><h3 id="æ¶ˆæ¯æŠ•é€’è¯­ä¹‰"><a href="#æ¶ˆæ¯æŠ•é€’è¯­ä¹‰" class="headerlink" title="æ¶ˆæ¯æŠ•é€’è¯­ä¹‰"></a>æ¶ˆæ¯æŠ•é€’è¯­ä¹‰</h3><p><a href="https://www.cnblogs.com/luxiaoxun/p/13048474.html">https://www.cnblogs.com/luxiaoxun/p/13048474.html</a></p><p>æ¶ˆæ¯æŠ•é€’è¯­ä¹‰æœ‰ä¸‰ç§ï¼š</p><p><strong>At most once</strong>ï¼šæœ€å¤šä¸€æ¬¡ï¼Œæ¶ˆæ¯å¯èƒ½ä¸¢å¤±ï¼Œä½†ä¸ä¼šé‡å¤</p><p><strong>At least once</strong>ï¼šæœ€å°‘ä¸€æ¬¡ï¼Œæ¶ˆæ¯ä¸ä¼šä¸¢å¤±ï¼Œå¯èƒ½ä¼šé‡å¤</p><p><strong>Exactly once</strong>ï¼šæœ‰ä¸”åªæœ‰ä¸€æ¬¡ï¼Œæ¶ˆæ¯ä¸ä¼šä¸¢å¤±æˆ–é‡å¤ï¼Œåªä¼šæ¶ˆè´¹ä¸€æ¬¡ï¼ˆ0.11ç‰ˆæœ¬å®ç°ï¼Œä»…é™äºä¸‹æ¸¸ä¹Ÿæ˜¯kafkaï¼‰</p><h4 id="å¹‚ç­‰ï¼špartitionå†…éƒ¨çš„exactly-onceé¡ºåºè¯­ä¹‰"><a href="#å¹‚ç­‰ï¼špartitionå†…éƒ¨çš„exactly-onceé¡ºåºè¯­ä¹‰" class="headerlink" title="å¹‚ç­‰ï¼špartitionå†…éƒ¨çš„exactly-onceé¡ºåºè¯­ä¹‰"></a>å¹‚ç­‰ï¼špartitionå†…éƒ¨çš„exactly-onceé¡ºåºè¯­ä¹‰</h4><p>å¹‚ç­‰æ“ä½œï¼Œæ˜¯æŒ‡å¯ä»¥æ‰§è¡Œå¤šæ¬¡ï¼Œè€Œä¸ä¼šäº§ç”Ÿä¸ä»…æ‰§è¡Œä¸€æ¬¡ä¸åŒç»“æœçš„æ“ä½œï¼ŒProducerçš„sendæ“ä½œç°åœ¨æ˜¯å¹‚ç­‰çš„ã€‚åœ¨ä»»ä½•å¯¼è‡´produceré‡è¯•çš„æƒ…å†µä¸‹ï¼Œç›¸åŒçš„æ¶ˆæ¯ï¼Œå¦‚æœè¢«producerå‘é€å¤šæ¬¡ï¼Œä¹Ÿåªä¼šè¢«å†™å…¥Kafkaä¸€æ¬¡ã€‚è¦æ‰“å¼€æ­¤åŠŸèƒ½ï¼Œå¹¶è®©æ‰€æœ‰partitionè·å¾—exactly-once deliveryã€æ— æ•°æ®ä¸¢å¤±å’Œin-orderè¯­ä¹‰ï¼Œéœ€è¦ä¿®æ”¹brokerçš„é…ç½®ï¼š<strong>enable.idempotence &#x3D; true</strong>ã€‚</p><p>è¿™ä¸ªåŠŸèƒ½å¦‚ä½•å·¥ä½œï¼Ÿå®ƒçš„å·¥ä½œæ–¹å¼ç±»ä¼¼äºTCPï¼šå‘é€åˆ°Kafkaçš„æ¯æ‰¹æ¶ˆæ¯å°†åŒ…å«ä¸€ä¸ªåºåˆ—å·ï¼Œè¯¥åºåˆ—å·ç”¨äºé‡å¤æ•°æ®çš„åˆ é™¤ã€‚ä¸TCPä¸åŒï¼ŒTCPåªèƒ½åœ¨transient in-memoryä¸­æä¾›ä¿è¯ã€‚<strong>åºåˆ—å·å°†è¢«æŒä¹…åŒ–å­˜å‚¨topicä¸­ï¼Œå› æ­¤å³ä½¿leader replicaå¤±è´¥ï¼Œæ¥ç®¡çš„ä»»ä½•å…¶ä»–brokerä¹Ÿå°†èƒ½æ„ŸçŸ¥åˆ°æ¶ˆæ¯æ˜¯å¦é‡å¤ã€‚</strong></p><p>è¿™ç§æœºåˆ¶çš„å¼€é”€ç›¸å½“ä½ï¼šå®ƒåªæ˜¯åœ¨æ¯æ‰¹æ¶ˆæ¯ä¸­æ·»åŠ äº†å‡ ä¸ªé¢å¤–å­—æ®µ:</p><ul><li>PIDï¼Œåœ¨Produceråˆå§‹åŒ–æ—¶åˆ†é…ï¼Œä½œä¸ºæ¯ä¸ªProducerä¼šè¯çš„å”¯ä¸€æ ‡è¯†ï¼›</li><li>åºåˆ—å·ï¼ˆsequence numberï¼‰ï¼ŒProducerå‘é€çš„æ¯æ¡æ¶ˆæ¯ï¼ˆæ›´å‡†ç¡®åœ°è¯´æ˜¯æ¯ä¸€ä¸ªæ¶ˆæ¯æ‰¹æ¬¡ï¼Œå³ProducerBatchï¼‰éƒ½ä¼šå¸¦æœ‰æ­¤åºåˆ—å·ï¼Œä»0å¼€å§‹å•è°ƒé€’å¢ã€‚Brokeræ ¹æ®å®ƒæ¥åˆ¤æ–­å†™å…¥çš„æ¶ˆæ¯æ˜¯å¦å¯æ¥å—ã€‚</li></ul><h3 id="äº‹åŠ¡æœºåˆ¶ï¼šè·¨partitionçš„åŸå­æ€§å†™æ“ä½œ"><a href="#äº‹åŠ¡æœºåˆ¶ï¼šè·¨partitionçš„åŸå­æ€§å†™æ“ä½œ" class="headerlink" title="äº‹åŠ¡æœºåˆ¶ï¼šè·¨partitionçš„åŸå­æ€§å†™æ“ä½œ"></a>äº‹åŠ¡æœºåˆ¶ï¼šè·¨partitionçš„åŸå­æ€§å†™æ“ä½œ</h3><p><a href="https://www.cnblogs.com/luxiaoxun/p/13048474.html">https://www.cnblogs.com/luxiaoxun/p/13048474.html</a></p><h2 id="é«˜æ€§èƒ½"><a href="#é«˜æ€§èƒ½" class="headerlink" title="é«˜æ€§èƒ½"></a>é«˜æ€§èƒ½</h2><h3 id="ä¸ºä»€ä¹ˆç”¨kafkaä¸ç”¨æœ¬åœ°é˜Ÿåˆ—"><a href="#ä¸ºä»€ä¹ˆç”¨kafkaä¸ç”¨æœ¬åœ°é˜Ÿåˆ—" class="headerlink" title="ä¸ºä»€ä¹ˆç”¨kafkaä¸ç”¨æœ¬åœ°é˜Ÿåˆ—"></a>ä¸ºä»€ä¹ˆç”¨kafkaä¸ç”¨æœ¬åœ°é˜Ÿåˆ—</h3><p>é«˜åå</p><p>æ¶ˆæ¯æŒä¹…åŒ–</p><p>åˆ†å¸ƒå¼æ˜“æ‹“å±•</p><h3 id="kafkaä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«"><a href="#kafkaä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«" class="headerlink" title="kafkaä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«"></a>kafkaä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«</h3><p>Kafkaé€Ÿåº¦çš„ç§˜è¯€åœ¨äºï¼Œå®ƒæŠŠæ‰€æœ‰çš„æ¶ˆæ¯éƒ½å˜æˆä¸€ä¸ªæ‰¹é‡çš„æ–‡ä»¶ï¼Œå¹¶ä¸”è¿›è¡Œåˆç†çš„æ‰¹é‡å‹ç¼©ï¼Œå‡å°‘ç½‘ç»œIOæŸè€—ï¼Œé€šè¿‡mmapæé«˜I&#x2F;Oé€Ÿåº¦ï¼Œå†™å…¥æ•°æ®çš„æ—¶å€™ç”±äºå•ä¸ªPartionæ˜¯æœ«å°¾æ·»åŠ æ‰€ä»¥é€Ÿåº¦æœ€ä¼˜ï¼›è¯»å–æ•°æ®çš„æ—¶å€™é…åˆsendfileç›´æ¥æš´åŠ›è¾“å‡ºã€‚</p><p>å…·ä½“åˆ†å†™å…¥å’Œè¯»å–ä¸¤ä¸ªæ–¹é¢ï¼š</p><p><strong>å†™å…¥</strong>ï¼š</p><ul><li>ä½¿ç”¨é¡ºåºå†™å…¥</li><li>Memory Mapped Files</li></ul><p><strong>è¯»å–</strong>ï¼š</p><ul><li>åŸºäºsendfileå®ç°Zero Copy</li><li>æ‰¹é‡å‹ç¼©</li></ul><h3 id="ä»€ä¹ˆæ˜¯é›¶æ‹·è´ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯é›¶æ‹·è´ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯é›¶æ‹·è´ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯é›¶æ‹·è´ï¼Ÿ</h3><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210529210252.webp" alt="å›¾ç‰‡"></p><p><a href="https://www.cnblogs.com/rickiyang/p/13265043.html">https://www.cnblogs.com/rickiyang/p/13265043.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> é¢ç» </tag>
            
            <tag> kafka </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>äº”æœˆç¬¬äºŒå‘¨</title>
      <link href="/posts/b2caa2b7.html"/>
      <url>/posts/b2caa2b7.html</url>
      
        <content type="html"><![CDATA[<hr><p>æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾æ¯å‘¨æ‰“å¡ 2021.05.17-2021.05.23</p><h3 id="437-è·¯å¾„æ€»å’Œ-III"><a href="#437-è·¯å¾„æ€»å’Œ-III" class="headerlink" title="437. è·¯å¾„æ€»å’Œ III"></a><a href="https://leetcode-cn.com/problems/path-sum-iii/">437. è·¯å¾„æ€»å’Œ III</a></h3><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œå®ƒçš„æ¯ä¸ªç»“ç‚¹éƒ½å­˜æ”¾ç€ä¸€ä¸ªæ•´æ•°å€¼ã€‚</p><p>æ‰¾å‡ºè·¯å¾„å’Œç­‰äºç»™å®šæ•°å€¼çš„è·¯å¾„æ€»æ•°ã€‚</p><p>è·¯å¾„ä¸éœ€è¦ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œä¹Ÿä¸éœ€è¦åœ¨å¶å­èŠ‚ç‚¹ç»“æŸï¼Œä½†æ˜¯è·¯å¾„æ–¹å‘å¿…é¡»æ˜¯å‘ä¸‹çš„ï¼ˆåªèƒ½ä»çˆ¶èŠ‚ç‚¹åˆ°å­èŠ‚ç‚¹ï¼‰ã€‚</p><p>äºŒå‰æ ‘ä¸è¶…è¿‡1000ä¸ªèŠ‚ç‚¹ï¼Œä¸”èŠ‚ç‚¹æ•°å€¼èŒƒå›´æ˜¯ [-1000000,1000000] çš„æ•´æ•°ã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root = [10,5,-3,3,2,null,11,3,-2,null,1], sum = 8</span><br><span class="line"></span><br><span class="line">      10</span><br><span class="line">     /  \</span><br><span class="line">    5   -3</span><br><span class="line">   / \    \</span><br><span class="line">  3   2   11</span><br><span class="line"> / \   \</span><br><span class="line">3  -2   1</span><br><span class="line"></span><br><span class="line">è¿”å› 3ã€‚å’Œç­‰äº 8 çš„è·¯å¾„æœ‰:</span><br><span class="line"></span><br><span class="line">1.  5 -&gt; 3</span><br><span class="line">2.  5 -&gt; 2 -&gt; 1</span><br><span class="line">3.  -3 -&gt; 11</span><br></pre></td></tr></table></figure><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h3 id="889-æ ¹æ®å‰åºå’Œååºéå†æ„é€ äºŒå‰æ ‘"><a href="#889-æ ¹æ®å‰åºå’Œååºéå†æ„é€ äºŒå‰æ ‘" class="headerlink" title="889. æ ¹æ®å‰åºå’Œååºéå†æ„é€ äºŒå‰æ ‘"></a><a href="https://leetcode-cn.com/problems/construct-binary-tree-from-preorder-and-postorder-traversal/">889. æ ¹æ®å‰åºå’Œååºéå†æ„é€ äºŒå‰æ ‘</a></h3><p>éš¾åº¦ä¸­ç­‰165</p><p>è¿”å›ä¸ç»™å®šçš„å‰åºå’Œååºéå†åŒ¹é…çš„ä»»ä½•äºŒå‰æ ‘ã€‚</p><p> <code>pre</code> å’Œ <code>post</code> éå†ä¸­çš„å€¼æ˜¯ä¸åŒçš„æ­£æ•´æ•°ã€‚</p><p> <strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼špre = [1,2,4,5,3,6,7], post = [4,5,2,6,7,3,1]</span><br><span class="line">è¾“å‡ºï¼š[1,2,3,4,5,6,7]</span><br></pre></td></tr></table></figure><p> <strong>æç¤ºï¼š</strong></p><ul><li><code>1 &lt;= pre.length == post.length &lt;= 30</code></li><li><code>pre[]</code> å’Œ <code>post[]</code> éƒ½æ˜¯ <code>1, 2, ..., pre.length</code> çš„æ’åˆ—</li><li>æ¯ä¸ªè¾“å…¥ä¿è¯è‡³å°‘æœ‰ä¸€ä¸ªç­”æ¡ˆã€‚å¦‚æœæœ‰å¤šä¸ªç­”æ¡ˆï¼Œå¯ä»¥è¿”å›å…¶ä¸­ä¸€ä¸ªã€‚</li></ul><h4 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ </tag>
            
            <tag> æ¯å‘¨æ‰“å¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>äº”æœˆç¬¬ä¸€å‘¨</title>
      <link href="/posts/82dc4e6f.html"/>
      <url>/posts/82dc4e6f.html</url>
      
        <content type="html"><![CDATA[<hr><p>æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾æ¯å‘¨æ‰“å¡ 2021.05.10-2021.05.16</p><h3 id="å‰‘æŒ‡-Offer-34-äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„"><a href="#å‰‘æŒ‡-Offer-34-äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„" class="headerlink" title="å‰‘æŒ‡ Offer 34. äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„"></a><a href="https://leetcode-cn.com/problems/er-cha-shu-zhong-he-wei-mou-yi-zhi-de-lu-jing-lcof/">å‰‘æŒ‡ Offer 34. äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„</a></h3><p>è¾“å…¥ä¸€æ£µäºŒå‰æ ‘å’Œä¸€ä¸ªæ•´æ•°ï¼Œæ‰“å°å‡ºäºŒå‰æ ‘ä¸­èŠ‚ç‚¹å€¼çš„å’Œä¸ºè¾“å…¥æ•´æ•°çš„æ‰€æœ‰è·¯å¾„ã€‚ä»æ ‘çš„æ ¹èŠ‚ç‚¹å¼€å§‹å¾€ä¸‹ä¸€ç›´åˆ°å¶èŠ‚ç‚¹æ‰€ç»è¿‡çš„èŠ‚ç‚¹å½¢æˆä¸€æ¡è·¯å¾„ã€‚</p><p><strong>ç¤ºä¾‹:</strong><br>ç»™å®šå¦‚ä¸‹äºŒå‰æ ‘ï¼Œä»¥åŠç›®æ ‡å’Œ <code>target = 22</code>ï¼Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">      5</span><br><span class="line">     / \</span><br><span class="line">    4   8</span><br><span class="line">   /   / \</span><br><span class="line">  11  13  4</span><br><span class="line"> /  \    / \</span><br><span class="line">7    2  5   1</span><br></pre></td></tr></table></figure><p>è¿”å›:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">   [5,4,11,2],</span><br><span class="line">   [5,8,4,5]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p> <strong>æç¤ºï¼š</strong></p><ol><li><code>èŠ‚ç‚¹æ€»æ•° &lt;= 10000</code></li></ol><p>æ³¨æ„ï¼šæœ¬é¢˜ä¸ä¸»ç«™ 113 é¢˜ç›¸åŒï¼š<a href="https://leetcode-cn.com/problems/path-sum-ii/">https://leetcode-cn.com/problems/path-sum-ii/</a></p><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h3 id="é¢è¯•é¢˜-04-03-ç‰¹å®šæ·±åº¦èŠ‚ç‚¹é“¾è¡¨"><a href="#é¢è¯•é¢˜-04-03-ç‰¹å®šæ·±åº¦èŠ‚ç‚¹é“¾è¡¨" class="headerlink" title="é¢è¯•é¢˜ 04.03. ç‰¹å®šæ·±åº¦èŠ‚ç‚¹é“¾è¡¨"></a><a href="https://leetcode-cn.com/problems/list-of-depth-lcci/">é¢è¯•é¢˜ 04.03. ç‰¹å®šæ·±åº¦èŠ‚ç‚¹é“¾è¡¨</a></h3><p>ç»™å®šä¸€æ£µäºŒå‰æ ‘ï¼Œè®¾è®¡ä¸€ä¸ªç®—æ³•ï¼Œåˆ›å»ºå«æœ‰æŸä¸€æ·±åº¦ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„é“¾è¡¨ï¼ˆæ¯”å¦‚ï¼Œè‹¥ä¸€æ£µæ ‘çš„æ·±åº¦ä¸º <code>D</code>ï¼Œåˆ™ä¼šåˆ›å»ºå‡º <code>D</code> ä¸ªé“¾è¡¨ï¼‰ã€‚è¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰æ·±åº¦çš„é“¾è¡¨çš„æ•°ç»„ã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼š[1,2,3,4,5,null,7,8]</span><br><span class="line"></span><br><span class="line">        1</span><br><span class="line">       /  \ </span><br><span class="line">      2    3</span><br><span class="line">     / \    \ </span><br><span class="line">    4   5    7</span><br><span class="line">   /</span><br><span class="line">  8</span><br><span class="line"></span><br><span class="line">è¾“å‡ºï¼š[[1],[2,3],[4,5,7],[8]]</span><br></pre></td></tr></table></figure><h4 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ </tag>
            
            <tag> æ¯å‘¨æ‰“å¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaåŸºç¡€</title>
      <link href="/posts/f7ede91d.html"/>
      <url>/posts/f7ede91d.html</url>
      
        <content type="html"><![CDATA[<hr><h2 id="é›†åˆ"><a href="#é›†åˆ" class="headerlink" title="é›†åˆ"></a>é›†åˆ</h2><h3 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h3><h3 id="ConcurrentHashMap"><a href="#ConcurrentHashMap" class="headerlink" title="ConcurrentHashMap"></a>ConcurrentHashMap</h3><h4 id="é›†åˆå¤§å°å¦‚ä½•è®¡ç®—"><a href="#é›†åˆå¤§å°å¦‚ä½•è®¡ç®—" class="headerlink" title="é›†åˆå¤§å°å¦‚ä½•è®¡ç®—"></a>é›†åˆå¤§å°å¦‚ä½•è®¡ç®—</h4><p><strong>1.7</strong></p><p>JDK7ç‰ˆæœ¬ç»è¿‡ä¸‰æ¬¡è®¡ç®—ï¼Œå‘ç°æ¯æ¬¡ç»Ÿè®¡æ—¶å“ˆå¸Œéƒ½æœ‰ç»“æ„æ€§çš„å˜åŒ–ï¼Œå°±ä¼šç»™æ¯ä¸ªSegmentåŠ é”ï¼›è€Œå½“è‡ªå·±ç»Ÿè®¡å®Œä¹‹åï¼Œæ‰ä¼šæŠŠé”é‡Šæ”¾æ‰ã€‚</p><p><strong>1.8</strong></p><p>å€ŸåŠ©baseCountå’ŒcountCellså±æ€§</p>]]></content>
      
      
      
        <tags>
            
            <tag> é¢ç» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>23è®² | äºŒå‰æ ‘åŸºç¡€ï¼ˆä¸Šï¼‰</title>
      <link href="/posts/e0f293c6.html"/>
      <url>/posts/e0f293c6.html</url>
      
        <content type="html"><![CDATA[<hr><h1 id="23-äºŒå‰æ ‘åŸºç¡€ï¼ˆä¸Šï¼‰ï¼šä»€ä¹ˆæ ·çš„äºŒå‰æ ‘é€‚åˆç”¨æ•°ç»„æ¥å­˜å‚¨ï¼Ÿ"><a href="#23-äºŒå‰æ ‘åŸºç¡€ï¼ˆä¸Šï¼‰ï¼šä»€ä¹ˆæ ·çš„äºŒå‰æ ‘é€‚åˆç”¨æ•°ç»„æ¥å­˜å‚¨ï¼Ÿ" class="headerlink" title="23 | äºŒå‰æ ‘åŸºç¡€ï¼ˆä¸Šï¼‰ï¼šä»€ä¹ˆæ ·çš„äºŒå‰æ ‘é€‚åˆç”¨æ•°ç»„æ¥å­˜å‚¨ï¼Ÿ"></a>23 | äºŒå‰æ ‘åŸºç¡€ï¼ˆä¸Šï¼‰ï¼šä»€ä¹ˆæ ·çš„äºŒå‰æ ‘é€‚åˆç”¨æ•°ç»„æ¥å­˜å‚¨ï¼Ÿ</h1><h2 id="æ ‘ï¼ˆTreeï¼‰"><a href="#æ ‘ï¼ˆTreeï¼‰" class="headerlink" title="æ ‘ï¼ˆTreeï¼‰"></a>æ ‘ï¼ˆTreeï¼‰</h2><p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹ï¼Œä»€ä¹ˆæ˜¯â€œæ ‘â€ï¼Ÿå†å®Œå¤‡çš„å®šä¹‰ï¼Œéƒ½æ²¡æœ‰å›¾ç›´è§‚ã€‚æ‰€ä»¥æˆ‘åœ¨å›¾ä¸­ç”»äº†å‡ æ£µâ€œæ ‘â€ã€‚ä½ æ¥çœ‹çœ‹ï¼Œè¿™äº›â€œæ ‘â€éƒ½æœ‰ä»€ä¹ˆç‰¹å¾ï¼Ÿ</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210515215731.jpeg" alt="img"></p><p>ä½ æœ‰æ²¡æœ‰å‘ç°ï¼Œâ€œæ ‘â€è¿™ç§æ•°æ®ç»“æ„çœŸçš„å¾ˆåƒæˆ‘ä»¬ç°å®ç”Ÿæ´»ä¸­çš„â€œæ ‘â€ï¼Œè¿™é‡Œé¢æ¯ä¸ªå…ƒç´ æˆ‘ä»¬å«åšâ€œèŠ‚ç‚¹â€ï¼›ç”¨æ¥è¿æ¥ç›¸é‚»èŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»ï¼Œæˆ‘ä»¬å«åšâ€œçˆ¶å­å…³ç³»â€ã€‚</p><p>æ¯”å¦‚ä¸‹é¢è¿™å¹…å›¾ï¼ŒA èŠ‚ç‚¹å°±æ˜¯ B èŠ‚ç‚¹çš„<strong>çˆ¶èŠ‚ç‚¹</strong>ï¼ŒB èŠ‚ç‚¹æ˜¯ A èŠ‚ç‚¹çš„<strong>å­èŠ‚ç‚¹</strong>ã€‚Bã€Cã€D è¿™ä¸‰ä¸ªèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥å®ƒä»¬ä¹‹é—´äº’ç§°ä¸º<strong>å…„å¼ŸèŠ‚ç‚¹ã€‚</strong>æˆ‘ä»¬æŠŠæ²¡æœ‰çˆ¶èŠ‚ç‚¹çš„èŠ‚ç‚¹å«åš<strong>æ ¹èŠ‚ç‚¹</strong>ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„èŠ‚ç‚¹ Eã€‚æˆ‘ä»¬æŠŠæ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹å«åš<strong>å¶å­èŠ‚ç‚¹</strong>æˆ–è€…<strong>å¶èŠ‚ç‚¹</strong>ï¼Œæ¯”å¦‚å›¾ä¸­çš„ Gã€Hã€Iã€Jã€Kã€L éƒ½æ˜¯å¶å­èŠ‚ç‚¹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210515215750.jpeg" alt="img"></p><p>é™¤æ­¤ä¹‹å¤–ï¼Œå…³äºâ€œæ ‘â€ï¼Œè¿˜æœ‰ä¸‰ä¸ªæ¯”è¾ƒç›¸ä¼¼çš„æ¦‚å¿µï¼š<strong>é«˜åº¦</strong>ï¼ˆHeightï¼‰ã€<strong>æ·±åº¦</strong>ï¼ˆDepthï¼‰ã€<strong>å±‚</strong>ï¼ˆLevelï¼‰ã€‚å®ƒä»¬çš„å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210515215851.jpeg" alt="img"></p><p>è¿™ä¸‰ä¸ªæ¦‚å¿µçš„å®šä¹‰æ¯”è¾ƒå®¹æ˜“æ··æ·†ï¼Œæè¿°èµ·æ¥ä¹Ÿæ¯”è¾ƒç©ºæ´ã€‚æˆ‘ä¸¾ä¸ªä¾‹å­è¯´æ˜ä¸€ä¸‹ï¼Œä½ ä¸€çœ‹åº”è¯¥å°±èƒ½æ˜ç™½ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210515215915.jpeg" alt="img"></p><p>è®°è¿™å‡ ä¸ªæ¦‚å¿µï¼Œæˆ‘è¿˜æœ‰ä¸€ä¸ªå°çªé—¨ï¼Œå°±æ˜¯ç±»æ¯”â€œé«˜åº¦â€â€œæ·±åº¦â€â€œå±‚â€è¿™å‡ ä¸ªåè¯åœ¨ç”Ÿæ´»ä¸­çš„å«ä¹‰ã€‚</p><p>åœ¨æˆ‘ä»¬çš„ç”Ÿæ´»ä¸­ï¼Œâ€œé«˜åº¦â€è¿™ä¸ªæ¦‚å¿µï¼Œå…¶å®å°±æ˜¯ä»ä¸‹å¾€ä¸Šåº¦é‡ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦åº¦é‡ç¬¬ 10 å±‚æ¥¼çš„é«˜åº¦ã€ç¬¬ 13 å±‚æ¥¼çš„é«˜åº¦ï¼Œèµ·ç‚¹éƒ½æ˜¯åœ°é¢ã€‚æ‰€ä»¥ï¼Œæ ‘è¿™ç§æ•°æ®ç»“æ„çš„é«˜åº¦ä¹Ÿæ˜¯ä¸€æ ·ï¼Œä»æœ€åº•å±‚å¼€å§‹è®¡æ•°ï¼Œå¹¶ä¸”è®¡æ•°çš„èµ·ç‚¹æ˜¯ 0ã€‚</p><p>â€œæ·±åº¦â€è¿™ä¸ªæ¦‚å¿µåœ¨ç”Ÿæ´»ä¸­æ˜¯ä»ä¸Šå¾€ä¸‹åº¦é‡çš„ï¼Œæ¯”å¦‚æ°´ä¸­é±¼çš„æ·±åº¦ï¼Œæ˜¯ä»æ°´å¹³é¢å¼€å§‹åº¦é‡çš„ã€‚æ‰€ä»¥ï¼Œæ ‘è¿™ç§æ•°æ®ç»“æ„çš„æ·±åº¦ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œä»æ ¹ç»“ç‚¹å¼€å§‹åº¦é‡ï¼Œå¹¶ä¸”è®¡æ•°èµ·ç‚¹ä¹Ÿæ˜¯ 0ã€‚</p><p>â€œå±‚æ•°â€è·Ÿæ·±åº¦çš„è®¡ç®—ç±»ä¼¼ï¼Œä¸è¿‡ï¼Œè®¡æ•°èµ·ç‚¹æ˜¯ 1ï¼Œä¹Ÿå°±æ˜¯è¯´æ ¹èŠ‚ç‚¹ä½äºç¬¬ 1 å±‚ã€‚</p><h2 id="äºŒå‰æ ‘ï¼ˆBinary-Treeï¼‰"><a href="#äºŒå‰æ ‘ï¼ˆBinary-Treeï¼‰" class="headerlink" title="äºŒå‰æ ‘ï¼ˆBinary Treeï¼‰"></a>äºŒå‰æ ‘ï¼ˆBinary Treeï¼‰</h2><p>æ ‘ç»“æ„å¤šç§å¤šæ ·ï¼Œä¸è¿‡æˆ‘ä»¬æœ€å¸¸ç”¨è¿˜æ˜¯äºŒå‰æ ‘ã€‚</p><p>äºŒå‰æ ‘ï¼Œé¡¾åæ€ä¹‰ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰ä¸¤ä¸ªâ€œå‰â€ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œåˆ†åˆ«æ˜¯å·¦å­èŠ‚ç‚¹å’Œå³å­èŠ‚ç‚¹ã€‚ä¸è¿‡ï¼ŒäºŒå‰æ ‘å¹¶ä¸è¦æ±‚æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œæœ‰çš„èŠ‚ç‚¹åªæœ‰å·¦å­èŠ‚ç‚¹ï¼Œæœ‰çš„èŠ‚ç‚¹åªæœ‰å³å­èŠ‚ç‚¹ã€‚æˆ‘ç”»çš„è¿™å‡ ä¸ªéƒ½æ˜¯äºŒå‰æ ‘ã€‚ä»¥æ­¤ç±»æ¨ï¼Œä½ å¯ä»¥æƒ³è±¡ä¸€ä¸‹å››å‰æ ‘ã€å…«å‰æ ‘é•¿ä»€ä¹ˆæ ·å­ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210515213800.jpeg" alt="img"></p><p>è¿™ä¸ªå›¾é‡Œé¢ï¼Œæœ‰ä¸¤ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„äºŒå‰æ ‘ï¼Œåˆ†åˆ«æ˜¯ç¼–å· 2 å’Œç¼–å· 3 è¿™ä¸¤ä¸ªã€‚</p><p>å…¶ä¸­ï¼Œç¼–å· 2 çš„äºŒå‰æ ‘ä¸­ï¼Œå¶å­èŠ‚ç‚¹å…¨éƒ½åœ¨æœ€åº•å±‚ï¼Œé™¤äº†å¶å­èŠ‚ç‚¹ä¹‹å¤–ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰å·¦å³ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œè¿™ç§äºŒå‰æ ‘å°±å«åšæ»¡äºŒå‰æ ‘ã€‚</p><p>ç¼–å· 3 çš„äºŒå‰æ ‘ä¸­ï¼Œå¶å­èŠ‚ç‚¹éƒ½åœ¨æœ€åº•ä¸‹ä¸¤å±‚ï¼Œæœ€åä¸€å±‚çš„å¶å­èŠ‚ç‚¹éƒ½é å·¦æ’åˆ—ï¼Œå¹¶ä¸”é™¤äº†æœ€åä¸€å±‚ï¼Œå…¶ä»–å±‚çš„èŠ‚ç‚¹ä¸ªæ•°éƒ½è¦è¾¾åˆ°æœ€å¤§ï¼Œè¿™ç§äºŒå‰æ ‘å«åšå®Œå…¨äºŒå‰æ ‘ã€‚</p><p>æ»¡äºŒå‰æ ‘å¾ˆå¥½ç†è§£ï¼Œä¹Ÿå¾ˆå¥½è¯†åˆ«ï¼Œä½†æ˜¯å®Œå…¨äºŒå‰æ ‘ï¼Œæœ‰çš„äººå¯èƒ½å°±åˆ†ä¸æ¸…äº†ã€‚æˆ‘ç”»äº†å‡ ä¸ªå®Œå…¨äºŒå‰æ ‘å’Œéå®Œå…¨äºŒå‰æ ‘çš„ä¾‹å­ï¼Œä½ å¯ä»¥å¯¹æ¯”ç€çœ‹çœ‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210515213820.jpeg" alt="img"></p><p>ä½ å¯èƒ½ä¼šè¯´ï¼Œæ»¡äºŒå‰æ ‘çš„ç‰¹å¾éå¸¸æ˜æ˜¾ï¼Œæˆ‘ä»¬æŠŠå®ƒå•ç‹¬æ‹å‡ºæ¥è®²ï¼Œè¿™ä¸ªå¯ä»¥ç†è§£ã€‚ä½†æ˜¯å®Œå…¨äºŒå‰æ ‘çš„ç‰¹å¾ä¸æ€ä¹ˆæ˜æ˜¾å•Šï¼Œå•ä»é•¿ç›¸ä¸Šæ¥çœ‹ï¼Œå®Œå…¨äºŒå‰æ ‘å¹¶æ²¡æœ‰ç‰¹åˆ«ç‰¹æ®Šçš„åœ°æ–¹å•Šï¼Œæ›´åƒæ˜¯â€œèŠ¸èŠ¸ä¼—æ ‘â€ä¸­çš„ä¸€ç§ã€‚</p><p>é‚£æˆ‘ä»¬ä¸ºä»€ä¹ˆè¿˜è¦ç‰¹æ„æŠŠå®ƒæ‹å‡ºæ¥è®²å‘¢ï¼Ÿä¸ºä»€ä¹ˆååæŠŠæœ€åä¸€å±‚çš„å¶å­èŠ‚ç‚¹é å·¦æ’åˆ—çš„å«å®Œå…¨äºŒå‰æ ‘ï¼Ÿå¦‚æœé å³æ’åˆ—å°±ä¸èƒ½å«å®Œå…¨äºŒå‰æ ‘äº†å—ï¼Ÿè¿™ä¸ªå®šä¹‰çš„ç”±æ¥æˆ–è€…è¯´ç›®çš„åœ¨å“ªé‡Œï¼Ÿ</p><p>è¦ç†è§£å®Œå…¨äºŒå‰æ ‘å®šä¹‰çš„ç”±æ¥ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ï¼Œ<strong>å¦‚ä½•è¡¨ç¤ºï¼ˆæˆ–è€…å­˜å‚¨ï¼‰ä¸€æ£µäºŒå‰æ ‘</strong>ï¼Ÿ</p><p>æƒ³è¦å­˜å‚¨ä¸€æ£µäºŒå‰æ ‘ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€ç§æ˜¯åŸºäºæŒ‡é’ˆæˆ–è€…å¼•ç”¨çš„äºŒå‰é“¾å¼å­˜å‚¨æ³•ï¼Œä¸€ç§æ˜¯åŸºäºæ•°ç»„çš„é¡ºåºå­˜å‚¨æ³•ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹æ¯”è¾ƒç®€å•ã€ç›´è§‚çš„<strong>é“¾å¼å­˜å‚¨æ³•</strong>ã€‚ä»å›¾ä¸­ä½ åº”è¯¥å¯ä»¥å¾ˆæ¸…æ¥šåœ°çœ‹åˆ°ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ‰ä¸‰ä¸ªå­—æ®µï¼Œå…¶ä¸­ä¸€ä¸ªå­˜å‚¨æ•°æ®ï¼Œå¦å¤–ä¸¤ä¸ªæ˜¯æŒ‡å‘å·¦å³å­èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚æˆ‘ä»¬åªè¦æ‹ä½æ ¹èŠ‚ç‚¹ï¼Œå°±å¯ä»¥é€šè¿‡å·¦å³å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼ŒæŠŠæ•´æ£µæ ‘éƒ½ä¸²èµ·æ¥ã€‚è¿™ç§å­˜å‚¨æ–¹å¼æˆ‘ä»¬æ¯”è¾ƒå¸¸ç”¨ã€‚å¤§éƒ¨åˆ†äºŒå‰æ ‘ä»£ç éƒ½æ˜¯é€šè¿‡è¿™ç§ç»“æ„æ¥å®ç°çš„ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210515213921.jpeg" alt="img"></p><p>æˆ‘ä»¬å†æ¥çœ‹ï¼ŒåŸºäºæ•°ç»„çš„<strong>é¡ºåºå­˜å‚¨æ³•</strong>ã€‚æˆ‘ä»¬æŠŠæ ¹èŠ‚ç‚¹å­˜å‚¨åœ¨ä¸‹æ ‡ i &#x3D; 1 çš„ä½ç½®ï¼Œé‚£å·¦å­èŠ‚ç‚¹å­˜å‚¨åœ¨ä¸‹æ ‡ 2 * i &#x3D; 2 çš„ä½ç½®ï¼Œå³å­èŠ‚ç‚¹å­˜å‚¨åœ¨ 2 * i + 1 &#x3D; 3 çš„ä½ç½®ã€‚ä»¥æ­¤ç±»æ¨ï¼ŒB èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹å­˜å‚¨åœ¨ 2 * i &#x3D; 2 * 2 &#x3D; 4 çš„ä½ç½®ï¼Œå³å­èŠ‚ç‚¹å­˜å‚¨åœ¨ 2 * i + 1 &#x3D; 2 * 2 + 1 &#x3D; 5 çš„ä½ç½®ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210515214026.jpeg" alt="img"></p><p>æˆ‘æ¥æ€»ç»“ä¸€ä¸‹ï¼Œå¦‚æœèŠ‚ç‚¹ X å­˜å‚¨åœ¨æ•°ç»„ä¸­ä¸‹æ ‡ä¸º i çš„ä½ç½®ï¼Œä¸‹æ ‡ä¸º 2 * i çš„ä½ç½®å­˜å‚¨çš„å°±æ˜¯å·¦å­èŠ‚ç‚¹ï¼Œä¸‹æ ‡ä¸º 2 * i + 1 çš„ä½ç½®å­˜å‚¨çš„å°±æ˜¯å³å­èŠ‚ç‚¹ã€‚åè¿‡æ¥ï¼Œä¸‹æ ‡ä¸º i&#x2F;2 çš„ä½ç½®å­˜å‚¨å°±æ˜¯å®ƒçš„çˆ¶èŠ‚ç‚¹ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬åªè¦çŸ¥é“æ ¹èŠ‚ç‚¹å­˜å‚¨çš„ä½ç½®ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸ºäº†æ–¹ä¾¿è®¡ç®—å­èŠ‚ç‚¹ï¼Œæ ¹èŠ‚ç‚¹ä¼šå­˜å‚¨åœ¨ä¸‹æ ‡ä¸º 1 çš„ä½ç½®ï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡ä¸‹æ ‡è®¡ç®—ï¼ŒæŠŠæ•´æ£µæ ‘éƒ½ä¸²èµ·æ¥ã€‚</p><p>ä¸è¿‡ï¼Œæˆ‘åˆšåˆšä¸¾çš„ä¾‹å­æ˜¯ä¸€æ£µå®Œå…¨äºŒå‰æ ‘ï¼Œæ‰€ä»¥ä»…ä»…â€œæµªè´¹â€äº†ä¸€ä¸ªä¸‹æ ‡ä¸º 0 çš„å­˜å‚¨ä½ç½®ã€‚å¦‚æœæ˜¯éå®Œå…¨äºŒå‰æ ‘ï¼Œå…¶å®ä¼šæµªè´¹æ¯”è¾ƒå¤šçš„æ•°ç»„å­˜å‚¨ç©ºé—´ã€‚ä½ å¯ä»¥çœ‹æˆ‘ä¸¾çš„ä¸‹é¢è¿™ä¸ªä¾‹å­ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210515214223.jpeg" alt="img"></p><p>æ‰€ä»¥ï¼Œå¦‚æœæŸæ£µäºŒå‰æ ‘æ˜¯ä¸€æ£µå®Œå…¨äºŒå‰æ ‘ï¼Œé‚£ç”¨æ•°ç»„å­˜å‚¨æ— ç–‘æ˜¯æœ€èŠ‚çœå†…å­˜çš„ä¸€ç§æ–¹å¼ã€‚å› ä¸ºæ•°ç»„çš„å­˜å‚¨æ–¹å¼å¹¶ä¸éœ€è¦åƒé“¾å¼å­˜å‚¨æ³•é‚£æ ·ï¼Œè¦å­˜å‚¨é¢å¤–çš„å·¦å³å­èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå®Œå…¨äºŒå‰æ ‘ä¼šå•ç‹¬æ‹å‡ºæ¥çš„åŸå› ï¼Œä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå®Œå…¨äºŒå‰æ ‘è¦æ±‚æœ€åä¸€å±‚çš„å­èŠ‚ç‚¹éƒ½é å·¦çš„åŸå› ã€‚</p><p>å½“æˆ‘ä»¬è®²åˆ°å †å’Œå †æ’åºçš„æ—¶å€™ï¼Œä½ ä¼šå‘ç°ï¼Œå †å…¶å®å°±æ˜¯ä¸€ç§å®Œå…¨äºŒå‰æ ‘ï¼Œæœ€å¸¸ç”¨çš„å­˜å‚¨æ–¹å¼å°±æ˜¯æ•°ç»„ã€‚</p><h2 id="äºŒå‰æ ‘çš„éå†"><a href="#äºŒå‰æ ‘çš„éå†" class="headerlink" title="äºŒå‰æ ‘çš„éå†"></a>äºŒå‰æ ‘çš„éå†</h2><p>å‰é¢æˆ‘è®²äº†äºŒå‰æ ‘çš„åŸºæœ¬å®šä¹‰å’Œå­˜å‚¨æ–¹æ³•ï¼Œç°åœ¨æˆ‘ä»¬æ¥çœ‹äºŒå‰æ ‘ä¸­éå¸¸é‡è¦çš„æ“ä½œï¼ŒäºŒå‰æ ‘çš„éå†ã€‚è¿™ä¹Ÿæ˜¯éå¸¸å¸¸è§çš„é¢è¯•é¢˜ã€‚</p><p>å¦‚ä½•å°†æ‰€æœ‰èŠ‚ç‚¹éƒ½éå†æ‰“å°å‡ºæ¥å‘¢ï¼Ÿç»å…¸çš„æ–¹æ³•æœ‰ä¸‰ç§ï¼Œ<strong>å‰åºéå†</strong>ã€<strong>ä¸­åºéå†</strong>å’Œ<strong>ååºéå†</strong>ã€‚å…¶ä¸­ï¼Œå‰ã€ä¸­ã€ååºï¼Œè¡¨ç¤ºçš„æ˜¯èŠ‚ç‚¹ä¸å®ƒçš„å·¦å³å­æ ‘èŠ‚ç‚¹éå†æ‰“å°çš„å…ˆåé¡ºåºã€‚</p><ul><li>å‰åºéå†æ˜¯æŒ‡ï¼Œå¯¹äºæ ‘ä¸­çš„ä»»æ„èŠ‚ç‚¹æ¥è¯´ï¼Œå…ˆæ‰“å°è¿™ä¸ªèŠ‚ç‚¹ï¼Œç„¶åå†æ‰“å°å®ƒçš„å·¦å­æ ‘ï¼Œæœ€åæ‰“å°å®ƒçš„å³å­æ ‘ã€‚</li><li>ä¸­åºéå†æ˜¯æŒ‡ï¼Œå¯¹äºæ ‘ä¸­çš„ä»»æ„èŠ‚ç‚¹æ¥è¯´ï¼Œå…ˆæ‰“å°å®ƒçš„å·¦å­æ ‘ï¼Œç„¶åå†æ‰“å°å®ƒæœ¬èº«ï¼Œæœ€åæ‰“å°å®ƒçš„å³å­æ ‘ã€‚</li><li>ååºéå†æ˜¯æŒ‡ï¼Œå¯¹äºæ ‘ä¸­çš„ä»»æ„èŠ‚ç‚¹æ¥è¯´ï¼Œå…ˆæ‰“å°å®ƒçš„å·¦å­æ ‘ï¼Œç„¶åå†æ‰“å°å®ƒçš„å³å­æ ‘ï¼Œæœ€åæ‰“å°è¿™ä¸ªèŠ‚ç‚¹æœ¬èº«ã€‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210515220044.jpeg" alt="img"></p><p><strong>å®é™…ä¸Šï¼ŒäºŒå‰æ ‘çš„å‰ã€ä¸­ã€ååºéå†å°±æ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹</strong>ã€‚æ¯”å¦‚ï¼Œå‰åºéå†ï¼Œå…¶å®å°±æ˜¯å…ˆæ‰“å°æ ¹èŠ‚ç‚¹ï¼Œç„¶åå†é€’å½’åœ°æ‰“å°å·¦å­æ ‘ï¼Œæœ€åé€’å½’åœ°æ‰“å°å³å­æ ‘ã€‚</p><p>å†™é€’å½’ä»£ç çš„å…³é”®ï¼Œå°±æ˜¯çœ‹èƒ½ä¸èƒ½å†™å‡ºé€’æ¨å…¬å¼ï¼Œè€Œå†™é€’æ¨å…¬å¼çš„å…³é”®å°±æ˜¯ï¼Œå¦‚æœè¦è§£å†³é—®é¢˜ Aï¼Œå°±å‡è®¾å­é—®é¢˜ Bã€C å·²ç»è§£å†³ï¼Œç„¶åå†æ¥çœ‹å¦‚ä½•åˆ©ç”¨ Bã€C æ¥è§£å†³ Aã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå‰ã€ä¸­ã€ååºéå†çš„é€’æ¨å…¬å¼éƒ½å†™å‡ºæ¥ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">å‰åºéå†çš„é€’æ¨å…¬å¼ï¼š</span><br><span class="line">preOrder(r) = <span class="built_in">print</span> r-&gt;preOrder(r-&gt;left)-&gt;preOrder(r-&gt;right)</span><br><span class="line"></span><br><span class="line">ä¸­åºéå†çš„é€’æ¨å…¬å¼ï¼š</span><br><span class="line">inOrder(r) = inOrder(r-&gt;left)-&gt;<span class="built_in">print</span> r-&gt;inOrder(r-&gt;right)</span><br><span class="line"></span><br><span class="line">ååºéå†çš„é€’æ¨å…¬å¼ï¼š</span><br><span class="line">postOrder(r) = postOrder(r-&gt;left)-&gt;postOrder(r-&gt;right)-&gt;<span class="built_in">print</span> r</span><br></pre></td></tr></table></figure><p>æœ‰äº†é€’æ¨å…¬å¼ï¼Œä»£ç å†™èµ·æ¥å°±ç®€å•å¤šäº†ã€‚è¿™ä¸‰ç§éå†æ–¹å¼çš„ä»£ç ï¼Œæˆ‘éƒ½å†™å‡ºæ¥äº†ï¼Œä½ å¯ä»¥çœ‹çœ‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">preOrder</span><span class="params">(Node* root)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (root == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">  print root <span class="comment">// æ­¤å¤„ä¸ºä¼ªä»£ç ï¼Œè¡¨ç¤ºæ‰“å°rootèŠ‚ç‚¹</span></span><br><span class="line">  preOrder(root-&gt;left);</span><br><span class="line">  preOrder(root-&gt;right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">inOrder</span><span class="params">(Node* root)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (root == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">  inOrder(root-&gt;left);</span><br><span class="line">  print root <span class="comment">// æ­¤å¤„ä¸ºä¼ªä»£ç ï¼Œè¡¨ç¤ºæ‰“å°rootèŠ‚ç‚¹</span></span><br><span class="line">  inOrder(root-&gt;right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">postOrder</span><span class="params">(Node* root)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (root == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">  postOrder(root-&gt;left);</span><br><span class="line">  postOrder(root-&gt;right);</span><br><span class="line">  print root <span class="comment">// æ­¤å¤„ä¸ºä¼ªä»£ç ï¼Œè¡¨ç¤ºæ‰“å°rootèŠ‚ç‚¹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äºŒå‰æ ‘çš„å‰ã€ä¸­ã€ååºéå†çš„é€’å½’å®ç°æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿä½ çŸ¥é“äºŒå‰æ ‘éå†çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘å—ï¼Ÿæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹ã€‚</p><p>ä»æˆ‘å‰é¢ç”»çš„å‰ã€ä¸­ã€ååºéå†çš„é¡ºåºå›¾ï¼Œå¯ä»¥çœ‹å‡ºæ¥ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ€å¤šä¼šè¢«è®¿é—®ä¸¤æ¬¡ï¼Œæ‰€ä»¥éå†æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ï¼Œè·ŸèŠ‚ç‚¹çš„ä¸ªæ•° n æˆæ­£æ¯”ï¼Œä¹Ÿå°±æ˜¯è¯´äºŒå‰æ ‘éå†çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚</p><h2 id="è¯¾åæ€è€ƒ"><a href="#è¯¾åæ€è€ƒ" class="headerlink" title="è¯¾åæ€è€ƒ"></a>è¯¾åæ€è€ƒ</h2><ol><li><p>ç»™å®šä¸€ç»„æ•°æ®ï¼Œæ¯”å¦‚ 1ï¼Œ3ï¼Œ5ï¼Œ6ï¼Œ9ï¼Œ10ã€‚ä½ æ¥ç®—ç®—ï¼Œå¯ä»¥æ„å»ºå‡ºå¤šå°‘ç§ä¸åŒçš„äºŒå‰æ ‘ï¼Ÿ</p><blockquote><p>æ˜¯å¡ç‰¹å…°æ•°ï¼Œæ˜¯C[n,2n] &#x2F; (n+1)ç§å½¢çŠ¶ï¼Œcæ˜¯ç»„åˆæ•°ï¼ŒèŠ‚ç‚¹çš„ä¸åŒåˆæ˜¯ä¸€ä¸ªå…¨æ’åˆ—ï¼Œä¸€å…±å°±æ˜¯n!*C[n,2n] &#x2F; (n+1)ä¸ªäºŒå‰æ ‘ã€‚å¯ä»¥é€šè¿‡æ•°å­¦å½’çº³æ³•æ¨å¯¼å¾—å‡ºã€‚</p></blockquote></li><li><p>æˆ‘ä»¬è®²äº†ä¸‰ç§äºŒå‰æ ‘çš„éå†æ–¹å¼ï¼Œå‰ã€ä¸­ã€ååºã€‚å®é™…ä¸Šï¼Œè¿˜æœ‰å¦å¤–ä¸€ç§éå†æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯æŒ‰å±‚éå†ï¼Œä½ çŸ¥é“å¦‚ä½•å®ç°å—ï¼Ÿ(é˜Ÿåˆ—)</p></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>24è®² | äºŒå‰æ ‘åŸºç¡€ï¼ˆä¸‹ï¼‰</title>
      <link href="/posts/70f96e94.html"/>
      <url>/posts/70f96e94.html</url>
      
        <content type="html"><![CDATA[<hr><h1 id="24-äºŒå‰æ ‘åŸºç¡€ï¼ˆä¸‹ï¼‰ï¼šæœ‰äº†å¦‚æ­¤é«˜æ•ˆçš„æ•£åˆ—è¡¨ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦äºŒå‰æ ‘ï¼Ÿ"><a href="#24-äºŒå‰æ ‘åŸºç¡€ï¼ˆä¸‹ï¼‰ï¼šæœ‰äº†å¦‚æ­¤é«˜æ•ˆçš„æ•£åˆ—è¡¨ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦äºŒå‰æ ‘ï¼Ÿ" class="headerlink" title="24 | äºŒå‰æ ‘åŸºç¡€ï¼ˆä¸‹ï¼‰ï¼šæœ‰äº†å¦‚æ­¤é«˜æ•ˆçš„æ•£åˆ—è¡¨ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦äºŒå‰æ ‘ï¼Ÿ"></a>24 | äºŒå‰æ ‘åŸºç¡€ï¼ˆä¸‹ï¼‰ï¼šæœ‰äº†å¦‚æ­¤é«˜æ•ˆçš„æ•£åˆ—è¡¨ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦äºŒå‰æ ‘ï¼Ÿ</h1><h2 id="äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBinary-Search-Treeï¼‰"><a href="#äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBinary-Search-Treeï¼‰" class="headerlink" title="äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBinary Search Treeï¼‰"></a>äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBinary Search Treeï¼‰</h2><p>äºŒå‰æŸ¥æ‰¾æ ‘æ˜¯äºŒå‰æ ‘ä¸­æœ€å¸¸ç”¨çš„ä¸€ç§ç±»å‹ï¼Œä¹Ÿå«äºŒå‰æœç´¢æ ‘ã€‚é¡¾åæ€ä¹‰ï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘æ˜¯ä¸ºäº†å®ç°å¿«é€ŸæŸ¥æ‰¾è€Œç”Ÿçš„ã€‚ä¸è¿‡ï¼Œå®ƒä¸ä»…ä»…æ”¯æŒå¿«é€ŸæŸ¥æ‰¾ä¸€ä¸ªæ•°æ®ï¼Œè¿˜æ”¯æŒå¿«é€Ÿæ’å…¥ã€åˆ é™¤ä¸€ä¸ªæ•°æ®ã€‚å®ƒæ˜¯æ€ä¹ˆåšåˆ°è¿™äº›çš„å‘¢ï¼Ÿ</p><p>è¿™äº›éƒ½ä¾èµ–äºäºŒå‰æŸ¥æ‰¾æ ‘çš„ç‰¹æ®Šç»“æ„<strong>ã€‚äºŒå‰æŸ¥æ‰¾æ ‘è¦æ±‚ï¼Œåœ¨æ ‘ä¸­çš„ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå…¶å·¦å­æ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹çš„å€¼ï¼Œéƒ½è¦å°äºè¿™ä¸ªèŠ‚ç‚¹çš„å€¼ï¼Œè€Œå³å­æ ‘èŠ‚ç‚¹çš„å€¼éƒ½å¤§äºè¿™ä¸ªèŠ‚ç‚¹çš„å€¼ã€‚</strong> æˆ‘ç”»äº†å‡ ä¸ªäºŒå‰æŸ¥æ‰¾æ ‘çš„ä¾‹å­ï¼Œä½ ä¸€çœ‹åº”è¯¥å°±æ¸…æ¥šäº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210516134604.jpeg" alt="img"></p><p>å‰é¢æˆ‘ä»¬è®²åˆ°ï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘æ”¯æŒå¿«é€ŸæŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤æ“ä½œï¼Œç°åœ¨æˆ‘ä»¬å°±ä¾æ¬¡æ¥çœ‹ä¸‹ï¼Œè¿™ä¸‰ä¸ªæ“ä½œæ˜¯å¦‚ä½•å®ç°çš„ã€‚</p><h3 id="1-äºŒå‰æŸ¥æ‰¾æ ‘çš„æŸ¥æ‰¾æ“ä½œ"><a href="#1-äºŒå‰æŸ¥æ‰¾æ ‘çš„æŸ¥æ‰¾æ“ä½œ" class="headerlink" title="1. äºŒå‰æŸ¥æ‰¾æ ‘çš„æŸ¥æ‰¾æ“ä½œ"></a>1. äºŒå‰æŸ¥æ‰¾æ ‘çš„æŸ¥æ‰¾æ“ä½œ</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹å¦‚ä½•åœ¨äºŒå‰æŸ¥æ‰¾æ ‘ä¸­æŸ¥æ‰¾ä¸€ä¸ªèŠ‚ç‚¹ã€‚æˆ‘ä»¬å…ˆå–æ ¹èŠ‚ç‚¹ï¼Œå¦‚æœå®ƒç­‰äºæˆ‘ä»¬è¦æŸ¥æ‰¾çš„æ•°æ®ï¼Œé‚£å°±è¿”å›ã€‚å¦‚æœè¦æŸ¥æ‰¾çš„æ•°æ®æ¯”æ ¹èŠ‚ç‚¹çš„å€¼å°ï¼Œé‚£å°±åœ¨å·¦å­æ ‘ä¸­é€’å½’æŸ¥æ‰¾ï¼›å¦‚æœè¦æŸ¥æ‰¾çš„æ•°æ®æ¯”æ ¹èŠ‚ç‚¹çš„å€¼å¤§ï¼Œé‚£å°±åœ¨å³å­æ ‘ä¸­é€’å½’æŸ¥æ‰¾ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210516134630.jpeg" alt="img"></p><p>è¿™é‡Œæˆ‘æŠŠæŸ¥æ‰¾çš„ä»£ç å®ç°äº†ä¸€ä¸‹ï¼Œè´´åœ¨ä¸‹é¢äº†ï¼Œç»“åˆä»£ç ï¼Œç†è§£èµ·æ¥ä¼šæ›´åŠ å®¹æ˜“ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BinarySearchTree</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> Node tree;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> Node <span class="title function_">find</span><span class="params">(<span class="type">int</span> data)</span> &#123;</span><br><span class="line">    <span class="type">Node</span> <span class="variable">p</span> <span class="operator">=</span> tree;</span><br><span class="line">    <span class="keyword">while</span> (p != <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (data &lt; p.data) p = p.left;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (data &gt; p.data) p = p.right;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> data;</span><br><span class="line">    <span class="keyword">private</span> Node left;</span><br><span class="line">    <span class="keyword">private</span> Node right;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(<span class="type">int</span> data)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-äºŒå‰æŸ¥æ‰¾æ ‘çš„æ’å…¥æ“ä½œ"><a href="#2-äºŒå‰æŸ¥æ‰¾æ ‘çš„æ’å…¥æ“ä½œ" class="headerlink" title="2. äºŒå‰æŸ¥æ‰¾æ ‘çš„æ’å…¥æ“ä½œ"></a>2. äºŒå‰æŸ¥æ‰¾æ ‘çš„æ’å…¥æ“ä½œ</h3><p>äºŒå‰æŸ¥æ‰¾æ ‘çš„æ’å…¥è¿‡ç¨‹æœ‰ç‚¹ç±»ä¼¼æŸ¥æ‰¾æ“ä½œã€‚æ–°æ’å…¥çš„æ•°æ®ä¸€èˆ¬éƒ½æ˜¯åœ¨å¶å­èŠ‚ç‚¹ä¸Šï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œä¾æ¬¡æ¯”è¾ƒè¦æ’å…¥çš„æ•°æ®å’ŒèŠ‚ç‚¹çš„å¤§å°å…³ç³»ã€‚</p><p>å¦‚æœè¦æ’å…¥çš„æ•°æ®æ¯”èŠ‚ç‚¹çš„æ•°æ®å¤§ï¼Œå¹¶ä¸”èŠ‚ç‚¹çš„å³å­æ ‘ä¸ºç©ºï¼Œå°±å°†æ–°æ•°æ®ç›´æ¥æ’åˆ°å³å­èŠ‚ç‚¹çš„ä½ç½®ï¼›å¦‚æœä¸ä¸ºç©ºï¼Œå°±å†é€’å½’éå†å³å­æ ‘ï¼ŒæŸ¥æ‰¾æ’å…¥ä½ç½®ã€‚åŒç†ï¼Œå¦‚æœè¦æ’å…¥çš„æ•°æ®æ¯”èŠ‚ç‚¹æ•°å€¼å°ï¼Œå¹¶ä¸”èŠ‚ç‚¹çš„å·¦å­æ ‘ä¸ºç©ºï¼Œå°±å°†æ–°æ•°æ®æ’å…¥åˆ°å·¦å­èŠ‚ç‚¹çš„ä½ç½®ï¼›å¦‚æœä¸ä¸ºç©ºï¼Œå°±å†é€’å½’éå†å·¦å­æ ‘ï¼ŒæŸ¥æ‰¾æ’å…¥ä½ç½®ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210516134908.jpeg" alt="img"></p><p>åŒæ ·ï¼Œæ’å…¥çš„ä»£ç æˆ‘ä¹Ÿå®ç°äº†ä¸€ä¸‹ï¼Œè´´åœ¨ä¸‹é¢ï¼Œä½ å¯ä»¥çœ‹çœ‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(<span class="type">int</span> data)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (tree == <span class="literal">null</span>) &#123;</span><br><span class="line">    tree = <span class="keyword">new</span> <span class="title class_">Node</span>(data);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="type">Node</span> <span class="variable">p</span> <span class="operator">=</span> tree;</span><br><span class="line">  <span class="keyword">while</span> (p != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (data &gt; p.data) &#123;</span><br><span class="line">      <span class="keyword">if</span> (p.right == <span class="literal">null</span>) &#123;</span><br><span class="line">        p.right = <span class="keyword">new</span> <span class="title class_">Node</span>(data);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      p = p.right;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">// data &lt; p.data</span></span><br><span class="line">      <span class="keyword">if</span> (p.left == <span class="literal">null</span>) &#123;</span><br><span class="line">        p.left = <span class="keyword">new</span> <span class="title class_">Node</span>(data);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      p = p.left;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-äºŒå‰æŸ¥æ‰¾æ ‘çš„åˆ é™¤æ“ä½œ"><a href="#3-äºŒå‰æŸ¥æ‰¾æ ‘çš„åˆ é™¤æ“ä½œ" class="headerlink" title="3. äºŒå‰æŸ¥æ‰¾æ ‘çš„åˆ é™¤æ“ä½œ"></a>3. äºŒå‰æŸ¥æ‰¾æ ‘çš„åˆ é™¤æ“ä½œ</h3><p>äºŒå‰æŸ¥æ‰¾æ ‘çš„æŸ¥æ‰¾ã€æ’å…¥æ“ä½œéƒ½æ¯”è¾ƒç®€å•æ˜“æ‡‚ï¼Œä½†æ˜¯å®ƒçš„åˆ é™¤æ“ä½œå°±æ¯”è¾ƒå¤æ‚äº† ã€‚é’ˆå¯¹è¦åˆ é™¤èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸ªæ•°çš„ä¸åŒï¼Œæˆ‘ä»¬éœ€è¦åˆ†ä¸‰ç§æƒ…å†µæ¥å¤„ç†ã€‚</p><p>ç¬¬ä¸€ç§æƒ…å†µæ˜¯ï¼Œå¦‚æœè¦åˆ é™¤çš„èŠ‚ç‚¹æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œæˆ‘ä»¬åªéœ€è¦ç›´æ¥å°†çˆ¶èŠ‚ç‚¹ä¸­ï¼ŒæŒ‡å‘è¦åˆ é™¤èŠ‚ç‚¹çš„æŒ‡é’ˆç½®ä¸º nullã€‚æ¯”å¦‚å›¾ä¸­çš„åˆ é™¤èŠ‚ç‚¹ 55ã€‚</p><p>ç¬¬äºŒç§æƒ…å†µæ˜¯ï¼Œå¦‚æœè¦åˆ é™¤çš„èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹ï¼ˆåªæœ‰å·¦å­èŠ‚ç‚¹æˆ–è€…å³å­èŠ‚ç‚¹ï¼‰ï¼Œæˆ‘ä»¬åªéœ€è¦æ›´æ–°çˆ¶èŠ‚ç‚¹ä¸­ï¼ŒæŒ‡å‘è¦åˆ é™¤èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œè®©å®ƒæŒ‡å‘è¦åˆ é™¤èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å°±å¯ä»¥äº†ã€‚æ¯”å¦‚å›¾ä¸­çš„åˆ é™¤èŠ‚ç‚¹ 13ã€‚</p><p>ç¬¬ä¸‰ç§æƒ…å†µæ˜¯ï¼Œå¦‚æœè¦åˆ é™¤çš„èŠ‚ç‚¹æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œè¿™å°±æ¯”è¾ƒå¤æ‚äº†ã€‚æˆ‘ä»¬éœ€è¦æ‰¾åˆ°è¿™ä¸ªèŠ‚ç‚¹çš„å³å­æ ‘ä¸­çš„æœ€å°èŠ‚ç‚¹ï¼ŒæŠŠå®ƒæ›¿æ¢åˆ°è¦åˆ é™¤çš„èŠ‚ç‚¹ä¸Šã€‚ç„¶åå†åˆ é™¤æ‰è¿™ä¸ªæœ€å°èŠ‚ç‚¹ï¼Œå› ä¸ºæœ€å°èŠ‚ç‚¹è‚¯å®šæ²¡æœ‰å·¦å­èŠ‚ç‚¹ï¼ˆå¦‚æœæœ‰å·¦å­ç»“ç‚¹ï¼Œé‚£å°±ä¸æ˜¯æœ€å°èŠ‚ç‚¹äº†ï¼‰ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥åº”ç”¨ä¸Šé¢ä¸¤æ¡è§„åˆ™æ¥åˆ é™¤è¿™ä¸ªæœ€å°èŠ‚ç‚¹ã€‚æ¯”å¦‚å›¾ä¸­çš„åˆ é™¤èŠ‚ç‚¹ 18ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210516135051.jpeg" alt="img"></p><p>è€è§„çŸ©ï¼Œæˆ‘è¿˜æ˜¯æŠŠåˆ é™¤çš„ä»£ç è´´åœ¨è¿™é‡Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(<span class="type">int</span> data)</span> &#123;</span><br><span class="line">  <span class="type">Node</span> <span class="variable">p</span> <span class="operator">=</span> tree; <span class="comment">// pæŒ‡å‘è¦åˆ é™¤çš„èŠ‚ç‚¹ï¼Œåˆå§‹åŒ–æŒ‡å‘æ ¹èŠ‚ç‚¹</span></span><br><span class="line">  <span class="type">Node</span> <span class="variable">pp</span> <span class="operator">=</span> <span class="literal">null</span>; <span class="comment">// ppè®°å½•çš„æ˜¯pçš„çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">while</span> (p != <span class="literal">null</span> &amp;&amp; p.data != data) &#123;</span><br><span class="line">    pp = p;</span><br><span class="line">    <span class="keyword">if</span> (data &gt; p.data) p = p.right;</span><br><span class="line">    <span class="keyword">else</span> p = p.left;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (p == <span class="literal">null</span>) <span class="keyword">return</span>; <span class="comment">// æ²¡æœ‰æ‰¾åˆ°</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¦åˆ é™¤çš„èŠ‚ç‚¹æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">if</span> (p.left != <span class="literal">null</span> &amp;&amp; p.right != <span class="literal">null</span>) &#123; <span class="comment">// æŸ¥æ‰¾å³å­æ ‘ä¸­æœ€å°èŠ‚ç‚¹</span></span><br><span class="line">    <span class="type">Node</span> <span class="variable">minP</span> <span class="operator">=</span> p.right;</span><br><span class="line">    <span class="type">Node</span> <span class="variable">minPP</span> <span class="operator">=</span> p; <span class="comment">// minPPè¡¨ç¤ºminPçš„çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">while</span> (minP.left != <span class="literal">null</span>) &#123;</span><br><span class="line">      minPP = minP;</span><br><span class="line">      minP = minP.left;</span><br><span class="line">    &#125;</span><br><span class="line">    p.data = minP.data; <span class="comment">// å°†minPçš„æ•°æ®æ›¿æ¢åˆ°pä¸­</span></span><br><span class="line">    p = minP; <span class="comment">// ä¸‹é¢å°±å˜æˆäº†åˆ é™¤minPäº†</span></span><br><span class="line">    pp = minPP;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ é™¤èŠ‚ç‚¹æ˜¯å¶å­èŠ‚ç‚¹æˆ–è€…ä»…æœ‰ä¸€ä¸ªå­èŠ‚ç‚¹</span></span><br><span class="line">  Node child; <span class="comment">// pçš„å­èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">if</span> (p.left != <span class="literal">null</span>) child = p.left;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (p.right != <span class="literal">null</span>) child = p.right;</span><br><span class="line">  <span class="keyword">else</span> child = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (pp == <span class="literal">null</span>) tree = child; <span class="comment">// åˆ é™¤çš„æ˜¯æ ¹èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (pp.left == p) pp.left = child;</span><br><span class="line">  <span class="keyword">else</span> pp.right = child;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šï¼Œå…³äºäºŒå‰æŸ¥æ‰¾æ ‘çš„åˆ é™¤æ“ä½œï¼Œè¿˜æœ‰ä¸ªéå¸¸ç®€å•ã€å–å·§çš„æ–¹æ³•ï¼Œå°±æ˜¯å•çº¯å°†è¦åˆ é™¤çš„èŠ‚ç‚¹æ ‡è®°ä¸ºâ€œå·²åˆ é™¤â€ï¼Œä½†æ˜¯å¹¶ä¸çœŸæ­£ä»æ ‘ä¸­å°†è¿™ä¸ªèŠ‚ç‚¹å»æ‰ã€‚è¿™æ ·åŸæœ¬åˆ é™¤çš„èŠ‚ç‚¹è¿˜éœ€è¦å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæ¯”è¾ƒæµªè´¹å†…å­˜ç©ºé—´ï¼Œä½†æ˜¯åˆ é™¤æ“ä½œå°±å˜å¾—ç®€å•äº†å¾ˆå¤šã€‚è€Œä¸”ï¼Œè¿™ç§å¤„ç†æ–¹æ³•ä¹Ÿå¹¶æ²¡æœ‰å¢åŠ æ’å…¥ã€æŸ¥æ‰¾æ“ä½œä»£ç å®ç°çš„éš¾åº¦ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title> 2021é¢ç»ç¬¬äºŒæ³¢</title>
      <link href="/posts/90dd64e0.html"/>
      <url>/posts/90dd64e0.html</url>
      
        <content type="html"><![CDATA[<hr><h3 id="æ¶‚é¸¦æ™ºèƒ½"><a href="#æ¶‚é¸¦æ™ºèƒ½" class="headerlink" title="æ¶‚é¸¦æ™ºèƒ½"></a>æ¶‚é¸¦æ™ºèƒ½</h3><ul><li>redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«</li><li>redisä¸ºä»€ä¹ˆæ˜¯å•çº¿ç¨‹</li><li>3000ä¸‡æ•°æ®çš„è¡¨ï¼Œå¦‚ä½•è¿›è¡Œä¼˜åŒ–</li><li>åˆ†åº“åˆ†è¡¨ã€å¤šç»´åº¦æŸ¥è¯¢</li></ul><h3 id="æ»´æ»´"><a href="#æ»´æ»´" class="headerlink" title="æ»´æ»´"></a>æ»´æ»´</h3><ul><li><p><a href="https://leetcode-cn.com/problems/swap-nodes-in-pairs/">24. ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹</a></p></li><li><p>å †å¤–å†…å­˜</p></li><li><p>ç±»åŠ è½½æœºåˆ¶</p></li><li><p>åŒäº²å§”æ´¾æœºåˆ¶ï¼Œå¦‚ä½•æ‰“ç ´</p></li><li><p>ä¸åŒçš„ç±»åŠ è½½å™¨åŠ è½½çš„ç±»æ˜¯ä¸æ˜¯åŒä¸€ä¸ªç±»</p><blockquote><p><a href="https://cloud.tencent.com/developer/news/627029">https://cloud.tencent.com/developer/news/627029</a></p><p>ä¸åŒç±»åŠ è½½å™¨åŠ è½½çš„ç±»åœ¨ JVM çœ‹æ¥æ˜¯ä¸¤ä¸ªä¸åŒçš„ç±»ï¼Œå› ä¸ºåœ¨ JVM ä¸­ä¸€ä¸ªç±»çš„å”¯ä¸€æ ‡è¯†æ˜¯ç±»åŠ è½½å™¨+ç±»åã€‚é€šè¿‡è¿™ç§æ–¹å¼æˆ‘ä»¬å°±èƒ½å¤ŸåŒæ—¶åŠ è½½ C çš„ä¸¤ä¸ªä¸åŒç‰ˆæœ¬çš„ç±»ï¼Œå³ä½¿å®ƒç±»åæ˜¯ä¸€æ ·çš„ã€‚æ³¨æ„ï¼Œè¿™é‡Œç±»åŠ è½½å™¨æŒ‡çš„æ˜¯ç±»åŠ è½½å™¨çš„å®ä¾‹ï¼Œå¹¶ä¸æ˜¯ä¸€å®šè¦å®šä¹‰ä¸¤ä¸ªä¸åŒç±»åŠ è½½å™¨</p></blockquote></li><li><p>çº¿ç¨‹æ± åŸç†ä»¥åŠä½¿ç”¨åœºæ™¯</p></li><li><p>synchronizedå’ŒReentrantLockçš„åŒºåˆ«ï¼ˆæ˜¯å¦æ˜¯é‡å…¥é”ï¼‰</p></li><li><p>ReentrantLockéå…¬å¹³é”å’Œå…¬å¹³é”å¦‚ä½•åšåˆ°çš„</p></li><li><p>synchronizedé”å‡çº§åŸç†</p></li><li><p>redisåˆ†å¸ƒå¼é”å¦‚ä½•ä½¿ç”¨</p></li><li><p>ä¸šåŠ¡æ²¡æ‰§è¡Œå®Œï¼Œåˆ†å¸ƒå¼é”è¿‡æœŸé‡Šæ”¾ï¼Œå¦‚ä½•è§£å†³</p></li><li><p>springcloudå’Œdubboçš„åŒºåˆ«</p></li><li><p>rpcåè®®å’Œhttpåè®®çš„åŒºåˆ«</p></li><li><p>httpsçš„åŸç†</p></li><li><p>åºåˆ—åŒ–æ–¹å¼æœ‰å“ªå‡ ç§ï¼Œdubboé»˜è®¤æ˜¯å“ªç§</p></li><li><p>mysqlæŸ¥è¯¢ä¼˜åŒ–</p></li><li><p>mysqlä¸ºä»€ä¹ˆç”¨b+æ ‘</p></li></ul><h3 id="å¿«æ‰‹"><a href="#å¿«æ‰‹" class="headerlink" title="å¿«æ‰‹"></a>å¿«æ‰‹</h3><ul><li><a href="https://leetcode-cn.com/problems/merge-k-sorted-lists/">23. åˆå¹¶Kä¸ªå‡åºé“¾è¡¨</a></li><li>HashMapåœ¨jdk1.7æ‰©å®¹è¿‡ç¨‹</li><li>HashMapä»€ä¹ˆæƒ…å†µä¸‹ä¼šé“¾è¡¨æˆç¯</li><li>HashMapä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨</li><li>åå°„åŸç†ä»¥åŠä½¿ç”¨åœºæ™¯</li><li>åˆ›å»ºå¯¹è±¡çš„å‡ ç§å½¢å¼</li><li>èšåˆæ ¹ã€å®ä½“åœ¨ä¸šåŠ¡ä¸­çš„åº”ç”¨</li><li>redisé›†ç¾¤ã€é«˜å¯ç”¨ã€æŒä¹…åŒ–</li><li>æœ¬åœ°äº‹åŠ¡è¡¨å¦‚æœTPSå¤ªé«˜ï¼Œå¦‚ä½•ä¼˜åŒ–</li></ul><h3 id="é…·å®¶ä¹"><a href="#é…·å®¶ä¹" class="headerlink" title="é…·å®¶ä¹"></a>é…·å®¶ä¹</h3><ul><li>æœ€é•¿å›æ–‡å­ä¸²</li><li>å¸¦<code>+ - * /ï¼ˆï¼‰</code>çš„åŸºæœ¬è®¡ç®—å™¨</li><li>binlogå­˜å‚¨å½¢å¼ï¼ˆrowå’Œstatementï¼‰</li><li>mvccå…·ä½“æ˜¯å¦‚ä½•è§£å†³å¹»è¯»çš„ï¼Ÿ</li><li>ç±»åŠ è½½è¿‡ç¨‹</li></ul><h3 id="å“ˆç½—å•è½¦"><a href="#å“ˆç½—å•è½¦" class="headerlink" title="å“ˆç½—å•è½¦"></a>å“ˆç½—å•è½¦</h3><ul><li><p>ä¸¤ä¸ªä¸åŒç‰ˆæœ¬çš„ç±»ï¼Œå¦‚æœæˆ‘éƒ½æƒ³å»åŠ è½½ï¼Ÿå¦‚ä½•å»åšï¼ˆè‡ªå®šä¹‰ä¸¤ä¸ªç±»åŠ è½½å™¨å»åŠ è½½ï¼‰</p></li><li><p>MySQLä¸ºä»€ä¹ˆä¸ç”¨å¹³è¡¡æ ‘ï¼Ÿ</p><blockquote><p>å› ä¸ºæ•°æ®æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„ï¼Œè¿›è¡ŒæŸ¥è¯¢æ“ä½œçš„æ—¶ï¼Œéœ€è¦å…ˆå°†æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼ˆç£ç›˜IOæ“ä½œï¼‰ã€‚è€Œæ•°æ®å¹¶ä¸èƒ½ä¸€æ¬¡æ€§å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œåªèƒ½é€ä¸€åŠ è½½æ¯ä¸ªç£ç›˜é¡µï¼ˆå¯¹åº”æ ‘çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼‰ï¼Œå¹¶ä¸”ç£ç›˜IOæ“ä½œå¾ˆæ…¢ï¼Œå¹³è¡¡äºŒå‰æ ‘ç”±äºæ·±åº¦è¿‡å¤§è€Œé€ æˆç£ç›˜IOè¯»å†™è¿‡äºé¢‘ç¹ï¼Œè¿›è€Œå¯¼è‡´æ•ˆç‡ä½ä¸‹ã€‚ä¸ºäº†å‡å°‘ç£ç›˜çš„IOæ¬¡æ•°ï¼Œå°±éœ€è¦é™ä½æ ‘çš„æ·±åº¦ï¼Œé‚£ä¹ˆå°±å¼•å‡ºäº†Bæ ‘å’ŒB+æ ‘ï¼šæ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨å¤šä¸ªå…ƒç´ ï¼Œé‡‡ç”¨å¤šå‰æ ‘ç»“æ„ã€‚æ‰€ä»¥ä½¿ç”¨B+æ ‘è€Œä¸æ˜¯å¹³è¡¡äºŒå‰æ ‘ã€‚</p><p>Bæ ‘çš„æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥å­˜å‚¨å¤šä¸ªå…³é”®å­—ï¼Œå®ƒå°†èŠ‚ç‚¹å¤§å°è®¾ç½®ä¸ºç£ç›˜é¡µçš„å¤§å°ï¼Œå……åˆ†åˆ©ç”¨äº†ç£ç›˜é¢„è¯»çš„åŠŸèƒ½ã€‚æ¯æ¬¡è¯»å–ç£ç›˜é¡µæ—¶å°±ä¼šè¯»å–ä¸€æ•´ä¸ªèŠ‚ç‚¹ã€‚ä¹Ÿæ­£å› æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨ç€éå¸¸å¤šä¸ªå…³é”®å­—ï¼Œæ ‘çš„æ·±åº¦å°±ä¼šéå¸¸çš„å°ã€‚è¿›è€Œè¦æ‰§è¡Œçš„ç£ç›˜è¯»å–æ“ä½œæ¬¡æ•°å°±ä¼šéå¸¸å°‘ï¼Œæ›´å¤šçš„æ˜¯åœ¨å†…å­˜ä¸­å¯¹è¯»å–è¿›æ¥çš„æ•°æ®è¿›è¡ŒæŸ¥æ‰¾ã€‚</p><p>æ€»ç»“ï¼šå¹³è¡¡æ ‘æ²¡èƒ½å……åˆ†åˆ©ç”¨ç£ç›˜é¢„è¯»ï¼ˆå±€éƒ¨æ€§åŸç†ï¼‰åŠŸèƒ½ï¼Œè€ŒB+æ ‘æ¯ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸ªç£ç›˜é¡µï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒ…å«å¤šä¸ªkeyï¼Œæ¯æ¬¡åŠ è½½èƒ½æŠŠä¸€é¡µæ•°æ®å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ï¼Œæé«˜äº†ç¼“å­˜å‘½ä¸­ç‡ã€‚</p></blockquote></li><li><p>MySQLä¸ºä»€ä¹ˆä½¿ç”¨B+æ ‘ç´¢å¼•è€Œä¸æ˜¯Bæ ‘ç´¢å¼•ï¼Ÿ</p><blockquote><ol><li>B+æ ‘å¶å­èŠ‚ç‚¹ä½¿ç”¨åŒå‘é“¾è¡¨è¿æ¥ï¼ŒèŒƒå›´æŸ¥è¯¢éå¸¸æ–¹ä¾¿ï¼›è€ŒBæ ‘å¿…é¡»ç”¨ä¸­åºéå†çš„æ–¹æ³•æŒ‰åºæ‰«åº“ï¼Œæ•ˆç‡ä½ä¸‹</li><li>B+æ ‘éå¶å­èŠ‚ç‚¹ä¸ä¿å­˜æ•°æ®ï¼ŒåŒæ ·çš„ç£ç›˜é¡µå¤§å°å®¹çº³çš„å…³é”®å­—æ›´å¤šï¼Œä¸€æ¬¡æ€§è¯»å…¥å†…å­˜çš„å…³é”®å­—ä¹Ÿå°±è¶Šå¤šï¼Œç›¸å¯¹æ¥è¯´è¯´IOæ¬¡æ•°å°±é™ä½äº†</li><li>B+æ ‘æŸ¥è¯¢æ•ˆç‡æ›´ç¨³å®šï¼šå› ä¸ºB+æ ‘éå¶å­èŠ‚ç‚¹ä¸ä¿å­˜æ•°æ®ï¼Œæ‰€ä»¥ä»»ä½•å…³é”®å­—çš„æŸ¥æ‰¾å¿…é¡»èµ°ä¸€æ¡ä»æ ¹ç»“ç‚¹åˆ°å¶å­ç»“ç‚¹çš„è·¯ã€‚æ‰€æœ‰å…³é”®å­—æŸ¥è¯¢çš„è·¯å¾„é•¿åº¦ç›¸åŒï¼Œå¯¼è‡´æ¯ä¸€ä¸ªæ•°æ®çš„æŸ¥è¯¢æ•ˆç‡ç›¸å½“ã€‚</li></ol></blockquote></li></ul><h3 id="ç½‘æ˜“"><a href="#ç½‘æ˜“" class="headerlink" title="ç½‘æ˜“"></a>ç½‘æ˜“</h3><ul><li><p>cmså’ŒG1åƒåœ¾å›æ”¶å™¨çš„åŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆG1é€‚åˆå¤§å†…å­˜ï¼ŒG1å¦‚ä½•åšåˆ°å¯é¢„æµ‹çš„ä½åœé¡¿çš„ï¼Ÿ</p><blockquote><p>G1æ”¶é›†å™¨ä¹‹æ‰€ä»¥èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼Œæ˜¯å› ä¸ºå®ƒå°†Regionä½œä¸ºå•æ¬¡å›æ”¶çš„æœ€å°å•å…ƒï¼Œå³æ¯æ¬¡æ”¶é›†åˆ°çš„å†…å­˜ç©ºé—´éƒ½æ˜¯Regionå¤§å°çš„æ•´æ•°å€ï¼Œè¿™æ ·å¯ä»¥æœ‰è®¡åˆ’åœ°é¿å…åœ¨æ•´ä¸ªJavaå †ä¸­è¿›è¡Œå…¨åŒºåŸŸçš„åƒåœ¾æ”¶é›†ã€‚æ›´å…·ä½“çš„å¤„ç†æ€è·¯æ˜¯è®©G1æ”¶é›†å™¨å»è·Ÿè¸ªå„ä¸ªRegioné‡Œé¢çš„åƒåœ¾å †ç§¯çš„â€œä»·å€¼â€å¤§å°ï¼Œä»·å€¼å³å›æ”¶æ‰€è·å¾—çš„ç©ºé—´å¤§å°ä»¥åŠå›æ”¶æ‰€éœ€æ—¶é—´çš„ç»éªŒå€¼ï¼Œç„¶ååœ¨åå°ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆçº§åˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®ç”¨æˆ·è®¾å®šå…è®¸çš„æ”¶é›†åœé¡¿æ—¶é—´ï¼ˆä½¿ç”¨å‚æ•° - XX:MaxGCPauseMillsæŒ‡å®šï¼Œé»˜è®¤å€¼æ˜¯200æ¯«ç§’ï¼‰ï¼Œä¼˜å…ˆå¤„ç†å›æ”¶ä»·å€¼æ”¶ç›Šæœ€å¤§çš„é‚£äº›Regionï¼Œè¿™ä¹Ÿå°±æ˜¯â€œGarbage Firstâ€åç§°çš„ç”±æ¥ã€‚è¿™ç§ä½¿ç”¨Regionåˆ’åˆ†å†…å­˜ç©ºé—´ï¼Œä»¥åŠå…·æœ‰ä¼˜å…ˆçº§çš„åŒºåŸŸå›æ”¶æ–¹å¼ï¼Œä¿è¯äº†G1æ”¶é›†å™¨åœ¨æœ‰é™çš„æ—¶é—´å†…è·å–å°½å¯èƒ½é«˜çš„æ”¶é›†æ•ˆç‡ã€‚</p></blockquote></li><li><p>è¯»å†™é”çš„å®ç°ç»†èŠ‚</p></li><li><p>volatileä¿è¯äº†ä»€ä¹ˆï¼Ÿå¦‚ä½•ä¿è¯çš„ï¼Ÿå†…å­˜å±éšœçš„æŒ‡ä»¤æœ‰å“ªäº›ï¼Ÿ</p></li><li><p>SQLæ³¨å…¥æ˜¯å•¥ï¼Œä»¥åŠå®ƒçš„åŸç†ï¼Œå¦‚ä½•é¿å…ï¼Ÿ</p></li><li><p>MySQLå¦‚ä½•è§£å†³å¹»è¯»ï¼Ÿï¼ˆé™¤äº†MVCCä¹‹å¤–è¿˜èƒ½å¦‚ä½•è§£å†³ï¼Ÿï¼‰</p></li><li><p>kafkaæ¶ˆæ¯æŠ•é€’è¯­ä¹‰ç²¾å‡†ä¸€æ¬¡æ€§ï¼ˆExactly-onceï¼‰æ˜¯å¦‚ä½•ä¿è¯çš„ï¼Ÿ</p><blockquote><p> è¿™ä¸ªç‰¹æ€§æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿåœ¨åº•å±‚ï¼Œå®ƒå’ŒTCPçš„å·¥ä½œåŸç†æœ‰ç‚¹åƒï¼Œæ¯ä¸€æ‰¹å‘é€åˆ°Kafkaçš„æ¶ˆæ¯éƒ½å°†åŒ…å«ä¸€ä¸ªåºåˆ—å·ï¼Œbrokerå°†ä½¿ç”¨è¿™ä¸ªåºåˆ—å·æ¥åˆ é™¤é‡å¤çš„å‘é€ã€‚å’Œåªèƒ½åœ¨ç¬æ€å†…å­˜ä¸­çš„è¿æ¥ä¸­ä¿è¯ä¸é‡å¤çš„TCPä¸åŒï¼Œè¿™ä¸ªåºåˆ—å·è¢«æŒä¹…åŒ–åˆ°å‰¯æœ¬æ—¥å¿—ï¼Œæ‰€ä»¥ï¼Œå³ä½¿åˆ†åŒºçš„leaderæŒ‚äº†ï¼Œå…¶ä»–çš„brokeræ¥ç®¡äº†leaderï¼Œæ–°leaderä»å¯ä»¥åˆ¤æ–­é‡æ–°å‘é€çš„æ˜¯å¦é‡å¤äº†ã€‚è¿™ç§æœºåˆ¶çš„å¼€é”€éå¸¸ä½ï¼šæ¯æ‰¹æ¶ˆæ¯åªæœ‰å‡ ä¸ªé¢å¤–çš„å­—æ®µï¼š</p><ul><li>PIDï¼Œåœ¨Produceråˆå§‹åŒ–æ—¶åˆ†é…ï¼Œä½œä¸ºæ¯ä¸ªProducerä¼šè¯çš„å”¯ä¸€æ ‡è¯†ï¼›</li><li>åºåˆ—å·ï¼ˆsequence numberï¼‰ï¼ŒProducerå‘é€çš„æ¯æ¡æ¶ˆæ¯ï¼ˆæ›´å‡†ç¡®åœ°è¯´æ˜¯æ¯ä¸€ä¸ªæ¶ˆæ¯æ‰¹æ¬¡ï¼Œå³ProducerBatchï¼‰éƒ½ä¼šå¸¦æœ‰æ­¤åºåˆ—å·ï¼Œä»0å¼€å§‹å•è°ƒé€’å¢ã€‚Brokeræ ¹æ®å®ƒæ¥åˆ¤æ–­å†™å…¥çš„æ¶ˆæ¯æ˜¯å¦å¯æ¥å—ã€‚</li></ul></blockquote></li></ul><h3 id="ç¾å›¢"><a href="#ç¾å›¢" class="headerlink" title="ç¾å›¢"></a>ç¾å›¢</h3><ul><li><a href="https://leetcode-cn.com/problems/sort-list/">148. æ’åºé“¾è¡¨</a></li><li>JVMå†…å­˜åŒºåŸŸ</li><li>CMSåƒåœ¾å›æ”¶å™¨</li><li>åƒåœ¾å›æ”¶ç®—æ³•</li><li>ç±»åŠ è½½è¿‡ç¨‹</li><li>çº¿ç¨‹æ± åŸç†ï¼Œä½¿ç”¨åœºæ™¯ï¼Œå‚æ•°å¦‚ä½•é…ç½®ï¼Œå¦‚ä½•é¢„åˆ›å»ºçº¿ç¨‹</li><li>Spring AOPåŸç†</li><li>redisä½¿ç”¨åœºæ™¯</li><li>rediså•çº¿ç¨‹ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«</li><li>redisä¸ºä»€ä¹ˆèƒ½æ”¯æ’‘10ä¸‡QPS</li></ul><h3 id="é˜¿é‡Œ"><a href="#é˜¿é‡Œ" class="headerlink" title="é˜¿é‡Œ"></a>é˜¿é‡Œ</h3><ul><li><p>å¸ƒéš†è¿‡æ»¤å™¨å¦‚ä½•é™ä½è¯¯åˆ¤ç‡</p><blockquote><p>å¢åŠ hashå‡½æ•°ä¸ªæ•°æˆ–è€…å¢å¤§ä½æ•°ç»„å®¹é‡</p></blockquote></li><li><p>jdk8ä¸ºä»€ä¹ˆè¦å–æ¶ˆæ–¹æ³•åŒºï¼Œè®¾ç«‹å…ƒç©ºé—´</p></li><li><p>å…ƒç©ºé—´å‚æ•°å¦‚ä½•é…ç½®</p><blockquote><p><strong>-XX:MetaspaceSize</strong>ï¼šMetaspace ç©ºé—´åˆå§‹å¤§å°ï¼Œå¦‚æœä¸è®¾ç½®çš„è¯ï¼Œé»˜è®¤æ˜¯20.79Mï¼Œè¿™ä¸ªåˆå§‹å¤§å°æ˜¯è§¦å‘é¦–æ¬¡ Metaspace Full GC çš„é˜ˆå€¼ï¼Œä¾‹å¦‚ -XX:MetaspaceSize&#x3D;256M</p><p><strong>-XX:MaxMetaspaceSize</strong>ï¼šMetaspace æœ€å¤§å€¼ï¼Œé»˜è®¤ä¸é™åˆ¶å¤§å°ï¼Œä½†æ˜¯çº¿ä¸Šç¯å¢ƒå»ºè®®è®¾ç½®ï¼Œä¾‹å¦‚</p><p>-XX:MaxMetaspaceSize&#x3D;256M</p><p><strong>-XX:MinMetaspaceFreeRatio</strong>ï¼šæœ€å°ç©ºé—²æ¯”ï¼Œå½“ Metaspace å‘ç”Ÿ GC åï¼Œä¼šè®¡ç®— Metaspace çš„ç©ºé—²æ¯”ï¼Œå¦‚æœç©ºé—²æ¯”(ç©ºé—²ç©ºé—´&#x2F;å½“å‰ Metaspace å¤§å°)å°äºæ­¤å€¼ï¼Œå°±ä¼šè§¦å‘ Metaspace æ‰©å®¹ã€‚é»˜è®¤å€¼æ˜¯ 40 ï¼Œä¹Ÿå°±æ˜¯ 40%ï¼Œä¾‹å¦‚ -XX:MinMetaspaceFreeRatio&#x3D;40</p><p><strong>-XX:MaxMetaspaceFreeRatio</strong>:æœ€å¤§ç©ºé—²æ¯”ï¼Œå½“ Metaspace å‘ç”Ÿ GC åï¼Œä¼šè®¡ç®— Metaspace çš„ç©ºé—²æ¯”ï¼Œå¦‚æœç©ºé—²æ¯”(ç©ºé—²ç©ºé—´&#x2F;å½“å‰ Metaspace å¤§å°)å¤§äºæ­¤å€¼ï¼Œå°±ä¼šè§¦å‘ Metaspace é‡Šæ”¾ç©ºé—´ã€‚é»˜è®¤å€¼æ˜¯ 70 ï¼Œä¹Ÿå°±æ˜¯ 70%ï¼Œä¾‹å¦‚ -XX:MaxMetaspaceFreeRatio&#x3D;70</p><ul><li>å»ºè®®å°† MetaspaceSize å’Œ MaxMetaspaceSize è®¾ç½®ä¸ºåŒæ ·å¤§å°ï¼Œé¿å…é¢‘ç¹æ‰©å®¹ã€‚</li></ul></blockquote></li><li><p>å¦‚ä½•å‡å°‘å›è¡¨</p></li><li><p>oomå¦‚ä½•æ’æŸ¥</p><blockquote><p><a href="https://www.cnblogs.com/lujiango/p/9650927.html">https://www.cnblogs.com/lujiango/p/9650927.html</a></p><p>1.<strong>ç¡®è®¤æ˜¯ä¸æ˜¯å†…å­˜æœ¬èº«å°±åˆ†é…è¿‡å°</strong></p><p><code>jmap -heap pid</code></p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210610232554.png" alt="img"></p><p>å¦‚å›¾ï¼Œå¯ä»¥æŸ¥çœ‹æ–°ç”Ÿä»£ï¼Œè€å¹´ä»£å †å†…å­˜çš„åˆ†é…å¤§å°ä»¥åŠä½¿ç”¨æƒ…å†µï¼Œçœ‹æ˜¯å¦æœ¬èº«åˆ†é…è¿‡å°ã€‚</p><p>2.<strong>æ‰¾åˆ°æœ€è€—å†…å­˜çš„å¯¹è±¡</strong></p><p><code>jmap -histo:live pid | more</code></p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210610232744.png" alt="img"></p><p>å¦‚å›¾ï¼Œç»“æœä»¥è¡¨æ ¼çš„å½¢å¼æ˜¾ç¤ºå­˜æ´»å¯¹è±¡çš„ä¿¡æ¯ï¼Œå¹¶æŒ‰ç…§æ‰€å å†…å­˜å¤§å°æ’åºï¼š</p><p>å®ä¾‹æ•°ï¼Œæ‰€å å†…å­˜å¤§å°ï¼Œç±»å</p><p>å¦‚æœå‘ç°æŸç±»å¯¹è±¡å ç”¨å†…å­˜å¾ˆå¤§ï¼Œå¾ˆå¯èƒ½æ˜¯ç±»å¯¹è±¡åˆ›å»ºå¤ªå¤šï¼Œä¸”ä¸€ç›´æœªé‡Šæ”¾ã€‚ä¾‹å¦‚ï¼š</p><p>ï¼ˆ1ï¼‰ç”³è¯·å®Œèµ„æºåï¼Œæœªè°ƒç”¨closeé‡Šæ”¾èµ„æº</p><p>ï¼ˆ2ï¼‰æ¶ˆè´¹è€…æ¶ˆè´¹é€Ÿåº¦æ…¢ï¼Œç”Ÿäº§è€…ä¸æ–­å¾€é˜Ÿåˆ—ä¸­æŠ•é€’ä»»åŠ¡ï¼Œå¯¼è‡´é˜Ÿåˆ—ä¸­ä»»åŠ¡ç´¯ç§¯è¿‡å¤š</p><p>3.<strong>ç¡®è®¤é‡Šæ”¾æ˜¯èµ„æºè€—å°½</strong></p><p>pstreeï¼šæŸ¥çœ‹è¿›ç¨‹åˆ›å»ºçš„çº¿ç¨‹æ•°</p><p>netstatï¼šç½‘ç»œè¿æ¥æ•°</p><p>è¿˜æœ‰å¦ä¸€ç§æ–¹æ³•ï¼Œé€šè¿‡</p><p>ll &#x2F;proc&#x2F;pid&#x2F;fd æŸ¥çœ‹å ç”¨å¥æŸ„</p><p>ll &#x2F;proc&#x2F;pid&#x2F;task æŸ¥çœ‹çº¿ç¨‹æ•°</p><p>ä¾‹å¦‚ï¼ŒæŸä¸€å°æ˜¾ç¤ºæœåŠ¡å™¨çš„sshdè¿›ç¨‹æ˜¯1041ï¼ŒæŸ¥çœ‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210610233254.png" alt="img"></p><p>sshdå…±å ç”¨äº†5ä¸ªå¥æŸ„ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210610233318.png" alt="img"></p><p>sshdåªæœ‰ä¸€ä¸ªä¸»çº¿ç¨‹ä¸º1041ï¼Œå¹¶æ²¡æœ‰å¤šçº¿ç¨‹ã€‚</p></blockquote></li></ul><h3 id="é˜¿é‡Œï¼ˆå•†å®¶ï¼‰"><a href="#é˜¿é‡Œï¼ˆå•†å®¶ï¼‰" class="headerlink" title="é˜¿é‡Œï¼ˆå•†å®¶ï¼‰"></a>é˜¿é‡Œï¼ˆå•†å®¶ï¼‰</h3><ul><li>æœ¬åœ°ç¼“å­˜ä¸€èˆ¬é€‚ç”¨äºä»€ä¹ˆåœºæ™¯ï¼Ÿå¦‚ä½•ä¿è¯ç¼“å­˜ä¸€è‡´æ€§</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> é¢ç» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>17è®²</title>
      <link href="/posts/858564ec.html"/>
      <url>/posts/858564ec.html</url>
      
        <content type="html"><![CDATA[<hr><h1 id="17-è·³è¡¨ï¼šä¸ºä»€ä¹ˆRedisä¸€å®šè¦ç”¨è·³è¡¨æ¥å®ç°æœ‰åºé›†åˆï¼Ÿ"><a href="#17-è·³è¡¨ï¼šä¸ºä»€ä¹ˆRedisä¸€å®šè¦ç”¨è·³è¡¨æ¥å®ç°æœ‰åºé›†åˆï¼Ÿ" class="headerlink" title="17 | è·³è¡¨ï¼šä¸ºä»€ä¹ˆRedisä¸€å®šè¦ç”¨è·³è¡¨æ¥å®ç°æœ‰åºé›†åˆï¼Ÿ"></a>17 | è·³è¡¨ï¼šä¸ºä»€ä¹ˆRedisä¸€å®šè¦ç”¨è·³è¡¨æ¥å®ç°æœ‰åºé›†åˆï¼Ÿ</h1><p>Redis ä¸­çš„æœ‰åºé›†åˆï¼ˆSorted Setï¼‰å°±æ˜¯ç”¨è·³è¡¨æ¥å®ç°çš„ã€‚å¦‚æœä½ æœ‰ä¸€å®šåŸºç¡€ï¼Œåº”è¯¥çŸ¥é“çº¢é»‘æ ‘ä¹Ÿå¯ä»¥å®ç°å¿«é€Ÿåœ°æ’å…¥ã€åˆ é™¤å’ŒæŸ¥æ‰¾æ“ä½œã€‚é‚£ Redis ä¸ºä»€ä¹ˆä¼šé€‰æ‹©ç”¨è·³è¡¨æ¥å®ç°æœ‰åºé›†åˆå‘¢ï¼Ÿ ä¸ºä»€ä¹ˆä¸ç”¨çº¢é»‘æ ‘å‘¢ï¼Ÿå­¦å®Œä»Šå¤©çš„å†…å®¹ï¼Œä½ å°±çŸ¥é“ç­”æ¡ˆäº†ã€‚</p><h2 id="å¦‚ä½•ç†è§£â€œè·³è¡¨â€ï¼Ÿ"><a href="#å¦‚ä½•ç†è§£â€œè·³è¡¨â€ï¼Ÿ" class="headerlink" title="å¦‚ä½•ç†è§£â€œè·³è¡¨â€ï¼Ÿ"></a>å¦‚ä½•ç†è§£â€œè·³è¡¨â€ï¼Ÿ</h2><p>å¯¹äºä¸€ä¸ªå•é“¾è¡¨æ¥è®²ï¼Œå³ä¾¿é“¾è¡¨ä¸­å­˜å‚¨çš„æ•°æ®æ˜¯æœ‰åºçš„ï¼Œå¦‚æœæˆ‘ä»¬è¦æƒ³åœ¨å…¶ä¸­æŸ¥æ‰¾æŸä¸ªæ•°æ®ï¼Œä¹Ÿåªèƒ½ä»å¤´åˆ°å°¾éå†é“¾è¡¨ã€‚è¿™æ ·æŸ¥æ‰¾æ•ˆç‡å°±ä¼šå¾ˆä½ï¼Œæ—¶é—´å¤æ‚åº¦ä¼šå¾ˆé«˜ï¼Œæ˜¯ O(n)ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210509151948.jpeg" alt="img"></p><p>é‚£æ€ä¹ˆæ¥æé«˜æŸ¥æ‰¾æ•ˆç‡å‘¢ï¼Ÿå¦‚æœåƒå›¾ä¸­é‚£æ ·ï¼Œå¯¹é“¾è¡¨å»ºç«‹ä¸€çº§â€œç´¢å¼•â€ï¼ŒæŸ¥æ‰¾èµ·æ¥æ˜¯ä¸æ˜¯å°±ä¼šæ›´å¿«ä¸€äº›å‘¢ï¼Ÿæ¯ä¸¤ä¸ªç»“ç‚¹æå–ä¸€ä¸ªç»“ç‚¹åˆ°ä¸Šä¸€çº§ï¼Œæˆ‘ä»¬æŠŠæŠ½å‡ºæ¥çš„é‚£ä¸€çº§å«åšç´¢å¼•æˆ–ç´¢å¼•å±‚ã€‚ä½ å¯ä»¥çœ‹æˆ‘ç”»çš„å›¾ã€‚å›¾ä¸­çš„ down è¡¨ç¤º down æŒ‡é’ˆï¼ŒæŒ‡å‘ä¸‹ä¸€çº§ç»“ç‚¹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210509152007.jpeg" alt="img"></p><p>å¦‚æœæˆ‘ä»¬ç°åœ¨è¦æŸ¥æ‰¾æŸä¸ªç»“ç‚¹ï¼Œæ¯”å¦‚ 16ã€‚æˆ‘ä»¬å¯ä»¥å…ˆåœ¨ç´¢å¼•å±‚éå†ï¼Œå½“éå†åˆ°ç´¢å¼•å±‚ä¸­å€¼ä¸º 13 çš„ç»“ç‚¹æ—¶ï¼Œæˆ‘ä»¬å‘ç°ä¸‹ä¸€ä¸ªç»“ç‚¹æ˜¯ 17ï¼Œé‚£è¦æŸ¥æ‰¾çš„ç»“ç‚¹ 16 è‚¯å®šå°±åœ¨è¿™ä¸¤ä¸ªç»“ç‚¹ä¹‹é—´ã€‚ç„¶åæˆ‘ä»¬é€šè¿‡ç´¢å¼•å±‚ç»“ç‚¹çš„ down æŒ‡é’ˆï¼Œä¸‹é™åˆ°åŸå§‹é“¾è¡¨è¿™ä¸€å±‚ï¼Œç»§ç»­éå†ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦å†éå† 2 ä¸ªç»“ç‚¹ï¼Œå°±å¯ä»¥æ‰¾åˆ°å€¼ç­‰äº 16 çš„è¿™ä¸ªç»“ç‚¹äº†ã€‚è¿™æ ·ï¼ŒåŸæ¥å¦‚æœè¦æŸ¥æ‰¾ 16ï¼Œéœ€è¦éå† 10 ä¸ªç»“ç‚¹ï¼Œç°åœ¨åªéœ€è¦éå† 7 ä¸ªç»“ç‚¹ã€‚</p><p>ä»è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬çœ‹å‡ºï¼Œ<strong>åŠ æ¥ä¸€å±‚ç´¢å¼•ä¹‹åï¼ŒæŸ¥æ‰¾ä¸€ä¸ªç»“ç‚¹éœ€è¦éå†çš„ç»“ç‚¹ä¸ªæ•°å‡å°‘äº†ï¼Œä¹Ÿå°±æ˜¯è¯´æŸ¥æ‰¾æ•ˆç‡æé«˜äº†</strong>ã€‚é‚£å¦‚æœæˆ‘ä»¬å†åŠ ä¸€çº§ç´¢å¼•å‘¢ï¼Ÿæ•ˆç‡ä¼šä¸ä¼šæå‡æ›´å¤šå‘¢ï¼Ÿ</p><p>è·Ÿå‰é¢å»ºç«‹ç¬¬ä¸€çº§ç´¢å¼•çš„æ–¹å¼ç›¸ä¼¼ï¼Œæˆ‘ä»¬åœ¨ç¬¬ä¸€çº§ç´¢å¼•çš„åŸºç¡€ä¹‹ä¸Šï¼Œæ¯ä¸¤ä¸ªç»“ç‚¹å°±æŠ½å‡ºä¸€ä¸ªç»“ç‚¹åˆ°ç¬¬äºŒçº§ç´¢å¼•ã€‚ç°åœ¨æˆ‘ä»¬å†æ¥æŸ¥æ‰¾ 16ï¼Œåªéœ€è¦éå† 6 ä¸ªç»“ç‚¹äº†ï¼Œéœ€è¦éå†çš„ç»“ç‚¹æ•°é‡åˆå‡å°‘äº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210509152037.jpeg" alt="img"></p><p>æˆ‘ä¸¾çš„ä¾‹å­æ•°æ®é‡ä¸å¤§ï¼Œæ‰€ä»¥å³ä¾¿åŠ äº†ä¸¤çº§ç´¢å¼•ï¼ŒæŸ¥æ‰¾æ•ˆç‡çš„æå‡ä¹Ÿå¹¶ä¸æ˜æ˜¾ã€‚ä¸ºäº†è®©ä½ èƒ½çœŸåˆ‡åœ°æ„Ÿå—ç´¢å¼•æå‡æŸ¥è¯¢æ•ˆç‡ã€‚æˆ‘ç”»äº†ä¸€ä¸ªåŒ…å« 64 ä¸ªç»“ç‚¹çš„é“¾è¡¨ï¼ŒæŒ‰ç…§å‰é¢è®²çš„è¿™ç§æ€è·¯ï¼Œå»ºç«‹äº†äº”çº§ç´¢å¼•ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210509152117.jpeg" alt="img"></p><p>ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒåŸæ¥æ²¡æœ‰ç´¢å¼•çš„æ—¶å€™ï¼ŒæŸ¥æ‰¾ 62 éœ€è¦éå† 62 ä¸ªç»“ç‚¹ï¼Œç°åœ¨åªéœ€è¦éå† 11 ä¸ªç»“ç‚¹ï¼Œé€Ÿåº¦æ˜¯ä¸æ˜¯æé«˜äº†å¾ˆå¤šï¼Ÿæ‰€ä»¥ï¼Œå½“é“¾è¡¨çš„é•¿åº¦ n æ¯”è¾ƒå¤§æ—¶ï¼Œæ¯”å¦‚ 1000ã€10000 çš„æ—¶å€™ï¼Œåœ¨æ„å»ºç´¢å¼•ä¹‹åï¼ŒæŸ¥æ‰¾æ•ˆç‡çš„æå‡å°±ä¼šéå¸¸æ˜æ˜¾ã€‚</p><p>å‰é¢è®²çš„<strong>è¿™ç§é“¾è¡¨åŠ å¤šçº§ç´¢å¼•çš„ç»“æ„ï¼Œå°±æ˜¯è·³è¡¨</strong>ã€‚æˆ‘é€šè¿‡ä¾‹å­ç»™ä½ å±•ç¤ºäº†è·³è¡¨æ˜¯å¦‚ä½•å‡å°‘æŸ¥è¯¢æ¬¡æ•°çš„ï¼Œç°åœ¨ä½ åº”è¯¥æ¯”è¾ƒæ¸…æ™°åœ°çŸ¥é“ï¼Œè·³è¡¨ç¡®å®æ˜¯å¯ä»¥æé«˜æŸ¥è¯¢æ•ˆç‡çš„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä¼šå®šé‡åœ°åˆ†æä¸€ä¸‹ï¼Œç”¨è·³è¡¨æŸ¥è¯¢åˆ°åº•æœ‰å¤šå¿«ã€‚</p><h2 id="ç”¨è·³è¡¨æŸ¥è¯¢åˆ°åº•æœ‰å¤šå¿«ï¼Ÿ"><a href="#ç”¨è·³è¡¨æŸ¥è¯¢åˆ°åº•æœ‰å¤šå¿«ï¼Ÿ" class="headerlink" title="ç”¨è·³è¡¨æŸ¥è¯¢åˆ°åº•æœ‰å¤šå¿«ï¼Ÿ"></a>ç”¨è·³è¡¨æŸ¥è¯¢åˆ°åº•æœ‰å¤šå¿«ï¼Ÿ</h2><p>å‰é¢æˆ‘è®²è¿‡ï¼Œç®—æ³•çš„æ‰§è¡Œæ•ˆç‡å¯ä»¥é€šè¿‡æ—¶é—´å¤æ‚åº¦æ¥åº¦é‡ï¼Œè¿™é‡Œä¾æ—§å¯ä»¥ç”¨ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ä¸€ä¸ªå•é“¾è¡¨ä¸­æŸ¥è¯¢æŸä¸ªæ•°æ®çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚é‚£åœ¨ä¸€ä¸ªå…·æœ‰å¤šçº§ç´¢å¼•çš„è·³è¡¨ä¸­ï¼ŒæŸ¥è¯¢æŸä¸ªæ•°æ®çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘å‘¢ï¼Ÿ</p><p>è¿™ä¸ªæ—¶é—´å¤æ‚åº¦çš„åˆ†ææ–¹æ³•æ¯”è¾ƒéš¾æƒ³åˆ°ã€‚æˆ‘æŠŠé—®é¢˜åˆ†è§£ä¸€ä¸‹ï¼Œå…ˆæ¥çœ‹è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœé“¾è¡¨é‡Œæœ‰ n ä¸ªç»“ç‚¹ï¼Œä¼šæœ‰å¤šå°‘çº§ç´¢å¼•å‘¢ï¼Ÿ</p><p>æŒ‰ç…§æˆ‘ä»¬åˆšæ‰è®²çš„ï¼Œæ¯ä¸¤ä¸ªç»“ç‚¹ä¼šæŠ½å‡ºä¸€ä¸ªç»“ç‚¹ä½œä¸ºä¸Šä¸€çº§ç´¢å¼•çš„ç»“ç‚¹ï¼Œé‚£ç¬¬ä¸€çº§ç´¢å¼•çš„ç»“ç‚¹ä¸ªæ•°å¤§çº¦å°±æ˜¯ n&#x2F;2ï¼Œç¬¬äºŒçº§ç´¢å¼•çš„ç»“ç‚¹ä¸ªæ•°å¤§çº¦å°±æ˜¯ n&#x2F;4ï¼Œç¬¬ä¸‰çº§ç´¢å¼•çš„ç»“ç‚¹ä¸ªæ•°å¤§çº¦å°±æ˜¯ n&#x2F;8ï¼Œä¾æ¬¡ç±»æ¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>ç¬¬ k çº§ç´¢å¼•çš„ç»“ç‚¹ä¸ªæ•°æ˜¯ç¬¬ k-1 çº§ç´¢å¼•çš„ç»“ç‚¹ä¸ªæ•°çš„ 1&#x2F;2ï¼Œé‚£ç¬¬ kçº§ç´¢å¼•ç»“ç‚¹çš„ä¸ªæ•°å°±æ˜¯ n&#x2F;(2k)ã€‚</strong></p><p>å‡è®¾ç´¢å¼•æœ‰ h çº§ï¼Œæœ€é«˜çº§çš„ç´¢å¼•æœ‰ 2 ä¸ªç»“ç‚¹ã€‚é€šè¿‡ä¸Šé¢çš„å…¬å¼ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ° n&#x2F;(2h)&#x3D;2ï¼Œä»è€Œæ±‚å¾— h&#x3D;log2n-1ã€‚å¦‚æœåŒ…å«åŸå§‹é“¾è¡¨è¿™ä¸€å±‚ï¼Œæ•´ä¸ªè·³è¡¨çš„é«˜åº¦å°±æ˜¯ log2nã€‚æˆ‘ä»¬åœ¨è·³è¡¨ä¸­æŸ¥è¯¢æŸä¸ªæ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœæ¯ä¸€å±‚éƒ½è¦éå† m ä¸ªç»“ç‚¹ï¼Œé‚£åœ¨è·³è¡¨ä¸­æŸ¥è¯¢ä¸€ä¸ªæ•°æ®çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(m*logn)ã€‚</p><p>é‚£è¿™ä¸ª m çš„å€¼æ˜¯å¤šå°‘å‘¢ï¼ŸæŒ‰ç…§å‰é¢è¿™ç§ç´¢å¼•ç»“æ„ï¼Œæˆ‘ä»¬æ¯ä¸€çº§ç´¢å¼•éƒ½æœ€å¤šåªéœ€è¦éå† 3 ä¸ªç»“ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ m&#x3D;3ï¼Œä¸ºä»€ä¹ˆæ˜¯ 3 å‘¢ï¼Ÿæˆ‘æ¥è§£é‡Šä¸€ä¸‹ã€‚</p><p>å‡è®¾æˆ‘ä»¬è¦æŸ¥æ‰¾çš„æ•°æ®æ˜¯ xï¼Œåœ¨ç¬¬ k çº§ç´¢å¼•ä¸­ï¼Œæˆ‘ä»¬éå†åˆ° y ç»“ç‚¹ä¹‹åï¼Œå‘ç° x å¤§äº yï¼Œå°äºåé¢çš„ç»“ç‚¹ zï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡ y çš„ down æŒ‡é’ˆï¼Œä»ç¬¬ k çº§ç´¢å¼•ä¸‹é™åˆ°ç¬¬ k-1 çº§ç´¢å¼•ã€‚åœ¨ç¬¬ k-1 çº§ç´¢å¼•ä¸­ï¼Œy å’Œ z ä¹‹é—´åªæœ‰ 3 ä¸ªç»“ç‚¹ï¼ˆåŒ…å« y å’Œ zï¼‰ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨ K-1 çº§ç´¢å¼•ä¸­æœ€å¤šåªéœ€è¦éå† 3 ä¸ªç»“ç‚¹ï¼Œä¾æ¬¡ç±»æ¨ï¼Œæ¯ä¸€çº§ç´¢å¼•éƒ½æœ€å¤šåªéœ€è¦éå† 3 ä¸ªç»“ç‚¹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210509152501.jpeg" alt="img"></p><p>é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å¾—åˆ° m&#x3D;3ï¼Œæ‰€ä»¥åœ¨è·³è¡¨ä¸­æŸ¥è¯¢ä»»æ„æ•°æ®çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(logn)ã€‚è¿™ä¸ªæŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦è·ŸäºŒåˆ†æŸ¥æ‰¾æ˜¯ä¸€æ ·çš„ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å…¶å®æ˜¯åŸºäºå•é“¾è¡¨å®ç°äº†äºŒåˆ†æŸ¥æ‰¾ï¼Œæ˜¯ä¸æ˜¯å¾ˆç¥å¥‡ï¼Ÿä¸è¿‡ï¼Œå¤©ä¸‹æ²¡æœ‰å…è´¹çš„åˆé¤ï¼Œè¿™ç§æŸ¥è¯¢æ•ˆç‡çš„æå‡ï¼Œå‰ææ˜¯å»ºç«‹äº†å¾ˆå¤šçº§ç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨ç¬¬ 6 èŠ‚è®²è¿‡çš„ç©ºé—´æ¢æ—¶é—´çš„è®¾è®¡æ€è·¯ã€‚</p><h2 id="è§£ç­”å¼€ç¯‡"><a href="#è§£ç­”å¼€ç¯‡" class="headerlink" title="è§£ç­”å¼€ç¯‡"></a>è§£ç­”å¼€ç¯‡</h2><p>ä»Šå¤©çš„å†…å®¹åˆ°æ­¤å°±è®²å®Œäº†ã€‚ç°åœ¨ï¼Œæˆ‘æ¥è®²è§£ä¸€ä¸‹å¼€ç¯‡çš„æ€è€ƒé¢˜ï¼šä¸ºä»€ä¹ˆ Redis è¦ç”¨è·³è¡¨æ¥å®ç°æœ‰åºé›†åˆï¼Œè€Œä¸æ˜¯çº¢é»‘æ ‘ï¼Ÿ</p><p>Redis ä¸­çš„æœ‰åºé›†åˆæ˜¯é€šè¿‡è·³è¡¨æ¥å®ç°çš„ï¼Œä¸¥æ ¼ç‚¹è®²ï¼Œå…¶å®è¿˜ç”¨åˆ°äº†æ•£åˆ—è¡¨ã€‚ä¸è¿‡æ•£åˆ—è¡¨æˆ‘ä»¬åé¢æ‰ä¼šè®²åˆ°ï¼Œæ‰€ä»¥æˆ‘ä»¬ç°åœ¨æš‚ä¸”å¿½ç•¥è¿™éƒ¨åˆ†ã€‚å¦‚æœä½ å»æŸ¥çœ‹ Redis çš„å¼€å‘æ‰‹å†Œï¼Œå°±ä¼šå‘ç°ï¼ŒRedis ä¸­çš„æœ‰åºé›†åˆæ”¯æŒçš„æ ¸å¿ƒæ“ä½œä¸»è¦æœ‰ä¸‹é¢è¿™å‡ ä¸ªï¼š</p><ul><li>æ’å…¥ä¸€ä¸ªæ•°æ®ï¼›</li><li>åˆ é™¤ä¸€ä¸ªæ•°æ®ï¼›</li><li>æŸ¥æ‰¾ä¸€ä¸ªæ•°æ®ï¼›</li><li>æŒ‰ç…§åŒºé—´æŸ¥æ‰¾æ•°æ®ï¼ˆæ¯”å¦‚æŸ¥æ‰¾å€¼åœ¨[100, 356]ä¹‹é—´çš„æ•°æ®ï¼‰ï¼›</li><li>è¿­ä»£è¾“å‡ºæœ‰åºåºåˆ—ã€‚</li></ul><p>å…¶ä¸­ï¼Œæ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾ä»¥åŠè¿­ä»£è¾“å‡ºæœ‰åºåºåˆ—è¿™å‡ ä¸ªæ“ä½œï¼Œçº¢é»‘æ ‘ä¹Ÿå¯ä»¥å®Œæˆï¼Œæ—¶é—´å¤æ‚åº¦è·Ÿè·³è¡¨æ˜¯ä¸€æ ·çš„ã€‚ä½†æ˜¯ï¼ŒæŒ‰ç…§åŒºé—´æ¥æŸ¥æ‰¾æ•°æ®è¿™ä¸ªæ“ä½œï¼Œçº¢é»‘æ ‘çš„æ•ˆç‡æ²¡æœ‰è·³è¡¨é«˜ã€‚</p><p>å¯¹äºæŒ‰ç…§åŒºé—´æŸ¥æ‰¾æ•°æ®è¿™ä¸ªæ“ä½œï¼Œè·³è¡¨å¯ä»¥åšåˆ° O(logn) çš„æ—¶é—´å¤æ‚åº¦å®šä½åŒºé—´çš„èµ·ç‚¹ï¼Œç„¶ååœ¨åŸå§‹é“¾è¡¨ä¸­é¡ºåºå¾€åéå†å°±å¯ä»¥äº†ã€‚è¿™æ ·åšéå¸¸é«˜æ•ˆã€‚</p><p>å½“ç„¶ï¼ŒRedis ä¹‹æ‰€ä»¥ç”¨è·³è¡¨æ¥å®ç°æœ‰åºé›†åˆï¼Œè¿˜æœ‰å…¶ä»–åŸå› ï¼Œæ¯”å¦‚ï¼Œè·³è¡¨æ›´å®¹æ˜“ä»£ç å®ç°ã€‚è™½ç„¶è·³è¡¨çš„å®ç°ä¹Ÿä¸ç®€å•ï¼Œä½†æ¯”èµ·çº¢é»‘æ ‘æ¥è¯´è¿˜æ˜¯å¥½æ‡‚ã€å¥½å†™å¤šäº†ï¼Œè€Œç®€å•å°±æ„å‘³ç€å¯è¯»æ€§å¥½ï¼Œä¸å®¹æ˜“å‡ºé”™ã€‚è¿˜æœ‰ï¼Œè·³è¡¨æ›´åŠ çµæ´»ï¼Œå®ƒå¯ä»¥é€šè¿‡æ”¹å˜ç´¢å¼•æ„å»ºç­–ç•¥ï¼Œæœ‰æ•ˆå¹³è¡¡æ‰§è¡Œæ•ˆç‡å’Œå†…å­˜æ¶ˆè€—ã€‚</p><p>ä¸è¿‡ï¼Œè·³è¡¨ä¹Ÿä¸èƒ½å®Œå…¨æ›¿ä»£çº¢é»‘æ ‘ã€‚å› ä¸ºçº¢é»‘æ ‘æ¯”è·³è¡¨çš„å‡ºç°è¦æ—©ä¸€äº›ï¼Œå¾ˆå¤šç¼–ç¨‹è¯­è¨€ä¸­çš„ Map ç±»å‹éƒ½æ˜¯é€šè¿‡çº¢é»‘æ ‘æ¥å®ç°çš„ã€‚æˆ‘ä»¬åšä¸šåŠ¡å¼€å‘çš„æ—¶å€™ï¼Œç›´æ¥æ‹¿æ¥ç”¨å°±å¯ä»¥äº†ï¼Œä¸ç”¨è´¹åŠ²è‡ªå·±å»å®ç°ä¸€ä¸ªçº¢é»‘æ ‘ï¼Œä½†æ˜¯è·³è¡¨å¹¶æ²¡æœ‰ä¸€ä¸ªç°æˆçš„å®ç°ï¼Œæ‰€ä»¥åœ¨å¼€å‘ä¸­ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨è·³è¡¨ï¼Œå¿…é¡»è¦è‡ªå·±å®ç°ã€‚</p><h2 id="å†…å®¹å°ç»“"><a href="#å†…å®¹å°ç»“" class="headerlink" title="å†…å®¹å°ç»“"></a>å†…å®¹å°ç»“</h2><p>ä»Šå¤©æˆ‘ä»¬è®²äº†è·³è¡¨è¿™ç§æ•°æ®ç»“æ„ã€‚è·³è¡¨ä½¿ç”¨ç©ºé—´æ¢æ—¶é—´çš„è®¾è®¡æ€è·¯ï¼Œé€šè¿‡æ„å»ºå¤šçº§ç´¢å¼•æ¥æé«˜æŸ¥è¯¢çš„æ•ˆç‡ï¼Œå®ç°äº†åŸºäºé“¾è¡¨çš„â€œäºŒåˆ†æŸ¥æ‰¾â€ã€‚è·³è¡¨æ˜¯ä¸€ç§åŠ¨æ€æ•°æ®ç»“æ„ï¼Œæ”¯æŒå¿«é€Ÿåœ°æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(logn)ã€‚</p><p>è·³è¡¨çš„ç©ºé—´å¤æ‚åº¦æ˜¯ O(n)ã€‚ä¸è¿‡ï¼Œè·³è¡¨çš„å®ç°éå¸¸çµæ´»ï¼Œå¯ä»¥é€šè¿‡æ”¹å˜ç´¢å¼•æ„å»ºç­–ç•¥ï¼Œæœ‰æ•ˆå¹³è¡¡æ‰§è¡Œæ•ˆç‡å’Œå†…å­˜æ¶ˆè€—ã€‚è™½ç„¶è·³è¡¨çš„ä»£ç å®ç°å¹¶ä¸ç®€å•ï¼Œä½†æ˜¯ä½œä¸ºä¸€ç§åŠ¨æ€æ•°æ®ç»“æ„ï¼Œæ¯”èµ·çº¢é»‘æ ‘æ¥è¯´ï¼Œå®ç°è¦ç®€å•å¤šäº†ã€‚æ‰€ä»¥å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬ä¸ºäº†ä»£ç çš„ç®€å•ã€æ˜“è¯»ï¼Œæ¯”èµ·çº¢é»‘æ ‘ï¼Œæˆ‘ä»¬æ›´å€¾å‘ç”¨è·³è¡¨ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>16è®² | äºŒåˆ†æŸ¥æ‰¾ï¼ˆä¸‹ï¼‰</title>
      <link href="/posts/dfdc8e63.html"/>
      <url>/posts/dfdc8e63.html</url>
      
        <content type="html"><![CDATA[<hr><h1 id="16-äºŒåˆ†æŸ¥æ‰¾ï¼ˆä¸‹ï¼‰ï¼šå¦‚ä½•å¿«é€Ÿå®šä½IPå¯¹åº”çš„çœä»½åœ°å€ï¼Ÿ"><a href="#16-äºŒåˆ†æŸ¥æ‰¾ï¼ˆä¸‹ï¼‰ï¼šå¦‚ä½•å¿«é€Ÿå®šä½IPå¯¹åº”çš„çœä»½åœ°å€ï¼Ÿ" class="headerlink" title="16 | äºŒåˆ†æŸ¥æ‰¾ï¼ˆä¸‹ï¼‰ï¼šå¦‚ä½•å¿«é€Ÿå®šä½IPå¯¹åº”çš„çœä»½åœ°å€ï¼Ÿ"></a>16 | äºŒåˆ†æŸ¥æ‰¾ï¼ˆä¸‹ï¼‰ï¼šå¦‚ä½•å¿«é€Ÿå®šä½IPå¯¹åº”çš„çœä»½åœ°å€ï¼Ÿ</h1><h2 id="å˜ä½“ä¸€ï¼šæŸ¥æ‰¾ç¬¬ä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ "><a href="#å˜ä½“ä¸€ï¼šæŸ¥æ‰¾ç¬¬ä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ " class="headerlink" title="å˜ä½“ä¸€ï¼šæŸ¥æ‰¾ç¬¬ä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ "></a>å˜ä½“ä¸€ï¼šæŸ¥æ‰¾ç¬¬ä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ </h2><p>æ¯”å¦‚ä¸‹é¢è¿™æ ·ä¸€ä¸ªæœ‰åºæ•°ç»„ï¼Œå…¶ä¸­ï¼Œa[5]ï¼Œa[6]ï¼Œa[7]çš„å€¼éƒ½ç­‰äº 8ï¼Œæ˜¯é‡å¤çš„æ•°æ®ã€‚æˆ‘ä»¬å¸Œæœ›æŸ¥æ‰¾ç¬¬ä¸€ä¸ªç­‰äº 8 çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ä¸‹æ ‡æ˜¯ 5 çš„å…ƒç´ ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210507081300.jpeg" alt="img"></p><p>å¦‚æœæˆ‘ä»¬ç”¨ä¸Šä¸€èŠ‚è¯¾è®²çš„äºŒåˆ†æŸ¥æ‰¾çš„ä»£ç å®ç°ï¼Œé¦–å…ˆæ‹¿ 8 ä¸åŒºé—´çš„ä¸­é—´å€¼ a[4]æ¯”è¾ƒï¼Œ8 æ¯” 6 å¤§ï¼Œäºæ˜¯åœ¨ä¸‹æ ‡ 5 åˆ° 9 ä¹‹é—´ç»§ç»­æŸ¥æ‰¾ã€‚ä¸‹æ ‡ 5 å’Œ 9 çš„ä¸­é—´ä½ç½®æ˜¯ä¸‹æ ‡ 7ï¼Œa[7]æ­£å¥½ç­‰äº 8ï¼Œæ‰€ä»¥ä»£ç å°±è¿”å›äº†ã€‚</p><p>å°½ç®¡ a[7]ä¹Ÿç­‰äº 8ï¼Œä½†å®ƒå¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦æ‰¾çš„ç¬¬ä¸€ä¸ªç­‰äº 8 çš„å…ƒç´ ï¼Œå› ä¸ºç¬¬ä¸€ä¸ªå€¼ç­‰äº 8 çš„å…ƒç´ æ˜¯æ•°ç»„ä¸‹æ ‡ä¸º 5 çš„å…ƒç´ ã€‚æˆ‘ä»¬ä¸Šä¸€èŠ‚è®²çš„äºŒåˆ†æŸ¥æ‰¾ä»£ç å°±æ— æ³•å¤„ç†è¿™ç§æƒ…å†µäº†ã€‚æ‰€ä»¥ï¼Œé’ˆå¯¹è¿™ä¸ªå˜å½¢é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ç¨å¾®æ”¹é€ ä¸€ä¸‹ä¸Šä¸€èŠ‚çš„ä»£ç ã€‚</p><p>æˆ‘æ¢äº†ä¸€ç§å®ç°æ–¹æ³•ï¼Œä½ çœ‹çœ‹æ˜¯ä¸æ˜¯æ›´å®¹æ˜“ç†è§£å‘¢ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">bsearch</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> n, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">  <span class="type">int</span> <span class="variable">low</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">  <span class="type">int</span> <span class="variable">high</span> <span class="operator">=</span> n - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (low &lt;= high) &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span>  low + ((high - low) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (a[mid] &gt; value) &#123;</span><br><span class="line">      high = mid - <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a[mid] &lt; value) &#123;</span><br><span class="line">      low = mid + <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> ((mid == <span class="number">0</span>) || (a[mid - <span class="number">1</span>] != value)) <span class="keyword">return</span> mid;</span><br><span class="line">      <span class="keyword">else</span> high = mid - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘æ¥ç¨å¾®è§£é‡Šä¸€ä¸‹è¿™æ®µä»£ç ã€‚a[mid]è·Ÿè¦æŸ¥æ‰¾çš„ value çš„å¤§å°å…³ç³»æœ‰ä¸‰ç§æƒ…å†µï¼šå¤§äºã€å°äºã€ç­‰äºã€‚å¯¹äº a[mid]&gt;value çš„æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–° high&#x3D; mid-1ï¼›å¯¹äº a[mid]&lt;value çš„æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–° low&#x3D;mid+1ã€‚è¿™ä¸¤ç‚¹éƒ½å¾ˆå¥½ç†è§£ã€‚é‚£å½“ a[mid]&#x3D;value çš„æ—¶å€™åº”è¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ</p><p>å¦‚æœæˆ‘ä»¬æŸ¥æ‰¾çš„æ˜¯ä»»æ„ä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ ï¼Œå½“ a[mid]ç­‰äºè¦æŸ¥æ‰¾çš„å€¼æ—¶ï¼Œa[mid]å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„å…ƒç´ ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æ±‚è§£çš„æ˜¯ç¬¬ä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ ï¼Œå½“ a[mid]ç­‰äºè¦æŸ¥æ‰¾çš„å€¼æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦ç¡®è®¤ä¸€ä¸‹è¿™ä¸ª a[mid]æ˜¯ä¸æ˜¯ç¬¬ä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ ã€‚</p><p>æˆ‘ä»¬é‡ç‚¹çœ‹ç¬¬ 11 è¡Œä»£ç ã€‚å¦‚æœ mid ç­‰äº 0ï¼Œé‚£è¿™ä¸ªå…ƒç´ å·²ç»æ˜¯æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œé‚£å®ƒè‚¯å®šæ˜¯æˆ‘ä»¬è¦æ‰¾çš„ï¼›å¦‚æœ mid ä¸ç­‰äº 0ï¼Œä½† a[mid]çš„å‰ä¸€ä¸ªå…ƒç´  a[mid-1]ä¸ç­‰äº valueï¼Œé‚£ä¹Ÿè¯´æ˜ a[mid]å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ç¬¬ä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ ã€‚</p><p>å¦‚æœç»è¿‡æ£€æŸ¥ä¹‹åå‘ç° a[mid]å‰é¢çš„ä¸€ä¸ªå…ƒç´  a[mid-1]ä¹Ÿç­‰äº valueï¼Œé‚£è¯´æ˜æ­¤æ—¶çš„ a[mid]è‚¯å®šä¸æ˜¯æˆ‘ä»¬è¦æŸ¥æ‰¾çš„ç¬¬ä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ ã€‚é‚£æˆ‘ä»¬å°±æ›´æ–° high&#x3D;mid-1ï¼Œå› ä¸ºè¦æ‰¾çš„å…ƒç´ è‚¯å®šå‡ºç°åœ¨[low, mid-1]ä¹‹é—´ã€‚</p><p>å¯¹æ¯”ä¸Šé¢çš„ä¸¤æ®µä»£ç ï¼Œæ˜¯ä¸æ˜¯ä¸‹é¢é‚£ç§æ›´å¥½ç†è§£ï¼Ÿå®é™…ä¸Šï¼Œ<strong>å¾ˆå¤šäººéƒ½è§‰å¾—å˜å½¢çš„äºŒåˆ†æŸ¥æ‰¾å¾ˆéš¾å†™ï¼Œä¸»è¦åŸå› æ˜¯å¤ªè¿½æ±‚ç¬¬ä¸€ç§é‚£æ ·å®Œç¾ã€ç®€æ´çš„å†™æ³•</strong>ã€‚è€Œå¯¹äºæˆ‘ä»¬åšå·¥ç¨‹å¼€å‘çš„äººæ¥è¯´ï¼Œä»£ç æ˜“è¯»æ‡‚ã€æ²¡ Bugï¼Œå…¶å®æ›´é‡è¦ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—ç¬¬äºŒç§å†™æ³•æ›´å¥½ã€‚</p><h2 id="å˜ä½“äºŒï¼šæŸ¥æ‰¾æœ€åä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ "><a href="#å˜ä½“äºŒï¼šæŸ¥æ‰¾æœ€åä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ " class="headerlink" title="å˜ä½“äºŒï¼šæŸ¥æ‰¾æœ€åä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ "></a>å˜ä½“äºŒï¼šæŸ¥æ‰¾æœ€åä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ </h2><p>å‰é¢çš„é—®é¢˜æ˜¯æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ ï¼Œæˆ‘ç°åœ¨æŠŠé—®é¢˜ç¨å¾®æ”¹ä¸€ä¸‹ï¼ŒæŸ¥æ‰¾æœ€åä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ ï¼Œåˆè¯¥å¦‚ä½•åšå‘¢ï¼Ÿ</p><p>å¦‚æœä½ æŒæ¡äº†å‰é¢çš„å†™æ³•ï¼Œé‚£è¿™ä¸ªé—®é¢˜ä½ åº”è¯¥å¾ˆè½»æ¾å°±èƒ½è§£å†³ã€‚ä½ å¯ä»¥å…ˆè¯•ç€å®ç°ä¸€ä¸‹ï¼Œç„¶åè·Ÿæˆ‘å†™çš„å¯¹æ¯”ä¸€ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">bsearch</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> n, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">  <span class="type">int</span> <span class="variable">low</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">  <span class="type">int</span> <span class="variable">high</span> <span class="operator">=</span> n - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (low &lt;= high) &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span>  low + ((high - low) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (a[mid] &gt; value) &#123;</span><br><span class="line">      high = mid - <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a[mid] &lt; value) &#123;</span><br><span class="line">      low = mid + <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> ((mid == n - <span class="number">1</span>) || (a[mid + <span class="number">1</span>] != value)) <span class="keyword">return</span> mid;</span><br><span class="line">      <span class="keyword">else</span> low = mid + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜æ˜¯é‡ç‚¹çœ‹ç¬¬ 11 è¡Œä»£ç ã€‚å¦‚æœ a[mid]è¿™ä¸ªå…ƒç´ å·²ç»æ˜¯æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ äº†ï¼Œé‚£å®ƒè‚¯å®šæ˜¯æˆ‘ä»¬è¦æ‰¾çš„ï¼›å¦‚æœ a[mid]çš„åä¸€ä¸ªå…ƒç´  a[mid+1]ä¸ç­‰äº valueï¼Œé‚£ä¹Ÿè¯´æ˜ a[mid]å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„æœ€åä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ ã€‚</p><p>å¦‚æœæˆ‘ä»¬ç»è¿‡æ£€æŸ¥ä¹‹åï¼Œå‘ç° a[mid]åé¢çš„ä¸€ä¸ªå…ƒç´  a[mid+1]ä¹Ÿç­‰äº valueï¼Œé‚£è¯´æ˜å½“å‰çš„è¿™ä¸ª a[mid]å¹¶ä¸æ˜¯æœ€åä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ ã€‚æˆ‘ä»¬å°±æ›´æ–° low&#x3D;mid+1ï¼Œå› ä¸ºè¦æ‰¾çš„å…ƒç´ è‚¯å®šå‡ºç°åœ¨[mid+1, high]ä¹‹é—´ã€‚</p><h2 id="å˜ä½“ä¸‰ï¼šæŸ¥æ‰¾ç¬¬ä¸€ä¸ªå¤§äºç­‰äºç»™å®šå€¼çš„å…ƒç´ "><a href="#å˜ä½“ä¸‰ï¼šæŸ¥æ‰¾ç¬¬ä¸€ä¸ªå¤§äºç­‰äºç»™å®šå€¼çš„å…ƒç´ " class="headerlink" title="å˜ä½“ä¸‰ï¼šæŸ¥æ‰¾ç¬¬ä¸€ä¸ªå¤§äºç­‰äºç»™å®šå€¼çš„å…ƒç´ "></a>å˜ä½“ä¸‰ï¼šæŸ¥æ‰¾ç¬¬ä¸€ä¸ªå¤§äºç­‰äºç»™å®šå€¼çš„å…ƒç´ </h2><p>ç°åœ¨æˆ‘ä»¬å†æ¥çœ‹å¦å¤–ä¸€ç±»å˜å½¢é—®é¢˜ã€‚åœ¨æœ‰åºæ•°ç»„ä¸­ï¼ŒæŸ¥æ‰¾ç¬¬ä¸€ä¸ªå¤§äºç­‰äºç»™å®šå€¼çš„å…ƒç´ ã€‚æ¯”å¦‚ï¼Œæ•°ç»„ä¸­å­˜å‚¨çš„è¿™æ ·ä¸€ä¸ªåºåˆ—ï¼š3ï¼Œ4ï¼Œ6ï¼Œ7ï¼Œ10ã€‚å¦‚æœæŸ¥æ‰¾ç¬¬ä¸€ä¸ªå¤§äºç­‰äº 5 çš„å…ƒç´ ï¼Œé‚£å°±æ˜¯ 6ã€‚</p><p>å®é™…ä¸Šï¼Œå®ç°çš„æ€è·¯è·Ÿå‰é¢çš„é‚£ä¸¤ç§å˜å½¢é—®é¢˜çš„å®ç°æ€è·¯ç±»ä¼¼ï¼Œä»£ç å†™èµ·æ¥ç”šè‡³æ›´ç®€æ´ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">bsearch</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> n, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">  <span class="type">int</span> <span class="variable">low</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">  <span class="type">int</span> <span class="variable">high</span> <span class="operator">=</span> n - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (low &lt;= high) &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span>  low + ((high - low) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (a[mid] &gt;= value) &#123;</span><br><span class="line">      <span class="keyword">if</span> ((mid == <span class="number">0</span>) || (a[mid - <span class="number">1</span>] &lt; value)) <span class="keyword">return</span> mid;</span><br><span class="line">      <span class="keyword">else</span> high = mid - <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      low = mid + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœ a[mid]å°äºè¦æŸ¥æ‰¾çš„å€¼ valueï¼Œé‚£è¦æŸ¥æ‰¾çš„å€¼è‚¯å®šåœ¨[mid+1, high]ä¹‹é—´ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬æ›´æ–° low&#x3D;mid+1ã€‚</p><p>å¯¹äº a[mid]å¤§äºç­‰äºç»™å®šå€¼ value çš„æƒ…å†µï¼Œæˆ‘ä»¬è¦å…ˆçœ‹ä¸‹è¿™ä¸ª a[mid]æ˜¯ä¸æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ç¬¬ä¸€ä¸ªå€¼å¤§äºç­‰äºç»™å®šå€¼çš„å…ƒç´ ã€‚å¦‚æœ a[mid]å‰é¢å·²ç»æ²¡æœ‰å…ƒç´ ï¼Œæˆ–è€…å‰é¢ä¸€ä¸ªå…ƒç´ å°äºè¦æŸ¥æ‰¾çš„å€¼ valueï¼Œé‚£ a[mid]å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„å…ƒç´ ã€‚è¿™æ®µé€»è¾‘å¯¹åº”çš„ä»£ç æ˜¯ç¬¬ 7 è¡Œã€‚</p><p>å¦‚æœ a[mid-1]ä¹Ÿå¤§äºç­‰äºè¦æŸ¥æ‰¾çš„å€¼ valueï¼Œé‚£è¯´æ˜è¦æŸ¥æ‰¾çš„å…ƒç´ åœ¨[low, mid-1]ä¹‹é—´ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å°† high æ›´æ–°ä¸º mid-1ã€‚</p><h2 id="å˜ä½“å››ï¼šæŸ¥æ‰¾æœ€åä¸€ä¸ªå°äºç­‰äºç»™å®šå€¼çš„å…ƒç´ "><a href="#å˜ä½“å››ï¼šæŸ¥æ‰¾æœ€åä¸€ä¸ªå°äºç­‰äºç»™å®šå€¼çš„å…ƒç´ " class="headerlink" title="å˜ä½“å››ï¼šæŸ¥æ‰¾æœ€åä¸€ä¸ªå°äºç­‰äºç»™å®šå€¼çš„å…ƒç´ "></a>å˜ä½“å››ï¼šæŸ¥æ‰¾æœ€åä¸€ä¸ªå°äºç­‰äºç»™å®šå€¼çš„å…ƒç´ </h2><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹æœ€åä¸€ç§äºŒåˆ†æŸ¥æ‰¾çš„å˜å½¢é—®é¢˜ï¼ŒæŸ¥æ‰¾æœ€åä¸€ä¸ªå°äºç­‰äºç»™å®šå€¼çš„å…ƒç´ ã€‚æ¯”å¦‚ï¼Œæ•°ç»„ä¸­å­˜å‚¨äº†è¿™æ ·ä¸€ç»„æ•°æ®ï¼š3ï¼Œ5ï¼Œ6ï¼Œ8ï¼Œ9ï¼Œ10ã€‚æœ€åä¸€ä¸ªå°äºç­‰äº 7 çš„å…ƒç´ å°±æ˜¯ 6ã€‚æ˜¯ä¸æ˜¯æœ‰ç‚¹ç±»ä¼¼ä¸Šé¢é‚£ä¸€ç§ï¼Ÿå®é™…ä¸Šï¼Œå®ç°æ€è·¯ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚</p><p>æœ‰äº†å‰é¢çš„åŸºç¡€ï¼Œä½ å®Œå…¨å¯ä»¥è‡ªå·±å†™å‡ºæ¥äº†ï¼Œæ‰€ä»¥æˆ‘å°±ä¸è¯¦ç»†åˆ†æäº†ã€‚æˆ‘æŠŠä»£ç è´´å‡ºæ¥ï¼Œä½ å¯ä»¥å†™å®Œä¹‹åå¯¹æ¯”ä¸€ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">bsearch7</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> n, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">  <span class="type">int</span> <span class="variable">low</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">  <span class="type">int</span> <span class="variable">high</span> <span class="operator">=</span> n - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (low &lt;= high) &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span>  low + ((high - low) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (a[mid] &gt; value) &#123;</span><br><span class="line">      high = mid - <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> ((mid == n - <span class="number">1</span>) || (a[mid + <span class="number">1</span>] &gt; value)) <span class="keyword">return</span> mid;</span><br><span class="line">      <span class="keyword">else</span> low = mid + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è§£ç­”å¼€ç¯‡"><a href="#è§£ç­”å¼€ç¯‡" class="headerlink" title="è§£ç­”å¼€ç¯‡"></a>è§£ç­”å¼€ç¯‡</h2><p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å›å¤´æ¥çœ‹å¼€ç¯‡çš„é—®é¢˜ï¼šå¦‚ä½•å¿«é€Ÿå®šä½å‡ºä¸€ä¸ª IP åœ°å€çš„å½’å±åœ°ï¼Ÿ</p><p>ç°åœ¨è¿™ä¸ªé—®é¢˜åº”è¯¥å¾ˆç®€å•äº†ã€‚å¦‚æœ IP åŒºé—´ä¸å½’å±åœ°çš„å¯¹åº”å…³ç³»ä¸ç»å¸¸æ›´æ–°ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆé¢„å¤„ç†è¿™ 12 ä¸‡æ¡æ•°æ®ï¼Œè®©å…¶æŒ‰ç…§èµ·å§‹ IP ä»å°åˆ°å¤§æ’åºã€‚å¦‚ä½•æ¥æ’åºå‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ï¼ŒIP åœ°å€å¯ä»¥è½¬åŒ–ä¸º 32 ä½çš„æ•´å‹æ•°ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†èµ·å§‹åœ°å€ï¼ŒæŒ‰ç…§å¯¹åº”çš„æ•´å‹å€¼çš„å¤§å°å…³ç³»ï¼Œä»å°åˆ°å¤§è¿›è¡Œæ’åºã€‚</p><p>ç„¶åï¼Œè¿™ä¸ªé—®é¢˜å°±å¯ä»¥è½¬åŒ–ä¸ºæˆ‘åˆšè®²çš„ç¬¬å››ç§å˜å½¢é—®é¢˜â€œåœ¨æœ‰åºæ•°ç»„ä¸­ï¼ŒæŸ¥æ‰¾æœ€åä¸€ä¸ªå°äºç­‰äºæŸä¸ªç»™å®šå€¼çš„å…ƒç´ â€äº†ã€‚</p><p>å½“æˆ‘ä»¬è¦æŸ¥è¯¢æŸä¸ª IP å½’å±åœ°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆé€šè¿‡äºŒåˆ†æŸ¥æ‰¾ï¼Œæ‰¾åˆ°æœ€åä¸€ä¸ªèµ·å§‹ IP å°äºç­‰äºè¿™ä¸ª IP çš„ IP åŒºé—´ï¼Œç„¶åï¼Œæ£€æŸ¥è¿™ä¸ª IP æ˜¯å¦åœ¨è¿™ä¸ª IP åŒºé—´å†…ï¼Œå¦‚æœåœ¨ï¼Œæˆ‘ä»¬å°±å–å‡ºå¯¹åº”çš„å½’å±åœ°æ˜¾ç¤ºï¼›å¦‚æœä¸åœ¨ï¼Œå°±è¿”å›æœªæŸ¥æ‰¾åˆ°ã€‚</p><blockquote><p>å‡è®¾ æˆ‘ä»¬å°†åŒºé—´å¯¹è±¡æœ‰åºçš„å­˜å…¥ä¸€ä¸ªæ•°ç»„ arr [ (0-2),(3-5),(6-11) ,(12-15) ] ; æˆ‘ä»¬ç°åœ¨åªå…³æ³¨IPåŒºé—´å¯¹è±¡çš„æœ€å°å€¼ [ (0),(3),(6) ,(12) ] ; é‚£ä¹ˆï¼Œå€¼ num æ‰€åœ¨åŒºé—´çš„ä¸‹æ ‡kï¼Œ ä¸€å®šæ»¡è¶³ arr[k]&lt;&#x3D; num ä¸” arr[k+1] &gt; num ï¼› æ¢å¥è¯è¯´ ä¹Ÿå°±æ˜¯ æ±‚æœ€åä¸€ä¸ªå°äºæˆ–ç­‰äºnumçš„å…ƒç´ ä¸‹æ ‡äº†ã€‚</p></blockquote><h2 id="å†…å®¹å°ç»“"><a href="#å†…å®¹å°ç»“" class="headerlink" title="å†…å®¹å°ç»“"></a>å†…å®¹å°ç»“</h2><p>ä¸Šä¸€èŠ‚æˆ‘è¯´è¿‡ï¼Œå‡¡æ˜¯ç”¨äºŒåˆ†æŸ¥æ‰¾èƒ½è§£å†³çš„ï¼Œç»å¤§éƒ¨åˆ†æˆ‘ä»¬æ›´å€¾å‘äºç”¨æ•£åˆ—è¡¨æˆ–è€…äºŒå‰æŸ¥æ‰¾æ ‘ã€‚å³ä¾¿æ˜¯äºŒåˆ†æŸ¥æ‰¾åœ¨å†…å­˜ä½¿ç”¨ä¸Šæ›´èŠ‚çœï¼Œä½†æ˜¯æ¯•ç«Ÿå†…å­˜å¦‚æ­¤ç´§ç¼ºçš„æƒ…å†µå¹¶ä¸å¤šã€‚é‚£äºŒåˆ†æŸ¥æ‰¾çœŸçš„æ²¡ä»€ä¹ˆç”¨å¤„äº†å—ï¼Ÿ</p><p>å®é™…ä¸Šï¼Œä¸Šä¸€èŠ‚è®²çš„æ±‚â€œå€¼ç­‰äºç»™å®šå€¼â€çš„äºŒåˆ†æŸ¥æ‰¾ç¡®å®ä¸æ€ä¹ˆä¼šè¢«ç”¨åˆ°ï¼ŒäºŒåˆ†æŸ¥æ‰¾æ›´é€‚åˆç”¨åœ¨â€œè¿‘ä¼¼â€æŸ¥æ‰¾é—®é¢˜ï¼Œåœ¨è¿™ç±»é—®é¢˜ä¸Šï¼ŒäºŒåˆ†æŸ¥æ‰¾çš„ä¼˜åŠ¿æ›´åŠ æ˜æ˜¾ã€‚æ¯”å¦‚ä»Šå¤©è®²çš„è¿™å‡ ç§å˜ä½“é—®é¢˜ï¼Œç”¨å…¶ä»–æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚æ•£åˆ—è¡¨ã€äºŒå‰æ ‘ï¼Œå°±æ¯”è¾ƒéš¾å®ç°äº†ã€‚</p><p>å˜ä½“çš„äºŒåˆ†æŸ¥æ‰¾ç®—æ³•å†™èµ·æ¥éå¸¸çƒ§è„‘ï¼Œå¾ˆå®¹æ˜“å› ä¸ºç»†èŠ‚å¤„ç†ä¸å¥½è€Œäº§ç”Ÿ Bugï¼Œè¿™äº›å®¹æ˜“å‡ºé”™çš„ç»†èŠ‚æœ‰ï¼š<strong>ç»ˆæ­¢æ¡ä»¶ã€åŒºé—´ä¸Šä¸‹ç•Œæ›´æ–°æ–¹æ³•ã€è¿”å›å€¼é€‰æ‹©</strong>ã€‚æ‰€ä»¥ä»Šå¤©çš„å†…å®¹ä½ æœ€å¥½èƒ½ç”¨è‡ªå·±å®ç°ä¸€éï¼Œå¯¹é”»ç‚¼ç¼–ç èƒ½åŠ›ã€é€»è¾‘æ€ç»´ã€å†™å‡º Bug free ä»£ç ï¼Œä¼šå¾ˆæœ‰å¸®åŠ©ã€‚</p><h2 id="è¯¾åæ€è€ƒ"><a href="#è¯¾åæ€è€ƒ" class="headerlink" title="è¯¾åæ€è€ƒ"></a>è¯¾åæ€è€ƒ</h2><p>æˆ‘ä»¬ä»Šå¤©è®²çš„éƒ½æ˜¯éå¸¸è§„çš„äºŒåˆ†æŸ¥æ‰¾é—®é¢˜ï¼Œä»Šå¤©çš„æ€è€ƒé¢˜ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸è§„çš„äºŒåˆ†æŸ¥æ‰¾é—®é¢˜ã€‚å¦‚æœæœ‰åºæ•°ç»„æ˜¯ä¸€ä¸ªå¾ªç¯æœ‰åºæ•°ç»„ï¼Œæ¯”å¦‚ 4ï¼Œ5ï¼Œ6ï¼Œ1ï¼Œ2ï¼Œ3ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œå¦‚ä½•å®ç°ä¸€ä¸ªæ±‚â€œå€¼ç­‰äºç»™å®šå€¼â€çš„äºŒåˆ†æŸ¥æ‰¾ç®—æ³•å‘¢ï¼Ÿ</p><blockquote><p>æœ‰ä¸‰ç§æ–¹æ³•æŸ¥æ‰¾å¾ªç¯æœ‰åºæ•°ç»„</p><p> ä¸€ã€</p><ol><li>æ‰¾åˆ°åˆ†ç•Œä¸‹æ ‡ï¼Œåˆ†æˆä¸¤ä¸ªæœ‰åºæ•°ç»„</li><li>åˆ¤æ–­ç›®æ ‡å€¼åœ¨å“ªä¸ªæœ‰åºæ•°æ®èŒƒå›´å†…ï¼ŒåšäºŒåˆ†æŸ¥æ‰¾</li></ol><p> äºŒã€</p><ol><li>æ‰¾åˆ°æœ€å¤§å€¼çš„ä¸‹æ ‡ x;</li><li>æ‰€æœ‰å…ƒç´ ä¸‹æ ‡ +x åç§»ï¼Œè¶…è¿‡æ•°ç»„èŒƒå›´å€¼çš„å–æ¨¡;</li><li>åˆ©ç”¨åç§»åçš„ä¸‹æ ‡åšäºŒåˆ†æŸ¥æ‰¾ï¼›</li><li>å¦‚æœæ‰¾åˆ°ç›®æ ‡ä¸‹æ ‡ï¼Œå†ä½œ -x åç§»ï¼Œå°±æ˜¯ç›®æ ‡å€¼å®é™…ä¸‹æ ‡ã€‚</li></ol><p> ä¸¤ç§æƒ…å†µæœ€é«˜æ—¶è€—éƒ½åœ¨æŸ¥æ‰¾åˆ†ç•Œç‚¹ä¸Šï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦æ˜¯ O(Nï¼‰ã€‚</p><p> å¤æ‚åº¦æœ‰ç‚¹é«˜ï¼Œèƒ½å¦ä¼˜åŒ–å‘¢ï¼Ÿ</p><p> ä¸‰ã€<br>æˆ‘ä»¬å‘ç°å¾ªç¯æ•°ç»„å­˜åœ¨ä¸€ä¸ªæ€§è´¨ï¼šä»¥æ•°ç»„ä¸­é—´ç‚¹ä¸ºåˆ†åŒºï¼Œä¼šå°†æ•°ç»„åˆ†æˆä¸€ä¸ªæœ‰åºæ•°ç»„å’Œä¸€ä¸ªå¾ªç¯æœ‰åºæ•°ç»„ã€‚</p><p> å¦‚æœé¦–å…ƒç´ å°äº midï¼Œè¯´æ˜å‰åŠéƒ¨åˆ†æ˜¯æœ‰åºçš„ï¼ŒååŠéƒ¨åˆ†æ˜¯å¾ªç¯æœ‰åºæ•°ç»„ï¼›<br> å¦‚æœé¦–å…ƒç´ å¤§äº midï¼Œè¯´æ˜ååŠéƒ¨åˆ†æ˜¯æœ‰åºçš„ï¼Œå‰åŠéƒ¨åˆ†æ˜¯å¾ªç¯æœ‰åºçš„æ•°ç»„ï¼›<br> å¦‚æœç›®æ ‡å…ƒç´ åœ¨æœ‰åºæ•°ç»„èŒƒå›´ä¸­ï¼Œä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼›<br> å¦‚æœç›®æ ‡å…ƒç´ åœ¨å¾ªç¯æœ‰åºæ•°ç»„ä¸­ï¼Œè®¾å®šæ•°ç»„è¾¹ç•Œåï¼Œä½¿ç”¨ä»¥ä¸Šæ–¹æ³•ç»§ç»­æŸ¥æ‰¾ã€‚</p><p> æ—¶é—´å¤æ‚åº¦ä¸º O(logN)ã€‚</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>15è®² | äºŒåˆ†æŸ¥æ‰¾ï¼ˆä¸Šï¼‰</title>
      <link href="/posts/65beee21.html"/>
      <url>/posts/65beee21.html</url>
      
        <content type="html"><![CDATA[<hr><h1 id="15-äºŒåˆ†æŸ¥æ‰¾ï¼ˆä¸Šï¼‰ï¼šå¦‚ä½•ç”¨æœ€çœå†…å­˜çš„æ–¹å¼å®ç°å¿«é€ŸæŸ¥æ‰¾åŠŸèƒ½ï¼Ÿ"><a href="#15-äºŒåˆ†æŸ¥æ‰¾ï¼ˆä¸Šï¼‰ï¼šå¦‚ä½•ç”¨æœ€çœå†…å­˜çš„æ–¹å¼å®ç°å¿«é€ŸæŸ¥æ‰¾åŠŸèƒ½ï¼Ÿ" class="headerlink" title="15 | äºŒåˆ†æŸ¥æ‰¾ï¼ˆä¸Šï¼‰ï¼šå¦‚ä½•ç”¨æœ€çœå†…å­˜çš„æ–¹å¼å®ç°å¿«é€ŸæŸ¥æ‰¾åŠŸèƒ½ï¼Ÿ"></a>15 | äºŒåˆ†æŸ¥æ‰¾ï¼ˆä¸Šï¼‰ï¼šå¦‚ä½•ç”¨æœ€çœå†…å­˜çš„æ–¹å¼å®ç°å¿«é€ŸæŸ¥æ‰¾åŠŸèƒ½ï¼Ÿ</h1><h2 id="æ— å¤„ä¸åœ¨çš„äºŒåˆ†æ€æƒ³"><a href="#æ— å¤„ä¸åœ¨çš„äºŒåˆ†æ€æƒ³" class="headerlink" title="æ— å¤„ä¸åœ¨çš„äºŒåˆ†æ€æƒ³"></a>æ— å¤„ä¸åœ¨çš„äºŒåˆ†æ€æƒ³</h2><p><strong>äºŒåˆ†æŸ¥æ‰¾é’ˆå¯¹çš„æ˜¯ä¸€ä¸ªæœ‰åºçš„æ•°æ®é›†åˆï¼ŒæŸ¥æ‰¾æ€æƒ³æœ‰ç‚¹ç±»ä¼¼åˆ†æ²»æ€æƒ³ã€‚æ¯æ¬¡éƒ½é€šè¿‡è·ŸåŒºé—´çš„ä¸­é—´å…ƒç´ å¯¹æ¯”ï¼Œå°†å¾…æŸ¥æ‰¾çš„åŒºé—´ç¼©å°ä¸ºä¹‹å‰çš„ä¸€åŠï¼Œç›´åˆ°æ‰¾åˆ°è¦æŸ¥æ‰¾çš„å…ƒç´ ï¼Œæˆ–è€…åŒºé—´è¢«ç¼©å°ä¸º 0</strong>ã€‚</p><h2 id="äºŒåˆ†æŸ¥æ‰¾çš„é€’å½’ä¸éé€’å½’å®ç°"><a href="#äºŒåˆ†æŸ¥æ‰¾çš„é€’å½’ä¸éé€’å½’å®ç°" class="headerlink" title="äºŒåˆ†æŸ¥æ‰¾çš„é€’å½’ä¸éé€’å½’å®ç°"></a>äºŒåˆ†æŸ¥æ‰¾çš„é€’å½’ä¸éé€’å½’å®ç°</h2><p><strong>æœ€ç®€å•çš„æƒ…å†µ</strong>å°±æ˜¯æœ‰åºæ•°ç»„ä¸­<strong>ä¸å­˜åœ¨é‡å¤å…ƒç´ </strong>ï¼Œæˆ‘ä»¬åœ¨å…¶ä¸­ç”¨äºŒåˆ†æŸ¥æ‰¾å€¼ç­‰äºç»™å®šå€¼çš„æ•°æ®ã€‚æˆ‘ç”¨ Java ä»£ç å®ç°äº†ä¸€ä¸ªæœ€ç®€å•çš„äºŒåˆ†æŸ¥æ‰¾ç®—æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">bsearch</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> n, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">  <span class="type">int</span> <span class="variable">low</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">  <span class="type">int</span> <span class="variable">high</span> <span class="operator">=</span> n - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (low &lt;= high) &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> (low + high) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (a[mid] == value) &#123;</span><br><span class="line">      <span class="keyword">return</span> mid;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a[mid] &lt; value) &#123;</span><br><span class="line">      low = mid + <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      high = mid - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä»£ç æˆ‘ç¨å¾®è§£é‡Šä¸€ä¸‹ï¼Œlowã€highã€mid éƒ½æ˜¯æŒ‡æ•°ç»„ä¸‹æ ‡ï¼Œå…¶ä¸­ low å’Œ high è¡¨ç¤ºå½“å‰æŸ¥æ‰¾çš„åŒºé—´èŒƒå›´ï¼Œåˆå§‹ low&#x3D;0ï¼Œ high&#x3D;n-1ã€‚mid è¡¨ç¤º[low, high]çš„ä¸­é—´ä½ç½®ã€‚æˆ‘ä»¬é€šè¿‡å¯¹æ¯” a[mid]ä¸ value çš„å¤§å°ï¼Œæ¥æ›´æ–°æ¥ä¸‹æ¥è¦æŸ¥æ‰¾çš„åŒºé—´èŒƒå›´ï¼Œç›´åˆ°æ‰¾åˆ°æˆ–è€…åŒºé—´ç¼©å°ä¸º 0ï¼Œå°±é€€å‡ºã€‚å¦‚æœä½ æœ‰ä¸€äº›ç¼–ç¨‹åŸºç¡€ï¼Œçœ‹æ‡‚è¿™äº›åº”è¯¥ä¸æˆé—®é¢˜ã€‚ç°åœ¨ï¼Œæˆ‘å°±ç€é‡å¼ºè°ƒä¸€ä¸‹<strong>å®¹æ˜“å‡ºé”™çš„ 3 ä¸ªåœ°æ–¹</strong>ã€‚</p><p><strong>1.å¾ªç¯é€€å‡ºæ¡ä»¶</strong></p><p>æ³¨æ„æ˜¯ low&lt;&#x3D;highï¼Œè€Œä¸æ˜¯ low&lt;highã€‚</p><p><strong>2.mid çš„å–å€¼</strong></p><p>å®é™…ä¸Šï¼Œmid&#x3D;(low+high)&#x2F;2 è¿™ç§å†™æ³•æ˜¯æœ‰é—®é¢˜çš„ã€‚å› ä¸ºå¦‚æœ low å’Œ high æ¯”è¾ƒå¤§çš„è¯ï¼Œä¸¤è€…ä¹‹å’Œå°±æœ‰å¯èƒ½ä¼šæº¢å‡ºã€‚æ”¹è¿›çš„æ–¹æ³•æ˜¯å°† mid çš„è®¡ç®—æ–¹å¼å†™æˆ low+(high-low)&#x2F;2ã€‚æ›´è¿›ä¸€æ­¥ï¼Œå¦‚æœè¦å°†æ€§èƒ½ä¼˜åŒ–åˆ°æè‡´çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™é‡Œçš„é™¤ä»¥ 2 æ“ä½œè½¬åŒ–æˆä½è¿ç®— low+((high-low)&gt;&gt;1)ã€‚å› ä¸ºç›¸æ¯”é™¤æ³•è¿ç®—æ¥è¯´ï¼Œè®¡ç®—æœºå¤„ç†ä½è¿ç®—è¦å¿«å¾—å¤šã€‚</p><p><strong>3.low å’Œ high çš„æ›´æ–°</strong></p><p>low&#x3D;mid+1ï¼Œhigh&#x3D;mid-1ã€‚æ³¨æ„è¿™é‡Œçš„ +1 å’Œ -1ï¼Œå¦‚æœç›´æ¥å†™æˆ low&#x3D;mid æˆ–è€… high&#x3D;midï¼Œå°±å¯èƒ½ä¼šå‘ç”Ÿæ­»å¾ªç¯ã€‚æ¯”å¦‚ï¼Œå½“ high&#x3D;3ï¼Œlow&#x3D;3 æ—¶ï¼Œå¦‚æœ a[3]ä¸ç­‰äº valueï¼Œå°±ä¼šå¯¼è‡´ä¸€ç›´å¾ªç¯ä¸é€€å‡ºã€‚</p><p>å¦‚æœä½ ç•™æ„æˆ‘åˆšè®²çš„è¿™ä¸‰ç‚¹ï¼Œæˆ‘æƒ³ä¸€ä¸ªç®€å•çš„äºŒåˆ†æŸ¥æ‰¾ä½ å·²ç»å¯ä»¥å®ç°äº†ã€‚<strong>å®é™…ä¸Šï¼ŒäºŒåˆ†æŸ¥æ‰¾é™¤äº†ç”¨å¾ªç¯æ¥å®ç°ï¼Œè¿˜å¯ä»¥ç”¨é€’å½’æ¥å®ç°</strong>ï¼Œè¿‡ç¨‹ä¹Ÿéå¸¸ç®€å•ã€‚</p><p>æˆ‘ç”¨ Java è¯­è¨€å®ç°äº†ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼Œæ­£å¥½ä½ å¯ä»¥å€Ÿæ­¤æœºä¼šå›é¡¾ä¸€ä¸‹å†™é€’å½’ä»£ç çš„æŠ€å·§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// äºŒåˆ†æŸ¥æ‰¾çš„é€’å½’å®ç°</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">bsearch</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> n, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> bsearchInternally(a, <span class="number">0</span>, n - <span class="number">1</span>, val);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="title function_">bsearchInternally</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> low, <span class="type">int</span> high, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (low &gt; high) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span>  low + ((high - low) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">if</span> (a[mid] == value) &#123;</span><br><span class="line">    <span class="keyword">return</span> mid;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a[mid] &lt; value) &#123;</span><br><span class="line">    <span class="keyword">return</span> bsearchInternally(a, mid+<span class="number">1</span>, high, value);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> bsearchInternally(a, low, mid-<span class="number">1</span>, value);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="äºŒåˆ†æŸ¥æ‰¾åº”ç”¨åœºæ™¯çš„å±€é™æ€§"><a href="#äºŒåˆ†æŸ¥æ‰¾åº”ç”¨åœºæ™¯çš„å±€é™æ€§" class="headerlink" title="äºŒåˆ†æŸ¥æ‰¾åº”ç”¨åœºæ™¯çš„å±€é™æ€§"></a>äºŒåˆ†æŸ¥æ‰¾åº”ç”¨åœºæ™¯çš„å±€é™æ€§</h2><p>å‰é¢æˆ‘ä»¬åˆ†æè¿‡ï¼ŒäºŒåˆ†æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(logn)ï¼ŒæŸ¥æ‰¾æ•°æ®çš„æ•ˆç‡éå¸¸é«˜ã€‚ä¸è¿‡ï¼Œå¹¶ä¸æ˜¯ä»€ä¹ˆæƒ…å†µä¸‹éƒ½å¯ä»¥ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œå®ƒçš„åº”ç”¨åœºæ™¯æ˜¯æœ‰å¾ˆå¤§å±€é™æ€§çš„ã€‚é‚£ä»€ä¹ˆæƒ…å†µä¸‹é€‚åˆç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œä»€ä¹ˆæƒ…å†µä¸‹ä¸é€‚åˆå‘¢ï¼Ÿ</p><p><strong>é¦–å…ˆï¼ŒäºŒåˆ†æŸ¥æ‰¾ä¾èµ–çš„æ˜¯é¡ºåºè¡¨ç»“æ„ï¼Œç®€å•ç‚¹è¯´å°±æ˜¯æ•°ç»„</strong>ã€‚</p><p>é‚£äºŒåˆ†æŸ¥æ‰¾èƒ½å¦ä¾èµ–å…¶ä»–æ•°æ®ç»“æ„å‘¢ï¼Ÿæ¯”å¦‚é“¾è¡¨ã€‚ç­”æ¡ˆæ˜¯ä¸å¯ä»¥çš„ï¼Œä¸»è¦åŸå› æ˜¯äºŒåˆ†æŸ¥æ‰¾ç®—æ³•éœ€è¦æŒ‰ç…§ä¸‹æ ‡éšæœºè®¿é—®å…ƒç´ ã€‚æˆ‘ä»¬åœ¨æ•°ç»„å’Œé“¾è¡¨é‚£ä¸¤èŠ‚è®²è¿‡ï¼Œæ•°ç»„æŒ‰ç…§ä¸‹æ ‡éšæœºè®¿é—®æ•°æ®çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ï¼Œè€Œé“¾è¡¨éšæœºè®¿é—®çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚æ‰€ä»¥ï¼Œå¦‚æœæ•°æ®ä½¿ç”¨é“¾è¡¨å­˜å‚¨ï¼ŒäºŒåˆ†æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚å°±ä¼šå˜å¾—å¾ˆé«˜ã€‚</p><p>äºŒåˆ†æŸ¥æ‰¾åªèƒ½ç”¨åœ¨æ•°æ®æ˜¯é€šè¿‡é¡ºåºè¡¨æ¥å­˜å‚¨çš„æ•°æ®ç»“æ„ä¸Šã€‚å¦‚æœä½ çš„æ•°æ®æ˜¯é€šè¿‡å…¶ä»–æ•°æ®ç»“æ„å­˜å‚¨çš„ï¼Œåˆ™æ— æ³•åº”ç”¨äºŒåˆ†æŸ¥æ‰¾ã€‚</p><p><strong>å…¶æ¬¡ï¼ŒäºŒåˆ†æŸ¥æ‰¾é’ˆå¯¹çš„æ˜¯æœ‰åºæ•°æ®ã€‚</strong></p><p>äºŒåˆ†æŸ¥æ‰¾å¯¹è¿™ä¸€ç‚¹çš„è¦æ±‚æ¯”è¾ƒè‹›åˆ»ï¼Œæ•°æ®å¿…é¡»æ˜¯æœ‰åºçš„ã€‚å¦‚æœæ•°æ®æ²¡æœ‰åºï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ’åºã€‚å‰é¢ç« èŠ‚é‡Œæˆ‘ä»¬è®²åˆ°ï¼Œæ’åºçš„æ—¶é—´å¤æ‚åº¦æœ€ä½æ˜¯ O(nlogn)ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬é’ˆå¯¹çš„æ˜¯ä¸€ç»„é™æ€çš„æ•°æ®ï¼Œæ²¡æœ‰é¢‘ç¹åœ°æ’å…¥ã€åˆ é™¤ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œä¸€æ¬¡æ’åºï¼Œå¤šæ¬¡äºŒåˆ†æŸ¥æ‰¾ã€‚è¿™æ ·æ’åºçš„æˆæœ¬å¯è¢«å‡æ‘Šï¼ŒäºŒåˆ†æŸ¥æ‰¾çš„è¾¹é™…æˆæœ¬å°±ä¼šæ¯”è¾ƒä½ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬çš„æ•°æ®é›†åˆæœ‰é¢‘ç¹çš„æ’å…¥å’Œåˆ é™¤æ“ä½œï¼Œè¦æƒ³ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œè¦ä¹ˆæ¯æ¬¡æ’å…¥ã€åˆ é™¤æ“ä½œä¹‹åä¿è¯æ•°æ®ä»ç„¶æœ‰åºï¼Œè¦ä¹ˆåœ¨æ¯æ¬¡äºŒåˆ†æŸ¥æ‰¾ä¹‹å‰éƒ½å…ˆè¿›è¡Œæ’åºã€‚é’ˆå¯¹è¿™ç§åŠ¨æ€æ•°æ®é›†åˆï¼Œæ— è®ºå“ªç§æ–¹æ³•ï¼Œç»´æŠ¤æœ‰åºçš„æˆæœ¬éƒ½æ˜¯å¾ˆé«˜çš„ã€‚</p><p>æ‰€ä»¥ï¼ŒäºŒåˆ†æŸ¥æ‰¾åªèƒ½ç”¨åœ¨æ’å…¥ã€åˆ é™¤æ“ä½œä¸é¢‘ç¹ï¼Œä¸€æ¬¡æ’åºå¤šæ¬¡æŸ¥æ‰¾çš„åœºæ™¯ä¸­ã€‚é’ˆå¯¹åŠ¨æ€å˜åŒ–çš„æ•°æ®é›†åˆï¼ŒäºŒåˆ†æŸ¥æ‰¾å°†ä¸å†é€‚ç”¨ã€‚é‚£é’ˆå¯¹åŠ¨æ€æ•°æ®é›†åˆï¼Œå¦‚ä½•åœ¨å…¶ä¸­å¿«é€ŸæŸ¥æ‰¾æŸä¸ªæ•°æ®å‘¢ï¼Ÿåˆ«æ€¥ï¼Œç­‰åˆ°äºŒå‰æ ‘é‚£ä¸€èŠ‚æˆ‘ä¼šè¯¦ç»†è®²ã€‚</p><p><strong>å†æ¬¡ï¼Œæ•°æ®é‡å¤ªå°ä¸é€‚åˆäºŒåˆ†æŸ¥æ‰¾ã€‚</strong></p><p>å¦‚æœè¦å¤„ç†çš„æ•°æ®é‡å¾ˆå°ï¼Œå®Œå…¨æ²¡æœ‰å¿…è¦ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œé¡ºåºéå†å°±è¶³å¤Ÿäº†ã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨ä¸€ä¸ªå¤§å°ä¸º 10 çš„æ•°ç»„ä¸­æŸ¥æ‰¾ä¸€ä¸ªå…ƒç´ ï¼Œä¸ç®¡ç”¨äºŒåˆ†æŸ¥æ‰¾è¿˜æ˜¯é¡ºåºéå†ï¼ŒæŸ¥æ‰¾é€Ÿåº¦éƒ½å·®ä¸å¤šã€‚åªæœ‰æ•°æ®é‡æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼ŒäºŒåˆ†æŸ¥æ‰¾çš„ä¼˜åŠ¿æ‰ä¼šæ¯”è¾ƒæ˜æ˜¾ã€‚</p><p>ä¸è¿‡ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å¤–ã€‚å¦‚æœæ•°æ®ä¹‹é—´çš„æ¯”è¾ƒæ“ä½œéå¸¸è€—æ—¶ï¼Œä¸ç®¡æ•°æ®é‡å¤§å°ï¼Œæˆ‘éƒ½æ¨èä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ã€‚æ¯”å¦‚ï¼Œæ•°ç»„ä¸­å­˜å‚¨çš„éƒ½æ˜¯é•¿åº¦è¶…è¿‡ 300 çš„å­—ç¬¦ä¸²ï¼Œå¦‚æ­¤é•¿çš„ä¸¤ä¸ªå­—ç¬¦ä¸²ä¹‹é—´æ¯”å¯¹å¤§å°ï¼Œå°±ä¼šéå¸¸è€—æ—¶ã€‚æˆ‘ä»¬éœ€è¦å°½å¯èƒ½åœ°å‡å°‘æ¯”è¾ƒæ¬¡æ•°ï¼Œè€Œæ¯”è¾ƒæ¬¡æ•°çš„å‡å°‘ä¼šå¤§å¤§æé«˜æ€§èƒ½ï¼Œè¿™ä¸ªæ—¶å€™äºŒåˆ†æŸ¥æ‰¾å°±æ¯”é¡ºåºéå†æ›´æœ‰ä¼˜åŠ¿ã€‚</p><p><strong>æœ€åï¼Œæ•°æ®é‡å¤ªå¤§ä¹Ÿä¸é€‚åˆäºŒåˆ†æŸ¥æ‰¾ã€‚</strong></p><p>äºŒåˆ†æŸ¥æ‰¾çš„åº•å±‚éœ€è¦ä¾èµ–æ•°ç»„è¿™ç§æ•°æ®ç»“æ„ï¼Œè€Œæ•°ç»„ä¸ºäº†æ”¯æŒéšæœºè®¿é—®çš„ç‰¹æ€§ï¼Œè¦æ±‚å†…å­˜ç©ºé—´è¿ç»­ï¼Œå¯¹å†…å­˜çš„è¦æ±‚æ¯”è¾ƒè‹›åˆ»ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬æœ‰ 1GB å¤§å°çš„æ•°æ®ï¼Œå¦‚æœå¸Œæœ›ç”¨æ•°ç»„æ¥å­˜å‚¨ï¼Œé‚£å°±éœ€è¦ 1GB çš„è¿ç»­å†…å­˜ç©ºé—´ã€‚</p><p>æ³¨æ„è¿™é‡Œçš„â€œè¿ç»­â€äºŒå­—ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä¾¿æœ‰ 2GB çš„å†…å­˜ç©ºé—´å‰©ä½™ï¼Œä½†æ˜¯å¦‚æœè¿™å‰©ä½™çš„ 2GB å†…å­˜ç©ºé—´éƒ½æ˜¯é›¶æ•£çš„ï¼Œæ²¡æœ‰è¿ç»­çš„ 1GB å¤§å°çš„å†…å­˜ç©ºé—´ï¼Œé‚£ç…§æ ·æ— æ³•ç”³è¯·ä¸€ä¸ª 1GB å¤§å°çš„æ•°ç»„ã€‚è€Œæˆ‘ä»¬çš„äºŒåˆ†æŸ¥æ‰¾æ˜¯ä½œç”¨åœ¨æ•°ç»„è¿™ç§æ•°æ®ç»“æ„ä¹‹ä¸Šçš„ï¼Œæ‰€ä»¥å¤ªå¤§çš„æ•°æ®ç”¨æ•°ç»„å­˜å‚¨å°±æ¯”è¾ƒåƒåŠ›äº†ï¼Œä¹Ÿå°±ä¸èƒ½ç”¨äºŒåˆ†æŸ¥æ‰¾äº†ã€‚</p><h2 id="å†…å®¹å°ç»“"><a href="#å†…å®¹å°ç»“" class="headerlink" title="å†…å®¹å°ç»“"></a>å†…å®¹å°ç»“</h2><p>ä»Šå¤©æˆ‘ä»¬å­¦ä¹ äº†ä¸€ç§é’ˆå¯¹æœ‰åºæ•°æ®çš„é«˜æ•ˆæŸ¥æ‰¾ç®—æ³•ï¼ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œå®ƒçš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(logn)ã€‚</p><p>äºŒåˆ†æŸ¥æ‰¾çš„æ ¸å¿ƒæ€æƒ³ç†è§£èµ·æ¥éå¸¸ç®€å•ï¼Œæœ‰ç‚¹ç±»ä¼¼åˆ†æ²»æ€æƒ³ã€‚å³æ¯æ¬¡éƒ½é€šè¿‡è·ŸåŒºé—´ä¸­çš„ä¸­é—´å…ƒç´ å¯¹æ¯”ï¼Œå°†å¾…æŸ¥æ‰¾çš„åŒºé—´ç¼©å°ä¸ºä¸€åŠï¼Œç›´åˆ°æ‰¾åˆ°è¦æŸ¥æ‰¾çš„å…ƒç´ ï¼Œæˆ–è€…åŒºé—´è¢«ç¼©å°ä¸º 0ã€‚ä½†æ˜¯äºŒåˆ†æŸ¥æ‰¾çš„ä»£ç å®ç°æ¯”è¾ƒå®¹æ˜“å†™é”™ã€‚ä½ éœ€è¦ç€é‡æŒæ¡å®ƒçš„ä¸‰ä¸ªå®¹æ˜“å‡ºé”™çš„åœ°æ–¹ï¼šå¾ªç¯é€€å‡ºæ¡ä»¶ã€mid çš„å–å€¼ï¼Œlow å’Œ high çš„æ›´æ–°ã€‚</p><p>äºŒåˆ†æŸ¥æ‰¾è™½ç„¶æ€§èƒ½æ¯”è¾ƒä¼˜ç§€ï¼Œä½†åº”ç”¨åœºæ™¯ä¹Ÿæ¯”è¾ƒæœ‰é™ã€‚åº•å±‚å¿…é¡»ä¾èµ–æ•°ç»„ï¼Œå¹¶ä¸”è¿˜è¦æ±‚æ•°æ®æ˜¯æœ‰åºçš„ã€‚å¯¹äºè¾ƒå°è§„æ¨¡çš„æ•°æ®æŸ¥æ‰¾ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨é¡ºåºéå†å°±å¯ä»¥äº†ï¼ŒäºŒåˆ†æŸ¥æ‰¾çš„ä¼˜åŠ¿å¹¶ä¸æ˜æ˜¾ã€‚äºŒåˆ†æŸ¥æ‰¾æ›´é€‚åˆå¤„ç†é™æ€æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰é¢‘ç¹çš„æ•°æ®æ’å…¥ã€åˆ é™¤æ“ä½œã€‚</p><h2 id="è¯¾åæ€è€ƒ"><a href="#è¯¾åæ€è€ƒ" class="headerlink" title="è¯¾åæ€è€ƒ"></a>è¯¾åæ€è€ƒ</h2><ol><li><p>å¦‚ä½•ç¼–ç¨‹å®ç°â€œæ±‚ä¸€ä¸ªæ•°çš„å¹³æ–¹æ ¹â€ï¼Ÿè¦æ±‚ç²¾ç¡®åˆ°å°æ•°ç‚¹å 6 ä½ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Sqrt</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Sqrt</span> <span class="variable">sqrt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Sqrt</span>();</span><br><span class="line">        <span class="type">double</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line">        <span class="type">double</span> <span class="variable">num</span> <span class="operator">=</span> sqrt.sqrt(a, <span class="number">0.000001</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç®—æ³•ç»“æœï¼š&quot;</span> + num);</span><br><span class="line">        System.out.println(<span class="string">&quot;å®é™…ç»“æœï¼š&quot;</span> + Math.sqrt(a));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">sqrt</span><span class="params">(<span class="type">double</span> a, <span class="type">double</span> precision)</span> &#123;</span><br><span class="line">        <span class="type">double</span> low, high, mid, tmp;</span><br><span class="line">        <span class="keyword">if</span> (a &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            low = <span class="number">1</span>;</span><br><span class="line">            high = a;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            low = a;</span><br><span class="line">            high = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (low &lt;= high) &#123;</span><br><span class="line">            mid = (low + high) / <span class="number">2.000</span>;</span><br><span class="line">            tmp = mid * mid;</span><br><span class="line">            <span class="comment">// å¦‚æœå½“å‰æ±‚å¾—çš„å¹³æ–¹æ ¹åœ¨target+0.000001å’Œtarget-0.000001ä¹‹é—´ï¼Œé‚£ä¹ˆè¿”å›mid</span></span><br><span class="line">            <span class="keyword">if</span> (tmp &lt; a + precision &amp;&amp; tmp &gt;= a - precision) &#123;</span><br><span class="line">                <span class="keyword">return</span> mid;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tmp &gt; a) &#123;</span><br><span class="line">                high = mid;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                low = mid;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1.000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æˆ‘åˆšæ‰è¯´äº†ï¼Œå¦‚æœæ•°æ®ä½¿ç”¨é“¾è¡¨å­˜å‚¨ï¼ŒäºŒåˆ†æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚å°±ä¼šå˜å¾—å¾ˆé«˜ï¼Œé‚£æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦ç©¶ç«Ÿæ˜¯å¤šå°‘å‘¢ï¼Ÿå¦‚æœä½ è‡ªå·±æ¨å¯¼ä¸€ä¸‹ï¼Œä½ å°±ä¼šæ·±åˆ»åœ°è®¤è¯†åˆ°ï¼Œä¸ºä½•æˆ‘ä»¬ä¼šé€‰æ‹©ç”¨æ•°ç»„è€Œä¸æ˜¯é“¾è¡¨æ¥å®ç°äºŒåˆ†æŸ¥æ‰¾äº†ã€‚</p><blockquote><p>å‡è®¾é“¾è¡¨é•¿åº¦ä¸ºnï¼ŒäºŒåˆ†æŸ¥æ‰¾æ¯æ¬¡éƒ½è¦æ‰¾åˆ°ä¸­é—´ç‚¹(è®¡ç®—ä¸­å¿½ç•¥å¥‡å¶æ•°å·®å¼‚):<br>ç¬¬ä¸€æ¬¡æŸ¥æ‰¾ä¸­é—´ç‚¹ï¼Œéœ€è¦ç§»åŠ¨æŒ‡é’ˆn&#x2F;2æ¬¡ï¼›<br>ç¬¬äºŒæ¬¡ï¼Œéœ€è¦ç§»åŠ¨æŒ‡é’ˆn&#x2F;4æ¬¡ï¼›<br>ç¬¬ä¸‰æ¬¡éœ€è¦ç§»åŠ¨æŒ‡é’ˆn&#x2F;8æ¬¡ï¼›<br>â€¦â€¦<br>ä»¥æ­¤ç±»æ¨ï¼Œä¸€ç›´åˆ°1æ¬¡ä¸ºå€¼</p><p>æ€»å…±æŒ‡é’ˆç§»åŠ¨æ¬¡æ•°(æŸ¥æ‰¾æ¬¡æ•°) &#x3D; n&#x2F;2 + n&#x2F;4 + n&#x2F;8 + â€¦+ 1ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸ªç­‰æ¯”æ•°åˆ—ï¼Œæ ¹æ®ç­‰æ¯”æ•°åˆ—æ±‚å’Œå…¬å¼ï¼šSum &#x3D; n - 1.</p><p>æœ€åç®—æ³•æ—¶é—´å¤æ‚åº¦æ˜¯ï¼šO(n-1)ï¼Œå¿½ç•¥å¸¸æ•°ï¼Œè®°ä¸ºO(n)ï¼Œæ—¶é—´å¤æ‚åº¦å’Œé¡ºåºæŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦ç›¸åŒ</p><p>ä½†æ˜¯ç¨å¾®æ€è€ƒä¸‹ï¼Œåœ¨äºŒåˆ†æŸ¥æ‰¾çš„æ—¶å€™ï¼Œç”±äºè¦è¿›è¡Œå¤šä½™çš„è¿ç®—ï¼Œä¸¥æ ¼æ¥è¯´ï¼Œä¼šæ¯”é¡ºåºæŸ¥æ‰¾æ—¶é—´æ…¢</p></blockquote></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>20è®²</title>
      <link href="/posts/5ff22685.html"/>
      <url>/posts/5ff22685.html</url>
      
        <content type="html"><![CDATA[<hr><h1 id="20-å¹»è¯»æ˜¯ä»€ä¹ˆï¼Œå¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#20-å¹»è¯»æ˜¯ä»€ä¹ˆï¼Œå¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="20 | å¹»è¯»æ˜¯ä»€ä¹ˆï¼Œå¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a>20 | å¹»è¯»æ˜¯ä»€ä¹ˆï¼Œå¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h1><p>ä¸ºäº†ä¾¿äºè¯´æ˜é—®é¢˜ï¼Œè¿™ä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°±å…ˆä½¿ç”¨ä¸€ä¸ªå°ä¸€ç‚¹å„¿çš„è¡¨ã€‚å»ºè¡¨å’Œåˆå§‹åŒ–è¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `t` (</span><br><span class="line">  `id` int(11) NOT NULL,</span><br><span class="line">  `c` int(11) DEFAULT NULL,</span><br><span class="line">  `d` int(11) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  KEY `c` (`c`)</span><br><span class="line">) ENGINE=InnoDB;</span><br><span class="line"></span><br><span class="line">insert into t values(0,0,0),(5,5,5),</span><br><span class="line">(10,10,10),(15,15,15),(20,20,20),(25,25,25);</span><br></pre></td></tr></table></figure><h2 id="å¹»è¯»æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#å¹»è¯»æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="å¹»è¯»æ˜¯ä»€ä¹ˆï¼Ÿ"></a>å¹»è¯»æ˜¯ä»€ä¹ˆï¼Ÿ</h2>]]></content>
      
      
      
        <tags>
            
            <tag> MySQLå®æˆ˜45è®² </tag>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>02è®²</title>
      <link href="/posts/8f3bbd6e.html"/>
      <url>/posts/8f3bbd6e.html</url>
      
        <content type="html"><![CDATA[<hr><h1 id="21-ä¸ºä»€ä¹ˆæˆ‘åªæ”¹ä¸€è¡Œçš„è¯­å¥ï¼Œé”è¿™ä¹ˆå¤šï¼Ÿ"><a href="#21-ä¸ºä»€ä¹ˆæˆ‘åªæ”¹ä¸€è¡Œçš„è¯­å¥ï¼Œé”è¿™ä¹ˆå¤šï¼Ÿ" class="headerlink" title="21 | ä¸ºä»€ä¹ˆæˆ‘åªæ”¹ä¸€è¡Œçš„è¯­å¥ï¼Œé”è¿™ä¹ˆå¤šï¼Ÿ"></a>21 | ä¸ºä»€ä¹ˆæˆ‘åªæ”¹ä¸€è¡Œçš„è¯­å¥ï¼Œé”è¿™ä¹ˆå¤šï¼Ÿ</h1><h2 id="é—´éš™é”å’Œnext-lock-keyåŠ é”åŸåˆ™"><a href="#é—´éš™é”å’Œnext-lock-keyåŠ é”åŸåˆ™" class="headerlink" title="é—´éš™é”å’Œnext-lock keyåŠ é”åŸåˆ™"></a>é—´éš™é”å’Œnext-lock keyåŠ é”åŸåˆ™</h2><p>å› ä¸ºé—´éš™é”åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹æ‰æœ‰æ•ˆï¼Œæ‰€ä»¥æœ¬ç¯‡æ–‡ç« æ¥ä¸‹æ¥çš„æè¿°ï¼Œè‹¥æ²¡æœ‰ç‰¹æ®Šè¯´æ˜ï¼Œé»˜è®¤æ˜¯å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ã€‚</p><p><strong>æˆ‘æ€»ç»“çš„åŠ é”è§„åˆ™é‡Œé¢ï¼ŒåŒ…å«äº†ä¸¤ä¸ªâ€œåŸåˆ™â€ã€ä¸¤ä¸ªâ€œä¼˜åŒ–â€å’Œä¸€ä¸ªâ€œbugâ€ã€‚</strong></p><ol><li>åŸåˆ™ 1ï¼šåŠ é”çš„åŸºæœ¬å•ä½æ˜¯ next-key lockã€‚å¸Œæœ›ä½ è¿˜è®°å¾—ï¼Œnext-key lock æ˜¯å‰å¼€åé—­åŒºé—´ã€‚</li><li>åŸåˆ™ 2ï¼šæŸ¥æ‰¾è¿‡ç¨‹ä¸­è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”ã€‚</li><li>ä¼˜åŒ– 1ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œç»™å”¯ä¸€ç´¢å¼•åŠ é”çš„æ—¶å€™ï¼Œnext-key lock é€€åŒ–ä¸ºè¡Œé”ã€‚</li><li>ä¼˜åŒ– 2ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œå‘å³éå†æ—¶ä¸”æœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³ç­‰å€¼æ¡ä»¶çš„æ—¶å€™ï¼Œnext-key lock é€€åŒ–ä¸ºé—´éš™é”ã€‚</li><li>ä¸€ä¸ª bugï¼šå”¯ä¸€ç´¢å¼•ä¸Šçš„èŒƒå›´æŸ¥è¯¢ä¼šè®¿é—®åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºæ­¢ã€‚</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> MySQLå®æˆ˜45è®² </tag>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>12è®² | å½’å¹¶æ’åº &amp; å¿«é€Ÿæ’åºï¼ŒæŸ¥æ‰¾ç¬¬Kå¤§å…ƒç´ </title>
      <link href="/posts/93213c3f.html"/>
      <url>/posts/93213c3f.html</url>
      
        <content type="html"><![CDATA[<hr><h1 id="12-æ’åºï¼ˆä¸‹ï¼‰ï¼šå¦‚ä½•ç”¨å¿«æ’æ€æƒ³åœ¨O-n-å†…æŸ¥æ‰¾ç¬¬Kå¤§å…ƒç´ ï¼Ÿ"><a href="#12-æ’åºï¼ˆä¸‹ï¼‰ï¼šå¦‚ä½•ç”¨å¿«æ’æ€æƒ³åœ¨O-n-å†…æŸ¥æ‰¾ç¬¬Kå¤§å…ƒç´ ï¼Ÿ" class="headerlink" title="12 | æ’åºï¼ˆä¸‹ï¼‰ï¼šå¦‚ä½•ç”¨å¿«æ’æ€æƒ³åœ¨O(n)å†…æŸ¥æ‰¾ç¬¬Kå¤§å…ƒç´ ï¼Ÿ"></a>12 | æ’åºï¼ˆä¸‹ï¼‰ï¼šå¦‚ä½•ç”¨å¿«æ’æ€æƒ³åœ¨O(n)å†…æŸ¥æ‰¾ç¬¬Kå¤§å…ƒç´ ï¼Ÿ</h1><h2 id="å½’å¹¶æ’åºçš„åŸç†"><a href="#å½’å¹¶æ’åºçš„åŸç†" class="headerlink" title="å½’å¹¶æ’åºçš„åŸç†"></a>å½’å¹¶æ’åºçš„åŸç†</h2><p>å½’å¹¶æ’åºçš„æ ¸å¿ƒæ€æƒ³è¿˜æ˜¯è›®ç®€å•çš„ã€‚å¦‚æœè¦æ’åºä¸€ä¸ªæ•°ç»„ï¼Œæˆ‘ä»¬å…ˆæŠŠæ•°ç»„ä»ä¸­é—´åˆ†æˆå‰åä¸¤éƒ¨åˆ†ï¼Œç„¶åå¯¹å‰åä¸¤éƒ¨åˆ†åˆ†åˆ«æ’åºï¼Œå†å°†æ’å¥½åºçš„ä¸¤éƒ¨åˆ†åˆå¹¶åœ¨ä¸€èµ·ï¼Œè¿™æ ·æ•´ä¸ªæ•°ç»„å°±éƒ½æœ‰åºäº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210504154821.jpeg" alt="img"></p><p>å½’å¹¶æ’åºä½¿ç”¨çš„å°±æ˜¯åˆ†æ²»æ€æƒ³ã€‚åˆ†æ²»ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯åˆ†è€Œæ²»ä¹‹ï¼Œå°†ä¸€ä¸ªå¤§é—®é¢˜åˆ†è§£æˆå°çš„å­é—®é¢˜æ¥è§£å†³ã€‚å°çš„å­é—®é¢˜è§£å†³äº†ï¼Œå¤§é—®é¢˜ä¹Ÿå°±è§£å†³äº†ã€‚</p><p>ä»æˆ‘åˆšæ‰çš„æè¿°ï¼Œä½ æœ‰æ²¡æœ‰æ„Ÿè§‰åˆ°ï¼Œåˆ†æ²»æ€æƒ³è·Ÿæˆ‘ä»¬å‰é¢è®²çš„é€’å½’æ€æƒ³å¾ˆåƒã€‚æ˜¯çš„ï¼Œåˆ†æ²»ç®—æ³•ä¸€èˆ¬éƒ½æ˜¯ç”¨é€’å½’æ¥å®ç°çš„ã€‚<strong>åˆ†æ²»æ˜¯ä¸€ç§è§£å†³é—®é¢˜çš„å¤„ç†æ€æƒ³ï¼Œé€’å½’æ˜¯ä¸€ç§ç¼–ç¨‹æŠ€å·§</strong>ï¼Œè¿™ä¸¤è€…å¹¶ä¸å†²çªã€‚åˆ†æ²»ç®—æ³•çš„æ€æƒ³æˆ‘åé¢ä¼šæœ‰ä¸“é—¨çš„ä¸€èŠ‚æ¥è®²ï¼Œç°åœ¨ä¸å±•å¼€è®¨è®ºï¼Œæˆ‘ä»¬ä»Šå¤©çš„é‡ç‚¹è¿˜æ˜¯æ’åºç®—æ³•ã€‚</p><p>å‰é¢æˆ‘é€šè¿‡ä¸¾ä¾‹è®©ä½ å¯¹å½’å¹¶æœ‰äº†ä¸€ä¸ªæ„Ÿæ€§çš„è®¤è¯†ï¼Œåˆå‘Šè¯‰ä½ ï¼Œå½’å¹¶æ’åºç”¨çš„æ˜¯åˆ†æ²»æ€æƒ³ï¼Œå¯ä»¥ç”¨é€’å½’æ¥å®ç°ã€‚æˆ‘ä»¬ç°åœ¨å°±æ¥çœ‹çœ‹<strong>å¦‚ä½•ç”¨é€’å½’ä»£ç æ¥å®ç°å½’å¹¶æ’åº</strong>ã€‚</p><p>æˆ‘åœ¨ç¬¬10 èŠ‚è®²çš„é€’å½’ä»£ç çš„ç¼–å†™æŠ€å·§ä½ è¿˜è®°å¾—å—ï¼Ÿå†™é€’å½’ä»£ç çš„æŠ€å·§å°±æ˜¯ï¼Œåˆ†æå¾—å‡ºé€’æ¨å…¬å¼ï¼Œç„¶åæ‰¾åˆ°ç»ˆæ­¢æ¡ä»¶ï¼Œæœ€åå°†é€’æ¨å…¬å¼ç¿»è¯‘æˆé€’å½’ä»£ç ã€‚æ‰€ä»¥ï¼Œè¦æƒ³å†™å‡ºå½’å¹¶æ’åºçš„ä»£ç ï¼Œæˆ‘ä»¬å…ˆå†™å‡ºå½’å¹¶æ’åºçš„é€’æ¨å…¬å¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">é€’æ¨å…¬å¼ï¼š</span><br><span class="line">merge_sort(pâ€¦r) = merge(merge_sort(pâ€¦q), merge_sort(q+1â€¦r))</span><br><span class="line"></span><br><span class="line">ç»ˆæ­¢æ¡ä»¶ï¼š</span><br><span class="line">p &gt;= r ä¸ç”¨å†ç»§ç»­åˆ†è§£</span><br></pre></td></tr></table></figure><p>æˆ‘æ¥è§£é‡Šä¸€ä¸‹è¿™ä¸ªé€’æ¨å…¬å¼ã€‚</p><p>merge_sort(pâ€¦r) è¡¨ç¤ºï¼Œç»™ä¸‹æ ‡ä» p åˆ° r ä¹‹é—´çš„æ•°ç»„æ’åºã€‚æˆ‘ä»¬å°†è¿™ä¸ªæ’åºé—®é¢˜è½¬åŒ–ä¸ºäº†ä¸¤ä¸ªå­é—®é¢˜ï¼Œmerge_sort(pâ€¦q) å’Œ merge_sort(q+1â€¦r)ï¼Œå…¶ä¸­ä¸‹æ ‡ q ç­‰äº p å’Œ r çš„ä¸­é—´ä½ç½®ï¼Œä¹Ÿå°±æ˜¯ (p+r)&#x2F;2ã€‚å½“ä¸‹æ ‡ä» p åˆ° q å’Œä» q+1 åˆ° r è¿™ä¸¤ä¸ªå­æ•°ç»„éƒ½æ’å¥½åºä¹‹åï¼Œæˆ‘ä»¬å†å°†ä¸¤ä¸ªæœ‰åºçš„å­æ•°ç»„åˆå¹¶åœ¨ä¸€èµ·ï¼Œè¿™æ ·ä¸‹æ ‡ä» p åˆ° r ä¹‹é—´çš„æ•°æ®å°±ä¹Ÿæ’å¥½åºäº†ã€‚</p><p>æœ‰äº†é€’æ¨å…¬å¼ï¼Œè½¬åŒ–æˆä»£ç å°±ç®€å•å¤šäº†ã€‚ä¸ºäº†é˜…è¯»æ–¹ä¾¿ï¼Œæˆ‘è¿™é‡Œåªç»™å‡ºä¼ªä»£ç ï¼Œä½ å¯ä»¥ç¿»è¯‘æˆä½ ç†Ÿæ‚‰çš„ç¼–ç¨‹è¯­è¨€ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å½’å¹¶æ’åºç®—æ³•, Aæ˜¯æ•°ç»„ï¼Œnè¡¨ç¤ºæ•°ç»„å¤§å°</span></span><br><span class="line">merge_sort(A, n) &#123;</span><br><span class="line">  merge_sort_c(A, <span class="number">0</span>, n<span class="number">-1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€’å½’è°ƒç”¨å‡½æ•°</span></span><br><span class="line">merge_sort_c(A, p, r) &#123;</span><br><span class="line">  <span class="comment">// é€’å½’ç»ˆæ­¢æ¡ä»¶</span></span><br><span class="line">  <span class="keyword">if</span> p &gt;= r  then <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// å–påˆ°rä¹‹é—´çš„ä¸­é—´ä½ç½®q</span></span><br><span class="line">  q = (p+r) / <span class="number">2</span></span><br><span class="line">  <span class="comment">// åˆ†æ²»é€’å½’</span></span><br><span class="line">  merge_sort_c(A, p, q)</span><br><span class="line">  merge_sort_c(A, q+<span class="number">1</span>, r)</span><br><span class="line">  <span class="comment">// å°†A[p...q]å’ŒA[q+1...r]åˆå¹¶ä¸ºA[p...r]</span></span><br><span class="line">  merge(A[p...r], A[p...q], A[q+<span class="number">1.</span>..r])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ å¯èƒ½å·²ç»å‘ç°äº†ï¼Œmerge(A[pâ€¦r], A[pâ€¦q], A[q+1â€¦r]) è¿™ä¸ªå‡½æ•°çš„ä½œç”¨å°±æ˜¯ï¼Œå°†å·²ç»æœ‰åºçš„ A[pâ€¦q]å’Œ A[q+1â€¦.r]åˆå¹¶æˆä¸€ä¸ªæœ‰åºçš„æ•°ç»„ï¼Œå¹¶ä¸”æ”¾å…¥ A[pâ€¦.r]ã€‚é‚£è¿™ä¸ªè¿‡ç¨‹å…·ä½“è¯¥å¦‚ä½•åšå‘¢ï¼Ÿ</p><p>å¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬ç”³è¯·ä¸€ä¸ªä¸´æ—¶æ•°ç»„ tmpï¼Œå¤§å°ä¸ A[pâ€¦r]ç›¸åŒã€‚æˆ‘ä»¬ç”¨ä¸¤ä¸ªæ¸¸æ ‡ i å’Œ jï¼Œåˆ†åˆ«æŒ‡å‘ A[pâ€¦q]å’Œ A[q+1â€¦r]çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚æ¯”è¾ƒè¿™ä¸¤ä¸ªå…ƒç´  A[i]å’Œ A[j]ï¼Œå¦‚æœ A[i]&lt;&#x3D;A[j]ï¼Œæˆ‘ä»¬å°±æŠŠ A[i]æ”¾å…¥åˆ°ä¸´æ—¶æ•°ç»„ tmpï¼Œå¹¶ä¸” i åç§»ä¸€ä½ï¼Œå¦åˆ™å°† A[j]æ”¾å…¥åˆ°æ•°ç»„ tmpï¼Œj åç§»ä¸€ä½ã€‚</p><p>ç»§ç»­ä¸Šè¿°æ¯”è¾ƒè¿‡ç¨‹ï¼Œç›´åˆ°å…¶ä¸­ä¸€ä¸ªå­æ•°ç»„ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½æ”¾å…¥ä¸´æ—¶æ•°ç»„ä¸­ï¼Œå†æŠŠå¦ä¸€ä¸ªæ•°ç»„ä¸­çš„æ•°æ®ä¾æ¬¡åŠ å…¥åˆ°ä¸´æ—¶æ•°ç»„çš„æœ«å°¾ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä¸´æ—¶æ•°ç»„ä¸­å­˜å‚¨çš„å°±æ˜¯ä¸¤ä¸ªå­æ•°ç»„åˆå¹¶ä¹‹åçš„ç»“æœäº†ã€‚æœ€åå†æŠŠä¸´æ—¶æ•°ç»„ tmp ä¸­çš„æ•°æ®æ‹·è´åˆ°åŸæ•°ç»„ A[pâ€¦r]ä¸­ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210504155216.jpeg" alt="img"></p><p>æˆ‘ä»¬æŠŠ merge() å‡½æ•°å†™æˆä¼ªä»£ç ï¼Œå°±æ˜¯ä¸‹é¢è¿™æ ·ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">merge(A[p...r], A[p...q], A[q+<span class="number">1.</span>..r]) &#123;</span><br><span class="line">  <span class="keyword">var</span> i := pï¼Œj := q+<span class="number">1</span>ï¼Œk := <span class="number">0</span> <span class="comment">// åˆå§‹åŒ–å˜é‡i, j, k</span></span><br><span class="line">  <span class="keyword">var</span> tmp := <span class="built_in">new</span> array[<span class="number">0.</span>..r-p] <span class="comment">// ç”³è¯·ä¸€ä¸ªå¤§å°è·ŸA[p...r]ä¸€æ ·çš„ä¸´æ—¶æ•°ç»„</span></span><br><span class="line">  while i&lt;=q AND j&lt;=r do &#123;</span><br><span class="line">    <span class="keyword">if</span> A[i] &lt;= A[j] &#123;</span><br><span class="line">      tmp[k++] = A[i++] <span class="comment">// i++ç­‰äºi:=i+1</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      tmp[k++] = A[j++]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åˆ¤æ–­å“ªä¸ªå­æ•°ç»„ä¸­æœ‰å‰©ä½™çš„æ•°æ®</span></span><br><span class="line">  <span class="keyword">var</span> start := iï¼Œend := q</span><br><span class="line">  <span class="keyword">if</span> j&lt;=r then start := j, end:=r</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å°†å‰©ä½™çš„æ•°æ®æ‹·è´åˆ°ä¸´æ—¶æ•°ç»„tmp</span></span><br><span class="line">  while start &lt;= end do &#123;</span><br><span class="line">    tmp[k++] = A[start++]</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å°†tmpä¸­çš„æ•°ç»„æ‹·è´å›A[p...r]</span></span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">0</span> to r-p do &#123;</span><br><span class="line">    A[p+i] = tmp[i]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¿«é€Ÿæ’åºçš„åŸç†"><a href="#å¿«é€Ÿæ’åºçš„åŸç†" class="headerlink" title="å¿«é€Ÿæ’åºçš„åŸç†"></a>å¿«é€Ÿæ’åºçš„åŸç†</h2><p>å¿«æ’çš„æ€æƒ³æ˜¯è¿™æ ·çš„ï¼šå¦‚æœè¦æ’åºæ•°ç»„ä¸­ä¸‹æ ‡ä» p åˆ° r ä¹‹é—´çš„ä¸€ç»„æ•°æ®ï¼Œæˆ‘ä»¬é€‰æ‹© p åˆ° r ä¹‹é—´çš„ä»»æ„ä¸€ä¸ªæ•°æ®ä½œä¸º pivotï¼ˆåˆ†åŒºç‚¹ï¼‰ã€‚</p><p>æˆ‘ä»¬éå† p åˆ° r ä¹‹é—´çš„æ•°æ®ï¼Œå°†å°äº pivot çš„æ”¾åˆ°å·¦è¾¹ï¼Œå°†å¤§äº pivot çš„æ”¾åˆ°å³è¾¹ï¼Œå°† pivot æ”¾åˆ°ä¸­é—´ã€‚ç»è¿‡è¿™ä¸€æ­¥éª¤ä¹‹åï¼Œæ•°ç»„ p åˆ° r ä¹‹é—´çš„æ•°æ®å°±è¢«åˆ†æˆäº†ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå‰é¢ p åˆ° q-1 ä¹‹é—´éƒ½æ˜¯å°äº pivot çš„ï¼Œä¸­é—´æ˜¯ pivotï¼Œåé¢çš„ q+1 åˆ° r ä¹‹é—´æ˜¯å¤§äº pivot çš„ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210427195633.jpeg" alt="img"></p><p>æ ¹æ®åˆ†æ²»ã€é€’å½’çš„å¤„ç†æ€æƒ³ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨é€’å½’æ’åºä¸‹æ ‡ä» p åˆ° q-1 ä¹‹é—´çš„æ•°æ®å’Œä¸‹æ ‡ä» q+1 åˆ° r ä¹‹é—´çš„æ•°æ®ï¼Œç›´åˆ°åŒºé—´ç¼©å°ä¸º 1ï¼Œå°±è¯´æ˜æ‰€æœ‰çš„æ•°æ®éƒ½æœ‰åºäº†ã€‚</p><p>å¦‚æœæˆ‘ä»¬ç”¨é€’æ¨å…¬å¼æ¥å°†ä¸Šé¢çš„è¿‡ç¨‹å†™å‡ºæ¥çš„è¯ï¼Œå°±æ˜¯è¿™æ ·ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">é€’æ¨å…¬å¼ï¼š</span><br><span class="line">quick_sort(pâ€¦r) = quick_sort(pâ€¦q-1) + quick_sort(q+1â€¦ r)</span><br><span class="line"></span><br><span class="line">ç»ˆæ­¢æ¡ä»¶ï¼š</span><br><span class="line">p &gt;= r</span><br></pre></td></tr></table></figure><p>æˆ‘å°†é€’æ¨å…¬å¼è½¬åŒ–æˆé€’å½’ä»£ç ã€‚è·Ÿå½’å¹¶æ’åºä¸€æ ·ï¼Œæˆ‘è¿˜æ˜¯ç”¨ä¼ªä»£ç æ¥å®ç°ï¼Œä½ å¯ä»¥ç¿»è¯‘æˆä½ ç†Ÿæ‚‰çš„ä»»ä½•è¯­è¨€ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¿«é€Ÿæ’åºï¼ŒAæ˜¯æ•°ç»„ï¼Œnè¡¨ç¤ºæ•°ç»„çš„å¤§å°</span></span><br><span class="line">quick_sort(A, n) &#123;</span><br><span class="line">  quick_sort_c(A, <span class="number">0</span>, n<span class="number">-1</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¿«é€Ÿæ’åºé€’å½’å‡½æ•°ï¼Œp,rä¸ºä¸‹æ ‡</span></span><br><span class="line">quick_sort_c(A, p, r) &#123;</span><br><span class="line">  <span class="keyword">if</span> p &gt;= r then <span class="keyword">return</span></span><br><span class="line">  </span><br><span class="line">  q = partition(A, p, r) <span class="comment">// è·å–åˆ†åŒºç‚¹</span></span><br><span class="line">  quick_sort_c(A, p, q<span class="number">-1</span>)</span><br><span class="line">  quick_sort_c(A, q+<span class="number">1</span>, r)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½’å¹¶æ’åºä¸­æœ‰ä¸€ä¸ª merge() åˆå¹¶å‡½æ•°ï¼Œæˆ‘ä»¬è¿™é‡Œæœ‰ä¸€ä¸ª partition() åˆ†åŒºå‡½æ•°ã€‚partition() åˆ†åŒºå‡½æ•°å®é™…ä¸Šæˆ‘ä»¬å‰é¢å·²ç»è®²è¿‡äº†ï¼Œå°±æ˜¯éšæœºé€‰æ‹©ä¸€ä¸ªå…ƒç´ ä½œä¸º pivotï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯ä»¥é€‰æ‹© p åˆ° r åŒºé—´çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œç„¶åå¯¹ A[pâ€¦r]åˆ†åŒºï¼Œå‡½æ•°è¿”å› pivot çš„ä¸‹æ ‡ã€‚</p><p>å¦‚æœæˆ‘ä»¬ä¸è€ƒè™‘ç©ºé—´æ¶ˆè€—çš„è¯ï¼Œpartition() åˆ†åŒºå‡½æ•°å¯ä»¥å†™å¾—éå¸¸ç®€å•ã€‚æˆ‘ä»¬ç”³è¯·ä¸¤ä¸ªä¸´æ—¶æ•°ç»„ X å’Œ Yï¼Œéå† A[pâ€¦r]ï¼Œå°†å°äº pivot çš„å…ƒç´ éƒ½æ‹·è´åˆ°ä¸´æ—¶æ•°ç»„ Xï¼Œå°†å¤§äº pivot çš„å…ƒç´ éƒ½æ‹·è´åˆ°ä¸´æ—¶æ•°ç»„ Yï¼Œæœ€åå†å°†æ•°ç»„ X å’Œæ•°ç»„ Y ä¸­æ•°æ®é¡ºåºæ‹·è´åˆ° A[pâ€¦.r]ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210427200346.jpeg" alt="img"></p><p>ä½†æ˜¯ï¼Œå¦‚æœæŒ‰ç…§è¿™ç§æ€è·¯å®ç°çš„è¯ï¼Œpartition() å‡½æ•°å°±éœ€è¦å¾ˆå¤šé¢å¤–çš„å†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥å¿«æ’å°±ä¸æ˜¯åŸåœ°æ’åºç®—æ³•äº†ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›å¿«æ’æ˜¯åŸåœ°æ’åºç®—æ³•ï¼Œé‚£å®ƒçš„ç©ºé—´å¤æ‚åº¦å¾—æ˜¯ O(1)ï¼Œé‚£ partition() åˆ†åŒºå‡½æ•°å°±ä¸èƒ½å ç”¨å¤ªå¤šé¢å¤–çš„å†…å­˜ç©ºé—´ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨ A[pâ€¦r]çš„åŸåœ°å®Œæˆåˆ†åŒºæ“ä½œã€‚</p><p>åŸåœ°åˆ†åŒºå‡½æ•°çš„å®ç°æ€è·¯éå¸¸å·§å¦™ï¼Œæˆ‘å†™æˆäº†ä¼ªä»£ç ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸€ä¸‹ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">partition(A, p, r) &#123;</span><br><span class="line">  pivot := A[r]</span><br><span class="line">  i := p</span><br><span class="line">  <span class="keyword">for</span> j := p to r<span class="number">-1</span> do &#123;</span><br><span class="line">    <span class="keyword">if</span> A[j] &lt; pivot &#123;</span><br><span class="line">      swap A[i] with A[j]</span><br><span class="line">      i := i+<span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  swap A[i] with A[r]</span><br><span class="line">  <span class="keyword">return</span> i</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„å¤„ç†æœ‰ç‚¹ç±»ä¼¼é€‰æ‹©æ’åºã€‚æˆ‘ä»¬é€šè¿‡æ¸¸æ ‡ i æŠŠ A[pâ€¦r-1]åˆ†æˆä¸¤éƒ¨åˆ†ã€‚A[pâ€¦i-1]çš„å…ƒç´ éƒ½æ˜¯å°äº pivot çš„ï¼Œæˆ‘ä»¬æš‚ä¸”å«å®ƒâ€œå·²å¤„ç†åŒºé—´â€ï¼ŒA[iâ€¦r-1]æ˜¯â€œæœªå¤„ç†åŒºé—´â€ã€‚æˆ‘ä»¬æ¯æ¬¡éƒ½ä»æœªå¤„ç†çš„åŒºé—´ A[iâ€¦r-1]ä¸­å–ä¸€ä¸ªå…ƒç´  A[j]ï¼Œä¸ pivot å¯¹æ¯”ï¼Œå¦‚æœå°äº pivotï¼Œåˆ™å°†å…¶åŠ å…¥åˆ°å·²å¤„ç†åŒºé—´çš„å°¾éƒ¨ï¼Œä¹Ÿå°±æ˜¯ A[i]çš„ä½ç½®ã€‚</p><p>æ•°ç»„çš„æ’å…¥æ“ä½œè¿˜è®°å¾—å—ï¼Ÿåœ¨æ•°ç»„æŸä¸ªä½ç½®æ’å…¥å…ƒç´ ï¼Œéœ€è¦æ¬ç§»æ•°æ®ï¼Œéå¸¸è€—æ—¶ã€‚å½“æ—¶æˆ‘ä»¬ä¹Ÿè®²äº†ä¸€ç§å¤„ç†æŠ€å·§ï¼Œå°±æ˜¯äº¤æ¢ï¼Œåœ¨ O(1) çš„æ—¶é—´å¤æ‚åº¦å†…å®Œæˆæ’å…¥æ“ä½œã€‚è¿™é‡Œæˆ‘ä»¬ä¹Ÿå€ŸåŠ©è¿™ä¸ªæ€æƒ³ï¼Œåªéœ€è¦å°† A[i]ä¸ A[j]äº¤æ¢ï¼Œå°±å¯ä»¥åœ¨ O(1) æ—¶é—´å¤æ‚åº¦å†…å°† A[j]æ”¾åˆ°ä¸‹æ ‡ä¸º i çš„ä½ç½®ã€‚</p><p>æ–‡å­—ä¸å¦‚å›¾ç›´è§‚ï¼Œæ‰€ä»¥æˆ‘ç”»äº†ä¸€å¼ å›¾æ¥å±•ç¤ºåˆ†åŒºçš„æ•´ä¸ªè¿‡ç¨‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210427201802.jpeg" alt="img"></p><p>å› ä¸ºåˆ†åŒºçš„è¿‡ç¨‹æ¶‰åŠäº¤æ¢æ“ä½œï¼Œå¦‚æœæ•°ç»„ä¸­æœ‰ä¸¤ä¸ªç›¸åŒçš„å…ƒç´ ï¼Œæ¯”å¦‚åºåˆ— 6ï¼Œ8ï¼Œ7ï¼Œ6ï¼Œ3ï¼Œ5ï¼Œ9ï¼Œ4ï¼Œåœ¨ç»è¿‡ç¬¬ä¸€æ¬¡åˆ†åŒºæ“ä½œä¹‹åï¼Œä¸¤ä¸ª 6 çš„ç›¸å¯¹å…ˆåé¡ºåºå°±ä¼šæ”¹å˜ã€‚æ‰€ä»¥ï¼Œå¿«é€Ÿæ’åºå¹¶ä¸æ˜¯ä¸€ä¸ªç¨³å®šçš„æ’åºç®—æ³•ã€‚</p><p>åˆ°æ­¤ï¼Œå¿«é€Ÿæ’åºçš„åŸç†ä½ åº”è¯¥ä¹ŸæŒæ¡äº†ã€‚ç°åœ¨ï¼Œæˆ‘å†æ¥çœ‹å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼šå¿«æ’å’Œå½’å¹¶ç”¨çš„éƒ½æ˜¯åˆ†æ²»æ€æƒ³ï¼Œé€’æ¨å…¬å¼å’Œé€’å½’ä»£ç ä¹Ÿéå¸¸ç›¸ä¼¼ï¼Œé‚£å®ƒä»¬çš„åŒºåˆ«åœ¨å“ªé‡Œå‘¢ï¼Ÿ</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210427201947.jpeg" alt="img"></p><p>å¯ä»¥å‘ç°ï¼Œå½’å¹¶æ’åºçš„å¤„ç†è¿‡ç¨‹æ˜¯<strong>ç”±ä¸‹åˆ°ä¸Š</strong>çš„ï¼Œå…ˆå¤„ç†å­é—®é¢˜ï¼Œç„¶åå†åˆå¹¶ã€‚è€Œå¿«æ’æ­£å¥½ç›¸åï¼Œå®ƒçš„å¤„ç†è¿‡ç¨‹æ˜¯<strong>ç”±ä¸Šåˆ°ä¸‹çš„</strong>ï¼Œå…ˆåˆ†åŒºï¼Œç„¶åå†å¤„ç†å­é—®é¢˜ã€‚å½’å¹¶æ’åºè™½ç„¶æ˜¯ç¨³å®šçš„ã€æ—¶é—´å¤æ‚åº¦ä¸º O(nlogn) çš„æ’åºç®—æ³•ï¼Œä½†æ˜¯å®ƒæ˜¯éåŸåœ°æ’åºç®—æ³•ã€‚æˆ‘ä»¬å‰é¢è®²è¿‡ï¼Œå½’å¹¶ä¹‹æ‰€ä»¥æ˜¯éåŸåœ°æ’åºç®—æ³•ï¼Œä¸»è¦åŸå› æ˜¯åˆå¹¶å‡½æ•°æ— æ³•åœ¨åŸåœ°æ‰§è¡Œã€‚å¿«é€Ÿæ’åºé€šè¿‡è®¾è®¡å·§å¦™çš„åŸåœ°åˆ†åŒºå‡½æ•°ï¼Œå¯ä»¥å®ç°åŸåœ°æ’åºï¼Œè§£å†³äº†å½’å¹¶æ’åºå ç”¨å¤ªå¤šå†…å­˜çš„é—®é¢˜ã€‚</p><h2 id="è§£ç­”å¼€ç¯‡"><a href="#è§£ç­”å¼€ç¯‡" class="headerlink" title="è§£ç­”å¼€ç¯‡"></a>è§£ç­”å¼€ç¯‡</h2><p>å¿«æ’æ ¸å¿ƒæ€æƒ³å°±æ˜¯åˆ†æ²»å’Œåˆ†åŒºï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨åˆ†åŒºçš„æ€æƒ³ï¼Œæ¥è§£ç­”å¼€ç¯‡çš„é—®é¢˜ï¼šO(n) æ—¶é—´å¤æ‚åº¦å†…æ±‚æ— åºæ•°ç»„ä¸­çš„ç¬¬ K å¤§å…ƒç´ ã€‚æ¯”å¦‚ï¼Œ4ï¼Œ 2ï¼Œ 5ï¼Œ 12ï¼Œ 3 è¿™æ ·ä¸€ç»„æ•°æ®ï¼Œç¬¬ 3 å¤§å…ƒç´ å°±æ˜¯ 4ã€‚</p><p>æˆ‘ä»¬é€‰æ‹©æ•°ç»„åŒºé—´ A[0â€¦n-1]çš„æœ€åä¸€ä¸ªå…ƒç´  A[n-1]ä½œä¸º pivotï¼Œå¯¹æ•°ç»„ A[0â€¦n-1]åŸåœ°åˆ†åŒºï¼Œè¿™æ ·æ•°ç»„å°±åˆ†æˆäº†ä¸‰éƒ¨åˆ†ï¼ŒA[0â€¦p-1]ã€A[p]ã€A[p+1â€¦n-1]ã€‚</p><p>å¦‚æœ p+1&#x3D;Kï¼Œé‚£ A[p]å°±æ˜¯è¦æ±‚è§£çš„å…ƒç´ ï¼›å¦‚æœ K&gt;p+1, è¯´æ˜ç¬¬ K å¤§å…ƒç´ å‡ºç°åœ¨ A[p+1â€¦n-1]åŒºé—´ï¼Œæˆ‘ä»¬å†æŒ‰ç…§ä¸Šé¢çš„æ€è·¯é€’å½’åœ°åœ¨ A[p+1â€¦n-1]è¿™ä¸ªåŒºé—´å†…æŸ¥æ‰¾ã€‚åŒç†ï¼Œå¦‚æœ K&lt;p+1ï¼Œé‚£æˆ‘ä»¬å°±åœ¨ A[0â€¦p-1]åŒºé—´æŸ¥æ‰¾ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210504155824.jpeg" alt="img"></p><p>æˆ‘ä»¬å†æ¥çœ‹ï¼Œä¸ºä»€ä¹ˆä¸Šè¿°è§£å†³æ€è·¯çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ï¼Ÿ</p><p>ç¬¬ä¸€æ¬¡åˆ†åŒºæŸ¥æ‰¾ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å¤§å°ä¸º n çš„æ•°ç»„æ‰§è¡Œåˆ†åŒºæ“ä½œï¼Œéœ€è¦éå† n ä¸ªå…ƒç´ ã€‚ç¬¬äºŒæ¬¡åˆ†åŒºæŸ¥æ‰¾ï¼Œæˆ‘ä»¬åªéœ€è¦å¯¹å¤§å°ä¸º n&#x2F;2 çš„æ•°ç»„æ‰§è¡Œåˆ†åŒºæ“ä½œï¼Œéœ€è¦éå† n&#x2F;2 ä¸ªå…ƒç´ ã€‚ä¾æ¬¡ç±»æ¨ï¼Œåˆ†åŒºéå†å…ƒç´ çš„ä¸ªæ•°åˆ†åˆ«ä¸ºã€n&#x2F;2ã€n&#x2F;4ã€n&#x2F;8ã€n&#x2F;16.â€¦â€¦ç›´åˆ°åŒºé—´ç¼©å°ä¸º 1ã€‚</p><p>å¦‚æœæˆ‘ä»¬æŠŠæ¯æ¬¡åˆ†åŒºéå†çš„å…ƒç´ ä¸ªæ•°åŠ èµ·æ¥ï¼Œå°±æ˜¯ï¼šn+n&#x2F;2+n&#x2F;4+n&#x2F;8+â€¦+1ã€‚è¿™æ˜¯ä¸€ä¸ªç­‰æ¯”æ•°åˆ—æ±‚å’Œï¼Œæœ€åçš„å’Œç­‰äº 2n-1ã€‚æ‰€ä»¥ï¼Œä¸Šè¿°è§£å†³æ€è·¯çš„æ—¶é—´å¤æ‚åº¦å°±ä¸º O(n)ã€‚</p><h2 id="å†…å®¹å°ç»“"><a href="#å†…å®¹å°ç»“" class="headerlink" title="å†…å®¹å°ç»“"></a>å†…å®¹å°ç»“</h2><p>å½’å¹¶æ’åºå’Œå¿«é€Ÿæ’åºæ˜¯ä¸¤ç§ç¨å¾®å¤æ‚çš„æ’åºç®—æ³•ï¼Œå®ƒä»¬ç”¨çš„éƒ½æ˜¯åˆ†æ²»çš„æ€æƒ³ï¼Œä»£ç éƒ½é€šè¿‡é€’å½’æ¥å®ç°ï¼Œè¿‡ç¨‹éå¸¸ç›¸ä¼¼ã€‚ç†è§£å½’å¹¶æ’åºçš„é‡ç‚¹æ˜¯ç†è§£é€’æ¨å…¬å¼å’Œ merge() åˆå¹¶å‡½æ•°ã€‚åŒç†ï¼Œç†è§£å¿«æ’çš„é‡ç‚¹ä¹Ÿæ˜¯ç†è§£é€’æ¨å…¬å¼ï¼Œè¿˜æœ‰ partition() åˆ†åŒºå‡½æ•°ã€‚</p><p>å½’å¹¶æ’åºç®—æ³•æ˜¯ä¸€ç§åœ¨ä»»ä½•æƒ…å†µä¸‹æ—¶é—´å¤æ‚åº¦éƒ½æ¯”è¾ƒç¨³å®šçš„æ’åºç®—æ³•ï¼Œè¿™ä¹Ÿä½¿å®ƒå­˜åœ¨è‡´å‘½çš„ç¼ºç‚¹ï¼Œå³å½’å¹¶æ’åºä¸æ˜¯åŸåœ°æ’åºç®—æ³•ï¼Œç©ºé—´å¤æ‚åº¦æ¯”è¾ƒé«˜ï¼Œæ˜¯ O(n)ã€‚æ­£å› ä¸ºæ­¤ï¼Œå®ƒä¹Ÿæ²¡æœ‰å¿«æ’åº”ç”¨å¹¿æ³›ã€‚</p><p>å¿«é€Ÿæ’åºç®—æ³•è™½ç„¶æœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n2)ï¼Œä½†æ˜¯å¹³å‡æƒ…å†µä¸‹æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(nlogn)ã€‚ä¸ä»…å¦‚æ­¤ï¼Œå¿«é€Ÿæ’åºç®—æ³•æ—¶é—´å¤æ‚åº¦é€€åŒ–åˆ° O(n2) çš„æ¦‚ç‡éå¸¸å°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆç†åœ°é€‰æ‹© pivot æ¥é¿å…è¿™ç§æƒ…å†µã€‚</p><h2 id="è¯¾åæ€è€ƒ"><a href="#è¯¾åæ€è€ƒ" class="headerlink" title="è¯¾åæ€è€ƒ"></a>è¯¾åæ€è€ƒ</h2><p>ç°åœ¨ä½ æœ‰ 10 ä¸ªæ¥å£è®¿é—®æ—¥å¿—æ–‡ä»¶ï¼Œæ¯ä¸ªæ—¥å¿—æ–‡ä»¶å¤§å°çº¦ 300MBï¼Œæ¯ä¸ªæ–‡ä»¶é‡Œçš„æ—¥å¿—éƒ½æ˜¯æŒ‰ç…§æ—¶é—´æˆ³ä»å°åˆ°å¤§æ’åºçš„ã€‚ä½ å¸Œæœ›å°†è¿™ 10 ä¸ªè¾ƒå°çš„æ—¥å¿—æ–‡ä»¶ï¼Œåˆå¹¶ä¸º 1 ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œåˆå¹¶ä¹‹åçš„æ—¥å¿—ä»ç„¶æŒ‰ç…§æ—¶é—´æˆ³ä»å°åˆ°å¤§æ’åˆ—ã€‚å¦‚æœå¤„ç†ä¸Šè¿°æ’åºä»»åŠ¡çš„æœºå™¨å†…å­˜åªæœ‰ 1GBï¼Œä½ æœ‰ä»€ä¹ˆå¥½çš„è§£å†³æ€è·¯ï¼Œèƒ½â€œå¿«é€Ÿâ€åœ°å°†è¿™ 10 ä¸ªæ—¥å¿—æ–‡ä»¶åˆå¹¶å—ï¼Ÿ</p><blockquote><p>å½’å¹¶æ€è·¯ï¼š </p><p>1.æ¯ä¸ªæ–‡ä»¶ä»æœ€å°å€¼è®°å½•å¼€å§‹ç»´æŠ¤ä¸€ä¸ªæ¸¸æ ‡ï¼Œæ ‡å¿—å½“å‰æ–‡ä»¶éå†çš„è®°å½•ä½ç½®ã€‚ </p><p>2.ç»´æŠ¤ä¸€ä¸ª10ç©ºé—´å¤§å°çš„å°é¡¶å †ï¼Œå°†æ¯ä¸ªæ–‡ä»¶çš„æ¸¸æ ‡è®°å½•å‹å…¥ï¼Œé¡¶ç«¯çš„å°±æ˜¯æœ€å°å€¼ã€‚ </p><p>3.å°†å †é¡¶æ•°æ®å–å‡ºï¼Œå†™å…¥æ–°çš„æ–‡ä»¶ã€‚ </p><p>4.å°†å–å‡ºçš„è®°å½•å¯¹åº”çš„æ–‡ä»¶æ¸¸æ ‡å‘å‰æ‹¨åŠ¨ï¼Œå–å‡ºå¯¹åº”çš„è®°å½•ï¼ˆå°±æ˜¯ä¸‹ä¸€ä¸ªè®°å½•ï¼‰ï¼Œå‹å…¥å°é¡¶å †ã€‚æ²¡æœ‰è®°å½•è¯´æ˜æ”¹æ–‡ä»¶éå†å®Œæ¯•ã€‚ </p><p>5.é‡å¤æ“ä½œ3ã€‚ ï¼ˆè¿™é‡Œçš„å°é¡¶å †ä½œç”¨å°±æ˜¯å¿«é€Ÿå–å‡ºæœ€å°çš„é‚£ä¸ªå€¼ï¼Œè€ƒè™‘åˆ°å †ç»“æ„çš„ä»£ç å®ç°éš¾åº¦ï¼Œè¿™ä¸ªåœ°æ–¹ç”¨ç®€å•çš„æœ‰åºåˆ—è¡¨ï¼Œæ–°çš„æ•°æ®æœ‰åºæ’å…¥ï¼Œå–å‡ºæœ€å°çš„ä¹Ÿå¾ˆokï¼Œ10æ¡è®°å½•éšä¾¿æï¼Œæ…¢ä¸åˆ°å“ªé‡Œï¼Œä¼˜åŒ–ä¹Ÿå¿«ä¸åˆ°å“ªé‡Œï¼Œç®€å•å°±å¥½ï¼‰ </p><p>è¿™ä¸ªç®€å•æ€è·¯å ç”¨ç©ºé—´å¾ˆå°ï¼Œå°±æ˜¯10æ¡æ•°æ®çš„å°é¡¶å †ã€‚ä½†é¢˜ç›®ç»™å‡ºçš„æ˜¯ï¼Œ1Gå†…å­˜ï¼Œæœ‰å¾ˆå¤§çš„ä¼˜åŒ–ç©ºé—´ï¼Œä¼˜åŒ–ç‚¹åœ¨ç£ç›˜IOï¼Œä¼˜åŒ–æ–¹å¼å°±æ˜¯æ‰¹é‡è¯»æ–‡ä»¶ï¼Œæ‰¹é‡å†™æ–‡ä»¶ã€‚ 1.æ‰¹é‡è¯»ï¼Œæ¯ä¸ªæ–‡ä»¶è¯»å–50Måˆ°å†…å­˜ï¼Œæ€»è®¡500Mã€‚ä¸Šé¢çš„æ¸¸æ ‡å°±å¯¹åº”åˆ°å†…å­˜æ¸¸æ ‡ï¼Œåªæ˜¯æ¸¸æ ‡åˆ°åº•ä¹‹åï¼Œéœ€è¦è¯»å–å¯¹åº”æ–‡ä»¶ä¸‹ä¸€ä¸ª50Mæ•°æ® 2.æ‰¹é‡å†™ï¼Œä¸Šé¢çš„å†™æ–‡ä»¶ï¼Œä¼˜åŒ–ä¸ºå†™å†…å­˜ï¼Œç»™äºˆ500Mçš„å†…å­˜ç©ºé—´ï¼Œå†™æ»¡åå†ä¸€æ¬¡åˆ·å…¥æ–°çš„æ–‡ä»¶ã€‚</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬å…«å‘¨</title>
      <link href="/posts/7f2c1a48.html"/>
      <url>/posts/7f2c1a48.html</url>
      
        <content type="html"><![CDATA[<hr><p>æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾æ¯å‘¨æ‰“å¡ 2021.04.26-2021.05.02</p><h3 id="é¢è¯•é¢˜-16-25-LRU-ç¼“å­˜"><a href="#é¢è¯•é¢˜-16-25-LRU-ç¼“å­˜" class="headerlink" title="é¢è¯•é¢˜ 16.25. LRU ç¼“å­˜"></a><a href="https://leetcode-cn.com/problems/lru-cache-lcci/">é¢è¯•é¢˜ 16.25. LRU ç¼“å­˜</a></h3><p>è®¾è®¡å’Œæ„å»ºä¸€ä¸ªâ€œæœ€è¿‘æœ€å°‘ä½¿ç”¨â€ç¼“å­˜ï¼Œè¯¥ç¼“å­˜ä¼šåˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„é¡¹ç›®ã€‚ç¼“å­˜åº”è¯¥ä»é”®æ˜ å°„åˆ°å€¼(å…è®¸ä½ æ’å…¥å’Œæ£€ç´¢ç‰¹å®šé”®å¯¹åº”çš„å€¼)ï¼Œå¹¶åœ¨åˆå§‹åŒ–æ—¶æŒ‡å®šæœ€å¤§å®¹é‡ã€‚å½“ç¼“å­˜è¢«å¡«æ»¡æ—¶ï¼Œå®ƒåº”è¯¥åˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„é¡¹ç›®ã€‚</p><p>å®ƒåº”è¯¥æ”¯æŒä»¥ä¸‹æ“ä½œï¼š è·å–æ•°æ® <code>get</code> å’Œ å†™å…¥æ•°æ® <code>put</code> ã€‚</p><p>è·å–æ•°æ® <code>get(key)</code> - å¦‚æœå¯†é’¥ (key) å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™è·å–å¯†é’¥çš„å€¼ï¼ˆæ€»æ˜¯æ­£æ•°ï¼‰ï¼Œå¦åˆ™è¿”å› -1ã€‚<br>å†™å…¥æ•°æ® <code>put(key, value)</code> - å¦‚æœå¯†é’¥ä¸å­˜åœ¨ï¼Œåˆ™å†™å…¥å…¶æ•°æ®å€¼ã€‚å½“ç¼“å­˜å®¹é‡è¾¾åˆ°ä¸Šé™æ—¶ï¼Œå®ƒåº”è¯¥åœ¨å†™å…¥æ–°æ•°æ®ä¹‹å‰åˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®å€¼ï¼Œä»è€Œä¸ºæ–°çš„æ•°æ®å€¼ç•™å‡ºç©ºé—´ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">LRUCache cache = new LRUCache( 2 /* ç¼“å­˜å®¹é‡ */ );</span><br><span class="line"></span><br><span class="line">cache.put(1, 1);</span><br><span class="line">cache.put(2, 2);</span><br><span class="line">cache.get(1);       // è¿”å›  1</span><br><span class="line">cache.put(3, 3);    // è¯¥æ“ä½œä¼šä½¿å¾—å¯†é’¥ 2 ä½œåºŸ</span><br><span class="line">cache.get(2);       // è¿”å› -1 (æœªæ‰¾åˆ°)</span><br><span class="line">cache.put(4, 4);    // è¯¥æ“ä½œä¼šä½¿å¾—å¯†é’¥ 1 ä½œåºŸ</span><br><span class="line">cache.get(1);       // è¿”å› -1 (æœªæ‰¾åˆ°)</span><br><span class="line">cache.get(3);       // è¿”å›  3</span><br><span class="line">cache.get(4);       // è¿”å›  4</span><br></pre></td></tr></table></figure><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">LRUCache</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨hashmapä½¿å¾—æŸ¥è¯¢é—´å¤æ‚åº¦ä¸ºO(1)ï¼Œå¦åˆ™é“¾è¡¨æ—¶é—´å¤æ‚åº¦ä¸ºO(n)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;Integer, Node&gt; cache;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> capacity;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Node head;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Node tail;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LRUCache</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">        cache = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">        head = <span class="keyword">new</span> <span class="title class_">Node</span>();</span><br><span class="line">        tail = <span class="keyword">new</span> <span class="title class_">Node</span>();</span><br><span class="line">        head.next = tail;</span><br><span class="line">        tail.prev = head;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> cache.get(key);</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        moveToHead(node);</span><br><span class="line">        <span class="keyword">return</span> node.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(<span class="type">int</span> key, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> cache.get(key);</span><br><span class="line">        <span class="comment">// è¯¥èŠ‚ç‚¹ä¸å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// å®¹é‡æ»¡äº†</span></span><br><span class="line">            <span class="keyword">if</span> (size == capacity) &#123;</span><br><span class="line">                <span class="type">Node</span> <span class="variable">last</span> <span class="operator">=</span> removeLast();</span><br><span class="line">                cache.remove(last.key);</span><br><span class="line">                size--;</span><br><span class="line">            &#125;</span><br><span class="line">            node = <span class="keyword">new</span> <span class="title class_">Node</span>(key, value);</span><br><span class="line">            addToHead(node);</span><br><span class="line">            cache.put(key, node);</span><br><span class="line">            size++;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            node.value = value;</span><br><span class="line">            <span class="comment">// èŠ‚ç‚¹å·²å­˜åœ¨</span></span><br><span class="line">            moveToHead(node);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Node <span class="title function_">removeLast</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">last</span> <span class="operator">=</span> tail.prev;</span><br><span class="line">        remove(last);</span><br><span class="line">        <span class="keyword">return</span> last;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">moveToHead</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">        remove(node);</span><br><span class="line">        addToHead(node);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addToHead</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">next</span> <span class="operator">=</span> head.next;</span><br><span class="line">        head.next = node;</span><br><span class="line">        next.prev = node;</span><br><span class="line"></span><br><span class="line">        node.prev = head;</span><br><span class="line">        node.next = next;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">prev</span> <span class="operator">=</span> node.prev;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">next</span> <span class="operator">=</span> node.next;</span><br><span class="line"></span><br><span class="line">        prev.next = next;</span><br><span class="line">        next.prev = prev;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŒå‘é“¾è¡¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">    <span class="type">int</span> key;</span><br><span class="line">    <span class="type">int</span> value;</span><br><span class="line">    Node prev;</span><br><span class="line">    Node next;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(<span class="type">int</span> key, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.key = key;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‰‘æŒ‡-Offer-68-II-äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"><a href="#å‰‘æŒ‡-Offer-68-II-äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ" class="headerlink" title="å‰‘æŒ‡ Offer 68 - II. äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"></a><a href="https://leetcode-cn.com/problems/er-cha-shu-de-zui-jin-gong-gong-zu-xian-lcof/">å‰‘æŒ‡ Offer 68 - II. äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</a></h3><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚</p><p><a href="https://baike.baidu.com/item/%E6%9C%80%E8%BF%91%E5%85%AC%E5%85%B1%E7%A5%96%E5%85%88/8918834?fr=aladdin">ç™¾åº¦ç™¾ç§‘</a>ä¸­æœ€è¿‘å…¬å…±ç¥–å…ˆçš„å®šä¹‰ä¸ºï¼šâ€œå¯¹äºæœ‰æ ¹æ ‘ T çš„ä¸¤ä¸ªç»“ç‚¹ pã€qï¼Œæœ€è¿‘å…¬å…±ç¥–å…ˆè¡¨ç¤ºä¸ºä¸€ä¸ªç»“ç‚¹ xï¼Œæ»¡è¶³ x æ˜¯ pã€q çš„ç¥–å…ˆä¸” x çš„æ·±åº¦å°½å¯èƒ½å¤§ï¼ˆ<strong>ä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥æ˜¯å®ƒè‡ªå·±çš„ç¥–å…ˆ</strong>ï¼‰ã€‚â€</p><p>ä¾‹å¦‚ï¼Œç»™å®šå¦‚ä¸‹äºŒå‰æ ‘: root &#x3D; [3,5,1,6,2,0,8,null,null,7,4]</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210501154050.png" alt="img"></p><p><strong>ç¤ºä¾‹ 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: root = [3,5,1,6,2,0,8,null,null,7,4], p = 5, q = 1</span><br><span class="line">è¾“å‡º: 3</span><br><span class="line">è§£é‡Š: èŠ‚ç‚¹ 5 å’ŒèŠ‚ç‚¹ 1 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯èŠ‚ç‚¹ 3ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: root = [3,5,1,6,2,0,8,null,null,7,4], p = 5, q = 4</span><br><span class="line">è¾“å‡º: 5</span><br><span class="line">è§£é‡Š: èŠ‚ç‚¹ 5 å’ŒèŠ‚ç‚¹ 4 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯èŠ‚ç‚¹ 5ã€‚å› ä¸ºæ ¹æ®å®šä¹‰æœ€è¿‘å…¬å…±ç¥–å…ˆèŠ‚ç‚¹å¯ä»¥ä¸ºèŠ‚ç‚¹æœ¬èº«ã€‚</span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜:</strong></p><ul><li>æ‰€æœ‰èŠ‚ç‚¹çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ã€‚</li><li>pã€q ä¸ºä¸åŒèŠ‚ç‚¹ä¸”å‡å­˜åœ¨äºç»™å®šçš„äºŒå‰æ ‘ä¸­ã€‚</li></ul><p>æ³¨æ„ï¼šæœ¬é¢˜ä¸ä¸»ç«™ 236 é¢˜ç›¸åŒï¼š<a href="https://leetcode-cn.com/problems/lowest-common-ancestor-of-a-binary-tree/">https://leetcode-cn.com/problems/lowest-common-ancestor-of-a-binary-tree/</a></p><h4 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//TODO</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ </tag>
            
            <tag> æ¯å‘¨æ‰“å¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLå¸¸è§é¢è¯•é¢˜</title>
      <link href="/posts/e27205e0.html"/>
      <url>/posts/e27205e0.html</url>
      
        <content type="html"><![CDATA[<h2 id="æ•°æ®åº“ä¼˜åŒ–ï¼š"><a href="#æ•°æ®åº“ä¼˜åŒ–ï¼š" class="headerlink" title="æ•°æ®åº“ä¼˜åŒ–ï¼š"></a>æ•°æ®åº“ä¼˜åŒ–ï¼š</h2><h3 id="ç´¢å¼•å¤±æ•ˆçš„åœºæ™¯ï¼š"><a href="#ç´¢å¼•å¤±æ•ˆçš„åœºæ™¯ï¼š" class="headerlink" title="ç´¢å¼•å¤±æ•ˆçš„åœºæ™¯ï¼š"></a>ç´¢å¼•å¤±æ•ˆçš„åœºæ™¯ï¼š</h3><ol><li>like ä»¥%å¼€å¤´ï¼Œç´¢å¼•æ— æ•ˆï¼›å½“likeå‰ç¼€æ²¡æœ‰%ï¼Œåç¼€æœ‰%æ—¶ï¼Œç´¢å¼•æœ‰æ•ˆã€‚</li><li>orè¯­å¥å‰åæ²¡æœ‰åŒæ—¶ä½¿ç”¨ç´¢å¼•ã€‚å½“orå·¦å³æŸ¥è¯¢å­—æ®µåªæœ‰ä¸€ä¸ªæ˜¯ç´¢å¼•ï¼Œè¯¥ç´¢å¼•å¤±æ•ˆï¼Œåªæœ‰å½“orå·¦å³æŸ¥è¯¢å­—æ®µå‡ä¸ºç´¢å¼•æ—¶ï¼Œæ‰ä¼šç”Ÿæ•ˆã€‚</li><li>ç»„åˆç´¢å¼•ï¼Œä¸æ˜¯ä½¿ç”¨ç¬¬ä¸€åˆ—ç´¢å¼•ï¼Œç´¢å¼•å¤±æ•ˆã€‚</li><li>æ•°æ®ç±»å‹å‡ºç°éšå¼è½¬åŒ–ã€‚å¦‚varcharä¸åŠ å•å¼•å·çš„è¯å¯èƒ½ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºintå‹ï¼Œä½¿ç´¢å¼•æ— æ•ˆï¼Œäº§ç”Ÿå…¨è¡¨æ‰«æã€‚</li><li>åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨ IS NULL æˆ– IS NOT NULLæ“ä½œã€‚ç´¢å¼•æ˜¯ä¸ç´¢å¼•ç©ºå€¼çš„ï¼Œæ‰€ä»¥è¿™æ ·çš„æ“ä½œä¸èƒ½ä½¿ç”¨ç´¢å¼•ï¼Œå¯ä»¥ç”¨å…¶ä»–çš„åŠæ³•å¤„ç†ï¼Œä¾‹å¦‚ï¼šæ•°å­—ç±»å‹ï¼Œåˆ¤æ–­å¤§äº0ï¼Œå­—ç¬¦ä¸²ç±»å‹è®¾ç½®ä¸€ä¸ªé»˜è®¤å€¼ï¼Œåˆ¤æ–­æ˜¯å¦ç­‰äºé»˜è®¤å€¼å³å¯ã€‚</li><li>åœ¨ç´¢å¼•å­—æ®µä¸Šä½¿ç”¨notï¼Œ&lt;&gt;ï¼Œ!&#x3D;ã€‚ä¸ç­‰äºæ“ä½œç¬¦æ˜¯æ°¸è¿œä¸ä¼šç”¨åˆ°ç´¢å¼•çš„ï¼Œå› æ­¤å¯¹å®ƒçš„å¤„ç†åªä¼šäº§ç”Ÿå…¨è¡¨æ‰«æã€‚ ä¼˜åŒ–æ–¹æ³•ï¼š key&lt;&gt;0 æ”¹ä¸º key&gt;0 or key&lt;0ã€‚</li><li>å¯¹ç´¢å¼•å­—æ®µè¿›è¡Œè®¡ç®—æ“ä½œã€‚</li><li>åœ¨ç´¢å¼•å­—æ®µä¸Šä½¿ç”¨å‡½æ•°ã€‚</li><li>å½“å…¨è¡¨æ‰«æé€Ÿåº¦æ¯”ç´¢å¼•é€Ÿåº¦å¿«æ—¶ï¼Œmysqlä¼šä½¿ç”¨å…¨è¡¨æ‰«æï¼Œæ­¤æ—¶ç´¢å¼•å¤±æ•ˆã€‚</li></ol><p>ç´¢å¼•å¤±æ•ˆåˆ†æå·¥å…·ï¼š</p><p>å¯ä»¥ä½¿ç”¨explainå‘½ä»¤åŠ åœ¨è¦åˆ†æçš„sqlè¯­å¥å‰é¢ï¼Œåœ¨æ‰§è¡Œç»“æœä¸­æŸ¥çœ‹keyè¿™ä¸€åˆ—çš„å€¼ï¼Œå¦‚æœä¸ºNULLï¼Œè¯´æ˜æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ã€‚</p><h3 id="ç´¢å¼•ä½¿ç”¨æ³¨æ„äº‹é¡¹"><a href="#ç´¢å¼•ä½¿ç”¨æ³¨æ„äº‹é¡¹" class="headerlink" title="ç´¢å¼•ä½¿ç”¨æ³¨æ„äº‹é¡¹"></a>ç´¢å¼•ä½¿ç”¨æ³¨æ„äº‹é¡¹</h3><ol><li>ä¸è¦æ»¥ç”¨ç´¢å¼•<ul><li>ç´¢å¼•æé«˜æŸ¥è¯¢é€Ÿåº¦ï¼Œå´ä¼šé™ä½æ›´æ–°è¡¨çš„é€Ÿåº¦ï¼Œå› ä¸ºæ›´æ–°è¡¨æ—¶ï¼Œmysqlä¸ä»…è¦æ›´æ–°æ•°æ®ï¼Œä¿å­˜æ•°æ®ï¼Œè¿˜è¦æ›´æ–°ç´¢å¼•ï¼Œä¿å­˜ç´¢å¼•</li><li>ç´¢å¼•ä¼šå ç”¨ç£ç›˜ç©ºé—´</li></ul></li><li>ç´¢å¼•ä¸ä¼šåŒ…å«å«æœ‰NULLå€¼çš„åˆ—    ï¼Œå¤åˆç´¢å¼•åªè¦æœ‰ä¸€åˆ—å«æœ‰NULLå€¼ï¼Œé‚£ä¹ˆè¿™ä¸€åˆ—å¯¹äºæ­¤ç¬¦åˆç´¢å¼•å°±æ˜¯æ— æ•ˆçš„ï¼Œå› æ­¤æˆ‘ä»¬åœ¨è®¾è®¡æ•°æ®åº“è®¾è®¡æ—¶ä¸è¦è®©å­—æ®µçš„é»˜è®¤å€¼ä¸ºNULLã€‚ </li><li>MySQLæŸ¥è¯¢åªæ˜¯ç”¨ä¸€ä¸ªç´¢å¼•ï¼Œå¦‚æœwhereå­—å¥ä¸­ä½¿ç”¨äº†ç´¢å¼•çš„è¯ï¼Œé‚£ä¹ˆorder byä¸­çš„åˆ—æ˜¯ä¸ä¼šä½¿ç”¨ç´¢å¼•çš„ </li><li>likeï¼šlike â€˜%aaa%â€™ä¸ä¼šä½¿ç”¨ç´¢å¼•è€Œlike â€œaaa%â€å¯ä»¥ä½¿ç”¨ç´¢å¼•</li></ol><h3 id="è”åˆç´¢å¼•æœ€å·¦åŒ¹é…åŸåˆ™"><a href="#è”åˆç´¢å¼•æœ€å·¦åŒ¹é…åŸåˆ™" class="headerlink" title="è”åˆç´¢å¼•æœ€å·¦åŒ¹é…åŸåˆ™"></a>è”åˆç´¢å¼•æœ€å·¦åŒ¹é…åŸåˆ™</h3><ol><li>æ˜¯ä¸æ˜¯ç”¨ç´¢å¼•ï¼Œå’ŒæŸ¥è¯¢æ¡ä»¶çš„é¡ºåºæ— å…³ï¼ˆä¼˜åŒ–å™¨ä¼šè‡ªåŠ¨è°ƒæ•´æ¡ä»¶çš„é¡ºåºï¼‰ï¼Œä½†å’Œè¿™äº›å­—æ®µçš„æŸ¥è¯¢æ‰‹æ®µæœ‰å…³</li><li>å»ºç«‹äº†abcçš„è”åˆç´¢å¼•ï¼Œç›¸å½“äºå»ºç«‹äº† açš„å•åˆ—ç´¢å¼•ï¼Œabçš„è”åˆç´¢å¼•ï¼Œä»¥åŠabcçš„è”åˆç´¢å¼•</li><li>ä¸€èˆ¬æ ¹æ®æœ€å·¦åŒ¹é…çš„åŸåˆ™ï¼Œä½†åœ¨é‡åˆ°èŒƒå›´æŸ¥è¯¢åï¼ŒåŒ¹é…ç»ˆæ­¢ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æ¡ä»¶ä¸ºï¼š<br>a like â€˜%str%â€™ã€a like â€˜%strâ€™ æ—¶ï¼Œä¸èµ°ç´¢å¼•ï¼›å½“æ¡ä»¶ä¸º a like â€˜str%â€™ æˆ–è€… â€œ&gt;â€, â€œ&lt;â€, â€œbetweenâ€æ—¶ï¼Œ ä»…ä½¿ç”¨äº†<strong>è”åˆç´¢å¼•ä¸­açš„éƒ¨åˆ†</strong>ï¼›<br>bï¼Œc åŒç†ï¼Œæ ¹æ®æŸ¥è¯¢æ–¹å¼ä¸åŒï¼Œå³ä¾¿æ¡ä»¶ä¸­çš„3ä¸ªå­—æ®µéƒ½åœ¨ç´¢å¼•é‡Œï¼Œä¹Ÿä¸ä¸€å®šä½¿ç”¨äº†å…¨ç´¢å¼•<br>å‡å¦‚æ¡ä»¶æ˜¯  a &#x3D; 1 and b &#x3D; 2 and c &#x3D; 3 è¿™ç±»æƒ…å†µï¼Œæ˜¯å¿…ç„¶èµ°è¿™ä¸ªè”åˆç´¢å¼•äº†</li></ol><h3 id="æˆ‘ä»¬çš„æ•°æ®åº“å½“ä¸­å¦‚ä½•åšçš„ä¼˜åŒ–"><a href="#æˆ‘ä»¬çš„æ•°æ®åº“å½“ä¸­å¦‚ä½•åšçš„ä¼˜åŒ–" class="headerlink" title="æˆ‘ä»¬çš„æ•°æ®åº“å½“ä¸­å¦‚ä½•åšçš„ä¼˜åŒ–?"></a>æˆ‘ä»¬çš„æ•°æ®åº“å½“ä¸­å¦‚ä½•åšçš„ä¼˜åŒ–?</h3><ul><li>å¯¹æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ï¼Œè¦å°½é‡é¿å…å…¨è¡¨æ‰«æï¼Œé¦–å…ˆåº”è€ƒè™‘åœ¨ where åŠ order by æ¶‰åŠçš„åˆ—ä¸Šå»ºç«‹ç´¢å¼•ã€‚</li><li>åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œ null å€¼åˆ¤æ–­ï¼Œå¦åˆ™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æ</li><li>åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­ä½¿ç”¨ !&#x3D; æˆ– &lt;&gt; æ“ä½œç¬¦ï¼Œå¦åˆ™å°†å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æã€‚</li><li>åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­ä½¿ç”¨ or æ¥è¿æ¥æ¡ä»¶ï¼Œå¦‚æœä¸€ä¸ªå­—æ®µæœ‰ç´¢å¼•ï¼Œä¸€ä¸ªå­—æ®µæ²¡æœ‰ç´¢å¼•ï¼Œå°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æ</li><li>in å’Œ not in ä¹Ÿè¦æ…ç”¨ï¼Œå¦åˆ™ä¼šå¯¼è‡´å…¨è¡¨æ‰«æï¼ˆå½“æ•°æ®åº“äººä¸ºINå’ŒNotInä½¿ç”¨ç´¢å¼•æŸ¥è¯¢çš„æ•ˆç‡ä¸å¦‚å…¨è¡¨æ‰«ææ—¶ä¼šæ”¾å¼ƒä½¿ç”¨ç´¢å¼•è½¬è€Œä½¿ç”¨æƒæ ‡æ‰«æï¼‰</li><li>likeæ¨¡ç³Šå…¨åŒ¹é…ä¹Ÿå°†å¯¼è‡´å…¨è¡¨æ‰«æ</li></ul><h3 id="å›è¡¨æŸ¥è¯¢å’Œç´¢å¼•è¦†ç›–æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#å›è¡¨æŸ¥è¯¢å’Œç´¢å¼•è¦†ç›–æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="å›è¡¨æŸ¥è¯¢å’Œç´¢å¼•è¦†ç›–æ˜¯ä»€ä¹ˆï¼Ÿ"></a>å›è¡¨æŸ¥è¯¢å’Œç´¢å¼•è¦†ç›–æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>æ¦‚å¿µï¼š</p><ul><li>å›è¡¨æŸ¥è¯¢ï¼šå…ˆå®šä½ä¸»é”®å€¼ï¼Œå†å®šä½è¡Œè®°å½•ï¼Œå®ƒçš„æ€§èƒ½è¾ƒæ‰«ä¸€éç´¢å¼•æ ‘æ›´ä½</li><li>ç´¢å¼•è¦†ç›–ï¼šåœ¨ä¸€æ£µç´¢å¼•æ ‘ä¸Šå°±èƒ½è·å–SQLæ‰€éœ€çš„æ‰€æœ‰åˆ—æ•°æ®ï¼Œæ— éœ€å›è¡¨ï¼Œå³å®ç°äº†ç´¢å¼•è¦†ç›–</li></ul><p>å¦‚ä½•å®ç°ç´¢å¼•è¦†ç›–ï¼š</p><ul><li>ä¸»é”®ç´¢å¼•å­˜å‚¨çš„æ˜¯ä¸»é”®å€¼å’Œè¡Œè®°å½•ï¼ˆå³èšç°‡ç´¢å¼•ï¼‰ï¼Œæ— éœ€å›è¡¨æŸ¥è¯¢</li><li>æ™®é€šç´¢å¼•å­˜å‚¨çš„æ˜¯ç´¢å¼•å’Œrowidçš„å€¼ï¼ŒæŸ¥è¯¢å…¶ä»–å­—æ®µï¼ˆérowidå­—æ®µå’Œå…¶ä»–å­—æ®µï¼‰éœ€è¦å›è¡¨æŸ¥è¯¢ï¼Œå»ºç«‹è”åˆç´¢å¼•å®ç°ç´¢å¼•è¦†ç›–å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜</li></ul><p>ç»“åˆä¸‹é¢çš„å®ä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># æœ‰ä¸€å¼ è¡¨</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `test` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `a` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `b` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `c` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `a` (`a`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">4</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"># è¿™å‡ æ¡è¯­å¥æœ‰ä»€ä¹ˆåŒºåˆ«</span><br><span class="line"></span><br><span class="line"># æ²¡æœ‰åŒºåˆ«ï¼Œæ²¡æœ‰å›è¡¨æŸ¥è¯¢</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">SELECT</span> id <span class="keyword">from</span> test <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">SELECT</span> a <span class="keyword">from</span> test <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"># ç¬¬ä¸€å¥ä¼šå‡ºç°å›è¡¨æŸ¥è¯¢ï¼Œå…¶ä½™éƒ½ç›´æ¥å¯ä»¥æŸ¥åˆ°æ•°æ®</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">where</span> a <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">SELECT</span> id <span class="keyword">from</span> test <span class="keyword">where</span> a <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">SELECT</span> a <span class="keyword">from</span> test <span class="keyword">where</span> a <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"># æ²¡æœ‰ç´¢å¼•ï¼Œéƒ½æ˜¯å…¨è¡¨æŸ¥è¯¢</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">where</span> b <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">SELECT</span> id <span class="keyword">from</span> test <span class="keyword">where</span> b <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">SELECT</span> a <span class="keyword">from</span> test <span class="keyword">where</span> b <span class="operator">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h3 id="Select-from-table-where-a-â€˜1â€™-and-b-â€˜2â€™-and-c-â€™3â€™-ç´¢å¼•-a-b-c-æ˜¯å¦èµ°ç´¢å¼•"><a href="#Select-from-table-where-a-â€˜1â€™-and-b-â€˜2â€™-and-c-â€™3â€™-ç´¢å¼•-a-b-c-æ˜¯å¦èµ°ç´¢å¼•" class="headerlink" title="Select * from table where a &#x3D; â€˜1â€™ and b &gt; â€˜2â€™ and c&#x3D;â€™3â€™ ç´¢å¼•(a,b,c)æ˜¯å¦èµ°ç´¢å¼•"></a>Select * from table where a &#x3D; â€˜1â€™ and b &gt; â€˜2â€™ and c&#x3D;â€™3â€™ ç´¢å¼•(a,b,c)æ˜¯å¦èµ°ç´¢å¼•</h3><p>åœ¨aã€bèµ°å®Œç´¢å¼•åï¼Œcè‚¯å®šæ˜¯æ— åºäº†ï¼Œæ‰€ä»¥cå°±æ²¡æ³•èµ°ç´¢å¼•ï¼Œæ•°æ®åº“ä¼šè§‰å¾—è¿˜ä¸å¦‚å…¨è¡¨æ‰«æcå­—æ®µæ¥çš„å¿«ï¼ˆæ‰«æå…¨éƒ¨æ»¡è¶³a&#x3D;1å’Œb&gt;2çš„çºªå½•ï¼‰</p><p> å§‹ç»ˆè®°å¾—ï¼Œåœ¨æ•°æ®åº“ä¸­æ˜¯å…ˆæŒ‰ç…§aæ’åºï¼ŒåæŒ‰ç…§bæ’åºï¼Œæœ€åæŒ‰ç…§cæ’åºã€‚ é¦–å…ˆç´¢å¼•æ‰¾aï¼Œæ‰¾åˆ°ååœ¨aç›¸ç­‰çš„æ¡ä»¶ä¸‹ï¼Œbå¿…ç„¶æ˜¯æœ‰åºçš„ã€‚å› ä¸ºå…ˆæŒ‰ç…§aæ’åºï¼Œè‹¥aç›¸åŒï¼ŒæŒ‰ç…§bæ’åºï¼Œå› æ­¤aç›¸ç­‰çš„æ¡ä»¶ä¸‹ï¼Œbå¿…ç„¶æœ‰åºã€‚ å¥½ï¼Œæˆ‘ä»¬ç»§ç»­ã€‚å½“æ‰¾åˆ°æ‰€æœ‰b&gt;2çš„ä¹‹åï¼Œcè¿˜æœ‰åºä¹ˆï¼Ÿä¸ï¼Œcä¸æœ‰åºã€‚å› ä¸ºï¼ˆb,cï¼‰çš„ç»„åˆå¯ä»¥æ˜¯ï¼ˆ100000,1ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ï¼ˆ1ï¼Œ100ï¼‰ã€‚å‘ç°äº†ä¹ˆï¼Œå½“ä½ æ ¹æ®bæ‰¾åˆ°åŒºé—´ä¹‹åï¼Œcæ˜¯æ— åºçš„ï¼Œå› ä¸ºbå’Œcä¹‹é—´æ²¡æœ‰å…³ç³»ã€‚ä½ ä¸èƒ½ä¿è¯æ‰€æœ‰å¤§äº2çš„bçš„é‚£äº›è®°å½•ä¸­ï¼Œcè¿˜æ˜¯æœ‰åºçš„ã€‚</p><h3 id="ç°åœ¨ä¸€å¼ è¡¨tableï¼Œæœ‰a-b-cä¸‰ä¸ªç´¢å¼•ï¼Œselect-from-table-where-a-1-and-b-2-order-by-cï¼Œè¿™äº›å­—æ®µæ˜¯å¦éƒ½èƒ½ä½¿ç”¨ç´¢å¼•ï¼Ÿå¦‚æœä¸èƒ½æ€ä¹ˆä¼˜åŒ–"><a href="#ç°åœ¨ä¸€å¼ è¡¨tableï¼Œæœ‰a-b-cä¸‰ä¸ªç´¢å¼•ï¼Œselect-from-table-where-a-1-and-b-2-order-by-cï¼Œè¿™äº›å­—æ®µæ˜¯å¦éƒ½èƒ½ä½¿ç”¨ç´¢å¼•ï¼Ÿå¦‚æœä¸èƒ½æ€ä¹ˆä¼˜åŒ–" class="headerlink" title="ç°åœ¨ä¸€å¼ è¡¨tableï¼Œæœ‰a,b,cä¸‰ä¸ªç´¢å¼•ï¼Œselect * from table where a &#x3D; 1 and b &#x3D; 2 order by cï¼Œè¿™äº›å­—æ®µæ˜¯å¦éƒ½èƒ½ä½¿ç”¨ç´¢å¼•ï¼Ÿå¦‚æœä¸èƒ½æ€ä¹ˆä¼˜åŒ–"></a>ç°åœ¨ä¸€å¼ è¡¨tableï¼Œæœ‰a,b,cä¸‰ä¸ªç´¢å¼•ï¼Œselect * from table where a &#x3D; 1 and b &#x3D; 2 order by cï¼Œè¿™äº›å­—æ®µæ˜¯å¦éƒ½èƒ½ä½¿ç”¨ç´¢å¼•ï¼Ÿå¦‚æœä¸èƒ½æ€ä¹ˆä¼˜åŒ–</h3><p><a href="https://blog.csdn.net/gb4215287/article/details/78037835">https://blog.csdn.net/gb4215287/article/details/78037835</a><br>ä¸å…¶è¯´æ˜¯æ•°æ®åº“åªæ”¯æŒä¸€æ¡æŸ¥è¯¢è¯­å¥åªä½¿ç”¨ä¸€ä¸ªç´¢å¼•ï¼Œå€’ä¸å¦‚è¯´Næ¡ç‹¬ç«‹ç´¢å¼•åŒæ—¶åœ¨ä¸€æ¡è¯­å¥ä½¿ç”¨çš„æ¶ˆè€—æ¯”åªä½¿ç”¨ä¸€ä¸ªç´¢å¼•è¿˜è¦æ…¢ã€‚<br>æ‰€ä»¥å¦‚ä¸Šæ¡çš„æƒ…å†µï¼Œæœ€ä½³æ¨èæ˜¯ä½¿ç”¨index(column1,column2,column3ï¼‰ è¿™ç§è”åˆç´¢å¼•ï¼Œæ­¤è”åˆç´¢å¼•å¯ä»¥æŠŠb+treeç»“æ„çš„ä¼˜åŠ¿å‘æŒ¥å¾—æ·‹æ¼“å°½è‡´ï¼š<br>ä¸€æ¡ä¸»äºŒå‰æ ‘ï¼ˆcolumn&#x3D;1ï¼‰ï¼ŒæŸ¥è¯¢åˆ°column&#x3D;1èŠ‚ç‚¹ååŸºäºå½“å‰èŠ‚ç‚¹è¿›è¡ŒäºŒçº§äºŒå‰æ ‘column2&#x3D;fooçš„æŸ¥è¯¢ï¼Œåœ¨äºŒçº§äºŒå‰æ ‘æŸ¥è¯¢åˆ°column2&#x3D;fooåï¼Œå»ä¸‰çº§äºŒå‰æ ‘column3&#x3D;baræŸ¥æ‰¾ã€‚</p><h2 id="ç´¢å¼•åº•å±‚æ•°æ®ç»“æ„ï¼š"><a href="#ç´¢å¼•åº•å±‚æ•°æ®ç»“æ„ï¼š" class="headerlink" title="ç´¢å¼•åº•å±‚æ•°æ®ç»“æ„ï¼š"></a>ç´¢å¼•åº•å±‚æ•°æ®ç»“æ„ï¼š</h2><h3 id="MySqlä¸­InnoDBè¡¨ä¸ºä»€ä¹ˆè¦å»ºè®®ç”¨è‡ªå¢åˆ—åšä¸»é”®"><a href="#MySqlä¸­InnoDBè¡¨ä¸ºä»€ä¹ˆè¦å»ºè®®ç”¨è‡ªå¢åˆ—åšä¸»é”®" class="headerlink" title="MySqlä¸­InnoDBè¡¨ä¸ºä»€ä¹ˆè¦å»ºè®®ç”¨è‡ªå¢åˆ—åšä¸»é”®"></a>MySqlä¸­InnoDBè¡¨ä¸ºä»€ä¹ˆè¦å»ºè®®ç”¨è‡ªå¢åˆ—åšä¸»é”®</h3><p><a href="https://blog.csdn.net/bigtree_3721/article/details/73151028">https://blog.csdn.net/bigtree_3721/article/details/73151028</a></p><p>InnoDBå¼•æ“è¡¨çš„ç‰¹ç‚¹ï¼š</p><ol><li>InnoDBå¼•æ“è¡¨æ˜¯åŸºäºB+æ ‘çš„ç´¢å¼•ç»„ç»‡è¡¨(IOT)</li></ol><p>å…³äºB+æ ‘<br><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210427162633.jpeg" alt="img"><br>B+ æ ‘çš„ç‰¹ç‚¹:</p><p>ï¼ˆ1ï¼‰æ‰€æœ‰å…³é”®å­—éƒ½å‡ºç°åœ¨å¶å­ç»“ç‚¹çš„é“¾è¡¨ä¸­(ç¨ å¯†ç´¢å¼•)ï¼Œä¸”é“¾è¡¨ä¸­çš„å…³é”®å­—æ°å¥½æ˜¯æœ‰åºçš„;</p><p>ï¼ˆ2ï¼‰ä¸å¯èƒ½åœ¨éå¶å­ç»“ç‚¹å‘½ä¸­;</p><p>ï¼ˆ3ï¼‰éå¶å­ç»“ç‚¹ç›¸å½“äºæ˜¯å¶å­ç»“ç‚¹çš„ç´¢å¼•(ç¨€ç–ç´¢å¼•)ï¼Œå¶å­ç»“ç‚¹ç›¸å½“äºæ˜¯å­˜å‚¨(å…³é”®å­—)æ•°æ®çš„æ•°æ®å±‚;</p><ol start="2"><li>å¦‚æœæˆ‘ä»¬å®šä¹‰äº†ä¸»é”®(PRIMARY KEY)ï¼Œé‚£ä¹ˆInnoDBä¼šé€‰æ‹©ä¸»é”®ä½œä¸ºèšé›†ç´¢å¼•ã€å¦‚æœæ²¡æœ‰æ˜¾å¼å®šä¹‰ä¸»é”®ï¼Œåˆ™InnoDBä¼šé€‰æ‹©ç¬¬ä¸€ä¸ªä¸åŒ…å«æœ‰NULLå€¼çš„å”¯ä¸€ç´¢å¼•ä½œä¸ºä¸»é”®ç´¢å¼•ã€å¦‚æœä¹Ÿæ²¡æœ‰è¿™æ ·çš„å”¯ä¸€ç´¢å¼•ï¼Œåˆ™InnoDBä¼šé€‰æ‹©å†…ç½®6å­—èŠ‚é•¿çš„ROWIDä½œä¸ºéšå«çš„èšé›†ç´¢å¼•(ROWIDéšç€è¡Œè®°å½•çš„å†™å…¥è€Œä¸»é”®é€’å¢ï¼Œè¿™ä¸ªROWIDä¸åƒORACLEçš„ROWIDé‚£æ ·å¯å¼•ç”¨ï¼Œæ˜¯éšå«çš„)ã€‚</li><li>æ•°æ®è®°å½•æœ¬èº«è¢«å­˜äºä¸»ç´¢å¼•ï¼ˆä¸€é¢—B+Treeï¼‰çš„å¶å­èŠ‚ç‚¹ä¸Šã€‚è¿™å°±è¦æ±‚åŒä¸€ä¸ªå¶å­èŠ‚ç‚¹å†…ï¼ˆå¤§å°ä¸ºä¸€ä¸ªå†…å­˜é¡µæˆ–ç£ç›˜é¡µï¼‰çš„å„æ¡æ•°æ®è®°å½•æŒ‰ä¸»é”®é¡ºåºå­˜æ”¾ï¼Œå› æ­¤æ¯å½“æœ‰ä¸€æ¡æ–°çš„è®°å½•æ’å…¥æ—¶ï¼ŒMySQLä¼šæ ¹æ®å…¶ä¸»é”®å°†å…¶æ’å…¥é€‚å½“çš„èŠ‚ç‚¹å’Œä½ç½®ï¼Œå¦‚æœé¡µé¢è¾¾åˆ°è£…è½½å› å­ï¼ˆInnoDBé»˜è®¤ä¸º15&#x2F;16ï¼‰ï¼Œåˆ™å¼€è¾Ÿä¸€ä¸ªæ–°çš„é¡µï¼ˆèŠ‚ç‚¹ï¼‰</li><li>å¦‚æœè¡¨ä½¿ç”¨è‡ªå¢ä¸»é”®ï¼Œé‚£ä¹ˆæ¯æ¬¡æ’å…¥æ–°çš„è®°å½•ï¼Œè®°å½•å°±ä¼šé¡ºåºæ·»åŠ åˆ°å½“å‰ç´¢å¼•èŠ‚ç‚¹çš„åç»­ä½ç½®ï¼Œå½“ä¸€é¡µå†™æ»¡ï¼Œå°±ä¼šè‡ªåŠ¨å¼€è¾Ÿä¸€ä¸ªæ–°çš„é¡µ</li><li>å¦‚æœä½¿ç”¨éè‡ªå¢ä¸»é”®ï¼ˆå¦‚æœèº«ä»½è¯å·æˆ–å­¦å·ç­‰ï¼‰ï¼Œç”±äºæ¯æ¬¡æ’å…¥ä¸»é”®çš„å€¼è¿‘ä¼¼äºéšæœºï¼Œå› æ­¤æ¯æ¬¡æ–°çºªå½•éƒ½è¦è¢«æ’åˆ°ç°æœ‰ç´¢å¼•é¡µå¾—ä¸­é—´æŸä¸ªä½ç½®ï¼Œæ­¤æ—¶MySQLä¸å¾—ä¸ä¸ºäº†å°†æ–°è®°å½•æ’åˆ°åˆé€‚ä½ç½®è€Œç§»åŠ¨æ•°æ®ï¼Œç”šè‡³ç›®æ ‡é¡µé¢å¯èƒ½å·²ç»è¢«å›å†™åˆ°ç£ç›˜ä¸Šè€Œä»ç¼“å­˜ä¸­æ¸…æ‰ï¼Œæ­¤æ—¶åˆè¦ä»ç£ç›˜ä¸Šè¯»å›æ¥ï¼Œè¿™å¢åŠ äº†å¾ˆå¤šå¼€é”€ï¼ŒåŒæ—¶é¢‘ç¹çš„ç§»åŠ¨ã€åˆ†é¡µæ“ä½œé€ æˆäº†å¤§é‡çš„ç¢ç‰‡ï¼Œå¾—åˆ°äº†ä¸å¤Ÿç´§å‡‘çš„ç´¢å¼•ç»“æ„ï¼Œåç»­ä¸å¾—ä¸é€šè¿‡OPTIMIZE TABLEæ¥é‡å»ºè¡¨å¹¶ä¼˜åŒ–å¡«å……é¡µé¢ã€‚</li></ol><p>ç»¼ä¸Šæ€»ç»“ï¼Œå¦‚æœInnoDBè¡¨çš„æ•°æ®å†™å…¥é¡ºåºèƒ½å’ŒB+æ ‘ç´¢å¼•çš„å¶å­èŠ‚ç‚¹é¡ºåºä¸€è‡´çš„è¯ï¼Œè¿™æ—¶å€™å­˜å–æ•ˆç‡æ˜¯æœ€é«˜çš„ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢è¿™å‡ ç§æƒ…å†µçš„å­˜å–æ•ˆç‡æœ€é«˜ï¼š</p><ol><li>ä½¿ç”¨è‡ªå¢åˆ—(INT&#x2F;BIGINTç±»å‹)åšä¸»é”®ï¼Œè¿™æ—¶å€™å†™å…¥é¡ºåºæ˜¯è‡ªå¢çš„ï¼Œå’ŒB+æ•°å¶å­èŠ‚ç‚¹åˆ†è£‚é¡ºåºä¸€è‡´ï¼›</li><li>è¯¥è¡¨ä¸æŒ‡å®šè‡ªå¢åˆ—åšä¸»é”®ï¼ŒåŒæ—¶ä¹Ÿæ²¡æœ‰å¯ä»¥è¢«é€‰ä¸ºä¸»é”®çš„å”¯ä¸€ç´¢å¼•(ä¸Šé¢çš„æ¡ä»¶)ï¼Œè¿™æ—¶å€™InnoDBä¼šé€‰æ‹©å†…ç½®çš„ROWIDä½œä¸ºä¸»é”®ï¼Œå†™å…¥é¡ºåºå’ŒROWIDå¢é•¿é¡ºåºä¸€è‡´ï¼›<br>é™¤æ­¤ä»¥å¤–ï¼Œå¦‚æœä¸€ä¸ªInnoDBè¡¨åˆæ²¡æœ‰æ˜¾ç¤ºä¸»é”®ï¼Œåˆæœ‰å¯ä»¥è¢«é€‰æ‹©ä¸ºä¸»é”®çš„å”¯ä¸€ç´¢å¼•ï¼Œä½†è¯¥å”¯ä¸€ç´¢å¼•å¯èƒ½ä¸æ˜¯é€’å¢å…³ç³»æ—¶(ä¾‹å¦‚å­—ç¬¦ä¸²ã€UUIDã€å¤šå­—æ®µè”åˆå”¯ä¸€ç´¢å¼•çš„æƒ…å†µ)ï¼Œè¯¥è¡¨çš„å­˜å–æ•ˆç‡å°±ä¼šæ¯”è¾ƒå·®ã€‚</li></ol><h3 id="MySqlä¸ºä»€ä¹ˆä½¿ç”¨B-Treeä½œä¸ºç´¢å¼•è€Œä¸æ˜¯å…¶ä»–äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆæ¯”å¦‚çº¢é»‘æ ‘ç­‰ï¼‰ï¼Ÿ"><a href="#MySqlä¸ºä»€ä¹ˆä½¿ç”¨B-Treeä½œä¸ºç´¢å¼•è€Œä¸æ˜¯å…¶ä»–äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆæ¯”å¦‚çº¢é»‘æ ‘ç­‰ï¼‰ï¼Ÿ" class="headerlink" title="MySqlä¸ºä»€ä¹ˆä½¿ç”¨B-Treeä½œä¸ºç´¢å¼•è€Œä¸æ˜¯å…¶ä»–äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆæ¯”å¦‚çº¢é»‘æ ‘ç­‰ï¼‰ï¼Ÿ"></a>MySqlä¸ºä»€ä¹ˆä½¿ç”¨B-Treeä½œä¸ºç´¢å¼•è€Œä¸æ˜¯å…¶ä»–äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆæ¯”å¦‚çº¢é»‘æ ‘ç­‰ï¼‰ï¼Ÿ</h3><p><a href="https://www.cnblogs.com/aspirant/p/9214485.html">https://www.cnblogs.com/aspirant/p/9214485.html</a><br>å¹³è¡¡äºŒå‰æ ‘ä¸é€‚åˆä½œä¸ºç´¢å¼•ã€‚é‚£ä¹ˆä»€ä¹ˆæ‰é€‚åˆä½œä¸ºç´¢å¼•â€”â€”Bæ ‘ã€‚</p><p>å¹³è¡¡äºŒå‰æ ‘æ²¡èƒ½å……åˆ†åˆ©ç”¨ç£ç›˜é¢„è¯»åŠŸèƒ½ï¼Œè€ŒBæ ‘æ˜¯ä¸ºäº†å……åˆ†åˆ©ç”¨ç£ç›˜é¢„è¯»åŠŸèƒ½æ¥è€Œåˆ›å»ºçš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œä¹Ÿå°±æ˜¯è¯´Bæ ‘å°±æ˜¯ä¸ºäº†ä½œä¸ºç´¢å¼•æ‰è¢«å‘æ˜å‡ºæ¥çš„çš„ã€‚</p><p>æ¥çœ‹çœ‹å…³äºâ€œå±€éƒ¨æ€§åŸç†ä¸ç£ç›˜é¢„è¯»â€çš„çŸ¥è¯†ï¼š </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">å±€éƒ¨æ€§åŸç†ä¸ç£ç›˜é¢„è¯»ï¼š</span><br><span class="line"></span><br><span class="line">ç”±äºå­˜å‚¨ä»‹è´¨çš„ç‰¹æ€§ï¼Œç£ç›˜æœ¬èº«å­˜å–å°±æ¯”ä¸»å­˜æ…¢å¾ˆå¤šï¼Œå†åŠ ä¸Šæœºæ¢°è¿åŠ¨è€—è´¹ï¼Œç£ç›˜çš„å­˜å–é€Ÿåº¦å¾€å¾€æ˜¯ä¸»å­˜çš„å‡ ç™¾åˆ†åˆ†ä¹‹ä¸€ï¼Œå› æ­¤ä¸ºäº†æé«˜æ•ˆç‡ï¼Œè¦å°½é‡å‡å°‘ç£ç›˜I/Oã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œç£ç›˜å¾€å¾€ä¸æ˜¯ä¸¥æ ¼æŒ‰éœ€è¯»å–ï¼Œè€Œæ˜¯æ¯æ¬¡éƒ½ä¼šé¢„è¯»ï¼Œå³ä½¿åªéœ€è¦ä¸€ä¸ªå­—èŠ‚ï¼Œç£ç›˜ä¹Ÿä¼šä»è¿™ä¸ªä½ç½®å¼€å§‹ï¼Œé¡ºåºå‘åè¯»å–ä¸€å®šé•¿åº¦çš„æ•°æ®æ”¾å…¥å†…å­˜ã€‚è¿™æ ·åšçš„ç†è®ºä¾æ®æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­è‘—åçš„å±€éƒ¨æ€§åŸç†ï¼š </span><br><span class="line">å½“ä¸€ä¸ªæ•°æ®è¢«ç”¨åˆ°æ—¶ï¼Œå…¶é™„è¿‘çš„æ•°æ®ä¹Ÿé€šå¸¸ä¼šé©¬ä¸Šè¢«ä½¿ç”¨ã€‚ </span><br><span class="line">ç¨‹åºè¿è¡ŒæœŸé—´æ‰€éœ€è¦çš„æ•°æ®é€šå¸¸æ¯”è¾ƒé›†ä¸­ã€‚ </span><br><span class="line">ç”±äºç£ç›˜é¡ºåºè¯»å–çš„æ•ˆç‡å¾ˆé«˜ï¼ˆä¸éœ€è¦å¯»é“æ—¶é—´ï¼Œåªéœ€å¾ˆå°‘çš„æ—‹è½¬æ—¶é—´ï¼‰ï¼Œå› æ­¤å¯¹äºå…·æœ‰å±€éƒ¨æ€§çš„ç¨‹åºæ¥è¯´ï¼Œé¢„è¯»å¯ä»¥æé«˜I/Oæ•ˆç‡ã€‚</span><br></pre></td></tr></table></figure><p>ææ¸…æ¥šä¸Šé¢çš„æ„æ€ã€‚ç£ç›˜é¢„è¯»æ˜¯å…·ä½“å®ç°ï¼Œå…¶ç†è®ºä¾æ®æ˜¯å±€éƒ¨æ€§åŸç†ã€‚</p><p>ä¸ºä»€ä¹ˆè¯´çº¢é»‘æ ‘æ²¡èƒ½å……åˆ†åˆ©ç”¨ç£ç›˜é¢„è¯»åŠŸèƒ½ï¼Œå¼•ç”¨ä¸€ç¯‡åšæ–‡çš„ä¸€æ®µè¯ï¼š </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">çº¢é»‘æ ‘è¿™ç§ç»“æ„ï¼Œhæ˜æ˜¾è¦æ·±çš„å¤šã€‚ç”±äºé€»è¾‘ä¸Šå¾ˆè¿‘çš„èŠ‚ç‚¹ï¼ˆçˆ¶å­ï¼‰ç‰©ç†ä¸Šå¯èƒ½å¾ˆè¿œï¼Œæ— æ³•åˆ©ç”¨å±€éƒ¨æ€§ï¼Œæ‰€ä»¥çº¢é»‘æ ‘çš„I/Oæ¸è¿›å¤æ‚åº¦ä¹Ÿä¸ºO(h)ï¼Œæ•ˆç‡æ˜æ˜¾æ¯”B-Treeå·®å¾ˆå¤šã€‚</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨çº¢é»‘æ ‘ï¼ˆå¹³è¡¡äºŒå‰æ ‘ï¼‰ç»“æ„çš„è¯ï¼Œæ¯æ¬¡ç£ç›˜é¢„è¯»ä¸­çš„å¾ˆå¤šæ•°æ®æ˜¯ç”¨ä¸ä¸Šçš„æ•°æ®ã€‚å› æ­¤ï¼Œå®ƒæ²¡èƒ½åˆ©ç”¨å¥½ç£ç›˜é¢„è¯»çš„æä¾›çš„æ•°æ®ã€‚ç„¶ååˆç”±äºæ·±åº¦å¤§ï¼ˆè¾ƒBæ ‘è€Œè¨€ï¼‰ï¼Œæ‰€ä»¥è¿›è¡Œçš„ç£ç›˜IOæ“ä½œæ›´å¤šã€‚</p><p>Bæ ‘çš„æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥å­˜å‚¨å¤šä¸ªå…³é”®å­—ï¼Œå®ƒå°†èŠ‚ç‚¹å¤§å°è®¾ç½®ä¸ºç£ç›˜é¡µçš„å¤§å°ï¼Œå……åˆ†åˆ©ç”¨äº†ç£ç›˜é¢„è¯»çš„åŠŸèƒ½ã€‚æ¯æ¬¡è¯»å–ç£ç›˜é¡µæ—¶å°±ä¼šè¯»å–ä¸€æ•´ä¸ªèŠ‚ç‚¹ã€‚ä¹Ÿæ­£å› æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨ç€éå¸¸å¤šä¸ªå…³é”®å­—ï¼Œæ ‘çš„æ·±åº¦å°±ä¼šéå¸¸çš„å°ã€‚è¿›è€Œè¦æ‰§è¡Œçš„ç£ç›˜è¯»å–æ“ä½œæ¬¡æ•°å°±ä¼šéå¸¸å°‘ï¼Œæ›´å¤šçš„æ˜¯åœ¨å†…å­˜ä¸­å¯¹è¯»å–è¿›æ¥çš„æ•°æ®è¿›è¡ŒæŸ¥æ‰¾ã€‚</p><p>Bæ ‘çš„æŸ¥è¯¢ï¼Œä¸»è¦å‘ç”Ÿåœ¨å†…å­˜ä¸­ï¼Œè€Œå¹³è¡¡äºŒå‰æ ‘çš„æŸ¥è¯¢ï¼Œåˆ™æ˜¯å‘ç”Ÿåœ¨ç£ç›˜è¯»å–ä¸­ã€‚å› æ­¤ï¼Œè™½ç„¶Bæ ‘æŸ¥è¯¢æŸ¥è¯¢çš„æ¬¡æ•°ä¸æ¯”å¹³è¡¡äºŒå‰æ ‘çš„æ¬¡æ•°å°‘ï¼Œä½†æ˜¯ç›¸æ¯”èµ·ç£ç›˜IOé€Ÿåº¦ï¼Œå†…å­˜ä¸­æ¯”è¾ƒçš„è€—æ—¶å°±å¯ä»¥å¿½ç•¥ä¸è®¡äº†ã€‚å› æ­¤ï¼ŒBæ ‘æ›´é€‚åˆä½œä¸ºç´¢å¼•ã€‚</p><h3 id="ä¸ºä»€ä¹ˆç”¨B-Treeä½œä¸ºç´¢å¼•è€Œä¸æ˜¯B-Tree"><a href="#ä¸ºä»€ä¹ˆç”¨B-Treeä½œä¸ºç´¢å¼•è€Œä¸æ˜¯B-Tree" class="headerlink" title="ä¸ºä»€ä¹ˆç”¨B+-Treeä½œä¸ºç´¢å¼•è€Œä¸æ˜¯B-Tree"></a>ä¸ºä»€ä¹ˆç”¨B+-Treeä½œä¸ºç´¢å¼•è€Œä¸æ˜¯B-Tree</h3><p>æ¯”Bæ ‘æ›´é€‚åˆä½œä¸ºç´¢å¼•çš„ç»“æ„æ˜¯B+æ ‘ã€‚MySQLä¸­ä¹Ÿæ˜¯ä½¿ç”¨B+æ ‘ä½œä¸ºç´¢å¼•ã€‚å®ƒæ˜¯Bæ ‘çš„å˜ç§ï¼Œå› æ­¤æ˜¯åŸºäºBæ ‘æ¥æ”¹è¿›çš„ã€‚ä¸ºä»€ä¹ˆB+æ ‘ä¼šæ¯”Bæ ‘æ›´åŠ ä¼˜ç§€å‘¢ï¼Ÿ</p><p>Bæ ‘ï¼šæœ‰åºæ•°ç»„+å¹³è¡¡å¤šå‰æ ‘ï¼›<br>B+æ ‘ï¼šæœ‰åºæ•°ç»„é“¾è¡¨+å¹³è¡¡å¤šå‰æ ‘ï¼›</p><p>B+æ ‘çš„å…³é”®å­—å…¨éƒ¨å­˜æ”¾åœ¨å¶å­èŠ‚ç‚¹ä¸­ï¼Œéå¶å­èŠ‚ç‚¹ç”¨æ¥åšç´¢å¼•ï¼Œè€Œå¶å­èŠ‚ç‚¹ä¸­æœ‰ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸€ä¸‹ä¸ªå¶å­èŠ‚ç‚¹ã€‚åšè¿™ä¸ªä¼˜åŒ–çš„ç›®çš„æ˜¯ä¸ºäº†æé«˜åŒºé—´è®¿é—®çš„æ€§èƒ½ã€‚è€Œæ­£æ˜¯è¿™ä¸ªç‰¹æ€§å†³å®šäº†B+æ ‘æ›´é€‚åˆç”¨æ¥å­˜å‚¨å¤–éƒ¨æ•°æ®ã€‚</p><p>å¼•ç”¨ä¸€æ®µè¯ï¼š </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">èµ°è¿›æœç´¢å¼•æ“çš„ä½œè€…æ¢æ–Œè€å¸ˆé’ˆå¯¹Bæ ‘ã€B+æ ‘ç»™å‡ºäº†ä»–çš„æ„è§ï¼ˆä¸ºäº†çœŸå®æ€§ï¼Œç‰¹å¼•ç”¨å…¶åŸè¯ï¼Œæœªä½œä»»ä½•æ”¹åŠ¨ï¼‰ï¼š â€œB+æ ‘è¿˜æœ‰ä¸€ä¸ªæœ€å¤§çš„å¥½å¤„ï¼Œæ–¹ä¾¿æ‰«åº“ï¼ŒBæ ‘å¿…é¡»ç”¨ä¸­åºéå†çš„æ–¹æ³•æŒ‰åºæ‰«åº“ï¼Œè€ŒB+æ ‘ç›´æ¥ä»å¶å­ç»“ç‚¹æŒ¨ä¸ªæ‰«ä¸€éå°±å®Œäº†ï¼ŒB+æ ‘æ”¯æŒrange-queryéå¸¸æ–¹ä¾¿ï¼Œè€ŒBæ ‘ä¸æ”¯æŒã€‚è¿™æ˜¯æ•°æ®åº“é€‰ç”¨B+æ ‘çš„æœ€ä¸»è¦åŸå› ã€‚ </span><br><span class="line">æ¯”å¦‚è¦æŸ¥ 5-10ä¹‹é—´çš„ï¼ŒB+æ ‘ä¸€æŠŠåˆ°5è¿™ä¸ªæ ‡è®°ï¼Œå†ä¸€æŠŠåˆ°10ï¼Œç„¶åä¸²èµ·æ¥å°±è¡Œäº†ï¼ŒBæ ‘å°±éå¸¸éº»çƒ¦ã€‚Bæ ‘çš„å¥½å¤„ï¼Œå°±æ˜¯æˆåŠŸæŸ¥è¯¢ç‰¹åˆ«æœ‰åˆ©ï¼Œå› ä¸ºæ ‘çš„é«˜åº¦æ€»ä½“è¦æ¯”B+æ ‘çŸ®ã€‚ä¸æˆåŠŸçš„æƒ…å†µä¸‹ï¼ŒBæ ‘ä¹Ÿæ¯”B+æ ‘ç¨ç¨å ä¸€ç‚¹ç‚¹ä¾¿å®œã€‚ </span><br><span class="line">Bæ ‘æ¯”å¦‚ä½ çš„ä¾‹å­ä¸­æŸ¥ï¼Œ17çš„è¯ï¼Œä¸€æŠŠå°±å¾—åˆ°ç»“æœäº†ï¼Œ </span><br><span class="line">æœ‰å¾ˆå¤šåŸºäºé¢‘ç‡çš„æœç´¢æ˜¯é€‰ç”¨Bæ ‘ï¼Œè¶Šé¢‘ç¹queryçš„ç»“ç‚¹è¶Šå¾€æ ¹ä¸Šèµ°ï¼Œå‰ææ˜¯éœ€è¦å¯¹queryåšç»Ÿè®¡ï¼Œè€Œä¸”è¦å¯¹keyåšä¸€äº›å˜åŒ–ã€‚ </span><br><span class="line">å¦å¤–Bæ ‘ä¹Ÿå¥½B+æ ‘ä¹Ÿå¥½ï¼Œæ ¹æˆ–è€…ä¸Šé¢å‡ å±‚å› ä¸ºè¢«åå¤queryï¼Œæ‰€ä»¥è¿™å‡ å—åŸºæœ¬éƒ½åœ¨å†…å­˜ä¸­ï¼Œä¸ä¼šå‡ºç°è¯»ç£ç›˜IOï¼Œä¸€èˆ¬å·²å¯åŠ¨çš„æ—¶å€™ï¼Œå°±ä¼šä¸»åŠ¨æ¢å…¥å†…å­˜ã€‚â€</span><br></pre></td></tr></table></figure><p>ä¸¾ä¸ªä¾‹å­æ¥å¯¹æ¯”ã€‚<br>Bæ ‘ï¼š </p><p>æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬è¦æŸ¥æ‰¾å…³é”®å­—èŒƒå›´åœ¨3åˆ°7çš„å…³é”®å­—ï¼Œåœ¨æ‰¾åˆ°ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„æ•°å­—3åï¼Œè®¿é—®å®Œç¬¬ä¸€ä¸ªå…³é”®å­—æ‰€åœ¨çš„å—åï¼Œå¾—éå†è¿™ä¸ªBæ ‘ï¼Œè·å–ä¸‹ä¸€ä¸ªå—ï¼Œç›´åˆ°é‡åˆ°ä¸€ä¸ªä¸ç¬¦åˆæ¡ä»¶çš„å…³é”®å­—ã€‚éå†çš„è¿‡ç¨‹æ˜¯æ¯”è¾ƒå¤æ‚çš„ã€‚</p><p>B+æ ‘(å¶èŠ‚ç‚¹ä¿å­˜æ•°æ®ï¼Œå…¶ä»–çš„èŠ‚ç‚¹ å…¨éƒ¨å­˜æ”¾ç´¢å¼•)ï¼š </p><p>ç›¸æ¯”ä¹‹ä¸‹ï¼ŒB+æ ‘çš„åŸºäºèŒƒå›´çš„æŸ¥è¯¢ç®€æ´å¾ˆå¤šã€‚ç”±äºå¶å­èŠ‚ç‚¹æœ‰æŒ‡å‘ä¸‹ä¸€ä¸ªå¶å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå› æ­¤ä»å—1åˆ°å—2çš„è®¿é—®ï¼Œé€šè¿‡å—1æŒ‡å‘å—2çš„æŒ‡é’ˆå³å¯ã€‚ä»å—2åˆ°å—3ä¹Ÿæ˜¯é€šè¿‡ä¸€ä¸ªæŒ‡é’ˆå³å¯ã€‚</p><p>å¼•ç”¨ä¸€ç¯‡åšæ–‡ä¸­ç½‘å‹è¯„è®ºçš„ä¸€æ®µè¯ï¼š </p><p>æ•°æ®åº“ç´¢å¼•é‡‡ç”¨B+æ ‘çš„ä¸»è¦åŸå› æ˜¯Bæ ‘åœ¨æé«˜äº†ç£ç›˜IOæ€§èƒ½çš„åŒæ—¶å¹¶æ²¡æœ‰è§£å†³å…ƒç´ éå†çš„æ•ˆç‡ä½ä¸‹çš„é—®é¢˜ã€‚æ­£æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒB+æ ‘åº”è¿è€Œç”Ÿã€‚<br>B+æ ‘åªè¦éå†å¶å­èŠ‚ç‚¹å°±å¯ä»¥å®ç°æ•´æ£µæ ‘çš„éå†ã€‚è€Œä¸”åœ¨æ•°æ®åº“ä¸­åŸºäºèŒƒå›´çš„æŸ¥è¯¢æ˜¯éå¸¸é¢‘ç¹çš„ï¼Œè€ŒBæ ‘ä¸æ”¯æŒè¿™æ ·çš„æ“ä½œï¼ˆæˆ–è€…è¯´æ•ˆç‡å¤ªä½ï¼‰ã€‚<br>æ­£å¦‚ä¸Šé¢æ‰€è¯´ï¼Œåœ¨æ•°æ®åº“ä¸­åŸºäºèŒƒå›´çš„æŸ¥è¯¢æ˜¯éå¸¸é¢‘ç¹çš„ï¼Œå› æ­¤MySQLæœ€ç»ˆé€‰æ‹©çš„ç´¢å¼•ç»“æ„æ˜¯B+æ ‘è€Œä¸æ˜¯Bæ ‘ã€‚ </p><h3 id="B-æ ‘å’Œ-B-æ ‘åœ¨æ„é€ å’ŒæŸ¥è¯¢æ€§èƒ½ä¸Šæœ‰ä»€ä¹ˆå·®å¼‚å‘¢ï¼Ÿ"><a href="#B-æ ‘å’Œ-B-æ ‘åœ¨æ„é€ å’ŒæŸ¥è¯¢æ€§èƒ½ä¸Šæœ‰ä»€ä¹ˆå·®å¼‚å‘¢ï¼Ÿ" class="headerlink" title="B+ æ ‘å’Œ B æ ‘åœ¨æ„é€ å’ŒæŸ¥è¯¢æ€§èƒ½ä¸Šæœ‰ä»€ä¹ˆå·®å¼‚å‘¢ï¼Ÿ"></a>B+ æ ‘å’Œ B æ ‘åœ¨æ„é€ å’ŒæŸ¥è¯¢æ€§èƒ½ä¸Šæœ‰ä»€ä¹ˆå·®å¼‚å‘¢ï¼Ÿ</h3><p>B+ æ ‘çš„ä¸­é—´èŠ‚ç‚¹å¹¶ä¸ç›´æ¥å­˜å‚¨æ•°æ®ã€‚</p><ol><li>B+æ ‘çš„æŸ¥è¯¢æ•ˆç‡æ›´åŠ ç¨³å®šï¼šç”±äºéç»ˆç»“ç‚¹å¹¶ä¸æ˜¯æœ€ç»ˆæŒ‡å‘æ–‡ä»¶å†…å®¹çš„ç»“ç‚¹ï¼Œè€Œåªæ˜¯å¶å­ç»“ç‚¹ä¸­å…³é”®å­—çš„ç´¢å¼•ã€‚æ‰€ä»¥ä»»ä½•å…³é”®å­—çš„æŸ¥æ‰¾å¿…é¡»èµ°ä¸€æ¡ä»æ ¹ç»“ç‚¹åˆ°å¶å­ç»“ç‚¹çš„è·¯ã€‚æ‰€æœ‰å…³é”®å­—æŸ¥è¯¢çš„è·¯å¾„é•¿åº¦ç›¸åŒï¼Œå¯¼è‡´æ¯ä¸€ä¸ªæ•°æ®çš„æŸ¥è¯¢æ•ˆç‡ç›¸å½“ã€‚</li><li>B+æ ‘çš„ç£ç›˜è¯»å†™ä»£ä»·æ›´ä½ï¼šB+æ ‘çš„å†…éƒ¨èŠ‚ç‚¹å¹¶æ²¡æœ‰æŒ‡å‘å…³é”®å­—å…·ä½“ä¿¡æ¯çš„æŒ‡é’ˆï¼Œå› æ­¤å…¶å†…éƒ¨èŠ‚ç‚¹ç›¸å¯¹Bæ ‘æ›´å°ï¼Œå¦‚æœæŠŠæ‰€æœ‰åŒä¸€å†…éƒ¨èŠ‚ç‚¹çš„å…³é”®å­—å­˜æ”¾åœ¨åŒä¸€ç›˜å—ä¸­ï¼Œé‚£ä¹ˆç›˜å—æ‰€èƒ½å®¹çº³çš„å…³é”®å­—æ•°é‡ä¹Ÿè¶Šå¤šï¼Œä¸€æ¬¡æ€§è¯»å…¥å†…å­˜çš„éœ€è¦æŸ¥æ‰¾çš„å…³é”®å­—ä¹Ÿå°±è¶Šå¤šï¼Œç›¸å¯¹IOè¯»å†™æ¬¡æ•°å°±é™ä½äº†ã€‚</li><li>ç”±äºB+æ ‘çš„æ•°æ®éƒ½å­˜å‚¨åœ¨å¶å­ç»“ç‚¹ä¸­ï¼Œåˆ†æ”¯ç»“ç‚¹å‡ä¸ºç´¢å¼•ï¼Œæ–¹ä¾¿æ‰«åº“ï¼Œåªéœ€è¦æ‰«ä¸€éå¶å­ç»“ç‚¹å³å¯ï¼Œä½†æ˜¯Bæ ‘å› ä¸ºå…¶åˆ†æ”¯ç»“ç‚¹åŒæ ·å­˜å‚¨ç€æ•°æ®ï¼Œæˆ‘ä»¬è¦æ‰¾åˆ°å…·ä½“çš„æ•°æ®ï¼Œéœ€è¦è¿›è¡Œä¸€æ¬¡ä¸­åºéå†æŒ‰åºæ¥æ‰«ï¼Œæ‰€ä»¥B+æ ‘æ›´åŠ é€‚åˆåœ¨åŒºé—´æŸ¥è¯¢çš„æƒ…å†µï¼Œæ‰€ä»¥é€šå¸¸B+æ ‘ç”¨äºæ•°æ®åº“ç´¢å¼•ã€‚</li></ol><h3 id="æ•°æ®åº“ç´¢å¼•ï¼Œä¸ºä»€ä¹ˆä¸é€‚ç”¨ç”¨äºŒå‰æ ‘ï¼š"><a href="#æ•°æ®åº“ç´¢å¼•ï¼Œä¸ºä»€ä¹ˆä¸é€‚ç”¨ç”¨äºŒå‰æ ‘ï¼š" class="headerlink" title="æ•°æ®åº“ç´¢å¼•ï¼Œä¸ºä»€ä¹ˆä¸é€‚ç”¨ç”¨äºŒå‰æ ‘ï¼š"></a>æ•°æ®åº“ç´¢å¼•ï¼Œä¸ºä»€ä¹ˆä¸é€‚ç”¨ç”¨äºŒå‰æ ‘ï¼š</h3><ol><li>å¹³è¡¡äºŒå‰æ ‘å¿…é¡»æ»¡è¶³ï¼ˆæ‰€æœ‰èŠ‚ç‚¹çš„å·¦å³å­æ ‘é«˜åº¦å·®ä¸è¶…è¿‡1ï¼‰ã€‚æ‰§è¡Œæ’å…¥è¿˜æ˜¯åˆ é™¤æ“ä½œï¼Œåªè¦ä¸æ»¡è¶³ä¸Šè¿°æ¡ä»¶ï¼Œå°±è¦é€šè¿‡æ—‹è½¬æ¥ä¿æŒå¹³è¡¡ï¼Œè€Œæ—‹è½¬æ˜¯éå¸¸è€—æ—¶çš„ï¼Œæ‰€ä»¥AVLæ ‘é€‚åˆç”¨äºæŸ¥æ‰¾å¤šçš„æƒ…å†µã€‚</li><li>äºŒå‰æ ‘çš„æ•°æ®ç»“æ„ï¼Œä¼šå¯¼è‡´â€œæ·±åº¦â€ï¼Œæ¯”è¾ƒæ·±ï¼Œè¿™ç§â€œç˜¦é«˜â€çš„ç‰¹æ€§ï¼ŒåŠ å¤§äº†å¹³å‡æŸ¥è¯¢çš„ç£ç›˜IOæ¬¡æ•°ï¼Œéšç€æ•°æ®é‡çš„å¢å¤šï¼ŒæŸ¥è¯¢æ•ˆç‡ä¹Ÿä¼šå—åˆ°å½±å“ï¼›</li></ol><h2 id="æ•°æ®åº“é”"><a href="#æ•°æ®åº“é”" class="headerlink" title="æ•°æ®åº“é”"></a>æ•°æ®åº“é”</h2><h3 id="MySqlæ‚²è§‚é”å’Œä¹è§‚é”å¦‚ä½•å®ç°"><a href="#MySqlæ‚²è§‚é”å’Œä¹è§‚é”å¦‚ä½•å®ç°" class="headerlink" title="MySqlæ‚²è§‚é”å’Œä¹è§‚é”å¦‚ä½•å®ç°"></a>MySqlæ‚²è§‚é”å’Œä¹è§‚é”å¦‚ä½•å®ç°</h3><ul><li><p>ç¡®ä¿åœ¨å¤šä¸ªäº‹åŠ¡åŒæ—¶å­˜å–æ•°æ®åº“ä¸­åŒä¸€æ•°æ®æ—¶ä¸ç ´åäº‹åŠ¡çš„éš”ç¦»æ€§å’Œç»Ÿä¸€æ€§ä»¥åŠæ•°æ®åº“çš„ç»Ÿä¸€æ€§ï¼Œ<strong>ä¹è§‚é”å’Œæ‚²è§‚é”æ˜¯å¹¶å‘æ§åˆ¶ä¸»è¦é‡‡ç”¨çš„æŠ€æœ¯æ‰‹æ®µã€‚</strong></p><ul><li><p>æ‚²è§‚é”ï¼šå‡å®šä¼šå‘ç”Ÿå¹¶å‘å†²çªï¼Œå±è”½ä¸€åˆ‡å¯èƒ½è¿åæ•°æ®å®Œæ•´æ€§çš„æ“ä½œ</p></li><li><ul><li><strong>åœ¨æŸ¥è¯¢å®Œæ•°æ®çš„æ—¶å€™å°±æŠŠäº‹åŠ¡é”èµ·æ¥ï¼Œç›´åˆ°æäº¤äº‹åŠ¡</strong></li><li>å®ç°æ–¹å¼ï¼šä½¿ç”¨æ•°æ®åº“ä¸­çš„é”æœºåˆ¶</li></ul></li><li><p>ä¹è§‚é”ï¼šå‡è®¾ä¸ä¼šå‘ç”Ÿå¹¶å‘å†²çªï¼Œåªåœ¨æäº¤æ“ä½œæ—¶æ£€æŸ¥æ˜¯å¦è¿åæ•°æ®å®Œæ•´æ€§ã€‚</p></li><li><ul><li><strong>åœ¨ä¿®æ”¹æ•°æ®çš„æ—¶å€™æŠŠäº‹åŠ¡é”èµ·æ¥ï¼Œé€šè¿‡versionçš„æ–¹å¼æ¥è¿›è¡Œé”å®š</strong></li><li>å®ç°æ–¹å¼ï¼šä½¿ç”¨versionç‰ˆæœ¬æˆ–è€…æ—¶é—´æˆ³</li></ul></li></ul><p>æ‚²è§‚é”ï¼šç¼ºç‚¹æ€§èƒ½ä½</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> eb_sku <span class="keyword">where</span> sku_id <span class="operator">=</span> <span class="number">1001</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line"><span class="keyword">update</span> eb_sku <span class="keyword">set</span> stock <span class="operator">=</span> <span class="number">100</span><span class="operator">-</span> $&#123;quantity&#125; <span class="keyword">where</span> sku_id <span class="operator">=</span> <span class="number">10001</span></span><br></pre></td></tr></table></figure><p>ä¹è§‚é”ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> eb_sku <span class="keyword">set</span> stock <span class="operator">=</span> <span class="number">100</span><span class="operator">-</span>$&#123;quantity&#125;, version <span class="operator">=</span> $&#123;version&#125;<span class="operator">+</span><span class="number">1</span> <span class="keyword">where</span> sku_id <span class="operator">=</span> $&#123;sku_id&#125; <span class="keyword">and</span> version<span class="operator">=</span>$&#123;version&#125; <span class="keyword">and</span> stock <span class="operator">&gt;</span> $&#123;quantity&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="è¡Œé”ã€è¡¨é”"><a href="#è¡Œé”ã€è¡¨é”" class="headerlink" title="è¡Œé”ã€è¡¨é”"></a>è¡Œé”ã€è¡¨é”</h3><h3 id="é—´éš™é”ã€ä¸´é”®é”"><a href="#é—´éš™é”ã€ä¸´é”®é”" class="headerlink" title="é—´éš™é”ã€ä¸´é”®é”"></a>é—´éš™é”ã€ä¸´é”®é”</h3><h2 id="åˆ†åº“åˆ†è¡¨"><a href="#åˆ†åº“åˆ†è¡¨" class="headerlink" title="åˆ†åº“åˆ†è¡¨"></a>åˆ†åº“åˆ†è¡¨</h2><h3 id="ä¸ºä»€ä¹ˆè¦åˆ†åº“åˆ†è¡¨"><a href="#ä¸ºä»€ä¹ˆè¦åˆ†åº“åˆ†è¡¨" class="headerlink" title="ä¸ºä»€ä¹ˆè¦åˆ†åº“åˆ†è¡¨"></a>ä¸ºä»€ä¹ˆè¦åˆ†åº“åˆ†è¡¨</h3><h3 id="æŒ‰ç…§ä»€ä¹ˆé€»è¾‘åˆ†åº“åˆ†è¡¨"><a href="#æŒ‰ç…§ä»€ä¹ˆé€»è¾‘åˆ†åº“åˆ†è¡¨" class="headerlink" title="æŒ‰ç…§ä»€ä¹ˆé€»è¾‘åˆ†åº“åˆ†è¡¨"></a>æŒ‰ç…§ä»€ä¹ˆé€»è¾‘åˆ†åº“åˆ†è¡¨</h3><h3 id="åˆ†åº“åˆ†è¡¨å¦‚ä½•æ‰©å®¹"><a href="#åˆ†åº“åˆ†è¡¨å¦‚ä½•æ‰©å®¹" class="headerlink" title="åˆ†åº“åˆ†è¡¨å¦‚ä½•æ‰©å®¹"></a>åˆ†åº“åˆ†è¡¨å¦‚ä½•æ‰©å®¹</h3><h2 id="å…¶ä»–çŸ¥è¯†ç‚¹"><a href="#å…¶ä»–çŸ¥è¯†ç‚¹" class="headerlink" title="å…¶ä»–çŸ¥è¯†ç‚¹"></a>å…¶ä»–çŸ¥è¯†ç‚¹</h2><h3 id="Mysqlä¸­utf-8å’Œutf8mb4çš„åŒºåˆ«ä¸ä½¿ç”¨åœºæ™¯"><a href="#Mysqlä¸­utf-8å’Œutf8mb4çš„åŒºåˆ«ä¸ä½¿ç”¨åœºæ™¯" class="headerlink" title="Mysqlä¸­utf-8å’Œutf8mb4çš„åŒºåˆ«ä¸ä½¿ç”¨åœºæ™¯"></a>Mysqlä¸­utf-8å’Œutf8mb4çš„åŒºåˆ«ä¸ä½¿ç”¨åœºæ™¯</h3><p>MySQLä¸­çš„<strong>utf8</strong>ç¼–ç åªæ”¯æŒæœ€å¤§3å­—èŠ‚æ¯å­—ç¬¦ï¼Œ<strong>utf8mb4</strong>æ‰æ˜¯ çœŸæ­£æ„ä¹‰ä¸Šçš„â€œUTF-8â€ï¼Œutf8mb4æ”¯æŒ4å­—èŠ‚æ¯å­—ç¬¦ï¼Œæ”¯æŒå­˜å‚¨emojiï¼Œè€Œutf8ä¸æ”¯æŒã€‚</p><h3 id="MySql-Innodbå¼•æ“å’ŒMyIASMå¼•æ“çš„åŒºåˆ«"><a href="#MySql-Innodbå¼•æ“å’ŒMyIASMå¼•æ“çš„åŒºåˆ«" class="headerlink" title="MySql Innodbå¼•æ“å’ŒMyIASMå¼•æ“çš„åŒºåˆ«"></a>MySql Innodbå¼•æ“å’ŒMyIASMå¼•æ“çš„åŒºåˆ«</h3><h4 id="Innodbå¼•æ“"><a href="#Innodbå¼•æ“" class="headerlink" title="Innodbå¼•æ“"></a>Innodbå¼•æ“</h4><ul><li>Innodbå¼•æ“æä¾›äº†å¯¹æ•°æ®åº“ACIDäº‹åŠ¡çš„æ”¯æŒï¼Œå¹¶ä¸”å®ç°äº†SQLæ ‡å‡†çš„å››ç§éš”ç¦»çº§åˆ«ã€‚</li><li>è¯¥å¼•æ“è¿˜æä¾›äº†è¡Œçº§é”å’Œå¤–é”®çº¦æŸ</li><li>ä½¿ç”¨è¡Œçº§é”ä¹Ÿä¸æ˜¯ç»å¯¹çš„ï¼Œå¦‚æœåœ¨æ‰§è¡Œä¸€ä¸ªSQLè¯­å¥æ—¶MySQLä¸èƒ½ç¡®å®šè¦æ‰«æçš„èŒƒå›´ï¼ŒInnoDBè¡¨åŒæ ·ä¼šé”å…¨è¡¨ã€‚</li><li>å®ƒçš„è®¾è®¡ç›®æ ‡æ˜¯å¤„ç†å¤§å®¹é‡æ•°æ®åº“ç³»ç»Ÿï¼Œå®ƒæœ¬èº«å…¶å®å°±æ˜¯åŸºäºMySQLåå°çš„å®Œæ•´æ•°æ®åº“ç³»ç»Ÿ</li><li>MySQLè¿è¡Œæ—¶Innodbä¼šåœ¨å†…å­˜ä¸­å»ºç«‹ç¼“å†²æ± ï¼Œç”¨äºç¼“å†²æ•°æ®å’Œç´¢å¼•ã€‚</li><li>è¯¥å¼•æ“ä¸æ”¯æŒFULLTEXTç±»å‹çš„ç´¢å¼•ï¼ˆä¸æ”¯æŒå…¨æ–‡ç´¢å¼•ï¼‰ã€‚</li><li>å®ƒæ²¡æœ‰ä¿å­˜è¡¨çš„è¡Œæ•°ï¼Œå½“SELECT COUNT(*) FROM TABLEæ—¶éœ€è¦æ‰«æå…¨è¡¨ã€‚</li><li>å½“éœ€è¦ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡æ—¶ï¼Œè¯¥å¼•æ“å½“ç„¶æ˜¯é¦–é€‰ã€‚</li><li>ç”±äºé”çš„ç²’åº¦æ›´å°ï¼Œå†™æ“ä½œä¸ä¼šé”å®šå…¨è¡¨ï¼Œæ‰€ä»¥åœ¨å¹¶å‘è¾ƒé«˜æ—¶ï¼Œä½¿ç”¨Innodbå¼•æ“ä¼šæå‡æ•ˆç‡ã€‚</li></ul><h4 id="MyIASMå¼•æ“"><a href="#MyIASMå¼•æ“" class="headerlink" title="MyIASMå¼•æ“"></a>MyIASMå¼•æ“</h4><ul><li>ä½†æ˜¯å®ƒæ²¡æœ‰æä¾›å¯¹æ•°æ®åº“äº‹åŠ¡çš„æ”¯æŒï¼Œä¹Ÿä¸æ”¯æŒè¡Œçº§é”å’Œå¤–é”®ï¼Œ</li><li>å› æ­¤å½“INSERT(æ’å…¥)æˆ–UPDATE(æ›´æ–°)æ•°æ®æ—¶å³å†™æ“ä½œéœ€è¦é”å®šæ•´ä¸ªè¡¨ï¼Œæ•ˆç‡ä¾¿ä¼šä½ä¸€äº›ã€‚</li><li>MyIASMä¸­å­˜å‚¨äº†è¡¨çš„è¡Œæ•°ï¼Œäºæ˜¯SELECT COUNT(*) FROM TABLEæ—¶åªéœ€è¦ç›´æ¥è¯»å–å·²ç»ä¿å­˜å¥½çš„å€¼è€Œä¸éœ€è¦è¿›è¡Œå…¨è¡¨æ‰«æã€‚</li><li>å¦‚æœè¡¨çš„è¯»æ“ä½œè¿œè¿œå¤šäºå†™æ“ä½œä¸”ä¸éœ€è¦æ•°æ®åº“äº‹åŠ¡çš„æ”¯æŒï¼Œé‚£ä¹ˆMyIASMä¹Ÿæ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚</li></ul><h4 id="ä¸»è¦åŒºåˆ«ï¼š"><a href="#ä¸»è¦åŒºåˆ«ï¼š" class="headerlink" title="ä¸»è¦åŒºåˆ«ï¼š"></a>ä¸»è¦åŒºåˆ«ï¼š</h4><ol><li>MyIASMæ˜¯éäº‹åŠ¡å®‰å…¨çš„ï¼Œè€ŒInnoDBæ˜¯äº‹åŠ¡å®‰å…¨çš„</li><li>MyIASMé”çš„ç²’åº¦æ˜¯è¡¨çº§çš„ï¼Œè€ŒInnoDBæ”¯æŒè¡Œçº§é”</li><li>MyIASMæ”¯æŒå…¨æ–‡ç±»å‹ç´¢å¼•ï¼Œè€ŒInnoDBä¸æ”¯æŒå…¨æ–‡ç´¢å¼•</li><li>MyIASMç›¸å¯¹ç®€å•ï¼Œæ•ˆç‡ä¸Šè¦ä¼˜äºInnoDBï¼Œå°å‹åº”ç”¨å¯ä»¥è€ƒè™‘ä½¿ç”¨MyIASM</li><li>MyIASMè¡¨ä¿å­˜æˆæ–‡ä»¶å½¢å¼ï¼Œè·¨å¹³å°ä½¿ç”¨æ›´åŠ æ–¹ä¾¿</li></ol><h4 id="åº”ç”¨åœºæ™¯ï¼š"><a href="#åº”ç”¨åœºæ™¯ï¼š" class="headerlink" title="åº”ç”¨åœºæ™¯ï¼š"></a>åº”ç”¨åœºæ™¯ï¼š</h4><ol><li>MyIASMç®¡ç†éäº‹åŠ¡è¡¨ï¼Œæä¾›é«˜é€Ÿå­˜å‚¨å’Œæ£€ç´¢ä»¥åŠå…¨æ–‡æœç´¢èƒ½åŠ›ï¼Œå¦‚æœå†åº”ç”¨ä¸­æ‰§è¡Œå¤§é‡selectæ“ä½œï¼Œåº”è¯¥é€‰æ‹©MyIASM</li><li>InnoDBç”¨äºäº‹åŠ¡å¤„ç†ï¼Œå…·æœ‰ACIDäº‹åŠ¡æ”¯æŒç­‰ç‰¹æ€§ï¼Œå¦‚æœåœ¨åº”ç”¨ä¸­æ‰§è¡Œå¤§é‡insertå’Œupdateæ“ä½œï¼Œåº”è¯¥é€‰æ‹©InnoDB</li></ol><table><thead><tr><th></th><th>MyIASM</th><th>InnoDB</th></tr></thead><tbody><tr><td>äº‹åŠ¡æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>é”çš„ç²’åº¦</td><td>Table</td><td>Row</td></tr><tr><td>å­˜å‚¨å®¹é‡</td><td>æ²¡æœ‰ä¸Šé™</td><td>64TB</td></tr><tr><td><strong>å“ˆå¸Œç´¢å¼•</strong></td><td><strong>ä¸æ”¯æŒ</strong></td><td><strong>æ”¯æŒ</strong></td></tr><tr><td><strong>å…¨æ–‡ç´¢å¼•</strong></td><td><strong>æ”¯æŒ</strong></td><td><strong>ä¸æ”¯æŒ</strong></td></tr><tr><td><strong>å¤–é”®</strong></td><td><strong>ä¸æ”¯æŒ</strong></td><td><strong>æ”¯æŒ</strong></td></tr></tbody></table><h3 id="MySQLå¦‚ä½•ç»™å¤§è¡¨åŠ ç´¢å¼•"><a href="#MySQLå¦‚ä½•ç»™å¤§è¡¨åŠ ç´¢å¼•" class="headerlink" title="MySQLå¦‚ä½•ç»™å¤§è¡¨åŠ ç´¢å¼•"></a>MySQLå¦‚ä½•ç»™å¤§è¡¨åŠ ç´¢å¼•</h3><p><a href="https://segmentfault.com/a/1190000040570831">https://segmentfault.com/a/1190000040570831</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> é¢ç» </tag>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬ä¸ƒå‘¨</title>
      <link href="/posts/8847320b.html"/>
      <url>/posts/8847320b.html</url>
      
        <content type="html"><![CDATA[<hr><p>æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾æ¯å‘¨æ‰“å¡ 2021.04.19-2021.04.25</p><h3 id="162-å¯»æ‰¾å³°å€¼"><a href="#162-å¯»æ‰¾å³°å€¼" class="headerlink" title="162. å¯»æ‰¾å³°å€¼"></a><a href="https://leetcode-cn.com/problems/find-peak-element/">162. å¯»æ‰¾å³°å€¼</a></h3><p>å³°å€¼å…ƒç´ æ˜¯æŒ‡å…¶å€¼å¤§äºå·¦å³ç›¸é‚»å€¼çš„å…ƒç´ ã€‚</p><p>ç»™ä½ ä¸€ä¸ªè¾“å…¥æ•°ç»„ <code>nums</code>ï¼Œæ‰¾åˆ°å³°å€¼å…ƒç´ å¹¶è¿”å›å…¶ç´¢å¼•ã€‚æ•°ç»„å¯èƒ½åŒ…å«å¤šä¸ªå³°å€¼ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿”å› <strong>ä»»ä½•ä¸€ä¸ªå³°å€¼</strong> æ‰€åœ¨ä½ç½®å³å¯ã€‚</p><p>ä½ å¯ä»¥å‡è®¾ <code>nums[-1] = nums[n] = -âˆ</code> ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [1,2,3,1]</span><br><span class="line">è¾“å‡ºï¼š2</span><br><span class="line">è§£é‡Šï¼š3 æ˜¯å³°å€¼å…ƒç´ ï¼Œä½ çš„å‡½æ•°åº”è¯¥è¿”å›å…¶ç´¢å¼• 2ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [1,2,1,3,5,6,4]</span><br><span class="line">è¾“å‡ºï¼š1 æˆ– 5 </span><br><span class="line">è§£é‡Šï¼šä½ çš„å‡½æ•°å¯ä»¥è¿”å›ç´¢å¼• 1ï¼Œå…¶å³°å€¼å…ƒç´ ä¸º 2ï¼›</span><br><span class="line">     æˆ–è€…è¿”å›ç´¢å¼• 5ï¼Œ å…¶å³°å€¼å…ƒç´ ä¸º 6ã€‚</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>1 &lt;= nums.length &lt;= 1000</code></li><li><code>-2^31 &lt;= nums[i] &lt;= 2^31 - 1</code></li><li>å¯¹äºæ‰€æœ‰æœ‰æ•ˆçš„ <code>i</code> éƒ½æœ‰ <code>nums[i] != nums[i + 1]</code></li></ul><p> <strong>è¿›é˜¶ï¼š</strong>ä½ å¯ä»¥å®ç°æ—¶é—´å¤æ‚åº¦ä¸º <code>O(logN)</code> çš„è§£å†³æ–¹æ¡ˆå—ï¼Ÿ</p><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h3 id="153-å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼"><a href="#153-å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼" class="headerlink" title="153. å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼"></a><a href="https://leetcode-cn.com/problems/find-minimum-in-rotated-sorted-array/">153. å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼</a></h3><p>å·²çŸ¥ä¸€ä¸ªé•¿åº¦ä¸º <code>n</code> çš„æ•°ç»„ï¼Œé¢„å…ˆæŒ‰ç…§å‡åºæ’åˆ—ï¼Œç»ç”± <code>1</code> åˆ° <code>n</code> æ¬¡ <strong>æ—‹è½¬</strong> åï¼Œå¾—åˆ°è¾“å…¥æ•°ç»„ã€‚ä¾‹å¦‚ï¼ŒåŸæ•°ç»„ <code>nums = [0,1,2,4,5,6,7]</code> åœ¨å˜åŒ–åå¯èƒ½å¾—åˆ°ï¼š</p><ul><li>è‹¥æ—‹è½¬ <code>4</code> æ¬¡ï¼Œåˆ™å¯ä»¥å¾—åˆ° <code>[4,5,6,7,0,1,2]</code></li><li>è‹¥æ—‹è½¬ <code>7</code> æ¬¡ï¼Œåˆ™å¯ä»¥å¾—åˆ° <code>[0,1,2,4,5,6,7]</code></li></ul><p>æ³¨æ„ï¼Œæ•°ç»„ <code>[a[0], a[1], a[2], ..., a[n-1]]</code> <strong>æ—‹è½¬ä¸€æ¬¡</strong> çš„ç»“æœä¸ºæ•°ç»„ <code>[a[n-1], a[0], a[1], a[2], ..., a[n-2]]</code> ã€‚</p><p>ç»™ä½ ä¸€ä¸ªå…ƒç´ å€¼ <strong>äº’ä¸ç›¸åŒ</strong> çš„æ•°ç»„ <code>nums</code> ï¼Œå®ƒåŸæ¥æ˜¯ä¸€ä¸ªå‡åºæ’åˆ—çš„æ•°ç»„ï¼Œå¹¶æŒ‰ä¸Šè¿°æƒ…å½¢è¿›è¡Œäº†å¤šæ¬¡æ—‹è½¬ã€‚è¯·ä½ æ‰¾å‡ºå¹¶è¿”å›æ•°ç»„ä¸­çš„ <strong>æœ€å°å…ƒç´ </strong> ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [3,4,5,1,2]</span><br><span class="line">è¾“å‡ºï¼š1</span><br><span class="line">è§£é‡Šï¼šåŸæ•°ç»„ä¸º [1,2,3,4,5] ï¼Œæ—‹è½¬ 3 æ¬¡å¾—åˆ°è¾“å…¥æ•°ç»„ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [4,5,6,7,0,1,2]</span><br><span class="line">è¾“å‡ºï¼š0</span><br><span class="line">è§£é‡Šï¼šåŸæ•°ç»„ä¸º [0,1,2,4,5,6,7] ï¼Œæ—‹è½¬ 4 æ¬¡å¾—åˆ°è¾“å…¥æ•°ç»„ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [11,13,15,17]</span><br><span class="line">è¾“å‡ºï¼š11</span><br><span class="line">è§£é‡Šï¼šåŸæ•°ç»„ä¸º [11,13,15,17] ï¼Œæ—‹è½¬ 4 æ¬¡å¾—åˆ°è¾“å…¥æ•°ç»„ã€‚</span><br></pre></td></tr></table></figure><p> <strong>æç¤ºï¼š</strong></p><ul><li><code>n == nums.length</code></li><li><code>1 &lt;= n &lt;= 5000</code></li><li><code>-5000 &lt;= nums[i] &lt;= 5000</code></li><li><code>nums</code> ä¸­çš„æ‰€æœ‰æ•´æ•° <strong>äº’ä¸ç›¸åŒ</strong></li><li><code>nums</code> åŸæ¥æ˜¯ä¸€ä¸ªå‡åºæ’åºçš„æ•°ç»„ï¼Œå¹¶è¿›è¡Œäº† <code>1</code> è‡³ <code>n</code> æ¬¡æ—‹è½¬</li></ul><h4 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ </tag>
            
            <tag> æ¯å‘¨æ‰“å¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>10è®²</title>
      <link href="/posts/18525c55.html"/>
      <url>/posts/18525c55.html</url>
      
        <content type="html"><![CDATA[<hr><h1 id="10-é€’å½’ï¼šå¦‚ä½•ç”¨ä¸‰è¡Œä»£ç æ‰¾åˆ°â€œæœ€ç»ˆæ¨èäººâ€ï¼Ÿ"><a href="#10-é€’å½’ï¼šå¦‚ä½•ç”¨ä¸‰è¡Œä»£ç æ‰¾åˆ°â€œæœ€ç»ˆæ¨èäººâ€ï¼Ÿ" class="headerlink" title="10 | é€’å½’ï¼šå¦‚ä½•ç”¨ä¸‰è¡Œä»£ç æ‰¾åˆ°â€œæœ€ç»ˆæ¨èäººâ€ï¼Ÿ"></a>10 | é€’å½’ï¼šå¦‚ä½•ç”¨ä¸‰è¡Œä»£ç æ‰¾åˆ°â€œæœ€ç»ˆæ¨èäººâ€ï¼Ÿ</h1><h2 id="é€’å½’éœ€è¦æ»¡è¶³çš„ä¸‰ä¸ªæ¡ä»¶"><a href="#é€’å½’éœ€è¦æ»¡è¶³çš„ä¸‰ä¸ªæ¡ä»¶" class="headerlink" title="é€’å½’éœ€è¦æ»¡è¶³çš„ä¸‰ä¸ªæ¡ä»¶"></a>é€’å½’éœ€è¦æ»¡è¶³çš„ä¸‰ä¸ªæ¡ä»¶</h2><h3 id="1-ä¸€ä¸ªé—®é¢˜çš„è§£å¯ä»¥åˆ†è§£ä¸ºå‡ ä¸ªå­é—®é¢˜çš„è§£"><a href="#1-ä¸€ä¸ªé—®é¢˜çš„è§£å¯ä»¥åˆ†è§£ä¸ºå‡ ä¸ªå­é—®é¢˜çš„è§£" class="headerlink" title="1. ä¸€ä¸ªé—®é¢˜çš„è§£å¯ä»¥åˆ†è§£ä¸ºå‡ ä¸ªå­é—®é¢˜çš„è§£"></a>1. ä¸€ä¸ªé—®é¢˜çš„è§£å¯ä»¥åˆ†è§£ä¸ºå‡ ä¸ªå­é—®é¢˜çš„è§£</h3><p>ä½•ä¸ºå­é—®é¢˜ï¼Ÿå­é—®é¢˜å°±æ˜¯æ•°æ®è§„æ¨¡æ›´å°çš„é—®é¢˜ã€‚æ¯”å¦‚ï¼Œå‰é¢è®²çš„ç”µå½±é™¢çš„ä¾‹å­ï¼Œä½ è¦çŸ¥é“ï¼Œâ€œè‡ªå·±åœ¨å“ªä¸€æ’â€çš„é—®é¢˜ï¼Œå¯ä»¥åˆ†è§£ä¸ºâ€œå‰ä¸€æ’çš„äººåœ¨å“ªä¸€æ’â€è¿™æ ·ä¸€ä¸ªå­é—®é¢˜ã€‚</p><h3 id="2-è¿™ä¸ªé—®é¢˜ä¸åˆ†è§£ä¹‹åçš„å­é—®é¢˜ï¼Œé™¤äº†æ•°æ®è§„æ¨¡ä¸åŒï¼Œæ±‚è§£æ€è·¯å®Œå…¨ä¸€æ ·"><a href="#2-è¿™ä¸ªé—®é¢˜ä¸åˆ†è§£ä¹‹åçš„å­é—®é¢˜ï¼Œé™¤äº†æ•°æ®è§„æ¨¡ä¸åŒï¼Œæ±‚è§£æ€è·¯å®Œå…¨ä¸€æ ·" class="headerlink" title="2.  è¿™ä¸ªé—®é¢˜ä¸åˆ†è§£ä¹‹åçš„å­é—®é¢˜ï¼Œé™¤äº†æ•°æ®è§„æ¨¡ä¸åŒï¼Œæ±‚è§£æ€è·¯å®Œå…¨ä¸€æ ·"></a>2.  è¿™ä¸ªé—®é¢˜ä¸åˆ†è§£ä¹‹åçš„å­é—®é¢˜ï¼Œé™¤äº†æ•°æ®è§„æ¨¡ä¸åŒï¼Œæ±‚è§£æ€è·¯å®Œå…¨ä¸€æ ·</h3><p>æ¯”å¦‚ç”µå½±é™¢é‚£ä¸ªä¾‹å­ï¼Œä½ æ±‚è§£â€œè‡ªå·±åœ¨å“ªä¸€æ’â€çš„æ€è·¯ï¼Œå’Œå‰é¢ä¸€æ’äººæ±‚è§£â€œè‡ªå·±åœ¨å“ªä¸€æ’â€çš„æ€è·¯ï¼Œæ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚</p><h3 id="3-å­˜åœ¨é€’å½’ç»ˆæ­¢æ¡ä»¶"><a href="#3-å­˜åœ¨é€’å½’ç»ˆæ­¢æ¡ä»¶" class="headerlink" title="3. å­˜åœ¨é€’å½’ç»ˆæ­¢æ¡ä»¶"></a>3. å­˜åœ¨é€’å½’ç»ˆæ­¢æ¡ä»¶</h3><p>æŠŠé—®é¢˜åˆ†è§£ä¸ºå­é—®é¢˜ï¼ŒæŠŠå­é—®é¢˜å†åˆ†è§£ä¸ºå­å­é—®é¢˜ï¼Œä¸€å±‚ä¸€å±‚åˆ†è§£ä¸‹å»ï¼Œä¸èƒ½å­˜åœ¨æ— é™å¾ªç¯ï¼Œè¿™å°±éœ€è¦æœ‰ç»ˆæ­¢æ¡ä»¶ã€‚è¿˜æ˜¯ç”µå½±é™¢çš„ä¾‹å­ï¼Œç¬¬ä¸€æ’çš„äººä¸éœ€è¦å†ç»§ç»­è¯¢é—®ä»»ä½•äººï¼Œå°±çŸ¥é“è‡ªå·±åœ¨å“ªä¸€æ’ï¼Œä¹Ÿå°±æ˜¯ f(1)&#x3D;1ï¼Œè¿™å°±æ˜¯é€’å½’çš„ç»ˆæ­¢æ¡ä»¶ã€‚</p><h2 id="å¦‚ä½•ç¼–å†™é€’å½’ä»£ç ï¼Ÿ"><a href="#å¦‚ä½•ç¼–å†™é€’å½’ä»£ç ï¼Ÿ" class="headerlink" title="å¦‚ä½•ç¼–å†™é€’å½’ä»£ç ï¼Ÿ"></a>å¦‚ä½•ç¼–å†™é€’å½’ä»£ç ï¼Ÿ</h2><p>å†™é€’å½’ä»£ç æœ€å…³é”®çš„æ˜¯<strong>å†™å‡ºé€’æ¨å…¬å¼ï¼Œæ‰¾åˆ°ç»ˆæ­¢æ¡ä»¶</strong>ï¼Œå‰©ä¸‹å°†é€’æ¨å…¬å¼è½¬åŒ–ä¸ºä»£ç å°±å¾ˆç®€å•äº†ã€‚</p><p>ä½ å…ˆè®°ä½è¿™ä¸ªç†è®ºã€‚æˆ‘ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œå¸¦ä½ ä¸€æ­¥ä¸€æ­¥å®ç°ä¸€ä¸ªé€’å½’ä»£ç ï¼Œå¸®ä½ ç†è§£ã€‚</p><p>å‡å¦‚è¿™é‡Œæœ‰ n ä¸ªå°é˜¶ï¼Œæ¯æ¬¡ä½ å¯ä»¥è·¨ 1 ä¸ªå°é˜¶æˆ–è€… 2 ä¸ªå°é˜¶ï¼Œè¯·é—®èµ°è¿™ n ä¸ªå°é˜¶æœ‰å¤šå°‘ç§èµ°æ³•ï¼Ÿå¦‚æœæœ‰ 7 ä¸ªå°é˜¶ï¼Œä½ å¯ä»¥ 2ï¼Œ2ï¼Œ2ï¼Œ1 è¿™æ ·å­ä¸Šå»ï¼Œä¹Ÿå¯ä»¥ 1ï¼Œ2ï¼Œ1ï¼Œ1ï¼Œ2 è¿™æ ·å­ä¸Šå»ï¼Œæ€»ä¹‹èµ°æ³•æœ‰å¾ˆå¤šï¼Œé‚£å¦‚ä½•ç”¨ç¼–ç¨‹æ±‚å¾—æ€»å…±æœ‰å¤šå°‘ç§èµ°æ³•å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬ä»”ç»†æƒ³ä¸‹ï¼Œå®é™…ä¸Šï¼Œå¯ä»¥æ ¹æ®ç¬¬ä¸€æ­¥çš„èµ°æ³•æŠŠæ‰€æœ‰èµ°æ³•åˆ†ä¸ºä¸¤ç±»ï¼Œç¬¬ä¸€ç±»æ˜¯ç¬¬ä¸€æ­¥èµ°äº† 1 ä¸ªå°é˜¶ï¼Œå¦ä¸€ç±»æ˜¯ç¬¬ä¸€æ­¥èµ°äº† 2 ä¸ªå°é˜¶ã€‚æ‰€ä»¥ n ä¸ªå°é˜¶çš„èµ°æ³•å°±ç­‰äºå…ˆèµ° 1 é˜¶åï¼Œn-1 ä¸ªå°é˜¶çš„èµ°æ³• åŠ ä¸Šå…ˆèµ° 2 é˜¶åï¼Œn-2 ä¸ªå°é˜¶çš„èµ°æ³•ã€‚ç”¨å…¬å¼è¡¨ç¤ºå°±æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f(n) = f(n-1)+f(n-2)</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œå…¶å®å°±æ˜¯æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼Œæˆ–è€…ä½ è‡ªå·±åœ¨æœ¬å­ä¸Šç”»ä¸€ä¸‹å°±çŸ¥é“äº†ï¼Œç¬¬ä¸€é˜¶æœ‰1ç§èµ°æ³•ï¼Œç¬¬äºŒé˜¶æœ‰2ç§èµ°æ³•ï¼Œç¬¬ä¸‰é˜¶æœ‰3ç§èµ°æ³•ï¼Œç¬¬å››é˜¶æœ‰5ç§èµ°æ³•ï¼Œç¬¬äº”é˜¶æœ‰8ç§èµ°æ³•ï¼Œè¿™ä¸ªèµ°æ³•çš„è§„å¾‹æ­£å¥½ç¬¦åˆæ–æ³¢é‚£å¥‘æ•°åˆ—1(è¿™ä¸ª1åœ¨æ­¤ä¾‹å­çœç•¥äº†)ã€1ã€2ã€3ã€5ã€8ã€13ã€21â€¦.ä¸ç®¡å“ªä¸ªæ•°éƒ½æ˜¯å‰ä¸¤ä¸ªæ•°çš„å’Œï¼Œé‚£ä¹ˆæƒ³è±¡æ¯ä¸ªæ•°ä¸‹é¢éƒ½æœ‰ä¸€ä¸ªç±»ä¼¼æ•°ç»„ä¸€æ ·çš„ä¸‹æ ‡ï¼Œé‚£ä¹ˆç¬¬nä¸ªæ•°å°±ç­‰äºç¬¬n-1ä½ç½®çš„æ•°åŠ ä¸Šç¬¬n-2ä½ç½®çš„æ•°ä¹Ÿå°±æ˜¯F(n) &#x3D; F(n-1) + F(n-2)</p></blockquote><p>æœ‰äº†é€’æ¨å…¬å¼ï¼Œé€’å½’ä»£ç åŸºæœ¬ä¸Šå°±å®Œæˆäº†ä¸€åŠã€‚æˆ‘ä»¬å†æ¥çœ‹ä¸‹ç»ˆæ­¢æ¡ä»¶ã€‚å½“æœ‰ä¸€ä¸ªå°é˜¶æ—¶ï¼Œæˆ‘ä»¬ä¸éœ€è¦å†ç»§ç»­é€’å½’ï¼Œå°±åªæœ‰ä¸€ç§èµ°æ³•ã€‚æ‰€ä»¥ f(1)&#x3D;1ã€‚è¿™ä¸ªé€’å½’ç»ˆæ­¢æ¡ä»¶è¶³å¤Ÿå—ï¼Ÿæˆ‘ä»¬å¯ä»¥ç”¨ n&#x3D;2ï¼Œn&#x3D;3 è¿™æ ·æ¯”è¾ƒå°çš„æ•°è¯•éªŒä¸€ä¸‹ã€‚</p><p>n&#x3D;2 æ—¶ï¼Œf(2)&#x3D;f(1)+f(0)ã€‚å¦‚æœé€’å½’ç»ˆæ­¢æ¡ä»¶åªæœ‰ä¸€ä¸ª f(1)&#x3D;1ï¼Œé‚£ f(2) å°±æ— æ³•æ±‚è§£äº†ã€‚æ‰€ä»¥é™¤äº† f(1)&#x3D;1 è¿™ä¸€ä¸ªé€’å½’ç»ˆæ­¢æ¡ä»¶å¤–ï¼Œè¿˜è¦æœ‰ f(0)&#x3D;1ï¼Œè¡¨ç¤ºèµ° 0 ä¸ªå°é˜¶æœ‰ä¸€ç§èµ°æ³•ï¼Œä¸è¿‡è¿™æ ·å­çœ‹èµ·æ¥å°±ä¸ç¬¦åˆæ­£å¸¸çš„é€»è¾‘æ€ç»´äº†ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ f(2)&#x3D;2 ä½œä¸ºä¸€ç§ç»ˆæ­¢æ¡ä»¶ï¼Œè¡¨ç¤ºèµ° 2 ä¸ªå°é˜¶ï¼Œæœ‰ä¸¤ç§èµ°æ³•ï¼Œä¸€æ­¥èµ°å®Œæˆ–è€…åˆ†ä¸¤æ­¥æ¥èµ°ã€‚</p><p>æ‰€ä»¥ï¼Œé€’å½’ç»ˆæ­¢æ¡ä»¶å°±æ˜¯ f(1)&#x3D;1ï¼Œf(2)&#x3D;2ã€‚è¿™ä¸ªæ—¶å€™ï¼Œä½ å¯ä»¥å†æ‹¿ n&#x3D;3ï¼Œn&#x3D;4 æ¥éªŒè¯ä¸€ä¸‹ï¼Œè¿™ä¸ªç»ˆæ­¢æ¡ä»¶æ˜¯å¦è¶³å¤Ÿå¹¶ä¸”æ­£ç¡®ã€‚</p><p>æˆ‘ä»¬æŠŠé€’å½’ç»ˆæ­¢æ¡ä»¶å’Œåˆšåˆšå¾—åˆ°çš„é€’æ¨å…¬å¼æ”¾åˆ°ä¸€èµ·å°±æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">f(1) = 1;</span><br><span class="line">f(2) = 2;</span><br><span class="line">f(n) = f(n-1)+f(n-2)</span><br></pre></td></tr></table></figure><p>æœ‰äº†è¿™ä¸ªå…¬å¼ï¼Œæˆ‘ä»¬è½¬åŒ–æˆé€’å½’ä»£ç å°±ç®€å•å¤šäº†ã€‚æœ€ç»ˆçš„é€’å½’ä»£ç æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">f</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (n == <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> (n == <span class="number">2</span>) <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">return</span> f(n<span class="number">-1</span>) + f(n<span class="number">-2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘æ€»ç»“ä¸€ä¸‹ï¼Œ<strong>å†™é€’å½’ä»£ç çš„å…³é”®å°±æ˜¯æ‰¾åˆ°å¦‚ä½•å°†å¤§é—®é¢˜åˆ†è§£ä¸ºå°é—®é¢˜çš„è§„å¾‹ï¼Œå¹¶ä¸”åŸºäºæ­¤å†™å‡ºé€’æ¨å…¬å¼ï¼Œç„¶åå†æ¨æ•²ç»ˆæ­¢æ¡ä»¶ï¼Œæœ€åå°†é€’æ¨å…¬å¼å’Œç»ˆæ­¢æ¡ä»¶ç¿»è¯‘æˆä»£ç </strong>ã€‚</p><p>è™½ç„¶æˆ‘è®²äº†è¿™ä¹ˆå¤šæ–¹æ³•ï¼Œä½†æ˜¯ä½œä¸ºåˆå­¦è€…çš„ä½ ï¼Œç°åœ¨æ˜¯ä¸æ˜¯è¿˜æ˜¯æœ‰ç§æƒ³ä¸å¤ªæ¸…æ¥šçš„æ„Ÿè§‰å‘¢ï¼Ÿå®é™…ä¸Šï¼Œæˆ‘åˆšå­¦é€’å½’çš„æ—¶å€™ï¼Œä¹Ÿæœ‰è¿™ç§æ„Ÿè§‰ï¼Œè¿™ä¹Ÿæ˜¯æ–‡ç« å¼€å¤´æˆ‘è¯´é€’å½’ä»£ç æ¯”è¾ƒéš¾ç†è§£çš„åœ°æ–¹ã€‚</p><p>åˆšè®²çš„ç”µå½±é™¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬çš„é€’å½’è°ƒç”¨åªæœ‰ä¸€ä¸ªåˆ†æ”¯ï¼Œä¹Ÿå°±æ˜¯è¯´â€œä¸€ä¸ªé—®é¢˜åªéœ€è¦åˆ†è§£ä¸ºä¸€ä¸ªå­é—®é¢˜â€ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“èƒ½å¤Ÿæƒ³æ¸…æ¥šâ€œé€’â€å’Œâ€œå½’â€çš„æ¯ä¸€ä¸ªæ­¥éª¤ï¼Œæ‰€ä»¥å†™èµ·æ¥ã€ç†è§£èµ·æ¥éƒ½ä¸éš¾ã€‚</p><p>ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬é¢å¯¹çš„æ˜¯ä¸€ä¸ªé—®é¢˜è¦åˆ†è§£ä¸ºå¤šä¸ªå­é—®é¢˜çš„æƒ…å†µï¼Œé€’å½’ä»£ç å°±æ²¡é‚£ä¹ˆå¥½ç†è§£äº†ã€‚</p><p>åƒæˆ‘åˆšåˆšè®²çš„ç¬¬äºŒä¸ªä¾‹å­ï¼Œäººè„‘å‡ ä¹æ²¡åŠæ³•æŠŠæ•´ä¸ªâ€œé€’â€å’Œâ€œå½’â€çš„è¿‡ç¨‹ä¸€æ­¥ä¸€æ­¥éƒ½æƒ³æ¸…æ¥šã€‚</p><p>è®¡ç®—æœºæ“…é•¿åšé‡å¤çš„äº‹æƒ…ï¼Œæ‰€ä»¥é€’å½’æ­£åˆå®ƒçš„èƒƒå£ã€‚è€Œæˆ‘ä»¬äººè„‘æ›´å–œæ¬¢å¹³é“ºç›´å™çš„æ€ç»´æ–¹å¼ã€‚å½“æˆ‘ä»¬çœ‹åˆ°é€’å½’æ—¶ï¼Œæˆ‘ä»¬æ€»æƒ³æŠŠé€’å½’å¹³é“ºå±•å¼€ï¼Œè„‘å­é‡Œå°±ä¼šå¾ªç¯ï¼Œä¸€å±‚ä¸€å±‚å¾€ä¸‹è°ƒï¼Œç„¶åå†ä¸€å±‚ä¸€å±‚è¿”å›ï¼Œè¯•å›¾æƒ³ææ¸…æ¥šè®¡ç®—æœºæ¯ä¸€æ­¥éƒ½æ˜¯æ€ä¹ˆæ‰§è¡Œçš„ï¼Œè¿™æ ·å°±å¾ˆå®¹æ˜“è¢«ç»•è¿›å»ã€‚</p><p>å¯¹äºé€’å½’ä»£ç ï¼Œè¿™ç§è¯•å›¾æƒ³æ¸…æ¥šæ•´ä¸ªé€’å’Œå½’è¿‡ç¨‹çš„åšæ³•ï¼Œå®é™…ä¸Šæ˜¯è¿›å…¥äº†ä¸€ä¸ªæ€ç»´è¯¯åŒºã€‚å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬ç†è§£èµ·æ¥æ¯”è¾ƒåƒåŠ›ï¼Œä¸»è¦åŸå› å°±æ˜¯è‡ªå·±ç»™è‡ªå·±åˆ¶é€ äº†è¿™ç§ç†è§£éšœç¢ã€‚é‚£æ­£ç¡®çš„æ€ç»´æ–¹å¼åº”è¯¥æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</p><p>å¦‚æœä¸€ä¸ªé—®é¢˜ A å¯ä»¥åˆ†è§£ä¸ºè‹¥å¹²å­é—®é¢˜ Bã€Cã€Dï¼Œä½ å¯ä»¥å‡è®¾å­é—®é¢˜ Bã€Cã€D å·²ç»è§£å†³ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šæ€è€ƒå¦‚ä½•è§£å†³é—®é¢˜ Aã€‚è€Œä¸”ï¼Œä½ åªéœ€è¦æ€è€ƒé—®é¢˜ A ä¸å­é—®é¢˜ Bã€Cã€D ä¸¤å±‚ä¹‹é—´çš„å…³ç³»å³å¯ï¼Œä¸éœ€è¦ä¸€å±‚ä¸€å±‚å¾€ä¸‹æ€è€ƒå­é—®é¢˜ä¸å­å­é—®é¢˜ï¼Œå­å­é—®é¢˜ä¸å­å­å­é—®é¢˜ä¹‹é—´çš„å…³ç³»ã€‚å±è”½æ‰é€’å½’ç»†èŠ‚ï¼Œè¿™æ ·å­ç†è§£èµ·æ¥å°±ç®€å•å¤šäº†ã€‚</p><p>å› æ­¤ï¼Œ<strong>ç¼–å†™é€’å½’ä»£ç çš„å…³é”®æ˜¯ï¼Œåªè¦é‡åˆ°é€’å½’ï¼Œæˆ‘ä»¬å°±æŠŠå®ƒæŠ½è±¡æˆä¸€ä¸ªé€’æ¨å…¬å¼ï¼Œä¸ç”¨æƒ³ä¸€å±‚å±‚çš„è°ƒç”¨å…³ç³»ï¼Œä¸è¦è¯•å›¾ç”¨äººè„‘å»åˆ†è§£é€’å½’çš„æ¯ä¸ªæ­¥éª¤</strong>ã€‚</p><h2 id="é€’å½’ä»£ç è¦è­¦æƒ•é‡å¤è®¡ç®—"><a href="#é€’å½’ä»£ç è¦è­¦æƒ•é‡å¤è®¡ç®—" class="headerlink" title="é€’å½’ä»£ç è¦è­¦æƒ•é‡å¤è®¡ç®—"></a>é€’å½’ä»£ç è¦è­¦æƒ•é‡å¤è®¡ç®—</h2><p>é™¤æ­¤ä¹‹å¤–ï¼Œä½¿ç”¨é€’å½’æ—¶è¿˜ä¼šå‡ºç°é‡å¤è®¡ç®—çš„é—®é¢˜ã€‚åˆšæ‰æˆ‘è®²çš„ç¬¬äºŒä¸ªé€’å½’ä»£ç çš„ä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬æŠŠæ•´ä¸ªé€’å½’è¿‡ç¨‹åˆ†è§£ä¸€ä¸‹çš„è¯ï¼Œé‚£å°±æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210424195819.jpeg" alt="img"></p><p>ä»å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´è§‚åœ°çœ‹åˆ°ï¼Œæƒ³è¦è®¡ç®— f(5)ï¼Œéœ€è¦å…ˆè®¡ç®— f(4) å’Œ f(3)ï¼Œè€Œè®¡ç®— f(4) è¿˜éœ€è¦è®¡ç®— f(3)ï¼Œå› æ­¤ï¼Œf(3) å°±è¢«è®¡ç®—äº†å¾ˆå¤šæ¬¡ï¼Œè¿™å°±æ˜¯é‡å¤è®¡ç®—é—®é¢˜ã€‚</p><p>ä¸ºäº†é¿å…é‡å¤è®¡ç®—ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªæ•°æ®ç»“æ„ï¼ˆæ¯”å¦‚æ•£åˆ—è¡¨ï¼‰æ¥ä¿å­˜å·²ç»æ±‚è§£è¿‡çš„ f(k)ã€‚å½“é€’å½’è°ƒç”¨åˆ° f(k) æ—¶ï¼Œå…ˆçœ‹ä¸‹æ˜¯å¦å·²ç»æ±‚è§£è¿‡äº†ã€‚å¦‚æœæ˜¯ï¼Œåˆ™ç›´æ¥ä»æ•£åˆ—è¡¨ä¸­å–å€¼è¿”å›ï¼Œä¸éœ€è¦é‡å¤è®¡ç®—ï¼Œè¿™æ ·å°±èƒ½é¿å…åˆšè®²çš„é—®é¢˜äº†ã€‚</p><p>æŒ‰ç…§ä¸Šé¢çš„æ€è·¯ï¼Œæˆ‘ä»¬æ¥æ”¹é€ ä¸€ä¸‹åˆšæ‰çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">f</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (n == <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> (n == <span class="number">2</span>) <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// hasSolvedListå¯ä»¥ç†è§£æˆä¸€ä¸ªMapï¼Œkeyæ˜¯nï¼Œvalueæ˜¯f(n)</span></span><br><span class="line">  <span class="keyword">if</span> (hasSolvedList.containsKey(n)) &#123;</span><br><span class="line">    <span class="keyword">return</span> hasSolvedList.get(n);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="type">int</span> <span class="variable">ret</span> <span class="operator">=</span> f(n-<span class="number">1</span>) + f(n-<span class="number">2</span>);</span><br><span class="line">  hasSolvedList.put(n, ret);</span><br><span class="line">  <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™¤äº†å †æ ˆæº¢å‡ºã€é‡å¤è®¡ç®—è¿™ä¸¤ä¸ªå¸¸è§çš„é—®é¢˜ã€‚é€’å½’ä»£ç è¿˜æœ‰å¾ˆå¤šåˆ«çš„é—®é¢˜ã€‚åœ¨æ—¶é—´æ•ˆç‡ä¸Šï¼Œé€’å½’ä»£ç é‡Œå¤šäº†å¾ˆå¤šå‡½æ•°è°ƒç”¨ï¼Œå½“è¿™äº›å‡½æ•°è°ƒç”¨çš„æ•°é‡è¾ƒå¤§æ—¶ï¼Œå°±ä¼šç§¯èšæˆä¸€ä¸ªå¯è§‚çš„æ—¶é—´æˆæœ¬ã€‚åœ¨ç©ºé—´å¤æ‚åº¦ä¸Šï¼Œå› ä¸ºé€’å½’è°ƒç”¨ä¸€æ¬¡å°±ä¼šåœ¨å†…å­˜æ ˆä¸­ä¿å­˜ä¸€æ¬¡ç°åœºæ•°æ®ï¼Œæ‰€ä»¥åœ¨åˆ†æé€’å½’ä»£ç ç©ºé—´å¤æ‚åº¦æ—¶ï¼Œéœ€è¦é¢å¤–è€ƒè™‘è¿™éƒ¨åˆ†çš„å¼€é”€ï¼Œæ¯”å¦‚æˆ‘ä»¬å‰é¢è®²åˆ°çš„ç”µå½±é™¢é€’å½’ä»£ç ï¼Œç©ºé—´å¤æ‚åº¦å¹¶ä¸æ˜¯ O(1)ï¼Œè€Œæ˜¯ O(n)ã€‚</p><h2 id="è¯¾åæ€è€ƒ"><a href="#è¯¾åæ€è€ƒ" class="headerlink" title="è¯¾åæ€è€ƒ"></a>è¯¾åæ€è€ƒ</h2><p>æˆ‘ä»¬å¹³æ—¶è°ƒè¯•ä»£ç å–œæ¬¢ä½¿ç”¨ IDE çš„å•æ­¥è·Ÿè¸ªåŠŸèƒ½ï¼Œåƒè§„æ¨¡æ¯”è¾ƒå¤§ã€é€’å½’å±‚æ¬¡å¾ˆæ·±çš„é€’å½’ä»£ç ï¼Œå‡ ä¹æ— æ³•ä½¿ç”¨è¿™ç§è°ƒè¯•æ–¹å¼ã€‚å¯¹äºé€’å½’ä»£ç ï¼Œä½ æœ‰ä»€ä¹ˆå¥½çš„è°ƒè¯•æ–¹æ³•å‘¢ï¼Ÿ</p><blockquote><p>è°ƒè¯•é€’å½’:<br>1.æ‰“å°æ—¥å¿—å‘ç°ï¼Œé€’å½’å€¼ã€‚<br>2.ç»“åˆæ¡ä»¶æ–­ç‚¹è¿›è¡Œè°ƒè¯•ã€‚</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢†åŸŸé©±åŠ¨è®¾è®¡DDD</title>
      <link href="/posts/e7f6134d.html"/>
      <url>/posts/e7f6134d.html</url>
      
        <content type="html"><![CDATA[<hr><h2 id="ä»€ä¹ˆæ˜¯é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼Ÿ</h2><h2 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨DDDï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨DDDï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨DDDï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨DDDï¼Ÿ</h2><h3 id="è¿‡åº¦è€¦åˆ"><a href="#è¿‡åº¦è€¦åˆ" class="headerlink" title="è¿‡åº¦è€¦åˆ"></a>è¿‡åº¦è€¦åˆ</h3><p>ä¸šåŠ¡åˆæœŸï¼Œæˆ‘ä»¬çš„åŠŸèƒ½å¤§éƒ½éå¸¸ç®€å•ï¼Œæ™®é€šçš„CRUDå°±èƒ½æ»¡è¶³ï¼Œæ­¤æ—¶ç³»ç»Ÿæ˜¯æ¸…æ™°çš„ã€‚éšç€è¿­ä»£çš„ä¸æ–­æ¼”åŒ–ï¼Œä¸šåŠ¡é€»è¾‘å˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿä¹Ÿè¶Šæ¥è¶Šå†—æ‚ã€‚æ¨¡å—å½¼æ­¤å…³è”ï¼Œè°éƒ½å¾ˆéš¾è¯´æ¸…æ¨¡å—çš„å…·ä½“åŠŸèƒ½æ„å›¾æ˜¯å•¥ã€‚ä¿®æ”¹ä¸€ä¸ªåŠŸèƒ½æ—¶ï¼Œå¾€å¾€å…‰å›æº¯è¯¥åŠŸèƒ½éœ€è¦çš„ä¿®æ”¹ç‚¹å°±éœ€è¦å¾ˆé•¿æ—¶é—´ï¼Œæ›´åˆ«æä¿®æ”¹å¸¦æ¥çš„ä¸å¯é¢„çŸ¥çš„å½±å“é¢ã€‚</p><p>ä¸‹å›¾æ˜¯ä¸€ä¸ªå¸¸è§çš„ç³»ç»Ÿè€¦åˆç—…ä¾‹ã€‚</p><p><img src="https://awps-assets.meituan.net/mit-x/blog-images-bundle-2017/8a1f7d38.svg" alt="æœåŠ¡è€¦åˆç¤ºæ„å›¾"></p><p>æœåŠ¡è€¦åˆç¤ºæ„å›¾</p><p>è®¢å•æœåŠ¡æ¥å£ä¸­æä¾›äº†æŸ¥è¯¢ã€åˆ›å»ºè®¢å•ç›¸å…³çš„æ¥å£ï¼Œä¹Ÿæä¾›äº†è®¢å•è¯„ä»·ã€æ”¯ä»˜ã€ä¿é™©çš„æ¥å£ã€‚åŒæ—¶æˆ‘ä»¬çš„è¡¨ä¹Ÿæ˜¯ä¸€ä¸ªè®¢å•å¤§è¡¨ï¼ŒåŒ…å«äº†éå¸¸å¤šå­—æ®µã€‚åœ¨æˆ‘ä»¬ç»´æŠ¤ä»£ç æ—¶ï¼Œç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ï¼Œå¾ˆå¯èƒ½åªæ˜¯æƒ³æ”¹ä¸‹è¯„ä»·ç›¸å…³çš„åŠŸèƒ½ï¼Œå´å½±å“åˆ°äº†åˆ›å•æ ¸å¿ƒè·¯å¾„ã€‚è™½ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡æµ‹è¯•ä¿è¯åŠŸèƒ½å®Œå¤‡æ€§ï¼Œä½†å½“æˆ‘ä»¬åœ¨è®¢å•é¢†åŸŸæœ‰å¤§é‡éœ€æ±‚åŒæ—¶å¹¶è¡Œå¼€å‘æ—¶ï¼Œæ”¹åŠ¨é‡å ã€æ¶æ€§å¾ªç¯ã€ç–²äºå¥”å‘½ä¿®æ”¹å„ç§é—®é¢˜ã€‚</p><p>ä¸Šè¿°é—®é¢˜ï¼Œå½’æ ¹åˆ°åº•åœ¨äºç³»ç»Ÿæ¶æ„ä¸æ¸…æ™°ï¼Œåˆ’åˆ†å‡ºæ¥çš„æ¨¡å—å†…èšåº¦ä½ã€é«˜è€¦åˆã€‚</p><p>æœ‰ä¸€ç§è§£å†³æ–¹æ¡ˆï¼ŒæŒ‰ç…§æ¼”è¿›å¼è®¾è®¡çš„ç†è®ºï¼Œè®©ç³»ç»Ÿçš„è®¾è®¡éšç€ç³»ç»Ÿå®ç°çš„å¢é•¿è€Œå¢é•¿ã€‚æˆ‘ä»¬ä¸éœ€è¦ä½œæå‰è®¾è®¡ï¼Œå°±è®©ç³»ç»Ÿä¼´éšä¸šåŠ¡æˆé•¿è€Œæ¼”è¿›ã€‚è¿™å½“ç„¶æ˜¯å¯è¡Œçš„ï¼Œæ•æ·å®è·µä¸­çš„é‡æ„ã€æµ‹è¯•é©±åŠ¨è®¾è®¡åŠæŒç»­é›†æˆå¯ä»¥å¯¹ä»˜å„ç§æ··ä¹±é—®é¢˜ã€‚é‡æ„â€”â€”ä¿æŒè¡Œä¸ºä¸å˜çš„ä»£ç æ”¹å–„æ¸…é™¤äº†ä¸åè°ƒçš„å±€éƒ¨è®¾è®¡ï¼Œæµ‹è¯•é©±åŠ¨è®¾è®¡ç¡®ä¿å¯¹ç³»ç»Ÿçš„æ›´æ”¹ä¸ä¼šå¯¼è‡´ç³»ç»Ÿä¸¢å¤±æˆ–ç ´åç°æœ‰åŠŸèƒ½ï¼ŒæŒç»­é›†æˆåˆ™ä¸ºå›¢é˜Ÿæä¾›äº†åŒä¸€ä»£ç åº“ã€‚</p><p>åœ¨è¿™ä¸‰ç§å®è·µä¸­ï¼Œ<strong>é‡æ„æ˜¯å…‹æœæ¼”è¿›å¼è®¾è®¡ä¸­å¤§æ‚çƒ©é—®é¢˜çš„ä¸»åŠ›</strong>ï¼Œé€šè¿‡åœ¨å•ç‹¬çš„ç±»åŠæ–¹æ³•çº§åˆ«ä¸Šåšä¸€ç³»åˆ—å°æ­¥é‡æ„æ¥å®Œæˆã€‚æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“é‡æ„å‡ºä¸€ä¸ªç‹¬ç«‹çš„ç±»æ¥æ”¾æŸäº›é€šç”¨çš„é€»è¾‘ï¼Œä½†æ˜¯ä½ ä¼šå‘ç°ä½ å¾ˆéš¾ç»™å®ƒä¸€ä¸ªä¸šåŠ¡ä¸Šçš„å«ä¹‰ï¼Œåªèƒ½ç»™äºˆä¸€ä¸ªæŠ€æœ¯ç»´åº¦æç»˜çš„å«ä¹‰ã€‚è¿™ä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿæ–°åŒå­¦å¹¶ä¸æ€»æ˜¯çŸ¥é“å¯¹é€šç”¨é€»è¾‘çš„æ”¹åŠ¨æˆ–è·å–æ¥è‡ªè¯¥ç±»ã€‚æ˜¾ç„¶ï¼Œåˆ¶å®šé¡¹ç›®è§„èŒƒå¹¶ä¸æ˜¯å¥½çš„ideaã€‚æˆ‘ä»¬åˆé—»åˆ°äº†ä»£ç å³å°†è…è´¥çš„å‘³é“ã€‚</p><p>äº‹å®ä¸Šï¼Œä½ å¯èƒ½æ„è¯†åˆ°é—®é¢˜ä¹‹æ‰€åœ¨ã€‚åœ¨è§£å†³ç°å®é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬ä¼šå°†é—®é¢˜æ˜ å°„åˆ°è„‘æµ·ä¸­çš„æ¦‚å¿µæ¨¡å‹ï¼Œåœ¨æ¨¡å‹ä¸­è§£å†³é—®é¢˜ï¼Œå†å°†è§£å†³æ–¹æ¡ˆè½¬æ¢ä¸ºå®é™…çš„ä»£ç ã€‚ä¸Šè¿°é—®é¢˜åœ¨äºæˆ‘ä»¬è§£å†³äº†è®¾è®¡åˆ°ä»£ç ä¹‹é—´çš„é‡æ„ï¼Œ<strong>ä½†æç‚¼å‡ºæ¥çš„è®¾è®¡æ¨¡å‹ï¼Œå¹¶ä¸å…·æœ‰å®é™…çš„ä¸šåŠ¡å«ä¹‰ï¼Œè¿™å°±å¯¼è‡´åœ¨å¼€å‘æ–°éœ€æ±‚æ—¶ï¼Œå…¶ä»–åŒå­¦å¹¶ä¸èƒ½å¾ˆè‡ªç„¶åœ°å°†ä¸šåŠ¡é—®é¢˜æ˜ å°„åˆ°è¯¥è®¾è®¡æ¨¡å‹ã€‚è®¾è®¡ä¼¼ä¹å˜æˆäº†é‡æ„è€…çš„è‡ªå¨±è‡ªä¹ï¼Œä»£ç ç»§ç»­è…è´¥ï¼Œé‡æ–°é‡æ„â€¦â€¦æ— ä¼‘æ­¢çš„å¾ªç¯ã€‚</strong></p><p>ç”¨DDDåˆ™å¯ä»¥å¾ˆå¥½åœ°è§£å†³é¢†åŸŸæ¨¡å‹åˆ°è®¾è®¡æ¨¡å‹çš„åŒæ­¥ã€æ¼”åŒ–ï¼Œæœ€åå†å°†åæ˜ äº†é¢†åŸŸçš„è®¾è®¡æ¨¡å‹è½¬ä¸ºå®é™…çš„ä»£ç ã€‚</p><p>æ³¨ï¼šæ¨¡å‹æ˜¯æˆ‘ä»¬è§£å†³å®é™…é—®é¢˜æ‰€æŠ½è±¡å‡ºæ¥çš„æ¦‚å¿µæ¨¡å‹ï¼Œé¢†åŸŸæ¨¡å‹åˆ™è¡¨è¾¾ä¸ä¸šåŠ¡ç›¸å…³çš„äº‹å®ï¼›è®¾è®¡æ¨¡å‹åˆ™æè¿°äº†æ‰€è¦æ„å»ºçš„ç³»ç»Ÿã€‚</p><h3 id="è´«è¡€ç—‡å’Œå¤±å¿†ç—‡"><a href="#è´«è¡€ç—‡å’Œå¤±å¿†ç—‡" class="headerlink" title="è´«è¡€ç—‡å’Œå¤±å¿†ç—‡"></a>è´«è¡€ç—‡å’Œå¤±å¿†ç—‡</h3><blockquote><p><strong>è´«è¡€é¢†åŸŸå¯¹è±¡</strong></p><p>è´«è¡€é¢†åŸŸå¯¹è±¡ï¼ˆAnemic Domain Objectï¼‰æ˜¯æŒ‡ä»…ç”¨ä½œæ•°æ®è½½ä½“ï¼Œè€Œæ²¡æœ‰è¡Œä¸ºå’ŒåŠ¨ä½œçš„é¢†åŸŸå¯¹è±¡ã€‚</p></blockquote><p>åœ¨æˆ‘ä»¬ä¹ æƒ¯äº†J2EEçš„å¼€å‘æ¨¡å¼åï¼ŒAction&#x2F;Service&#x2F;DAOè¿™ç§åˆ†å±‚æ¨¡å¼ï¼Œä¼šå¾ˆè‡ªç„¶åœ°å†™å‡ºè¿‡ç¨‹å¼ä»£ç ï¼Œè€Œå­¦åˆ°çš„å¾ˆå¤šå…³äºOOç†è®ºçš„ä¹Ÿæ¯«æ— ç”¨æ­¦ä¹‹åœ°ã€‚ä½¿ç”¨è¿™ç§å¼€å‘æ–¹å¼ï¼Œå¯¹è±¡åªæ˜¯æ•°æ®çš„è½½ä½“ï¼Œæ²¡æœ‰è¡Œä¸ºã€‚ä»¥æ•°æ®ä¸ºä¸­å¿ƒï¼Œä»¥æ•°æ®åº“ERè®¾è®¡ä½œé©±åŠ¨ã€‚åˆ†å±‚æ¶æ„åœ¨è¿™ç§å¼€å‘æ¨¡å¼ä¸‹ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯å¯¹æ•°æ®ç§»åŠ¨ã€å¤„ç†å’Œå®ç°çš„è¿‡ç¨‹ã€‚</p><p>ä»¥ç¬”è€…æœ€è¿‘å¼€å‘çš„ç³»ç»ŸæŠ½å¥–å¹³å°ä¸ºä¾‹ï¼š</p><ul><li>åœºæ™¯éœ€æ±‚</li></ul><p>å¥–æ± é‡Œé…ç½®äº†å¾ˆå¤šå¥–é¡¹ï¼Œæˆ‘ä»¬éœ€è¦æŒ‰è¿è¥é¢„å…ˆé…ç½®çš„æ¦‚ç‡æŠ½ä¸­ä¸€ä¸ªå¥–é¡¹ã€‚ å®ç°éå¸¸ç®€å•ï¼Œç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼ŒåŒ¹é…ç¬¦åˆè¯¥éšæœºæ•°ç”Ÿæˆæ¦‚ç‡çš„å¥–é¡¹å³å¯ã€‚</p><ul><li>è´«è¡€æ¨¡å‹å®ç°æ–¹æ¡ˆ</li></ul><p>å…ˆè®¾è®¡å¥–æ± å’Œå¥–é¡¹çš„åº“è¡¨é…ç½®ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210307204734.svg" alt="æŠ½å¥–ERå›¾"></p><p>æŠ½å¥–ERå›¾</p><ul><li>è®¾è®¡AwardPoolå’ŒAwardä¸¤ä¸ªå¯¹è±¡ï¼Œåªæœ‰ç®€å•çš„getå’Œsetå±æ€§çš„æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AwardPool</span> &#123;</span><br><span class="line">    <span class="type">int</span> awardPoolId;</span><br><span class="line">    List&lt;Award&gt; awards;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Award&gt; <span class="title function_">getAwards</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> awards;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAwards</span><span class="params">(List&lt;Award&gt; awards)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.awards = awards;</span><br><span class="line">    &#125;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Award</span> &#123;</span><br><span class="line">   <span class="type">int</span> awardId;</span><br><span class="line">   <span class="type">int</span> probability;<span class="comment">//æ¦‚ç‡</span></span><br><span class="line">  </span><br><span class="line">   ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Serviceä»£ç å®ç°</li></ul><p>è®¾è®¡ä¸€ä¸ªLotteryServiceï¼Œåœ¨å…¶ä¸­çš„drawLottery()æ–¹æ³•å†™æœåŠ¡é€»è¾‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AwardPool</span> <span class="variable">awardPool</span> <span class="operator">=</span> awardPoolDao.getAwardPool(poolId);<span class="comment">//sqlæŸ¥è¯¢ï¼Œå°†æ•°æ®æ˜ å°„åˆ°AwardPoolå¯¹è±¡</span></span><br><span class="line"><span class="keyword">for</span> (Award award : awardPool.getAwards()) &#123;</span><br><span class="line">   <span class="comment">//å¯»æ‰¾åˆ°ç¬¦åˆaward.getProbability()æ¦‚ç‡çš„award</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æŒ‰ç…§æˆ‘ä»¬é€šå¸¸æ€è·¯å®ç°ï¼Œå¯ä»¥å‘ç°ï¼šåœ¨ä¸šåŠ¡é¢†åŸŸé‡Œéå¸¸é‡è¦çš„æŠ½å¥–ï¼Œæˆ‘çš„ä¸šåŠ¡é€»è¾‘éƒ½æ˜¯å†™åœ¨Serviceä¸­çš„ï¼ŒAwardå……å…¶é‡åªæ˜¯ä¸ªæ•°æ®è½½ä½“ï¼Œæ²¡æœ‰ä»»ä½•è¡Œä¸ºã€‚<strong>ç®€å•çš„ä¸šåŠ¡ç³»ç»Ÿé‡‡ç”¨è¿™ç§è´«è¡€æ¨¡å‹å’Œè¿‡ç¨‹åŒ–è®¾è®¡æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œ</strong>ä½†åœ¨ä¸šåŠ¡é€»è¾‘å¤æ‚äº†ï¼Œä¸šåŠ¡é€»è¾‘ã€çŠ¶æ€ä¼šæ•£è½åˆ°åœ¨å¤§é‡æ–¹æ³•ä¸­ï¼ŒåŸæœ¬çš„ä»£ç æ„å›¾ä¼šæ¸æ¸ä¸æ˜ç¡®ï¼Œæˆ‘ä»¬å°†è¿™ç§æƒ…å†µç§°ä¸ºç”±è´«è¡€ç—‡å¼•èµ·çš„<strong>å¤±å¿†ç—‡</strong>ã€‚</li></ul><p>æ›´å¥½çš„æ˜¯é‡‡ç”¨é¢†åŸŸæ¨¡å‹çš„å¼€å‘æ–¹å¼ï¼Œå°†æ•°æ®å’Œè¡Œä¸ºå°è£…åœ¨ä¸€èµ·ï¼Œå¹¶ä¸ç°å®ä¸–ç•Œä¸­çš„ä¸šåŠ¡å¯¹è±¡ç›¸æ˜ å°„ã€‚å„ç±»å…·å¤‡æ˜ç¡®çš„èŒè´£åˆ’åˆ†ï¼Œå°†é¢†åŸŸé€»è¾‘åˆ†æ•£åˆ°é¢†åŸŸå¯¹è±¡ä¸­ã€‚ç»§ç»­ä¸¾æˆ‘ä»¬ä¸Šè¿°æŠ½å¥–çš„ä¾‹å­ï¼Œä½¿ç”¨æ¦‚ç‡é€‰æ‹©å¯¹åº”çš„å¥–å“å°±åº”å½“æ”¾åˆ°AwardPoolç±»ä¸­ã€‚</p><h3 id="è½¯ä»¶ç³»ç»Ÿå¤æ‚æ€§åº”å¯¹"><a href="#è½¯ä»¶ç³»ç»Ÿå¤æ‚æ€§åº”å¯¹" class="headerlink" title="è½¯ä»¶ç³»ç»Ÿå¤æ‚æ€§åº”å¯¹"></a>è½¯ä»¶ç³»ç»Ÿå¤æ‚æ€§åº”å¯¹</h3><p>è§£å†³<strong>å¤æ‚å’Œå¤§è§„æ¨¡è½¯ä»¶</strong>çš„æ­¦å™¨å¯ä»¥è¢«ç²—ç•¥åœ°å½’ä¸ºä¸‰ç±»ï¼šæŠ½è±¡ã€åˆ†æ²»å’ŒçŸ¥è¯†ã€‚</p><p><strong>åˆ†æ²»</strong> æŠŠé—®é¢˜ç©ºé—´åˆ†å‰²ä¸ºè§„æ¨¡æ›´å°ä¸”æ˜“äºå¤„ç†çš„è‹¥å¹²å­é—®é¢˜ã€‚åˆ†å‰²åçš„é—®é¢˜éœ€è¦è¶³å¤Ÿå°ï¼Œä»¥ä¾¿ä¸€ä¸ªäººå•æªåŒ¹é©¬å°±èƒ½å¤Ÿè§£å†³ä»–ä»¬ï¼›å…¶æ¬¡ï¼Œå¿…é¡»è€ƒè™‘å¦‚ä½•å°†åˆ†å‰²åçš„å„ä¸ªéƒ¨åˆ†è£…é…ä¸ºæ•´ä½“ã€‚åˆ†å‰²å¾—è¶Šåˆç†è¶Šæ˜“äºç†è§£ï¼Œåœ¨è£…é…æˆæ•´ä½“æ—¶ï¼Œæ‰€éœ€è·Ÿè¸ªçš„ç»†èŠ‚ä¹Ÿå°±è¶Šå°‘ã€‚å³æ›´å®¹æ˜“è®¾è®¡å„éƒ¨åˆ†çš„åä½œæ–¹å¼ã€‚è¯„åˆ¤ä»€ä¹ˆæ˜¯åˆ†æ²»å¾—å¥½ï¼Œå³é«˜å†…èšä½è€¦åˆã€‚</p><p><strong>æŠ½è±¡</strong> ä½¿ç”¨æŠ½è±¡èƒ½å¤Ÿç²¾ç®€é—®é¢˜ç©ºé—´ï¼Œè€Œä¸”é—®é¢˜è¶Šå°è¶Šå®¹æ˜“ç†è§£ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä»åŒ—äº¬åˆ°ä¸Šæµ·å‡ºå·®ï¼Œå¯ä»¥å…ˆç†è§£ä¸ºä½¿ç”¨äº¤é€šå·¥å…·å‰å¾€ï¼Œä½†ä¸éœ€è¦ä¸€å¼€å§‹å°±æƒ³æ¸…æ¥šåˆ°åº•æ˜¯é«˜é“è¿˜æ˜¯é£æœºï¼Œä»¥åŠä¹˜åä»–ä»¬éœ€è¦æ³¨æ„ä»€ä¹ˆã€‚</p><p><strong>çŸ¥è¯†</strong> é¡¾åæ€ä¹‰ï¼ŒDDDå¯ä»¥è®¤ä¸ºæ˜¯çŸ¥è¯†çš„ä¸€ç§ã€‚</p><p>DDDæä¾›äº†è¿™æ ·çš„çŸ¥è¯†æ‰‹æ®µï¼Œè®©æˆ‘ä»¬çŸ¥é“å¦‚ä½•æŠ½è±¡å‡ºé™ç•Œä¸Šä¸‹æ–‡ä»¥åŠå¦‚ä½•å»åˆ†æ²»ã€‚</p><h3 id="ä¸å¾®æœåŠ¡æ¶æ„ç›¸å¾—ç›Šå½°"><a href="#ä¸å¾®æœåŠ¡æ¶æ„ç›¸å¾—ç›Šå½°" class="headerlink" title="ä¸å¾®æœåŠ¡æ¶æ„ç›¸å¾—ç›Šå½°"></a>ä¸å¾®æœåŠ¡æ¶æ„ç›¸å¾—ç›Šå½°</h3><p>å¾®æœåŠ¡æ¶æ„ä¼—æ‰€å‘¨çŸ¥ï¼Œæ­¤å¤„ä¸åšèµ˜è¿°ã€‚æˆ‘ä»¬åˆ›å»ºå¾®æœåŠ¡æ—¶ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªé«˜å†…èšã€ä½è€¦åˆçš„å¾®æœåŠ¡ã€‚è€ŒDDDä¸­çš„é™ç•Œä¸Šä¸‹æ–‡åˆ™å®Œç¾åŒ¹é…å¾®æœåŠ¡è¦æ±‚ï¼Œå¯ä»¥å°†è¯¥é™ç•Œä¸Šä¸‹æ–‡ç†è§£ä¸ºä¸€ä¸ªå¾®æœåŠ¡è¿›ç¨‹ã€‚</p><p>ä¸Šè¿°æ˜¯ä»æ›´ç›´è§‚çš„è§’åº¦æ¥æè¿°ä¸¤è€…çš„ç›¸ä¼¼å¤„ã€‚</p><p>åœ¨ç³»ç»Ÿå¤æ‚ä¹‹åï¼Œæˆ‘ä»¬éƒ½éœ€è¦ç”¨åˆ†æ²»æ¥æ‹†è§£é—®é¢˜ã€‚ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼ŒæŠ€æœ¯ç»´åº¦å’Œä¸šåŠ¡ç»´åº¦ã€‚æŠ€æœ¯ç»´åº¦æ˜¯ç±»ä¼¼MVCè¿™æ ·ï¼Œä¸šåŠ¡ç»´åº¦åˆ™æ˜¯æŒ‡æŒ‰ä¸šåŠ¡é¢†åŸŸæ¥åˆ’åˆ†ç³»ç»Ÿã€‚</p><p>å¾®æœåŠ¡æ¶æ„æ›´å¼ºè°ƒä»ä¸šåŠ¡ç»´åº¦å»åšåˆ†æ²»æ¥åº”å¯¹ç³»ç»Ÿå¤æ‚åº¦ï¼Œè€ŒDDDä¹Ÿæ˜¯åŒæ ·çš„ç€é‡ä¸šåŠ¡è§†è§’ã€‚ å¦‚æœ<strong>ä¸¤è€…åœ¨è¿½æ±‚çš„ç›®æ ‡ï¼ˆä¸šåŠ¡ç»´åº¦ï¼‰è¾¾åˆ°äº†ä¸Šä¸‹æ–‡çš„ç»Ÿä¸€</strong>ï¼Œé‚£ä¹ˆåœ¨å…·ä½“åšæ³•ä¸Šæœ‰ä»€ä¹ˆè”ç³»å’Œä¸åŒå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å°†æ¶æ„è®¾è®¡æ´»åŠ¨ç²¾ç®€ä¸ºä»¥ä¸‹ä¸‰ä¸ªå±‚é¢ï¼š</p><ul><li>ä¸šåŠ¡æ¶æ„â€”â€”æ ¹æ®ä¸šåŠ¡éœ€æ±‚è®¾è®¡ä¸šåŠ¡æ¨¡å—åŠå…¶å…³ç³»</li><li>ç³»ç»Ÿæ¶æ„â€”â€”è®¾è®¡ç³»ç»Ÿå’Œå­ç³»ç»Ÿçš„æ¨¡å—</li><li>æŠ€æœ¯æ¶æ„â€”â€”å†³å®šé‡‡ç”¨çš„æŠ€æœ¯åŠæ¡†æ¶</li></ul><p>ä»¥ä¸Šä¸‰ç§æ´»åŠ¨åœ¨å®é™…å¼€å‘ä¸­æ˜¯æœ‰å…ˆåé¡ºåºçš„ï¼Œä½†ä¸ä¸€å®šå­°å…ˆå­°åã€‚åœ¨æˆ‘ä»¬è§£å†³å¸¸è§„å¥—è·¯é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬ä¼šå¾ˆè‡ªç„¶åœ°å¾€ç†Ÿæ‚‰çš„åˆ†å±‚æ¶æ„å¥—ï¼ˆå…ˆç¡®å®šç³»ç»Ÿæ¶æ„ï¼‰ï¼Œæˆ–è€…ç”¨PHPå¼€å‘å¾ˆå¿«ï¼ˆå…ˆç¡®å®šæŠ€æœ¯æ¶æ„ï¼‰ï¼Œåœ¨ä¸šåŠ¡ä¸å¤æ‚æ—¶ï¼Œè¿™æ ·æ˜¯åˆç†çš„ã€‚</p><p>è·³è¿‡ä¸šåŠ¡æ¶æ„è®¾è®¡å‡ºæ¥çš„æ¶æ„å…³æ³¨ç‚¹ä¸åœ¨ä¸šåŠ¡å“åº”ä¸Šï¼Œå¯èƒ½å°±æ˜¯ä¸ªå¤§æ³¥çƒï¼Œåœ¨é¢ä¸´éœ€æ±‚è¿­ä»£æˆ–å“åº”å¸‚åœºå˜åŒ–æ—¶å°±å¾ˆç—›è‹¦ã€‚</p><p><strong>DDDçš„æ ¸å¿ƒè¯‰æ±‚å°±æ˜¯å°†ä¸šåŠ¡æ¶æ„æ˜ å°„åˆ°ç³»ç»Ÿæ¶æ„ä¸Šï¼Œåœ¨å“åº”ä¸šåŠ¡å˜åŒ–è°ƒæ•´ä¸šåŠ¡æ¶æ„æ—¶ï¼Œä¹Ÿéšä¹‹å˜åŒ–ç³»ç»Ÿæ¶æ„ã€‚è€Œå¾®æœåŠ¡è¿½æ±‚ä¸šåŠ¡å±‚é¢çš„å¤ç”¨ï¼Œè®¾è®¡å‡ºæ¥çš„ç³»ç»Ÿæ¶æ„å’Œä¸šåŠ¡ä¸€è‡´ï¼›åœ¨æŠ€æœ¯æ¶æ„ä¸Šåˆ™ç³»ç»Ÿæ¨¡å—ä¹‹é—´å……åˆ†è§£è€¦ï¼Œå¯ä»¥è‡ªç”±åœ°é€‰æ‹©åˆé€‚çš„æŠ€æœ¯æ¶æ„ï¼Œå»ä¸­å¿ƒåŒ–åœ°æ²»ç†æŠ€æœ¯å’Œæ•°æ®ã€‚</strong></p><p>å¯ä»¥å‚è§ä¸‹å›¾æ¥æ›´å¥½åœ°ç†è§£åŒæ–¹ä¹‹é—´çš„åä½œå…³ç³»ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210307204709.svg" alt="DDDä¸å¾®æœåŠ¡å…³ç³»"></p><p>DDDä¸å¾®æœåŠ¡å…³ç³»</p><h2 id="å¦‚ä½•å®è·µDDD"><a href="#å¦‚ä½•å®è·µDDD" class="headerlink" title="å¦‚ä½•å®è·µDDD"></a>å¦‚ä½•å®è·µDDD</h2><p>æˆ‘ä»¬å°†é€šè¿‡ä¸Šæ–‡æåˆ°çš„æŠ½å¥–å¹³å°ï¼Œæ¥è¯¦ç»†ä»‹ç»æˆ‘ä»¬å¦‚ä½•é€šè¿‡DDDæ¥è§£æ„ä¸€ä¸ªä¸­å‹çš„åŸºäºå¾®æœåŠ¡æ¶æ„çš„ç³»ç»Ÿï¼Œä»è€Œåšåˆ°ç³»ç»Ÿçš„é«˜å†…èšã€ä½è€¦åˆã€‚</p><p>é¦–å…ˆçœ‹ä¸‹æŠ½å¥–ç³»ç»Ÿçš„å¤§è‡´éœ€æ±‚ï¼š è¿è¥â€”â€”å¯ä»¥é…ç½®ä¸€ä¸ªæŠ½å¥–æ´»åŠ¨ï¼Œè¯¥æ´»åŠ¨é¢å‘ä¸€ä¸ªç‰¹å®šçš„ç”¨æˆ·ç¾¤ä½“ï¼Œå¹¶é’ˆå¯¹ä¸€ä¸ªç”¨æˆ·ç¾¤ä½“å‘æ”¾ä¸€æ‰¹ä¸åŒç±»å‹çš„å¥–å“ï¼ˆä¼˜æƒ åˆ¸ï¼Œæ¿€æ´»ç ï¼Œå®ç‰©å¥–å“ç­‰ï¼‰ã€‚ ç”¨æˆ·-é€šè¿‡æ´»åŠ¨é¡µé¢å‚ä¸ä¸åŒç±»å‹çš„æŠ½å¥–æ´»åŠ¨ã€‚</p><p>è®¾è®¡é¢†åŸŸæ¨¡å‹çš„ä¸€èˆ¬æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>æ ¹æ®éœ€æ±‚åˆ’åˆ†å‡ºåˆæ­¥çš„é¢†åŸŸå’Œé™ç•Œä¸Šä¸‹æ–‡ï¼Œä»¥åŠä¸Šä¸‹æ–‡ä¹‹é—´çš„å…³ç³»ï¼›</li><li>è¿›ä¸€æ­¥åˆ†ææ¯ä¸ªä¸Šä¸‹æ–‡å†…éƒ¨ï¼Œè¯†åˆ«å‡ºå“ªäº›æ˜¯å®ä½“ï¼Œå“ªäº›æ˜¯å€¼å¯¹è±¡ï¼›</li><li>å¯¹å®ä½“ã€å€¼å¯¹è±¡è¿›è¡Œå…³è”å’Œèšåˆï¼Œåˆ’åˆ†å‡ºèšåˆçš„èŒƒç•´å’Œèšåˆæ ¹ï¼›</li><li>ä¸ºèšåˆæ ¹è®¾è®¡ä»“å‚¨ï¼Œå¹¶æ€è€ƒå®ä½“æˆ–å€¼å¯¹è±¡çš„åˆ›å»ºæ–¹å¼ï¼›</li><li>åœ¨å·¥ç¨‹ä¸­å®è·µé¢†åŸŸæ¨¡å‹ï¼Œå¹¶åœ¨å®è·µä¸­æ£€éªŒæ¨¡å‹çš„åˆç†æ€§ï¼Œå€’æ¨æ¨¡å‹ä¸­ä¸è¶³çš„åœ°æ–¹å¹¶é‡æ„ã€‚</li></ol><h3 id="æˆ˜ç•¥å»ºæ¨¡"><a href="#æˆ˜ç•¥å»ºæ¨¡" class="headerlink" title="æˆ˜ç•¥å»ºæ¨¡"></a>æˆ˜ç•¥å»ºæ¨¡</h3><p>æˆ˜ç•¥å’Œæˆ˜æœ¯è®¾è®¡æ˜¯ç«™åœ¨DDDçš„è§’åº¦è¿›è¡Œåˆ’åˆ†ã€‚æˆ˜ç•¥è®¾è®¡ä¾§é‡äºé«˜å±‚æ¬¡ã€å®è§‚ä¸Šå»åˆ’åˆ†å’Œé›†æˆé™ç•Œä¸Šä¸‹æ–‡ï¼Œè€Œæˆ˜æœ¯è®¾è®¡åˆ™å…³æ³¨æ›´å…·ä½“ä½¿ç”¨å»ºæ¨¡å·¥å…·æ¥ç»†åŒ–ä¸Šä¸‹æ–‡ã€‚</p><h4 id="é¢†åŸŸ"><a href="#é¢†åŸŸ" class="headerlink" title="é¢†åŸŸ"></a>é¢†åŸŸ</h4><p>ç°å®ä¸–ç•Œä¸­ï¼Œé¢†åŸŸåŒ…å«äº†é—®é¢˜åŸŸå’Œè§£ç³»ç»Ÿã€‚ä¸€èˆ¬è®¤ä¸ºè½¯ä»¶æ˜¯å¯¹ç°å®ä¸–ç•Œçš„éƒ¨åˆ†æ¨¡æ‹Ÿã€‚åœ¨DDDä¸­ï¼Œè§£ç³»ç»Ÿå¯ä»¥æ˜ å°„ä¸ºä¸€ä¸ªä¸ªé™ç•Œä¸Šä¸‹æ–‡ï¼Œé™ç•Œä¸Šä¸‹æ–‡å°±æ˜¯è½¯ä»¶å¯¹äºé—®é¢˜åŸŸçš„ä¸€ä¸ªç‰¹å®šçš„ã€æœ‰é™çš„è§£å†³æ–¹æ¡ˆã€‚</p><h4 id="é™ç•Œä¸Šä¸‹æ–‡"><a href="#é™ç•Œä¸Šä¸‹æ–‡" class="headerlink" title="é™ç•Œä¸Šä¸‹æ–‡"></a>é™ç•Œä¸Šä¸‹æ–‡</h4><blockquote><p><strong>é™ç•Œä¸Šä¸‹æ–‡</strong></p><p>ä¸€ä¸ªç”±æ˜¾ç¤ºè¾¹ç•Œé™å®šçš„ç‰¹å®šèŒè´£ã€‚é¢†åŸŸæ¨¡å‹ä¾¿å­˜åœ¨äºè¿™ä¸ªè¾¹ç•Œä¹‹å†…ã€‚åœ¨è¾¹ç•Œå†…ï¼Œæ¯ä¸€ä¸ªæ¨¡å‹æ¦‚å¿µï¼ŒåŒ…æ‹¬å®ƒçš„å±æ€§å’Œæ“ä½œï¼Œéƒ½å…·æœ‰ç‰¹æ®Šçš„å«ä¹‰ã€‚</p></blockquote><p>ä¸€ä¸ªç»™å®šçš„ä¸šåŠ¡é¢†åŸŸä¼šåŒ…å«å¤šä¸ªé™ç•Œä¸Šä¸‹æ–‡ï¼Œæƒ³ä¸ä¸€ä¸ªé™ç•Œä¸Šä¸‹æ–‡æ²Ÿé€šï¼Œåˆ™éœ€è¦é€šè¿‡æ˜¾ç¤ºè¾¹ç•Œè¿›è¡Œé€šä¿¡ã€‚ç³»ç»Ÿé€šè¿‡ç¡®å®šçš„é™ç•Œä¸Šä¸‹æ–‡æ¥è¿›è¡Œè§£è€¦ï¼Œè€Œæ¯ä¸€ä¸ªä¸Šä¸‹æ–‡å†…éƒ¨ç´§å¯†ç»„ç»‡ï¼ŒèŒè´£æ˜ç¡®ï¼Œå…·æœ‰è¾ƒé«˜çš„å†…èšæ€§ã€‚</p><p>ä¸€ä¸ªå¾ˆå½¢è±¡çš„éšå–»ï¼šç»†èƒè´¨æ‰€ä»¥èƒ½å¤Ÿå­˜åœ¨ï¼Œæ˜¯å› ä¸ºç»†èƒè†œé™å®šäº†ä»€ä¹ˆåœ¨ç»†èƒå†…ï¼Œä»€ä¹ˆåœ¨ç»†èƒå¤–ï¼Œå¹¶ä¸”ç¡®å®šäº†ä»€ä¹ˆç‰©è´¨å¯ä»¥é€šè¿‡ç»†èƒè†œã€‚</p><h4 id="åˆ’åˆ†é™ç•Œä¸Šä¸‹æ–‡"><a href="#åˆ’åˆ†é™ç•Œä¸Šä¸‹æ–‡" class="headerlink" title="åˆ’åˆ†é™ç•Œä¸Šä¸‹æ–‡"></a>åˆ’åˆ†é™ç•Œä¸Šä¸‹æ–‡</h4><p>åˆ’åˆ†é™ç•Œä¸Šä¸‹æ–‡ï¼Œä¸ç®¡æ˜¯Eric Evansè¿˜æ˜¯Vaughn Vernonï¼Œåœ¨ä»–ä»¬çš„å¤§ä½œé‡Œéƒ½æ²¡æœ‰æ€ä¹ˆæåŠã€‚</p><p>æ˜¾ç„¶æˆ‘ä»¬ä¸åº”è¯¥æŒ‰æŠ€æœ¯æ¶æ„æˆ–è€…å¼€å‘ä»»åŠ¡æ¥åˆ›å»ºé™ç•Œä¸Šä¸‹æ–‡ï¼Œåº”è¯¥æŒ‰ç…§è¯­ä¹‰çš„è¾¹ç•Œæ¥è€ƒè™‘ã€‚</p><p><strong>æˆ‘ä»¬çš„å®è·µæ˜¯ï¼Œè€ƒè™‘äº§å“æ‰€è®²çš„é€šç”¨è¯­è¨€ï¼Œä»ä¸­æå–ä¸€äº›æœ¯è¯­ç§°ä¹‹ä¸ºæ¦‚å¿µå¯¹è±¡ï¼Œå¯»æ‰¾å¯¹è±¡ä¹‹é—´çš„è”ç³»ï¼›æˆ–è€…ä»éœ€æ±‚é‡Œæå–ä¸€äº›åŠ¨è¯ï¼Œè§‚å¯ŸåŠ¨è¯å’Œå¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼›æˆ‘ä»¬å°†ç´§è€¦åˆçš„å„è‡ªåœˆåœ¨ä¸€èµ·ï¼Œè§‚å¯Ÿä»–ä»¬å†…åœ¨çš„è”ç³»ï¼Œä»è€Œå½¢æˆå¯¹åº”çš„ç•Œé™ä¸Šä¸‹æ–‡ã€‚å½¢æˆä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ç”¨è¯­è¨€æ¥æè¿°ä¸‹ç•Œé™ä¸Šä¸‹æ–‡çš„èŒè´£ï¼Œçœ‹å®ƒæ˜¯å¦æ¸…æ™°ã€å‡†ç¡®ã€ç®€æ´å’Œå®Œæ•´ã€‚ç®€è¨€ä¹‹ï¼Œé™ç•Œä¸Šä¸‹æ–‡åº”è¯¥ä»éœ€æ±‚å‡ºå‘ï¼ŒæŒ‰é¢†åŸŸåˆ’åˆ†ã€‚</strong></p><p>å‰æ–‡æåˆ°ï¼Œæˆ‘ä»¬çš„ç”¨æˆ·åˆ’åˆ†ä¸ºè¿è¥å’Œç”¨æˆ·ã€‚å…¶ä¸­ï¼Œè¿è¥å¯¹æŠ½å¥–æ´»åŠ¨çš„é…ç½®ååˆ†å¤æ‚ä½†ç›¸å¯¹ä½é¢‘ã€‚ç”¨æˆ·å¯¹è¿™äº›æŠ½å¥–æ´»åŠ¨é…ç½®çš„ä½¿ç”¨æ˜¯é«˜é¢‘æ¬¡ä¸”æ— æ„ŸçŸ¥çš„ã€‚æ ¹æ®è¿™æ ·çš„ä¸šåŠ¡ç‰¹ç‚¹ï¼Œæˆ‘ä»¬é¦–å…ˆå°†æŠ½å¥–å¹³å°åˆ’åˆ†ä¸ºCç«¯æŠ½å¥–å’ŒMç«¯æŠ½å¥–ç®¡ç†å¹³å°ä¸¤ä¸ªå­åŸŸï¼Œè®©ä¸¤è€…å®Œå…¨è§£è€¦ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210307204646.svg" alt="æŠ½å¥–å¹³å°é¢†åŸŸ"></p><p>æŠ½å¥–å¹³å°é¢†åŸŸ</p><p>åœ¨ç¡®è®¤äº†Mç«¯é¢†åŸŸå’ŒCç«¯çš„é™ç•Œä¸Šä¸‹æ–‡åï¼Œæˆ‘ä»¬å†å¯¹å„è‡ªä¸Šä¸‹æ–‡å†…éƒ¨è¿›è¡Œé™ç•Œä¸Šä¸‹æ–‡çš„åˆ’åˆ†ã€‚ä¸‹é¢æˆ‘ä»¬ç”¨Cç«¯è¿›è¡Œä¸¾ä¾‹ã€‚</p><p>äº§å“çš„éœ€æ±‚æ¦‚è¿°å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. æŠ½å¥–æ´»åŠ¨æœ‰æ´»åŠ¨é™åˆ¶ï¼Œä¾‹å¦‚ç”¨æˆ·çš„æŠ½å¥–æ¬¡æ•°é™åˆ¶ï¼ŒæŠ½å¥–çš„å¼€å§‹å’Œç»“æŸçš„æ—¶é—´ç­‰ï¼›</span><br><span class="line">2. ä¸€ä¸ªæŠ½å¥–æ´»åŠ¨åŒ…å«å¤šä¸ªå¥–å“ï¼Œå¯ä»¥é’ˆå¯¹ä¸€ä¸ªæˆ–å¤šä¸ªç”¨æˆ·ç¾¤ä½“ï¼›</span><br><span class="line">3. å¥–å“æœ‰è‡ªèº«çš„å¥–å“é…ç½®ï¼Œä¾‹å¦‚åº“å­˜é‡ï¼Œè¢«æŠ½ä¸­çš„æ¦‚ç‡ç­‰ï¼Œæœ€å¤šè¢«ä¸€ä¸ªç”¨æˆ·æŠ½ä¸­çš„æ¬¡æ•°ç­‰ç­‰ï¼›</span><br><span class="line">4. ç”¨æˆ·ç¾¤ä½“æœ‰å¤šç§åŒºåˆ«æ–¹å¼ï¼Œå¦‚æŒ‰ç…§ç”¨æˆ·æ‰€åœ¨åŸå¸‚åŒºåˆ†ï¼ŒæŒ‰ç…§æ–°è€å®¢åŒºåˆ†ç­‰ï¼›</span><br><span class="line">5. æ´»åŠ¨å…·æœ‰é£æ§é…ç½®ï¼Œèƒ½å¤Ÿé™åˆ¶ç”¨æˆ·å‚ä¸æŠ½å¥–çš„é¢‘ç‡ã€‚</span><br></pre></td></tr></table></figure><p>æ ¹æ®äº§å“çš„éœ€æ±‚ï¼Œæˆ‘ä»¬æå–äº†ä¸€äº›å…³é”®æ€§çš„æ¦‚å¿µä½œä¸ºå­åŸŸï¼Œå½¢æˆæˆ‘ä»¬çš„é™ç•Œä¸Šä¸‹æ–‡ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210307204603.svg" alt="Cç«¯æŠ½å¥–é¢†åŸŸ"></p><p>Cç«¯æŠ½å¥–é¢†åŸŸ</p><p>é¦–å…ˆï¼ŒæŠ½å¥–ä¸Šä¸‹æ–‡ä½œä¸ºæ•´ä¸ªé¢†åŸŸçš„æ ¸å¿ƒï¼Œæ‰¿æ‹…ç€ç”¨æˆ·æŠ½å¥–çš„æ ¸å¿ƒä¸šåŠ¡ï¼ŒæŠ½å¥–ä¸­åŒ…å«äº†å¥–å“å’Œç”¨æˆ·ç¾¤ä½“çš„æ¦‚å¿µã€‚</p><ul><li>åœ¨è®¾è®¡åˆæœŸï¼Œæˆ‘ä»¬æ›¾ç»è€ƒè™‘åˆ’åˆ†å‡ºæŠ½å¥–å’Œå‘å¥–ä¸¤ä¸ªé¢†åŸŸï¼Œå‰è€…è´Ÿè´£é€‰å¥–ï¼Œåè€…è´Ÿè´£å°†é€‰ä¸­çš„å¥–å“å‘æ”¾å‡ºå»ã€‚ä½†åœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å‘ç°è¿™ä¸¤éƒ¨åˆ†çš„é€»è¾‘ç´§å¯†è¿æ¥ï¼Œéš¾ä»¥æ‹†åˆ†ã€‚å¹¶ä¸”å•çº¯çš„å‘å¥–é€»è¾‘è¶³å¤Ÿç®€å•ï¼Œä»…ä»…æ˜¯è°ƒç”¨ç¬¬ä¸‰æ–¹æœåŠ¡è¿›è¡Œå‘å¥–ï¼Œä¸è¶³ä»¥ç‹¬ç«‹å‡ºæ¥æˆä¸ºä¸€ä¸ªé¢†åŸŸã€‚</li></ul><p>å¯¹äºæ´»åŠ¨çš„é™åˆ¶ï¼Œæˆ‘ä»¬å®šä¹‰äº†æ´»åŠ¨å‡†å…¥çš„é€šç”¨è¯­è¨€ï¼Œå°†æ´»åŠ¨å¼€å§‹&#x2F;ç»“æŸæ—¶é—´ï¼Œæ´»åŠ¨å¯å‚ä¸æ¬¡æ•°ç­‰é™åˆ¶æ¡ä»¶éƒ½æ”¶æ‹¢åˆ°æ´»åŠ¨å‡†å…¥ä¸Šä¸‹æ–‡ä¸­ã€‚</p><p>å¯¹äºæŠ½å¥–çš„å¥–å“åº“å­˜é‡ï¼Œç”±äºåº“å­˜çš„è¡Œä¸ºä¸å¥–å“æœ¬èº«ç›¸å¯¹è§£è€¦ï¼Œåº“å­˜å…³æ³¨ç‚¹æ›´å¤šæ˜¯åº“å­˜å†…å®¹çš„æ ¸é”€ï¼Œä¸”åº“å­˜æœ¬èº«å…·å¤‡é€šç”¨æ€§ï¼Œå¯ä»¥è¢«å¥–å“ä¹‹å¤–çš„å†…å®¹ä½¿ç”¨ï¼Œå› æ­¤æˆ‘ä»¬å®šä¹‰äº†ç‹¬ç«‹çš„åº“å­˜ä¸Šä¸‹æ–‡ã€‚</p><p>ç”±äºCç«¯å­˜åœ¨ä¸€äº›åˆ·å•è¡Œä¸ºï¼Œæˆ‘ä»¬æ ¹æ®äº§å“éœ€æ±‚å®šä¹‰äº†é£æ§ä¸Šä¸‹æ–‡ï¼Œç”¨äºå¯¹æ´»åŠ¨è¿›è¡Œé£æ§ã€‚ æœ€åï¼Œæ´»åŠ¨å‡†å…¥ã€é£æ§ã€æŠ½å¥–ç­‰é¢†åŸŸéƒ½æ¶‰åŠåˆ°ä¸€äº›æ¬¡æ•°çš„é™åˆ¶ï¼Œå› æ­¤æˆ‘ä»¬å®šä¹‰äº†è®¡æ•°ä¸Šä¸‹æ–‡ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡DDDçš„é™ç•Œä¸Šä¸‹æ–‡åˆ’åˆ†ï¼Œæˆ‘ä»¬ç•Œå®šå‡ºæŠ½å¥–ã€æ´»åŠ¨å‡†å…¥ã€é£æ§ã€è®¡æ•°ã€åº“å­˜ç­‰äº”ä¸ªä¸Šä¸‹æ–‡ï¼Œæ¯ä¸ªä¸Šä¸‹æ–‡åœ¨ç³»ç»Ÿä¸­éƒ½é«˜åº¦å†…èšã€‚</p><h4 id="ä¸Šä¸‹æ–‡æ˜ å°„å›¾"><a href="#ä¸Šä¸‹æ–‡æ˜ å°„å›¾" class="headerlink" title="ä¸Šä¸‹æ–‡æ˜ å°„å›¾"></a>ä¸Šä¸‹æ–‡æ˜ å°„å›¾</h4><p>åœ¨è¿›è¡Œä¸Šä¸‹æ–‡åˆ’åˆ†ä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦è¿›ä¸€æ­¥æ¢³ç†ä¸Šä¸‹æ–‡ä¹‹é—´çš„å…³ç³»ã€‚</p><blockquote><p><strong>åº·å¨ï¼ˆæ¢…å°”Â·åº·å¨ï¼‰å®šå¾‹</strong></p><p>ä»»ä½•ç»„ç»‡åœ¨è®¾è®¡ä¸€å¥—ç³»ç»Ÿï¼ˆå¹¿ä¹‰æ¦‚å¿µä¸Šçš„ç³»ç»Ÿï¼‰æ—¶ï¼Œæ‰€äº¤ä»˜çš„è®¾è®¡æ–¹æ¡ˆåœ¨ç»“æ„ä¸Šéƒ½ä¸è¯¥ç»„ç»‡çš„æ²Ÿé€šç»“æ„ä¿æŒä¸€è‡´ã€‚</p></blockquote><p>åº·å¨å®šå¾‹å‘Šè¯‰æˆ‘ä»¬ï¼Œç³»ç»Ÿç»“æ„åº”å°½é‡çš„ä¸ç»„ç»‡ç»“æ„ä¿æŒä¸€è‡´ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬è®¤ä¸ºå›¢é˜Ÿç»“æ„ï¼ˆæ— è®ºæ˜¯å†…éƒ¨ç»„ç»‡è¿˜æ˜¯å›¢é˜Ÿé—´ç»„ç»‡ï¼‰å°±æ˜¯ç»„ç»‡ç»“æ„ï¼Œé™ç•Œä¸Šä¸‹æ–‡å°±æ˜¯ç³»ç»Ÿçš„ä¸šåŠ¡ç»“æ„ã€‚å› æ­¤ï¼Œå›¢é˜Ÿç»“æ„åº”è¯¥å’Œé™ç•Œä¸Šä¸‹æ–‡ä¿æŒä¸€è‡´ã€‚</p><p>æ¢³ç†æ¸…æ¥šä¸Šä¸‹æ–‡ä¹‹é—´çš„å…³ç³»ï¼Œä»å›¢é˜Ÿå†…éƒ¨çš„å…³ç³»æ¥çœ‹ï¼Œæœ‰å¦‚ä¸‹å¥½å¤„ï¼š</p><ol><li>ä»»åŠ¡æ›´å¥½æ‹†åˆ†ï¼Œä¸€ä¸ªå¼€å‘äººå‘˜å¯ä»¥å…¨èº«å¿ƒçš„æŠ•å…¥åˆ°ç›¸å…³çš„ä¸€ä¸ªå•ç‹¬çš„ä¸Šä¸‹æ–‡ä¸­ï¼›</li><li>æ²Ÿé€šæ›´åŠ é¡ºç•…ï¼Œä¸€ä¸ªä¸Šä¸‹æ–‡å¯ä»¥æ˜ç¡®è‡ªå·±å¯¹å…¶ä»–ä¸Šä¸‹æ–‡çš„ä¾èµ–å…³ç³»ï¼Œä»è€Œä½¿å¾—å›¢é˜Ÿå†…å¼€å‘ç›´æ¥æ›´å¥½çš„å¯¹æ¥ã€‚</li></ol><p>ä»å›¢é˜Ÿé—´çš„å…³ç³»æ¥çœ‹ï¼Œæ˜ç¡®çš„ä¸Šä¸‹æ–‡å…³ç³»èƒ½å¤Ÿå¸¦æ¥å¦‚ä¸‹å¸®åŠ©ï¼š</p><ol><li>æ¯ä¸ªå›¢é˜Ÿåœ¨å®ƒçš„ä¸Šä¸‹æ–‡ä¸­èƒ½å¤Ÿæ›´åŠ æ˜ç¡®è‡ªå·±é¢†åŸŸå†…çš„æ¦‚å¿µï¼Œå› ä¸ºä¸Šä¸‹æ–‡æ˜¯é¢†åŸŸçš„è§£ç³»ç»Ÿï¼›</li><li>å¯¹äºé™ç•Œä¸Šä¸‹æ–‡ä¹‹é—´å‘ç”Ÿäº¤äº’ï¼Œå›¢é˜Ÿä¸ä¸Šä¸‹æ–‡çš„ä¸€è‡´æ€§ï¼Œèƒ½å¤Ÿä¿è¯æˆ‘ä»¬æ˜ç¡®å¯¹æ¥çš„å›¢é˜Ÿå’Œä¾èµ–çš„ä¸Šä¸‹æ¸¸ã€‚</li></ol><blockquote><p><strong>é™ç•Œä¸Šä¸‹æ–‡ä¹‹é—´çš„æ˜ å°„å…³ç³»</strong></p><ul><li>åˆä½œå…³ç³»ï¼ˆPartnershipï¼‰ï¼šä¸¤ä¸ªä¸Šä¸‹æ–‡ç´§å¯†åˆä½œçš„å…³ç³»ï¼Œä¸€è£ä¿±è£ï¼Œä¸€æŸä¿±æŸã€‚</li><li>å…±äº«å†…æ ¸ï¼ˆShared Kernelï¼‰ï¼šä¸¤ä¸ªä¸Šä¸‹æ–‡ä¾èµ–éƒ¨åˆ†å…±äº«çš„æ¨¡å‹ã€‚</li><li>å®¢æˆ·æ–¹-ä¾›åº”æ–¹å¼€å‘ï¼ˆCustomer-Supplier Developmentï¼‰ï¼šä¸Šä¸‹æ–‡ä¹‹é—´æœ‰ç»„ç»‡çš„ä¸Šä¸‹æ¸¸ä¾èµ–ã€‚</li><li>éµå¥‰è€…ï¼ˆConformistï¼‰ï¼šä¸‹æ¸¸ä¸Šä¸‹æ–‡åªèƒ½ç›²ç›®ä¾èµ–ä¸Šæ¸¸ä¸Šä¸‹æ–‡ã€‚</li><li>é˜²è…å±‚ï¼ˆAnticorruption Layerï¼‰ï¼šä¸€ä¸ªä¸Šä¸‹æ–‡é€šè¿‡ä¸€äº›é€‚é…å’Œè½¬æ¢ä¸å¦ä¸€ä¸ªä¸Šä¸‹æ–‡äº¤äº’ã€‚</li><li>å¼€æ”¾ä¸»æœºæœåŠ¡ï¼ˆOpen Host Serviceï¼‰ï¼šå®šä¹‰ä¸€ç§åè®®æ¥è®©å…¶ä»–ä¸Šä¸‹æ–‡æ¥å¯¹æœ¬ä¸Šä¸‹æ–‡è¿›è¡Œè®¿é—®ã€‚</li><li>å‘å¸ƒè¯­è¨€ï¼ˆPublished Languageï¼‰ï¼šé€šå¸¸ä¸OHSä¸€èµ·ä½¿ç”¨ï¼Œç”¨äºå®šä¹‰å¼€æ”¾ä¸»æœºçš„åè®®ã€‚</li><li>å¤§æ³¥çƒï¼ˆBig Ball of Mudï¼‰ï¼šæ··æ‚åœ¨ä¸€èµ·çš„ä¸Šä¸‹æ–‡å…³ç³»ï¼Œè¾¹ç•Œä¸æ¸…æ™°ã€‚</li><li>å¦è°‹ä»–è·¯ï¼ˆSeparateWayï¼‰ï¼šä¸¤ä¸ªå®Œå…¨æ²¡æœ‰ä»»ä½•è”ç³»çš„ä¸Šä¸‹æ–‡ã€‚</li></ul></blockquote><p>ä¸Šæ–‡å®šä¹‰äº†ä¸Šä¸‹æ–‡æ˜ å°„é—´çš„å…³ç³»ï¼Œç»è¿‡æˆ‘ä»¬çš„åå¤æ–Ÿé…Œï¼ŒæŠ½å¥–å¹³å°ä¸Šä¸‹æ–‡çš„æ˜ å°„å…³ç³»å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210307204349.svg" alt="ä¸Šä¸‹æ–‡æ˜ å°„å…³ç³»"></p><p>ä¸Šä¸‹æ–‡æ˜ å°„å…³ç³»</p><p>ç”±äºæŠ½å¥–ï¼Œé£æ§ï¼Œæ´»åŠ¨å‡†å…¥ï¼Œåº“å­˜ï¼Œè®¡æ•°äº”ä¸ªä¸Šä¸‹æ–‡éƒ½å¤„åœ¨æŠ½å¥–é¢†åŸŸçš„å†…éƒ¨ï¼Œæ‰€ä»¥å®ƒä»¬ä¹‹é—´ç¬¦åˆâ€œä¸€è£ä¿±è£ï¼Œä¸€æŸä¿±æŸâ€çš„åˆä½œå…³ç³»ï¼ˆPartnerShipï¼Œç®€ç§°PSï¼‰ã€‚</p><p>åŒæ—¶ï¼ŒæŠ½å¥–ä¸Šä¸‹æ–‡åœ¨è¿›è¡Œå‘åˆ¸åŠ¨ä½œæ—¶ï¼Œä¼šä¾èµ–åˆ¸ç ã€å¹³å°åˆ¸ã€å¤–å–åˆ¸ä¸‰ä¸ªä¸Šä¸‹æ–‡ã€‚æŠ½å¥–ä¸Šä¸‹æ–‡é€šè¿‡é˜²è…å±‚ï¼ˆAnticorruption Layerï¼ŒACLï¼‰å¯¹ä¸‰ä¸ªä¸Šä¸‹æ–‡è¿›è¡Œäº†éš”ç¦»ï¼Œè€Œä¸‰ä¸ªåˆ¸ä¸Šä¸‹æ–‡é€šè¿‡å¼€æ”¾ä¸»æœºæœåŠ¡ï¼ˆOpen Host Serviceï¼‰ä½œä¸ºå‘å¸ƒè¯­è¨€ï¼ˆPublished Languageï¼‰å¯¹æŠ½å¥–ä¸Šä¸‹æ–‡æä¾›è®¿é—®æœºåˆ¶ã€‚</p><p><strong>é€šè¿‡ä¸Šä¸‹æ–‡æ˜ å°„å…³ç³»ï¼Œæˆ‘ä»¬æ˜ç¡®çš„é™åˆ¶äº†é™ç•Œä¸Šä¸‹æ–‡çš„è€¦åˆæ€§ï¼Œå³åœ¨æŠ½å¥–å¹³å°ä¸­ï¼Œæ— è®ºæ˜¯ä¸Šä¸‹æ–‡å†…éƒ¨äº¤äº’ï¼ˆåˆä½œå…³ç³»ï¼‰è¿˜æ˜¯ä¸å¤–éƒ¨ä¸Šä¸‹æ–‡äº¤äº’ï¼ˆé˜²è…å±‚ï¼‰ï¼Œè€¦åˆåº¦éƒ½é™å®šåœ¨æ•°æ®è€¦åˆï¼ˆData Couplingï¼‰çš„å±‚çº§ã€‚</strong></p><h3 id="æˆ˜æœ¯å»ºæ¨¡â€”â€”ç»†åŒ–ä¸Šä¸‹æ–‡"><a href="#æˆ˜æœ¯å»ºæ¨¡â€”â€”ç»†åŒ–ä¸Šä¸‹æ–‡" class="headerlink" title="æˆ˜æœ¯å»ºæ¨¡â€”â€”ç»†åŒ–ä¸Šä¸‹æ–‡"></a>æˆ˜æœ¯å»ºæ¨¡â€”â€”ç»†åŒ–ä¸Šä¸‹æ–‡</h3><p>æ¢³ç†æ¸…æ¥šä¸Šä¸‹æ–‡ä¹‹é—´çš„å…³ç³»åï¼Œæˆ‘ä»¬éœ€è¦ä»æˆ˜æœ¯å±‚é¢ä¸Šå‰–æä¸Šä¸‹æ–‡å†…éƒ¨çš„ç»„ç»‡å…³ç³»ã€‚é¦–å…ˆçœ‹ä¸‹DDDä¸­çš„ä¸€äº›å®šä¹‰ã€‚</p><blockquote><p><strong>å®ä½“</strong></p><p>å½“ä¸€ä¸ªå¯¹è±¡ç”±å…¶æ ‡è¯†ï¼ˆè€Œä¸æ˜¯å±æ€§ï¼‰åŒºåˆ†æ—¶ï¼Œè¿™ç§å¯¹è±¡ç§°ä¸ºå®ä½“ï¼ˆEntityï¼‰ã€‚</p><p>ä¾‹ï¼šæœ€ç®€å•çš„ï¼Œå…¬å®‰ç³»ç»Ÿçš„èº«ä»½ä¿¡æ¯å½•å…¥ï¼Œå¯¹äºäººçš„æ¨¡æ‹Ÿï¼Œå³è®¤ä¸ºæ˜¯å®ä½“ï¼Œå› ä¸ºæ¯ä¸ªäººæ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œä¸”å…¶å…·æœ‰å”¯ä¸€æ ‡è¯†ï¼ˆå¦‚å…¬å®‰ç³»ç»Ÿåˆ†å‘çš„èº«ä»½è¯å·ç ï¼‰ã€‚</p></blockquote><p>åœ¨å®è·µä¸Šå»ºè®®å°†å±æ€§çš„éªŒè¯æ”¾åˆ°å®ä½“ä¸­ã€‚</p><blockquote><p><strong>å€¼å¯¹è±¡</strong></p><p>å½“ä¸€ä¸ªå¯¹è±¡ç”¨äºå¯¹äº‹åŠ¡è¿›è¡Œæè¿°è€Œæ²¡æœ‰å”¯ä¸€æ ‡è¯†æ—¶ï¼Œå®ƒè¢«ç§°ä½œå€¼å¯¹è±¡ï¼ˆValue Objectï¼‰ã€‚</p><p>ä¾‹ï¼šæ¯”å¦‚é¢œè‰²ä¿¡æ¯ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“{â€œnameâ€:â€œé»‘è‰²â€ï¼Œâ€cssâ€:â€œ#000000â€}è¿™æ ·çš„å€¼ä¿¡æ¯å°±èƒ½å¤Ÿæ»¡è¶³è¦æ±‚äº†ï¼Œè¿™é¿å…äº†æˆ‘ä»¬å¯¹æ ‡è¯†è¿½è¸ªå¸¦æ¥çš„ç³»ç»Ÿå¤æ‚æ€§ã€‚</p></blockquote><p>å€¼å¯¹è±¡å¾ˆé‡è¦ï¼Œåœ¨ä¹ æƒ¯äº†ä½¿ç”¨æ•°æ®åº“çš„æ•°æ®å»ºæ¨¡åï¼Œå¾ˆå®¹æ˜“å°†æ‰€æœ‰å¯¹è±¡çœ‹ä½œå®ä½“ã€‚ä½¿ç”¨å€¼å¯¹è±¡ï¼Œå¯ä»¥æ›´å¥½åœ°åšç³»ç»Ÿä¼˜åŒ–ã€ç²¾ç®€è®¾è®¡ã€‚</p><p>å®ƒå…·æœ‰ä¸å˜æ€§ã€ç›¸ç­‰æ€§å’Œå¯æ›¿æ¢æ€§ã€‚</p><p>åœ¨å®è·µä¸­ï¼Œéœ€è¦ä¿è¯å€¼å¯¹è±¡åˆ›å»ºåå°±ä¸èƒ½è¢«ä¿®æ”¹ï¼Œå³ä¸å…è®¸å¤–éƒ¨å†ä¿®æ”¹å…¶å±æ€§ã€‚åœ¨ä¸åŒä¸Šä¸‹æ–‡é›†æˆæ—¶ï¼Œä¼šå‡ºç°æ¨¡å‹æ¦‚å¿µçš„å…¬ç”¨ï¼Œå¦‚å•†å“æ¨¡å‹ä¼šå­˜åœ¨äºç”µå•†çš„å„ä¸ªä¸Šä¸‹æ–‡ä¸­ã€‚åœ¨è®¢å•ä¸Šä¸‹æ–‡ä¸­å¦‚æœä½ åªå…³æ³¨ä¸‹å•æ—¶å•†å“ä¿¡æ¯å¿«ç…§ï¼Œé‚£ä¹ˆå°†å•†å“å¯¹è±¡è§†ä¸ºå€¼å¯¹è±¡æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚</p><blockquote><p><strong>èšåˆæ ¹</strong></p><p>Aggregate(èšåˆï¼‰æ˜¯ä¸€ç»„ç›¸å…³å¯¹è±¡çš„é›†åˆï¼Œä½œä¸ºä¸€ä¸ªæ•´ä½“è¢«å¤–ç•Œè®¿é—®ï¼Œèšåˆæ ¹ï¼ˆAggregate Rootï¼‰æ˜¯è¿™ä¸ªèšåˆçš„æ ¹èŠ‚ç‚¹ã€‚</p></blockquote><p>èšåˆæ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼Œæ ¸å¿ƒé¢†åŸŸå¾€å¾€éƒ½éœ€è¦ç”¨èšåˆæ¥è¡¨è¾¾ã€‚å…¶æ¬¡ï¼Œèšåˆåœ¨æŠ€æœ¯ä¸Šæœ‰éå¸¸é«˜çš„ä»·å€¼ï¼Œå¯ä»¥æŒ‡å¯¼è¯¦ç»†è®¾è®¡ã€‚</p><p>èšåˆç”±æ ¹å®ä½“ï¼Œå€¼å¯¹è±¡å’Œå®ä½“ç»„æˆã€‚</p><p>å¦‚ä½•åˆ›å»ºå¥½çš„èšåˆï¼Ÿ</p><ul><li>è¾¹ç•Œå†…çš„å†…å®¹å…·æœ‰ä¸€è‡´æ€§ï¼šåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­åªä¿®æ”¹ä¸€ä¸ªèšåˆå®ä¾‹ã€‚å¦‚æœä½ å‘ç°è¾¹ç•Œå†…å¾ˆéš¾æ¥å—å¼ºä¸€è‡´ï¼Œä¸ç®¡æ˜¯å‡ºäºæ€§èƒ½æˆ–äº§å“éœ€æ±‚çš„è€ƒè™‘ï¼Œåº”è¯¥è€ƒè™‘å‰¥ç¦»å‡ºç‹¬ç«‹çš„èšåˆï¼Œé‡‡ç”¨æœ€ç»ˆä¸€è‡´çš„æ–¹å¼ã€‚</li><li>è®¾è®¡å°èšåˆï¼šå¤§éƒ¨åˆ†çš„èšåˆéƒ½å¯ä»¥åªåŒ…å«æ ¹å®ä½“ï¼Œè€Œæ— éœ€åŒ…å«å…¶ä»–å®ä½“ã€‚å³ä½¿ä¸€å®šè¦åŒ…å«ï¼Œå¯ä»¥è€ƒè™‘å°†å…¶åˆ›å»ºä¸ºå€¼å¯¹è±¡ã€‚</li><li>é€šè¿‡å”¯ä¸€æ ‡è¯†æ¥å¼•ç”¨å…¶ä»–èšåˆæˆ–å®ä½“ï¼šå½“å­˜åœ¨å¯¹è±¡ä¹‹é—´çš„å…³è”æ—¶ï¼Œå»ºè®®å¼•ç”¨å…¶å”¯ä¸€æ ‡è¯†è€Œéå¼•ç”¨å…¶æ•´ä½“å¯¹è±¡ã€‚å¦‚æœæ˜¯å¤–éƒ¨ä¸Šä¸‹æ–‡ä¸­çš„å®ä½“ï¼Œå¼•ç”¨å…¶å”¯ä¸€æ ‡è¯†æˆ–å°†éœ€è¦çš„å±æ€§æ„é€ å€¼å¯¹è±¡ã€‚ å¦‚æœèšåˆåˆ›å»ºå¤æ‚ï¼Œæ¨èä½¿ç”¨å·¥å‚æ–¹æ³•æ¥å±è”½å†…éƒ¨å¤æ‚çš„åˆ›å»ºé€»è¾‘ã€‚</li></ul><p>èšåˆå†…éƒ¨å¤šä¸ªç»„æˆå¯¹è±¡çš„å…³ç³»å¯ä»¥ç”¨æ¥æŒ‡å¯¼æ•°æ®åº“åˆ›å»ºï¼Œä½†ä¸å¯é¿å…å­˜åœ¨ä¸€å®šçš„æŠ—é˜»ã€‚å¦‚èšåˆä¸­å­˜åœ¨List&lt;å€¼å¯¹è±¡&gt;ï¼Œé‚£ä¹ˆåœ¨æ•°æ®åº“ä¸­å»ºç«‹1:Nçš„å…³è”éœ€è¦å°†å€¼å¯¹è±¡å•ç‹¬å»ºè¡¨ï¼Œæ­¤æ—¶æ˜¯æœ‰idçš„ï¼Œå»ºè®®ä¸è¦å°†è¯¥idæš´éœ²åˆ°èµ„æºåº“å¤–éƒ¨ï¼Œå¯¹å¤–éšè”½ã€‚</p><blockquote><p><strong>é¢†åŸŸæœåŠ¡</strong></p><p>ä¸€äº›é‡è¦çš„é¢†åŸŸè¡Œä¸ºæˆ–æ“ä½œï¼Œå¯ä»¥å½’ç±»ä¸ºé¢†åŸŸæœåŠ¡ã€‚å®ƒæ—¢ä¸æ˜¯å®ä½“ï¼Œä¹Ÿä¸æ˜¯å€¼å¯¹è±¡çš„èŒƒç•´ã€‚</p></blockquote><p>å½“æˆ‘ä»¬é‡‡ç”¨äº†å¾®æœåŠ¡æ¶æ„é£æ ¼ï¼Œä¸€åˆ‡é¢†åŸŸé€»è¾‘çš„å¯¹å¤–æš´éœ²å‡éœ€è¦é€šè¿‡é¢†åŸŸæœåŠ¡æ¥è¿›è¡Œã€‚å¦‚åŸæœ¬ç”±èšåˆæ ¹æš´éœ²çš„ä¸šåŠ¡é€»è¾‘ä¹Ÿéœ€è¦ä¾æ‰˜äºé¢†åŸŸæœåŠ¡ã€‚</p><blockquote><p><strong>é¢†åŸŸäº‹ä»¶</strong></p><p>é¢†åŸŸäº‹ä»¶æ˜¯å¯¹é¢†åŸŸå†…å‘ç”Ÿçš„æ´»åŠ¨è¿›è¡Œçš„å»ºæ¨¡ã€‚</p></blockquote><p>æŠ½å¥–å¹³å°çš„æ ¸å¿ƒä¸Šä¸‹æ–‡æ˜¯æŠ½å¥–ä¸Šä¸‹æ–‡ï¼Œæ¥ä¸‹æ¥ä»‹ç»ä¸‹æˆ‘ä»¬å¯¹æŠ½å¥–ä¸Šä¸‹æ–‡çš„å»ºæ¨¡ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210307205016.svg" alt="æŠ½å¥–ä¸Šä¸‹æ–‡"></p><p>åœ¨æŠ½å¥–ä¸Šä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡æŠ½å¥–(DrawLottery)è¿™ä¸ªèšåˆæ ¹æ¥æ§åˆ¶æŠ½å¥–è¡Œä¸ºï¼Œå¯ä»¥çœ‹åˆ°ï¼Œä¸€ä¸ªæŠ½å¥–åŒ…æ‹¬äº†æŠ½å¥–IDï¼ˆLotteryIdï¼‰ä»¥åŠå¤šä¸ªå¥–æ± ï¼ˆAwardPoolï¼‰ï¼Œè€Œä¸€ä¸ªå¥–æ± é’ˆå¯¹ä¸€ä¸ªç‰¹å®šçš„ç”¨æˆ·ç¾¤ä½“ï¼ˆUserGroupï¼‰è®¾ç½®äº†å¤šä¸ªå¥–å“ï¼ˆAwardï¼‰ã€‚</p><p>å¦å¤–ï¼Œåœ¨æŠ½å¥–é¢†åŸŸä¸­ï¼Œæˆ‘ä»¬è¿˜ä¼šä½¿ç”¨æŠ½å¥–ç»“æœï¼ˆSendResultï¼‰ä½œä¸ºè¾“å‡ºä¿¡æ¯ï¼Œä½¿ç”¨ç”¨æˆ·é¢†å¥–è®°å½•ï¼ˆUserLotteryLogï¼‰ä½œä¸ºé¢†å¥–å‡­æ®å’Œå­˜æ ¹ã€‚</p><p><strong>è°¨æ…ä½¿ç”¨å€¼å¯¹è±¡</strong></p><p>åœ¨å®è·µä¸­ï¼Œæˆ‘ä»¬å‘ç°è™½ç„¶ä¸€äº›é¢†åŸŸå¯¹è±¡ç¬¦åˆå€¼å¯¹è±¡çš„æ¦‚å¿µï¼Œä½†æ˜¯éšç€ä¸šåŠ¡çš„å˜åŠ¨ï¼Œå¾ˆå¤šåŸæœ‰çš„å®šä¹‰ä¼šå‘ç”Ÿå˜æ›´ï¼Œå€¼å¯¹è±¡å¯èƒ½éœ€è¦åœ¨ä¸šåŠ¡æ„ä¹‰å…·æœ‰å”¯ä¸€æ ‡è¯†ï¼Œè€Œå¯¹è¿™ç±»å€¼å¯¹è±¡çš„é‡æ„å¾€å¾€éœ€è¦è¾ƒé«˜æˆæœ¬ã€‚å› æ­¤åœ¨ç‰¹å®šçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿè¦æ ¹æ®å®é™…æƒ…å†µæ¥æƒè¡¡é¢†åŸŸå¯¹è±¡çš„é€‰å‹ã€‚</p><h2 id="äº‹ä»¶é©±åŠ¨æ¶æ„"><a href="#äº‹ä»¶é©±åŠ¨æ¶æ„" class="headerlink" title="äº‹ä»¶é©±åŠ¨æ¶æ„"></a>äº‹ä»¶é©±åŠ¨æ¶æ„</h2><p>å¯¹è®¸å¤šåº”ç”¨æ¥è¯´ï¼Œè¿™ä¸ªè§£å†³æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨äº‹ä»¶é©±åŠ¨æ¶æ„ï¼ˆevent-driven architectureï¼‰ã€‚åœ¨è¿™ç§æ¶æ„ä¸­ï¼Œå½“æŸä»¶é‡è¦äº‹æƒ…å‘ç”Ÿæ—¶ï¼Œå¾®æœåŠ¡ä¼šå‘å¸ƒä¸€ä¸ªäº‹ä»¶ï¼Œä¾‹å¦‚æ›´æ–°ä¸€ä¸ªä¸šåŠ¡å®ä½“ã€‚å½“è®¢é˜…è¿™äº›äº‹ä»¶çš„å¾®æœåŠ¡æ¥æ”¶æ­¤äº‹ä»¶æ—¶ï¼Œå°±å¯ä»¥æ›´æ–°è‡ªå·±çš„ä¸šåŠ¡å®ä½“ï¼Œä¹Ÿå¯èƒ½ä¼šå¼•å‘æ›´å¤šçš„äº‹ä»¶å‘å¸ƒã€‚</p><p>å¯ä»¥ä½¿ç”¨äº‹ä»¶æ¥å®ç°è·¨å¤šæœåŠ¡çš„ä¸šåŠ¡äº¤æ˜“ã€‚äº¤æ˜“ä¸€èˆ¬ç”±ä¸€ç³»åˆ—æ­¥éª¤æ„æˆï¼Œæ¯ä¸€æ­¥éª¤éƒ½ç”±ä¸€ä¸ªæ›´æ–°ä¸šåŠ¡å®ä½“çš„å¾®æœåŠ¡å’Œå‘å¸ƒæ¿€æ´»ä¸‹ä¸€æ­¥éª¤çš„äº‹ä»¶æ„æˆã€‚ä¸‹å›¾å±•ç°å¦‚ä½•ä½¿ç”¨äº‹ä»¶é©±åŠ¨æ–¹æ³•ï¼Œåœ¨åˆ›å»ºè®¢å•æ—¶æ£€æŸ¥ä¿¡ç”¨å¯ç”¨åº¦ï¼Œå¾®æœåŠ¡é€šè¿‡æ¶ˆæ¯ä»£ç†ï¼ˆMessage Brokerï¼‰æ¥äº¤æ¢äº‹ä»¶ã€‚</p><ol><li>è®¢å•æœåŠ¡åˆ›å»ºä¸€ä¸ªå¸¦æœ‰ NEW çŠ¶æ€çš„ Order ï¼ˆè®¢å•ï¼‰ï¼Œå‘å¸ƒäº†ä¸€ä¸ª â€œOrder Created Eventï¼ˆåˆ›å»ºè®¢å•ï¼‰â€ çš„äº‹ä»¶ã€‚</li></ol><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210225154505.png" alt="Order-Created-Event"></p><ol><li>å®¢æˆ·æœåŠ¡æ¶ˆè´¹ Order Created Event äº‹ä»¶ï¼Œä¸ºæ­¤è®¢å•é¢„ç•™ä¿¡ç”¨ï¼Œå‘å¸ƒ â€œCredit Reserved Eventï¼ˆä¿¡ç”¨é¢„ç•™ï¼‰â€ äº‹ä»¶ã€‚</li></ol><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210225154659.png" alt="Credit-Reserved-Event"></p><ol><li>è®¢å•æœåŠ¡æ¶ˆè´¹ Credit Reserved Event ï¼Œæ”¹å˜è®¢å•çš„çŠ¶æ€ä¸º OPENã€‚</li></ol><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210225154636.png" alt="Status-is-OPEN"></p><p>æ›´å¤æ‚çš„åœºæ™¯å¯ä»¥å¼•å…¥æ›´å¤šæ­¥éª¤ï¼Œä¾‹å¦‚åœ¨æ£€æŸ¥ç”¨æˆ·ä¿¡ç”¨çš„åŒæ—¶é¢„ç•™åº“å­˜ç­‰ã€‚</p><p>è€ƒè™‘åˆ°ï¼ˆaï¼‰æ¯ä¸ªæœåŠ¡åŸå­æ€§æ›´æ–°æ•°æ®åº“å’Œå‘å¸ƒäº‹ä»¶ï¼Œç„¶åï¼Œï¼ˆbï¼‰æ¶ˆæ¯ä»£ç†ç¡®ä¿äº‹ä»¶ä¼ é€’è‡³å°‘ä¸€æ¬¡ï¼Œç„¶åå¯ä»¥è·¨å¤šä¸ªæœåŠ¡å®Œæˆä¸šåŠ¡äº¤æ˜“ï¼ˆæ­¤äº¤æ˜“ä¸æ˜¯ ACID äº¤æ˜“ï¼‰ã€‚è¿™ç§æ¨¡å¼æä¾›å¼±ç¡®å®šæ€§ï¼Œä¾‹å¦‚æœ€ç»ˆä¸€è‡´æ€§ eventual consistencyã€‚è¿™ç§äº¤æ˜“ç±»å‹è¢«ç§°ä½œ BASE modelã€‚</p><p>äº¦å¯ä»¥ä½¿ç”¨äº‹ä»¶æ¥ç»´æŠ¤ä¸åŒå¾®æœåŠ¡æ‹¥æœ‰æ•°æ®é¢„è¿æ¥ï¼ˆpre-joinï¼‰çš„å®ç°è§†å›¾ã€‚ç»´æŠ¤æ­¤è§†å›¾çš„æœåŠ¡è®¢é˜…ç›¸å…³äº‹ä»¶å¹¶ä¸”æ›´æ–°è§†å›¾ã€‚ä¾‹å¦‚ï¼Œå®¢æˆ·è®¢å•è§†å›¾æ›´æ–°æœåŠ¡ï¼ˆç»´æŠ¤å®¢æˆ·è®¢å•è§†å›¾ï¼‰ä¼šè®¢é˜…ç”±å®¢æˆ·æœåŠ¡å’Œè®¢å•æœåŠ¡å‘å¸ƒçš„äº‹ä»¶ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210225154614.png" alt="pre-join"></p><p>å½“å®¢æˆ·è®¢å•è§†å›¾æ›´æ–°æœåŠ¡æ”¶åˆ°å®¢æˆ·æˆ–è€…è®¢å•äº‹ä»¶ï¼Œå°±ä¼šæ›´æ–° å®¢æˆ·è®¢å•è§†å›¾æ•°æ®é›†ã€‚å¯ä»¥ä½¿ç”¨æ–‡æ¡£æ•°æ®åº“ï¼ˆä¾‹å¦‚ MongoDBï¼‰æ¥å®ç°å®¢æˆ·è®¢å•è§†å›¾ï¼Œä¸ºæ¯ä¸ªç”¨æˆ·å­˜å‚¨ä¸€ä¸ªæ–‡æ¡£ã€‚å®¢æˆ·è®¢å•è§†å›¾æŸ¥è¯¢æœåŠ¡è´Ÿè´£å“åº”å¯¹å®¢æˆ·ä»¥åŠæœ€è¿‘è®¢å•ï¼ˆé€šè¿‡æŸ¥è¯¢å®¢æˆ·è®¢å•è§†å›¾æ•°æ®é›†ï¼‰çš„æŸ¥è¯¢ã€‚</p><p>äº‹ä»¶é©±åŠ¨æ¶æ„ä¹Ÿæ˜¯æ—¢æœ‰ä¼˜ç‚¹ä¹Ÿæœ‰ç¼ºç‚¹ï¼Œæ­¤æ¶æ„å¯ä»¥ä½¿å¾—äº¤æ˜“è·¨å¤šä¸ªæœåŠ¡ä¸”æä¾›æœ€ç»ˆä¸€è‡´æ€§ï¼Œå¹¶ä¸”å¯ä»¥ä½¿åº”ç”¨ç»´æŠ¤æœ€ç»ˆè§†å›¾ï¼›è€Œç¼ºç‚¹åœ¨äºç¼–ç¨‹æ¨¡å¼æ¯” ACID äº¤æ˜“æ¨¡å¼æ›´åŠ å¤æ‚ï¼šä¸ºäº†ä»åº”ç”¨å±‚çº§å¤±æ•ˆä¸­æ¢å¤ï¼Œè¿˜éœ€è¦å®Œæˆè¡¥å¿æ€§äº¤æ˜“ï¼Œä¾‹å¦‚ï¼Œå¦‚æœä¿¡ç”¨æ£€æŸ¥ä¸æˆåŠŸåˆ™å¿…é¡»å–æ¶ˆè®¢å•ï¼›å¦å¤–ï¼Œåº”ç”¨å¿…é¡»åº”å¯¹ä¸ä¸€è‡´çš„æ•°æ®ï¼Œè¿™æ˜¯å› ä¸ºä¸´æ—¶ï¼ˆin-flightï¼‰äº¤æ˜“é€ æˆçš„æ”¹å˜æ˜¯å¯è§çš„ï¼Œå¦å¤–å½“åº”ç”¨è¯»å–æœªæ›´æ–°çš„æœ€ç»ˆè§†å›¾æ—¶ä¹Ÿä¼šé‡è§æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚å¦å¤–ä¸€ä¸ªç¼ºç‚¹åœ¨äºè®¢é˜…è€…å¿…é¡»æ£€æµ‹å’Œå¿½ç•¥å†—ä½™äº‹ä»¶ã€‚</p><h2 id="Event-Sourcing"><a href="#Event-Sourcing" class="headerlink" title="Event Sourcing"></a>Event Sourcing</h2><p>Event sourcing ï¼ˆäº‹ä»¶æº¯æºï¼‰é€šè¿‡ä½¿ç”¨æ ¹æœ¬ä¸åŒçš„äº‹ä»¶ä¸­å¿ƒæ–¹å¼æ¥è·å¾—ä¸éœ€ 2PC çš„åŸå­æ€§ï¼Œä¿è¯ä¸šåŠ¡å®ä½“çš„ä¸€è‡´æ€§ã€‚ è¿™ç§åº”ç”¨ä¿å­˜ä¸šåŠ¡å®ä½“ä¸€ç³»åˆ—çŠ¶æ€æ”¹å˜äº‹ä»¶ï¼Œè€Œä¸æ˜¯å­˜å‚¨å®ä½“ç°åœ¨çš„çŠ¶æ€ã€‚åº”ç”¨å¯ä»¥é€šè¿‡é‡æ”¾äº‹ä»¶æ¥é‡å»ºå®ä½“ç°åœ¨çŠ¶æ€ã€‚åªè¦ä¸šåŠ¡å®ä½“å‘ç”Ÿå˜åŒ–ï¼Œæ–°äº‹ä»¶å°±ä¼šæ·»åŠ åˆ°æ—¶é—´è¡¨ä¸­ã€‚å› ä¸ºä¿å­˜äº‹ä»¶æ˜¯å•ä¸€æ“ä½œï¼Œå› æ­¤è‚¯å®šæ˜¯åŸå­æ€§çš„ã€‚</p><p>ä¸ºäº†ç†è§£äº‹ä»¶æºå·¥ä½œæ–¹å¼ï¼Œè€ƒè™‘äº‹ä»¶å®ä½“ä½œä¸ºä¸€ä¸ªä¾‹å­ã€‚ä¼ ç»Ÿæ–¹å¼ä¸­ï¼Œæ¯ä¸ªè®¢å•æ˜ å°„ä¸º ORDER è¡¨ä¸­ä¸€è¡Œï¼Œä¾‹å¦‚åœ¨ ORDER_LINE_ITEM è¡¨ä¸­ã€‚ä½†æ˜¯å¯¹äºäº‹ä»¶æºæ–¹å¼ï¼Œè®¢å•æœåŠ¡ä»¥äº‹ä»¶çŠ¶æ€æ”¹å˜æ–¹å¼å­˜å‚¨ä¸€ä¸ªè®¢å•ï¼šåˆ›å»ºçš„ï¼Œå·²æ‰¹å‡†çš„ï¼Œå·²å‘è´§çš„ï¼Œå–æ¶ˆçš„ï¼›æ¯ä¸ªäº‹ä»¶åŒ…æ‹¬è¶³å¤Ÿæ•°æ®æ¥é‡å»ºè®¢å•çŠ¶æ€ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210225165545.png" alt="Event-sourcing"></p><p>äº‹ä»¶æ˜¯é•¿æœŸä¿å­˜åœ¨äº‹ä»¶æ•°æ®åº“ä¸­ï¼Œæä¾› API æ·»åŠ å’Œè·å–å®ä½“äº‹ä»¶ã€‚äº‹ä»¶å­˜å‚¨è·Ÿä¹‹å‰æè¿°çš„æ¶ˆæ¯ä»£ç†ç±»ä¼¼ï¼Œæä¾› API æ¥è®¢é˜…äº‹ä»¶ã€‚äº‹ä»¶å­˜å‚¨å°†äº‹ä»¶é€’é€åˆ°æ‰€æœ‰æ„Ÿå…´è¶£çš„è®¢é˜…è€…ï¼Œäº‹ä»¶å­˜å‚¨æ˜¯äº‹ä»¶é©±åŠ¨å¾®æœåŠ¡æ¶æ„çš„åŸºå¹²ã€‚</p><p>äº‹ä»¶æºæ–¹æ³•æœ‰å¾ˆå¤šä¼˜ç‚¹ï¼šè§£å†³äº†äº‹ä»¶é©±åŠ¨æ¶æ„å…³é”®é—®é¢˜ï¼Œä½¿å¾—åªè¦æœ‰çŠ¶æ€å˜åŒ–å°±å¯ä»¥å¯é åœ°å‘å¸ƒäº‹ä»¶ï¼Œä¹Ÿå°±è§£å†³äº†å¾®æœåŠ¡æ¶æ„ä¸­æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚å¦å¤–ï¼Œå› ä¸ºæ˜¯æŒä¹…åŒ–äº‹ä»¶è€Œä¸æ˜¯å¯¹è±¡ï¼Œä¹Ÿå°±é¿å…äº† object relational impedance mismatch problemã€‚</p><p>æ•°æ®æºæ–¹æ³•æä¾›äº† 100%å¯é çš„ä¸šåŠ¡å®ä½“å˜åŒ–ç›‘æ§æ—¥å¿—ï¼Œä½¿å¾—è·å–ä»»ä½•æ—¶ç‚¹å®ä½“çŠ¶æ€æˆä¸ºå¯èƒ½ã€‚å¦å¤–ï¼Œäº‹ä»¶æºæ–¹æ³•å¯ä»¥ä½¿å¾—ä¸šåŠ¡é€»è¾‘å¯ä»¥ç”±äº‹ä»¶äº¤æ¢çš„æ¾è€¦åˆä¸šåŠ¡å®ä½“æ„æˆã€‚è¿™äº›ä¼˜åŠ¿ä½¿å¾—å•ä½“åº”ç”¨ç§»æ¤åˆ°å¾®æœåŠ¡æ¶æ„å˜çš„ç›¸å¯¹å®¹æ˜“ã€‚</p><p>äº‹ä»¶æºæ–¹æ³•ä¹Ÿæœ‰ä¸å°‘ç¼ºç‚¹ï¼Œå› ä¸ºé‡‡ç”¨ä¸åŒæˆ–è€…ä¸å¤ªç†Ÿæ‚‰çš„å˜æˆæ¨¡å¼ï¼Œä½¿å¾—é‡æ–°å­¦ä¹ ä¸å¤ªå®¹æ˜“ï¼›äº‹ä»¶å­˜å‚¨åªæ”¯æŒä¸»é”®æŸ¥è¯¢ä¸šåŠ¡å®ä½“ï¼Œå¿…é¡»ä½¿ç”¨ Command Query Responsibility Segregation (CQRS) æ¥å®ŒæˆæŸ¥è¯¢ä¸šåŠ¡ï¼Œå› æ­¤ï¼Œåº”ç”¨å¿…é¡»å¤„ç†æœ€ç»ˆä¸€è‡´æ•°æ®ã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://tech.meituan.com/2017/12/22/ddd-in-practice.html">ç¾å›¢æŠ€æœ¯åšå®¢-é¢†åŸŸé©±åŠ¨è®¾è®¡åœ¨äº’è”ç½‘ä¸šåŠ¡å¼€å‘ä¸­çš„å®è·µ</a></li><li><a href="https://doocs.github.io/advanced-java/#/./docs/micro-services/event-driven-data-management-for-microservices">å¾®æœåŠ¡å’Œåˆ†å¸ƒå¼æ•°æ®ç®¡ç†é—®é¢˜</a></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> é¢ç» </tag>
            
            <tag> DDD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>08è®²</title>
      <link href="/posts/e0865d0a.html"/>
      <url>/posts/e0865d0a.html</url>
      
        <content type="html"><![CDATA[<hr><h1 id="08-æ ˆï¼šå¦‚ä½•å®ç°æµè§ˆå™¨çš„å‰è¿›å’Œåé€€åŠŸèƒ½ï¼Ÿ"><a href="#08-æ ˆï¼šå¦‚ä½•å®ç°æµè§ˆå™¨çš„å‰è¿›å’Œåé€€åŠŸèƒ½ï¼Ÿ" class="headerlink" title="08 | æ ˆï¼šå¦‚ä½•å®ç°æµè§ˆå™¨çš„å‰è¿›å’Œåé€€åŠŸèƒ½ï¼Ÿ"></a>08 | æ ˆï¼šå¦‚ä½•å®ç°æµè§ˆå™¨çš„å‰è¿›å’Œåé€€åŠŸèƒ½ï¼Ÿ</h1><h2 id="å¦‚ä½•ç†è§£â€œæ ˆâ€ï¼Ÿ"><a href="#å¦‚ä½•ç†è§£â€œæ ˆâ€ï¼Ÿ" class="headerlink" title="å¦‚ä½•ç†è§£â€œæ ˆâ€ï¼Ÿ"></a>å¦‚ä½•ç†è§£â€œæ ˆâ€ï¼Ÿ</h2><p>å…³äºâ€œæ ˆâ€ï¼Œæˆ‘æœ‰ä¸€ä¸ªéå¸¸è´´åˆ‡çš„ä¾‹å­ï¼Œå°±æ˜¯ä¸€æ‘å åœ¨ä¸€èµ·çš„ç›˜å­ã€‚æˆ‘ä»¬å¹³æ—¶æ”¾ç›˜å­çš„æ—¶å€™ï¼Œéƒ½æ˜¯ä»ä¸‹å¾€ä¸Šä¸€ä¸ªä¸€ä¸ªæ”¾ï¼›å–çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯ä»ä¸Šå¾€ä¸‹ä¸€ä¸ªä¸€ä¸ªåœ°ä¾æ¬¡å–ï¼Œä¸èƒ½ä»ä¸­é—´ä»»æ„æŠ½å‡ºã€‚<strong>åè¿›è€…å…ˆå‡ºï¼Œå…ˆè¿›è€…åå‡ºï¼Œè¿™å°±æ˜¯å…¸å‹çš„â€œæ ˆâ€ç»“æ„</strong>ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210508072455.jpeg" alt="img"></p><p>ä»æ ˆçš„æ“ä½œç‰¹æ€§ä¸Šæ¥çœ‹ï¼Œ<strong>æ ˆæ˜¯ä¸€ç§â€œæ“ä½œå—é™â€çš„çº¿æ€§è¡¨</strong>ï¼Œåªå…è®¸åœ¨ä¸€ç«¯æ’å…¥å’Œåˆ é™¤æ•°æ®ã€‚</p><p>äº‹å®ä¸Šï¼Œä»åŠŸèƒ½ä¸Šæ¥è¯´ï¼Œæ•°ç»„æˆ–é“¾è¡¨ç¡®å®å¯ä»¥æ›¿ä»£æ ˆï¼Œä½†ä½ è¦çŸ¥é“ï¼Œç‰¹å®šçš„æ•°æ®ç»“æ„æ˜¯å¯¹ç‰¹å®šåœºæ™¯çš„æŠ½è±¡ï¼Œè€Œä¸”ï¼Œæ•°ç»„æˆ–é“¾è¡¨æš´éœ²äº†å¤ªå¤šçš„æ“ä½œæ¥å£ï¼Œæ“ä½œä¸Šçš„ç¡®çµæ´»è‡ªç”±ï¼Œä½†ä½¿ç”¨æ—¶å°±æ¯”è¾ƒä¸å¯æ§ï¼Œè‡ªç„¶ä¹Ÿå°±æ›´å®¹æ˜“å‡ºé”™ã€‚</p><p>æˆ‘ç¬¬ä¸€æ¬¡æ¥è§¦è¿™ç§æ•°æ®ç»“æ„çš„æ—¶å€™ï¼Œå°±å¯¹å®ƒå­˜åœ¨çš„æ„ä¹‰äº§ç”Ÿäº†å¾ˆå¤§çš„ç–‘æƒ‘ã€‚å› ä¸ºæˆ‘è§‰å¾—ï¼Œç›¸æ¯”æ•°ç»„å’Œé“¾è¡¨ï¼Œæ ˆå¸¦ç»™æˆ‘çš„åªæœ‰é™åˆ¶ï¼Œå¹¶æ²¡æœ‰ä»»ä½•ä¼˜åŠ¿ã€‚é‚£æˆ‘ç›´æ¥ä½¿ç”¨æ•°ç»„æˆ–è€…é“¾è¡¨ä¸å°±å¥½äº†å—ï¼Ÿä¸ºä»€ä¹ˆè¿˜è¦ç”¨è¿™ä¸ªâ€œæ“ä½œå—é™â€çš„â€œæ ˆâ€å‘¢ï¼Ÿ</p><p>äº‹å®ä¸Šï¼Œä»åŠŸèƒ½ä¸Šæ¥è¯´ï¼Œæ•°ç»„æˆ–é“¾è¡¨ç¡®å®å¯ä»¥æ›¿ä»£æ ˆï¼Œä½†ä½ è¦çŸ¥é“ï¼Œç‰¹å®šçš„æ•°æ®ç»“æ„æ˜¯å¯¹ç‰¹å®šåœºæ™¯çš„æŠ½è±¡ï¼Œè€Œä¸”ï¼Œæ•°ç»„æˆ–é“¾è¡¨æš´éœ²äº†å¤ªå¤šçš„æ“ä½œæ¥å£ï¼Œæ“ä½œä¸Šçš„ç¡®çµæ´»è‡ªç”±ï¼Œä½†ä½¿ç”¨æ—¶å°±æ¯”è¾ƒä¸å¯æ§ï¼Œè‡ªç„¶ä¹Ÿå°±æ›´å®¹æ˜“å‡ºé”™ã€‚</p><p><strong>å½“æŸä¸ªæ•°æ®é›†åˆåªæ¶‰åŠåœ¨ä¸€ç«¯æ’å…¥å’Œåˆ é™¤æ•°æ®ï¼Œå¹¶ä¸”æ»¡è¶³åè¿›å…ˆå‡ºã€å…ˆè¿›åå‡ºçš„ç‰¹æ€§ï¼Œè¿™æ—¶æˆ‘ä»¬å°±åº”è¯¥é¦–é€‰â€œæ ˆâ€è¿™ç§æ•°æ®ç»“æ„</strong>ã€‚</p><h2 id="å¦‚ä½•å®ç°ä¸€ä¸ªâ€œæ ˆâ€ï¼Ÿ"><a href="#å¦‚ä½•å®ç°ä¸€ä¸ªâ€œæ ˆâ€ï¼Ÿ" class="headerlink" title="å¦‚ä½•å®ç°ä¸€ä¸ªâ€œæ ˆâ€ï¼Ÿ"></a>å¦‚ä½•å®ç°ä¸€ä¸ªâ€œæ ˆâ€ï¼Ÿ</h2><p>å®é™…ä¸Šï¼Œæ ˆæ—¢å¯ä»¥ç”¨æ•°ç»„æ¥å®ç°ï¼Œä¹Ÿå¯ä»¥ç”¨é“¾è¡¨æ¥å®ç°ã€‚ç”¨æ•°ç»„å®ç°çš„æ ˆï¼Œæˆ‘ä»¬å«ä½œ<strong>é¡ºåºæ ˆ</strong>ï¼Œç”¨é“¾è¡¨å®ç°çš„æ ˆï¼Œæˆ‘ä»¬å«ä½œ<strong>é“¾å¼æ ˆ</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŸºäºæ•°ç»„å®ç°çš„é¡ºåºæ ˆ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayStack</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> String[] items;  <span class="comment">// æ•°ç»„</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> count;       <span class="comment">// æ ˆä¸­å…ƒç´ ä¸ªæ•°</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> n;           <span class="comment">//æ ˆçš„å¤§å°</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆå§‹åŒ–æ•°ç»„ï¼Œç”³è¯·ä¸€ä¸ªå¤§å°ä¸ºnçš„æ•°ç»„ç©ºé—´</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">ArrayStack</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.items = <span class="keyword">new</span> <span class="title class_">String</span>[n];</span><br><span class="line">    <span class="built_in">this</span>.n = n;</span><br><span class="line">    <span class="built_in">this</span>.count = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å…¥æ ˆæ“ä½œ</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">push</span><span class="params">(String item)</span> &#123;</span><br><span class="line">    <span class="comment">// æ•°ç»„ç©ºé—´ä¸å¤Ÿäº†ï¼Œç›´æ¥è¿”å›falseï¼Œå…¥æ ˆå¤±è´¥ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (count == n) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// å°†itemæ”¾åˆ°ä¸‹æ ‡ä¸ºcountçš„ä½ç½®ï¼Œå¹¶ä¸”countåŠ ä¸€</span></span><br><span class="line">    items[count] = item;</span><br><span class="line">    ++count;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å‡ºæ ˆæ“ä½œ</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// æ ˆä¸ºç©ºï¼Œåˆ™ç›´æ¥è¿”å›null</span></span><br><span class="line">    <span class="keyword">if</span> (count == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// è¿”å›ä¸‹æ ‡ä¸ºcount-1çš„æ•°ç»„å…ƒç´ ï¼Œå¹¶ä¸”æ ˆä¸­å…ƒç´ ä¸ªæ•°countå‡ä¸€</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">tmp</span> <span class="operator">=</span> items[count-<span class="number">1</span>];</span><br><span class="line">    --count;</span><br><span class="line">    <span class="keyword">return</span> tmp;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äº†è§£äº†å®šä¹‰å’ŒåŸºæœ¬æ“ä½œï¼Œé‚£å®ƒçš„æ“ä½œçš„æ—¶é—´ã€ç©ºé—´å¤æ‚åº¦æ˜¯å¤šå°‘å‘¢ï¼Ÿ</p><p>ä¸ç®¡æ˜¯é¡ºåºæ ˆè¿˜æ˜¯é“¾å¼æ ˆï¼Œæˆ‘ä»¬å­˜å‚¨æ•°æ®åªéœ€è¦ä¸€ä¸ªå¤§å°ä¸º n çš„æ•°ç»„å°±å¤Ÿäº†ã€‚åœ¨å…¥æ ˆå’Œå‡ºæ ˆè¿‡ç¨‹ä¸­ï¼Œåªéœ€è¦ä¸€ä¸¤ä¸ªä¸´æ—¶å˜é‡å­˜å‚¨ç©ºé—´ï¼Œæ‰€ä»¥ç©ºé—´å¤æ‚åº¦æ˜¯ O(1)ã€‚</p><p>æ³¨æ„ï¼Œè¿™é‡Œå­˜å‚¨æ•°æ®éœ€è¦ä¸€ä¸ªå¤§å°ä¸º n çš„æ•°ç»„ï¼Œå¹¶ä¸æ˜¯è¯´ç©ºé—´å¤æ‚åº¦å°±æ˜¯ O(n)ã€‚å› ä¸ºï¼Œè¿™ n ä¸ªç©ºé—´æ˜¯å¿…é¡»çš„ï¼Œæ— æ³•çœæ‰ã€‚æ‰€ä»¥æˆ‘ä»¬è¯´ç©ºé—´å¤æ‚åº¦çš„æ—¶å€™ï¼Œæ˜¯æŒ‡é™¤äº†åŸæœ¬çš„æ•°æ®å­˜å‚¨ç©ºé—´å¤–ï¼Œç®—æ³•è¿è¡Œè¿˜éœ€è¦é¢å¤–çš„å­˜å‚¨ç©ºé—´ã€‚</p><p>ç©ºé—´å¤æ‚åº¦åˆ†ææ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿæ—¶é—´å¤æ‚åº¦ä¹Ÿä¸éš¾ã€‚ä¸ç®¡æ˜¯é¡ºåºæ ˆè¿˜æ˜¯é“¾å¼æ ˆï¼Œå…¥æ ˆã€å‡ºæ ˆåªæ¶‰åŠæ ˆé¡¶ä¸ªåˆ«æ•°æ®çš„æ“ä½œï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(1)ã€‚</p><h2 id="æ”¯æŒåŠ¨æ€æ‰©å®¹çš„é¡ºåºæ ˆ"><a href="#æ”¯æŒåŠ¨æ€æ‰©å®¹çš„é¡ºåºæ ˆ" class="headerlink" title="æ”¯æŒåŠ¨æ€æ‰©å®¹çš„é¡ºåºæ ˆ"></a>æ”¯æŒåŠ¨æ€æ‰©å®¹çš„é¡ºåºæ ˆ</h2><p>åˆšæ‰é‚£ä¸ªåŸºäºæ•°ç»„å®ç°çš„æ ˆï¼Œæ˜¯ä¸€ä¸ªå›ºå®šå¤§å°çš„æ ˆï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨åˆå§‹åŒ–æ ˆæ—¶éœ€è¦äº‹å…ˆæŒ‡å®šæ ˆçš„å¤§å°ã€‚å½“æ ˆæ»¡ä¹‹åï¼Œå°±æ— æ³•å†å¾€æ ˆé‡Œæ·»åŠ æ•°æ®äº†ã€‚å°½ç®¡é“¾å¼æ ˆçš„å¤§å°ä¸å—é™ï¼Œä½†è¦å­˜å‚¨ next æŒ‡é’ˆï¼Œå†…å­˜æ¶ˆè€—ç›¸å¯¹è¾ƒå¤šã€‚é‚£æˆ‘ä»¬å¦‚ä½•åŸºäºæ•°ç»„å®ç°ä¸€ä¸ªå¯ä»¥æ”¯æŒåŠ¨æ€æ‰©å®¹çš„æ ˆå‘¢ï¼Ÿ</p><p>ä½ è¿˜è®°å¾—ï¼Œæˆ‘ä»¬åœ¨æ•°ç»„é‚£ä¸€èŠ‚ï¼Œæ˜¯å¦‚ä½•æ¥å®ç°ä¸€ä¸ªæ”¯æŒåŠ¨æ€æ‰©å®¹çš„æ•°ç»„çš„å—ï¼Ÿå½“æ•°ç»„ç©ºé—´ä¸å¤Ÿæ—¶ï¼Œæˆ‘ä»¬å°±é‡æ–°ç”³è¯·ä¸€å—æ›´å¤§çš„å†…å­˜ï¼Œå°†åŸæ¥æ•°ç»„ä¸­æ•°æ®ç»Ÿç»Ÿæ‹·è´è¿‡å»ã€‚è¿™æ ·å°±å®ç°äº†ä¸€ä¸ªæ”¯æŒåŠ¨æ€æ‰©å®¹çš„æ•°ç»„ã€‚</p><p>æ‰€ä»¥ï¼Œå¦‚æœè¦å®ç°ä¸€ä¸ªæ”¯æŒåŠ¨æ€æ‰©å®¹çš„æ ˆï¼Œæˆ‘ä»¬åªéœ€è¦åº•å±‚ä¾èµ–ä¸€ä¸ªæ”¯æŒåŠ¨æ€æ‰©å®¹çš„æ•°ç»„å°±å¯ä»¥äº†ã€‚å½“æ ˆæ»¡äº†ä¹‹åï¼Œæˆ‘ä»¬å°±ç”³è¯·ä¸€ä¸ªæ›´å¤§çš„æ•°ç»„ï¼Œå°†åŸæ¥çš„æ•°æ®æ¬ç§»åˆ°æ–°æ•°ç»„ä¸­ã€‚æˆ‘ç”»äº†ä¸€å¼ å›¾ï¼Œä½ å¯ä»¥å¯¹ç…§ç€ç†è§£ä¸€ä¸‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210508072907.jpeg" alt="img"></p><h2 id="æ ˆåœ¨å‡½æ•°è°ƒç”¨ä¸­çš„åº”ç”¨"><a href="#æ ˆåœ¨å‡½æ•°è°ƒç”¨ä¸­çš„åº”ç”¨" class="headerlink" title="æ ˆåœ¨å‡½æ•°è°ƒç”¨ä¸­çš„åº”ç”¨"></a>æ ˆåœ¨å‡½æ•°è°ƒç”¨ä¸­çš„åº”ç”¨</h2><p>å‰é¢æˆ‘è®²çš„éƒ½æ¯”è¾ƒåç†è®ºï¼Œæˆ‘ä»¬ç°åœ¨æ¥çœ‹ä¸‹ï¼Œæ ˆåœ¨è½¯ä»¶å·¥ç¨‹ä¸­çš„å®é™…åº”ç”¨ã€‚æ ˆä½œä¸ºä¸€ä¸ªæ¯”è¾ƒåŸºç¡€çš„æ•°æ®ç»“æ„ï¼Œåº”ç”¨åœºæ™¯è¿˜æ˜¯è›®å¤šçš„ã€‚å…¶ä¸­ï¼Œæ¯”è¾ƒç»å…¸çš„ä¸€ä¸ªåº”ç”¨åœºæ™¯å°±æ˜¯<strong>å‡½æ•°è°ƒç”¨æ ˆ</strong>ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œæ“ä½œç³»ç»Ÿç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…äº†ä¸€å—ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œè¿™å—å†…å­˜è¢«ç»„ç»‡æˆâ€œæ ˆâ€è¿™ç§ç»“æ„, ç”¨æ¥å­˜å‚¨å‡½æ•°è°ƒç”¨æ—¶çš„ä¸´æ—¶å˜é‡ã€‚æ¯è¿›å…¥ä¸€ä¸ªå‡½æ•°ï¼Œå°±ä¼šå°†ä¸´æ—¶å˜é‡ä½œä¸ºä¸€ä¸ªæ ˆå¸§å…¥æ ˆï¼Œå½“è¢«è°ƒç”¨å‡½æ•°æ‰§è¡Œå®Œæˆï¼Œè¿”å›ä¹‹åï¼Œå°†è¿™ä¸ªå‡½æ•°å¯¹åº”çš„æ ˆå¸§å‡ºæ ˆã€‚ä¸ºäº†è®©ä½ æ›´å¥½åœ°ç†è§£ï¼Œæˆ‘ä»¬ä¸€å—æ¥çœ‹ä¸‹è¿™æ®µä»£ç çš„æ‰§è¡Œè¿‡ç¨‹ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="type">int</span> a = <span class="number">1</span>; </span><br><span class="line">   <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">   <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">   ret = <span class="built_in">add</span>(<span class="number">3</span>, <span class="number">5</span>);</span><br><span class="line">   res = a + ret;</span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, res);</span><br><span class="line">   reuturn <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">   <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">   sum = x + y;</span><br><span class="line">   <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œmain() å‡½æ•°è°ƒç”¨äº† add() å‡½æ•°ï¼Œè·å–è®¡ç®—ç»“æœï¼Œå¹¶ä¸”ä¸ä¸´æ—¶å˜é‡ a ç›¸åŠ ï¼Œæœ€åæ‰“å° res çš„å€¼ã€‚ä¸ºäº†è®©ä½ æ¸…æ™°åœ°çœ‹åˆ°è¿™ä¸ªè¿‡ç¨‹å¯¹åº”çš„å‡½æ•°æ ˆé‡Œå‡ºæ ˆã€å…¥æ ˆçš„æ“ä½œï¼Œæˆ‘ç”»äº†ä¸€å¼ å›¾ã€‚å›¾ä¸­æ˜¾ç¤ºçš„æ˜¯ï¼Œåœ¨æ‰§è¡Œåˆ° add() å‡½æ•°æ—¶ï¼Œå‡½æ•°è°ƒç”¨æ ˆçš„æƒ…å†µã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210508073240.jpeg" alt="img"></p><h2 id="æ ˆåœ¨è¡¨è¾¾å¼æ±‚å€¼ä¸­çš„åº”ç”¨"><a href="#æ ˆåœ¨è¡¨è¾¾å¼æ±‚å€¼ä¸­çš„åº”ç”¨" class="headerlink" title="æ ˆåœ¨è¡¨è¾¾å¼æ±‚å€¼ä¸­çš„åº”ç”¨"></a>æ ˆåœ¨è¡¨è¾¾å¼æ±‚å€¼ä¸­çš„åº”ç”¨</h2><p>æˆ‘ä»¬å†æ¥çœ‹æ ˆçš„å¦ä¸€ä¸ªå¸¸è§çš„åº”ç”¨åœºæ™¯ï¼Œç¼–è¯‘å™¨å¦‚ä½•åˆ©ç”¨æ ˆæ¥å®ç°<strong>è¡¨è¾¾å¼æ±‚å€¼</strong>ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿è§£é‡Šï¼Œæˆ‘å°†ç®—æœ¯è¡¨è¾¾å¼ç®€åŒ–ä¸ºåªåŒ…å«åŠ å‡ä¹˜é™¤å››åˆ™è¿ç®—ï¼Œæ¯”å¦‚ï¼š34+13*9+44-12&#x2F;3ã€‚å¯¹äºè¿™ä¸ªå››åˆ™è¿ç®—ï¼Œæˆ‘ä»¬äººè„‘å¯ä»¥å¾ˆå¿«æ±‚è§£å‡ºç­”æ¡ˆï¼Œä½†æ˜¯å¯¹äºè®¡ç®—æœºæ¥è¯´ï¼Œç†è§£è¿™ä¸ªè¡¨è¾¾å¼æœ¬èº«å°±æ˜¯ä¸ªæŒºéš¾çš„äº‹å„¿ã€‚å¦‚æœæ¢ä½œä½ ï¼Œè®©ä½ æ¥å®ç°è¿™æ ·ä¸€ä¸ªè¡¨è¾¾å¼æ±‚å€¼çš„åŠŸèƒ½ï¼Œä½ ä¼šæ€ä¹ˆåšå‘¢ï¼Ÿ</p><p>å®é™…ä¸Šï¼Œç¼–è¯‘å™¨å°±æ˜¯é€šè¿‡ä¸¤ä¸ªæ ˆæ¥å®ç°çš„ã€‚å…¶ä¸­ä¸€ä¸ªä¿å­˜æ“ä½œæ•°çš„æ ˆï¼Œå¦ä¸€ä¸ªæ˜¯ä¿å­˜è¿ç®—ç¬¦çš„æ ˆã€‚æˆ‘ä»¬ä»å·¦å‘å³éå†è¡¨è¾¾å¼ï¼Œå½“é‡åˆ°æ•°å­—ï¼Œæˆ‘ä»¬å°±ç›´æ¥å‹å…¥æ“ä½œæ•°æ ˆï¼›å½“é‡åˆ°è¿ç®—ç¬¦ï¼Œå°±ä¸è¿ç®—ç¬¦æ ˆçš„æ ˆé¡¶å…ƒç´ è¿›è¡Œæ¯”è¾ƒã€‚</p><p>å¦‚æœæ¯”è¿ç®—ç¬¦æ ˆé¡¶å…ƒç´ çš„ä¼˜å…ˆçº§é«˜ï¼Œå°±å°†å½“å‰è¿ç®—ç¬¦å‹å…¥æ ˆï¼›å¦‚æœæ¯”è¿ç®—ç¬¦æ ˆé¡¶å…ƒç´ çš„ä¼˜å…ˆçº§ä½æˆ–è€…ç›¸åŒï¼Œä»è¿ç®—ç¬¦æ ˆä¸­å–æ ˆé¡¶è¿ç®—ç¬¦ï¼Œä»æ“ä½œæ•°æ ˆçš„æ ˆé¡¶å– 2 ä¸ªæ“ä½œæ•°ï¼Œç„¶åè¿›è¡Œè®¡ç®—ï¼Œå†æŠŠè®¡ç®—å®Œçš„ç»“æœå‹å…¥æ“ä½œæ•°æ ˆï¼Œç»§ç»­æ¯”è¾ƒã€‚</p><p>æˆ‘å°† 3+5*8-6 è¿™ä¸ªè¡¨è¾¾å¼çš„è®¡ç®—è¿‡ç¨‹ç”»æˆäº†ä¸€å¼ å›¾ï¼Œä½ å¯ä»¥ç»“åˆå›¾æ¥ç†è§£æˆ‘åˆšè®²çš„è®¡ç®—è¿‡ç¨‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210508073429.jpeg" alt="img"></p><h2 id="æ ˆåœ¨æ‹¬å·åŒ¹é…ä¸­çš„åº”ç”¨"><a href="#æ ˆåœ¨æ‹¬å·åŒ¹é…ä¸­çš„åº”ç”¨" class="headerlink" title="æ ˆåœ¨æ‹¬å·åŒ¹é…ä¸­çš„åº”ç”¨"></a>æ ˆåœ¨æ‹¬å·åŒ¹é…ä¸­çš„åº”ç”¨</h2><p>é™¤äº†ç”¨æ ˆæ¥å®ç°è¡¨è¾¾å¼æ±‚å€¼ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å€ŸåŠ©æ ˆæ¥æ£€æŸ¥è¡¨è¾¾å¼ä¸­çš„æ‹¬å·æ˜¯å¦åŒ¹é…ã€‚</p><p>æˆ‘ä»¬åŒæ ·ç®€åŒ–ä¸€ä¸‹èƒŒæ™¯ã€‚æˆ‘ä»¬å‡è®¾è¡¨è¾¾å¼ä¸­åªåŒ…å«ä¸‰ç§æ‹¬å·ï¼Œåœ†æ‹¬å· ()ã€æ–¹æ‹¬å·[]å’ŒèŠ±æ‹¬å·{}ï¼Œå¹¶ä¸”å®ƒä»¬å¯ä»¥ä»»æ„åµŒå¥—ã€‚æ¯”å¦‚ï¼Œ{[] ()[{}]}æˆ–[{()}([])]ç­‰éƒ½ä¸ºåˆæ³•æ ¼å¼ï¼Œè€Œ{[}()]æˆ–[({)]ä¸ºä¸åˆæ³•çš„æ ¼å¼ã€‚é‚£æˆ‘ç°åœ¨ç»™ä½ ä¸€ä¸ªåŒ…å«ä¸‰ç§æ‹¬å·çš„è¡¨è¾¾å¼å­—ç¬¦ä¸²ï¼Œå¦‚ä½•æ£€æŸ¥å®ƒæ˜¯å¦åˆæ³•å‘¢ï¼Ÿ</p><p>è¿™é‡Œä¹Ÿå¯ä»¥ç”¨æ ˆæ¥è§£å†³ã€‚æˆ‘ä»¬ç”¨æ ˆæ¥ä¿å­˜æœªåŒ¹é…çš„å·¦æ‹¬å·ï¼Œä»å·¦åˆ°å³ä¾æ¬¡æ‰«æå­—ç¬¦ä¸²ã€‚å½“æ‰«æåˆ°å·¦æ‹¬å·æ—¶ï¼Œåˆ™å°†å…¶å‹å…¥æ ˆä¸­ï¼›å½“æ‰«æåˆ°å³æ‹¬å·æ—¶ï¼Œä»æ ˆé¡¶å–å‡ºä¸€ä¸ªå·¦æ‹¬å·ã€‚å¦‚æœèƒ½å¤ŸåŒ¹é…ï¼Œæ¯”å¦‚â€œ(â€è·Ÿâ€œ)â€åŒ¹é…ï¼Œâ€œ[â€è·Ÿâ€œ]â€åŒ¹é…ï¼Œâ€œ{â€è·Ÿâ€œ}â€åŒ¹é…ï¼Œåˆ™ç»§ç»­æ‰«æå‰©ä¸‹çš„å­—ç¬¦ä¸²ã€‚å¦‚æœæ‰«æçš„è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°ä¸èƒ½é…å¯¹çš„å³æ‹¬å·ï¼Œæˆ–è€…æ ˆä¸­æ²¡æœ‰æ•°æ®ï¼Œåˆ™è¯´æ˜ä¸ºéæ³•æ ¼å¼ã€‚</p><p>å½“æ‰€æœ‰çš„æ‹¬å·éƒ½æ‰«æå®Œæˆä¹‹åï¼Œå¦‚æœæ ˆä¸ºç©ºï¼Œåˆ™è¯´æ˜å­—ç¬¦ä¸²ä¸ºåˆæ³•æ ¼å¼ï¼›å¦åˆ™ï¼Œè¯´æ˜æœ‰æœªåŒ¹é…çš„å·¦æ‹¬å·ï¼Œä¸ºéæ³•æ ¼å¼ã€‚</p><h2 id="è§£ç­”å¼€ç¯‡"><a href="#è§£ç­”å¼€ç¯‡" class="headerlink" title="è§£ç­”å¼€ç¯‡"></a>è§£ç­”å¼€ç¯‡</h2><p>å¥½äº†ï¼Œæˆ‘æƒ³ç°åœ¨ä½ å·²ç»å®Œå…¨ç†è§£äº†æ ˆçš„æ¦‚å¿µã€‚æˆ‘ä»¬å†å›æ¥çœ‹çœ‹å¼€ç¯‡çš„æ€è€ƒé¢˜ï¼Œå¦‚ä½•å®ç°æµè§ˆå™¨çš„å‰è¿›ã€åé€€åŠŸèƒ½ï¼Ÿå…¶å®ï¼Œç”¨ä¸¤ä¸ªæ ˆå°±å¯ä»¥éå¸¸å®Œç¾åœ°è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨ä¸¤ä¸ªæ ˆï¼ŒX å’Œ Yï¼Œæˆ‘ä»¬æŠŠé¦–æ¬¡æµè§ˆçš„é¡µé¢ä¾æ¬¡å‹å…¥æ ˆ Xï¼Œå½“ç‚¹å‡»åé€€æŒ‰é’®æ—¶ï¼Œå†ä¾æ¬¡ä»æ ˆ X ä¸­å‡ºæ ˆï¼Œå¹¶å°†å‡ºæ ˆçš„æ•°æ®ä¾æ¬¡æ”¾å…¥æ ˆ Yã€‚å½“æˆ‘ä»¬ç‚¹å‡»å‰è¿›æŒ‰é’®æ—¶ï¼Œæˆ‘ä»¬ä¾æ¬¡ä»æ ˆ Y ä¸­å–å‡ºæ•°æ®ï¼Œæ”¾å…¥æ ˆ X ä¸­ã€‚å½“æ ˆ X ä¸­æ²¡æœ‰æ•°æ®æ—¶ï¼Œé‚£å°±è¯´æ˜æ²¡æœ‰é¡µé¢å¯ä»¥ç»§ç»­åé€€æµè§ˆäº†ã€‚å½“æ ˆ Y ä¸­æ²¡æœ‰æ•°æ®ï¼Œé‚£å°±è¯´æ˜æ²¡æœ‰é¡µé¢å¯ä»¥ç‚¹å‡»å‰è¿›æŒ‰é’®æµè§ˆäº†ã€‚</p><p>æ¯”å¦‚ä½ é¡ºåºæŸ¥çœ‹äº† aï¼Œbï¼Œc ä¸‰ä¸ªé¡µé¢ï¼Œæˆ‘ä»¬å°±ä¾æ¬¡æŠŠ aï¼Œbï¼Œc å‹å…¥æ ˆï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä¸¤ä¸ªæ ˆçš„æ•°æ®å°±æ˜¯è¿™ä¸ªæ ·å­ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210508073855.jpeg" alt="img"></p><p>å½“ä½ é€šè¿‡æµè§ˆå™¨çš„åé€€æŒ‰é’®ï¼Œä»é¡µé¢ c åé€€åˆ°é¡µé¢ a ä¹‹åï¼Œæˆ‘ä»¬å°±ä¾æ¬¡æŠŠ c å’Œ b ä»æ ˆ X ä¸­å¼¹å‡ºï¼Œå¹¶ä¸”ä¾æ¬¡æ”¾å…¥åˆ°æ ˆ Yã€‚è¿™ä¸ªæ—¶å€™ï¼Œä¸¤ä¸ªæ ˆçš„æ•°æ®å°±æ˜¯è¿™ä¸ªæ ·å­ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210508073904.jpeg" alt="img"></p><p>è¿™ä¸ªæ—¶å€™ä½ åˆæƒ³çœ‹é¡µé¢ bï¼Œäºæ˜¯ä½ åˆç‚¹å‡»å‰è¿›æŒ‰é’®å›åˆ° b é¡µé¢ï¼Œæˆ‘ä»¬å°±æŠŠ b å†ä»æ ˆ Y ä¸­å‡ºæ ˆï¼Œæ”¾å…¥æ ˆ X ä¸­ã€‚æ­¤æ—¶ä¸¤ä¸ªæ ˆçš„æ•°æ®æ˜¯è¿™ä¸ªæ ·å­ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210508073951.jpeg" alt="img"></p><p>è¿™ä¸ªæ—¶å€™ï¼Œä½ é€šè¿‡é¡µé¢ b åˆè·³è½¬åˆ°æ–°çš„é¡µé¢ d äº†ï¼Œé¡µé¢ c å°±æ— æ³•å†é€šè¿‡å‰è¿›ã€åé€€æŒ‰é’®é‡å¤æŸ¥çœ‹äº†ï¼Œæ‰€ä»¥éœ€è¦æ¸…ç©ºæ ˆ Yã€‚æ­¤æ—¶ä¸¤ä¸ªæ ˆçš„æ•°æ®è¿™ä¸ªæ ·å­ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210508073921.jpeg" alt="img"></p><h2 id="å†…å®¹å°ç»“"><a href="#å†…å®¹å°ç»“" class="headerlink" title="å†…å®¹å°ç»“"></a>å†…å®¹å°ç»“</h2><p>æˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹ä»Šå¤©è®²çš„å†…å®¹ã€‚æ ˆæ˜¯ä¸€ç§æ“ä½œå—é™çš„æ•°æ®ç»“æ„ï¼Œåªæ”¯æŒå…¥æ ˆå’Œå‡ºæ ˆæ“ä½œã€‚åè¿›å…ˆå‡ºæ˜¯å®ƒæœ€å¤§çš„ç‰¹ç‚¹ã€‚æ ˆæ—¢å¯ä»¥é€šè¿‡æ•°ç»„å®ç°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é“¾è¡¨æ¥å®ç°ã€‚ä¸ç®¡åŸºäºæ•°ç»„è¿˜æ˜¯é“¾è¡¨ï¼Œå…¥æ ˆã€å‡ºæ ˆçš„æ—¶é—´å¤æ‚åº¦éƒ½ä¸º O(1)ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜è®²äº†ä¸€ç§æ”¯æŒåŠ¨æ€æ‰©å®¹çš„é¡ºåºæ ˆï¼Œä½ éœ€è¦é‡ç‚¹æŒæ¡å®ƒçš„å‡æ‘Šæ—¶é—´å¤æ‚åº¦åˆ†ææ–¹æ³•ã€‚</p><h2 id="è¯¾åæ€è€ƒ"><a href="#è¯¾åæ€è€ƒ" class="headerlink" title="è¯¾åæ€è€ƒ"></a>è¯¾åæ€è€ƒ</h2><ol><li><p>æˆ‘ä»¬åœ¨è®²æ ˆçš„åº”ç”¨æ—¶ï¼Œè®²åˆ°ç”¨å‡½æ•°è°ƒç”¨æ ˆæ¥ä¿å­˜ä¸´æ—¶å˜é‡ï¼Œä¸ºä»€ä¹ˆå‡½æ•°è°ƒç”¨è¦ç”¨â€œæ ˆâ€æ¥ä¿å­˜ä¸´æ—¶å˜é‡å‘¢ï¼Ÿç”¨å…¶ä»–æ•°æ®ç»“æ„ä¸è¡Œå—ï¼Ÿ</p><blockquote><p>å…¶å®ï¼Œæˆ‘ä»¬ä¸ä¸€å®šéè¦ç”¨æ ˆæ¥ä¿å­˜ä¸´æ—¶å˜é‡ï¼Œåªä¸è¿‡å¦‚æœè¿™ä¸ªå‡½æ•°è°ƒç”¨ç¬¦åˆåè¿›å…ˆå‡ºçš„ç‰¹æ€§ï¼Œç”¨æ ˆè¿™ç§æ•°æ®ç»“æ„æ¥å®ç°ï¼Œæ˜¯æœ€é¡ºç†æˆç« çš„é€‰æ‹©ã€‚</p><p>ä»è°ƒç”¨å‡½æ•°è¿›å…¥è¢«è°ƒç”¨å‡½æ•°ï¼Œå¯¹äºæ•°æ®æ¥è¯´ï¼Œå˜åŒ–çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ˜¯ä½œç”¨åŸŸã€‚æ‰€ä»¥æ ¹æœ¬ä¸Šï¼Œåªè¦èƒ½ä¿è¯æ¯è¿›å…¥ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œéƒ½æ˜¯ä¸€ä¸ªæ–°çš„ä½œç”¨åŸŸå°±å¯ä»¥ã€‚è€Œè¦å®ç°è¿™ä¸ªï¼Œç”¨æ ˆå°±éå¸¸æ–¹ä¾¿ã€‚åœ¨è¿›å…¥è¢«è°ƒç”¨å‡½æ•°çš„æ—¶å€™ï¼Œåˆ†é…ä¸€æ®µæ ˆç©ºé—´ç»™è¿™ä¸ªå‡½æ•°çš„å˜é‡ï¼Œåœ¨å‡½æ•°ç»“æŸçš„æ—¶å€™ï¼Œå°†æ ˆé¡¶å¤ä½ï¼Œæ­£å¥½å›åˆ°è°ƒç”¨å‡½æ•°çš„ä½œç”¨åŸŸå†…ã€‚</p></blockquote></li><li><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒJVM å†…å­˜ç®¡ç†ä¸­æœ‰ä¸ªâ€œå †æ ˆâ€çš„æ¦‚å¿µã€‚æ ˆå†…å­˜ç”¨æ¥å­˜å‚¨å±€éƒ¨å˜é‡å’Œæ–¹æ³•è°ƒç”¨ï¼Œå †å†…å­˜ç”¨æ¥å­˜å‚¨ Java ä¸­çš„å¯¹è±¡ã€‚é‚£ JVM é‡Œé¢çš„â€œæ ˆâ€è·Ÿæˆ‘ä»¬è¿™é‡Œè¯´çš„â€œæ ˆâ€æ˜¯ä¸æ˜¯ä¸€å›äº‹å‘¢ï¼Ÿå¦‚æœä¸æ˜¯ï¼Œé‚£å®ƒä¸ºä»€ä¹ˆåˆå«ä½œâ€œæ ˆâ€å‘¢ï¼Ÿ</p><blockquote><p>è™½ç„¶å†…å­˜ä¸­çš„æ ˆå’Œæ•°æ®ç»“æ„çš„æ ˆä¸æ˜¯ä¸€å›äº‹ï¼Œå³å†…å­˜ä¸­çš„æ ˆæ˜¯ä¸€æ®µè™šæ‹Ÿçš„å†…å­˜ç©ºé—´ï¼Œæ•°æ®ç»“æ„ä¸­çš„æ ˆæ˜¯ä¸€ç§æŠ½è±¡çš„æ•°æ®ç±»å‹ï¼Œä½†æ˜¯å®ƒä»¬éƒ½æœ‰â€œæ ˆâ€çš„ç‰¹æ€§â€”â€”åè¿›å…ˆå‡ºï¼Œæ‰€ä»¥éƒ½å«â€œæ ˆâ€ä¹Ÿæ— å¯åšéã€‚</p></blockquote></li></ol><h2 id="å¤šå†™å¤šç»ƒ"><a href="#å¤šå†™å¤šç»ƒ" class="headerlink" title="å¤šå†™å¤šç»ƒ"></a>å¤šå†™å¤šç»ƒ</h2><ul><li><h4 id="20-æœ‰æ•ˆçš„æ‹¬å·"><a href="#20-æœ‰æ•ˆçš„æ‹¬å·" class="headerlink" title="20. æœ‰æ•ˆçš„æ‹¬å·"></a><a href="https://leetcode-cn.com/problems/valid-parentheses/">20. æœ‰æ•ˆçš„æ‹¬å·</a></h4></li><li><h4 id="155-æœ€å°æ ˆ"><a href="#155-æœ€å°æ ˆ" class="headerlink" title="155. æœ€å°æ ˆ"></a><a href="https://leetcode-cn.com/problems/min-stack/">155. æœ€å°æ ˆ</a></h4></li><li><h4 id="232-ç”¨æ ˆå®ç°é˜Ÿåˆ—"><a href="#232-ç”¨æ ˆå®ç°é˜Ÿåˆ—" class="headerlink" title="232. ç”¨æ ˆå®ç°é˜Ÿåˆ—"></a><a href="https://leetcode-cn.com/problems/implement-queue-using-stacks/">232. ç”¨æ ˆå®ç°é˜Ÿåˆ—</a></h4></li><li><h4 id="844-æ¯”è¾ƒå«é€€æ ¼çš„å­—ç¬¦ä¸²"><a href="#844-æ¯”è¾ƒå«é€€æ ¼çš„å­—ç¬¦ä¸²" class="headerlink" title="844. æ¯”è¾ƒå«é€€æ ¼çš„å­—ç¬¦ä¸²"></a><a href="https://leetcode-cn.com/problems/backspace-string-compare/">844. æ¯”è¾ƒå«é€€æ ¼çš„å­—ç¬¦ä¸²</a></h4></li><li><h4 id="224-åŸºæœ¬è®¡ç®—å™¨"><a href="#224-åŸºæœ¬è®¡ç®—å™¨" class="headerlink" title="224. åŸºæœ¬è®¡ç®—å™¨"></a><a href="https://leetcode-cn.com/problems/basic-calculator/">224. åŸºæœ¬è®¡ç®—å™¨</a></h4></li><li><h4 id="682-æ£’çƒæ¯”èµ›"><a href="#682-æ£’çƒæ¯”èµ›" class="headerlink" title="682. æ£’çƒæ¯”èµ›"></a><a href="https://leetcode-cn.com/problems/baseball-game/">682. æ£’çƒæ¯”èµ›</a></h4></li><li><h4 id="496-ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ -I"><a href="#496-ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ -I" class="headerlink" title="496. ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´  I"></a><a href="https://leetcode-cn.com/problems/next-greater-element-i/">496. ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´  I</a></h4></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬å…­å‘¨</title>
      <link href="/posts/5a474594.html"/>
      <url>/posts/5a474594.html</url>
      
        <content type="html"><![CDATA[<hr><p>æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾æ¯å‘¨æ‰“å¡ 2021.04.12-2021.04.18</p><h3 id="42-æ¥é›¨æ°´"><a href="#42-æ¥é›¨æ°´" class="headerlink" title="42. æ¥é›¨æ°´"></a><a href="https://leetcode-cn.com/problems/trapping-rain-water/">42. æ¥é›¨æ°´</a></h3><p>ç»™å®š <em>n</em> ä¸ªéè´Ÿæ•´æ•°è¡¨ç¤ºæ¯ä¸ªå®½åº¦ä¸º 1 çš„æŸ±å­çš„é«˜åº¦å›¾ï¼Œè®¡ç®—æŒ‰æ­¤æ’åˆ—çš„æŸ±å­ï¼Œä¸‹é›¨ä¹‹åèƒ½æ¥å¤šå°‘é›¨æ°´ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210418221157.png" alt="img"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šheight = [0,1,0,2,1,0,1,3,2,1,2,1]</span><br><span class="line">è¾“å‡ºï¼š6</span><br><span class="line">è§£é‡Šï¼šä¸Šé¢æ˜¯ç”±æ•°ç»„ [0,1,0,2,1,0,1,3,2,1,2,1] è¡¨ç¤ºçš„é«˜åº¦å›¾ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥æ¥ 6 ä¸ªå•ä½çš„é›¨æ°´ï¼ˆè“è‰²éƒ¨åˆ†è¡¨ç¤ºé›¨æ°´ï¼‰ã€‚ </span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šheight = [4,2,0,3,2,5]</span><br><span class="line">è¾“å‡ºï¼š9</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>n == height.length</code></li><li><code>0 &lt;= n &lt;= 3 * 104^</code></li><li><code>0 &lt;= height[i] &lt;= 105</code></li></ul><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h3 id="é¢è¯•é¢˜-03-06-åŠ¨ç‰©æ”¶å®¹æ‰€"><a href="#é¢è¯•é¢˜-03-06-åŠ¨ç‰©æ”¶å®¹æ‰€" class="headerlink" title="é¢è¯•é¢˜ 03.06. åŠ¨ç‰©æ”¶å®¹æ‰€"></a><a href="https://leetcode-cn.com/problems/animal-shelter-lcci/">é¢è¯•é¢˜ 03.06. åŠ¨ç‰©æ”¶å®¹æ‰€</a></h3><p>åŠ¨ç‰©æ”¶å®¹æ‰€ã€‚æœ‰å®¶åŠ¨ç‰©æ”¶å®¹æ‰€åªæ”¶å®¹ç‹—ä¸çŒ«ï¼Œä¸”ä¸¥æ ¼éµå®ˆâ€œå…ˆè¿›å…ˆå‡ºâ€çš„åŸåˆ™ã€‚åœ¨æ”¶å…»è¯¥æ”¶å®¹æ‰€çš„åŠ¨ç‰©æ—¶ï¼Œæ”¶å…»äººåªèƒ½æ”¶å…»æ‰€æœ‰åŠ¨ç‰©ä¸­â€œæœ€è€â€ï¼ˆç”±å…¶è¿›å…¥æ”¶å®¹æ‰€çš„æ—¶é—´é•¿çŸ­è€Œå®šï¼‰çš„åŠ¨ç‰©ï¼Œæˆ–è€…å¯ä»¥æŒ‘é€‰çŒ«æˆ–ç‹—ï¼ˆåŒæ—¶å¿…é¡»æ”¶å…»æ­¤ç±»åŠ¨ç‰©ä¸­â€œæœ€è€â€çš„ï¼‰ã€‚æ¢è¨€ä¹‹ï¼Œæ”¶å…»äººä¸èƒ½è‡ªç”±æŒ‘é€‰æƒ³æ”¶å…»çš„å¯¹è±¡ã€‚è¯·åˆ›å»ºé€‚ç”¨äºè¿™ä¸ªç³»ç»Ÿçš„æ•°æ®ç»“æ„ï¼Œå®ç°å„ç§æ“ä½œæ–¹æ³•ï¼Œæ¯”å¦‚<code>enqueue</code>ã€<code>dequeueAny</code>ã€<code>dequeueDog</code>å’Œ<code>dequeueCat</code>ã€‚å…è®¸ä½¿ç”¨Javaå†…ç½®çš„LinkedListæ•°æ®ç»“æ„ã€‚</p><p><code>enqueue</code>æ–¹æ³•æœ‰ä¸€ä¸ª<code>animal</code>å‚æ•°ï¼Œ<code>animal[0]</code>ä»£è¡¨åŠ¨ç‰©ç¼–å·ï¼Œ<code>animal[1]</code>ä»£è¡¨åŠ¨ç‰©ç§ç±»ï¼Œå…¶ä¸­ 0 ä»£è¡¨çŒ«ï¼Œ1 ä»£è¡¨ç‹—ã€‚</p><p><code>dequeue*</code>æ–¹æ³•è¿”å›ä¸€ä¸ªåˆ—è¡¨<code>[åŠ¨ç‰©ç¼–å·, åŠ¨ç‰©ç§ç±»]</code>ï¼Œè‹¥æ²¡æœ‰å¯ä»¥æ”¶å…»çš„åŠ¨ç‰©ï¼Œåˆ™è¿”å›<code>[-1,-1]</code>ã€‚</p><p><strong>ç¤ºä¾‹1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> è¾“å…¥ï¼š</span><br><span class="line">[&quot;AnimalShelf&quot;, &quot;enqueue&quot;, &quot;enqueue&quot;, &quot;dequeueCat&quot;, &quot;dequeueDog&quot;, &quot;dequeueAny&quot;]</span><br><span class="line">[[], [[0, 0]], [[1, 0]], [], [], []]</span><br><span class="line"> è¾“å‡ºï¼š</span><br><span class="line">[null,null,null,[0,0],[-1,-1],[1,0]]</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> è¾“å…¥ï¼š</span><br><span class="line">[&quot;AnimalShelf&quot;, &quot;enqueue&quot;, &quot;enqueue&quot;, &quot;enqueue&quot;, &quot;dequeueDog&quot;, &quot;dequeueCat&quot;, &quot;dequeueAny&quot;]</span><br><span class="line">[[], [[0, 0]], [[1, 0]], [[2, 1]], [], [], []]</span><br><span class="line"> è¾“å‡ºï¼š</span><br><span class="line">[null,null,null,null,[2,1],[0,0],[1,0]]</span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜:</strong></p><ol><li>æ”¶çº³æ‰€çš„æœ€å¤§å®¹é‡ä¸º20000</li></ol><h4 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ </tag>
            
            <tag> æ¯å‘¨æ‰“å¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬äº”å‘¨</title>
      <link href="/posts/3f490e4d.html"/>
      <url>/posts/3f490e4d.html</url>
      
        <content type="html"><![CDATA[<hr><p>æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾æ¯å‘¨æ‰“å¡ 2021.04.06-2021.04.11</p><h3 id="é¢è¯•é¢˜-08-06-æ±‰è¯ºå¡”é—®é¢˜"><a href="#é¢è¯•é¢˜-08-06-æ±‰è¯ºå¡”é—®é¢˜" class="headerlink" title="é¢è¯•é¢˜ 08.06. æ±‰è¯ºå¡”é—®é¢˜"></a><a href="https://leetcode-cn.com/problems/hanota-lcci/">é¢è¯•é¢˜ 08.06. æ±‰è¯ºå¡”é—®é¢˜</a></h3><p>åœ¨ç»å…¸æ±‰è¯ºå¡”é—®é¢˜ä¸­ï¼Œæœ‰ 3 æ ¹æŸ±å­åŠ N ä¸ªä¸åŒå¤§å°çš„ç©¿å­”åœ†ç›˜ï¼Œç›˜å­å¯ä»¥æ»‘å…¥ä»»æ„ä¸€æ ¹æŸ±å­ã€‚ä¸€å¼€å§‹ï¼Œæ‰€æœ‰ç›˜å­è‡ªä¸Šè€Œä¸‹æŒ‰å‡åºä¾æ¬¡å¥—åœ¨ç¬¬ä¸€æ ¹æŸ±å­ä¸Š(å³æ¯ä¸€ä¸ªç›˜å­åªèƒ½æ”¾åœ¨æ›´å¤§çš„ç›˜å­ä¸Šé¢)ã€‚ç§»åŠ¨åœ†ç›˜æ—¶å—åˆ°ä»¥ä¸‹é™åˆ¶:<br>(1) æ¯æ¬¡åªèƒ½ç§»åŠ¨ä¸€ä¸ªç›˜å­;<br>(2) ç›˜å­åªèƒ½ä»æŸ±å­é¡¶ç«¯æ»‘å‡ºç§»åˆ°ä¸‹ä¸€æ ¹æŸ±å­;<br>(3) ç›˜å­åªèƒ½å åœ¨æ¯”å®ƒå¤§çš„ç›˜å­ä¸Šã€‚</p><p>è¯·ç¼–å†™ç¨‹åºï¼Œç”¨æ ˆå°†æ‰€æœ‰ç›˜å­ä»ç¬¬ä¸€æ ¹æŸ±å­ç§»åˆ°æœ€åä¸€æ ¹æŸ±å­ã€‚</p><p>ä½ éœ€è¦åŸåœ°ä¿®æ”¹æ ˆã€‚</p><p><strong>ç¤ºä¾‹1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šA = [2, 1, 0], B = [], C = []</span><br><span class="line">è¾“å‡ºï¼šC = [2, 1, 0]</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šA = [1, 0], B = [], C = []</span><br><span class="line">è¾“å‡ºï¼šC = [1, 0]</span><br></pre></td></tr></table></figure><p><strong>æç¤º:</strong></p><ol><li>Aä¸­ç›˜å­çš„æ•°ç›®ä¸å¤§äº14ä¸ªã€‚</li></ol><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h4 id="148-æ’åºé“¾è¡¨"><a href="#148-æ’åºé“¾è¡¨" class="headerlink" title="148. æ’åºé“¾è¡¨"></a><a href="https://leetcode-cn.com/problems/sort-list/">148. æ’åºé“¾è¡¨</a></h4><p>éš¾åº¦ä¸­ç­‰1077</p><p>ç»™ä½ é“¾è¡¨çš„å¤´ç»“ç‚¹ <code>head</code> ï¼Œè¯·å°†å…¶æŒ‰ <strong>å‡åº</strong> æ’åˆ—å¹¶è¿”å› <strong>æ’åºåçš„é“¾è¡¨</strong> ã€‚</p><p><strong>è¿›é˜¶ï¼š</strong></p><ul><li>ä½ å¯ä»¥åœ¨ <code>O(n log n)</code> æ—¶é—´å¤æ‚åº¦å’Œå¸¸æ•°çº§ç©ºé—´å¤æ‚åº¦ä¸‹ï¼Œå¯¹é“¾è¡¨è¿›è¡Œæ’åºå—ï¼Ÿ</li></ul><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210406141723.jpeg" alt="img"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead = [4,2,1,3]</span><br><span class="line">è¾“å‡ºï¼š[1,2,3,4]</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210406141731.jpeg" alt="img"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead = [-1,5,3,4,0]</span><br><span class="line">è¾“å‡ºï¼š[-1,0,3,4,5]</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead = []</span><br><span class="line">è¾“å‡ºï¼š[]</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li>é“¾è¡¨ä¸­èŠ‚ç‚¹çš„æ•°ç›®åœ¨èŒƒå›´ <code>[0, 5 * 104]</code> å†…</li><li><code>-105 &lt;= Node.val &lt;= 105</code></li></ul><h4 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ </tag>
            
            <tag> æ¯å‘¨æ‰“å¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬å››å‘¨</title>
      <link href="/posts/50d7cb0a.html"/>
      <url>/posts/50d7cb0a.html</url>
      
        <content type="html"><![CDATA[<hr><p>æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾æ¯å‘¨æ‰“å¡ 2021.03.29-2021.04.04</p><h3 id="å‰‘æŒ‡-Offer-59-II-é˜Ÿåˆ—çš„æœ€å¤§å€¼"><a href="#å‰‘æŒ‡-Offer-59-II-é˜Ÿåˆ—çš„æœ€å¤§å€¼" class="headerlink" title="å‰‘æŒ‡ Offer 59 - II. é˜Ÿåˆ—çš„æœ€å¤§å€¼"></a><a href="https://leetcode-cn.com/problems/dui-lie-de-zui-da-zhi-lcof/">å‰‘æŒ‡ Offer 59 - II. é˜Ÿåˆ—çš„æœ€å¤§å€¼</a></h3><p>è¯·å®šä¹‰ä¸€ä¸ªé˜Ÿåˆ—å¹¶å®ç°å‡½æ•° <code>max_value</code> å¾—åˆ°é˜Ÿåˆ—é‡Œçš„æœ€å¤§å€¼ï¼Œè¦æ±‚å‡½æ•°<code>max_value</code>ã€<code>push_back</code> å’Œ <code>pop_front</code> çš„<strong>å‡æ‘Š</strong>æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1)ã€‚</p><p>è‹¥é˜Ÿåˆ—ä¸ºç©ºï¼Œ<code>pop_front</code> å’Œ <code>max_value</code> éœ€è¦è¿”å› -1</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: </span><br><span class="line">[&quot;MaxQueue&quot;,&quot;push_back&quot;,&quot;push_back&quot;,&quot;max_value&quot;,&quot;pop_front&quot;,&quot;max_value&quot;]</span><br><span class="line">[[],[1],[2],[],[],[]]</span><br><span class="line">è¾“å‡º: [null,null,null,2,1,2]</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: </span><br><span class="line">[&quot;MaxQueue&quot;,&quot;pop_front&quot;,&quot;max_value&quot;]</span><br><span class="line">[[],[],[]]</span><br><span class="line">è¾“å‡º: [null,-1,-1]</span><br></pre></td></tr></table></figure><p><strong>é™åˆ¶ï¼š</strong></p><ul><li><code>1 &lt;= push_back,pop_front,max_valueçš„æ€»æ“ä½œæ•° &lt;= 10000</code></li><li><code>1 &lt;= value &lt;= 10^5</code></li></ul><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h3 id="é¢è¯•é¢˜59-I-æ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼"><a href="#é¢è¯•é¢˜59-I-æ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼" class="headerlink" title="é¢è¯•é¢˜59 - I. æ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼"></a><a href="https://leetcode-cn.com/problems/hua-dong-chuang-kou-de-zui-da-zhi-lcof/">é¢è¯•é¢˜59 - I. æ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼</a></h3><p>ç»™å®šä¸€ä¸ªæ•°ç»„ <code>nums</code> å’Œæ»‘åŠ¨çª—å£çš„å¤§å° <code>k</code>ï¼Œè¯·æ‰¾å‡ºæ‰€æœ‰æ»‘åŠ¨çª—å£é‡Œçš„æœ€å¤§å€¼ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: nums = [1,3,-1,-3,5,3,6,7], å’Œ k = 3</span><br><span class="line">è¾“å‡º: [3,3,5,5,6,7] </span><br><span class="line">è§£é‡Š: </span><br><span class="line"></span><br><span class="line">  æ»‘åŠ¨çª—å£çš„ä½ç½®                æœ€å¤§å€¼</span><br><span class="line">---------------               -----</span><br><span class="line">[1  3  -1] -3  5  3  6  7       3</span><br><span class="line"> 1 [3  -1  -3] 5  3  6  7       3</span><br><span class="line"> 1  3 [-1  -3  5] 3  6  7       5</span><br><span class="line"> 1  3  -1 [-3  5  3] 6  7       5</span><br><span class="line"> 1  3  -1  -3 [5  3  6] 7       6</span><br><span class="line"> 1  3  -1  -3  5 [3  6  7]      7</span><br></pre></td></tr></table></figure><p> <strong>æç¤ºï¼š</strong></p><p>ä½ å¯ä»¥å‡è®¾ <em>k</em> æ€»æ˜¯æœ‰æ•ˆçš„ï¼Œåœ¨è¾“å…¥æ•°ç»„ä¸ä¸ºç©ºçš„æƒ…å†µä¸‹ï¼Œ1 â‰¤ k â‰¤ è¾“å…¥æ•°ç»„çš„å¤§å°ã€‚</p><p>æ³¨æ„ï¼šæœ¬é¢˜ä¸ä¸»ç«™ 239 é¢˜ç›¸åŒï¼š<a href="https://leetcode-cn.com/problems/sliding-window-maximum/">https://leetcode-cn.com/problems/sliding-window-maximum/</a></p><h4 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ </tag>
            
            <tag> æ¯å‘¨æ‰“å¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>07è®²</title>
      <link href="/posts/b8e54d5c.html"/>
      <url>/posts/b8e54d5c.html</url>
      
        <content type="html"><![CDATA[<hr><h1 id="07-é“¾è¡¨ï¼ˆä¸‹ï¼‰ï¼šå¦‚ä½•è½»æ¾å†™å‡ºæ­£ç¡®çš„é“¾è¡¨ä»£ç ï¼Ÿ"><a href="#07-é“¾è¡¨ï¼ˆä¸‹ï¼‰ï¼šå¦‚ä½•è½»æ¾å†™å‡ºæ­£ç¡®çš„é“¾è¡¨ä»£ç ï¼Ÿ" class="headerlink" title="07 | é“¾è¡¨ï¼ˆä¸‹ï¼‰ï¼šå¦‚ä½•è½»æ¾å†™å‡ºæ­£ç¡®çš„é“¾è¡¨ä»£ç ï¼Ÿ"></a>07 | é“¾è¡¨ï¼ˆä¸‹ï¼‰ï¼šå¦‚ä½•è½»æ¾å†™å‡ºæ­£ç¡®çš„é“¾è¡¨ä»£ç ï¼Ÿ</h1><h2 id="å‡ ä¸ªå†™é“¾è¡¨ä»£ç çš„æŠ€å·§"><a href="#å‡ ä¸ªå†™é“¾è¡¨ä»£ç çš„æŠ€å·§" class="headerlink" title="å‡ ä¸ªå†™é“¾è¡¨ä»£ç çš„æŠ€å·§"></a>å‡ ä¸ªå†™é“¾è¡¨ä»£ç çš„æŠ€å·§</h2><h3 id="æŠ€å·§ä¸€ï¼šç†è§£æŒ‡é’ˆæˆ–å¼•ç”¨çš„å«ä¹‰"><a href="#æŠ€å·§ä¸€ï¼šç†è§£æŒ‡é’ˆæˆ–å¼•ç”¨çš„å«ä¹‰" class="headerlink" title="æŠ€å·§ä¸€ï¼šç†è§£æŒ‡é’ˆæˆ–å¼•ç”¨çš„å«ä¹‰"></a>æŠ€å·§ä¸€ï¼šç†è§£æŒ‡é’ˆæˆ–å¼•ç”¨çš„å«ä¹‰</h3><p>å®é™…ä¸Šï¼Œå¯¹äºæŒ‡é’ˆæˆ–å¼•ç”¨çš„ç†è§£ï¼Œä½ åªéœ€è¦è®°ä½ä¸‹é¢è¿™å¥è¯å°±å¯ä»¥äº†ï¼š</p><p><strong>å°†æŸä¸ªå˜é‡èµ‹å€¼ç»™æŒ‡é’ˆï¼Œå®é™…ä¸Šå°±æ˜¯å°†è¿™ä¸ªå˜é‡çš„åœ°å€èµ‹å€¼ç»™æŒ‡é’ˆï¼Œæˆ–è€…åè¿‡æ¥è¯´ï¼ŒæŒ‡é’ˆä¸­å­˜å‚¨äº†è¿™ä¸ªå˜é‡çš„å†…å­˜åœ°å€ï¼ŒæŒ‡å‘äº†è¿™ä¸ªå˜é‡ï¼Œé€šè¿‡æŒ‡é’ˆå°±èƒ½æ‰¾åˆ°è¿™ä¸ªå˜é‡ã€‚</strong></p><p>åœ¨ç¼–å†™é“¾è¡¨ä»£ç çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šæœ‰è¿™æ ·çš„ä»£ç ï¼šp-&gt;next&#x3D;qã€‚è¿™è¡Œä»£ç æ˜¯è¯´ï¼Œp ç»“ç‚¹ä¸­çš„ next æŒ‡é’ˆå­˜å‚¨äº† q ç»“ç‚¹çš„å†…å­˜åœ°å€ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªæ›´å¤æ‚çš„ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å†™é“¾è¡¨ä»£ç ç»å¸¸ä¼šç”¨åˆ°çš„ï¼šp-&gt;next&#x3D;p-&gt;next-&gt;nextã€‚è¿™è¡Œä»£ç è¡¨ç¤ºï¼Œp ç»“ç‚¹çš„ next æŒ‡é’ˆå­˜å‚¨äº† p ç»“ç‚¹çš„ä¸‹ä¸‹ä¸€ä¸ªç»“ç‚¹çš„å†…å­˜åœ°å€ã€‚</p><p>æŒæ¡äº†æŒ‡é’ˆæˆ–å¼•ç”¨çš„æ¦‚å¿µï¼Œä½ åº”è¯¥å¯ä»¥å¾ˆè½»æ¾åœ°çœ‹æ‡‚é“¾è¡¨ä»£ç ã€‚æ­å–œä½ ï¼Œå·²ç»ç¦»å†™å‡ºé“¾è¡¨ä»£ç è¿‘äº†ä¸€æ­¥ï¼</p><h3 id="æŠ€å·§äºŒï¼šè­¦æƒ•æŒ‡é’ˆä¸¢å¤±å’Œå†…å­˜æ³„æ¼"><a href="#æŠ€å·§äºŒï¼šè­¦æƒ•æŒ‡é’ˆä¸¢å¤±å’Œå†…å­˜æ³„æ¼" class="headerlink" title="æŠ€å·§äºŒï¼šè­¦æƒ•æŒ‡é’ˆä¸¢å¤±å’Œå†…å­˜æ³„æ¼"></a>æŠ€å·§äºŒï¼šè­¦æƒ•æŒ‡é’ˆä¸¢å¤±å’Œå†…å­˜æ³„æ¼</h3><p>ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰è¿™æ ·çš„æ„Ÿè§‰ï¼Œå†™é“¾è¡¨ä»£ç çš„æ—¶å€™ï¼ŒæŒ‡é’ˆæŒ‡æ¥æŒ‡å»ï¼Œä¸€ä¼šå„¿å°±ä¸çŸ¥é“æŒ‡åˆ°å“ªé‡Œäº†ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨å†™çš„æ—¶å€™ï¼Œä¸€å®šæ³¨æ„ä¸è¦å¼„ä¸¢äº†æŒ‡é’ˆã€‚</p><p>æŒ‡é’ˆå¾€å¾€éƒ½æ˜¯æ€ä¹ˆå¼„ä¸¢çš„å‘¢ï¼Ÿæˆ‘æ‹¿å•é“¾è¡¨çš„æ’å…¥æ“ä½œä¸ºä¾‹æ¥ç»™ä½ åˆ†æä¸€ä¸‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210329002827.jpeg" alt="img"></p><p>å¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨ç»“ç‚¹ a å’Œç›¸é‚»çš„ç»“ç‚¹ b ä¹‹é—´æ’å…¥ç»“ç‚¹ xï¼Œå‡è®¾å½“å‰æŒ‡é’ˆ p æŒ‡å‘ç»“ç‚¹ aã€‚å¦‚æœæˆ‘ä»¬å°†ä»£ç å®ç°å˜æˆä¸‹é¢è¿™ä¸ªæ ·å­ï¼Œå°±ä¼šå‘ç”ŸæŒ‡é’ˆä¸¢å¤±å’Œå†…å­˜æ³„éœ²ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p-&gt;next = x;  <span class="comment">// å°†pçš„nextæŒ‡é’ˆæŒ‡å‘xç»“ç‚¹ï¼›</span></span><br><span class="line">x-&gt;next = p-&gt;next;  <span class="comment">// å°†xçš„ç»“ç‚¹çš„nextæŒ‡é’ˆæŒ‡å‘bç»“ç‚¹ï¼›</span></span><br></pre></td></tr></table></figure><p>åˆå­¦è€…ç»å¸¸ä¼šåœ¨è¿™å„¿çŠ¯é”™ã€‚p-&gt;next æŒ‡é’ˆåœ¨å®Œæˆç¬¬ä¸€æ­¥æ“ä½œä¹‹åï¼Œå·²ç»ä¸å†æŒ‡å‘ç»“ç‚¹ b äº†ï¼Œè€Œæ˜¯æŒ‡å‘ç»“ç‚¹ xã€‚ç¬¬ 2 è¡Œä»£ç ç›¸å½“äºå°† x èµ‹å€¼ç»™ x-&gt;nextï¼Œè‡ªå·±æŒ‡å‘è‡ªå·±ã€‚å› æ­¤ï¼Œæ•´ä¸ªé“¾è¡¨ä¹Ÿå°±æ–­æˆäº†ä¸¤åŠï¼Œä»ç»“ç‚¹ b å¾€åçš„æ‰€æœ‰ç»“ç‚¹éƒ½æ— æ³•è®¿é—®åˆ°äº†ã€‚</p><p>å¯¹äºæœ‰äº›è¯­è¨€æ¥è¯´ï¼Œæ¯”å¦‚ C è¯­è¨€ï¼Œå†…å­˜ç®¡ç†æ˜¯ç”±ç¨‹åºå‘˜è´Ÿè´£çš„ï¼Œå¦‚æœæ²¡æœ‰æ‰‹åŠ¨é‡Šæ”¾ç»“ç‚¹å¯¹åº”çš„å†…å­˜ç©ºé—´ï¼Œå°±ä¼šäº§ç”Ÿå†…å­˜æ³„éœ²ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬<strong>æ’å…¥ç»“ç‚¹æ—¶ï¼Œä¸€å®šè¦æ³¨æ„æ“ä½œçš„é¡ºåº</strong>ï¼Œè¦å…ˆå°†ç»“ç‚¹ x çš„ next æŒ‡é’ˆæŒ‡å‘ç»“ç‚¹ bï¼Œå†æŠŠç»“ç‚¹ a çš„ next æŒ‡é’ˆæŒ‡å‘ç»“ç‚¹ xï¼Œè¿™æ ·æ‰ä¸ä¼šä¸¢å¤±æŒ‡é’ˆï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚æ‰€ä»¥ï¼Œå¯¹äºåˆšåˆšçš„æ’å…¥ä»£ç ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠç¬¬ 1 è¡Œå’Œç¬¬ 2 è¡Œä»£ç çš„é¡ºåºé¢ å€’ä¸€ä¸‹å°±å¯ä»¥äº†ã€‚</p><p>åŒç†ï¼Œ<strong>åˆ é™¤é“¾è¡¨ç»“ç‚¹æ—¶ï¼Œä¹Ÿä¸€å®šè¦è®°å¾—æ‰‹åŠ¨é‡Šæ”¾å†…å­˜ç©ºé—´</strong>ï¼Œå¦åˆ™ï¼Œä¹Ÿä¼šå‡ºç°å†…å­˜æ³„æ¼çš„é—®é¢˜ã€‚å½“ç„¶ï¼Œå¯¹äºåƒ Java è¿™ç§è™šæ‹Ÿæœºè‡ªåŠ¨ç®¡ç†å†…å­˜çš„ç¼–ç¨‹è¯­è¨€æ¥è¯´ï¼Œå°±ä¸éœ€è¦è€ƒè™‘è¿™ä¹ˆå¤šäº†ã€‚</p><h3 id="æŠ€å·§ä¸‰ï¼šåˆ©ç”¨å“¨å…µç®€åŒ–å®ç°éš¾åº¦"><a href="#æŠ€å·§ä¸‰ï¼šåˆ©ç”¨å“¨å…µç®€åŒ–å®ç°éš¾åº¦" class="headerlink" title="æŠ€å·§ä¸‰ï¼šåˆ©ç”¨å“¨å…µç®€åŒ–å®ç°éš¾åº¦"></a>æŠ€å·§ä¸‰ï¼šåˆ©ç”¨å“¨å…µç®€åŒ–å®ç°éš¾åº¦</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸€ä¸‹å•é“¾è¡¨çš„æ’å…¥å’Œåˆ é™¤æ“ä½œã€‚å¦‚æœæˆ‘ä»¬åœ¨ç»“ç‚¹ p åé¢æ’å…¥ä¸€ä¸ªæ–°çš„ç»“ç‚¹ï¼Œåªéœ€è¦ä¸‹é¢ä¸¤è¡Œä»£ç å°±å¯ä»¥æå®šã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">new_node-&gt;next = p-&gt;next;</span><br><span class="line">p-&gt;next = new_node;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬è¦å‘ä¸€ä¸ªç©ºé“¾è¡¨ä¸­æ’å…¥ç¬¬ä¸€ä¸ªç»“ç‚¹ï¼Œåˆšåˆšçš„é€»è¾‘å°±ä¸èƒ½ç”¨äº†ã€‚æˆ‘ä»¬éœ€è¦è¿›è¡Œä¸‹é¢è¿™æ ·çš„ç‰¹æ®Šå¤„ç†ï¼Œå…¶ä¸­ head è¡¨ç¤ºé“¾è¡¨çš„å¤´ç»“ç‚¹ã€‚æ‰€ä»¥ï¼Œä»è¿™æ®µä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå¯¹äºå•é“¾è¡¨çš„æ’å…¥æ“ä½œï¼Œç¬¬ä¸€ä¸ªç»“ç‚¹å’Œå…¶ä»–ç»“ç‚¹çš„æ’å…¥é€»è¾‘æ˜¯ä¸ä¸€æ ·çš„ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (head == null) &#123;</span><br><span class="line">  head = new_node;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å†æ¥çœ‹å•é“¾è¡¨ç»“ç‚¹åˆ é™¤æ“ä½œã€‚å¦‚æœè¦åˆ é™¤ç»“ç‚¹ p çš„åç»§ç»“ç‚¹ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸€è¡Œä»£ç å°±å¯ä»¥æå®šã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p-&gt;next = p-&gt;next-&gt;next;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬è¦åˆ é™¤é“¾è¡¨ä¸­çš„æœ€åä¸€ä¸ªç»“ç‚¹ï¼Œå‰é¢çš„åˆ é™¤ä»£ç å°±ä¸ work äº†ã€‚è·Ÿæ’å…¥ç±»ä¼¼ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å¯¹äºè¿™ç§æƒ…å†µç‰¹æ®Šå¤„ç†ã€‚å†™æˆä»£ç æ˜¯è¿™æ ·å­çš„ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (head-&gt;next == null) &#123;</span><br><span class="line">   head = null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»å‰é¢çš„ä¸€æ­¥ä¸€æ­¥åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œ<strong>é’ˆå¯¹é“¾è¡¨çš„æ’å…¥ã€åˆ é™¤æ“ä½œï¼Œéœ€è¦å¯¹æ’å…¥ç¬¬ä¸€ä¸ªç»“ç‚¹å’Œåˆ é™¤æœ€åä¸€ä¸ªç»“ç‚¹çš„æƒ…å†µè¿›è¡Œç‰¹æ®Šå¤„ç†</strong>ã€‚è¿™æ ·ä»£ç å®ç°èµ·æ¥å°±ä¼šå¾ˆç¹çï¼Œä¸ç®€æ´ï¼Œè€Œä¸”ä¹Ÿå®¹æ˜“å› ä¸ºè€ƒè™‘ä¸å…¨è€Œå‡ºé”™ã€‚å¦‚ä½•æ¥è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</p><p>æŠ€å·§ä¸‰ä¸­æåˆ°çš„å“¨å…µå°±è¦ç™»åœºäº†ã€‚å“¨å…µï¼Œè§£å†³çš„æ˜¯å›½å®¶ä¹‹é—´çš„è¾¹ç•Œé—®é¢˜ã€‚åŒç†ï¼Œè¿™é‡Œè¯´çš„å“¨å…µä¹Ÿæ˜¯è§£å†³â€œè¾¹ç•Œé—®é¢˜â€çš„ï¼Œä¸ç›´æ¥å‚ä¸ä¸šåŠ¡é€»è¾‘ã€‚</p><p>è¿˜è®°å¾—å¦‚ä½•è¡¨ç¤ºä¸€ä¸ªç©ºé“¾è¡¨å—ï¼Ÿhead&#x3D;null è¡¨ç¤ºé“¾è¡¨ä¸­æ²¡æœ‰ç»“ç‚¹äº†ã€‚å…¶ä¸­ head è¡¨ç¤ºå¤´ç»“ç‚¹æŒ‡é’ˆï¼ŒæŒ‡å‘é“¾è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªç»“ç‚¹ã€‚</p><p>å¦‚æœæˆ‘ä»¬å¼•å…¥å“¨å…µç»“ç‚¹ï¼Œåœ¨ä»»ä½•æ—¶å€™ï¼Œä¸ç®¡é“¾è¡¨æ˜¯ä¸æ˜¯ç©ºï¼Œhead æŒ‡é’ˆéƒ½ä¼šä¸€ç›´æŒ‡å‘è¿™ä¸ªå“¨å…µç»“ç‚¹ã€‚æˆ‘ä»¬ä¹ŸæŠŠè¿™ç§æœ‰å“¨å…µç»“ç‚¹çš„é“¾è¡¨å«<strong>å¸¦å¤´é“¾è¡¨</strong>ã€‚ç›¸åï¼Œæ²¡æœ‰å“¨å…µç»“ç‚¹çš„é“¾è¡¨å°±å«ä½œ<strong>ä¸å¸¦å¤´é“¾è¡¨</strong>ã€‚</p><p>æˆ‘ç”»äº†ä¸€ä¸ªå¸¦å¤´é“¾è¡¨ï¼Œä½ å¯ä»¥å‘ç°ï¼Œå“¨å…µç»“ç‚¹æ˜¯ä¸å­˜å‚¨æ•°æ®çš„ã€‚å› ä¸ºå“¨å…µç»“ç‚¹ä¸€ç›´å­˜åœ¨ï¼Œæ‰€ä»¥æ’å…¥ç¬¬ä¸€ä¸ªç»“ç‚¹å’Œæ’å…¥å…¶ä»–ç»“ç‚¹ï¼Œåˆ é™¤æœ€åä¸€ä¸ªç»“ç‚¹å’Œåˆ é™¤å…¶ä»–ç»“ç‚¹ï¼Œéƒ½å¯ä»¥ç»Ÿä¸€ä¸ºç›¸åŒçš„ä»£ç å®ç°é€»è¾‘äº†ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ’å…¥ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">new_node-&gt;next = dummy_node-&gt;next</span><br><span class="line">dummy_node-&gt;next = new_node</span><br><span class="line"><span class="comment">// åˆ é™¤æœ€åä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">dummy_node-&gt;next = dummy_node-&gt;next-&gt;next;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210329003540.jpeg" alt="img"></p><h3 id="æŠ€å·§å››ï¼šé‡ç‚¹ç•™æ„è¾¹ç•Œæ¡ä»¶å¤„ç†"><a href="#æŠ€å·§å››ï¼šé‡ç‚¹ç•™æ„è¾¹ç•Œæ¡ä»¶å¤„ç†" class="headerlink" title="æŠ€å·§å››ï¼šé‡ç‚¹ç•™æ„è¾¹ç•Œæ¡ä»¶å¤„ç†"></a>æŠ€å·§å››ï¼šé‡ç‚¹ç•™æ„è¾¹ç•Œæ¡ä»¶å¤„ç†</h3><p>è½¯ä»¶å¼€å‘ä¸­ï¼Œä»£ç åœ¨ä¸€äº›è¾¹ç•Œæˆ–è€…å¼‚å¸¸æƒ…å†µä¸‹ï¼Œæœ€å®¹æ˜“äº§ç”Ÿ Bugã€‚é“¾è¡¨ä»£ç ä¹Ÿä¸ä¾‹å¤–ã€‚è¦å®ç°æ²¡æœ‰ Bug çš„é“¾è¡¨ä»£ç ï¼Œä¸€å®šè¦åœ¨ç¼–å†™çš„è¿‡ç¨‹ä¸­ä»¥åŠç¼–å†™å®Œæˆä¹‹åï¼Œæ£€æŸ¥è¾¹ç•Œæ¡ä»¶æ˜¯å¦è€ƒè™‘å…¨é¢ï¼Œä»¥åŠä»£ç åœ¨è¾¹ç•Œæ¡ä»¶ä¸‹æ˜¯å¦èƒ½æ­£ç¡®è¿è¡Œã€‚</p><p>æˆ‘ç»å¸¸ç”¨æ¥æ£€æŸ¥é“¾è¡¨ä»£ç æ˜¯å¦æ­£ç¡®çš„è¾¹ç•Œæ¡ä»¶æœ‰è¿™æ ·å‡ ä¸ªï¼š</p><ul><li>å¦‚æœé“¾è¡¨ä¸ºç©ºæ—¶ï¼Œä»£ç æ˜¯å¦èƒ½æ­£å¸¸å·¥ä½œï¼Ÿ</li><li>å¦‚æœé“¾è¡¨åªåŒ…å«ä¸€ä¸ªç»“ç‚¹æ—¶ï¼Œä»£ç æ˜¯å¦èƒ½æ­£å¸¸å·¥ä½œï¼Ÿ</li><li>å¦‚æœé“¾è¡¨åªåŒ…å«ä¸¤ä¸ªç»“ç‚¹æ—¶ï¼Œä»£ç æ˜¯å¦èƒ½æ­£å¸¸å·¥ä½œï¼Ÿ</li><li>ä»£ç é€»è¾‘åœ¨å¤„ç†å¤´ç»“ç‚¹å’Œå°¾ç»“ç‚¹çš„æ—¶å€™ï¼Œæ˜¯å¦èƒ½æ­£å¸¸å·¥ä½œï¼Ÿ</li></ul><h3 id="æŠ€å·§äº”ï¼šä¸¾ä¾‹ç”»å›¾ï¼Œè¾…åŠ©æ€è€ƒ"><a href="#æŠ€å·§äº”ï¼šä¸¾ä¾‹ç”»å›¾ï¼Œè¾…åŠ©æ€è€ƒ" class="headerlink" title="æŠ€å·§äº”ï¼šä¸¾ä¾‹ç”»å›¾ï¼Œè¾…åŠ©æ€è€ƒ"></a>æŠ€å·§äº”ï¼šä¸¾ä¾‹ç”»å›¾ï¼Œè¾…åŠ©æ€è€ƒ</h3><p>å¯¹äºç¨å¾®å¤æ‚çš„é“¾è¡¨æ“ä½œï¼Œæ¯”å¦‚å‰é¢æˆ‘ä»¬æåˆ°çš„å•é“¾è¡¨åè½¬ï¼ŒæŒ‡é’ˆä¸€ä¼šå„¿æŒ‡è¿™ï¼Œä¸€ä¼šå„¿æŒ‡é‚£ï¼Œä¸€ä¼šå„¿å°±è¢«ç»•æ™•äº†ã€‚æ€»æ„Ÿè§‰è„‘å®¹é‡ä¸å¤Ÿï¼Œæƒ³ä¸æ¸…æ¥šã€‚æ‰€ä»¥è¿™ä¸ªæ—¶å€™å°±è¦ä½¿ç”¨å¤§æ‹›äº†ï¼Œ<strong>ä¸¾ä¾‹æ³•</strong>å’Œ<strong>ç”»å›¾æ³•</strong>ã€‚</p><p>ä½ å¯ä»¥æ‰¾ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼ŒæŠŠå®ƒç”»åœ¨çº¸ä¸Šï¼Œé‡Šæ”¾ä¸€äº›è„‘å®¹é‡ï¼Œç•™æ›´å¤šçš„ç»™é€»è¾‘æ€è€ƒï¼Œè¿™æ ·å°±ä¼šæ„Ÿè§‰åˆ°æ€è·¯æ¸…æ™°å¾ˆå¤šã€‚æ¯”å¦‚å¾€å•é“¾è¡¨ä¸­æ’å…¥ä¸€ä¸ªæ•°æ®è¿™æ ·ä¸€ä¸ªæ“ä½œï¼Œæˆ‘ä¸€èˆ¬éƒ½æ˜¯æŠŠå„ç§æƒ…å†µéƒ½ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œç”»å‡ºæ’å…¥å‰å’Œæ’å…¥åçš„é“¾è¡¨å˜åŒ–ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210329004753.jpeg" alt="img"></p><p>çœ‹å›¾å†™ä»£ç ï¼Œæ˜¯ä¸æ˜¯å°±ç®€å•å¤šå•¦ï¼Ÿè€Œä¸”ï¼Œå½“æˆ‘ä»¬å†™å®Œä»£ç ä¹‹åï¼Œä¹Ÿå¯ä»¥ä¸¾å‡ ä¸ªä¾‹å­ï¼Œç”»åœ¨çº¸ä¸Šï¼Œç…§ç€ä»£ç èµ°ä¸€éï¼Œå¾ˆå®¹æ˜“å°±èƒ½å‘ç°ä»£ç ä¸­çš„ Bugã€‚</p><h3 id="æŠ€å·§å…­ï¼šå¤šå†™å¤šç»ƒï¼Œæ²¡æœ‰æ·å¾„"><a href="#æŠ€å·§å…­ï¼šå¤šå†™å¤šç»ƒï¼Œæ²¡æœ‰æ·å¾„" class="headerlink" title="æŠ€å·§å…­ï¼šå¤šå†™å¤šç»ƒï¼Œæ²¡æœ‰æ·å¾„"></a>æŠ€å·§å…­ï¼šå¤šå†™å¤šç»ƒï¼Œæ²¡æœ‰æ·å¾„</h3><p>æˆ‘ç²¾é€‰äº† 5 ä¸ªå¸¸è§çš„é“¾è¡¨æ“ä½œã€‚ä½ åªè¦æŠŠè¿™å‡ ä¸ªæ“ä½œéƒ½èƒ½å†™ç†Ÿç»ƒï¼Œä¸ç†Ÿå°±å¤šå†™å‡ éï¼Œæˆ‘ä¿è¯ä½ ä¹‹åå†ä¹Ÿä¸ä¼šå®³æ€•å†™é“¾è¡¨ä»£ç ã€‚</p><ul><li><p><a href="https://leetcode-cn.com/problems/reverse-linked-list/">206. åè½¬é“¾è¡¨</a></p></li><li><p><a href="https://leetcode-cn.com/problems/linked-list-cycle/">141. ç¯å½¢é“¾è¡¨</a></p></li><li><p><a href="https://leetcode-cn.com/problems/merge-two-sorted-lists/">21. åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨</a></p></li><li><p><a href="https://leetcode-cn.com/problems/remove-nth-node-from-end-of-list/">19. åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ N ä¸ªç»“ç‚¹</a></p></li><li><p><a href="https://leetcode-cn.com/problems/middle-of-the-linked-list/">876. é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹</a></p></li></ul><h2 id="è¯¾åæ€è€ƒ"><a href="#è¯¾åæ€è€ƒ" class="headerlink" title="è¯¾åæ€è€ƒ"></a>è¯¾åæ€è€ƒ</h2><p>ä»Šå¤©æˆ‘ä»¬è®²åˆ°ç”¨å“¨å…µæ¥ç®€åŒ–ç¼–ç å®ç°ï¼Œä½ æ˜¯å¦è¿˜èƒ½å¤Ÿæƒ³åˆ°å…¶ä»–åœºæ™¯ï¼Œåˆ©ç”¨å“¨å…µå¯ä»¥å¤§å¤§åœ°ç®€åŒ–ç¼–ç éš¾åº¦ï¼Ÿ</p><blockquote><p>å“¨å…µå¯ä»¥ç†è§£ä¸ºå®ƒå¯ä»¥å‡å°‘ç‰¹æ®Šæƒ…å†µçš„åˆ¤æ–­ï¼Œæ¯”å¦‚åˆ¤ç©ºï¼Œæ¯”å¦‚åˆ¤è¶Šç•Œï¼Œæ¯”å¦‚å‡å°‘é“¾è¡¨æ’å…¥åˆ é™¤ä¸­å¯¹ç©ºé“¾è¡¨çš„åˆ¤æ–­ï¼Œæ¯”å¦‚ä¾‹å­ä¸­å¯¹iè¶Šç•Œçš„åˆ¤æ–­ã€‚</p><p>ç©ºä¸è¶Šç•Œå¯ä»¥è®¤ä¸ºæ˜¯å°æ¦‚ç‡æƒ…å†µï¼Œæ‰€ä»¥ä»£ç æ¯ä¸€æ¬¡æ“ä½œéƒ½èµ°ä¸€éåˆ¤æ–­ï¼Œåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½ä¼šæ˜¯å¤šä½™çš„ã€‚</p><p>å“¨å…µçš„å·§å¦™å°±æ˜¯æå‰å°†è¿™ç§æƒ…å†µå»é™¤ï¼Œæ¯”å¦‚ç»™ä¸€ä¸ªå“¨å…µç»“ç‚¹ï¼Œä»¥åŠå°†keyèµ‹å€¼ç»™æ•°ç»„æœ«å…ƒç´ ï¼Œè®©æ•°ç»„éå†ä¸ç”¨åˆ¤æ–­è¶Šç•Œä¹Ÿå¯ä»¥å› ä¸ºç›¸ç­‰åœä¸‹æ¥ã€‚</p><p>ä½¿ç”¨å“¨å…µçš„æŒ‡å¯¼æ€æƒ³åº”è¯¥æ˜¯å°†å°æ¦‚ç‡éœ€è¦çš„åˆ¤æ–­å…ˆæå‰æ‰¼æ€ï¼Œæ¯”å¦‚æå‰ç»™ä»–ä¸€ä¸ªå€¼è®©ä»–ä¸ä¸ºnullï¼Œæˆ–è€…æå‰é¢„è®¾å€¼ï¼Œæˆ–è€…å¤šæ€çš„æ—¶å€™æå‰ç»™ä¸ªç©ºå®ç°ï¼Œç„¶ååœ¨æ¯ä¸€æ¬¡æ“ä½œä¸­ä¸å¿…å†åˆ¤æ–­ä»¥å¢åŠ æ•ˆç‡ã€‚</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>06è®²</title>
      <link href="/posts/592a39.html"/>
      <url>/posts/592a39.html</url>
      
        <content type="html"><![CDATA[<hr><h1 id="06-é“¾è¡¨ï¼ˆä¸Šï¼‰ï¼šå¦‚ä½•å®ç°LRUç¼“å­˜æ·˜æ±°ç®—æ³•"><a href="#06-é“¾è¡¨ï¼ˆä¸Šï¼‰ï¼šå¦‚ä½•å®ç°LRUç¼“å­˜æ·˜æ±°ç®—æ³•" class="headerlink" title="06 | é“¾è¡¨ï¼ˆä¸Šï¼‰ï¼šå¦‚ä½•å®ç°LRUç¼“å­˜æ·˜æ±°ç®—æ³•?"></a>06 | é“¾è¡¨ï¼ˆä¸Šï¼‰ï¼šå¦‚ä½•å®ç°LRUç¼“å­˜æ·˜æ±°ç®—æ³•?</h1><h2 id="é“¾è¡¨çš„æ¦‚å¿µ"><a href="#é“¾è¡¨çš„æ¦‚å¿µ" class="headerlink" title="é“¾è¡¨çš„æ¦‚å¿µ"></a>é“¾è¡¨çš„æ¦‚å¿µ</h2><h3 id="é“¾è¡¨å’Œæ•°ç»„çš„åŒºåˆ«"><a href="#é“¾è¡¨å’Œæ•°ç»„çš„åŒºåˆ«" class="headerlink" title="é“¾è¡¨å’Œæ•°ç»„çš„åŒºåˆ«"></a>é“¾è¡¨å’Œæ•°ç»„çš„åŒºåˆ«</h3><p>æˆ‘ä»¬å…ˆä»<strong>åº•å±‚çš„å­˜å‚¨ç»“æ„</strong>ä¸Šæ¥çœ‹ä¸€çœ‹ã€‚</p><p>ä¸ºäº†ç›´è§‚åœ°å¯¹æ¯”ï¼Œæˆ‘ç”»äº†ä¸€å¼ å›¾ã€‚ä»å›¾ä¸­æˆ‘ä»¬çœ‹åˆ°ï¼Œæ•°ç»„éœ€è¦ä¸€å—<strong>è¿ç»­çš„å†…å­˜ç©ºé—´</strong>æ¥å­˜å‚¨ï¼Œå¯¹å†…å­˜çš„è¦æ±‚æ¯”è¾ƒé«˜ã€‚å¦‚æœæˆ‘ä»¬ç”³è¯·ä¸€ä¸ª 100MB å¤§å°çš„æ•°ç»„ï¼Œå½“å†…å­˜ä¸­æ²¡æœ‰è¿ç»­çš„ã€è¶³å¤Ÿå¤§çš„å­˜å‚¨ç©ºé—´æ—¶ï¼Œå³ä¾¿å†…å­˜çš„å‰©ä½™æ€»å¯ç”¨ç©ºé—´å¤§äº 100MBï¼Œä»ç„¶ä¼šç”³è¯·å¤±è´¥ã€‚</p><p>è€Œé“¾è¡¨æ°æ°ç›¸åï¼Œå®ƒå¹¶ä¸éœ€è¦ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œå®ƒé€šè¿‡â€œæŒ‡é’ˆâ€å°†ä¸€ç»„<strong>é›¶æ•£çš„å†…å­˜å—</strong>ä¸²è”èµ·æ¥ä½¿ç”¨ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬ç”³è¯·çš„æ˜¯ 100MB å¤§å°çš„é“¾è¡¨ï¼Œæ ¹æœ¬ä¸ä¼šæœ‰é—®é¢˜ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210327143549.jpeg" alt="img"></p><h3 id="äº”èŠ±å…«é—¨çš„çš„é“¾è¡¨ç»“æ„"><a href="#äº”èŠ±å…«é—¨çš„çš„é“¾è¡¨ç»“æ„" class="headerlink" title="äº”èŠ±å…«é—¨çš„çš„é“¾è¡¨ç»“æ„"></a>äº”èŠ±å…«é—¨çš„çš„é“¾è¡¨ç»“æ„</h3><p>é“¾è¡¨ç»“æ„äº”èŠ±å…«é—¨ï¼Œä»Šå¤©æˆ‘é‡ç‚¹ç»™ä½ ä»‹ç»ä¸‰ç§æœ€å¸¸è§çš„é“¾è¡¨ç»“æ„ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼šå•é“¾è¡¨ã€åŒå‘é“¾è¡¨å’Œå¾ªç¯é“¾è¡¨ã€‚æˆ‘ä»¬é¦–å…ˆæ¥çœ‹æœ€ç®€å•ã€æœ€å¸¸ç”¨çš„<strong>å•é“¾è¡¨</strong>ã€‚</p><h4 id="å•é“¾è¡¨"><a href="#å•é“¾è¡¨" class="headerlink" title="å•é“¾è¡¨"></a>å•é“¾è¡¨</h4><p>æˆ‘ä»¬åˆšåˆšè®²åˆ°ï¼Œé“¾è¡¨é€šè¿‡æŒ‡é’ˆå°†ä¸€ç»„é›¶æ•£çš„å†…å­˜å—ä¸²è”åœ¨ä¸€èµ·ã€‚å…¶ä¸­ï¼Œæˆ‘ä»¬æŠŠå†…å­˜å—ç§°ä¸ºé“¾è¡¨çš„â€œ<strong>ç»“ç‚¹</strong>â€ã€‚ä¸ºäº†å°†æ‰€æœ‰çš„ç»“ç‚¹ä¸²èµ·æ¥ï¼Œæ¯ä¸ªé“¾è¡¨çš„ç»“ç‚¹é™¤äº†å­˜å‚¨æ•°æ®ä¹‹å¤–ï¼Œè¿˜éœ€è¦è®°å½•é“¾ä¸Šçš„ä¸‹ä¸€ä¸ªç»“ç‚¹çš„åœ°å€ã€‚å¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªè®°å½•ä¸‹ä¸ªç»“ç‚¹åœ°å€çš„æŒ‡é’ˆå«ä½œ<strong>åç»§æŒ‡é’ˆ next</strong>ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210327144616.jpeg" alt="img"></p><p>ä»æˆ‘ç”»çš„å•é“¾è¡¨å›¾ä¸­ï¼Œä½ åº”è¯¥å¯ä»¥å‘ç°ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªç»“ç‚¹æ˜¯æ¯”è¾ƒç‰¹æ®Šçš„ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ç¬¬ä¸€ä¸ªç»“ç‚¹å’Œæœ€åä¸€ä¸ªç»“ç‚¹ã€‚æˆ‘ä»¬ä¹ æƒ¯æ€§åœ°æŠŠç¬¬ä¸€ä¸ªç»“ç‚¹å«ä½œ<strong>å¤´ç»“ç‚¹</strong>ï¼ŒæŠŠæœ€åä¸€ä¸ªç»“ç‚¹å«ä½œ<strong>å°¾ç»“ç‚¹</strong>ã€‚å…¶ä¸­ï¼Œå¤´ç»“ç‚¹ç”¨æ¥è®°å½•é“¾è¡¨çš„åŸºåœ°å€ã€‚æœ‰äº†å®ƒï¼Œæˆ‘ä»¬å°±å¯ä»¥éå†å¾—åˆ°æ•´æ¡é“¾è¡¨ã€‚è€Œå°¾ç»“ç‚¹ç‰¹æ®Šçš„åœ°æ–¹æ˜¯ï¼šæŒ‡é’ˆä¸æ˜¯æŒ‡å‘ä¸‹ä¸€ä¸ªç»“ç‚¹ï¼Œè€Œæ˜¯æŒ‡å‘ä¸€ä¸ª<strong>ç©ºåœ°å€ NULL</strong>ï¼Œè¡¨ç¤ºè¿™æ˜¯é“¾è¡¨ä¸Šæœ€åä¸€ä¸ªç»“ç‚¹ã€‚</p><p>ä¸æ•°ç»„ä¸€æ ·ï¼Œé“¾è¡¨ä¹Ÿæ”¯æŒæ•°æ®çš„æŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤æ“ä½œã€‚</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨è¿›è¡Œæ•°ç»„çš„æ’å…¥ã€åˆ é™¤æ“ä½œæ—¶ï¼Œä¸ºäº†ä¿æŒå†…å­˜æ•°æ®çš„è¿ç»­æ€§ï¼Œéœ€è¦åšå¤§é‡çš„æ•°æ®æ¬ç§»ï¼Œæ‰€ä»¥**æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)**ã€‚è€Œåœ¨é“¾è¡¨ä¸­æ’å…¥æˆ–è€…åˆ é™¤ä¸€ä¸ªæ•°æ®ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦ä¸ºäº†ä¿æŒå†…å­˜çš„è¿ç»­æ€§è€Œæ¬ç§»ç»“ç‚¹ï¼Œå› ä¸ºé“¾è¡¨çš„å­˜å‚¨ç©ºé—´æœ¬èº«å°±ä¸æ˜¯è¿ç»­çš„ã€‚æ‰€ä»¥ï¼Œåœ¨é“¾è¡¨ä¸­æ’å…¥å’Œåˆ é™¤ä¸€ä¸ªæ•°æ®æ˜¯éå¸¸å¿«é€Ÿçš„ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿ä½ ç†è§£ï¼Œæˆ‘ç”»äº†ä¸€å¼ å›¾ï¼Œä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œé’ˆå¯¹é“¾è¡¨çš„æ’å…¥å’Œåˆ é™¤æ“ä½œï¼Œæˆ‘ä»¬åªéœ€è¦è€ƒè™‘ç›¸é‚»ç»“ç‚¹çš„æŒ‡é’ˆæ”¹å˜ï¼Œæ‰€ä»¥å¯¹åº”çš„**æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)**ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210327144923.jpeg" alt="img"></p><p>ä½†æ˜¯ï¼Œæœ‰åˆ©å°±æœ‰å¼Šã€‚é“¾è¡¨è¦æƒ³éšæœºè®¿é—®ç¬¬ k ä¸ªå…ƒç´ ï¼Œå°±æ²¡æœ‰æ•°ç»„é‚£ä¹ˆé«˜æ•ˆäº†ã€‚å› ä¸ºé“¾è¡¨ä¸­çš„æ•°æ®å¹¶éè¿ç»­å­˜å‚¨çš„ï¼Œæ‰€ä»¥æ— æ³•åƒæ•°ç»„é‚£æ ·ï¼Œæ ¹æ®é¦–åœ°å€å’Œä¸‹æ ‡ï¼Œé€šè¿‡å¯»å€å…¬å¼å°±èƒ½ç›´æ¥è®¡ç®—å‡ºå¯¹åº”çš„å†…å­˜åœ°å€ï¼Œè€Œæ˜¯éœ€è¦æ ¹æ®æŒ‡é’ˆä¸€ä¸ªç»“ç‚¹ä¸€ä¸ªç»“ç‚¹åœ°ä¾æ¬¡éå†ï¼Œç›´åˆ°æ‰¾åˆ°ç›¸åº”çš„ç»“ç‚¹ã€‚</p><p>ä½ å¯ä»¥æŠŠé“¾è¡¨æƒ³è±¡æˆä¸€ä¸ªé˜Ÿä¼ï¼Œé˜Ÿä¼ä¸­çš„æ¯ä¸ªäººéƒ½åªçŸ¥é“è‡ªå·±åé¢çš„äººæ˜¯è°ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬å¸Œæœ›çŸ¥é“æ’åœ¨ç¬¬ k ä½çš„äººæ˜¯è°çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦ä»ç¬¬ä¸€ä¸ªäººå¼€å§‹ï¼Œä¸€ä¸ªä¸€ä¸ªåœ°å¾€ä¸‹æ•°ã€‚æ‰€ä»¥ï¼Œé“¾è¡¨éšæœºè®¿é—®çš„æ€§èƒ½æ²¡æœ‰æ•°ç»„å¥½ï¼Œéœ€è¦ <strong>O(n) çš„æ—¶é—´å¤æ‚åº¦</strong>ã€‚</p><h4 id="å¾ªç¯é“¾è¡¨"><a href="#å¾ªç¯é“¾è¡¨" class="headerlink" title="å¾ªç¯é“¾è¡¨"></a>å¾ªç¯é“¾è¡¨</h4><p><strong>å¾ªç¯é“¾è¡¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„å•é“¾è¡¨</strong>ã€‚å®é™…ä¸Šï¼Œå¾ªç¯é“¾è¡¨ä¹Ÿå¾ˆç®€å•ã€‚å®ƒè·Ÿå•é“¾è¡¨å”¯ä¸€çš„åŒºåˆ«å°±åœ¨å°¾ç»“ç‚¹ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œå•é“¾è¡¨çš„å°¾ç»“ç‚¹æŒ‡é’ˆæŒ‡å‘ç©ºåœ°å€ï¼Œè¡¨ç¤ºè¿™å°±æ˜¯æœ€åçš„ç»“ç‚¹äº†ã€‚è€Œå¾ªç¯é“¾è¡¨çš„å°¾ç»“ç‚¹æŒ‡é’ˆæ˜¯æŒ‡å‘é“¾è¡¨çš„å¤´ç»“ç‚¹ã€‚ä»æˆ‘ç”»çš„å¾ªç¯é“¾è¡¨å›¾ä¸­ï¼Œä½ åº”è¯¥å¯ä»¥çœ‹å‡ºæ¥ï¼Œå®ƒåƒä¸€ä¸ªç¯ä¸€æ ·é¦–å°¾ç›¸è¿ï¼Œæ‰€ä»¥å«ä½œâ€œå¾ªç¯â€é“¾è¡¨ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210327145318.jpeg"></p><p>å’Œå•é“¾è¡¨ç›¸æ¯”ï¼Œå¾ªç¯é“¾è¡¨çš„ä¼˜ç‚¹æ˜¯ä»é“¾å°¾åˆ°é“¾å¤´æ¯”è¾ƒæ–¹ä¾¿ã€‚å½“è¦å¤„ç†çš„æ•°æ®å…·æœ‰ç¯å‹ç»“æ„ç‰¹ç‚¹æ—¶ï¼Œå°±ç‰¹åˆ«é€‚åˆé‡‡ç”¨å¾ªç¯é“¾è¡¨ã€‚æ¯”å¦‚è‘—åçš„çº¦ç‘Ÿå¤«é—®é¢˜ã€‚å°½ç®¡ç”¨å•é“¾è¡¨ä¹Ÿå¯ä»¥å®ç°ï¼Œä½†æ˜¯ç”¨å¾ªç¯é“¾è¡¨å®ç°çš„è¯ï¼Œä»£ç å°±ä¼šç®€æ´å¾ˆå¤šã€‚</p><h4 id="åŒå‘é“¾è¡¨"><a href="#åŒå‘é“¾è¡¨" class="headerlink" title="åŒå‘é“¾è¡¨"></a>åŒå‘é“¾è¡¨</h4><p>å•é“¾è¡¨å’Œå¾ªç¯é“¾è¡¨æ˜¯ä¸æ˜¯éƒ½ä¸éš¾ï¼Ÿæ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªç¨å¾®å¤æ‚çš„ï¼Œåœ¨å®é™…çš„è½¯ä»¶å¼€å‘ä¸­ï¼Œä¹Ÿæ›´åŠ å¸¸ç”¨çš„é“¾è¡¨ç»“æ„ï¼š<strong>åŒå‘é“¾è¡¨</strong>ã€‚</p><p>å•å‘é“¾è¡¨åªæœ‰ä¸€ä¸ªæ–¹å‘ï¼Œç»“ç‚¹åªæœ‰ä¸€ä¸ªåç»§æŒ‡é’ˆ next æŒ‡å‘åé¢çš„ç»“ç‚¹ã€‚è€ŒåŒå‘é“¾è¡¨ï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒæ”¯æŒä¸¤ä¸ªæ–¹å‘ï¼Œæ¯ä¸ªç»“ç‚¹ä¸æ­¢æœ‰ä¸€ä¸ªåç»§æŒ‡é’ˆ next æŒ‡å‘åé¢çš„ç»“ç‚¹ï¼Œè¿˜æœ‰ä¸€ä¸ªå‰é©±æŒ‡é’ˆ prev æŒ‡å‘å‰é¢çš„ç»“ç‚¹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210327145700.jpeg" alt="img"></p><p>ä»æˆ‘ç”»çš„å›¾ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼ŒåŒå‘é“¾è¡¨éœ€è¦é¢å¤–çš„ä¸¤ä¸ªç©ºé—´æ¥å­˜å‚¨åç»§ç»“ç‚¹å’Œå‰é©±ç»“ç‚¹çš„åœ°å€ã€‚æ‰€ä»¥ï¼Œå¦‚æœå­˜å‚¨åŒæ ·å¤šçš„æ•°æ®ï¼ŒåŒå‘é“¾è¡¨è¦æ¯”å•é“¾è¡¨å ç”¨æ›´å¤šçš„å†…å­˜ç©ºé—´ã€‚è™½ç„¶ä¸¤ä¸ªæŒ‡é’ˆæ¯”è¾ƒæµªè´¹å­˜å‚¨ç©ºé—´ï¼Œä½†å¯ä»¥æ”¯æŒåŒå‘éå†ï¼Œè¿™æ ·ä¹Ÿå¸¦æ¥äº†åŒå‘é“¾è¡¨æ“ä½œçš„çµæ´»æ€§ã€‚</p><h4 id="åŒé“¾è¡¨ç›¸å¯¹å•é“¾è¡¨çš„ä¼˜åŠ¿"><a href="#åŒé“¾è¡¨ç›¸å¯¹å•é“¾è¡¨çš„ä¼˜åŠ¿" class="headerlink" title="åŒé“¾è¡¨ç›¸å¯¹å•é“¾è¡¨çš„ä¼˜åŠ¿"></a>åŒé“¾è¡¨ç›¸å¯¹å•é“¾è¡¨çš„ä¼˜åŠ¿</h4><p>é‚£ç›¸æ¯”å•é“¾è¡¨ï¼ŒåŒå‘é“¾è¡¨é€‚åˆè§£å†³å“ªç§é—®é¢˜å‘¢ï¼Ÿ</p><p>ä»ç»“æ„ä¸Šæ¥çœ‹ï¼ŒåŒå‘é“¾è¡¨å¯ä»¥æ”¯æŒ O(1) æ—¶é—´å¤æ‚åº¦çš„æƒ…å†µä¸‹æ‰¾åˆ°å‰é©±ç»“ç‚¹ï¼Œæ­£æ˜¯è¿™æ ·çš„ç‰¹ç‚¹ï¼Œä¹Ÿä½¿åŒå‘é“¾è¡¨åœ¨æŸäº›æƒ…å†µä¸‹çš„æ’å…¥ã€åˆ é™¤ç­‰æ“ä½œéƒ½è¦æ¯”å•é“¾è¡¨ç®€å•ã€é«˜æ•ˆã€‚</p><p>ä½ å¯èƒ½ä¼šè¯´ï¼Œæˆ‘åˆšè®²åˆ°å•é“¾è¡¨çš„æ’å…¥ã€åˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦å·²ç»æ˜¯ O(1) äº†ï¼ŒåŒå‘é“¾è¡¨è¿˜èƒ½å†æ€ä¹ˆé«˜æ•ˆå‘¢ï¼Ÿåˆ«ç€æ€¥ï¼Œåˆšåˆšçš„åˆ†ææ¯”è¾ƒåç†è®ºï¼Œå¾ˆå¤šæ•°æ®ç»“æ„å’Œç®—æ³•ä¹¦ç±ä¸­éƒ½ä¼šè¿™ä¹ˆè®²ï¼Œä½†æ˜¯è¿™ç§è¯´æ³•å®é™…ä¸Šæ˜¯ä¸å‡†ç¡®çš„ï¼Œæˆ–è€…è¯´æ˜¯æœ‰å…ˆå†³æ¡ä»¶çš„ã€‚æˆ‘å†æ¥å¸¦ä½ åˆ†æä¸€ä¸‹é“¾è¡¨çš„ä¸¤ä¸ªæ“ä½œã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹<strong>åˆ é™¤æ“ä½œ</strong>ã€‚</p><p>åœ¨å®é™…çš„è½¯ä»¶å¼€å‘ä¸­ï¼Œä»é“¾è¡¨ä¸­åˆ é™¤ä¸€ä¸ªæ•°æ®æ— å¤–ä¹è¿™ä¸¤ç§æƒ…å†µï¼š</p><ul><li>åˆ é™¤ç»“ç‚¹ä¸­â€œå€¼ç­‰äºæŸä¸ªç»™å®šå€¼â€çš„ç»“ç‚¹ï¼›</li><li>åˆ é™¤ç»™å®šæŒ‡é’ˆæŒ‡å‘çš„ç»“ç‚¹ã€‚</li></ul><p>å¯¹äºç¬¬ä¸€ç§æƒ…å†µï¼Œä¸ç®¡æ˜¯å•é“¾è¡¨è¿˜æ˜¯åŒå‘é“¾è¡¨ï¼Œä¸ºäº†æŸ¥æ‰¾åˆ°å€¼ç­‰äºç»™å®šå€¼çš„ç»“ç‚¹ï¼Œéƒ½éœ€è¦ä»å¤´ç»“ç‚¹å¼€å§‹ä¸€ä¸ªä¸€ä¸ªä¾æ¬¡éå†å¯¹æ¯”ï¼Œç›´åˆ°æ‰¾åˆ°å€¼ç­‰äºç»™å®šå€¼çš„ç»“ç‚¹ï¼Œç„¶åå†é€šè¿‡æˆ‘å‰é¢è®²çš„æŒ‡é’ˆæ“ä½œå°†å…¶åˆ é™¤ã€‚</p><p>å°½ç®¡å•çº¯çš„åˆ é™¤æ“ä½œæ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ï¼Œä½†éå†æŸ¥æ‰¾çš„æ—¶é—´æ˜¯ä¸»è¦çš„è€—æ—¶ç‚¹ï¼Œå¯¹åº”çš„æ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚æ ¹æ®æ—¶é—´å¤æ‚åº¦åˆ†æä¸­çš„åŠ æ³•æ³•åˆ™ï¼Œåˆ é™¤å€¼ç­‰äºç»™å®šå€¼çš„ç»“ç‚¹å¯¹åº”çš„é“¾è¡¨æ“ä½œçš„æ€»æ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚</p><p>å¯¹äºç¬¬äºŒç§æƒ…å†µï¼Œæˆ‘ä»¬å·²ç»æ‰¾åˆ°äº†è¦åˆ é™¤çš„ç»“ç‚¹ï¼Œä½†æ˜¯åˆ é™¤æŸä¸ªç»“ç‚¹ q éœ€è¦çŸ¥é“å…¶å‰é©±ç»“ç‚¹ï¼Œè€Œå•é“¾è¡¨å¹¶ä¸æ”¯æŒç›´æ¥è·å–å‰é©±ç»“ç‚¹ï¼Œæ‰€ä»¥ï¼Œä¸ºäº†æ‰¾åˆ°å‰é©±ç»“ç‚¹ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦ä»å¤´ç»“ç‚¹å¼€å§‹éå†é“¾è¡¨ï¼Œç›´åˆ° p-&gt;next&#x3D;qï¼Œè¯´æ˜ p æ˜¯ q çš„å‰é©±ç»“ç‚¹ã€‚</p><p>ä½†æ˜¯å¯¹äºåŒå‘é“¾è¡¨æ¥è¯´ï¼Œè¿™ç§æƒ…å†µå°±æ¯”è¾ƒæœ‰ä¼˜åŠ¿äº†ã€‚å› ä¸ºåŒå‘é“¾è¡¨ä¸­çš„ç»“ç‚¹å·²ç»ä¿å­˜äº†å‰é©±ç»“ç‚¹çš„æŒ‡é’ˆï¼Œä¸éœ€è¦åƒå•é“¾è¡¨é‚£æ ·éå†ã€‚æ‰€ä»¥ï¼Œé’ˆå¯¹ç¬¬äºŒç§æƒ…å†µï¼Œå•é“¾è¡¨åˆ é™¤æ“ä½œéœ€è¦ O(n) çš„æ—¶é—´å¤æ‚åº¦ï¼Œè€ŒåŒå‘é“¾è¡¨åªéœ€è¦åœ¨ O(1) çš„æ—¶é—´å¤æ‚åº¦å†…å°±æå®šäº†ï¼</p><p>åŒç†ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨é“¾è¡¨çš„æŸä¸ªæŒ‡å®šç»“ç‚¹å‰é¢æ’å…¥ä¸€ä¸ªç»“ç‚¹ï¼ŒåŒå‘é“¾è¡¨æ¯”å•é“¾è¡¨æœ‰å¾ˆå¤§çš„ä¼˜åŠ¿ã€‚åŒå‘é“¾è¡¨å¯ä»¥åœ¨ O(1) æ—¶é—´å¤æ‚åº¦æå®šï¼Œè€Œå•å‘é“¾è¡¨éœ€è¦ O(n) çš„æ—¶é—´å¤æ‚åº¦ã€‚ä½ å¯ä»¥å‚ç…§æˆ‘åˆšåˆšè®²è¿‡çš„åˆ é™¤æ“ä½œè‡ªå·±åˆ†æä¸€ä¸‹ã€‚</p><p>é™¤äº†æ’å…¥ã€åˆ é™¤æ“ä½œæœ‰ä¼˜åŠ¿ä¹‹å¤–ï¼Œå¯¹äºä¸€ä¸ªæœ‰åºé“¾è¡¨ï¼ŒåŒå‘é“¾è¡¨çš„æŒ‰å€¼æŸ¥è¯¢çš„æ•ˆç‡ä¹Ÿè¦æ¯”å•é“¾è¡¨é«˜ä¸€äº›ã€‚å› ä¸ºï¼Œæˆ‘ä»¬å¯ä»¥è®°å½•ä¸Šæ¬¡æŸ¥æ‰¾çš„ä½ç½® pï¼Œæ¯æ¬¡æŸ¥è¯¢æ—¶ï¼Œæ ¹æ®è¦æŸ¥æ‰¾çš„å€¼ä¸ p çš„å¤§å°å…³ç³»ï¼Œå†³å®šæ˜¯å¾€å‰è¿˜æ˜¯å¾€åæŸ¥æ‰¾ï¼Œæ‰€ä»¥å¹³å‡åªéœ€è¦æŸ¥æ‰¾ä¸€åŠçš„æ•°æ®ã€‚</p><h4 id="åŒå‘å¾ªç¯é“¾è¡¨"><a href="#åŒå‘å¾ªç¯é“¾è¡¨" class="headerlink" title="åŒå‘å¾ªç¯é“¾è¡¨"></a>åŒå‘å¾ªç¯é“¾è¡¨</h4><p>äº†è§£äº†å¾ªç¯é“¾è¡¨å’ŒåŒå‘é“¾è¡¨ï¼Œå¦‚æœæŠŠè¿™ä¸¤ç§é“¾è¡¨æ•´åˆåœ¨ä¸€èµ·å°±æ˜¯ä¸€ä¸ªæ–°çš„ç‰ˆæœ¬ï¼š<strong>åŒå‘å¾ªç¯é“¾è¡¨</strong>ã€‚æˆ‘æƒ³ä¸ç”¨æˆ‘å¤šè®²ï¼Œä½ åº”è¯¥çŸ¥é“åŒå‘å¾ªç¯é“¾è¡¨é•¿ä»€ä¹ˆæ ·å­äº†å§ï¼Ÿä½ å¯ä»¥è‡ªå·±è¯•ç€åœ¨çº¸ä¸Šç”»ä¸€ç”»ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210327154453.jpeg" alt="img"></p><h3 id="é“¾è¡¨-VS-æ•°ç»„æ€§èƒ½å¤§æ¯”æ‹¼"><a href="#é“¾è¡¨-VS-æ•°ç»„æ€§èƒ½å¤§æ¯”æ‹¼" class="headerlink" title="é“¾è¡¨ VS æ•°ç»„æ€§èƒ½å¤§æ¯”æ‹¼"></a>é“¾è¡¨ VS æ•°ç»„æ€§èƒ½å¤§æ¯”æ‹¼</h3><p>é€šè¿‡å‰é¢å†…å®¹çš„å­¦ä¹ ï¼Œä½ åº”è¯¥å·²ç»çŸ¥é“ï¼Œæ•°ç»„å’Œé“¾è¡¨æ˜¯ä¸¤ç§æˆªç„¶ä¸åŒçš„å†…å­˜ç»„ç»‡æ–¹å¼ã€‚æ­£æ˜¯å› ä¸ºå†…å­˜å­˜å‚¨çš„åŒºåˆ«ï¼Œå®ƒä»¬æ’å…¥ã€åˆ é™¤ã€éšæœºè®¿é—®æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ­£å¥½ç›¸åã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210327154545.jpeg" alt="img"></p><p>ä¸è¿‡ï¼Œæ•°ç»„å’Œé“¾è¡¨çš„å¯¹æ¯”ï¼Œå¹¶ä¸èƒ½å±€é™äºæ—¶é—´å¤æ‚åº¦ã€‚è€Œä¸”ï¼Œåœ¨å®é™…çš„è½¯ä»¶å¼€å‘ä¸­ï¼Œä¸èƒ½ä»…ä»…åˆ©ç”¨å¤æ‚åº¦åˆ†æå°±å†³å®šä½¿ç”¨å“ªä¸ªæ•°æ®ç»“æ„æ¥å­˜å‚¨æ•°æ®ã€‚</p><p>æ•°ç»„ç®€å•æ˜“ç”¨ï¼Œåœ¨å®ç°ä¸Šä½¿ç”¨çš„æ˜¯è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œå¯ä»¥å€ŸåŠ© CPU çš„ç¼“å­˜æœºåˆ¶ï¼Œé¢„è¯»æ•°ç»„ä¸­çš„æ•°æ®ï¼Œæ‰€ä»¥è®¿é—®æ•ˆç‡æ›´é«˜ã€‚è€Œé“¾è¡¨åœ¨å†…å­˜ä¸­å¹¶ä¸æ˜¯è¿ç»­å­˜å‚¨ï¼Œæ‰€ä»¥å¯¹ CPU ç¼“å­˜ä¸å‹å¥½ï¼Œæ²¡åŠæ³•æœ‰æ•ˆé¢„è¯»ã€‚</p><blockquote><p>CPUåœ¨ä»å†…å­˜è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œä¼šå…ˆæŠŠè¯»å–åˆ°çš„æ•°æ®åŠ è½½åˆ°CPUçš„ç¼“å­˜ä¸­ã€‚è€ŒCPUæ¯æ¬¡ä»å†…å­˜è¯»å–æ•°æ®å¹¶ä¸æ˜¯åªè¯»å–é‚£ä¸ªç‰¹å®šè¦è®¿é—®çš„åœ°å€ï¼Œè€Œæ˜¯è¯»å–ä¸€ä¸ªæ•°æ®å—å¹¶ä¿å­˜åˆ°CPUç¼“å­˜ä¸­ï¼Œç„¶åä¸‹æ¬¡è®¿é—®å†…å­˜æ•°æ®çš„æ—¶å€™å°±ä¼šå…ˆä»CPUç¼“å­˜å¼€å§‹æŸ¥æ‰¾ï¼ˆ<strong>è®¡ç®—æœºçš„å±€éƒ¨æ€§åŸç†</strong>ï¼‰ï¼Œå¦‚æœæ‰¾åˆ°å°±ä¸éœ€è¦å†ä»å†…å­˜ä¸­å–ã€‚è¿™æ ·å°±å®ç°äº†æ¯”å†…å­˜è®¿é—®é€Ÿåº¦æ›´å¿«çš„æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯CPUç¼“å­˜å­˜åœ¨çš„æ„ä¹‰ï¼šä¸ºäº†å¼¥è¡¥å†…å­˜è®¿é—®é€Ÿåº¦è¿‡æ…¢ä¸CPUæ‰§è¡Œé€Ÿåº¦å¿«ä¹‹é—´çš„å·®å¼‚è€Œå¼•å…¥ã€‚ å¯¹äºæ•°ç»„æ¥è¯´ï¼Œå­˜å‚¨ç©ºé—´æ˜¯è¿ç»­çš„ï¼Œæ‰€ä»¥åœ¨åŠ è½½æŸä¸ªä¸‹æ ‡çš„æ—¶å€™å¯ä»¥æŠŠä»¥åçš„å‡ ä¸ªä¸‹æ ‡å…ƒç´ ä¹ŸåŠ è½½åˆ°CPUç¼“å­˜è¿™æ ·æ‰§è¡Œé€Ÿåº¦ä¼šå¿«äºå­˜å‚¨ç©ºé—´ä¸è¿ç»­çš„é“¾è¡¨å­˜å‚¨ã€‚</p></blockquote><p>æ•°ç»„çš„ç¼ºç‚¹æ˜¯å¤§å°å›ºå®šï¼Œä¸€ç»å£°æ˜å°±è¦å ç”¨æ•´å—è¿ç»­å†…å­˜ç©ºé—´ã€‚å¦‚æœå£°æ˜çš„æ•°ç»„è¿‡å¤§ï¼Œç³»ç»Ÿå¯èƒ½æ²¡æœ‰è¶³å¤Ÿçš„è¿ç»­å†…å­˜ç©ºé—´åˆ†é…ç»™å®ƒï¼Œå¯¼è‡´â€œå†…å­˜ä¸è¶³ï¼ˆout of memoryï¼‰â€ã€‚å¦‚æœå£°æ˜çš„æ•°ç»„è¿‡å°ï¼Œåˆ™å¯èƒ½å‡ºç°ä¸å¤Ÿç”¨çš„æƒ…å†µã€‚è¿™æ—¶åªèƒ½å†ç”³è¯·ä¸€ä¸ªæ›´å¤§çš„å†…å­˜ç©ºé—´ï¼ŒæŠŠåŸæ•°ç»„æ‹·è´è¿›å»ï¼Œéå¸¸è´¹æ—¶ã€‚é“¾è¡¨æœ¬èº«æ²¡æœ‰å¤§å°çš„é™åˆ¶ï¼Œå¤©ç„¶åœ°æ”¯æŒåŠ¨æ€æ‰©å®¹ï¼Œæˆ‘è§‰å¾—è¿™ä¹Ÿæ˜¯å®ƒä¸æ•°ç»„æœ€å¤§çš„åŒºåˆ«ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æœä½ çš„ä»£ç å¯¹å†…å­˜çš„ä½¿ç”¨éå¸¸è‹›åˆ»ï¼Œé‚£æ•°ç»„å°±æ›´é€‚åˆä½ ã€‚å› ä¸ºé“¾è¡¨ä¸­çš„æ¯ä¸ªç»“ç‚¹éƒ½éœ€è¦æ¶ˆè€—é¢å¤–çš„å­˜å‚¨ç©ºé—´å»å­˜å‚¨ä¸€ä»½æŒ‡å‘ä¸‹ä¸€ä¸ªç»“ç‚¹çš„æŒ‡é’ˆï¼Œæ‰€ä»¥å†…å­˜æ¶ˆè€—ä¼šç¿»å€ã€‚è€Œä¸”ï¼Œå¯¹é“¾è¡¨è¿›è¡Œé¢‘ç¹çš„æ’å…¥ã€åˆ é™¤æ“ä½œï¼Œè¿˜ä¼šå¯¼è‡´é¢‘ç¹çš„å†…å­˜ç”³è¯·å’Œé‡Šæ”¾ï¼Œå®¹æ˜“é€ æˆå†…å­˜ç¢ç‰‡ï¼Œå¦‚æœæ˜¯ Java è¯­è¨€ï¼Œå°±æœ‰å¯èƒ½ä¼šå¯¼è‡´é¢‘ç¹çš„ GCï¼ˆGarbage Collectionï¼Œåƒåœ¾å›æ”¶ï¼‰ã€‚</p><h2 id="åŸºäºé“¾è¡¨å®ç°-LRU-ç¼“å­˜æ·˜æ±°ç®—æ³•"><a href="#åŸºäºé“¾è¡¨å®ç°-LRU-ç¼“å­˜æ·˜æ±°ç®—æ³•" class="headerlink" title="åŸºäºé“¾è¡¨å®ç° LRU ç¼“å­˜æ·˜æ±°ç®—æ³•"></a>åŸºäºé“¾è¡¨å®ç° LRU ç¼“å­˜æ·˜æ±°ç®—æ³•</h2><h3 id="å¸¸è§çš„ç¼“å­˜æ·˜æ±°ç­–ç•¥"><a href="#å¸¸è§çš„ç¼“å­˜æ·˜æ±°ç­–ç•¥" class="headerlink" title="å¸¸è§çš„ç¼“å­˜æ·˜æ±°ç­–ç•¥"></a>å¸¸è§çš„ç¼“å­˜æ·˜æ±°ç­–ç•¥</h3><p>ç¼“å­˜çš„å¤§å°æœ‰é™ï¼Œå½“ç¼“å­˜è¢«ç”¨æ»¡æ—¶ï¼Œå“ªäº›æ•°æ®åº”è¯¥è¢«æ¸…ç†å‡ºå»ï¼Œå“ªäº›æ•°æ®åº”è¯¥è¢«ä¿ç•™ï¼Ÿè¿™å°±éœ€è¦ç¼“å­˜æ·˜æ±°ç­–ç•¥æ¥å†³å®šã€‚å¸¸è§çš„ç­–ç•¥æœ‰ä¸‰ç§ï¼šå…ˆè¿›å…ˆå‡ºç­–ç•¥ FIFOï¼ˆFirst Inï¼ŒFirst Outï¼‰ã€æœ€å°‘ä½¿ç”¨ç­–ç•¥ LFUï¼ˆLeast Frequently Usedï¼‰ã€æœ€è¿‘æœ€å°‘ä½¿ç”¨ç­–ç•¥ LRUï¼ˆLeast Recently Usedï¼‰ã€‚</p><p>è¿™äº›ç­–ç•¥ä½ ä¸ç”¨æ­»è®°ï¼Œæˆ‘æ‰“ä¸ªæ¯”æ–¹ä½ å¾ˆå®¹æ˜“å°±æ˜ç™½äº†ã€‚å‡å¦‚è¯´ï¼Œä½ ä¹°äº†å¾ˆå¤šæœ¬æŠ€æœ¯ä¹¦ï¼Œä½†æœ‰ä¸€å¤©ä½ å‘ç°ï¼Œè¿™äº›ä¹¦å¤ªå¤šäº†ï¼Œå¤ªå ä¹¦æˆ¿ç©ºé—´äº†ï¼Œä½ è¦åšä¸ªå¤§æ‰«é™¤ï¼Œæ‰”æ‰ä¸€äº›ä¹¦ç±ã€‚é‚£è¿™ä¸ªæ—¶å€™ï¼Œä½ ä¼šé€‰æ‹©æ‰”æ‰å“ªäº›ä¹¦å‘¢ï¼Ÿå¯¹åº”ä¸€ä¸‹ï¼Œä½ çš„é€‰æ‹©æ ‡å‡†æ˜¯ä¸æ˜¯å’Œä¸Šé¢çš„ä¸‰ç§ç­–ç•¥ç¥ä¼¼å‘¢ï¼Ÿ</p><h3 id="LRUåœ¨æ“ä½œç³»ç»Ÿä¸­çš„åº”ç”¨"><a href="#LRUåœ¨æ“ä½œç³»ç»Ÿä¸­çš„åº”ç”¨" class="headerlink" title="LRUåœ¨æ“ä½œç³»ç»Ÿä¸­çš„åº”ç”¨"></a>LRUåœ¨æ“ä½œç³»ç»Ÿä¸­çš„åº”ç”¨</h3><p>LRUæœ€è¿‘æœ€å°‘æœªä½¿ç”¨ç®—æ³•ã€‚åœ¨OSè™šæ‹Ÿå­˜å‚¨å™¨é‚£éƒ¨åˆ†ã€‚ç”¨åˆ°äº†è¯¥ç®—æ³•ï¼Œæ ¹æ®ç¨‹åºçš„å±€éƒ¨æ€§åŸç†ï¼Œå‰äººè®¾è®¡å‡ºäº†è™šæ‹Ÿå­˜å‚¨å™¨ï¼Œæ¯ä¸ªè¿›ç¨‹åªè¢«åˆ†é…å‡ ä¸ªå†…å­˜å—ï¼Œå½“è¿›ç¨‹çš„å†…å­˜å—è¢«å å®Œäº†ä¹‹åã€‚ä»ç¡¬ç›˜ä¸Šåˆé‡æ–°è¯»å–äº†ä¸€ä¸ªå†…å­˜å—çš„æ•°æ®é‡ï¼Œæ­¤æ—¶ï¼Œå“ªä¸ªå†…å­˜å—çš„å†…å®¹è¢«æ¢å‡ºå»æ¯”è¾ƒåˆé€‚å‘¢ï¼Ÿå¦‚æœç½®æ¢ç®—æ³•é‡‡å–çš„ä¸å¥½ï¼Œå°±ä¼šå¯¼è‡´ç¼ºé¡µç‡ä¸Šå‡ã€‚è¿›ç¨‹é¢‘ç¹çš„å‘ç”Ÿç¼ºé¡µä¸­æ–­ã€‚OSå°±ä¼šé¢‘ç¹çš„åœ¨å†…å­˜å’Œå¤–å­˜ä¹‹é—´æ›¿æ¢é¡µé¢ã€‚å½±å“äº†è¿›ç¨‹çš„æ‰§è¡Œæ•ˆç‡ï¼Œè¿™ç§ç°è±¡åˆç§°ä¹‹ä¸ºâ€æŠ–åŠ¨â€ï¼ŒLRUç½®æ¢ç®—æ³•çš„ç¼ºé¡µç‡ç›¸å¯¹æ¯”è¾ƒä½ã€‚</p><h3 id="ç®—æ³•å®ç°"><a href="#ç®—æ³•å®ç°" class="headerlink" title="ç®—æ³•å®ç°"></a>ç®—æ³•å®ç°</h3><p>æˆ‘çš„æ€è·¯æ˜¯è¿™æ ·çš„ï¼šæˆ‘ä»¬ç»´æŠ¤ä¸€ä¸ªæœ‰åºå•é“¾è¡¨ï¼Œè¶Šé è¿‘é“¾è¡¨å°¾éƒ¨çš„ç»“ç‚¹æ˜¯è¶Šæ—©ä¹‹å‰è®¿é—®çš„ã€‚å½“æœ‰ä¸€ä¸ªæ–°çš„æ•°æ®è¢«è®¿é—®æ—¶ï¼Œæˆ‘ä»¬ä»é“¾è¡¨å¤´å¼€å§‹é¡ºåºéå†é“¾è¡¨ã€‚</p><ol><li>å¦‚æœæ­¤æ•°æ®ä¹‹å‰å·²ç»è¢«ç¼“å­˜åœ¨é“¾è¡¨ä¸­äº†ï¼Œæˆ‘ä»¬éå†å¾—åˆ°è¿™ä¸ªæ•°æ®å¯¹åº”çš„ç»“ç‚¹ï¼Œå¹¶å°†å…¶ä»åŸæ¥çš„ä½ç½®åˆ é™¤ï¼Œç„¶åå†æ’å…¥åˆ°é“¾è¡¨çš„å¤´éƒ¨ã€‚</li><li>å¦‚æœæ­¤æ•°æ®æ²¡æœ‰åœ¨ç¼“å­˜é“¾è¡¨ä¸­ï¼Œåˆå¯ä»¥åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š</li></ol><ul><li>å¦‚æœæ­¤æ—¶ç¼“å­˜æœªæ»¡ï¼Œåˆ™å°†æ­¤ç»“ç‚¹ç›´æ¥æ’å…¥åˆ°é“¾è¡¨çš„å¤´éƒ¨ï¼›</li><li>å¦‚æœæ­¤æ—¶ç¼“å­˜å·²æ»¡ï¼Œåˆ™é“¾è¡¨å°¾ç»“ç‚¹åˆ é™¤ï¼Œå°†æ–°çš„æ•°æ®ç»“ç‚¹æ’å…¥é“¾è¡¨çš„å¤´éƒ¨ã€‚</li></ul><p>ç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸‹ç¼“å­˜è®¿é—®çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ã€‚å› ä¸ºä¸ç®¡ç¼“å­˜æœ‰æ²¡æœ‰æ»¡ï¼Œæˆ‘ä»¬éƒ½éœ€è¦éå†ä¸€éé“¾è¡¨ï¼Œæ‰€ä»¥è¿™ç§åŸºäºé“¾è¡¨çš„å®ç°æ€è·¯ï¼Œç¼“å­˜è®¿é—®çš„æ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚</p><p>å®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­ä¼˜åŒ–è¿™ä¸ªå®ç°æ€è·¯ï¼Œæ¯”å¦‚å¼•å…¥<strong>æ•£åˆ—è¡¨</strong>ï¼ˆHash tableï¼‰æ¥è®°å½•æ¯ä¸ªæ•°æ®çš„ä½ç½®ï¼Œå°†ç¼“å­˜è®¿é—®çš„æ—¶é—´å¤æ‚åº¦é™åˆ° O(1)ã€‚</p><h2 id="è¯¾åæ€è€ƒ"><a href="#è¯¾åæ€è€ƒ" class="headerlink" title="è¯¾åæ€è€ƒ"></a>è¯¾åæ€è€ƒ</h2><ol><li><p>å¦‚ä½•åŸºäºæ•°ç»„å®ç°LRUç®—æ³•</p><blockquote><p>å¾ªç¯æ•°ç»„ï¼Ÿ</p></blockquote></li><li><p>å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦æ˜¯å›æ–‡å­—ç¬¦ä¸²çš„é—®é¢˜ï¼Œæˆ‘æƒ³ä½ åº”è¯¥å¬è¿‡ï¼Œæˆ‘ä»¬ä»Šå¤©çš„é¢˜ç›®å°±æ˜¯åŸºäºè¿™ä¸ªé—®é¢˜çš„æ”¹é€ ç‰ˆæœ¬ã€‚å¦‚æœå­—ç¬¦ä¸²æ˜¯é€šè¿‡å•é“¾è¡¨æ¥å­˜å‚¨çš„ï¼Œé‚£è¯¥å¦‚ä½•æ¥åˆ¤æ–­æ˜¯ä¸€ä¸ªå›æ–‡ä¸²å‘¢ï¼Ÿä½ æœ‰ä»€ä¹ˆå¥½çš„è§£å†³æ€è·¯å‘¢ï¼Ÿç›¸åº”çš„æ—¶é—´ç©ºé—´å¤æ‚åº¦åˆæ˜¯å¤šå°‘å‘¢ï¼Ÿ</p><blockquote></blockquote></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>05è®²</title>
      <link href="/posts/12ec85d7.html"/>
      <url>/posts/12ec85d7.html</url>
      
        <content type="html"><![CDATA[<hr><h1 id="æ•°ç»„ï¼šä¸ºä»€ä¹ˆå¾ˆå¤šç¼–ç¨‹è¯­è¨€ä¸­æ•°ç»„éƒ½ä»0å¼€å§‹ç¼–å·ï¼Ÿ"><a href="#æ•°ç»„ï¼šä¸ºä»€ä¹ˆå¾ˆå¤šç¼–ç¨‹è¯­è¨€ä¸­æ•°ç»„éƒ½ä»0å¼€å§‹ç¼–å·ï¼Ÿ" class="headerlink" title="æ•°ç»„ï¼šä¸ºä»€ä¹ˆå¾ˆå¤šç¼–ç¨‹è¯­è¨€ä¸­æ•°ç»„éƒ½ä»0å¼€å§‹ç¼–å·ï¼Ÿ"></a>æ•°ç»„ï¼šä¸ºä»€ä¹ˆå¾ˆå¤šç¼–ç¨‹è¯­è¨€ä¸­æ•°ç»„éƒ½ä»0å¼€å§‹ç¼–å·ï¼Ÿ</h1><h2 id="æ•°ç»„å¦‚ä½•å®ç°éšæœºè®¿é—®ï¼Ÿ"><a href="#æ•°ç»„å¦‚ä½•å®ç°éšæœºè®¿é—®ï¼Ÿ" class="headerlink" title="æ•°ç»„å¦‚ä½•å®ç°éšæœºè®¿é—®ï¼Ÿ"></a>æ•°ç»„å¦‚ä½•å®ç°éšæœºè®¿é—®ï¼Ÿ</h2><h3 id="ä»€ä¹ˆæ˜¯æ•°ç»„ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ•°ç»„ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ•°ç»„ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ•°ç»„ï¼Ÿ</h3><p><strong>æ•°ç»„ï¼ˆArrayï¼‰æ˜¯ä¸€ç§çº¿æ€§è¡¨æ•°æ®ç»“æ„ã€‚å®ƒç”¨ä¸€ç»„è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œæ¥å­˜å‚¨ä¸€ç»„å…·æœ‰ç›¸åŒç±»å‹çš„æ•°æ®</strong>ã€‚</p><h3 id="æ•°ç»„æ˜¯å¦‚ä½•å®ç°æ ¹æ®ä¸‹æ ‡éšæœºè®¿é—®æ•°ç»„å…ƒç´ çš„å—ï¼Ÿ"><a href="#æ•°ç»„æ˜¯å¦‚ä½•å®ç°æ ¹æ®ä¸‹æ ‡éšæœºè®¿é—®æ•°ç»„å…ƒç´ çš„å—ï¼Ÿ" class="headerlink" title="æ•°ç»„æ˜¯å¦‚ä½•å®ç°æ ¹æ®ä¸‹æ ‡éšæœºè®¿é—®æ•°ç»„å…ƒç´ çš„å—ï¼Ÿ"></a>æ•°ç»„æ˜¯å¦‚ä½•å®ç°æ ¹æ®ä¸‹æ ‡éšæœºè®¿é—®æ•°ç»„å…ƒç´ çš„å—ï¼Ÿ</h3><p>æˆ‘ä»¬æ‹¿ä¸€ä¸ªé•¿åº¦ä¸º 10 çš„ int ç±»å‹çš„æ•°ç»„ int[] a &#x3D; new int[10]æ¥ä¸¾ä¾‹ã€‚åœ¨æˆ‘ç”»çš„è¿™ä¸ªå›¾ä¸­ï¼Œè®¡ç®—æœºç»™æ•°ç»„ a[10]ï¼Œåˆ†é…äº†ä¸€å—è¿ç»­å†…å­˜ç©ºé—´ 1000ï½1039ï¼Œå…¶ä¸­ï¼Œå†…å­˜å—çš„é¦–åœ°å€ä¸º base_address &#x3D; 1000ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210324230955.jpeg" alt="img"></p><p>æˆ‘ä»¬çŸ¥é“ï¼Œè®¡ç®—æœºä¼šç»™æ¯ä¸ªå†…å­˜å•å…ƒåˆ†é…ä¸€ä¸ªåœ°å€ï¼Œè®¡ç®—æœºé€šè¿‡åœ°å€æ¥è®¿é—®å†…å­˜ä¸­çš„æ•°æ®ã€‚å½“è®¡ç®—æœºéœ€è¦éšæœºè®¿é—®æ•°ç»„ä¸­çš„æŸä¸ªå…ƒç´ æ—¶ï¼Œå®ƒä¼šé¦–å…ˆé€šè¿‡ä¸‹é¢çš„å¯»å€å…¬å¼ï¼Œè®¡ç®—å‡ºè¯¥å…ƒç´ å­˜å‚¨çš„å†…å­˜åœ°å€ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[i]_address = base_address + i * data_type_size</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ data_type_size è¡¨ç¤ºæ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ çš„å¤§å°ã€‚æˆ‘ä»¬ä¸¾çš„è¿™ä¸ªä¾‹å­é‡Œï¼Œæ•°ç»„ä¸­å­˜å‚¨çš„æ˜¯ int ç±»å‹æ•°æ®ï¼Œæ‰€ä»¥ data_type_size å°±ä¸º 4 ä¸ªå­—èŠ‚ã€‚</p><h2 id="å®¹å™¨å’Œæ•°ç»„è¯¥å¦‚ä½•é€‰æ‹©ï¼Ÿ"><a href="#å®¹å™¨å’Œæ•°ç»„è¯¥å¦‚ä½•é€‰æ‹©ï¼Ÿ" class="headerlink" title="å®¹å™¨å’Œæ•°ç»„è¯¥å¦‚ä½•é€‰æ‹©ï¼Ÿ"></a>å®¹å™¨å’Œæ•°ç»„è¯¥å¦‚ä½•é€‰æ‹©ï¼Ÿ</h2><ol><li>Java ArrayList æ— æ³•å­˜å‚¨åŸºæœ¬ç±»å‹ï¼Œæ¯”å¦‚ intã€longï¼Œéœ€è¦å°è£…ä¸º Integerã€Long ç±»ï¼Œè€Œ Autoboxingã€Unboxing åˆ™æœ‰ä¸€å®šçš„æ€§èƒ½æ¶ˆè€—ï¼Œæ‰€ä»¥å¦‚æœç‰¹åˆ«å…³æ³¨æ€§èƒ½ï¼Œæˆ–è€…å¸Œæœ›ä½¿ç”¨åŸºæœ¬ç±»å‹ï¼Œå°±å¯ä»¥é€‰ç”¨æ•°ç»„ã€‚</li><li>å¦‚æœæ•°æ®å¤§å°äº‹å…ˆå·²çŸ¥ï¼Œå¹¶ä¸”å¯¹æ•°æ®çš„æ“ä½œéå¸¸ç®€å•ï¼Œç”¨ä¸åˆ° ArrayList æä¾›çš„å¤§éƒ¨åˆ†æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨æ•°ç»„ã€‚</li><li>è¿˜æœ‰ä¸€ä¸ªæ˜¯æˆ‘ä¸ªäººçš„å–œå¥½ï¼Œå½“è¦è¡¨ç¤ºå¤šç»´æ•°ç»„æ—¶ï¼Œç”¨æ•°ç»„å¾€å¾€ä¼šæ›´åŠ ç›´è§‚ã€‚æ¯”å¦‚ Object[][] arrayï¼›è€Œç”¨å®¹å™¨çš„è¯åˆ™éœ€è¦è¿™æ ·å®šä¹‰ï¼šArrayList&lt;ArrayList&lt;object&gt;&gt; arrayã€‚</li></ol><p>æ€»ç»“ä¸€ä¸‹ï¼Œå¯¹äºä¸šåŠ¡å¼€å‘ï¼Œç›´æ¥ä½¿ç”¨å®¹å™¨å°±è¶³å¤Ÿäº†ï¼Œçœæ—¶çœåŠ›ã€‚æ¯•ç«ŸæŸè€—ä¸€ä¸¢ä¸¢æ€§èƒ½ï¼Œå®Œå…¨ä¸ä¼šå½±å“åˆ°ç³»ç»Ÿæ•´ä½“çš„æ€§èƒ½ã€‚ä½†å¦‚æœä½ æ˜¯åšä¸€äº›éå¸¸åº•å±‚çš„å¼€å‘ï¼Œæ¯”å¦‚å¼€å‘ç½‘ç»œæ¡†æ¶ï¼Œæ€§èƒ½çš„ä¼˜åŒ–éœ€è¦åšåˆ°æè‡´ï¼Œè¿™ä¸ªæ—¶å€™æ•°ç»„å°±ä¼šä¼˜äºå®¹å™¨ï¼Œæˆä¸ºé¦–é€‰ã€‚</p><h2 id="ä¸ºä»€ä¹ˆæ•°ç»„è¦ä»-0-å¼€å§‹ç¼–å·ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆæ•°ç»„è¦ä»-0-å¼€å§‹ç¼–å·ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆæ•°ç»„è¦ä» 0 å¼€å§‹ç¼–å·ï¼Ÿ"></a>ä¸ºä»€ä¹ˆæ•°ç»„è¦ä» 0 å¼€å§‹ç¼–å·ï¼Ÿ</h2><p>ä»æ•°ç»„å­˜å‚¨çš„å†…å­˜æ¨¡å‹ä¸Šæ¥çœ‹ï¼Œâ€œä¸‹æ ‡â€æœ€ç¡®åˆ‡çš„å®šä¹‰åº”è¯¥æ˜¯â€œåç§»ï¼ˆoffsetï¼‰â€ã€‚å‰é¢ä¹Ÿè®²åˆ°ï¼Œå¦‚æœç”¨ a æ¥è¡¨ç¤ºæ•°ç»„çš„é¦–åœ°å€ï¼Œa[0]å°±æ˜¯åç§»ä¸º 0 çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯é¦–åœ°å€ï¼Œa[k]å°±è¡¨ç¤ºåç§» k ä¸ª type_size çš„ä½ç½®ï¼Œæ‰€ä»¥è®¡ç®— a[k]çš„å†…å­˜åœ°å€åªéœ€è¦ç”¨è¿™ä¸ªå…¬å¼ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[k]_address = base_address + k * type_size</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œå¦‚æœæ•°ç»„ä» 1 å¼€å§‹è®¡æ•°ï¼Œé‚£æˆ‘ä»¬è®¡ç®—æ•°ç»„å…ƒç´  a[k]çš„å†…å­˜åœ°å€å°±ä¼šå˜ä¸ºï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[k]_address = base_address + (k<span class="number">-1</span>) * type_size</span><br></pre></td></tr></table></figure><p>å¯¹æ¯”ä¸¤ä¸ªå…¬å¼ï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œä» 1 å¼€å§‹ç¼–å·ï¼Œæ¯æ¬¡éšæœºè®¿é—®æ•°ç»„å…ƒç´ éƒ½å¤šäº†ä¸€æ¬¡å‡æ³•è¿ç®—ï¼Œå¯¹äº CPU æ¥è¯´ï¼Œå°±æ˜¯å¤šäº†ä¸€æ¬¡å‡æ³•æŒ‡ä»¤ã€‚</p><p>æ•°ç»„ä½œä¸ºéå¸¸åŸºç¡€çš„æ•°æ®ç»“æ„ï¼Œé€šè¿‡ä¸‹æ ‡éšæœºè®¿é—®æ•°ç»„å…ƒç´ åˆæ˜¯å…¶éå¸¸åŸºç¡€çš„ç¼–ç¨‹æ“ä½œï¼Œæ•ˆç‡çš„ä¼˜åŒ–å°±è¦å°½å¯èƒ½åšåˆ°æè‡´ã€‚æ‰€ä»¥ä¸ºäº†å‡å°‘ä¸€æ¬¡å‡æ³•æ“ä½œï¼Œæ•°ç»„é€‰æ‹©äº†ä» 0 å¼€å§‹ç¼–å·ï¼Œè€Œä¸æ˜¯ä» 1 å¼€å§‹ã€‚</p><p>ä¸è¿‡æˆ‘è®¤ä¸ºï¼Œä¸Šé¢è§£é‡Šå¾—å†å¤šå…¶å®éƒ½ç®—ä¸ä¸Šå‹å€’æ€§çš„è¯æ˜ï¼Œè¯´æ•°ç»„èµ·å§‹ç¼–å·é 0 å¼€å§‹ä¸å¯ã€‚æ‰€ä»¥æˆ‘è§‰å¾—æœ€ä¸»è¦çš„åŸå› å¯èƒ½æ˜¯å†å²åŸå› ã€‚</p><p>C è¯­è¨€è®¾è®¡è€…ç”¨ 0 å¼€å§‹è®¡æ•°æ•°ç»„ä¸‹æ ‡ï¼Œä¹‹åçš„ Javaã€JavaScript ç­‰é«˜çº§è¯­è¨€éƒ½æ•ˆä»¿äº† C è¯­è¨€ï¼Œæˆ–è€…è¯´ï¼Œä¸ºäº†åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘ C è¯­è¨€ç¨‹åºå‘˜å­¦ä¹  Java çš„å­¦ä¹ æˆæœ¬ï¼Œå› æ­¤ç»§ç»­æ²¿ç”¨äº†ä» 0 å¼€å§‹è®¡æ•°çš„ä¹ æƒ¯ã€‚å®é™…ä¸Šï¼Œå¾ˆå¤šè¯­è¨€ä¸­æ•°ç»„ä¹Ÿå¹¶ä¸æ˜¯ä» 0 å¼€å§‹è®¡æ•°çš„ï¼Œæ¯”å¦‚ Matlabã€‚ç”šè‡³è¿˜æœ‰ä¸€äº›è¯­è¨€æ”¯æŒè´Ÿæ•°ä¸‹æ ‡ï¼Œæ¯”å¦‚ Pythonã€‚</p><h2 id="è¯¾åæ€è€ƒ"><a href="#è¯¾åæ€è€ƒ" class="headerlink" title="è¯¾åæ€è€ƒ"></a>è¯¾åæ€è€ƒ</h2><p>1.å‰é¢æˆ‘åŸºäºæ•°ç»„çš„åŸç†å¼•å‡º JVM çš„æ ‡è®°æ¸…é™¤åƒåœ¾å›æ”¶ç®—æ³•çš„æ ¸å¿ƒç†å¿µã€‚æˆ‘ä¸çŸ¥é“ä½ æ˜¯å¦ä½¿ç”¨ Java è¯­è¨€ï¼Œç†è§£ JVMï¼Œå¦‚æœä½ ç†Ÿæ‚‰ï¼Œå¯ä»¥åœ¨è¯„è®ºåŒºå›é¡¾ä¸‹ä½ ç†è§£çš„æ ‡è®°æ¸…é™¤åƒåœ¾å›æ”¶ç®—æ³•ã€‚</p><blockquote><p>åˆ†ä¸ºâ€œæ ‡è®°â€å’Œâ€œæ¸…é™¤â€ä¸¤ä¸ªé˜¶æ®µï¼šé¦–å…ˆæ ‡è®°å‡ºæ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œåœ¨æ ‡è®°å®Œæˆåï¼Œç»Ÿä¸€å›æ”¶æ‰æ‰€æœ‰è¢«æ ‡è®°çš„å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥åè¿‡æ¥ï¼Œæ ‡è®°å­˜æ´»çš„å¯¹è±¡ï¼Œç»Ÿä¸€å›æ”¶æ‰€æœ‰æœªè¢«æ ‡è®°çš„å¯¹è±¡ã€‚</p><p>å¤§å¤šæ•°ä¸»æµè™šæ‹Ÿæœºé‡‡ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»ï¼Œåœ¨æ ‡è®°é˜¶æ®µï¼Œä¼šéå†æ‰€æœ‰ GC ROOTSï¼Œå°†æ‰€æœ‰ GC ROOTS å¯è¾¾çš„å¯¹è±¡æ ‡è®°ä¸ºå­˜æ´»ã€‚</p><p>ç¼ºç‚¹ä¸»è¦æœ‰ä¸¤ä¸ªï¼š1. æ‰§è¡Œæ•ˆç‡ä¸ç¨³å®šï¼Œå¦‚æœJavaå †ä¸­åŒ…å«å¤§é‡å¯¹è±¡ï¼Œè€Œä¸”å…¶ä¸­å¤§éƒ¨åˆ†æ˜¯éœ€è¦è¢«å›æ”¶çš„ï¼Œè¿™æ—¶å¿…é¡»è¿›è¡Œå¤§é‡æ ‡è®°å’Œæ¸…é™¤çš„åŠ¨ä½œï¼Œå¯¼è‡´æ ‡è®°å’Œæ¸…é™¤ä¸¤ä¸ªè¿‡ç¨‹çš„æ‰§è¡Œæ•ˆç‡éƒ½éšå¯¹è±¡æ•°é‡å¢é•¿è€Œé™ä½ï¼›2. å†…å­˜ç¢ç‰‡åŒ–é—®é¢˜ï¼Œæ ‡è®°ã€æ¸…é™¤ä¹‹åä¼šäº§ç”Ÿå¤§é‡ä¸è¿ç»­çš„å†…å­˜ç¢ç‰‡ï¼Œç©ºé—´ç¢ç‰‡å¤ªå¤šå¯èƒ½ä¼šå¯¼è‡´å½“ä»¥ååœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦åˆ†é…è¾ƒå¤§å¯¹è±¡æ—¶æ— æ³•æ‰¾åˆ°è¶³å¤Ÿçš„è¿ç»­å†…å­˜è€Œä¸å¾—ä¸æå‰è§¦å‘ä¸€æ¬¡åƒåœ¾å›æ”¶åŠ¨ä½œã€‚</p></blockquote><p>2.å‰é¢æˆ‘ä»¬è®²åˆ°ä¸€ç»´æ•°ç»„çš„å†…å­˜å¯»å€å…¬å¼ï¼Œé‚£ä½ å¯ä»¥æ€è€ƒä¸€ä¸‹ï¼Œç±»æ¯”ä¸€ä¸‹ï¼ŒäºŒç»´æ•°ç»„çš„å†…å­˜å¯»å€å…¬å¼æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</p><blockquote><p>äºŒç»´æ•°ç»„å†…å­˜å¯»å€ï¼š</p><p>å¯¹äº m * n çš„æ•°ç»„ï¼Œa [i][j] (i &lt; m, j &lt; n)çš„åœ°å€ä¸ºï¼š</p><p><code>address = base_address + ( i * n + j) * type_size</code></p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬ä¸‰å‘¨</title>
      <link href="/posts/e7fad26f.html"/>
      <url>/posts/e7fad26f.html</url>
      
        <content type="html"><![CDATA[<hr><p>æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾æ¯å‘¨æ‰“å¡ 2021.03.22-2021.03.28</p><h3 id="é¢è¯•é¢˜-16-26-è®¡ç®—å™¨"><a href="#é¢è¯•é¢˜-16-26-è®¡ç®—å™¨" class="headerlink" title="é¢è¯•é¢˜ 16.26. è®¡ç®—å™¨"></a><a href="https://leetcode-cn.com/problems/calculator-lcci/">é¢è¯•é¢˜ 16.26. è®¡ç®—å™¨</a></h3><p>ç»™å®šä¸€ä¸ªåŒ…å«æ­£æ•´æ•°ã€åŠ (+)ã€å‡(-)ã€ä¹˜(*)ã€é™¤(&#x2F;)çš„ç®—æ•°è¡¨è¾¾å¼(æ‹¬å·é™¤å¤–)ï¼Œè®¡ç®—å…¶ç»“æœã€‚</p><p>è¡¨è¾¾å¼ä»…åŒ…å«éè´Ÿæ•´æ•°ï¼Œ<code>+</code>ï¼Œ <code>-</code> ï¼Œ<code>*</code>ï¼Œ<code>/</code> å››ç§è¿ç®—ç¬¦å’Œç©ºæ ¼ <code> </code>ã€‚ æ•´æ•°é™¤æ³•ä»…ä¿ç•™æ•´æ•°éƒ¨åˆ†ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: &quot;3+2*2&quot;</span><br><span class="line">è¾“å‡º: 7</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: &quot; 3/2 &quot;</span><br><span class="line">è¾“å‡º: 1</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: &quot; 3+5 / 2 &quot;</span><br><span class="line">è¾“å‡º: 5</span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜ï¼š</strong></p><ul><li>ä½ å¯ä»¥å‡è®¾æ‰€ç»™å®šçš„è¡¨è¾¾å¼éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚</li><li>è¯·<strong>ä¸è¦</strong>ä½¿ç”¨å†…ç½®çš„åº“å‡½æ•° <code>eval</code>ã€‚</li></ul><h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p>ä¸»è¦æ€æƒ³å¦‚ä¸‹ï¼š</p><ol><li>å°†å‡æ³•è½¬åŒ–ä¸ºåŠ æ³•ï¼ˆå–ç›¸åæ•°ï¼‰ </li><li>ç”±äºä¹˜é™¤æ³•ä¼˜å…ˆçº§é«˜ï¼Œç›´æ¥è®¡ç®—</li><li>æ•´æ•°ä¸ä»…ä¸€ä½ï¼Œä¼š&gt;10 </li><li>è¡¨è¾¾å¼ä¸­æ²¡æœ‰æ‹¬å·</li></ol><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">calculate</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> s.length();</span><br><span class="line">        Deque&lt;Integer&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">char</span> <span class="variable">preSign</span> <span class="operator">=</span> <span class="string">&#x27;+&#x27;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> s.charAt(i);</span><br><span class="line">            <span class="keyword">if</span> (Character.isDigit(c)) &#123;</span><br><span class="line">                <span class="comment">// è¿ç»­æ•°å­—å­—ç¬¦ä¸²è½¬ä¸ºæ•°å­—ï¼Œæ¯”å¦‚å­—ç¬¦ä¸² â€œ23â€</span></span><br><span class="line">                <span class="comment">// num ç¬¬ä¸€æ¬¡ä¿å­˜ä¸º2ï¼Œnumç¬¬äºŒæ¬¡ä¿å­˜ 2*10 + 3 = 23ã€‚</span></span><br><span class="line">                num = num * <span class="number">10</span> + c - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å¦‚æœæ˜¯è¿ç®—ç¬¦æˆ–è€…æ˜¯æœ€åä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line">            <span class="keyword">if</span> ((!Character.isDigit(c) &amp;&amp; c != <span class="string">&#x27; &#x27;</span>) || i == n - <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">switch</span> (preSign) &#123;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">                        stack.push(num);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">                        stack.push(-num);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">                        stack.push(stack.pop() * num);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">                        stack.push(stack.pop() / num);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                preSign = c;</span><br><span class="line">                <span class="comment">// numç”¨å®Œå½’é›¶</span></span><br><span class="line">                num = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å°†æ ˆä¸­å…ƒç´ æ±‚å’Œ</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!stack.isEmpty()) &#123;</span><br><span class="line">            res += stack.pop();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="739-æ¯æ—¥æ¸©åº¦"><a href="#739-æ¯æ—¥æ¸©åº¦" class="headerlink" title="739. æ¯æ—¥æ¸©åº¦"></a><a href="https://leetcode-cn.com/problems/daily-temperatures/">739. æ¯æ—¥æ¸©åº¦</a></h3><p>è¯·æ ¹æ®æ¯æ—¥ <code>æ°”æ¸©</code> åˆ—è¡¨ï¼Œé‡æ–°ç”Ÿæˆä¸€ä¸ªåˆ—è¡¨ã€‚å¯¹åº”ä½ç½®çš„è¾“å‡ºä¸ºï¼šè¦æƒ³è§‚æµ‹åˆ°æ›´é«˜çš„æ°”æ¸©ï¼Œè‡³å°‘éœ€è¦ç­‰å¾…çš„å¤©æ•°ã€‚å¦‚æœæ°”æ¸©åœ¨è¿™ä¹‹åéƒ½ä¸ä¼šå‡é«˜ï¼Œè¯·åœ¨è¯¥ä½ç½®ç”¨ <code>0</code> æ¥ä»£æ›¿ã€‚</p><p>ä¾‹å¦‚ï¼Œç»™å®šä¸€ä¸ªåˆ—è¡¨ <code>temperatures = [73, 74, 75, 71, 69, 72, 76, 73]</code>ï¼Œä½ çš„è¾“å‡ºåº”è¯¥æ˜¯ <code>[1, 1, 4, 2, 1, 1, 0, 0]</code>ã€‚</p><p><strong>æç¤ºï¼š</strong><code>æ°”æ¸©</code> åˆ—è¡¨é•¿åº¦çš„èŒƒå›´æ˜¯ <code>[1, 30000]</code>ã€‚æ¯ä¸ªæ°”æ¸©çš„å€¼çš„å‡ä¸ºåæ°åº¦ï¼Œéƒ½æ˜¯åœ¨ <code>[30, 100]</code> èŒƒå›´å†…çš„æ•´æ•°ã€‚</p><h4 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] dailyTemperatures(<span class="type">int</span>[] T) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> T.length;</span><br><span class="line">        <span class="type">int</span>[] ans = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        <span class="comment">// ç»´æŠ¤ä¸€ä¸ªå•è°ƒé€’å‡æ ˆ</span></span><br><span class="line">        Deque&lt;Integer&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> T[i];</span><br><span class="line">            <span class="comment">// å¦‚æœæ ˆä¸ä¸ºç©ºå¹¶ä¸”å½“å‰å…ƒç´ å¤§äºæ ˆé¡¶å…ƒç´ ï¼Œå¼¹å‡ºæ ˆä¸­æ¯”å½“å‰å°çš„å…ƒç´ </span></span><br><span class="line">            <span class="comment">// å¹¶æ›´æ–°å®ƒä»¬åœ¨è¿”å›æ•°ç»„ä¸­å¯¹åº”ä½ç½®çš„å€¼ï¼ˆéœ€è¦ç­‰å¾…çš„å¤©æ•°ï¼‰</span></span><br><span class="line">            <span class="comment">// æ ˆé‡Œé¢éœ€è¦ä¿å­˜å…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ï¼Œè€Œä¸æ˜¯å…·ä½“çš„æ•°å­—ã€‚å› ä¸ºéœ€è¦æ ¹æ®ä¸‹æ ‡ä¿®æ”¹ç»“æœæ•°ç»„</span></span><br><span class="line">            <span class="keyword">while</span> (!stack.isEmpty() &amp;&amp; num &gt; T[stack.peek()]) &#123;</span><br><span class="line">                <span class="type">Integer</span> <span class="variable">preIndex</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">                ans[preIndex] = i - preIndex;</span><br><span class="line">            &#125;</span><br><span class="line">            stack.push(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ </tag>
            
            <tag> æ¯å‘¨æ‰“å¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>04è®²</title>
      <link href="/posts/aa50e2b2.html"/>
      <url>/posts/aa50e2b2.html</url>
      
        <content type="html"><![CDATA[<hr><h1 id="å¤æ‚åº¦åˆ†æï¼ˆä¸‹ï¼‰ï¼šæµ…ææœ€å¥½ã€æœ€åã€å¹³å‡ã€å‡æ‘Šæ—¶é—´å¤æ‚åº¦"><a href="#å¤æ‚åº¦åˆ†æï¼ˆä¸‹ï¼‰ï¼šæµ…ææœ€å¥½ã€æœ€åã€å¹³å‡ã€å‡æ‘Šæ—¶é—´å¤æ‚åº¦" class="headerlink" title="å¤æ‚åº¦åˆ†æï¼ˆä¸‹ï¼‰ï¼šæµ…ææœ€å¥½ã€æœ€åã€å¹³å‡ã€å‡æ‘Šæ—¶é—´å¤æ‚åº¦"></a>å¤æ‚åº¦åˆ†æï¼ˆä¸‹ï¼‰ï¼šæµ…ææœ€å¥½ã€æœ€åã€å¹³å‡ã€å‡æ‘Šæ—¶é—´å¤æ‚åº¦</h1><h3 id="ä¸€ã€å¤æ‚åº¦åˆ†æçš„4ä¸ªæ¦‚å¿µ"><a href="#ä¸€ã€å¤æ‚åº¦åˆ†æçš„4ä¸ªæ¦‚å¿µ" class="headerlink" title="ä¸€ã€å¤æ‚åº¦åˆ†æçš„4ä¸ªæ¦‚å¿µ"></a>ä¸€ã€å¤æ‚åº¦åˆ†æçš„4ä¸ªæ¦‚å¿µ</h3><ol><li><strong>æœ€å¥½æƒ…å†µæ—¶é—´å¤æ‚åº¦</strong>ï¼šä»£ç åœ¨æœ€ç†æƒ³æƒ…å†µä¸‹æ‰§è¡Œçš„æ—¶é—´å¤æ‚åº¦ã€‚</li><li><strong>æœ€åæƒ…å†µæ—¶é—´å¤æ‚åº¦</strong>ï¼šä»£ç åœ¨æœ€åæƒ…å†µä¸‹æ‰§è¡Œçš„æ—¶é—´å¤æ‚åº¦ã€‚</li><li><strong>å¹³å‡æ—¶é—´å¤æ‚åº¦</strong>ï¼šç”¨ä»£ç åœ¨æ‰€æœ‰æƒ…å†µä¸‹æ‰§è¡Œçš„æ¬¡æ•°çš„åŠ æƒå¹³å‡å€¼è¡¨ç¤ºã€‚</li><li><strong>å‡æ‘Šæ—¶é—´å¤æ‚åº¦</strong>ï¼šåœ¨ä»£ç æ‰§è¡Œçš„æ‰€æœ‰å¤æ‚åº¦æƒ…å†µä¸­ç»å¤§éƒ¨åˆ†æ˜¯ä½çº§åˆ«çš„å¤æ‚åº¦ï¼Œä¸ªåˆ«æƒ…å†µæ˜¯é«˜çº§åˆ«å¤æ‚åº¦ä¸”å‘ç”Ÿå…·æœ‰æ—¶åºå…³ç³»æ—¶ï¼Œå¯ä»¥å°†ä¸ªåˆ«é«˜çº§åˆ«å¤æ‚åº¦å‡æ‘Šåˆ°ä½çº§åˆ«å¤æ‚åº¦ä¸Šã€‚åŸºæœ¬ä¸Šå‡æ‘Šç»“æœå°±ç­‰äºä½çº§åˆ«å¤æ‚åº¦ã€‚</li></ol><h3 id="äºŒã€ä¸ºä»€ä¹ˆè¦å¼•å…¥è¿™4ä¸ªæ¦‚å¿µï¼Ÿ"><a href="#äºŒã€ä¸ºä»€ä¹ˆè¦å¼•å…¥è¿™4ä¸ªæ¦‚å¿µï¼Ÿ" class="headerlink" title="äºŒã€ä¸ºä»€ä¹ˆè¦å¼•å…¥è¿™4ä¸ªæ¦‚å¿µï¼Ÿ"></a>äºŒã€ä¸ºä»€ä¹ˆè¦å¼•å…¥è¿™4ä¸ªæ¦‚å¿µï¼Ÿ</h3><ol><li>åŒä¸€æ®µä»£ç åœ¨ä¸åŒæƒ…å†µä¸‹æ—¶é—´å¤æ‚åº¦ä¼šå‡ºç°é‡çº§å·®å¼‚ï¼Œä¸ºäº†æ›´å…¨é¢ï¼Œæ›´å‡†ç¡®çš„æè¿°ä»£ç çš„æ—¶é—´å¤æ‚åº¦ï¼Œæ‰€ä»¥å¼•å…¥è¿™4ä¸ªæ¦‚å¿µã€‚</li><li>ä»£ç å¤æ‚åº¦åœ¨ä¸åŒæƒ…å†µä¸‹å‡ºç°é‡çº§å·®åˆ«æ—¶æ‰éœ€è¦åŒºåˆ«è¿™å››ç§å¤æ‚åº¦ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ˜¯ä¸éœ€è¦åŒºåˆ«åˆ†æå®ƒä»¬çš„ã€‚</li></ol><h3 id="ä¸‰ã€å¦‚ä½•åˆ†æå¹³å‡ã€å‡æ‘Šæ—¶é—´å¤æ‚åº¦ï¼Ÿ"><a href="#ä¸‰ã€å¦‚ä½•åˆ†æå¹³å‡ã€å‡æ‘Šæ—¶é—´å¤æ‚åº¦ï¼Ÿ" class="headerlink" title="ä¸‰ã€å¦‚ä½•åˆ†æå¹³å‡ã€å‡æ‘Šæ—¶é—´å¤æ‚åº¦ï¼Ÿ"></a>ä¸‰ã€å¦‚ä½•åˆ†æå¹³å‡ã€å‡æ‘Šæ—¶é—´å¤æ‚åº¦ï¼Ÿ</h3><ol><li><strong>å¹³å‡æ—¶é—´å¤æ‚åº¦</strong>ï¼šä»£ç åœ¨ä¸åŒæƒ…å†µä¸‹å¤æ‚åº¦å‡ºç°é‡çº§å·®åˆ«ï¼Œåˆ™ç”¨ä»£ç æ‰€æœ‰å¯èƒ½æƒ…å†µä¸‹æ‰§è¡Œæ¬¡æ•°çš„åŠ æƒå¹³å‡å€¼è¡¨ç¤ºã€‚</li><li><strong>å‡æ‘Šæ—¶é—´å¤æ‚åº¦</strong>ï¼šä¸¤ä¸ªæ¡ä»¶æ»¡è¶³æ—¶ä½¿ç”¨ï¼š1ï¼‰ä»£ç åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯ä½çº§åˆ«å¤æ‚åº¦ï¼Œåªæœ‰æå°‘æ•°æƒ…å†µæ˜¯é«˜çº§åˆ«å¤æ‚åº¦ï¼›2ï¼‰ä½çº§åˆ«å’Œé«˜çº§åˆ«å¤æ‚åº¦å‡ºç°å…·æœ‰æ—¶åºè§„å¾‹ã€‚å‡æ‘Šç»“æœä¸€èˆ¬éƒ½ç­‰äºä½çº§åˆ«å¤æ‚åº¦ã€‚</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>03è®²</title>
      <link href="/posts/3787da0b.html"/>
      <url>/posts/3787da0b.html</url>
      
        <content type="html"><![CDATA[<hr><h1 id="å¤æ‚åº¦åˆ†æï¼ˆä¸Šï¼‰ï¼šå¦‚ä½•åˆ†æã€ç»Ÿè®¡ç®—æ³•çš„æ‰§è¡Œæ•ˆç‡å’Œèµ„æºæ¶ˆè€—ï¼Ÿ"><a href="#å¤æ‚åº¦åˆ†æï¼ˆä¸Šï¼‰ï¼šå¦‚ä½•åˆ†æã€ç»Ÿè®¡ç®—æ³•çš„æ‰§è¡Œæ•ˆç‡å’Œèµ„æºæ¶ˆè€—ï¼Ÿ" class="headerlink" title="å¤æ‚åº¦åˆ†æï¼ˆä¸Šï¼‰ï¼šå¦‚ä½•åˆ†æã€ç»Ÿè®¡ç®—æ³•çš„æ‰§è¡Œæ•ˆç‡å’Œèµ„æºæ¶ˆè€—ï¼Ÿ"></a>å¤æ‚åº¦åˆ†æï¼ˆä¸Šï¼‰ï¼šå¦‚ä½•åˆ†æã€ç»Ÿè®¡ç®—æ³•çš„æ‰§è¡Œæ•ˆç‡å’Œèµ„æºæ¶ˆè€—ï¼Ÿ</h1><h3 id="æ—¶é—´å¤æ‚åº¦åˆ†æ"><a href="#æ—¶é—´å¤æ‚åº¦åˆ†æ" class="headerlink" title="æ—¶é—´å¤æ‚åº¦åˆ†æ"></a>æ—¶é—´å¤æ‚åº¦åˆ†æ</h3><h4 id="1-åªå…³æ³¨å¾ªç¯æ‰§è¡Œæ¬¡æ•°æœ€å¤šçš„ä¸€æ®µä»£ç "><a href="#1-åªå…³æ³¨å¾ªç¯æ‰§è¡Œæ¬¡æ•°æœ€å¤šçš„ä¸€æ®µä»£ç " class="headerlink" title="1.åªå…³æ³¨å¾ªç¯æ‰§è¡Œæ¬¡æ•°æœ€å¤šçš„ä¸€æ®µä»£ç "></a>1.åªå…³æ³¨å¾ªç¯æ‰§è¡Œæ¬¡æ•°æœ€å¤šçš„ä¸€æ®µä»£ç </h4><p>å¤§ O è¿™ç§å¤æ‚åº¦è¡¨ç¤ºæ–¹æ³•åªæ˜¯è¡¨ç¤ºä¸€ç§å˜åŒ–è¶‹åŠ¿ã€‚æˆ‘ä»¬é€šå¸¸ä¼šå¿½ç•¥æ‰å…¬å¼ä¸­çš„å¸¸é‡ã€ä½é˜¶ã€ç³»æ•°ï¼Œåªéœ€è¦è®°å½•ä¸€ä¸ªæœ€å¤§é˜¶çš„é‡çº§å°±å¯ä»¥äº†ã€‚æ‰€ä»¥ï¼Œ<strong>æˆ‘ä»¬åœ¨åˆ†æä¸€ä¸ªç®—æ³•ã€ä¸€æ®µä»£ç çš„æ—¶é—´å¤æ‚åº¦çš„æ—¶å€™ï¼Œä¹Ÿåªå…³æ³¨å¾ªç¯æ‰§è¡Œæ¬¡æ•°æœ€å¤šçš„é‚£ä¸€æ®µä»£ç å°±å¯ä»¥äº†</strong>ã€‚</p><h4 id="2-åŠ æ³•æ³•åˆ™ï¼šæ€»å¤æ‚åº¦ç­‰äºé‡çº§æœ€å¤§çš„é‚£æ®µä»£ç çš„å¤æ‚åº¦"><a href="#2-åŠ æ³•æ³•åˆ™ï¼šæ€»å¤æ‚åº¦ç­‰äºé‡çº§æœ€å¤§çš„é‚£æ®µä»£ç çš„å¤æ‚åº¦" class="headerlink" title="2.åŠ æ³•æ³•åˆ™ï¼šæ€»å¤æ‚åº¦ç­‰äºé‡çº§æœ€å¤§çš„é‚£æ®µä»£ç çš„å¤æ‚åº¦"></a>2.åŠ æ³•æ³•åˆ™ï¼šæ€»å¤æ‚åº¦ç­‰äºé‡çº§æœ€å¤§çš„é‚£æ®µä»£ç çš„å¤æ‚åº¦</h4><p><strong>æ—¶é—´å¤æ‚åº¦ä¸æ˜¯ä»£ç çš„æ‰§è¡Œæ—¶é—´ï¼Œè€Œæ˜¯ä¸€ç§éšç€æ•°æ®è§„æ¨¡ä¸æ–­å¢é•¿çš„ä¸€ç§å˜åŒ–è¶‹åŠ¿</strong>ã€‚æ‰€ä»¥é‡åˆ°å¸¸é‡æ‰§è¡Œæ—¶é—´çš„ä»£ç ï¼Œæ— è®ºè¿™æ®µä»£ç æ‰§è¡Œ10000æ¬¡ã€100000æ¬¡ï¼Œåªè¦æ˜¯ä¸€ä¸ªå·²çŸ¥çš„æ•°ï¼Œè·Ÿ n æ— å…³ï¼Œç…§æ ·ä¹Ÿæ˜¯å¸¸é‡çº§çš„æ‰§è¡Œæ—¶é—´ã€‚å½“ n æ— é™å¤§çš„æ—¶å€™ï¼Œå°±å¯ä»¥å¿½ç•¥ã€‚å°½ç®¡å¯¹ä»£ç çš„æ‰§è¡Œæ—¶é—´ä¼šæœ‰å¾ˆå¤§å½±å“ï¼Œä½†æ˜¯å›åˆ°æ—¶é—´å¤æ‚åº¦çš„æ¦‚å¿µæ¥è¯´ï¼Œå®ƒè¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªç®—æ³•æ‰§è¡Œæ•ˆç‡ä¸æ•°æ®è§„æ¨¡å¢é•¿çš„å˜åŒ–è¶‹åŠ¿ï¼Œæ‰€ä»¥ä¸ç®¡å¸¸é‡çš„æ‰§è¡Œæ—¶é—´å¤šå¤§ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥å¿½ç•¥æ‰ã€‚å› ä¸ºå®ƒæœ¬èº«å¯¹å¢é•¿è¶‹åŠ¿å¹¶æ²¡æœ‰å½±å“ã€‚</p><h4 id="3-ä¹˜æ³•æ³•åˆ™ï¼šåµŒå¥—ä»£ç çš„å¤æ‚åº¦ç­‰äºåµŒå¥—å†…å¤–ä»£ç å¤æ‚åº¦çš„ä¹˜ç§¯"><a href="#3-ä¹˜æ³•æ³•åˆ™ï¼šåµŒå¥—ä»£ç çš„å¤æ‚åº¦ç­‰äºåµŒå¥—å†…å¤–ä»£ç å¤æ‚åº¦çš„ä¹˜ç§¯" class="headerlink" title="3.ä¹˜æ³•æ³•åˆ™ï¼šåµŒå¥—ä»£ç çš„å¤æ‚åº¦ç­‰äºåµŒå¥—å†…å¤–ä»£ç å¤æ‚åº¦çš„ä¹˜ç§¯"></a>3.ä¹˜æ³•æ³•åˆ™ï¼šåµŒå¥—ä»£ç çš„å¤æ‚åº¦ç­‰äºåµŒå¥—å†…å¤–ä»£ç å¤æ‚åº¦çš„ä¹˜ç§¯</h4><h3 id="å‡ ç§å¸¸è§æ—¶é—´å¤æ‚åº¦å®ä¾‹åˆ†æ"><a href="#å‡ ç§å¸¸è§æ—¶é—´å¤æ‚åº¦å®ä¾‹åˆ†æ" class="headerlink" title="å‡ ç§å¸¸è§æ—¶é—´å¤æ‚åº¦å®ä¾‹åˆ†æ"></a>å‡ ç§å¸¸è§æ—¶é—´å¤æ‚åº¦å®ä¾‹åˆ†æ</h3><p>è™½ç„¶ä»£ç åƒå·®ä¸‡åˆ«ï¼Œä½†æ˜¯å¸¸è§çš„å¤æ‚åº¦é‡çº§å¹¶ä¸å¤šã€‚æˆ‘ç¨å¾®æ€»ç»“äº†ä¸€ä¸‹ï¼Œè¿™äº›å¤æ‚åº¦é‡çº§å‡ ä¹æ¶µç›–äº†ä½ ä»Šåå¯ä»¥æ¥è§¦çš„æ‰€æœ‰ä»£ç çš„å¤æ‚åº¦é‡çº§ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210321211233.jpeg" alt="img"></p><h4 id="1-O-1"><a href="#1-O-1" class="headerlink" title="1.O(1)"></a>1.O(1)</h4><p>æˆ‘ç¨å¾®æ€»ç»“ä¸€ä¸‹ï¼Œåªè¦ä»£ç çš„æ‰§è¡Œæ—¶é—´ä¸éš n çš„å¢å¤§è€Œå¢é•¿ï¼Œè¿™æ ·ä»£ç çš„æ—¶é—´å¤æ‚åº¦æˆ‘ä»¬éƒ½è®°ä½œ O(1)ã€‚æˆ–è€…è¯´ï¼Œ**ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåªè¦ç®—æ³•ä¸­ä¸å­˜åœ¨å¾ªç¯è¯­å¥ã€é€’å½’è¯­å¥ï¼Œå³ä½¿æœ‰æˆåƒä¸Šä¸‡è¡Œçš„ä»£ç ï¼Œå…¶æ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯ÎŸ(1)**ã€‚</p><h4 id="2-O-logn-ã€O-nlogn"><a href="#2-O-logn-ã€O-nlogn" class="headerlink" title="2.O(logn)ã€O(nlogn)"></a>2.O(logn)ã€O(nlogn)</h4><h4 id="3-O-m-n-ã€O-m-n"><a href="#3-O-m-n-ã€O-m-n" class="headerlink" title="3.O(m+n)ã€O(m*n)"></a>3.O(m+n)ã€O(m*n)</h4><h3 id="ç©ºé—´å¤æ‚åº¦åˆ†æ"><a href="#ç©ºé—´å¤æ‚åº¦åˆ†æ" class="headerlink" title="ç©ºé—´å¤æ‚åº¦åˆ†æ"></a>ç©ºé—´å¤æ‚åº¦åˆ†æ</h3><p>å‰é¢æˆ‘è®²è¿‡ï¼Œæ—¶é—´å¤æ‚åº¦çš„å…¨ç§°æ˜¯<strong>æ¸è¿›æ—¶é—´å¤æ‚åº¦ï¼Œè¡¨ç¤ºç®—æ³•çš„æ‰§è¡Œæ—¶é—´ä¸æ•°æ®è§„æ¨¡ä¹‹é—´çš„å¢é•¿å…³ç³»</strong>ã€‚ç±»æ¯”ä¸€ä¸‹ï¼Œç©ºé—´å¤æ‚åº¦å…¨ç§°å°±æ˜¯<strong>æ¸è¿›ç©ºé—´å¤æ‚åº¦</strong>ï¼ˆasymptotic space complexityï¼‰ï¼Œ<strong>è¡¨ç¤ºç®—æ³•çš„å­˜å‚¨ç©ºé—´ä¸æ•°æ®è§„æ¨¡ä¹‹é—´çš„å¢é•¿å…³ç³»</strong>ã€‚</p><p>æˆ‘ä»¬å¸¸è§çš„ç©ºé—´å¤æ‚åº¦å°±æ˜¯ O(1)ã€O(n)ã€O(n2 )ï¼Œåƒ O(logn)ã€O(nlogn) è¿™æ ·çš„å¯¹æ•°é˜¶å¤æ‚åº¦å¹³æ—¶éƒ½ç”¨ä¸åˆ°ã€‚</p><h3 id="å†…å®¹å°ç»“"><a href="#å†…å®¹å°ç»“" class="headerlink" title="å†…å®¹å°ç»“"></a>å†…å®¹å°ç»“</h3><p>åŸºç¡€å¤æ‚åº¦åˆ†æçš„çŸ¥è¯†åˆ°æ­¤å°±è®²å®Œäº†ï¼Œæˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹ã€‚</p><p>å¤æ‚åº¦ä¹Ÿå«æ¸è¿›å¤æ‚åº¦ï¼ŒåŒ…æ‹¬æ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦ï¼Œç”¨æ¥åˆ†æç®—æ³•æ‰§è¡Œæ•ˆç‡ä¸æ•°æ®è§„æ¨¡ä¹‹é—´çš„å¢é•¿å…³ç³»ï¼Œå¯ä»¥ç²—ç•¥åœ°è¡¨ç¤ºï¼Œè¶Šé«˜é˜¶å¤æ‚åº¦çš„ç®—æ³•ï¼Œæ‰§è¡Œæ•ˆç‡è¶Šä½ã€‚å¸¸è§çš„å¤æ‚åº¦å¹¶ä¸å¤šï¼Œä»ä½é˜¶åˆ°é«˜é˜¶æœ‰ï¼šO(1)ã€O(logn)ã€O(n)ã€O(nlogn)ã€O(n2 )ã€‚ç­‰ä½ å­¦å®Œæ•´ä¸ªä¸“æ ä¹‹åï¼Œä½ å°±ä¼šå‘ç°å‡ ä¹æ‰€æœ‰çš„æ•°æ®ç»“æ„å’Œç®—æ³•çš„å¤æ‚åº¦éƒ½è·‘ä¸å‡ºè¿™å‡ ä¸ªã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210321220126.jpeg" alt="img"></p><h3 id="ç•™è¨€åŒºä¼˜ç§€æ€»ç»“"><a href="#ç•™è¨€åŒºä¼˜ç§€æ€»ç»“" class="headerlink" title="ç•™è¨€åŒºä¼˜ç§€æ€»ç»“"></a>ç•™è¨€åŒºä¼˜ç§€æ€»ç»“</h3><h4 id="ä¸€ã€ä»€ä¹ˆæ˜¯å¤æ‚åº¦åˆ†æï¼Ÿ"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯å¤æ‚åº¦åˆ†æï¼Ÿ" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯å¤æ‚åº¦åˆ†æï¼Ÿ"></a>ä¸€ã€ä»€ä¹ˆæ˜¯å¤æ‚åº¦åˆ†æï¼Ÿ</h4><p>1.æ•°æ®ç»“æ„å’Œç®—æ³•è§£å†³æ˜¯â€œå¦‚ä½•è®©è®¡ç®—æœºæ›´å¿«æ—¶é—´ã€æ›´çœç©ºé—´çš„è§£å†³é—®é¢˜â€ã€‚<br>2.å› æ­¤éœ€ä»æ‰§è¡Œæ—¶é—´å’Œå ç”¨ç©ºé—´ä¸¤ä¸ªç»´åº¦æ¥è¯„ä¼°æ•°æ®ç»“æ„å’Œç®—æ³•çš„æ€§èƒ½ã€‚<br>3.åˆ†åˆ«ç”¨æ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦ä¸¤ä¸ªæ¦‚å¿µæ¥æè¿°æ€§èƒ½é—®é¢˜ï¼ŒäºŒè€…ç»Ÿç§°ä¸ºå¤æ‚åº¦ã€‚<br>4.å¤æ‚åº¦æè¿°çš„æ˜¯ç®—æ³•æ‰§è¡Œæ—¶é—´ï¼ˆæˆ–å ç”¨ç©ºé—´ï¼‰ä¸æ•°æ®è§„æ¨¡çš„å¢é•¿å…³ç³»ã€‚</p><h4 id="äºŒã€ä¸ºä»€ä¹ˆè¦è¿›è¡Œå¤æ‚åº¦åˆ†æï¼Ÿ"><a href="#äºŒã€ä¸ºä»€ä¹ˆè¦è¿›è¡Œå¤æ‚åº¦åˆ†æï¼Ÿ" class="headerlink" title="äºŒã€ä¸ºä»€ä¹ˆè¦è¿›è¡Œå¤æ‚åº¦åˆ†æï¼Ÿ"></a>äºŒã€ä¸ºä»€ä¹ˆè¦è¿›è¡Œå¤æ‚åº¦åˆ†æï¼Ÿ</h4><p>1.å’Œæ€§èƒ½æµ‹è¯•ç›¸æ¯”ï¼Œå¤æ‚åº¦åˆ†ææœ‰ä¸ä¾èµ–æ‰§è¡Œç¯å¢ƒã€æˆæœ¬ä½ã€æ•ˆç‡é«˜ã€æ˜“æ“ä½œã€æŒ‡å¯¼æ€§å¼ºçš„ç‰¹ç‚¹ã€‚<br>2.æŒæ¡å¤æ‚åº¦åˆ†æï¼Œå°†èƒ½ç¼–å†™å‡ºæ€§èƒ½æ›´ä¼˜çš„ä»£ç ï¼Œæœ‰åˆ©äºé™ä½ç³»ç»Ÿå¼€å‘å’Œç»´æŠ¤æˆæœ¬ã€‚</p><h4 id="ä¸‰ã€å¦‚ä½•è¿›è¡Œå¤æ‚åº¦åˆ†æï¼Ÿ"><a href="#ä¸‰ã€å¦‚ä½•è¿›è¡Œå¤æ‚åº¦åˆ†æï¼Ÿ" class="headerlink" title="ä¸‰ã€å¦‚ä½•è¿›è¡Œå¤æ‚åº¦åˆ†æï¼Ÿ"></a>ä¸‰ã€å¦‚ä½•è¿›è¡Œå¤æ‚åº¦åˆ†æï¼Ÿ</h4><h5 id="1-å¤§Oè¡¨ç¤ºæ³•"><a href="#1-å¤§Oè¡¨ç¤ºæ³•" class="headerlink" title="1.å¤§Oè¡¨ç¤ºæ³•"></a>1.å¤§Oè¡¨ç¤ºæ³•</h5><p>1ï¼‰æ¥æº<br>ç®—æ³•çš„æ‰§è¡Œæ—¶é—´ä¸æ¯è¡Œä»£ç çš„æ‰§è¡Œæ¬¡æ•°æˆæ­£æ¯”ï¼Œç”¨T(n) &#x3D; O(f(n))è¡¨ç¤ºï¼Œå…¶ä¸­T(n)è¡¨ç¤ºç®—æ³•æ‰§è¡Œæ€»æ—¶é—´ï¼Œf(n)è¡¨ç¤ºæ¯è¡Œä»£ç æ‰§è¡Œæ€»æ¬¡æ•°ï¼Œè€Œnå¾€å¾€è¡¨ç¤ºæ•°æ®çš„è§„æ¨¡ã€‚<br>2ï¼‰ç‰¹ç‚¹<br>ä»¥æ—¶é—´å¤æ‚åº¦ä¸ºä¾‹ï¼Œç”±äºæ—¶é—´å¤æ‚åº¦æè¿°çš„æ˜¯ç®—æ³•æ‰§è¡Œæ—¶é—´ä¸æ•°æ®è§„æ¨¡çš„å¢é•¿å˜åŒ–è¶‹åŠ¿ï¼Œæ‰€ä»¥å¸¸é‡é˜¶ã€ä½é˜¶ä»¥åŠç³»æ•°å®é™…ä¸Šå¯¹è¿™ç§å¢é•¿è¶‹åŠ¿ä¸äº§å†³å®šæ€§å½±å“ï¼Œæ‰€ä»¥åœ¨åšæ—¶é—´å¤æ‚åº¦åˆ†ææ—¶å¿½ç•¥è¿™äº›é¡¹ã€‚</p><h5 id="2-å¤æ‚åº¦åˆ†ææ³•åˆ™"><a href="#2-å¤æ‚åº¦åˆ†ææ³•åˆ™" class="headerlink" title="2.å¤æ‚åº¦åˆ†ææ³•åˆ™"></a>2.å¤æ‚åº¦åˆ†ææ³•åˆ™</h5><p>1ï¼‰å•æ®µä»£ç çœ‹é«˜é¢‘ï¼šæ¯”å¦‚å¾ªç¯ã€‚<br>2ï¼‰å¤šæ®µä»£ç å–æœ€å¤§ï¼šæ¯”å¦‚ä¸€æ®µä»£ç ä¸­æœ‰å•å¾ªç¯å’Œå¤šé‡å¾ªç¯ï¼Œé‚£ä¹ˆå–å¤šé‡å¾ªç¯çš„å¤æ‚åº¦ã€‚<br>3ï¼‰åµŒå¥—ä»£ç æ±‚ä¹˜ç§¯ï¼šæ¯”å¦‚é€’å½’ã€å¤šé‡å¾ªç¯ç­‰<br>4ï¼‰å¤šä¸ªè§„æ¨¡æ±‚åŠ æ³•ï¼šæ¯”å¦‚æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°æ§åˆ¶ä¸¤ä¸ªå¾ªç¯çš„æ¬¡æ•°ï¼Œé‚£ä¹ˆè¿™æ—¶å°±å–äºŒè€…å¤æ‚åº¦ç›¸åŠ ã€‚</p><h4 id="å››ã€å¸¸ç”¨çš„å¤æ‚åº¦çº§åˆ«ï¼Ÿ"><a href="#å››ã€å¸¸ç”¨çš„å¤æ‚åº¦çº§åˆ«ï¼Ÿ" class="headerlink" title="å››ã€å¸¸ç”¨çš„å¤æ‚åº¦çº§åˆ«ï¼Ÿ"></a>å››ã€å¸¸ç”¨çš„å¤æ‚åº¦çº§åˆ«ï¼Ÿ</h4><p>å¤šé¡¹å¼é˜¶ï¼šéšç€æ•°æ®è§„æ¨¡çš„å¢é•¿ï¼Œç®—æ³•çš„æ‰§è¡Œæ—¶é—´å’Œç©ºé—´å ç”¨ï¼ŒæŒ‰ç…§å¤šé¡¹å¼çš„æ¯”ä¾‹å¢é•¿ã€‚åŒ…æ‹¬ï¼Œ<br>O(1)ï¼ˆå¸¸æ•°é˜¶ï¼‰ã€O(logn)ï¼ˆå¯¹æ•°é˜¶ï¼‰ã€O(n)ï¼ˆçº¿æ€§é˜¶ï¼‰ã€O(nlogn)ï¼ˆçº¿æ€§å¯¹æ•°é˜¶ï¼‰ã€O(n^2)ï¼ˆå¹³æ–¹é˜¶ï¼‰ã€O(n^3)ï¼ˆç«‹æ–¹é˜¶ï¼‰<br>éå¤šé¡¹å¼é˜¶ï¼šéšç€æ•°æ®è§„æ¨¡çš„å¢é•¿ï¼Œç®—æ³•çš„æ‰§è¡Œæ—¶é—´å’Œç©ºé—´å ç”¨æš´å¢ï¼Œè¿™ç±»ç®—æ³•æ€§èƒ½æå·®ã€‚åŒ…æ‹¬ï¼Œ<br>O(2^n)ï¼ˆæŒ‡æ•°é˜¶ï¼‰ã€O(n!)ï¼ˆé˜¶ä¹˜é˜¶ï¼‰</p><h4 id="äº”ã€å¦‚ä½•æŒæ¡å¥½å¤æ‚åº¦åˆ†ææ–¹æ³•ï¼Ÿ"><a href="#äº”ã€å¦‚ä½•æŒæ¡å¥½å¤æ‚åº¦åˆ†ææ–¹æ³•ï¼Ÿ" class="headerlink" title="äº”ã€å¦‚ä½•æŒæ¡å¥½å¤æ‚åº¦åˆ†ææ–¹æ³•ï¼Ÿ"></a>äº”ã€å¦‚ä½•æŒæ¡å¥½å¤æ‚åº¦åˆ†ææ–¹æ³•ï¼Ÿ</h4><p>å¤æ‚åº¦åˆ†æå…³é”®åœ¨äºå¤šç»ƒï¼Œæ‰€è°“å­°èƒ½ç”Ÿå·§ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•é«˜é¢‘ç®—æ³•é¢˜</title>
      <link href="/posts/e62dd828.html"/>
      <url>/posts/e62dd828.html</url>
      
        <content type="html"><![CDATA[<hr><h2 id="å­—èŠ‚è·³åŠ¨"><a href="#å­—èŠ‚è·³åŠ¨" class="headerlink" title="å­—èŠ‚è·³åŠ¨"></a>å­—èŠ‚è·³åŠ¨</h2><h3 id="36è¿›åˆ¶åŠ æ³•"><a href="#36è¿›åˆ¶åŠ æ³•" class="headerlink" title="36è¿›åˆ¶åŠ æ³•"></a>36è¿›åˆ¶åŠ æ³•</h3><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210321174103.png" alt="å›¾ç‰‡"></p><h4 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><p>36è¿›åˆ¶ç”±0-9ï¼Œa-zï¼Œå…±36ä¸ªå­—ç¬¦è¡¨ç¤ºã€‚</p><p>è¦æ±‚æŒ‰ç…§åŠ æ³•è§„åˆ™è®¡ç®—å‡ºä»»æ„ä¸¤ä¸ª36è¿›åˆ¶æ­£æ•´æ•°çš„å’Œï¼Œå¦‚ 1b + 2x &#x3D; 48  ï¼ˆè§£é‡Šï¼š47+105&#x3D;152ï¼‰ï¼Œ1 + a &#x3D; b ï¼ˆè§£é‡Šï¼š1+10 &#x3D; 11 ï¼‰ , 1z + 1 &#x3D; 20 ï¼ˆè§£é‡Šï¼š71 + 1 &#x3D; 72ï¼‰</p><p>è¦æ±‚ï¼šä¸å…è®¸ä½¿ç”¨å…ˆå°†36è¿›åˆ¶æ•°å­—æ•´ä½“è½¬ä¸º10è¿›åˆ¶ï¼Œç›¸åŠ åå†è½¬å›ä¸º36è¿›åˆ¶çš„åšæ³•</p><h4 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h4><p>è·Ÿ<a href="https://leetcode-cn.com/problems/add-strings/">LC415. å­—ç¬¦ä¸²ç›¸åŠ </a>åšæ³•ç±»ä¼¼ï¼ŒæŒæ¡åè¿›åˆ¶çš„å¤§æ•´æ•°åŠ æ³•åï¼Œæœ¬é¢˜åªéœ€è¦æ³¨æ„å°†<code>10</code>å˜æˆ<code>36</code>ï¼Œä»¥åŠ36è¿›åˆ¶å­—ç¬¦ä¸æ•°å€¼çš„è½¬æ¢ã€‚è¿™é‡Œä½¿ç”¨<code>getChar(int n)</code>å’Œ<code>getInt(char c)</code>ä¸¤ä¸ªè¾…åŠ©å‡½æ•°æ¥å®Œæˆ36è¿›åˆ¶å­—ç¬¦ä¸æ•°å€¼çš„è½¬æ¢ã€‚</p><h4 id="å‚è€ƒä»£ç "><a href="#å‚è€ƒä»£ç " class="headerlink" title="å‚è€ƒä»£ç "></a>å‚è€ƒä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Add36Strings</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">add36Strings</span><span class="params">(String num1, String num2)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n1</span> <span class="operator">=</span> num1.length(), n2 = num2.length();</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">res</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> n1 - <span class="number">1</span>, j = n2 - <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">carry</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &gt;= <span class="number">0</span> || j &gt;= <span class="number">0</span> || carry != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                x = getInt(num1.charAt(i));</span><br><span class="line">                i--;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (j &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                y = getInt(num2.charAt(j));</span><br><span class="line">                j--;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> x + y + carry;</span><br><span class="line">            res.append(getChar(sum % <span class="number">36</span>));</span><br><span class="line">            carry = sum / <span class="number">36</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res.reverse().toString();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†å­—ç¬¦è½¬æ¢ä¸ºæ•°å­—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">getInt</span><span class="params">(<span class="type">char</span> c)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (c &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; c &lt;= <span class="string">&#x27;9&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> c - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> c - <span class="string">&#x27;a&#x27;</span> + <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†æ•°å­—è½¬æ¢ä¸ºå­—ç¬¦</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">char</span> <span class="title function_">getChar</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (n &lt;= <span class="number">9</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="type">char</span>) (n + <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="type">char</span>) (n - <span class="number">10</span> + <span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Add36Strings</span> <span class="variable">add36Strings</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Add36Strings</span>();</span><br><span class="line">        add36Strings.add36Strings(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;a&quot;</span>);</span><br><span class="line">        add36Strings.add36Strings(<span class="string">&quot;1b&quot;</span>, <span class="string">&quot;2x&quot;</span>);</span><br><span class="line">        add36Strings.add36Strings(<span class="string">&quot;1z&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>02è®²</title>
      <link href="/posts/8f3bbd6e.html"/>
      <url>/posts/8f3bbd6e.html</url>
      
        <content type="html"><![CDATA[<hr><h3 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><h4 id="æ€ç»´å¯¼å›¾"><a href="#æ€ç»´å¯¼å›¾" class="headerlink" title="æ€ç»´å¯¼å›¾"></a>æ€ç»´å¯¼å›¾</h4><p>ä¸ºäº†è®©ä½ å¯¹æ•°æ®ç»“æ„å’Œç®—æ³•æœ‰ä¸ªå…¨é¢çš„è®¤è¯†ï¼Œæˆ‘ç”»äº†ä¸€å¼ å›¾ï¼Œé‡Œé¢å‡ ä¹æ¶µç›–äº†æ‰€æœ‰æ•°æ®ç»“æ„å’Œç®—æ³•ä¹¦ç±ä¸­éƒ½ä¼šè®²åˆ°çš„çŸ¥è¯†ç‚¹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210317221223.jpeg" alt="img"></p><h4 id="å¸¸ç”¨çš„æ•°æ®ç»“æ„ä¸ç®—æ³•"><a href="#å¸¸ç”¨çš„æ•°æ®ç»“æ„ä¸ç®—æ³•" class="headerlink" title="å¸¸ç”¨çš„æ•°æ®ç»“æ„ä¸ç®—æ³•"></a>å¸¸ç”¨çš„æ•°æ®ç»“æ„ä¸ç®—æ³•</h4><p>æ‰€ä»¥ï¼Œç»“åˆæˆ‘è‡ªå·±çš„å­¦ä¹ å¿ƒå¾—ï¼Œè¿˜æœ‰è¿™äº›å¹´çš„é¢è¯•ã€å¼€å‘ç»éªŒï¼Œæˆ‘æ€»ç»“äº†<strong>20ä¸ªæœ€å¸¸ç”¨çš„ã€æœ€åŸºç¡€</strong>çš„æ•°æ®ç»“æ„ä¸ç®—æ³•ï¼Œ<strong>ä¸ç®¡æ˜¯åº”ä»˜é¢è¯•è¿˜æ˜¯å·¥ä½œéœ€è¦ï¼Œåªè¦é›†ä¸­ç²¾åŠ›é€ä¸€æ”»å…‹è¿™20ä¸ªçŸ¥è¯†ç‚¹å°±è¶³å¤Ÿäº†ã€‚</strong></p><p>è¿™é‡Œé¢æœ‰ 10 ä¸ªæ•°æ®ç»“æ„ï¼š<strong>æ•°ç»„ã€é“¾è¡¨ã€æ ˆã€é˜Ÿåˆ—ã€æ•£åˆ—è¡¨ã€äºŒå‰æ ‘ã€å †ã€è·³è¡¨ã€å›¾ã€Trie æ ‘</strong>ï¼›10 ä¸ªç®—æ³•ï¼š<strong>é€’å½’ã€æ’åºã€äºŒåˆ†æŸ¥æ‰¾ã€æœç´¢ã€å“ˆå¸Œç®—æ³•ã€è´ªå¿ƒç®—æ³•ã€åˆ†æ²»ç®—æ³•ã€å›æº¯ç®—æ³•ã€åŠ¨æ€è§„åˆ’ã€å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•</strong>ã€‚</p><p>åœ¨å­¦ä¹ æ•°æ®ç»“æ„å’Œç®—æ³•çš„è¿‡ç¨‹ä¸­ï¼Œä½ ä¹Ÿè¦æ³¨æ„ï¼Œä¸è¦åªæ˜¯æ­»è®°ç¡¬èƒŒï¼Œä¸è¦ä¸ºäº†å­¦ä¹ å’Œå­¦ä¹ ï¼Œè€Œæ˜¯**è¦å­¦ä¹ å®ƒçš„â€œæ¥å†â€ â€œè‡ªèº«çš„ç‰¹ç‚¹â€ â€œé€‚åˆè§£å†³çš„é—®é¢˜â€ ä»¥åŠ â€œå®é™…çš„åº”ç”¨åœºæ™¯â€ ** ã€‚</p><h3 id="ä¸€äº›å¯ä»¥è®©ä½ äº‹åŠåŠŸå€çš„å­¦ä¹ æŠ€å·§"><a href="#ä¸€äº›å¯ä»¥è®©ä½ äº‹åŠåŠŸå€çš„å­¦ä¹ æŠ€å·§" class="headerlink" title="ä¸€äº›å¯ä»¥è®©ä½ äº‹åŠåŠŸå€çš„å­¦ä¹ æŠ€å·§"></a>ä¸€äº›å¯ä»¥è®©ä½ äº‹åŠåŠŸå€çš„å­¦ä¹ æŠ€å·§</h3><h4 id="1-è¾¹å­¦è¾¹ç»ƒï¼Œé€‚åº¦åˆ·é¢˜"><a href="#1-è¾¹å­¦è¾¹ç»ƒï¼Œé€‚åº¦åˆ·é¢˜" class="headerlink" title="1.è¾¹å­¦è¾¹ç»ƒï¼Œé€‚åº¦åˆ·é¢˜"></a>1.è¾¹å­¦è¾¹ç»ƒï¼Œé€‚åº¦åˆ·é¢˜</h4><h4 id="2-å¤šé—®ã€å¤šæ€è€ƒã€å¤šäº’åŠ¨"><a href="#2-å¤šé—®ã€å¤šæ€è€ƒã€å¤šäº’åŠ¨" class="headerlink" title="2.å¤šé—®ã€å¤šæ€è€ƒã€å¤šäº’åŠ¨"></a>2.å¤šé—®ã€å¤šæ€è€ƒã€å¤šäº’åŠ¨</h4><h4 id="3-æ‰“æ€ªå‡çº§å­¦ä¹ æ³•"><a href="#3-æ‰“æ€ªå‡çº§å­¦ä¹ æ³•" class="headerlink" title="3.æ‰“æ€ªå‡çº§å­¦ä¹ æ³•"></a>3.æ‰“æ€ªå‡çº§å­¦ä¹ æ³•</h4><p><strong>å­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç¢°åˆ°æœ€å¤§çš„é—®é¢˜å°±æ˜¯ï¼ŒåšæŒä¸ä¸‹æ¥ã€‚</strong></p><p>æ‰€ä»¥ï¼Œ<strong>æˆ‘ä»¬åœ¨æ¯ç‡¥çš„å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œä¹Ÿå¯ä»¥ç»™è‡ªå·±è®¾ç«‹ä¸€ä¸ªåˆ‡å®å¯è¡Œçš„ç›®æ ‡</strong>ï¼Œå°±åƒæ‰“æ€ªå‡çº§ä¸€æ ·ã€‚</p><h4 id="4-åªæ˜¯éœ€è¦æ²‰æ·€ï¼Œä¸è¦æƒ³è¯•å›¾ä¸€ä¸‹å­æŒæ¡æ‰€æœ‰"><a href="#4-åªæ˜¯éœ€è¦æ²‰æ·€ï¼Œä¸è¦æƒ³è¯•å›¾ä¸€ä¸‹å­æŒæ¡æ‰€æœ‰" class="headerlink" title="4.åªæ˜¯éœ€è¦æ²‰æ·€ï¼Œä¸è¦æƒ³è¯•å›¾ä¸€ä¸‹å­æŒæ¡æ‰€æœ‰"></a>4.åªæ˜¯éœ€è¦æ²‰æ·€ï¼Œä¸è¦æƒ³è¯•å›¾ä¸€ä¸‹å­æŒæ¡æ‰€æœ‰</h4><p>åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œä¸€å®šä¼šç¢°åˆ°â€œæ‹¦è·¯è™â€ã€‚å¦‚æœå“ªä¸ªçŸ¥è¯†ç‚¹æ²¡æœ‰æ€ä¹ˆå­¦æ‡‚ï¼Œä¸è¦ç€æ€¥ï¼Œè¿™æ˜¯æ­£å¸¸çš„ã€‚å› ä¸ºï¼Œæƒ³å¬ä¸€éã€çœ‹ä¸€éå°±æŠŠæ‰€æœ‰çŸ¥è¯†æŒæ¡ï¼Œè¿™è‚¯å®šæ˜¯ä¸å¯èƒ½çš„ã€‚<strong>å­¦ä¹ çŸ¥è¯†çš„è¿‡ç¨‹æ˜¯åå¤è¿­ä»£ã€ä¸æ–­æ²‰æ·€çš„è¿‡ç¨‹</strong>ã€‚</p><h3 id="ç•™è¨€åŒºä¼˜ç§€æ€»ç»“"><a href="#ç•™è¨€åŒºä¼˜ç§€æ€»ç»“" class="headerlink" title="ç•™è¨€åŒºä¼˜ç§€æ€»ç»“"></a>ç•™è¨€åŒºä¼˜ç§€æ€»ç»“</h3><h4 id="æ˜¯ä»€ä¹ˆï¼š"><a href="#æ˜¯ä»€ä¹ˆï¼š" class="headerlink" title="æ˜¯ä»€ä¹ˆï¼š"></a>æ˜¯ä»€ä¹ˆï¼š</h4><p>æ•°æ®ç»“æ„æŒ‡çš„æ˜¯â€œä¸€ç»„æ•°æ®çš„å­˜å‚¨ç»“æ„â€ï¼Œç®—æ³•æŒ‡çš„æ˜¯â€œæ“ä½œæ•°æ®çš„ä¸€ç»„æ–¹æ³•â€ã€‚<br>æ•°æ®ç»“æ„æ˜¯ä¸ºç®—æ³•æœåŠ¡çš„ï¼Œç®—æ³•æ˜¯è¦ä½œç”¨å†ç‰¹å®šçš„æ•°æ®ç»“æ„ä¸Šçš„ã€‚</p><h4 id="å­¦ä»€ä¹ˆï¼š"><a href="#å­¦ä»€ä¹ˆï¼š" class="headerlink" title="å­¦ä»€ä¹ˆï¼š"></a>å­¦ä»€ä¹ˆï¼š</h4><ol><li>æ•ˆç‡å’Œèµ„æºæ¶ˆè€—çš„åº¦é‡è¡¡â€“å¤æ‚åº¦åˆ†æã€‚</li><li>æœ€å¸¸ç”¨ã€æœ€åŸºç¡€çš„20ä¸ªæ•°æ®ç»“æ„ä¸ç®—æ³•ï¼Œå­¦ä¹ ä»–ä»¬çš„ï¼šâ€œæ¥å†â€ã€â€œç‰¹ç‚¹â€ã€â€œé€‚åˆè§£å†³ä»€ä¹ˆé—®é¢˜â€å’Œâ€œå®é™…çš„åº”ç”¨åœºæ™¯â€ã€‚10ä¸ªæ•°æ®ç»“æ„ï¼š<strong>æ•°ç»„ã€é“¾è¡¨ã€æ ˆã€é˜Ÿåˆ—ã€æ•£åˆ—è¡¨ã€äºŒå‰æ ‘â€˜ã€å †ã€è·³è¡¨ã€å›¾ã€Trieæ ‘</strong>ï¼›10ä¸ªç®—æ³•ï¼š <strong>é€’å½’ã€æ’åºã€äºŒåˆ†æŸ¥æ‰¾ã€æœç´¢ã€å“ˆå¸Œç®—æ³•ã€è´ªå¿ƒç®—æ³•ã€åˆ†æ²»ç®—æ³•ã€å›æº¯ç®—æ³•ã€åŠ¨æ€è§„åˆ’ã€å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•</strong>ã€‚</li></ol><h4 id="æ€ä¹ˆå­¦ï¼š"><a href="#æ€ä¹ˆå­¦ï¼š" class="headerlink" title="æ€ä¹ˆå­¦ï¼š"></a>æ€ä¹ˆå­¦ï¼š</h4><ol><li>è¾¹å­¦è¾¹ç»ƒï¼Œæ¯å‘¨èŠ± 1~2 å°æ—¶é›†ä¸­æ”»å…³ä¸‰èŠ‚è¯¾æ¶‰åŠçš„æ•°æ®ç»“æ„å’Œç®—æ³•ï¼Œå…¨éƒ¨å†™å‡ºæ¥ã€‚</li><li>ä¸»åŠ¨æé—®ã€å¤šæ€è€ƒã€å¤šäº’åŠ¨ã€‚åœ¨ç•™è¨€åŒºå¢åŠ è‡ªå·±çš„ç•™è¨€ã€‚</li><li>è‡ªæˆ‘æ¿€åŠ±ï¼Œæ¯æ¬¡å­¦ä¹ å®Œåšä¸€ç¯‡å­¦ä¹ ç¬”è®°ã€‚</li><li>æ²‰ä¸‹å¿ƒä¸è¦æµ®èºï¼Œå…ˆæŠŠè¿™äº›åŸºç¡€çš„æ•°æ®ç»“æ„å’Œç®—æ³•ï¼Œè¿˜æœ‰å­¦ä¹ æ–¹æ³•ç†Ÿç»ƒæŒæ¡åï¼Œå†è¿½æ±‚æ›´é«˜å±‚æ¬¡ã€‚</li></ol><hr><p>flagï¼šæ¯ç¯‡æ–‡ç« å¿…å†™å­¦ä¹ ç¬”è®°ï¼Œæ¯å‘¨å¿…å®ç°ä¸€æ¬¡è¯¥å‘¨ä»£ç ã€‚</p><h3 id="å­¦ä¹ å·¥å…·"><a href="#å­¦ä¹ å·¥å…·" class="headerlink" title="å­¦ä¹ å·¥å…·"></a>å­¦ä¹ å·¥å…·</h3><p><a href="https://www.cs.usfca.edu/~galles/visualization/Algorithms.html">https://www.cs.usfca.edu/~galles/visualization/Algorithms.html</a><br>æ­¤ç½‘ç«™å¯ä»¥å°†æŒ‡å®šç®—æ³•å¯è§†åŒ–ï¼Œèƒ½æ–¹ä¾¿ç†è§£ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬äºŒå‘¨</title>
      <link href="/posts/aae4713d.html"/>
      <url>/posts/aae4713d.html</url>
      
        <content type="html"><![CDATA[<hr><p>æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾æ¯å‘¨æ‰“å¡ 2021.03.15-2021.03.21</p><h3 id="Leetcode-206-åè½¬é“¾è¡¨"><a href="#Leetcode-206-åè½¬é“¾è¡¨" class="headerlink" title="Leetcode 206. åè½¬é“¾è¡¨"></a><a href="https://leetcode-cn.com/problems/reverse-linked-list/">Leetcode 206. åè½¬é“¾è¡¨</a></h3><p>åè½¬ä¸€ä¸ªå•é“¾è¡¨ã€‚</p><p><strong>ç¤ºä¾‹:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: 1-&gt;2-&gt;3-&gt;4-&gt;5-&gt;NULL</span><br><span class="line">è¾“å‡º: 5-&gt;4-&gt;3-&gt;2-&gt;1-&gt;NULL</span><br></pre></td></tr></table></figure><p><strong>è¿›é˜¶:</strong><br>ä½ å¯ä»¥è¿­ä»£æˆ–é€’å½’åœ°åè½¬é“¾è¡¨ã€‚ä½ èƒ½å¦ç”¨ä¸¤ç§æ–¹æ³•è§£å†³è¿™é“é¢˜ï¼Ÿ</p><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><h5 id="è¿­ä»£æ³•ï¼š"><a href="#è¿­ä»£æ³•ï¼š" class="headerlink" title="è¿­ä»£æ³•ï¼š"></a>è¿­ä»£æ³•ï¼š</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">reverseList</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">         <span class="type">ListNode</span> <span class="variable">pre</span> <span class="operator">=</span> <span class="literal">null</span>, cur = head;</span><br><span class="line">         <span class="keyword">while</span> (cur != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">ListNode</span> <span class="variable">next</span> <span class="operator">=</span> cur.next;</span><br><span class="line">            cur.next = pre;</span><br><span class="line">            pre = cur;</span><br><span class="line">            cur = next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pre;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="é€’å½’ï¼š"><a href="#é€’å½’ï¼š" class="headerlink" title="é€’å½’ï¼š"></a>é€’å½’ï¼š</h5><p><strong>é€’å½’ç¼–ç¨‹çš„ä¸‰ä¸ªæ¡ä»¶</strong>ï¼š</p><ol><li>å¤§é—®é¢˜æ‹†æˆä¸¤ä¸ªå­é—®é¢˜</li><li>å­é—®é¢˜æ±‚è§£æ–¹å¼å’Œå¤§é—®é¢˜ä¸€æ ·</li><li>å­˜åœ¨æœ€å°å­é—®é¢˜</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">reverseList</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="comment">/* é€’å½’ç»ˆæ­¢æ¡ä»¶ï¼š</span></span><br><span class="line"><span class="comment">         * 1. head==nullé“¾è¡¨ä¸ºç©ºï¼Œä¸éœ€è¦åè½¬</span></span><br><span class="line"><span class="comment">         * 2. head.next==nullåªå‰©ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™ï¼Œä¹Ÿä¸éœ€è¦åè½¬</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">null</span> || head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> head;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">newHead</span> <span class="operator">=</span> reverseList(head.next);</span><br><span class="line">        head.next.next = head;</span><br><span class="line">        head.next = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">return</span> newHead;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Leetcode-2-ä¸¤æ•°ç›¸åŠ "><a href="#Leetcode-2-ä¸¤æ•°ç›¸åŠ " class="headerlink" title="Leetcode 2. ä¸¤æ•°ç›¸åŠ "></a><a href="https://leetcode-cn.com/problems/add-two-numbers/">Leetcode 2. ä¸¤æ•°ç›¸åŠ </a></h3><p>ç»™ä½ ä¸¤ä¸ª <strong>éç©º</strong> çš„é“¾è¡¨ï¼Œè¡¨ç¤ºä¸¤ä¸ªéè´Ÿçš„æ•´æ•°ã€‚å®ƒä»¬æ¯ä½æ•°å­—éƒ½æ˜¯æŒ‰ç…§ <strong>é€†åº</strong> çš„æ–¹å¼å­˜å‚¨çš„ï¼Œå¹¶ä¸”æ¯ä¸ªèŠ‚ç‚¹åªèƒ½å­˜å‚¨ <strong>ä¸€ä½</strong> æ•°å­—ã€‚</p><p>è¯·ä½ å°†ä¸¤ä¸ªæ•°ç›¸åŠ ï¼Œå¹¶ä»¥ç›¸åŒå½¢å¼è¿”å›ä¸€ä¸ªè¡¨ç¤ºå’Œçš„é“¾è¡¨ã€‚</p><p>ä½ å¯ä»¥å‡è®¾é™¤äº†æ•°å­— 0 ä¹‹å¤–ï¼Œè¿™ä¸¤ä¸ªæ•°éƒ½ä¸ä¼šä»¥ 0 å¼€å¤´ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210316155523.jpeg" alt="img"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šl1 = [2,4,3], l2 = [5,6,4]</span><br><span class="line">è¾“å‡ºï¼š[7,0,8]</span><br><span class="line">è§£é‡Šï¼š342 + 465 = 807.</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šl1 = [0], l2 = [0]</span><br><span class="line">è¾“å‡ºï¼š[0]</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šl1 = [9,9,9,9,9,9,9], l2 = [9,9,9,9]</span><br><span class="line">è¾“å‡ºï¼š[8,9,9,9,0,0,0,1]</span><br></pre></td></tr></table></figure><p> <strong>æç¤ºï¼š</strong></p><ul><li>æ¯ä¸ªé“¾è¡¨ä¸­çš„èŠ‚ç‚¹æ•°åœ¨èŒƒå›´ <code>[1, 100]</code> å†…</li><li><code>0 &lt;= Node.val &lt;= 9</code></li><li>é¢˜ç›®æ•°æ®ä¿è¯åˆ—è¡¨è¡¨ç¤ºçš„æ•°å­—ä¸å«å‰å¯¼é›¶</li></ul><h4 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">addTwoNumbers</span><span class="params">(ListNode l1, ListNode l2)</span> &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">dummyNode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(-<span class="number">1</span>);</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">head</span> <span class="operator">=</span> dummyNode;</span><br><span class="line">        <span class="type">int</span> <span class="variable">carry</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// å¦‚æœl1æˆ–l2ä¸ä¸ºç©ºæˆ–è€…è¿›ä½ä¸º1ï¼Œåˆ™ç»§ç»­å¾ªç¯</span></span><br><span class="line">        <span class="keyword">while</span> (l1 != <span class="literal">null</span> || l2 != <span class="literal">null</span> || carry != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> carry;</span><br><span class="line">            <span class="comment">// ä¸ä¸ºç©ºåˆ™sumåŠ ä¸Šè¿™ä¸ªå€¼ï¼ŒåŒæ—¶æŒ‡é’ˆå¾€ä¸‹èµ°</span></span><br><span class="line">            <span class="keyword">if</span> (l1 != <span class="literal">null</span>) &#123;</span><br><span class="line">                sum += l1.val;</span><br><span class="line">                l1 = l1.next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (l2 != <span class="literal">null</span>) &#123;</span><br><span class="line">                sum += l2.val;</span><br><span class="line">                l2 = l2.next;</span><br><span class="line">            &#125;</span><br><span class="line">            head.next = <span class="keyword">new</span> <span class="title class_">ListNode</span>(sum % <span class="number">10</span>);</span><br><span class="line">            head = head.next;</span><br><span class="line">            carry = sum / <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dummyNode.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ </tag>
            
            <tag> æ¯å‘¨æ‰“å¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬ä¸€å‘¨</title>
      <link href="/posts/9af29de5.html"/>
      <url>/posts/9af29de5.html</url>
      
        <content type="html"><![CDATA[<hr><p>æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾æ¯å‘¨æ‰“å¡ 2021.03.08-2021.03.14</p><h3 id="é¢è¯•é¢˜-01-03-URLåŒ–"><a href="#é¢è¯•é¢˜-01-03-URLåŒ–" class="headerlink" title="é¢è¯•é¢˜ 01.03. URLåŒ–"></a><a href="https://leetcode-cn.com/problems/string-to-url-lcci/">é¢è¯•é¢˜ 01.03. URLåŒ–</a></h3><p>URLåŒ–ã€‚ç¼–å†™ä¸€ç§æ–¹æ³•ï¼Œå°†å­—ç¬¦ä¸²ä¸­çš„ç©ºæ ¼å…¨éƒ¨æ›¿æ¢ä¸º<code>%20</code>ã€‚å‡å®šè¯¥å­—ç¬¦ä¸²å°¾éƒ¨æœ‰è¶³å¤Ÿçš„ç©ºé—´å­˜æ”¾æ–°å¢å­—ç¬¦ï¼Œå¹¶ä¸”çŸ¥é“å­—ç¬¦ä¸²çš„â€œçœŸå®â€é•¿åº¦ã€‚ï¼ˆæ³¨ï¼šç”¨<code>Java</code>å®ç°çš„è¯ï¼Œè¯·ä½¿ç”¨å­—ç¬¦æ•°ç»„å®ç°ï¼Œä»¥ä¾¿ç›´æ¥åœ¨æ•°ç»„ä¸Šæ“ä½œã€‚ï¼‰</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼š&quot;Mr John Smith    &quot;, 13</span><br><span class="line">è¾“å‡ºï¼š&quot;Mr%20John%20Smith&quot;</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼š&quot;               &quot;, 5</span><br><span class="line">è¾“å‡ºï¼š&quot;%20%20%20%20%20&quot;</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li>å­—ç¬¦ä¸²é•¿åº¦åœ¨ [0, 500000] èŒƒå›´å†…ã€‚</li></ul><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">replaceSpaces</span><span class="params">(String S, <span class="type">int</span> length)</span> &#123;</span><br><span class="line">        <span class="type">char</span>[] chs = S.toCharArray();</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> length - <span class="number">1</span>, j = S.length() - <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// ä»å³å¾€å‰èµ°ï¼ŒæŠŠå·¦è¾¹çš„çš„å­—ç¬¦ä¸²æ‹·è´åˆ°å³è¾¹</span></span><br><span class="line">        <span class="keyword">while</span> (i &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (chs[i] == <span class="string">&#x27; &#x27;</span>) &#123;</span><br><span class="line">                chs[j--] = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">                chs[j--] = <span class="string">&#x27;2&#x27;</span>;</span><br><span class="line">                chs[j--] = <span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                chs[j--] = chs[i];</span><br><span class="line">            &#125;</span><br><span class="line">            i--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æœ€åå–æ‹·è´å®Œä¹‹åçš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯j+1å¼€å§‹ï¼Œå­—ç¬¦ä¸²é•¿åº¦å‡å»j+1</span></span><br><span class="line">        <span class="keyword">return</span> String.valueOf(chs, j + <span class="number">1</span>, S.length() - j - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1528-é‡æ–°æ’åˆ—å­—ç¬¦ä¸²"><a href="#1528-é‡æ–°æ’åˆ—å­—ç¬¦ä¸²" class="headerlink" title="1528. é‡æ–°æ’åˆ—å­—ç¬¦ä¸²"></a><a href="https://leetcode-cn.com/problems/shuffle-string/">1528. é‡æ–°æ’åˆ—å­—ç¬¦ä¸²</a></h3><p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² <code>s</code> å’Œä¸€ä¸ª <strong>é•¿åº¦ç›¸åŒ</strong> çš„æ•´æ•°æ•°ç»„ <code>indices</code> ã€‚</p><p>è¯·ä½ é‡æ–°æ’åˆ—å­—ç¬¦ä¸² <code>s</code> ï¼Œå…¶ä¸­ç¬¬ <code>i</code> ä¸ªå­—ç¬¦éœ€è¦ç§»åŠ¨åˆ° <code>indices[i]</code> æŒ‡ç¤ºçš„ä½ç½®ã€‚</p><p>è¿”å›é‡æ–°æ’åˆ—åçš„å­—ç¬¦ä¸²ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210322161725.jpeg" alt="img"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot;codeleet&quot;, indices = [4,5,6,7,0,2,1,3]</span><br><span class="line">è¾“å‡ºï¼š&quot;leetcode&quot;</span><br><span class="line">è§£é‡Šï¼šå¦‚å›¾æ‰€ç¤ºï¼Œ&quot;codeleet&quot; é‡æ–°æ’åˆ—åå˜ä¸º &quot;leetcode&quot; ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot;abc&quot;, indices = [0,1,2]</span><br><span class="line">è¾“å‡ºï¼š&quot;abc&quot;</span><br><span class="line">è§£é‡Šï¼šé‡æ–°æ’åˆ—åï¼Œæ¯ä¸ªå­—ç¬¦éƒ½è¿˜ç•™åœ¨åŸæ¥çš„ä½ç½®ä¸Šã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot;aiohn&quot;, indices = [3,1,4,2,0]</span><br><span class="line">è¾“å‡ºï¼š&quot;nihao&quot;</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 4ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot;aaiougrt&quot;, indices = [4,0,2,6,7,3,1,5]</span><br><span class="line">è¾“å‡ºï¼š&quot;arigatou&quot;</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 5ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot;art&quot;, indices = [1,0,2]</span><br><span class="line">è¾“å‡ºï¼š&quot;rat&quot;</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>s.length == indices.length == n</code></li><li><code>1 &lt;= n &lt;= 100</code></li><li><code>s</code> ä»…åŒ…å«å°å†™è‹±æ–‡å­—æ¯ã€‚</li><li><code>0 &lt;= indices[i] &lt; n</code></li><li><code>indices</code> çš„æ‰€æœ‰çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>indices</code> æ˜¯æ•´æ•° <code>0</code> åˆ° <code>n - 1</code> å½¢æˆçš„ä¸€ç»„æ’åˆ—ï¼‰ã€‚</li></ul><h4 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">restoreString</span><span class="params">(String s, <span class="type">int</span>[] indices)</span> &#123;</span><br><span class="line">       <span class="type">char</span>[] res = <span class="keyword">new</span> <span class="title class_">char</span>[s.length()];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">            res[indices[i]] = s.charAt(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> String.valueOf(res);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ </tag>
            
            <tag> æ¯å‘¨æ‰“å¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼åˆæ¢</title>
      <link href="/posts/74108e1f.html"/>
      <url>/posts/74108e1f.html</url>
      
        <content type="html"><![CDATA[<hr><h3 id="è®¾è®¡æ¨¡å¼åŸåˆ™"><a href="#è®¾è®¡æ¨¡å¼åŸåˆ™" class="headerlink" title="è®¾è®¡æ¨¡å¼åŸåˆ™"></a>è®¾è®¡æ¨¡å¼åŸåˆ™</h3><p>é¢å‘å¯¹è±¡çš„è®¾è®¡æ¨¡å¼æœ‰ä¸ƒå¤§åŸºæœ¬åŸåˆ™ï¼š</p><ul><li>å¼€é—­åŸåˆ™ï¼ˆOpen Closed Principleï¼ŒOCPï¼‰</li><li>å•ä¸€èŒè´£åŸåˆ™ï¼ˆSingle Responsibility Principle, SRPï¼‰</li><li>é‡Œæ°ä»£æ¢åŸåˆ™ï¼ˆLiskov Substitution Principleï¼ŒLSPï¼‰</li><li>ä¾èµ–å€’è½¬åŸåˆ™ï¼ˆDependency Inversion Principleï¼ŒDIPï¼‰</li><li>æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface Segregation Principleï¼ŒISPï¼‰</li><li>åˆæˆ&#x2F;èšåˆå¤ç”¨åŸåˆ™ï¼ˆComposite&#x2F;Aggregate Reuse Principleï¼ŒCARPï¼‰</li><li>æœ€å°‘çŸ¥è¯†åŸåˆ™ï¼ˆLeast Knowledge Principleï¼ŒLKPï¼‰æˆ–è€…è¿ªç±³ç‰¹æ³•åˆ™ï¼ˆLaw of Demeterï¼ŒLODï¼‰</li></ul><p>ç®€å•ç†è§£å°±æ˜¯ï¼š<strong>å¼€é—­åŸåˆ™æ˜¯æ€»çº²</strong>ï¼Œå®ƒæŒ‡å¯¼æˆ‘ä»¬è¦å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼›å•ä¸€èŒè´£åŸåˆ™æŒ‡å¯¼æˆ‘ä»¬å®ç°ç±»è¦èŒè´£å•ä¸€ï¼›é‡Œæ°æ›¿æ¢åŸåˆ™æŒ‡å¯¼æˆ‘ä»¬ä¸è¦ç ´åç»§æ‰¿ä½“ç³»ï¼›ä¾èµ–å€’ç½®åŸåˆ™æŒ‡å¯¼æˆ‘ä»¬è¦é¢å‘æ¥å£ç¼–ç¨‹ï¼›æ¥å£éš”ç¦»åŸåˆ™æŒ‡å¯¼æˆ‘ä»¬åœ¨è®¾è®¡æ¥å£çš„æ—¶å€™è¦ç²¾ç®€å•ä¸€ï¼›è¿ªç±³ç‰¹æ³•åˆ™æŒ‡å¯¼æˆ‘ä»¬è¦é™ä½è€¦åˆã€‚</p><span id="more"></span><h3 id="å·¥å‚æ¨¡å¼-Factory-Method-Pattern"><a href="#å·¥å‚æ¨¡å¼-Factory-Method-Pattern" class="headerlink" title="å·¥å‚æ¨¡å¼ Factory Method Pattern"></a>å·¥å‚æ¨¡å¼ Factory Method Pattern</h3><p><strong>æ¨¡å¼ï¼šå·¥å‚æ¨¡å¼</strong></p><blockquote><p>å·¥å‚æ¨¡å¼åˆç»†åˆ†ä¸ºå·¥å‚æ–¹æ³•æ¨¡å¼å’ŒæŠ½è±¡å·¥å‚æ¨¡å¼ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»å·¥å‚æ–¹æ³•æ¨¡å¼ã€‚</p></blockquote><p><strong>æ¨¡å¼å®šä¹‰</strong>ï¼šå®šä¹‰ä¸€ä¸ªç”¨äºåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸€ä¸ªç±»ã€‚å·¥å‚æ–¹æ³•æ˜¯ä¸€ä¸ªç±»çš„å®ä¾‹åŒ–å»¶è¿Ÿåˆ°å…¶å­ç±»ã€‚</p><p>å·¥å‚æ¨¡å¼é€šç”¨ç±»å›¾å¦‚ä¸‹:</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210301205001.png" alt="å›¾ç‰‡"></p><p>æˆ‘ä»¬é€šè¿‡ä¸€æ®µè¾ƒä¸ºé€šç”¨çš„ä»£ç æ¥è§£é‡Šå¦‚ä½•ä½¿ç”¨å·¥å‚æ¨¡å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æŠ½è±¡çš„äº§å“</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªå…·ä½“çš„äº§å“ (å¯ä»¥å®šä¹‰å¤šä¸ªå…·ä½“çš„äº§å“)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProductA</span> <span class="keyword">extends</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> &#123;&#125;  <span class="comment">//å…·ä½“çš„æ‰§è¡Œé€»è¾‘</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æŠ½è±¡çš„å·¥å‚</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Factory</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">abstract</span> Product <span class="title function_">createProduct</span><span class="params">(Class&lt;T&gt; c)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å…·ä½“çš„å·¥å‚å¯ä»¥ç”Ÿäº§å‡ºç›¸åº”çš„äº§å“</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FactoryA</span> <span class="keyword">extends</span> <span class="title class_">Factory</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    Product <span class="title function_">createProduct</span><span class="params">(Class c)</span> &#123;</span><br><span class="line">        <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> (Product) Class.forName(c.getName()).newInstance();</span><br><span class="line">        <span class="keyword">return</span> product;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç­–ç•¥æ¨¡å¼-Strategy-Pattern"><a href="#ç­–ç•¥æ¨¡å¼-Strategy-Pattern" class="headerlink" title="ç­–ç•¥æ¨¡å¼ Strategy Pattern"></a>ç­–ç•¥æ¨¡å¼ Strategy Pattern</h3><p><strong>æ¨¡å¼ï¼šç­–ç•¥æ¨¡å¼</strong></p><p><strong>æ¨¡å¼å®šä¹‰</strong>ï¼šå®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼Œå°†æ¯ä¸ªç®—æ³•éƒ½å°è£…èµ·æ¥ï¼Œå¹¶ä¸”å®ƒä»¬å¯ä»¥äº’æ¢ã€‚ç­–ç•¥æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡è¡Œä¸ºæ¨¡å¼ã€‚</p><p>ç­–ç•¥æ¨¡å¼é€šç”¨ç±»å›¾å¦‚ä¸‹:</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210301205021.png" alt="å›¾ç‰‡"></p><p>æˆ‘ä»¬é€šè¿‡ä¸€æ®µæ¯”è¾ƒé€šç”¨çš„ä»£ç æ¥è§£é‡Šæ€ä¹ˆä½¿ç”¨ç­–ç•¥æ¨¡å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªç­–ç•¥æ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Strategy</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">strategyImplementation</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å…·ä½“çš„ç­–ç•¥å®ç°(å¯ä»¥å®šä¹‰å¤šä¸ªå…·ä½“çš„ç­–ç•¥å®ç°)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StrategyA</span> <span class="keyword">implements</span> <span class="title class_">Strategy</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">strategyImplementation</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ­£åœ¨æ‰§è¡Œç­–ç•¥A&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å°è£…ç­–ç•¥ï¼Œå±è”½é«˜å±‚æ¨¡å—å¯¹ç­–ç•¥ã€ç®—æ³•çš„ç›´æ¥è®¿é—®ï¼Œå±è”½å¯èƒ½å­˜åœ¨çš„ç­–ç•¥å˜åŒ–</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Context</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Strategy</span> <span class="variable">strategy</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Context</span><span class="params">(Strategy strategy)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.strategy = strategy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doStrategy</span><span class="params">()</span> &#123;</span><br><span class="line">        strategy.strategyImplementation();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="çŠ¶æ€æ¨¡å¼-State-Pattern"><a href="#çŠ¶æ€æ¨¡å¼-State-Pattern" class="headerlink" title="çŠ¶æ€æ¨¡å¼ State Pattern"></a>çŠ¶æ€æ¨¡å¼ State Pattern</h3><p><strong>æ¨¡å¼ï¼šçŠ¶æ€æ¨¡å¼</strong></p><p><strong>æ¨¡å¼å®šä¹‰</strong>ï¼šå½“ä¸€ä¸ªå¯¹è±¡å†…åœ¨çŠ¶æ€æ”¹å˜æ—¶å…è®¸å…¶æ”¹å˜è¡Œä¸ºï¼Œè¿™ä¸ªå¯¹è±¡çœ‹èµ·æ¥åƒæ”¹å˜äº†å…¶ç±»ã€‚</p><p>çŠ¶æ€æ¨¡å¼çš„é€šç”¨ç±»å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210301205104.webp" alt="å›¾ç‰‡"></p><p>å¯¹æ¯”ç­–ç•¥æ¨¡å¼çš„ç±»å‹ä¼šå‘ç°å’ŒçŠ¶æ€æ¨¡å¼çš„ç±»å›¾å¾ˆç±»ä¼¼ï¼Œä½†å®é™…ä¸Šæœ‰å¾ˆå¤§çš„åŒºåˆ«ï¼Œå…·ä½“ä½“ç°åœ¨concrete classä¸Šã€‚ç­–ç•¥æ¨¡å¼é€šè¿‡Contextäº§ç”Ÿå”¯ä¸€ä¸€ä¸ªConcreteStrategyä½œç”¨äºä»£ç ä¸­ï¼Œè€ŒçŠ¶æ€æ¨¡å¼åˆ™æ˜¯é€šè¿‡contextç»„ç»‡å¤šä¸ªConcreteStateå½¢æˆä¸€ä¸ªçŠ¶æ€è½¬æ¢å›¾æ¥å®ç°ä¸šåŠ¡é€»è¾‘ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€æ®µé€šç”¨ä»£ç æ¥è§£é‡Šæ€ä¹ˆä½¿ç”¨çŠ¶æ€æ¨¡å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªæŠ½è±¡çš„çŠ¶æ€ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">State</span> &#123;</span><br><span class="line">    Context context;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setContext</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.context = context;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">handle1</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">handle2</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å®šä¹‰çŠ¶æ€A</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteStateA</span> <span class="keyword">extends</span> <span class="title class_">State</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle1</span><span class="params">()</span> &#123;&#125;  <span class="comment">//æœ¬çŠ¶æ€ä¸‹å¿…é¡»è¦å¤„ç†çš„äº‹æƒ…</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.context.setCurrentState(Context.contreteStateB);  <span class="comment">//åˆ‡æ¢åˆ°çŠ¶æ€B        </span></span><br><span class="line">        <span class="built_in">super</span>.context.handle2();  <span class="comment">//æ‰§è¡ŒçŠ¶æ€Bçš„ä»»åŠ¡</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å®šä¹‰çŠ¶æ€B</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteStateB</span> <span class="keyword">extends</span> <span class="title class_">State</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle2</span><span class="params">()</span> &#123;&#125;  <span class="comment">//æœ¬çŠ¶æ€ä¸‹å¿…é¡»è¦å¤„ç†çš„äº‹æƒ…ï¼Œ...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.context.setCurrentState(Context.contreteStateA);  <span class="comment">//åˆ‡æ¢åˆ°çŠ¶æ€A</span></span><br><span class="line">        <span class="built_in">super</span>.context.handle1();  <span class="comment">//æ‰§è¡ŒçŠ¶æ€Açš„ä»»åŠ¡</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªä¸Šä¸‹æ–‡ç®¡ç†ç¯å¢ƒ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Context</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">ConcreteStateA</span> <span class="variable">contreteStateA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteStateA</span>();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">ConcreteStateB</span> <span class="variable">contreteStateB</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteStateB</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> State CurrentState;</span><br><span class="line">    <span class="keyword">public</span> State <span class="title function_">getCurrentState</span><span class="params">()</span> &#123;<span class="keyword">return</span> CurrentState;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCurrentState</span><span class="params">(State currentState)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.CurrentState = currentState;</span><br><span class="line">        <span class="built_in">this</span>.CurrentState.setContext(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle1</span><span class="params">()</span> &#123;<span class="built_in">this</span>.CurrentState.handle1();&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle2</span><span class="params">()</span> &#123;<span class="built_in">this</span>.CurrentState.handle2();&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å®šä¹‰clientæ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Context</span>();</span><br><span class="line">        context.setCurrentState(<span class="keyword">new</span> <span class="title class_">ContreteStateA</span>());</span><br><span class="line">        context.handle1();</span><br><span class="line">        context.handle2();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è´£ä»»é“¾æ¨¡å¼-Chain-of-Responsibility-Pattern"><a href="#è´£ä»»é“¾æ¨¡å¼-Chain-of-Responsibility-Pattern" class="headerlink" title="è´£ä»»é“¾æ¨¡å¼ Chain of Responsibility Pattern"></a>è´£ä»»é“¾æ¨¡å¼ Chain of Responsibility Pattern</h3><p><strong>æ¨¡å¼ï¼šè´£ä»»é“¾æ¨¡å¼</strong></p><p><strong>æ¨¡å¼å®šä¹‰</strong>ï¼šä½¿å¤šä¸ªå¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚ï¼Œä»è€Œé¿å…äº†è¯·æ±‚çš„å‘é€è€…å’Œæ¥å—è€…ä¹‹é—´çš„è€¦åˆå…³ç³»ã€‚å°†è¿™äº›å¯¹è±¡è¿æˆä¸€æ¡é“¾ï¼Œå¹¶æ²¿ç€è¿™æ¡é“¾ä¼ é€’è¯¥è¯·æ±‚ï¼Œç›´åˆ°æœ‰å¯¹è±¡å¤„ç†å®ƒä¸ºæ­¢ã€‚</p><p>è´£ä»»é“¾æ¨¡å¼é€šç”¨ç±»å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210301214900.png" alt="å›¾ç‰‡"></p><p>æˆ‘ä»¬é€šè¿‡ä¸€æ®µæ¯”è¾ƒé€šç”¨çš„ä»£ç æ¥è§£é‡Šå¦‚ä½•ä½¿ç”¨è´£ä»»é“¾æ¨¡å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªæŠ½è±¡çš„handle</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Handler</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Handler nextHandler;  <span class="comment">//æŒ‡å‘ä¸‹ä¸€ä¸ªå¤„ç†è€…</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> level;  <span class="comment">//å¤„ç†è€…èƒ½å¤Ÿå¤„ç†çš„çº§åˆ«</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Handler</span><span class="params">(<span class="type">int</span> level)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.level = level;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNextHandler</span><span class="params">(Handler handler)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.nextHandler = handler;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤„ç†è¯·æ±‚ä¼ é€’ï¼Œæ³¨æ„finalï¼Œå­ç±»ä¸å¯é‡å†™</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">handleMessage</span><span class="params">(Request request)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (level == request.getRequstLevel()) &#123;</span><br><span class="line">            <span class="built_in">this</span>.echo(request);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.nextHandler != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="built_in">this</span>.nextHandler.handleMessage(request);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;å·²ç»åˆ°æœ€å°½å¤´äº†&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æŠ½è±¡æ–¹æ³•ï¼Œå­ç±»å®ç°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">echo</span><span class="params">(Request request)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªå…·ä½“çš„handleA</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HandleRuleA</span> <span class="keyword">extends</span> <span class="title class_">Handler</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HandleRuleA</span><span class="params">(<span class="type">int</span> level)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(level);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">echo</span><span class="params">(Request request)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯å¤„ç†è€…1,æˆ‘æ­£åœ¨å¤„ç†Aè§„åˆ™&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªå…·ä½“çš„handleB</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HandleRuleB</span> <span class="keyword">extends</span> <span class="title class_">Handler</span> &#123;&#125;  <span class="comment">//...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å®¢æˆ·ç«¯å®ç°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">HandleRuleA</span> <span class="variable">handleRuleA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HandleRuleA</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="type">HandleRuleB</span> <span class="variable">handleRuleB</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HandleRuleB</span>(<span class="number">2</span>);</span><br><span class="line">        handleRuleA.setNextHandler(handleRuleB);  <span class="comment">//è¿™æ˜¯é‡ç‚¹ï¼Œå°†handleAå’ŒhandleBä¸²èµ·æ¥</span></span><br><span class="line">        handleRuleA.echo(<span class="keyword">new</span> <span class="title class_">Request</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è®¿é—®è€…æ¨¡å¼"><a href="#è®¿é—®è€…æ¨¡å¼" class="headerlink" title="è®¿é—®è€…æ¨¡å¼"></a>è®¿é—®è€…æ¨¡å¼</h3><p>TODO</p><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ul><li><a href="https://mp.weixin.qq.com/s/9gDGQhzRAL3pj35VAinZbQ">è®¾è®¡æ¨¡å¼åœ¨å¤–å–è¥é”€ä¸šåŠ¡ä¸­çš„å®è·µ</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®—æ³•æ€æƒ³æŒæ¡</title>
      <link href="/posts/9680e536.html"/>
      <url>/posts/9680e536.html</url>
      
        <content type="html"><![CDATA[<hr><h2 id="é€’å½’"><a href="#é€’å½’" class="headerlink" title="é€’å½’"></a>é€’å½’</h2><h3 id="395-è‡³å°‘æœ‰Kä¸ªé‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²"><a href="#395-è‡³å°‘æœ‰Kä¸ªé‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²" class="headerlink" title="395. è‡³å°‘æœ‰Kä¸ªé‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²"></a><a href="https://leetcode-cn.com/problems/longest-substring-with-at-least-k-repeating-characters/">395. è‡³å°‘æœ‰Kä¸ªé‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²</a></h3><p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² <code>s</code> å’Œä¸€ä¸ªæ•´æ•° <code>k</code> ï¼Œè¯·ä½ æ‰¾å‡º <code>s</code> ä¸­çš„æœ€é•¿å­ä¸²ï¼Œ è¦æ±‚è¯¥å­ä¸²ä¸­çš„æ¯ä¸€å­—ç¬¦å‡ºç°æ¬¡æ•°éƒ½ä¸å°‘äº <code>k</code> ã€‚è¿”å›è¿™ä¸€å­ä¸²çš„é•¿åº¦ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot;aaabb&quot;, k = 3</span><br><span class="line">è¾“å‡ºï¼š3</span><br><span class="line">è§£é‡Šï¼šæœ€é•¿å­ä¸²ä¸º &quot;aaa&quot; ï¼Œå…¶ä¸­ &#x27;a&#x27; é‡å¤äº† 3 æ¬¡ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šs = &quot;ababbc&quot;, k = 2</span><br><span class="line">è¾“å‡ºï¼š5</span><br><span class="line">è§£é‡Šï¼šæœ€é•¿å­ä¸²ä¸º &quot;ababb&quot; ï¼Œå…¶ä¸­ &#x27;a&#x27; é‡å¤äº† 2 æ¬¡ï¼Œ &#x27;b&#x27; é‡å¤äº† 3 æ¬¡ã€‚</span><br></pre></td></tr></table></figure><p> <strong>æç¤ºï¼š</strong></p><ul><li><code>1 &lt;= s.length &lt;= 10^4</code></li><li><code>s</code> ä»…ç”±å°å†™è‹±æ–‡å­—æ¯ç»„æˆ</li><li><code>1 &lt;= k &lt;= 10^5</code></li></ul><span id="more"></span><h4 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>æœ¬é¢˜è¦æ±‚çš„ä¸€ä¸ªæœ€é•¿çš„å­å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œè¯¥å­å­—ç¬¦ä¸²ä¸­æ¯ä¸ªå­—ç¬¦å‡ºç°çš„æ¬¡æ•°éƒ½æœ€å°‘ä¸º kkã€‚</p><p>æ±‚æœ€é•¿å­å­—ç¬¦ä¸²&#x2F;åŒºé—´çš„è¿™ç±»é¢˜ä¸€èˆ¬å¯ä»¥ç”¨æ»‘åŠ¨çª—å£æ¥åšï¼Œä½†æ˜¯æœ¬é¢˜æ»‘åŠ¨çª—å£çš„ä»£ç ä¸å¥½å†™ï¼Œæˆ‘æ”¹ç”¨é€’å½’ã€‚ä¹Ÿå€Ÿæœ¬é¢˜æ¥å¸®åŠ©å¤§å®¶ç†è§£é€’å½’ã€‚</p><ul><li><strong>é‡ç‚¹ï¼šæˆ‘ä»¬åœ¨è°ƒç”¨é€’å½’å‡½æ•°çš„æ—¶å€™ï¼ŒæŠŠé€’å½’å‡½æ•°å½“åšæ™®é€šå‡½æ•°ï¼ˆé»‘ç®±ï¼‰æ¥è°ƒç”¨ï¼Œå³æ˜ç™½è¯¥å‡½æ•°çš„è¾“å…¥è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Œè€Œä¸ç”¨ç®¡æ­¤å‡½æ•°å†…éƒ¨åœ¨åšä»€ä¹ˆã€‚</strong></li></ul><p>ä¸‹é¢æ˜¯è¯¦ç»†è®²è§£ã€‚</p><ol><li><strong>é€’å½’æœ€åŸºæœ¬çš„æ˜¯è®°ä½é€’å½’å‡½æ•°çš„å«ä¹‰ï¼ˆåŠ¡å¿…ç‰¢è®°å‡½æ•°å®šä¹‰ï¼‰</strong>ï¼šæœ¬é¢˜çš„ <code>longestSubstring(s, k)</code> å‡½æ•°è¡¨ç¤ºçš„å°±æ˜¯é¢˜æ„ï¼Œå³æ±‚ä¸€ä¸ªæœ€é•¿çš„å­å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œè¯¥å­å­—ç¬¦ä¸²ä¸­æ¯ä¸ªå­—ç¬¦å‡ºç°çš„æ¬¡æ•°éƒ½æœ€å°‘ä¸º kã€‚å‡½æ•°å…¥å‚ s æ˜¯è¡¨ç¤ºæºå­—ç¬¦ä¸²ï¼›k æ˜¯é™åˆ¶æ¡ä»¶ï¼Œå³å­å­—ç¬¦ä¸²ä¸­æ¯ä¸ªå­—ç¬¦æœ€å°‘å‡ºç°çš„æ¬¡æ•°ï¼›å‡½æ•°è¿”å›ç»“æœæ˜¯æ»¡è¶³é¢˜æ„çš„æœ€é•¿å­å­—ç¬¦ä¸²é•¿åº¦ã€‚</li><li><strong>é€’å½’çš„ç»ˆæ­¢æ¡ä»¶ï¼ˆèƒ½ç›´æ¥å†™å‡ºçš„æœ€ç®€å• caseï¼‰</strong>ï¼šå¦‚æœå­—ç¬¦ä¸² s çš„é•¿åº¦å°‘äº kï¼Œé‚£ä¹ˆä¸€å®šä¸å­˜åœ¨æ»¡è¶³é¢˜æ„çš„å­å­—ç¬¦ä¸²ï¼Œè¿”å› 0ï¼›</li><li><strong>è°ƒç”¨é€’å½’ï¼ˆé‡ç‚¹ï¼‰</strong>ï¼šå¦‚æœä¸€ä¸ªå­—ç¬¦ c åœ¨ s ä¸­å‡ºç°çš„æ¬¡æ•°å°‘äº k æ¬¡ï¼Œé‚£ä¹ˆ s ä¸­æ‰€æœ‰çš„åŒ…å« c çš„å­å­—ç¬¦ä¸²éƒ½ä¸èƒ½æ»¡è¶³é¢˜æ„ã€‚æ‰€ä»¥ï¼Œåº”è¯¥åœ¨ s çš„æ‰€æœ‰ä¸åŒ…å« c çš„å­å­—ç¬¦ä¸²ä¸­ç»§ç»­å¯»æ‰¾ç»“æœï¼šæŠŠ s æŒ‰ç…§ c åˆ†å‰²ï¼ˆåˆ†å‰²åæ¯ä¸ªå­ä¸²éƒ½ä¸åŒ…å« cï¼‰ï¼Œå¾—åˆ°å¾ˆå¤šå­å­—ç¬¦ä¸² tï¼›<strong>ä¸‹ä¸€æ­¥è¦æ±‚ tä½œä¸ºæºå­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œå®ƒçš„æœ€é•¿çš„æ»¡è¶³é¢˜æ„çš„å­å­—ç¬¦ä¸²é•¿åº¦</strong>ï¼ˆåˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬æŠŠå¤§é—®é¢˜åˆ†å‰²ä¸ºäº†å°é—®é¢˜(s â†’ t)ï¼‰ã€‚æ­¤æ—¶æˆ‘ä»¬å‘ç°ï¼Œæ°å¥½å·²ç»å®šä¹‰äº†å‡½æ•° <code>longestSubstring(s, k)</code> å°±æ˜¯æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„ï¼æ‰€ä»¥ç›´æ¥æŠŠ <code>longestSubstring(s, k)</code> å‡½æ•°æ‹¿æ¥ç”¨ï¼Œäºæ˜¯å½¢æˆäº†é€’å½’ã€‚</li><li>æœªè¿›å…¥é€’å½’æ—¶çš„è¿”å›ç»“æœï¼šå¦‚æœ s ä¸­çš„æ¯ä¸ªå­—ç¬¦å‡ºç°çš„æ¬¡æ•°éƒ½å¤§äº k æ¬¡ï¼Œé‚£ä¹ˆ s å°±æ˜¯æˆ‘ä»¬è¦æ±‚çš„å­—ç¬¦ä¸²ï¼Œç›´æ¥è¿”å›è¯¥å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚</li></ol><p>æ€»ä¹‹ï¼Œé€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬çœ‹å‡ºäº†ï¼š<strong>æˆ‘ä»¬ä¸æ˜¯ä¸ºäº†é€’å½’è€Œé€’å½’</strong>ã€‚è€Œæ˜¯å› ä¸ºæˆ‘ä»¬æŠŠå¤§é—®é¢˜æ‹†è§£æˆäº†å°é—®é¢˜ï¼Œæ°å¥½æœ‰å‡½æ•°å¯ä»¥è§£å†³å°é—®é¢˜ï¼Œæ‰€ä»¥ç›´æ¥ç”¨è¿™ä¸ªå‡½æ•°ã€‚ç”±äºè¿™ä¸ªå‡½æ•°æ­£å¥½æ˜¯æœ¬èº«ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠæ­¤ç°è±¡å«åšé€’å½’ã€‚å°é—®é¢˜æ˜¯åŸå› ï¼Œé€’å½’æ˜¯ç»“æœã€‚è€Œ<strong>é€’å½’å‡½æ•°åˆ°åº•æ€ä¹ˆä¸€å±‚å±‚å±•å¼€ä¸ç»ˆæ­¢çš„ï¼Œä¸è¦ç”¨å¤§è„‘å»æƒ³</strong>ï¼Œè¿™æ˜¯è®¡ç®—æœºå¹²çš„äº‹ã€‚æˆ‘ä»¬åªç”¨æŠŠé€’å½’å‡½æ•°å½“åšä¸€ä¸ªèƒ½è§£å†³é—®é¢˜çš„é»‘ç®±å°±å¤Ÿäº†ï¼ŒæŠŠæ›´å¤šçš„æ³¨æ„åŠ›æ”¾åœ¨æ‹†è§£å­é—®é¢˜ã€é€’å½’ç»ˆæ­¢æ¡ä»¶ã€é€’å½’å‡½æ•°çš„æ­£ç¡®æ€§ä¸Šæ¥ã€‚</p><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">longestSubstring</span><span class="params">(String s, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (s.length() &lt; k) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        HashMap&lt;Character, Integer&gt; counter = <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">            counter.put(s.charAt(i), counter.getOrDefault(s.charAt(i), <span class="number">0</span>) + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> c : counter.keySet()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (counter.get(c) &lt; k) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span> (String t : s.split(String.valueOf(c))) &#123;</span><br><span class="line">                    res = Math.max(res, longestSubstring(t, k));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> res;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> s.length();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="82-åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´ -II"><a href="#82-åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´ -II" class="headerlink" title="82. åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´  II"></a><a href="https://leetcode-cn.com/problems/remove-duplicates-from-sorted-list-ii/">82. åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´  II</a></h3><p>å­˜åœ¨ä¸€ä¸ªæŒ‰å‡åºæ’åˆ—çš„é“¾è¡¨ï¼Œç»™ä½ è¿™ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ <code>head</code> ï¼Œè¯·ä½ åˆ é™¤é“¾è¡¨ä¸­æ‰€æœ‰å­˜åœ¨æ•°å­—é‡å¤æƒ…å†µçš„èŠ‚ç‚¹ï¼Œåªä¿ç•™åŸå§‹é“¾è¡¨ä¸­ <strong>æ²¡æœ‰é‡å¤å‡ºç°</strong> çš„æ•°å­—ã€‚</p><p>è¿”å›åŒæ ·æŒ‰å‡åºæ’åˆ—çš„ç»“æœé“¾è¡¨ã€‚</p><p> <strong>ç¤ºä¾‹ 1ï¼š</strong></p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210326100625.jpeg" alt="img"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead = [1,2,3,3,4,4,5]</span><br><span class="line">è¾“å‡ºï¼š[1,2,5]</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210326100625.jpeg" alt="img"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead = [1,1,1,2,3]</span><br><span class="line">è¾“å‡ºï¼š[2,3]</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li>é“¾è¡¨ä¸­èŠ‚ç‚¹æ•°ç›®åœ¨èŒƒå›´ <code>[0, 300]</code> å†…</li><li><code>-100 &lt;= Node.val &lt;= 100</code></li><li>é¢˜ç›®æ•°æ®ä¿è¯é“¾è¡¨å·²ç»æŒ‰å‡åºæ’åˆ—</li></ul><h4 id="è§£é¢˜æ€è·¯-1"><a href="#è§£é¢˜æ€è·¯-1" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p>é¢˜æ„ï¼šåœ¨ä¸€ä¸ª<strong>æœ‰åº</strong>é“¾è¡¨ä¸­ï¼Œå¦‚æœä¸€ä¸ªèŠ‚ç‚¹çš„å€¼å‡ºç°ä¸æ­¢ä¸€æ¬¡ï¼Œé‚£ä¹ˆæŠŠè¿™ä¸ªèŠ‚ç‚¹åˆ é™¤æ‰ã€‚</p><p>é‡ç‚¹ï¼š<strong>æœ‰åºé“¾è¡¨</strong>ï¼Œæ‰€ä»¥ï¼Œä¸€ä¸ªèŠ‚ç‚¹çš„å€¼å‡ºç°ä¸æ­¢ä¸€æ¬¡ï¼Œé‚£ä¹ˆå®ƒä»¬å¿…ç›¸é‚»ã€‚</p><h5 id="1-é€’å½’å‡½æ•°å®šä¹‰"><a href="#1-é€’å½’å‡½æ•°å®šä¹‰" class="headerlink" title="1. é€’å½’å‡½æ•°å®šä¹‰"></a>1. é€’å½’å‡½æ•°å®šä¹‰</h5><p><strong>é€’å½’æœ€åŸºæœ¬çš„æ˜¯è¦æ˜ç™½é€’å½’å‡½æ•°çš„å®šä¹‰ï¼</strong> æˆ‘åå¤å¼ºè°ƒè¿‡è¿™ä¸€ç‚¹ã€‚</p><p>é€’å½’å‡½æ•°ç›´æ¥ä½¿ç”¨é¢˜ç›®ç»™å‡ºçš„å‡½æ•° <code>deleteDuplicates(head)</code> ï¼Œå®ƒçš„å«ä¹‰æ˜¯ åˆ é™¤ä»¥ <code>head</code> ä½œä¸ºå¼€å¤´çš„æœ‰åºé“¾è¡¨ä¸­ï¼Œå€¼å‡ºç°é‡å¤çš„èŠ‚ç‚¹ã€‚</p><h5 id="2-é€’å½’ç»ˆæ­¢æ¡ä»¶"><a href="#2-é€’å½’ç»ˆæ­¢æ¡ä»¶" class="headerlink" title="2. é€’å½’ç»ˆæ­¢æ¡ä»¶"></a>2. é€’å½’ç»ˆæ­¢æ¡ä»¶</h5><p>ç»ˆæ­¢æ¡ä»¶å°±æ˜¯èƒ½æƒ³åˆ°çš„åŸºæœ¬çš„ã€ä¸ç”¨ç»§ç»­é€’å½’å¤„ç†çš„caseã€‚</p><ul><li>å¦‚æœ <code>head</code> ä¸ºç©ºï¼Œé‚£ä¹ˆè‚¯å®šæ²¡æœ‰å€¼å‡ºç°é‡å¤çš„èŠ‚ç‚¹ï¼Œç›´æ¥è¿”å› headï¼›</li><li>å¦‚æœ <code>head.next</code> ä¸ºç©ºï¼Œé‚£ä¹ˆè¯´æ˜é“¾è¡¨ä¸­åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿæ²¡æœ‰å€¼å‡ºç°é‡å¤çš„èŠ‚ç‚¹ï¼Œä¹Ÿç›´æ¥è¿”å› headã€‚</li></ul><h5 id="3-é€’å½’è°ƒç”¨"><a href="#3-é€’å½’è°ƒç”¨" class="headerlink" title="3. é€’å½’è°ƒç”¨"></a>3. é€’å½’è°ƒç”¨</h5><p>ä»€ä¹ˆæ—¶å€™éœ€è¦é€’å½’å‘¢ï¼Ÿæˆ‘ä»¬æƒ³ä¸€ä¸‹è¿™ä¸¤ç§æƒ…å†µï¼š</p><ul><li>å¦‚æœ <code>head.val != head.next.val</code> ï¼Œè¯´æ˜å¤´èŠ‚ç‚¹çš„å€¼<strong>ä¸ç­‰äº</strong>ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å€¼ï¼Œæ‰€ä»¥å½“å‰çš„ <code>head</code> èŠ‚ç‚¹å¿…é¡»ä¿ç•™ï¼›ä½†æ˜¯ head.next èŠ‚ç‚¹è¦ä¸è¦ä¿ç•™å‘¢ï¼Ÿæˆ‘ä»¬è¿˜ä¸çŸ¥é“ï¼Œéœ€è¦å¯¹ <code>head.next</code> è¿›è¡Œé€’å½’ï¼Œå³å¯¹<code>head.next</code> ä½œä¸ºå¤´èŠ‚ç‚¹çš„é“¾è¡¨ï¼Œå»é™¤å€¼é‡å¤çš„èŠ‚ç‚¹ã€‚æ‰€ä»¥ <code>head.next = deleteDuplicates(head.next)</code>.</li><li>å¦‚æœ <code>head.val == head.next.val</code> ï¼Œè¯´æ˜å¤´èŠ‚ç‚¹çš„å€¼<strong>ç­‰äº</strong>ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å€¼ï¼Œæ‰€ä»¥å½“å‰çš„ <code>head</code> èŠ‚ç‚¹å¿…é¡»åˆ é™¤ï¼›ä½†æ˜¯ head.next èŠ‚ç‚¹è¦ä¸è¦åˆ é™¤å‘¢ï¼Ÿæˆ‘ä»¬è¿˜ä¸çŸ¥é“ï¼Œéœ€è¦ä¸€ç›´å‘åéå†å¯»æ‰¾åˆ°ä¸ head.val ä¸ç­‰çš„èŠ‚ç‚¹ã€‚ä¸ head.val ç›¸ç­‰çš„è¿™ä¸€æ®µé“¾è¡¨éƒ½è¦åˆ é™¤ï¼Œå› æ­¤è¿”å› <code>deleteDuplicates(move);</code></li></ul><h5 id="4-è¿”å›ç»“æœ"><a href="#4-è¿”å›ç»“æœ" class="headerlink" title="4. è¿”å›ç»“æœ"></a>4. è¿”å›ç»“æœ</h5><p>é¢˜ç›®è®©æˆ‘ä»¬è¿”å›åˆ é™¤äº†å€¼é‡å¤çš„èŠ‚ç‚¹åå‰©ä½™çš„é“¾è¡¨ï¼Œç»“åˆä¸Šé¢ä¸¤ç§é€’å½’è°ƒç”¨çš„æƒ…å†µã€‚</p><ul><li>å¦‚æœ <code>head.val != head.next.val</code> ï¼Œå¤´ç»“ç‚¹éœ€è¦ä¿ç•™ï¼Œå› æ­¤è¿”å›çš„æ˜¯ <code>head</code>ï¼›</li><li>å¦‚æœ <code>head.val == head.next.val</code> ï¼Œå¤´ç»“ç‚¹éœ€è¦åˆ é™¤ï¼Œéœ€è¦è¿”å›çš„æ˜¯<code>deleteDuplicates(move);</code>ã€‚</li></ul><p>å¯¹é“¾è¡¨ <code>1 -&gt; 2 -&gt; 2 -&gt; 3</code> é€’å½’çš„è¿‡ç¨‹å¦‚ä¸‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210326103612.jpeg" alt="82.001.jpeg"></p><h4 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">deleteDuplicates</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="comment">// æ²¡æœ‰èŠ‚ç‚¹æˆ–è€…åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¿…ç„¶æ²¡æœ‰é‡å¤å…ƒç´ </span></span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">null</span> || head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> head;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å½“å‰èŠ‚ç‚¹å’Œä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå€¼ä¸åŒï¼Œåˆ™headçš„å€¼æ˜¯éœ€è¦ä¿ç•™çš„ï¼Œå¯¹head.nextç»§ç»­é€’å½’</span></span><br><span class="line">        <span class="keyword">if</span> (head.val != head.next.val) &#123;</span><br><span class="line">            head.next = deleteDuplicates(head.next);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å½“å‰èŠ‚ç‚¹ä¸ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å€¼é‡å¤äº†ï¼Œé‡å¤çš„å€¼éƒ½ä¸èƒ½è¦ã€‚</span></span><br><span class="line">            <span class="comment">// ä¸€ç›´å¾€ä¸‹æ‰¾ï¼Œæ‰¾åˆ°ä¸é‡å¤çš„èŠ‚ç‚¹ã€‚è¿”å›å¯¹ä¸é‡å¤èŠ‚ç‚¹çš„é€’å½’ç»“æœ</span></span><br><span class="line">            <span class="type">ListNode</span> <span class="variable">move</span> <span class="operator">=</span> head.next;</span><br><span class="line">            <span class="keyword">while</span> (move != <span class="literal">null</span> &amp;&amp; head.val == move.val) &#123;</span><br><span class="line">                move = move.next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> deleteDuplicates(move);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‰ç¼€å’Œ"><a href="#å‰ç¼€å’Œ" class="headerlink" title="å‰ç¼€å’Œ"></a>å‰ç¼€å’Œ</h2><h3 id="303-åŒºåŸŸå’Œæ£€ç´¢-æ•°ç»„ä¸å¯å˜"><a href="#303-åŒºåŸŸå’Œæ£€ç´¢-æ•°ç»„ä¸å¯å˜" class="headerlink" title="303. åŒºåŸŸå’Œæ£€ç´¢ - æ•°ç»„ä¸å¯å˜"></a><a href="https://leetcode-cn.com/problems/range-sum-query-immutable/">303. åŒºåŸŸå’Œæ£€ç´¢ - æ•°ç»„ä¸å¯å˜</a></h3><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„  numsï¼Œæ±‚å‡ºæ•°ç»„ä»ç´¢å¼• i åˆ° jï¼ˆi â‰¤ jï¼‰èŒƒå›´å†…å…ƒç´ çš„æ€»å’Œï¼ŒåŒ…å« iã€j ä¸¤ç‚¹ã€‚</p><p>å®ç° NumArray ç±»ï¼š</p><ul><li>NumArray(int[] nums) ä½¿ç”¨æ•°ç»„ nums åˆå§‹åŒ–å¯¹è±¡</li><li>int sumRange(int i, int j) è¿”å›æ•°ç»„ nums ä»ç´¢å¼• i åˆ° jï¼ˆi â‰¤ jï¼‰èŒƒå›´å†…å…ƒç´ çš„æ€»å’Œï¼ŒåŒ…å« iã€j ä¸¤ç‚¹ï¼ˆä¹Ÿå°±æ˜¯ sum(nums[i], nums[i + 1], â€¦ , nums[j])ï¼‰</li></ul><p>ç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼š</span><br><span class="line">[&quot;NumArray&quot;, &quot;sumRange&quot;, &quot;sumRange&quot;, &quot;sumRange&quot;]</span><br><span class="line">[[[-2, 0, 3, -5, 2, -1]], [0, 2], [2, 5], [0, 5]]</span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">[null, 1, -1, -3]</span><br><span class="line"></span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">NumArray numArray = new NumArray([-2, 0, 3, -5, 2, -1]);</span><br><span class="line">numArray.sumRange(0, 2); // return 1 ((-2) + 0 + 3)</span><br><span class="line">numArray.sumRange(2, 5); // return -1 (3 + (-5) + 2 + (-1)) </span><br><span class="line">numArray.sumRange(0, 5); // return -3 ((-2) + 0 + 3 + (-5) + 2 + (-1))</span><br></pre></td></tr></table></figure><p>æç¤ºï¼š</p><ul><li>0 &lt;&#x3D; nums.length &lt;&#x3D; 10^4</li><li>-10^5 &lt;&#x3D; nums[i] &lt;&#x3D; 10^5</li><li>0 &lt;&#x3D; i &lt;&#x3D; j &lt; nums.length</li><li>æœ€å¤šè°ƒç”¨ 10^4 æ¬¡ sumRange æ–¹æ³•</li></ul><h4 id="è§£é¢˜æ€è·¯-2"><a href="#è§£é¢˜æ€è·¯-2" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h4><p><strong>preSumï¼ˆå‰ç¼€å’Œï¼‰</strong><br>ä»Šå¤©è¿™ä¸ªé¢˜ç›®è®©æˆ‘ä»¬æ±‚ä¸€ä¸ªåŒºé—´ [i, j] å†…çš„å’Œï¼Œæ±‚åŒºé—´å’Œå¯ä»¥ç”¨ preSum æ¥åšã€‚</p><p>preSum æ–¹æ³•èƒ½å¿«é€Ÿè®¡ç®—æŒ‡å®šåŒºé—´æ®µ i - j çš„å…ƒç´ ä¹‹å’Œã€‚å®ƒçš„è®¡ç®—æ–¹æ³•æ˜¯ä»å·¦å‘å³éå†æ•°ç»„ï¼Œå½“éå†åˆ°æ•°ç»„çš„ i ä½ç½®æ—¶ï¼ŒpreSum è¡¨ç¤º i ä½ç½®å·¦è¾¹çš„å…ƒç´ ä¹‹å’Œã€‚</p><p>å‡è®¾æ•°ç»„é•¿åº¦ä¸º Nï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªé•¿åº¦ä¸º N+1 çš„ preSum æ•°ç»„ï¼Œ<strong>preSum[i] è¡¨ç¤ºè¯¥å…ƒç´ å·¦è¾¹æ‰€æœ‰å…ƒç´ ä¹‹å’Œï¼ˆä¸åŒ…å« i å…ƒç´ ï¼‰</strong>ã€‚ç„¶åéå†ä¸€æ¬¡æ•°ç»„ï¼Œç´¯åŠ åŒºé—´ [0, i)èŒƒå›´å†…çš„å…ƒç´ ï¼Œå¯ä»¥å¾—åˆ° preSum æ•°ç»„ã€‚</p><p>æ±‚ <code>preSum</code> çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">N = <span class="built_in">len</span>(nums)</span><br><span class="line">preSum = <span class="built_in">range</span>(N + <span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">    preSum[i + <span class="number">1</span>] = preSum[i] + nums[i]</span><br><span class="line"><span class="built_in">print</span>(preSum)</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨ preSum æ•°ç»„ï¼Œå¯ä»¥åœ¨ O(1) çš„æ—¶é—´å†…å¿«é€Ÿæ±‚å‡º nums ä»»æ„åŒºé—´ [i, j] (ä¸¤ç«¯éƒ½åŒ…å«) çš„å„å…ƒç´ ä¹‹å’Œã€‚</p><p><code>sum(i, j) = preSum[j + 1] - preSum[i]</code></p><p>å¯¹äºæœ¬é¢˜ï¼Œå¯ä»¥åœ¨ NumArray ç±»çš„æ„é€ å‡½æ•°çš„é‡Œé¢ï¼Œæ±‚æ•°ç»„æ¯ä¸ªä½ç½®çš„ preSumï¼›å½“è®¡ç®—sumRange(i, j)çš„æ—¶å€™ç›´æ¥è¿”å› <code>preSum[j + 1] - preSum[i]</code> å¯ä»¥å¾—åˆ°åŒºé—´å’Œã€‚</p><p>ä¸‹é¢ä»¥æ•°ç»„ <code>[1, 12, -5, -6, 50, 3]</code> ä¸ºä¾‹ï¼Œå±•ç¤ºäº†æ±‚ preSum çš„è¿‡ç¨‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210301102603.gif" alt="303ï¼ŒpreSum.gif"></p><h4 id="ä»£ç -2"><a href="#ä»£ç -2" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">NumArray</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] preSum;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">NumArray</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        preSum = <span class="keyword">new</span> <span class="title class_">int</span>[n + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            preSum[i + <span class="number">1</span>] = preSum[i] + nums[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sumRange</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> preSum[j + <span class="number">1</span>] - preSum[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ—¶é—´å¤æ‚åº¦ï¼šæ„é€ å‡½æ•°çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(N), sumRange å‡½æ•°è°ƒç”¨çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)</li><li>ç©ºé—´å¤æ‚åº¦ï¼šO(N)ã€‚</li></ul><h2 id="å•è°ƒæ ˆ-Monotonic-Stack"><a href="#å•è°ƒæ ˆ-Monotonic-Stack" class="headerlink" title="å•è°ƒæ ˆ Monotonic Stack"></a>å•è°ƒæ ˆ Monotonic Stack</h2><h3 id="503-ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ -II"><a href="#503-ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ -II" class="headerlink" title="503. ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´  II"></a><a href="https://leetcode-cn.com/problems/next-greater-element-ii/">503. ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´  II</a></h3><p>ç»™å®šä¸€ä¸ªå¾ªç¯æ•°ç»„ï¼ˆæœ€åä¸€ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªå…ƒç´ æ˜¯æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¾“å‡ºæ¯ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ ã€‚æ•°å­— x çš„ä¸‹ä¸€ä¸ªæ›´å¤§çš„å…ƒç´ æ˜¯æŒ‰æ•°ç»„éå†é¡ºåºï¼Œè¿™ä¸ªæ•°å­—ä¹‹åçš„ç¬¬ä¸€ä¸ªæ¯”å®ƒæ›´å¤§çš„æ•°ï¼Œè¿™æ„å‘³ç€ä½ åº”è¯¥å¾ªç¯åœ°æœç´¢å®ƒçš„ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ•°ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¾“å‡º -1ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: [1,2,1]</span><br><span class="line">è¾“å‡º: [2,-1,2]</span><br><span class="line">è§£é‡Š: ç¬¬ä¸€ä¸ª 1 çš„ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ•°æ˜¯ 2ï¼›</span><br><span class="line">æ•°å­— 2 æ‰¾ä¸åˆ°ä¸‹ä¸€ä¸ªæ›´å¤§çš„æ•°ï¼› </span><br><span class="line">ç¬¬äºŒä¸ª 1 çš„ä¸‹ä¸€ä¸ªæœ€å¤§çš„æ•°éœ€è¦å¾ªç¯æœç´¢ï¼Œç»“æœä¹Ÿæ˜¯ 2ã€‚</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„:</strong> è¾“å…¥æ•°ç»„çš„é•¿åº¦ä¸ä¼šè¶…è¿‡ 10000ã€‚</p><h3 id="è§£é¢˜æ€è·¯-3"><a href="#è§£é¢˜æ€è·¯-3" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>ä»Šå¤©é¢˜ç›®çš„ä¸¤ä¸ªé‡ç‚¹ï¼š</p><ul><li>å¦‚ä½•æ±‚ä¸‹ä¸€ä¸ªæ›´å¤§çš„å…ƒç´ </li><li>å¦‚ä½•å®ç°å¾ªç¯æ•°ç»„</li></ul><h5 id="1-å¦‚ä½•æ±‚ä¸‹ä¸€ä¸ªæ›´å¤§çš„å…ƒç´ "><a href="#1-å¦‚ä½•æ±‚ä¸‹ä¸€ä¸ªæ›´å¤§çš„å…ƒç´ " class="headerlink" title="1. å¦‚ä½•æ±‚ä¸‹ä¸€ä¸ªæ›´å¤§çš„å…ƒç´ "></a>1. å¦‚ä½•æ±‚ä¸‹ä¸€ä¸ªæ›´å¤§çš„å…ƒç´ </h5><p>æœ¬é¢˜å¦‚æœæš´åŠ›æ±‚è§£ï¼Œå¯¹äºæ¯ä¸ªå…ƒç´ éƒ½å‘åå»å¯»æ‰¾æ¯”å®ƒæ›´å¤§çš„å…ƒç´ ï¼Œé‚£ä¹ˆæ—¶é—´å¤æ‚åº¦ *O(N^2)*ä¼šè¶…æ—¶ã€‚å¿…é¡»æƒ³åŠæ³•ä¼˜åŒ–ã€‚</p><p>æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œæš´åŠ›è§£æ³•ä¸­ï¼Œå¦‚æœæ•°ç»„çš„å‰åŠéƒ¨åˆ†æ˜¯å•è°ƒä¸å¢çš„ï¼Œé‚£ä¹ˆä¼šæœ‰å¾ˆå¤§çš„è®¡ç®—èµ„æºçš„æµªè´¹ã€‚æ¯”å¦‚è¯´ <code>[6,5,4,3,8]</code>ï¼Œå¯¹äºå‰é¢çš„ <code>[6,5,4,3]</code> ç­‰æ•°å­—éƒ½éœ€è¦å‘åéå†ï¼Œå½“å¯»æ‰¾åˆ°å…ƒç´  8 æ—¶æ‰æ‰¾åˆ°äº†æ¯”è‡ªå·±å¤§çš„å…ƒç´ ï¼›è€Œå¦‚æœå·²çŸ¥å…ƒç´  6 å‘åæ‰¾åˆ°å…ƒç´  8 æ‰æ‰¾åˆ°äº†æ¯”è‡ªå·±çš„å¤§çš„æ•°å­—ï¼Œé‚£ä¹ˆå¯¹äºå…ƒç´  <code>[5,4,3]</code> æ¥è¯´ï¼Œå®ƒä»¬éƒ½æ¯”å…ƒç´  6 æ›´å°ï¼Œæ‰€ä»¥æ¯”å®ƒä»¬æ›´å¤§çš„å…ƒç´ ä¸€å®šæ˜¯å…ƒç´  8ï¼Œä¸éœ€è¦å•ç‹¬éå†å¯¹ <code>[5,4,3]</code> å‘åéå†ä¸€æ¬¡ï¼</p><p>æ ¹æ®ä¸Šé¢çš„åˆ†æå¯çŸ¥ï¼Œ<strong>å¯ä»¥éå†ä¸€æ¬¡æ•°ç»„ï¼Œå¦‚æœå…ƒç´ æ˜¯å•è°ƒé€’å‡çš„ï¼ˆåˆ™ä»–ä»¬çš„ã€Œä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ ã€ç›¸åŒï¼‰ï¼Œæˆ‘ä»¬å°±æŠŠè¿™äº›å…ƒç´ ä¿å­˜ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªè¾ƒå¤§çš„å…ƒç´ ï¼›æŠŠè¯¥è¾ƒå¤§å…ƒç´ é€ä¸€è·Ÿä¿å­˜äº†çš„å…ƒç´ æ¯”è¾ƒï¼Œå¦‚æœè¯¥å…ƒç´ æ›´å¤§ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯å‰é¢å…ƒç´ çš„ã€Œä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ ã€</strong>ã€‚</p><p>åœ¨å®ç°ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ã€Œ<strong>å•è°ƒæ ˆ</strong>ã€æ¥å®ç°ï¼Œ<strong>å•è°ƒæ ˆ</strong>æ˜¯è¯´æ ˆé‡Œé¢çš„å…ƒç´ ä»æ ˆåº•åˆ°æ ˆé¡¶æ˜¯<strong>å•è°ƒé€’å¢</strong>æˆ–è€…<strong>å•è°ƒé€’å‡</strong>çš„ï¼ˆç±»ä¼¼äºæ±‰è¯ºå¡”ï¼‰ã€‚</p><p>æœ¬é¢˜åº”è¯¥ç”¨ä¸ªã€Œå•è°ƒé€’å‡æ ˆã€æ¥å®ç°ã€‚</p><p>å»ºç«‹ã€Œå•è°ƒé€’å‡æ ˆã€ï¼Œå¹¶å¯¹åŸæ•°ç»„éå†ä¸€æ¬¡ï¼š</p><ul><li>å¦‚æœæ ˆä¸ºç©ºï¼Œåˆ™æŠŠå½“å‰å…ƒç´ æ”¾å…¥æ ˆå†…ï¼›</li><li>å¦‚æœæ ˆä¸ä¸ºç©ºï¼Œåˆ™éœ€è¦åˆ¤æ–­å½“å‰å…ƒç´ å’Œæ ˆé¡¶å…ƒç´ çš„å¤§å°ï¼š<ul><li>å¦‚æœå½“å‰å…ƒç´ æ¯”æ ˆé¡¶å…ƒç´ å¤§ï¼šè¯´æ˜å½“å‰å…ƒç´ æ˜¯å‰é¢ä¸€äº›å…ƒç´ çš„ã€Œä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ ã€ï¼Œåˆ™é€ä¸ªå¼¹å‡ºæ ˆé¡¶å…ƒç´ ï¼Œç›´åˆ°å½“å‰å…ƒç´ æ¯”æ ˆé¡¶å…ƒç´ å°ä¸ºæ­¢ã€‚</li><li>å¦‚æœå½“å‰å…ƒç´ æ¯”æ ˆé¡¶å…ƒç´ å°ï¼šè¯´æ˜å½“å‰å…ƒç´ çš„ã€Œä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ ã€ä¸æ ˆé¡¶å…ƒç´ ç›¸åŒï¼Œåˆ™æŠŠå½“å‰å…ƒç´ å…¥æ ˆã€‚</li></ul></li></ul><p>å¯ä»¥ç”¨ä¸‹é¢çš„åŠ¨å›¾æ¥å¸®åŠ©ç†è§£ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210306142911.gif" alt="å•è°ƒæ ˆ"></p><h5 id="2-å¦‚ä½•å®ç°å¾ªç¯æ•°ç»„"><a href="#2-å¦‚ä½•å®ç°å¾ªç¯æ•°ç»„" class="headerlink" title="2. å¦‚ä½•å®ç°å¾ªç¯æ•°ç»„"></a>2. å¦‚ä½•å®ç°å¾ªç¯æ•°ç»„</h5><p>é¢˜ç›®è¯´ç»™å‡ºçš„æ•°ç»„æ˜¯å¾ªç¯æ•°ç»„ï¼Œä½•ä¸ºå¾ªç¯æ•°ç»„ï¼Ÿå°±æ˜¯è¯´æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ ä¸‹ä¸€ä¸ªå…ƒç´ æ˜¯æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå½¢çŠ¶ç±»ä¼¼äºã€Œç¯ã€ã€‚</p><ul><li>ä¸€ç§å®ç°æ–¹å¼æ˜¯ï¼ŒæŠŠæ•°ç»„å¤åˆ¶ä¸€ä»½åˆ°æ•°ç»„æœ«å°¾ï¼Œè¿™æ ·è™½ç„¶ä¸æ˜¯ä¸¥æ ¼çš„å¾ªç¯æ•°ç»„ï¼Œä½†æ˜¯å¯¹äºæœ¬é¢˜å·²ç»è¶³å¤Ÿäº†ï¼Œå› ä¸ºæœ¬é¢˜å¯¹æ•°ç»„æœ€å¤šéå†ä¸¤æ¬¡ã€‚</li><li>å¦ä¸€ä¸ªå¸¸è§çš„å®ç°æ–¹å¼æ˜¯ï¼Œä½¿ç”¨å–æ¨¡è¿ç®— *%*å¯ä»¥æŠŠä¸‹æ ‡ <em>i</em> æ˜ å°„åˆ°æ•°ç»„ <em>nums</em> é•¿åº¦çš„ <em>0 - N</em> å†…ã€‚</li></ul><h3 id="ä»£ç -3"><a href="#ä»£ç -3" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><p>æ ˆé‡Œé¢éœ€è¦ä¿å­˜å…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ï¼Œè€Œä¸æ˜¯å…·ä½“çš„æ•°å­—ã€‚å› ä¸ºéœ€è¦æ ¹æ®ä¸‹æ ‡ä¿®æ”¹ç»“æœæ•°ç»„ <code>res</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] nextGreaterElements(<span class="type">int</span>[] nums) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        Arrays.fill(res, -<span class="number">1</span>);</span><br><span class="line">        Deque&lt;Integer&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">2</span> * n; i++) &#123;</span><br><span class="line">            <span class="keyword">while</span> (!stack.isEmpty() &amp;&amp; nums[i % n] &gt; nums[stack.peek()]) &#123;</span><br><span class="line">                res[stack.pop()] = nums[i % n];</span><br><span class="line">            &#125;</span><br><span class="line">            stack.push(i % n);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ—¶é—´å¤æ‚åº¦ï¼š*O(N)*ï¼Œéå†äº†ä¸¤æ¬¡æ•°ç»„ï¼›</li><li>ç©ºé—´å¤æ‚åº¦ï¼š*O(N)*ï¼Œä½¿ç”¨äº†é¢å¤–ç©ºé—´ã€Œå•è°ƒæ ˆã€ï¼Œæœ€åæƒ…å†µä¸‹ï¼Œæ ˆå†…ä¼šä¿å­˜æ•°ç»„çš„æ‰€æœ‰å…ƒç´ ã€‚</li></ul><h2 id="å¯»æ‰¾ä¸‹ä¸€ä¸ªæ›´å¤§çš„å…ƒç´ éœ€è¦ç§»åŠ¨çš„æ­¥æ•°"><a href="#å¯»æ‰¾ä¸‹ä¸€ä¸ªæ›´å¤§çš„å…ƒç´ éœ€è¦ç§»åŠ¨çš„æ­¥æ•°" class="headerlink" title="å¯»æ‰¾ä¸‹ä¸€ä¸ªæ›´å¤§çš„å…ƒç´ éœ€è¦ç§»åŠ¨çš„æ­¥æ•°"></a><a href="https://zhuanlan.zhihu.com/p/26465701">å¯»æ‰¾ä¸‹ä¸€ä¸ªæ›´å¤§çš„å…ƒç´ éœ€è¦ç§»åŠ¨çš„æ­¥æ•°</a></h2><p>ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œè¿”å›é•¿åº¦ç›¸åŒçš„æ•°ç»„ã€‚è¿”å›çš„æ•°ç»„çš„ç¬¬iä¸ªä½ç½®çš„å€¼åº”å½“æ˜¯ï¼Œå¯¹äºåŸæ•°ç»„ä¸­çš„ç¬¬iä¸ªå…ƒç´ ï¼Œè‡³å°‘å¾€å³èµ°å¤šå°‘æ­¥ï¼Œæ‰èƒ½é‡åˆ°ä¸€ä¸ªæ¯”è‡ªå·±å¤§çš„å…ƒç´ ï¼ˆå¦‚æœä¹‹åæ²¡æœ‰æ¯”è‡ªå·±å¤§çš„å…ƒç´ ï¼Œæˆ–è€…å·²ç»æ˜¯æœ€åä¸€ä¸ªå…ƒç´ ï¼Œåˆ™åœ¨è¿”å›æ•°ç»„çš„å¯¹åº”ä½ç½®æ”¾ä¸Š-1ï¼‰ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: [5,3,1,2,4]</span><br><span class="line">è¾“å‡º: [-1,3,1,1,-1]</span><br><span class="line">è§£é‡Š: 5æ‰¾ä¸åˆ°æ¯”å®ƒæ›´å¤§çš„æ‰€ä»¥æ˜¯-1ï¼Œ3ç§»åŠ¨3ä½æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¯”å®ƒå¤§çš„4ï¼Œä»¥æ­¤ç±»æ¨</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ€è·¯-4"><a href="#è§£é¢˜æ€è·¯-4" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>æˆ‘ä»¬ç»´æŠ¤è¿™æ ·ä¸€ä¸ªå•è°ƒé€’å‡çš„stackï¼Œstackå†…éƒ¨å­˜çš„æ˜¯åŸæ•°ç»„çš„æ¯ä¸ªindexã€‚æ¯å½“æˆ‘ä»¬é‡åˆ°ä¸€ä¸ªæ¯”å½“å‰æ ˆé¡¶æ‰€å¯¹åº”çš„æ•°ï¼ˆå°±æ˜¯nums[stack.peek()]ï¼‰å¤§çš„æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±é‡åˆ°äº†ä¸€ä¸ªâ€œå¤§æ•°â€œã€‚è¿™ä¸ªâ€å¤§æ•°â€œæ¯”å®ƒä¹‹å‰å¤šå°‘ä¸ªæ•°å¤§æˆ‘ä»¬ä¸çŸ¥é“ï¼Œä½†æ˜¯è‡³å°‘æ¯”å½“å‰æ ˆé¡¶æ‰€å¯¹åº”çš„æ•°å¤§ã€‚æˆ‘ä»¬å¼¹å‡ºæ ˆå†…æ‰€æœ‰å¯¹åº”æ•°æ¯”è¿™ä¸ªæ•°å°çš„æ ˆå†…å…ƒç´ ï¼Œå¹¶æ›´æ–°å®ƒä»¬åœ¨è¿”å›æ•°ç»„ä¸­å¯¹åº”ä½ç½®çš„å€¼ã€‚å› ä¸ºè¿™ä¸ªæ ˆæœ¬èº«çš„å•è°ƒæ€§ï¼Œå½“æˆ‘ä»¬æ ˆé¡¶å…ƒç´ æ‰€å¯¹åº”çš„æ•°æ¯”è¿™ä¸ªå…ƒç´ å¤§çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä¿è¯ï¼Œæ ˆå†…æ‰€æœ‰å…ƒç´ éƒ½æ¯”è¿™ä¸ªå…ƒç´ å¤§ã€‚å¯¹äºæ¯ä¸€ä¸ªå…ƒç´ ï¼Œå½“å®ƒå‡ºæ ˆçš„æ—¶å€™ï¼Œè¯´æ˜å®ƒé‡åˆ°äº†è‡ªå·±çš„next greater elementï¼Œæˆ‘ä»¬ä¹Ÿå°±è¦æ›´æ–°returnæ•°ç»„ä¸­çš„å¯¹åº”ä½ç½®çš„å€¼ã€‚å¦‚æœä¸€ä¸ªå…ƒç´ ä¸€ç›´ä¸æ›¾å‡ºæ ˆï¼Œé‚£ä¹ˆè¯´æ˜ä¸å­˜åœ¨next greater elementï¼Œæˆ‘ä»¬ä¹Ÿå°±ä¸ç”¨æ›´æ–°returnæ•°ç»„äº†ã€‚</p><h3 id="ä»£ç -4"><a href="#ä»£ç -4" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] nextExceed(<span class="type">int</span>[] nums) &#123;</span><br><span class="line">     <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">     <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">     <span class="comment">// å¡«å……-1</span></span><br><span class="line">     Arrays.fill(res, -<span class="number">1</span>);</span><br><span class="line">     Deque&lt;Integer&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">     <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">         <span class="comment">// å¦‚æœæ ˆä¸ä¸ºç©ºå¹¶ä¸”å½“å‰å…ƒç´ å¤§äºæ ˆé¡¶å…ƒç´ </span></span><br><span class="line">         <span class="comment">// å¼¹å‡ºæ ˆä¸­æ¯”å½“å‰å°çš„å…ƒç´ ï¼Œå¹¶æ›´æ–°å®ƒä»¬åœ¨è¿”å›æ•°ç»„ä¸­å¯¹åº”ä½ç½®çš„å€¼ï¼ˆç§»åŠ¨çš„æ­¥æ•°ï¼‰</span></span><br><span class="line">         <span class="comment">// æ ˆé‡Œé¢éœ€è¦ä¿å­˜å…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ï¼Œè€Œä¸æ˜¯å…·ä½“çš„æ•°å­—ã€‚å› ä¸ºéœ€è¦æ ¹æ®ä¸‹æ ‡ä¿®æ”¹ç»“æœæ•°ç»„</span></span><br><span class="line">         <span class="keyword">while</span> (!stack.isEmpty() &amp;&amp; nums[i] &gt; nums[stack.peek()]) &#123;          </span><br><span class="line">             res[stack.peek()] = i - stack.peek();</span><br><span class="line">             stack.pop();</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="comment">// ä¸‹æ ‡å…¥æ ˆ</span></span><br><span class="line">         stack.push(i);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> res;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½ éœ€è¦äº†è§£è¿™14ç§ç¼–ç¨‹é¢è¯•æ¨¡å¼</title>
      <link href="/posts/d9dc84f3.html"/>
      <url>/posts/d9dc84f3.html</url>
      
        <content type="html"><![CDATA[<hr><p>ä½œè€…ï¼šFahim ul Haq</p><p>æœºå™¨ä¹‹å¿ƒç¼–è¯‘</p><p>å‚ä¸ï¼šPanda</p><h1 id="è§£é¢˜å¥—è·¯"><a href="#è§£é¢˜å¥—è·¯" class="headerlink" title="è§£é¢˜å¥—è·¯"></a>è§£é¢˜å¥—è·¯</h1><p>å’±ä»¬åœ¨é¢è¯•ç¨‹åºå‘˜å²—ä½æ—¶å¾€å¾€éœ€è¦ç»å†ä¸€ä¸ªç¼–ç¨‹é¢è¯•è¿‡ç¨‹ï¼Œé›‡ä¸»ä¼šå€Ÿæ­¤è€ƒéªŒé¢è¯•è€…çš„æŠ€æœ¯å®åŠ›ã€‚</p><p>ç„¶è€Œï¼Œè¿™äº›æŠ€æœ¯é—®é¢˜æœ‰æ—¶å€™å´å’Œæˆ‘ä»¬çš„å®é™…å·¥ä½œå¹¶æ— å¤ªå¤§å…³ç³»ï¼Œä¹Ÿç”±æ­¤å¯èƒ½ç»™æˆ‘ä»¬çš„ç¼–ç¨‹é¢è¯•å‡†å¤‡é˜¶æ®µå¸¦æ¥å¾ˆå¤§çš„å‹åŠ›ã€‚</p><p>æ›¾åœ¨ Facebook å’Œå¾®è½¯å·¥ä½œè¿‡çš„ Educative.io åˆ›å§‹äºº Fahim ul Haq è¿‘æ—¥å‘æ–‡æ€»ç»“äº†ç¼–ç¨‹é¢è¯•æ‰€é‡åˆ°çš„é—®é¢˜çš„ 14 ç§æœ€å¸¸è§çš„æ¨¡å¼ï¼Œä¹Ÿè®¸èƒ½å¸®ä½ çœ‹æ¸…å„ç§ç¼–ç¨‹é¢è¯•é—®é¢˜ã€ŒèƒŒåçš„çœŸç›¸ã€ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210225100733.png" alt="å›¾ç‰‡"></p><p>å¯¹å¾ˆå¤šå¼€å‘è€…æ¥è¯´ï¼Œç¼–ç¨‹å·¥ä½œçš„é¢è¯•å‡†å¤‡å¾ˆå®¹æ˜“è®©äººç„¦è™‘ã€‚é¢è¯•è¦æ¶‰åŠçš„ä¸œè¥¿å®åœ¨å¤ªå¤šï¼Œå…¶ä¸­å¾ˆå¤šè¿˜å¾€å¾€ä¸å¼€å‘è€…çš„æ—¥å¸¸å·¥ä½œæ— å…³ï¼Œåªä¼šé¢å¤–å¢æ·»å‹åŠ›ã€‚</p><p>è¿™ç§ç°çŠ¶å¯¼è‡´äº†ä¸€ä¸ªåæœï¼šç°åœ¨çš„å¼€å‘è€…å¾€å¾€éœ€è¦èŠ±è´¹æ•°å‘¨æ—¶é—´åœ¨ LeetCode ç­‰ç½‘ç«™ä¸Šäº†è§£ç»¼åˆæ•°ç™¾ä¸ªé—®é¢˜ã€‚</p><p>ä¸æˆ‘è°ˆè¿‡çš„å¼€å‘è€…åœ¨é¢è¯•å‰çš„ä¸€ä¸ªå¸¸è§ç„¦è™‘é—®é¢˜æ˜¯ï¼š<strong>æˆ‘æ˜¯å¦å·²ç»è§£å†³è¿‡è¶³å¤Ÿå¤šçš„å®é™…é—®é¢˜ï¼Ÿæˆ‘æœ¬å¯ä»¥åšåˆ°æ›´å¤šå—ï¼Ÿ</strong></p><p>è¿™å°±æ˜¯æˆ‘æƒ³è¦å¸®åŠ©å¼€å‘è€…äº†è§£æ¯ä¸ªé—®é¢˜èƒŒåçš„åº•å±‚æ¨¡å¼çš„åŸå› â€”â€”è¿™æ ·ä»–ä»¬å°±ä¸å¿…æ‹…å¿§è§£å†³æ•°ç™¾ä¸ªé—®é¢˜ä»¥åŠè¢« LeetCode æ•´å¾—ç–²æƒ«ä¸å ªäº†ã€‚</p><p>å¦‚æœä½ ç†è§£é¢è¯•çš„é€šç”¨æ¨¡å¼ï¼Œä½ å°±å¯ä»¥å°†å…¶ç”¨ä½œæ¨¡æ¿ï¼Œä»è€Œè§£å†³å„ç§å±‚çº§çš„ç¨æœ‰ä¸åŒçš„é—®é¢˜ã€‚</p><p>è¿™é‡Œæˆ‘å°†åˆ—å‡ºæœ€å¸¸è§çš„ 14 ç§æ¨¡å¼ï¼Œå®ƒä»¬å¯è¢«ç”¨äºè§£å†³ä»»ä½•ç¼–ç¨‹é¢è¯•é—®é¢˜ã€‚</p><p>å¦å¤–æˆ‘è¿˜ä¼šè¯´æ˜å¦‚ä½•è¯†åˆ«æ¯ç§æ¨¡å¼ï¼Œå¹¶ä¼šä¸ºæ¯ç§æ¨¡å¼æä¾›ä¸€äº›é—®é¢˜ç¤ºä¾‹ã€‚</p><p>è¿™äº›å†…å®¹éƒ½åªæ˜¯èœ»èœ“ç‚¹æ°´â€”â€”<strong>æˆ‘å¼ºçƒˆå»ºè®®ä½ çœ‹çœ‹è¯¾ç¨‹ã€ŠGrokking the Coding Interview: Patterns for Coding Questionsã€‹ï¼Œé‡Œé¢æä¾›äº†å…¨é¢çš„è§£é‡Šã€ç¤ºä¾‹å’Œç¼–ç¨‹å®è·µ</strong>ã€‚</p><p>ä¸‹é¢çš„æ¨¡å¼è¯´æ˜å‡è®¾ä½ å·²ç»çŸ¥æ‚‰äº†æ•°æ®ç»“æ„ã€‚å¦‚æœä½ è¿˜ä¸äº†è§£ï¼Œé‚£éœ€è¦è¡¥å……ä¸€ä¸‹çŸ¥è¯†ç‚¹å“¦ã€‚</p><p>æˆ‘ä»¬ä»Šå¤©å°†è¯´æ˜ä»¥ä¸‹ 14 ç§æ¨¡å¼ï¼š</p><blockquote><ul><li>1ï¼æ»‘åŠ¨çª—å£</li><li>2ï¼äºŒæŒ‡é’ˆæˆ–è¿­ä»£å™¨</li><li>3ï¼å¿«é€Ÿå’Œæ…¢é€ŸæŒ‡é’ˆæˆ–è¿­ä»£å™¨</li><li>4ï¼åˆå¹¶åŒºé—´</li><li>5ï¼å¾ªç¯æ’åº</li><li>6ï¼åŸåœ°åè½¬é“¾è¡¨</li><li>7ï¼æ ‘çš„å®½åº¦ä¼˜å…ˆæœç´¢ï¼ˆTree BFSï¼‰</li><li>8ï¼æ ‘çš„æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆTree DFSï¼‰</li><li>9ï¼Two Heaps</li><li>10ï¼å­é›†</li><li>11ï¼ç»è¿‡ä¿®æ”¹çš„äºŒå‰æœç´¢</li><li>12ï¼å‰ K ä¸ªå…ƒç´ </li><li>13ï¼K è·¯åˆå¹¶</li><li>14ï¼æ‹“æ‰‘æ’åº</li></ul></blockquote><p>æˆ‘ä»¬å¼€å§‹å§ï¼</p><span id="more"></span><h1 id="1ï¼æ»‘åŠ¨çª—å£"><a href="#1ï¼æ»‘åŠ¨çª—å£" class="headerlink" title="1ï¼æ»‘åŠ¨çª—å£"></a>1ï¼æ»‘åŠ¨çª—å£</h1><p>æ»‘åŠ¨çª—å£æ¨¡å¼æ˜¯ç”¨äºåœ¨ç»™å®šæ•°ç»„æˆ–é“¾è¡¨çš„ç‰¹å®šçª—å£å¤§å°ä¸Šæ‰§è¡Œæ‰€éœ€çš„æ“ä½œï¼Œæ¯”å¦‚å¯»æ‰¾åŒ…å«æ‰€æœ‰ 1 çš„æœ€é•¿å­æ•°ç»„ã€‚</p><p>ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹æ»‘åŠ¨çª—å£å¹¶é€ä¸ªå…ƒç´ åœ°å‘å³æ»‘ï¼Œå¹¶æ ¹æ®ä½ æ‰€æ±‚è§£çš„é—®é¢˜è°ƒæ•´çª—å£çš„é•¿åº¦ã€‚</p><p>åœ¨æŸäº›æƒ…å†µä¸‹çª—å£å¤§å°ä¼šä¿æŒæ’å®šï¼Œåœ¨å…¶å®ƒæƒ…å†µä¸‹çª—å£å¤§å°ä¼šå¢å¤§æˆ–å‡å°ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210225100646.png" alt="å›¾ç‰‡"></p><p>ä¸‹é¢æ˜¯ä¸€äº›ä½ å¯ä»¥ç”¨æ¥ç¡®å®šç»™å®šé—®é¢˜å¯èƒ½éœ€è¦æ»‘åŠ¨çª—å£çš„æ–¹æ³•ï¼š</p><blockquote><ul><li>é—®é¢˜çš„è¾“å…¥æ˜¯ä¸€ç§çº¿æ€§æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚é“¾è¡¨ã€æ•°ç»„æˆ–å­—ç¬¦ä¸²</li><li>ä½ è¢«è¦æ±‚æŸ¥æ‰¾æœ€é•¿&#x2F;æœ€çŸ­çš„å­å­—ç¬¦ä¸²ã€å­æ•°ç»„æˆ–æ‰€éœ€çš„å€¼</li></ul></blockquote><p>ä½ å¯ä»¥ä½¿ç”¨æ»‘åŠ¨çª—å£æ¨¡å¼å¤„ç†çš„å¸¸è§é—®é¢˜ï¼š</p><blockquote><ul><li>å¤§å°ä¸º K çš„å­æ•°ç»„çš„æœ€å¤§å’Œï¼ˆç®€å•ï¼‰</li><li>å¸¦æœ‰ K ä¸ªä¸åŒå­—ç¬¦çš„æœ€é•¿å­å­—ç¬¦ä¸²ï¼ˆä¸­ç­‰ï¼‰</li><li>å¯»æ‰¾å­—ç¬¦ç›¸åŒä½†æ’åºä¸ä¸€æ ·çš„å­—ç¬¦ä¸²ï¼ˆå›°éš¾ï¼‰</li></ul></blockquote><h1 id="2ï¼äºŒæŒ‡é’ˆæˆ–è¿­ä»£å™¨"><a href="#2ï¼äºŒæŒ‡é’ˆæˆ–è¿­ä»£å™¨" class="headerlink" title="2ï¼äºŒæŒ‡é’ˆæˆ–è¿­ä»£å™¨"></a>2ï¼äºŒæŒ‡é’ˆæˆ–è¿­ä»£å™¨</h1><p>äºŒæŒ‡é’ˆï¼ˆTwo Pointersï¼‰æ˜¯è¿™æ ·ä¸€ç§æ¨¡å¼ï¼š</p><p>ä¸¤ä¸ªæŒ‡é’ˆä»¥ä¸€å‰ä¸€åçš„æ¨¡å¼åœ¨æ•°æ®ç»“æ„ä¸­è¿­ä»£ï¼Œç›´åˆ°ä¸€ä¸ªæˆ–ä¸¤ä¸ªæŒ‡é’ˆè¾¾åˆ°æŸç§ç‰¹å®šæ¡ä»¶ã€‚</p><p>äºŒæŒ‡é’ˆé€šå¸¸åœ¨æ’åºæ•°ç»„æˆ–é“¾è¡¨ä¸­æœç´¢é…å¯¹æ—¶å¾ˆæœ‰ç”¨ï¼šæ¯”å¦‚å½“ä½ å¿…é¡»å°†ä¸€ä¸ªæ•°ç»„çš„æ¯ä¸ªå…ƒç´ ä¸å…¶å®ƒå…ƒç´ åšæ¯”è¾ƒæ—¶ã€‚</p><p>äºŒæŒ‡é’ˆæ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œå› ä¸ºå¦‚æœåªæœ‰ä¸€ä¸ªæŒ‡é’ˆï¼Œä½ å¿…é¡»ç»§ç»­åœ¨æ•°ç»„ä¸­å¾ªç¯å›æ¥æ‰èƒ½æ‰¾åˆ°ç­”æ¡ˆã€‚</p><p>è¿™ç§ä½¿ç”¨å•ä¸ªè¿­ä»£å™¨è¿›è¡Œæ¥å›åœ¨æ—¶é—´å’Œç©ºé—´å¤æ‚åº¦ä¸Šéƒ½å¾ˆä½æ•ˆâ€”â€”è¿™ä¸ªæ¦‚å¿µè¢«ç§°ä¸ºã€Œæ¸è¿›åˆ†æï¼ˆasymptotic analysisï¼‰ã€ã€‚</p><p>å°½ç®¡ä½¿ç”¨ 1 ä¸ªæŒ‡é’ˆè¿›è¡Œæš´åŠ›æœç´¢æˆ–ç®€å•æ™®é€šçš„è§£å†³æ–¹æ¡ˆä¹Ÿæœ‰æ•ˆæœï¼Œä½†è¿™ä¼šæ²¿ O(nÂ²) çº¿å¾—åˆ°ä¸€äº›ä¸œè¥¿ã€‚åœ¨å¾ˆå¤šæƒ…å†µä¸­ï¼ŒäºŒæŒ‡é’ˆæœ‰åŠ©äºä½ å¯»æ‰¾æœ‰æ›´å¥½ç©ºé—´æˆ–è¿è¡Œæ—¶é—´å¤æ‚åº¦çš„è§£å†³æ–¹æ¡ˆã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210225100642.webp" alt="å›¾ç‰‡"></p><p>ç”¨äºè¯†åˆ«ä½¿ç”¨äºŒæŒ‡é’ˆçš„æ—¶æœºçš„æ–¹æ³•ï¼š</p><blockquote><ul><li>å¯ç”¨äºä½ è¦å¤„ç†æ’åºæ•°ç»„ï¼ˆæˆ–é“¾æ¥åˆ—è¡¨ï¼‰å¹¶éœ€è¦æŸ¥æ‰¾æ»¡è¶³æŸäº›çº¦æŸçš„ä¸€ç»„å…ƒç´ çš„é—®é¢˜</li><li>æ•°ç»„ä¸­çš„å…ƒç´ é›†æ˜¯é…å¯¹ã€ä¸‰å…ƒç»„ç”šè‡³å­æ•°ç»„</li></ul></blockquote><p>ä¸‹é¢æ˜¯ä¸€äº›æ»¡è¶³äºŒæŒ‡é’ˆæ¨¡å¼çš„é—®é¢˜ï¼š</p><blockquote><ul><li>æ±‚ä¸€ä¸ªæ’åºæ•°ç»„çš„å¹³æ–¹ï¼ˆç®€å•ï¼‰</li><li>æ±‚æ€»å’Œä¸ºé›¶çš„ä¸‰å…ƒç»„ï¼ˆä¸­ç­‰ï¼‰</li><li>æ¯”è¾ƒåŒ…å«å›é€€ï¼ˆbackspaceï¼‰çš„å­—ç¬¦ä¸²ï¼ˆä¸­ç­‰ï¼‰</li></ul></blockquote><h1 id="3ï¼å¿«é€Ÿå’Œæ…¢é€ŸæŒ‡é’ˆ"><a href="#3ï¼å¿«é€Ÿå’Œæ…¢é€ŸæŒ‡é’ˆ" class="headerlink" title="3ï¼å¿«é€Ÿå’Œæ…¢é€ŸæŒ‡é’ˆ"></a>3ï¼å¿«é€Ÿå’Œæ…¢é€ŸæŒ‡é’ˆ</h1><p>å¿«é€Ÿå’Œæ…¢é€ŸæŒ‡é’ˆæ–¹æ³•ä¹Ÿè¢«ç§°ä¸º Hare &amp; Tortoise ç®—æ³•ï¼Œè¯¥ç®—æ³•ä¼šä½¿ç”¨ä¸¤ä¸ªåœ¨æ•°ç»„ï¼ˆæˆ–åºåˆ—&#x2F;é“¾è¡¨ï¼‰ä¸­ä»¥ä¸åŒé€Ÿåº¦ç§»åŠ¨çš„æŒ‡é’ˆã€‚è¯¥æ–¹æ³•åœ¨å¤„ç†å¾ªç¯é“¾è¡¨æˆ–æ•°ç»„æ—¶éå¸¸æœ‰ç”¨ã€‚</p><p>é€šè¿‡ä»¥ä¸åŒçš„é€Ÿåº¦è¿›è¡Œç§»åŠ¨ï¼ˆæ¯”å¦‚åœ¨ä¸€ä¸ªå¾ªç¯é“¾è¡¨ä¸­ï¼‰ï¼Œè¯¥ç®—æ³•è¯æ˜è¿™ä¸¤ä¸ªæŒ‡é’ˆæ³¨å®šä¼šç›¸é‡ã€‚åªè¦è¿™ä¸¤ä¸ªæŒ‡é’ˆåœ¨åŒä¸€ä¸ªå¾ªç¯ä¸­ï¼Œå¿«é€ŸæŒ‡é’ˆå°±ä¼šè¿½èµ¶ä¸Šæ…¢é€ŸæŒ‡é’ˆã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210225100638.webp" alt="å›¾ç‰‡"></p><p>å¦‚ä½•åˆ¤åˆ«ä½¿ç”¨å¿«é€Ÿå’Œæ…¢é€Ÿæ¨¡å¼çš„æ—¶æœºï¼Ÿ</p><blockquote><ul><li>å¤„ç†é“¾è¡¨æˆ–æ•°ç»„ä¸­çš„å¾ªç¯çš„é—®é¢˜</li><li>å½“ä½ éœ€è¦çŸ¥é“ç‰¹å®šå…ƒç´ çš„ä½ç½®æˆ–é“¾è¡¨çš„æ€»é•¿åº¦æ—¶</li></ul></blockquote><p>ä½•æ—¶åº”è¯¥ä¼˜å…ˆé€‰æ‹©è¿™ç§æ–¹æ³•ï¼Œè€Œä¸æ˜¯ä¸Šé¢æåˆ°çš„äºŒæŒ‡é’ˆæ–¹æ³•ï¼Ÿ</p><blockquote><ul><li>æœ‰äº›æƒ…å†µä¸é€‚åˆä½¿ç”¨äºŒæŒ‡é’ˆæ–¹æ³•ï¼Œæ¯”å¦‚åœ¨ä¸èƒ½åå‘ç§»åŠ¨çš„å•é“¾æ¥é“¾è¡¨ä¸­ã€‚ä½¿ç”¨å¿«é€Ÿå’Œæ…¢é€Ÿæ¨¡å¼çš„ä¸€ä¸ªæ¡ˆä¾‹æ˜¯å½“ä½ æƒ³è¦ç¡®å®šä¸€ä¸ªé“¾è¡¨æ˜¯å¦ä¸ºå›æ–‡ï¼ˆpalindromeï¼‰æ—¶ã€‚</li></ul></blockquote><p>ä¸‹é¢æ˜¯ä¸€äº›æ»¡è¶³å¿«é€Ÿå’Œæ…¢é€ŸæŒ‡é’ˆæ¨¡å¼çš„é—®é¢˜ï¼š</p><blockquote><ul><li>é“¾è¡¨å¾ªç¯ï¼ˆç®€å•ï¼‰</li><li>å›æ–‡é“¾è¡¨ï¼ˆä¸­ç­‰ï¼‰</li><li>ç¯å½¢æ•°ç»„ä¸­çš„å¾ªç¯ï¼ˆå›°éš¾ï¼‰</li></ul></blockquote><h1 id="4ï¼åˆå¹¶åŒºé—´"><a href="#4ï¼åˆå¹¶åŒºé—´" class="headerlink" title="4ï¼åˆå¹¶åŒºé—´"></a>4ï¼åˆå¹¶åŒºé—´</h1><p>åˆå¹¶åŒºé—´æ¨¡å¼æ˜¯ä¸€ç§å¤„ç†é‡å åŒºé—´çš„æœ‰æ•ˆæŠ€æœ¯ã€‚</p><p>åœ¨å¾ˆå¤šæ¶‰åŠåŒºé—´çš„é—®é¢˜ä¸­ï¼Œä½ æ—¢éœ€è¦æ‰¾åˆ°é‡å çš„åŒºé—´ï¼Œä¹Ÿéœ€è¦åœ¨è¿™äº›åŒºé—´é‡å æ—¶åˆå¹¶å®ƒä»¬ã€‚è¯¥æ¨¡å¼çš„å·¥ä½œæ–¹å¼ä¸ºï¼š</p><p>ç»™å®šä¸¤ä¸ªåŒºé—´ï¼ˆa å’Œ bï¼‰ï¼Œè¿™ä¸¤ä¸ªåŒºé—´æœ‰ 6 ç§ä¸åŒçš„äº’ç›¸å…³è”çš„æ–¹å¼ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210225100634.webp" alt="å›¾ç‰‡"></p><p>ç†è§£å¹¶è¯†åˆ«è¿™å…­ç§æƒ…å†µæœ‰åŠ©äºä½ æ±‚è§£èŒƒå›´å¹¿æ³›çš„é—®é¢˜ï¼Œä»æ’å…¥åŒºé—´åˆ°ä¼˜åŒ–åŒºé—´åˆå¹¶ç­‰ã€‚</p><p>é‚£ä¹ˆå¦‚ä½•ç¡®å®šä½•æ—¶è¯¥ä½¿ç”¨åˆå¹¶åŒºé—´æ¨¡å¼å‘¢ï¼Ÿ</p><blockquote><ul><li>å¦‚æœä½ è¢«è¦æ±‚å¾—åˆ°ä¸€ä¸ªä»…å«äº’æ–¥åŒºé—´çš„åˆ—è¡¨</li><li>å¦‚æœä½ å¬åˆ°äº†æœ¯è¯­ã€Œé‡å åŒºé—´ï¼ˆoverlapping intervalsï¼‰ã€</li></ul></blockquote><p>åˆå¹¶åŒºé—´æ¨¡å¼çš„é—®é¢˜ï¼š</p><blockquote><ul><li>åŒºé—´äº¤å‰ï¼ˆä¸­ç­‰ï¼‰</li><li>æœ€å¤§ CPU è´Ÿè½½ï¼ˆå›°éš¾ï¼‰</li></ul></blockquote><h1 id="5-å¾ªç¯æ’åº"><a href="#5-å¾ªç¯æ’åº" class="headerlink" title="5. å¾ªç¯æ’åº"></a>5. å¾ªç¯æ’åº</h1><p>è¿™ä¸€æ¨¡å¼æè¿°äº†ä¸€ç§æœ‰è¶£çš„æ–¹æ³•ï¼Œå¤„ç†çš„æ˜¯æ¶‰åŠåŒ…å«ç»™å®šèŒƒå›´å†…æ•°å€¼çš„æ•°ç»„çš„é—®é¢˜ã€‚</p><p>å¾ªç¯æ’åºæ¨¡å¼ä¸€æ¬¡ä¼šåœ¨æ•°ç»„ä¸Šè¿­ä»£ä¸€ä¸ªæ•°å€¼ï¼Œå¦‚æœæ‰€è¿­ä»£çš„å½“å‰æ•°å€¼ä¸åœ¨æ­£ç¡®çš„ç´¢å¼•å¤„ï¼Œå°±å°†å…¶ä¸å…¶æ­£ç¡®ç´¢å¼•å¤„çš„æ•°å€¼äº¤æ¢ã€‚</p><p>ä½ å¯ä»¥å°è¯•æ›¿æ¢å…¶æ­£ç¡®ç´¢å¼•å¤„çš„æ•°å€¼ï¼Œä½†è¿™ä¼šå¸¦æ¥ O(n^2) çš„å¤æ‚åº¦ï¼Œè¿™ä¸æ˜¯æœ€ä¼˜çš„ï¼Œå› æ­¤è¦ç”¨å¾ªç¯æ’åºæ¨¡å¼ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210225100619.webp" alt="å›¾ç‰‡"></p><p>å¦‚ä½•è¯†åˆ«è¿™ç§æ¨¡å¼ï¼Ÿ</p><blockquote><ul><li>æ¶‰åŠæ•°å€¼åœ¨ç»™å®šèŒƒå›´å†…çš„æ’åºæ•°ç»„çš„é—®é¢˜</li><li>å¦‚æœé—®é¢˜è¦æ±‚ä½ åœ¨ä¸€ä¸ªæ’åº&#x2F;æ—‹è½¬çš„æ•°ç»„ä¸­æ‰¾åˆ°ç¼ºå¤±å€¼&#x2F;é‡å¤å€¼&#x2F;æœ€å°å€¼</li></ul></blockquote><p>å¾ªç¯æ’åºæ¨¡å¼çš„é—®é¢˜ï¼š</p><blockquote><ul><li>æ‰¾åˆ°ç¼ºå¤±å€¼ï¼ˆç®€å•ï¼‰</li><li>æ‰¾åˆ°æœ€å°çš„ç¼ºå¤±çš„æ­£æ•°å€¼ï¼ˆä¸­ç­‰ï¼‰</li></ul></blockquote><h1 id="6-åŸåœ°åè½¬é“¾è¡¨"><a href="#6-åŸåœ°åè½¬é“¾è¡¨" class="headerlink" title="6. åŸåœ°åè½¬é“¾è¡¨"></a>6. åŸåœ°åè½¬é“¾è¡¨</h1><p>åœ¨å¾ˆå¤šé—®é¢˜ä¸­ï¼Œä½ å¯èƒ½ä¼šè¢«è¦æ±‚åè½¬ä¸€ä¸ªé“¾è¡¨ä¸­ä¸€ç»„èŠ‚ç‚¹ä¹‹é—´çš„é“¾æ¥ã€‚</p><p>é€šå¸¸è€Œè¨€ï¼Œä½ éœ€è¦åŸåœ°å®Œæˆè¿™ä¸€ä»»åŠ¡ï¼Œå³ä½¿ç”¨å·²æœ‰çš„èŠ‚ç‚¹å¯¹è±¡ä¸”ä¸å ç”¨é¢å¤–çš„å†…å­˜ã€‚è¿™å°±æ˜¯è¿™ä¸ªæ¨¡å¼çš„ç”¨æ­¦ä¹‹åœ°ã€‚</p><p>è¯¥æ¨¡å¼ä¼šä»ä¸€ä¸ªæŒ‡å‘é“¾è¡¨å¤´çš„å˜é‡ï¼ˆcurrentï¼‰å¼€å§‹ä¸€æ¬¡åè½¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç„¶åä¸€ä¸ªå˜é‡ï¼ˆpreviousï¼‰å°†æŒ‡å‘å·²ç»å¤„ç†è¿‡çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p><p>ä»¥é”æ­¥çš„æ–¹å¼ï¼Œåœ¨ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¹‹å‰å°†å…¶æŒ‡å‘å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¯å®ç°å¯¹å½“å‰èŠ‚ç‚¹çš„åè½¬ã€‚</p><p>å¦å¤–ï¼Œä¹Ÿå°†æ›´æ–°å˜é‡ã€Œpreviousã€ï¼Œä½¿å…¶æ€»æ˜¯æŒ‡å‘å·²ç»å¤„ç†è¿‡çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210225102126.webp" alt="å›¾ç‰‡"></p><p>å¦‚ä½•è¯†åˆ«ä½¿ç”¨è¯¥æ¨¡å¼çš„æ—¶æœºï¼š</p><blockquote><ul><li>å¦‚æœä½ è¢«è¦æ±‚åœ¨ä¸ä½¿ç”¨é¢å¤–å†…å­˜çš„å‰æä¸‹åè½¬ä¸€ä¸ªé“¾è¡¨</li></ul></blockquote><p>åŸåœ°åè½¬é“¾è¡¨æ¨¡å¼çš„é—®é¢˜ï¼š</p><blockquote><ul><li>åè½¬ä¸€ä¸ªå­åˆ—è¡¨ï¼ˆä¸­ç­‰ï¼‰</li><li>åè½¬æ¯ä¸ª K ä¸ªå…ƒç´ çš„å­åˆ—è¡¨ï¼ˆä¸­ç­‰ï¼‰</li></ul></blockquote><h1 id="7ï¼æ ‘çš„å®½åº¦ä¼˜å…ˆæœç´¢ï¼ˆTree-BFSï¼‰"><a href="#7ï¼æ ‘çš„å®½åº¦ä¼˜å…ˆæœç´¢ï¼ˆTree-BFSï¼‰" class="headerlink" title="7ï¼æ ‘çš„å®½åº¦ä¼˜å…ˆæœç´¢ï¼ˆTree BFSï¼‰"></a>7ï¼æ ‘çš„å®½åº¦ä¼˜å…ˆæœç´¢ï¼ˆTree BFSï¼‰</h1><p>è¯¥æ¨¡å¼åŸºäºå®½åº¦ä¼˜å…ˆæœç´¢ï¼ˆBFSï¼‰æŠ€æœ¯ï¼Œå¯éå†ä¸€ä¸ªæ ‘å¹¶ä½¿ç”¨ä¸€ä¸ªé˜Ÿåˆ—æ¥è·Ÿè¸ªä¸€ä¸ªå±‚çº§çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œä¹‹åå†è·³è½¬åˆ°ä¸‹ä¸€ä¸ªå±‚çº§ã€‚</p><p>ä»»ä½•æ¶‰åŠåˆ°ä»¥é€å±‚çº§æ–¹å¼éå†æ ‘çš„é—®é¢˜éƒ½å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹æ³•æœ‰æ•ˆè§£å†³ã€‚</p><p>Tree BFS æ¨¡å¼çš„å·¥ä½œæ–¹å¼æ˜¯ï¼šå°†æ ¹èŠ‚ç‚¹æ¨è‡³é˜Ÿåˆ—ï¼Œç„¶åè¿ç»­è¿­ä»£çŸ¥é“é˜Ÿåˆ—ä¸ºç©ºã€‚åœ¨æ¯æ¬¡è¿­ä»£ä¸­ï¼Œæˆ‘ä»¬ç§»é™¤é˜Ÿåˆ—å¤´éƒ¨çš„èŠ‚ç‚¹å¹¶ã€Œè®¿é—®ã€è¯¥èŠ‚ç‚¹ã€‚åœ¨ç§»é™¤äº†é˜Ÿåˆ—ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ä¹‹åï¼Œæˆ‘ä»¬è¿˜å°†å…¶æ‰€æœ‰å­èŠ‚ç‚¹æ’å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚</p><p>å¦‚ä½•è¯†åˆ« Tree BFS æ¨¡å¼ï¼š</p><blockquote><ul><li>å¦‚æœä½ è¢«è¦æ±‚ä»¥é€å±‚çº§æ–¹å¼éå†ï¼ˆæˆ–æŒ‰å±‚çº§é¡ºåºéå†ï¼‰ä¸€ä¸ªæ ‘</li></ul></blockquote><p>Tree BFS æ¨¡å¼çš„é—®é¢˜ï¼š</p><blockquote><ul><li>äºŒå‰æ ‘å±‚çº§é¡ºåºéå†ï¼ˆç®€å•ï¼‰</li><li>ä¹‹å­—å‹éå†ï¼ˆZigzag Traversalï¼‰ï¼ˆä¸­ç­‰ï¼‰</li></ul></blockquote><h1 id="8ï¼æ ‘çš„æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆTree-DFSï¼‰"><a href="#8ï¼æ ‘çš„æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆTree-DFSï¼‰" class="headerlink" title="8ï¼æ ‘çš„æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆTree DFSï¼‰"></a>8ï¼æ ‘çš„æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆTree DFSï¼‰</h1><p>Tree DFS æ˜¯åŸºäºæ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰æŠ€æœ¯æ¥éå†æ ‘ã€‚</p><p>ä½ å¯ä»¥ä½¿ç”¨é€’å½’ï¼ˆæˆ–è¯¥è¿­ä»£æ–¹æ³•çš„æŠ€æœ¯æ ˆï¼‰æ¥åœ¨éå†æœŸé—´ä¿æŒå¯¹æ‰€æœ‰ä¹‹å‰çš„ï¼ˆçˆ¶ï¼‰èŠ‚ç‚¹çš„è·Ÿè¸ªã€‚</p><p>Tree DFS æ¨¡å¼çš„å·¥ä½œæ–¹å¼æ˜¯ä»æ ‘çš„æ ¹éƒ¨å¼€å§‹ï¼Œå¦‚æœè¿™ä¸ªèŠ‚ç‚¹ä¸æ˜¯ä¸€ä¸ªå¶èŠ‚ç‚¹ï¼Œåˆ™éœ€è¦åšä¸¤ä»¶äº‹ï¼š</p><blockquote><ul><li>1ï¼å†³å®šç°åœ¨æ˜¯å¤„ç†å½“å‰çš„èŠ‚ç‚¹ï¼ˆpre-orderï¼‰ï¼Œæˆ–æ˜¯åœ¨å¤„ç†ä¸¤ä¸ªå­èŠ‚ç‚¹ä¹‹é—´ï¼ˆin-orderï¼‰ï¼Œè¿˜æ˜¯åœ¨å¤„ç†ä¸¤ä¸ªå­èŠ‚ç‚¹ä¹‹åï¼ˆpost-orderï¼‰</li><li>2ï¼ä¸ºå½“å‰èŠ‚ç‚¹çš„ä¸¤ä¸ªå­èŠ‚ç‚¹æ‰§è¡Œä¸¤æ¬¡é€’å½’è°ƒç”¨ä»¥å¤„ç†å®ƒä»¬</li></ul></blockquote><p>å¦‚ä½•è¯†åˆ« Tree DFS æ¨¡å¼ï¼š</p><blockquote><ul><li>å¦‚æœä½ è¢«è¦æ±‚ç”¨ in-orderã€pre-order æˆ– post-order DFS æ¥éå†ä¸€ä¸ªæ ‘</li><li>å¦‚æœé—®é¢˜éœ€è¦æœç´¢å…¶ä¸­èŠ‚ç‚¹æ›´æ¥è¿‘å¶èŠ‚ç‚¹çš„ä¸œè¥¿</li></ul></blockquote><p>Tree DFS æ¨¡å¼çš„é—®é¢˜ï¼š</p><blockquote><ul><li>è·¯å¾„æ•°é‡ä¹‹å’Œï¼ˆä¸­ç­‰ï¼‰</li><li>ä¸€ä¸ªå’Œçš„æ‰€æœ‰è·¯å¾„ï¼ˆä¸­ç­‰ï¼‰</li></ul></blockquote><h1 id="9ï¼Two-Heaps"><a href="#9ï¼Two-Heaps" class="headerlink" title="9ï¼Two Heaps"></a>9ï¼Two Heaps</h1><p>åœ¨å¾ˆå¤šé—®é¢˜ä¸­ï¼Œæˆ‘ä»¬è¦å°†ç»™å®šçš„ä¸€ç»„å…ƒç´ åˆ†ä¸ºä¸¤éƒ¨åˆ†ã€‚</p><p>ä¸ºäº†æ±‚è§£è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ„Ÿå…´è¶£çš„æ˜¯äº†è§£ä¸€éƒ¨åˆ†çš„æœ€å°å…ƒç´ ä»¥åŠå¦ä¸€éƒ¨åˆ†çš„æœ€å¤§å…ƒç´ ã€‚è¿™ä¸€æ¨¡å¼æ˜¯æ±‚è§£è¿™ç±»é—®é¢˜çš„ä¸€ç§æœ‰æ•ˆæ–¹æ³•ã€‚</p><p>è¯¥æ¨¡å¼è¦ä½¿ç”¨ä¸¤ä¸ªå †ï¼ˆheapï¼‰ï¼šä¸€ä¸ªç”¨äºå¯»æ‰¾æœ€å°å…ƒç´ çš„ Min Heap å’Œä¸€ä¸ªç”¨äºå¯»æ‰¾æœ€å¤§å…ƒç´ çš„ Max Heapã€‚</p><p>è¯¥æ¨¡å¼çš„å·¥ä½œæ–¹å¼æ˜¯ï¼š</p><p>å…ˆå°†å‰ä¸€åŠçš„æ•°å€¼å­˜å‚¨åˆ° Max Heapï¼Œè¿™æ˜¯ç”±äºä½ è¦å¯»æ‰¾å‰ä¸€åŠä¸­çš„æœ€å¤§æ•°å€¼ã€‚ç„¶åå†å°†å¦ä¸€åŠå­˜å‚¨åˆ° Min Heapï¼Œå› ä¸ºä½ è¦å¯»æ‰¾ç¬¬äºŒåŠçš„æœ€å°æ•°å€¼ã€‚åœ¨ä»»ä½•æ—¶å€™ï¼Œå½“å‰æ•°å€¼åˆ—è¡¨çš„ä¸­é—´å€¼éƒ½å¯ä»¥æ ¹æ®è¿™ä¸¤ä¸ª heap çš„é¡¶éƒ¨å…ƒç´ è®¡ç®—å¾—åˆ°ã€‚</p><p>è¯†åˆ« Two Heaps æ¨¡å¼çš„æ–¹æ³•ï¼š</p><blockquote><ul><li>åœ¨ä¼˜å…ˆçº§é˜Ÿåˆ—ã€è°ƒåº¦ç­‰åœºæ™¯ä¸­æœ‰ç”¨</li><li>å¦‚æœé—®é¢˜è¯´ä½ éœ€è¦æ‰¾åˆ°ä¸€ä¸ªé›†åˆçš„æœ€å°&#x2F;æœ€å¤§&#x2F;ä¸­é—´å…ƒç´ </li><li>æœ‰æ—¶å€™å¯ç”¨äºå…·æœ‰äºŒå‰æ ‘æ•°æ®ç»“æ„çš„é—®é¢˜</li></ul></blockquote><p>Two Heaps æ¨¡å¼çš„é—®é¢˜ï¼š</p><blockquote><ul><li>æŸ¥æ‰¾ä¸€ä¸ªæ•°å€¼æµçš„ä¸­é—´å€¼ï¼ˆä¸­ç­‰ï¼‰</li></ul></blockquote><h1 id="10ï¼å­é›†"><a href="#10ï¼å­é›†" class="headerlink" title="10ï¼å­é›†"></a>10ï¼å­é›†</h1><p>å¾ˆå¤šç¼–ç¨‹é¢è¯•é—®é¢˜éƒ½æ¶‰åŠåˆ°å¤„ç†ç»™å®šå…ƒç´ é›†åˆçš„æ’åˆ—å’Œç»„åˆã€‚</p><p>å­é›†ï¼ˆSubsetsï¼‰æ¨¡å¼æè¿°äº†ä¸€ç§ç”¨äºæœ‰æ•ˆå¤„ç†æ‰€æœ‰è¿™äº›é—®é¢˜çš„å®½åº¦ä¼˜å…ˆæœç´¢ï¼ˆBFSï¼‰æ–¹æ³•ã€‚</p><p>è¯¥æ¨¡å¼çœ‹èµ·æ¥æ˜¯è¿™æ ·ï¼š</p><p>ç»™å®šä¸€ä¸ªé›†åˆ [1, 5, 3]</p><blockquote><ul><li>1ï¼ ä»ä¸€ä¸ªç©ºé›†å¼€å§‹ï¼š[[]]</li><li>2ï¼å‘æ‰€æœ‰å·²æœ‰å­é›†æ·»åŠ ç¬¬ä¸€ä¸ªæ•° (1)ï¼Œä»è€Œåˆ›é€ æ–°çš„å­é›†ï¼š[[], [1]]</li><li>3ï¼å‘æ‰€æœ‰å·²æœ‰å­é›†æ·»åŠ ç¬¬äºŒä¸ªæ•° (5)ï¼š[[], [1], [5], [1,5]]</li><li>4ï¼å‘æ‰€æœ‰å·²æœ‰å­é›†æ·»åŠ ç¬¬ä¸‰ä¸ªæ•° (3)ï¼š[[], [1], [5], [1,5], [3], [1,3], [5,3], [1,5,3]]</li></ul></blockquote><p>ä¸‹é¢æ˜¯è¿™ç§å­é›†æ¨¡å¼çš„ä¸€ç§è§†è§‰è¡¨ç¤ºï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210225100608.webp" alt="å›¾ç‰‡"></p><p>å¦‚ä½•è¯†åˆ«å­é›†æ¨¡å¼ï¼š</p><blockquote><ul><li>ä½ éœ€è¦æ‰¾åˆ°ç»™å®šé›†åˆçš„ç»„åˆæˆ–æ’åˆ—çš„é—®é¢˜</li></ul></blockquote><p>å­é›†æ¨¡å¼çš„é—®é¢˜ï¼š</p><blockquote><ul><li>å¸¦æœ‰é‡å¤é¡¹çš„å­é›†ï¼ˆç®€å•ï¼‰</li><li>é€šè¿‡æ”¹å˜å¤§å°å†™çš„å­—ç¬¦ä¸²æ’åˆ—ï¼ˆä¸­ç­‰ï¼‰</li></ul></blockquote><h1 id="11ï¼ç»è¿‡ä¿®æ”¹çš„äºŒå‰æœç´¢"><a href="#11ï¼ç»è¿‡ä¿®æ”¹çš„äºŒå‰æœç´¢" class="headerlink" title="11ï¼ç»è¿‡ä¿®æ”¹çš„äºŒå‰æœç´¢"></a>11ï¼ç»è¿‡ä¿®æ”¹çš„äºŒå‰æœç´¢</h1><p>åªè¦ç»™å®šäº†æ’åºæ•°ç»„ã€é“¾è¡¨æˆ–çŸ©é˜µï¼Œå¹¶è¦æ±‚å¯»æ‰¾ä¸€ä¸ªç‰¹å®šå…ƒç´ ï¼Œä½ å¯ä»¥ä½¿ç”¨çš„æœ€ä½³ç®—æ³•å°±æ˜¯äºŒå‰æœç´¢ã€‚</p><p>è¿™ä¸€æ¨¡å¼æè¿°äº†ä¸€ç§ç”¨äºå¤„ç†æ‰€æœ‰æ¶‰åŠäºŒå‰æœç´¢çš„é—®é¢˜çš„æœ‰æ•ˆæ–¹æ³•ã€‚</p><p>å¯¹äºä¸€ä¸ªå‡åºçš„é›†åˆï¼Œè¯¥æ¨¡å¼çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š</p><blockquote><ul><li>1ï¼é¦–å…ˆï¼Œæ‰¾åˆ°èµ·ç‚¹å’Œç»ˆç‚¹çš„ä¸­é—´ä½ç½®ã€‚<br>å¯»æ‰¾ä¸­é—´ä½ç½®çš„ä¸€ç§ç®€å•æ–¹æ³•æ˜¯ï¼šmiddle &#x3D; (start + end) &#x2F; 2ã€‚<br>ä½†è¿™å¾ˆæœ‰å¯èƒ½é€ æˆæ•´æ•°æº¢å‡ºï¼Œæ‰€ä»¥æ¨èä½ è¿™æ ·è¡¨ç¤ºä¸­é—´ä½ç½®ï¼šmiddle &#x3D; start + (endâ€”start) &#x2F; 2ã€‚</li><li>2ï¼å¦‚æœé”®å€¼ï¼ˆkeyï¼‰ç­‰äºä¸­é—´ç´¢å¼•å¤„çš„å€¼ï¼Œé‚£ä¹ˆè¿”å›è¿™ä¸ªä¸­é—´ä½ç½®ã€‚</li><li>3ï¼å¦‚æœé”®å€¼ä¸ç­‰äºä¸­é—´ç´¢å¼•å¤„çš„å€¼ï¼š</li><li>4ï¼æ£€æŸ¥ key &lt; arr[middle] æ˜¯å¦æˆç«‹ã€‚å¦‚æœæˆç«‹ï¼Œå°†æœç´¢çº¦ç®€åˆ° end &#x3D; middleâ€”1ã€æ¢è¡Œã€‘5ï¼æ£€æŸ¥ key &gt; arr[middle] æ˜¯å¦æˆç«‹ã€‚å¦‚æœæˆç«‹ï¼Œå°†æœç´¢çº¦ç®€åˆ° end &#x3D; middle + 1</li></ul></blockquote><p>ä¸‹é¢ç»™å‡ºäº†è¿™ç§ç»è¿‡ä¿®æ”¹çš„äºŒå‰æœç´¢æ¨¡å¼çš„è§†è§‰è¡¨ç¤ºï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210225100608.webp" alt="å›¾ç‰‡"></p><p>ç»è¿‡ä¿®æ”¹çš„äºŒå‰æœç´¢æ¨¡å¼çš„é—®é¢˜ï¼š</p><blockquote><ul><li>ä¸é¡ºåºæ— å…³çš„äºŒå‰æœç´¢ï¼ˆç®€å•ï¼‰</li><li>åœ¨ç»è¿‡æ’åºçš„æ— é™æ•°ç»„ä¸­æœç´¢ï¼ˆä¸­ç­‰ï¼‰</li></ul></blockquote><h1 id="12-å‰-K-ä¸ªå…ƒç´ "><a href="#12-å‰-K-ä¸ªå…ƒç´ " class="headerlink" title="12. å‰ K ä¸ªå…ƒç´ "></a>12. å‰ K ä¸ªå…ƒç´ </h1><p>ä»»ä½•è¦æ±‚æˆ‘ä»¬æ‰¾åˆ°ä¸€ä¸ªç»™å®šé›†åˆä¸­å‰é¢çš„&#x2F;æœ€å°çš„&#x2F;æœ€å¸¸å‡ºç°çš„ K çš„å…ƒç´ çš„é—®é¢˜éƒ½åœ¨è¿™ä¸€æ¨¡å¼çš„èŒƒå›´å†…ã€‚</p><p>è·Ÿè¸ª K ä¸ªå…ƒç´ çš„æœ€ä½³çš„æ•°æ®ç»“æ„æ˜¯ Heapã€‚</p><p>è¿™ä¸€æ¨¡å¼ä¼šä½¿ç”¨ Heap æ¥æ±‚è§£å¤šä¸ªä¸€æ¬¡æ€§å¤„ç†ä¸€ä¸ªç»™å®šå…ƒç´ é›†ä¸­ K ä¸ªå…ƒç´ çš„é—®é¢˜ã€‚</p><p>è¯¥æ¨¡å¼æ˜¯è¿™æ ·å·¥ä½œçš„ï¼š</p><blockquote><ul><li>1ï¼æ ¹æ®é—®é¢˜çš„ä¸åŒï¼Œå°† K ä¸ªå…ƒç´ æ’å…¥åˆ° min-heap æˆ– max-heap ä¸­</li><li>2ï¼è¿­ä»£å¤„ç†å‰©ä½™çš„æ•°ï¼Œå¦‚æœä½ æ‰¾åˆ°ä¸€ä¸ªæ¯” heap ä¸­æ•°æ›´å¤§çš„æ•°ï¼Œé‚£ä¹ˆå°±ç§»é™¤é‚£ä¸ªæ•°å¹¶æ’å…¥è¿™ä¸ªæ›´å¤§çš„æ•°</li></ul></blockquote><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210225100602.webp" alt="å›¾ç‰‡"></p><p>è¿™é‡Œæ— éœ€æ’åºç®—æ³•ï¼Œå› ä¸º heap å°†ä¸ºä½ è·Ÿè¸ªè¿™äº›å…ƒç´ ã€‚</p><p>å¦‚ä½•è¯†åˆ«å‰ K ä¸ªå…ƒç´ æ¨¡å¼ï¼š</p><blockquote><ul><li>å¦‚æœä½ è¢«è¦æ±‚å¯»æ‰¾ä¸€ä¸ªç»™å®šé›†åˆä¸­å‰é¢çš„&#x2F;æœ€å°çš„&#x2F;æœ€å¸¸å‡ºç°çš„ K çš„å…ƒç´ </li><li>å¦‚æœä½ è¢«è¦æ±‚å¯¹ä¸€ä¸ªæ•°å€¼è¿›è¡Œæ’åºä»¥æ‰¾åˆ°ä¸€ä¸ªç¡®å®šå…ƒç´ </li></ul></blockquote><p>å‰ K ä¸ªå…ƒç´ æ¨¡å¼çš„é—®é¢˜ï¼š</p><blockquote><ul><li>å‰é¢çš„ K ä¸ªæ•°ï¼ˆç®€å•ï¼‰</li><li>æœ€å¸¸å‡ºç°çš„ K ä¸ªæ•°ï¼ˆä¸­ç­‰ï¼‰</li></ul></blockquote><h1 id="13-K-è·¯åˆå¹¶"><a href="#13-K-è·¯åˆå¹¶" class="headerlink" title="13. K è·¯åˆå¹¶"></a>13. K è·¯åˆå¹¶</h1><p>K è·¯åˆå¹¶èƒ½å¸®åŠ©ä½ æ±‚è§£æ¶‰åŠä¸€ç»„ç»è¿‡æ’åºçš„æ•°ç»„çš„é—®é¢˜ã€‚</p><p>å½“ä½ è¢«ç»™å‡ºäº† K ä¸ªç»è¿‡æ’åºçš„æ•°ç»„æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ Heap æ¥æœ‰æ•ˆåœ°æ‰§è¡Œæ‰€æœ‰æ•°ç»„çš„æ‰€æœ‰å…ƒç´ çš„æ’åºéå†ã€‚ä½ å¯ä»¥å°†æ¯ä¸ªæ•°ç»„çš„æœ€å°å…ƒç´ æ¨é€è‡³ Min Heap ä»¥è·å¾—æ•´ä½“æœ€å°å€¼ã€‚</p><p>åœ¨è·å¾—äº†æ•´ä½“æœ€å°å€¼åï¼Œå°†æ¥è‡ªåŒä¸€ä¸ªæ•°ç»„çš„ä¸‹ä¸€ä¸ªå…ƒç´ æ¨é€è‡³ heapã€‚</p><p>ç„¶åï¼Œé‡å¤è¿™ä¸€è¿‡ç¨‹ä»¥å¾—åˆ°æ‰€æœ‰å…ƒç´ çš„æ’åºéå†ç»“æœã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210225100559.webp" alt="å›¾ç‰‡"></p><p>è¯¥æ¨¡å¼çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p><blockquote><ul><li>1ï¼å°†æ¯ä¸ªæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ’å…¥ Min Heap</li><li>2ï¼ä¹‹åï¼Œä»è¯¥ Heap å–å‡ºæœ€å°ï¼ˆé¡¶éƒ¨çš„ï¼‰å…ƒç´ ï¼Œå°†å…¶åŠ å…¥åˆ°åˆå¹¶çš„åˆ—è¡¨ã€‚</li><li>3ï¼åœ¨ä» Heap ç§»é™¤äº†æœ€å°çš„å…ƒç´ ä¹‹åï¼Œå°†åŒä¸€åˆ—è¡¨çš„ä¸‹ä¸€ä¸ªå…ƒç´ æ’å…¥è¯¥ Heap</li><li>4ï¼é‡å¤æ­¥éª¤ 2 å’Œ 3ï¼Œä»¥æ’åºçš„é¡ºåºå¡«å……åˆå¹¶çš„åˆ—è¡¨</li></ul></blockquote><p>å¦‚ä½•è¯†åˆ« K è·¯åˆå¹¶æ¨¡å¼ï¼š</p><blockquote><ul><li>å…·æœ‰æ’åºæ•°ç»„ã€åˆ—è¡¨æˆ–çŸ©é˜µçš„é—®é¢˜</li><li>å¦‚æœé—®é¢˜è¦æ±‚ä½ åˆå¹¶æ’åºçš„åˆ—è¡¨ï¼Œæ‰¾åˆ°ä¸€ä¸ªæ’åºåˆ—è¡¨ä¸­çš„æœ€å°å…ƒç´ </li></ul></blockquote><p>K è·¯åˆå¹¶æ¨¡å¼çš„é—®é¢˜ï¼š</p><blockquote><ul><li>åˆå¹¶ K ä¸ªæ’åºçš„åˆ—è¡¨ï¼ˆä¸­ç­‰ï¼‰</li><li>æ‰¾åˆ°å’Œæœ€å¤§çš„ K ä¸ªé…å¯¹ï¼ˆå›°éš¾ï¼‰</li></ul></blockquote><h1 id="14-æ‹“æ‰‘æ’åº"><a href="#14-æ‹“æ‰‘æ’åº" class="headerlink" title="14. æ‹“æ‰‘æ’åº"></a>14. æ‹“æ‰‘æ’åº</h1><p>æ‹“æ‰‘æ’åºå¯ç”¨äºå¯»æ‰¾äº’ç›¸ä¾èµ–çš„å…ƒç´ çš„çº¿æ€§é¡ºåºã€‚</p><p>æ¯”å¦‚ï¼Œå¦‚æœäº‹ä»¶ B ä¾èµ–äºäº‹ä»¶ Aï¼Œé‚£ä¹ˆ A åœ¨æ‹“æ‰‘æ’åºæ—¶ä½äº B ä¹‹å‰ã€‚</p><p>è¿™ä¸ªæ¨¡å¼å®šä¹‰äº†ä¸€ç§ç®€å•æ–¹æ³•æ¥ç†è§£æ‰§è¡Œä¸€ç»„å…ƒç´ çš„æ‹“æ‰‘æ’åºçš„æŠ€æœ¯ã€‚</p><p>è¯¥æ¨¡å¼çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š</p><blockquote><ul><li><p>1ï¼åˆå§‹åŒ–ã€‚<br>aï¼‰ä½¿ç”¨ HashMap å°†å›¾ï¼ˆgraphï¼‰å­˜å‚¨åˆ°é‚»æ¥çš„åˆ—è¡¨ä¸­ï¼›<br>bï¼‰ä¸ºäº†æŸ¥æ‰¾æ‰€æœ‰æºï¼Œä½¿ç”¨ HashMap è®°å½• in-degree çš„æ•°é‡</p></li><li><p>2ï¼æ„å»ºå›¾å¹¶æ‰¾åˆ°æ‰€æœ‰é¡¶ç‚¹çš„ in-degreeã€‚<br>aï¼‰æ ¹æ®è¾“å…¥æ„å»ºå›¾å¹¶å¡«å…… in-degree HashMap</p></li><li><p>3ï¼å¯»æ‰¾æ‰€æœ‰çš„æºã€‚<br>aï¼‰æ‰€æœ‰ in-degree ä¸º 0 çš„é¡¶ç‚¹éƒ½æ˜¯æºï¼Œå¹¶ä¼šè¢«å­˜å…¥ä¸€ä¸ªé˜Ÿåˆ—</p></li><li><p>4ï¼æ’åºã€‚<br>aï¼‰å¯¹äºæ¯ä¸ªæºï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><p>iï¼‰å°†å…¶åŠ å…¥åˆ°æ’åºçš„åˆ—è¡¨ï¼›<br>iiï¼‰æ ¹æ®å›¾è·å–å…¶æ‰€æœ‰å­èŠ‚ç‚¹ï¼›<br>iiiï¼‰å°†æ¯ä¸ªå­èŠ‚ç‚¹çš„ in-degree å‡å°‘ 1ï¼›<br>ivï¼‰å¦‚æœä¸€ä¸ªå­èŠ‚ç‚¹çš„ in-degree å˜ä¸º 0ï¼Œå°†å…¶åŠ å…¥åˆ°æºé˜Ÿåˆ—ã€‚</p><p>bï¼‰é‡å¤ (a)ï¼Œç›´åˆ°æºé˜Ÿåˆ—ä¸ºç©ºã€‚</p></li></ul></blockquote><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210225100552.webp" alt="å›¾ç‰‡"></p><p>å¦‚ä½•è¯†åˆ«æ‹“æ‰‘æ’åºæ¨¡å¼ï¼š</p><blockquote><ul><li>å¤„ç†æ— å‘æœ‰ç¯å›¾çš„é—®é¢˜</li><li>å¦‚æœä½ è¢«è¦æ±‚ä»¥æ’åºé¡ºåºæ›´æ–°æ‰€æœ‰å¯¹è±¡</li><li>å¦‚æœä½ æœ‰ä¸€ç±»éµå¾ªç‰¹å®šé¡ºåºçš„å¯¹è±¡</li></ul></blockquote><p>æ‹“æ‰‘æ’åºæ¨¡å¼çš„é—®é¢˜ï¼š</p><blockquote><ul><li>ä»»åŠ¡è°ƒåº¦ï¼ˆä¸­ç­‰ï¼‰</li><li>ä¸€ä¸ªæ ‘çš„æœ€å°é«˜åº¦</li></ul></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> é¢ç» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®—æ³•æ¨¡æ¿</title>
      <link href="/posts/2cc2fa98.html"/>
      <url>/posts/2cc2fa98.html</url>
      
        <content type="html"><![CDATA[<hr><h3 id="æ»‘åŠ¨çª—å£"><a href="#æ»‘åŠ¨çª—å£" class="headerlink" title="æ»‘åŠ¨çª—å£"></a>æ»‘åŠ¨çª—å£</h3><h4 id="1-æ»‘åŠ¨çª—å£é€šç”¨æ¨¡æ¿"><a href="#1-æ»‘åŠ¨çª—å£é€šç”¨æ¨¡æ¿" class="headerlink" title="1.æ»‘åŠ¨çª—å£é€šç”¨æ¨¡æ¿"></a>1.æ»‘åŠ¨çª—å£é€šç”¨æ¨¡æ¿</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">findSubArray</span>(<span class="params">nums</span>):</span><br><span class="line">    N = <span class="built_in">len</span>(nums) <span class="comment"># æ•°ç»„/å­—ç¬¦ä¸²é•¿åº¦</span></span><br><span class="line">    left, right = <span class="number">0</span>, <span class="number">0</span> <span class="comment"># åŒæŒ‡é’ˆï¼Œè¡¨ç¤ºå½“å‰éå†çš„åŒºé—´[left, right]ï¼Œé—­åŒºé—´</span></span><br><span class="line">    sums = <span class="number">0</span> <span class="comment"># ç”¨äºç»Ÿè®¡ å­æ•°ç»„/å­åŒºé—´ æ˜¯å¦æœ‰æ•ˆï¼Œæ ¹æ®é¢˜ç›®å¯èƒ½ä¼šæ”¹æˆæ±‚å’Œ/è®¡æ•°</span></span><br><span class="line">    res = <span class="number">0</span> <span class="comment"># ä¿å­˜æœ€å¤§çš„æ»¡è¶³é¢˜ç›®è¦æ±‚çš„ å­æ•°ç»„/å­ä¸² é•¿åº¦</span></span><br><span class="line">    <span class="keyword">while</span> right &lt; N: <span class="comment"># å½“å³è¾¹çš„æŒ‡é’ˆæ²¡æœ‰æœç´¢åˆ° æ•°ç»„/å­—ç¬¦ä¸² çš„ç»“å°¾</span></span><br><span class="line">        sums += nums[right] <span class="comment"># å¢åŠ å½“å‰å³è¾¹æŒ‡é’ˆçš„æ•°å­—/å­—ç¬¦çš„æ±‚å’Œ/è®¡æ•°</span></span><br><span class="line">        <span class="keyword">while</span> åŒºé—´[left, right]ä¸ç¬¦åˆé¢˜æ„ï¼š<span class="comment"># æ­¤æ—¶éœ€è¦ä¸€ç›´ç§»åŠ¨å·¦æŒ‡é’ˆï¼Œç›´è‡³æ‰¾åˆ°ä¸€ä¸ªç¬¦åˆé¢˜æ„çš„åŒºé—´</span></span><br><span class="line">            sums -= nums[left] <span class="comment"># ç§»åŠ¨å·¦æŒ‡é’ˆå‰éœ€è¦ä»counterä¸­å‡å°‘leftä½ç½®å­—ç¬¦çš„æ±‚å’Œ/è®¡æ•°</span></span><br><span class="line">            left += <span class="number">1</span> <span class="comment"># çœŸæ­£çš„ç§»åŠ¨å·¦æŒ‡é’ˆï¼Œæ³¨æ„ä¸èƒ½è·Ÿä¸Šé¢ä¸€è¡Œä»£ç å†™å</span></span><br><span class="line">        <span class="comment"># åˆ° while ç»“æŸæ—¶ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†ä¸€ä¸ªç¬¦åˆé¢˜æ„è¦æ±‚çš„ å­æ•°ç»„/å­ä¸²</span></span><br><span class="line">        res = <span class="built_in">max</span>(res, right - left + <span class="number">1</span>) <span class="comment"># éœ€è¦æ›´æ–°ç»“æœ</span></span><br><span class="line">        right += <span class="number">1</span> <span class="comment"># ç§»åŠ¨å³æŒ‡é’ˆï¼Œå»æ¢ç´¢æ–°çš„åŒºé—´</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><p>æ»‘åŠ¨çª—å£ä¸­ç”¨åˆ°äº†å·¦å³ä¸¤ä¸ªæŒ‡é’ˆï¼Œå®ƒä»¬ç§»åŠ¨çš„æ€è·¯æ˜¯ï¼šä»¥å³æŒ‡é’ˆä½œä¸ºé©±åŠ¨ï¼Œæ‹–ç€å·¦æŒ‡é’ˆå‘å‰èµ°ã€‚å³æŒ‡é’ˆæ¯æ¬¡åªç§»åŠ¨ä¸€æ­¥ï¼Œè€Œå·¦æŒ‡é’ˆåœ¨å†…éƒ¨ while å¾ªç¯ä¸­æ¯æ¬¡å¯èƒ½ç§»åŠ¨å¤šæ­¥ã€‚å³æŒ‡é’ˆæ˜¯ä¸»åŠ¨å‰ç§»ï¼Œæ¢ç´¢æœªçŸ¥çš„æ–°åŒºåŸŸï¼›å·¦æŒ‡é’ˆæ˜¯è¢«è¿«ç§»åŠ¨ï¼Œè´Ÿè´£å¯»æ‰¾æ»¡è¶³é¢˜æ„çš„åŒºé—´ã€‚</p><p>æ¨¡æ¿çš„æ•´ä½“æ€æƒ³æ˜¯ï¼š</p><p>å®šä¹‰ä¸¤ä¸ªæŒ‡é’ˆ left å’Œ right åˆ†åˆ«æŒ‡å‘åŒºé—´çš„å¼€å¤´å’Œç»“å°¾ï¼Œæ³¨æ„æ˜¯é—­åŒºé—´ï¼›å®šä¹‰ sums ç”¨æ¥ç»Ÿè®¡è¯¥åŒºé—´å†…çš„å„ä¸ªå­—ç¬¦å‡ºç°æ¬¡æ•°ï¼›<br>ç¬¬ä¸€é‡ while å¾ªç¯æ˜¯ä¸ºäº†åˆ¤æ–­ right æŒ‡é’ˆçš„ä½ç½®æ˜¯å¦è¶…å‡ºäº†æ•°ç»„è¾¹ç•Œï¼›å½“ right æ¯æ¬¡åˆ°äº†æ–°ä½ç½®ï¼Œéœ€è¦å¢åŠ  right æŒ‡é’ˆçš„æ±‚å’Œ&#x2F;è®¡æ•°ï¼›<br>ç¬¬äºŒé‡ while å¾ªç¯æ˜¯è®© left æŒ‡é’ˆå‘å³ç§»åŠ¨åˆ° [left, right] åŒºé—´ç¬¦åˆé¢˜æ„çš„ä½ç½®ï¼›å½“ left æ¯æ¬¡ç§»åŠ¨åˆ°äº†æ–°ä½ç½®ï¼Œéœ€è¦å‡å°‘ left æŒ‡é’ˆçš„æ±‚å’Œ&#x2F;è®¡æ•°ï¼›<br>åœ¨ç¬¬äºŒé‡ while å¾ªç¯ä¹‹åï¼ŒæˆåŠŸæ‰¾åˆ°äº†ä¸€ä¸ªç¬¦åˆé¢˜æ„çš„ [left, right] åŒºé—´ï¼Œé¢˜ç›®è¦æ±‚æœ€å¤§çš„åŒºé—´é•¿åº¦ï¼Œå› æ­¤æ›´æ–° res ä¸º max(res, å½“å‰åŒºé—´çš„é•¿åº¦) ã€‚<br>right æŒ‡é’ˆæ¯æ¬¡å‘å³ç§»åŠ¨ä¸€æ­¥ï¼Œå¼€å§‹æ¢ç´¢æ–°çš„åŒºé—´ã€‚<br>æ¨¡æ¿ä¸­çš„ sums éœ€è¦æ ¹æ®é¢˜ç›®æ„æ€å…·ä½“å»ä¿®æ”¹ï¼Œæœ¬é¢˜æ˜¯æ±‚å’Œé¢˜ç›®å› æ­¤æŠŠsums å®šä¹‰æˆæ•´æ•°ç”¨äºæ±‚å’Œï¼›å¦‚æœæ˜¯è®¡æ•°é¢˜ç›®ï¼Œå°±éœ€è¦æ”¹æˆå­—å…¸ç”¨äºè®¡æ•°ã€‚å½“å·¦å³æŒ‡é’ˆå‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œéƒ½éœ€è¦æ›´æ–° sums ã€‚</p><h4 id="2-å›ºå®šæ»‘åŠ¨çª—å£"><a href="#2-å›ºå®šæ»‘åŠ¨çª—å£" class="headerlink" title="2.å›ºå®šæ»‘åŠ¨çª—å£"></a>2.å›ºå®šæ»‘åŠ¨çª—å£</h4><h5 id="leetcode-643-å­æ•°ç»„æœ€å¤§å¹³å‡æ•°-I"><a href="#leetcode-643-å­æ•°ç»„æœ€å¤§å¹³å‡æ•°-I" class="headerlink" title="leetcode 643. å­æ•°ç»„æœ€å¤§å¹³å‡æ•° I"></a><a href="https://leetcode-cn.com/problems/maximum-average-subarray-i/">leetcode 643. å­æ•°ç»„æœ€å¤§å¹³å‡æ•° I</a></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">double</span> <span class="title function_">findMaxAverage</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; k; i++) &#123;</span><br><span class="line">        sum += nums[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> sum;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> k; i &lt; nums.length; i++) &#123;</span><br><span class="line">        sum = sum + nums[i] - nums[i - k];</span><br><span class="line">        max = Math.max(sum, max);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1.0</span> * max / k;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="leetcode-1052-çˆ±ç”Ÿæ°”çš„ä¹¦åº—è€æ¿"><a href="#leetcode-1052-çˆ±ç”Ÿæ°”çš„ä¹¦åº—è€æ¿" class="headerlink" title="leetcode 1052.çˆ±ç”Ÿæ°”çš„ä¹¦åº—è€æ¿"></a><a href="https://leetcode-cn.com/problems/grumpy-bookstore-owner/">leetcode 1052.çˆ±ç”Ÿæ°”çš„ä¹¦åº—è€æ¿</a></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">maxSatisfied</span><span class="params">(<span class="type">int</span>[] customers, <span class="type">int</span>[] grumpy, <span class="type">int</span> X)</span> &#123;</span><br><span class="line">      <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> customers.length;</span><br><span class="line">      <span class="type">int</span> <span class="variable">total</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">          total += customers[i] * (<span class="number">1</span> - grumpy[i]);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="type">int</span> <span class="variable">increase</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; X; i++) &#123;</span><br><span class="line">          increase += customers[i] * grumpy[i];</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">int</span> <span class="variable">maxIncrease</span> <span class="operator">=</span> increase;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> X; i &lt; n; i++) &#123;</span><br><span class="line">          <span class="comment">// å¦‚æœæ˜¯1çš„ä»£è¡¨ç”Ÿæ°”ï¼Œ0çš„ä»£è¡¨ä¸ç”Ÿæ°”ç›´æ¥ä¹˜å°±å¯ä»¥ï¼ˆä»ä¸º0ï¼‰ï¼Œå› ä¸ºä¹‹å‰å·²ç»ç®—å‡ºæ¥äº†</span></span><br><span class="line">          increase = increase - customers[i - X] * grumpy[i - X] + customers[i] * grumpy[i];</span><br><span class="line">          maxIncrease = Math.max(maxIncrease, increase);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> total + maxIncrease;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> é¢ç» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†å¸ƒå¼äº‹åŠ¡</title>
      <link href="/posts/cdcc4eae.html"/>
      <url>/posts/cdcc4eae.html</url>
      
        <content type="html"><![CDATA[<hr><h3 id="ä¸¤é˜¶æ®µæäº¤æ–¹æ¡ˆ-XA-æ–¹æ¡ˆ"><a href="#ä¸¤é˜¶æ®µæäº¤æ–¹æ¡ˆ-XA-æ–¹æ¡ˆ" class="headerlink" title="ä¸¤é˜¶æ®µæäº¤æ–¹æ¡ˆ&#x2F;XA æ–¹æ¡ˆ"></a>ä¸¤é˜¶æ®µæäº¤æ–¹æ¡ˆ&#x2F;XA æ–¹æ¡ˆ</h3><p>æ‰€è°“çš„ XA æ–¹æ¡ˆï¼Œå³ï¼šä¸¤é˜¶æ®µæäº¤ï¼Œæœ‰ä¸€ä¸ª<strong>äº‹åŠ¡ç®¡ç†å™¨</strong>çš„æ¦‚å¿µï¼Œè´Ÿè´£åè°ƒå¤šä¸ªæ•°æ®åº“ï¼ˆèµ„æºç®¡ç†å™¨ï¼‰çš„äº‹åŠ¡ï¼Œäº‹åŠ¡ç®¡ç†å™¨å…ˆé—®é—®å„ä¸ªæ•°æ®åº“ä½ å‡†å¤‡å¥½äº†å—ï¼Ÿå¦‚æœæ¯ä¸ªæ•°æ®åº“éƒ½å›å¤ okï¼Œé‚£ä¹ˆå°±æ­£å¼æäº¤äº‹åŠ¡ï¼Œåœ¨å„ä¸ªæ•°æ®åº“ä¸Šæ‰§è¡Œæ“ä½œï¼›å¦‚æœä»»ä½•å…¶ä¸­ä¸€ä¸ªæ•°æ®åº“å›ç­”ä¸ okï¼Œé‚£ä¹ˆå°±å›æ»šäº‹åŠ¡ã€‚</p><p>è¿™ç§åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆï¼Œæ¯”è¾ƒé€‚åˆå•å—åº”ç”¨é‡Œï¼Œè·¨å¤šä¸ªåº“çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œè€Œä¸”å› ä¸ºä¸¥é‡ä¾èµ–äºæ•°æ®åº“å±‚é¢æ¥æå®šå¤æ‚çš„äº‹åŠ¡ï¼Œæ•ˆç‡å¾ˆä½ï¼Œç»å¯¹ä¸é€‚åˆé«˜å¹¶å‘çš„åœºæ™¯ã€‚å¦‚æœè¦ç©å„¿ï¼Œé‚£ä¹ˆåŸºäº <code>Spring + JTA</code> å°±å¯ä»¥æå®šï¼Œè‡ªå·±éšä¾¿æœä¸ª demo çœ‹çœ‹å°±çŸ¥é“äº†ã€‚</p><p>è¿™ä¸ªæ–¹æ¡ˆï¼Œæˆ‘ä»¬å¾ˆå°‘ç”¨ï¼Œä¸€èˆ¬æ¥è¯´<strong>æŸä¸ªç³»ç»Ÿå†…éƒ¨å¦‚æœå‡ºç°è·¨å¤šä¸ªåº“</strong>çš„è¿™ä¹ˆä¸€ä¸ªæ“ä½œï¼Œæ˜¯<strong>ä¸åˆè§„</strong>çš„ã€‚æˆ‘å¯ä»¥ç»™å¤§å®¶ä»‹ç»ä¸€ä¸‹ï¼Œ ç°åœ¨å¾®æœåŠ¡ï¼Œä¸€ä¸ªå¤§çš„ç³»ç»Ÿåˆ†æˆå‡ åä¸ªç”šè‡³å‡ ç™¾ä¸ªæœåŠ¡ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬çš„è§„å®šå’Œè§„èŒƒï¼Œæ˜¯è¦æ±‚<strong>æ¯ä¸ªæœåŠ¡åªèƒ½æ“ä½œè‡ªå·±å¯¹åº”çš„ä¸€ä¸ªæ•°æ®åº“</strong>ã€‚</p><p>å¦‚æœä½ è¦æ“ä½œåˆ«çš„æœåŠ¡å¯¹åº”çš„åº“ï¼Œä¸å…è®¸ç›´è¿åˆ«çš„æœåŠ¡çš„åº“ï¼Œè¿åå¾®æœåŠ¡æ¶æ„çš„è§„èŒƒï¼Œä½ éšä¾¿äº¤å‰èƒ¡ä¹±è®¿é—®ï¼Œå‡ ç™¾ä¸ªæœåŠ¡çš„è¯ï¼Œå…¨ä½“ä¹±å¥—ï¼Œè¿™æ ·çš„ä¸€å¥—æœåŠ¡æ˜¯æ²¡æ³•ç®¡ç†çš„ï¼Œæ²¡æ³•æ²»ç†çš„ï¼Œå¯èƒ½ä¼šå‡ºç°æ•°æ®è¢«åˆ«äººæ”¹é”™ï¼Œè‡ªå·±çš„åº“è¢«åˆ«äººå†™æŒ‚ç­‰æƒ…å†µã€‚</p><p>å¦‚æœä½ è¦æ“ä½œåˆ«äººçš„æœåŠ¡çš„åº“ï¼Œä½ å¿…é¡»æ˜¯é€šè¿‡<strong>è°ƒç”¨åˆ«çš„æœåŠ¡çš„æ¥å£</strong>æ¥å®ç°ï¼Œç»å¯¹ä¸å…è®¸äº¤å‰è®¿é—®åˆ«äººçš„æ•°æ®åº“ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210221234444.png" alt="distributed-transacion-XA"></p><h3 id="TCCæ–¹æ¡ˆ"><a href="#TCCæ–¹æ¡ˆ" class="headerlink" title="TCCæ–¹æ¡ˆ"></a>TCCæ–¹æ¡ˆ</h3><p>TCC çš„å…¨ç§°æ˜¯ï¼š <code>Try</code> ã€ <code>Confirm</code> ã€ <code>Cancel</code> ã€‚</p><ul><li>Try é˜¶æ®µï¼šè¿™ä¸ªé˜¶æ®µè¯´çš„æ˜¯å¯¹å„ä¸ªæœåŠ¡çš„èµ„æºåšæ£€æµ‹ä»¥åŠå¯¹èµ„æºè¿›è¡Œ<strong>é”å®šæˆ–è€…é¢„ç•™</strong>ã€‚</li><li>Confirm é˜¶æ®µï¼šè¿™ä¸ªé˜¶æ®µè¯´çš„æ˜¯åœ¨å„ä¸ªæœåŠ¡ä¸­<strong>æ‰§è¡Œå®é™…çš„æ“ä½œ</strong>ã€‚</li><li>Cancel é˜¶æ®µï¼šå¦‚æœä»»ä½•ä¸€ä¸ªæœåŠ¡çš„ä¸šåŠ¡æ–¹æ³•æ‰§è¡Œå‡ºé”™ï¼Œé‚£ä¹ˆè¿™é‡Œå°±éœ€è¦<strong>è¿›è¡Œè¡¥å¿</strong>ï¼Œå°±æ˜¯æ‰§è¡Œå·²ç»æ‰§è¡ŒæˆåŠŸçš„ä¸šåŠ¡é€»è¾‘çš„å›æ»šæ“ä½œã€‚ï¼ˆæŠŠé‚£äº›æ‰§è¡ŒæˆåŠŸçš„å›æ»šï¼‰</li></ul><p>è¿™ç§æ–¹æ¡ˆè¯´å®è¯å‡ ä¹å¾ˆå°‘äººä½¿ç”¨ï¼Œæˆ‘ä»¬ç”¨çš„ä¹Ÿæ¯”è¾ƒå°‘ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä½¿ç”¨çš„åœºæ™¯ã€‚å› ä¸ºè¿™ä¸ª<strong>äº‹åŠ¡å›æ»š</strong>å®é™…ä¸Šæ˜¯<strong>ä¸¥é‡ä¾èµ–äºä½ è‡ªå·±å†™ä»£ç æ¥å›æ»šå’Œè¡¥å¿</strong>äº†ï¼Œä¼šé€ æˆè¡¥å¿ä»£ç å·¨å¤§ï¼Œéå¸¸ä¹‹æ¶å¿ƒã€‚</p><p>æ¯”å¦‚è¯´æˆ‘ä»¬ï¼Œä¸€èˆ¬æ¥è¯´è·Ÿ<strong>é’±</strong>ç›¸å…³çš„ï¼Œè·Ÿé’±æ‰“äº¤é“çš„ï¼Œ<strong>æ”¯ä»˜</strong>ã€<strong>äº¤æ˜“</strong>ç›¸å…³çš„åœºæ™¯ï¼Œæˆ‘ä»¬ä¼šç”¨ TCCï¼Œä¸¥æ ¼ä¿è¯åˆ†å¸ƒå¼äº‹åŠ¡è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨è‡ªåŠ¨å›æ»šï¼Œä¸¥æ ¼ä¿è¯èµ„é‡‘çš„æ­£ç¡®æ€§ï¼Œä¿è¯åœ¨èµ„é‡‘ä¸Šä¸ä¼šå‡ºç°é—®é¢˜ã€‚</p><p>è€Œä¸”æœ€å¥½æ˜¯ä½ çš„å„ä¸ªä¸šåŠ¡æ‰§è¡Œçš„æ—¶é—´éƒ½æ¯”è¾ƒçŸ­ã€‚</p><p>ä½†æ˜¯è¯´å®è¯ï¼Œä¸€èˆ¬å°½é‡åˆ«è¿™ä¹ˆæï¼Œè‡ªå·±æ‰‹å†™å›æ»šé€»è¾‘ï¼Œæˆ–è€…æ˜¯è¡¥å¿é€»è¾‘ï¼Œå®åœ¨å¤ªæ¶å¿ƒäº†ï¼Œé‚£ä¸ªä¸šåŠ¡ä»£ç æ˜¯å¾ˆéš¾ç»´æŠ¤çš„ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210221231742.png" alt="distributed-transacion-TCC"></p><h3 id="Sagaæ–¹æ¡ˆ"><a href="#Sagaæ–¹æ¡ˆ" class="headerlink" title="Sagaæ–¹æ¡ˆ"></a>Sagaæ–¹æ¡ˆ</h3><p>é‡‘èæ ¸å¿ƒç­‰ä¸šåŠ¡å¯èƒ½ä¼šé€‰æ‹© TCC æ–¹æ¡ˆï¼Œä»¥è¿½æ±‚å¼ºä¸€è‡´æ€§å’Œæ›´é«˜çš„å¹¶å‘é‡ï¼Œè€Œå¯¹äºæ›´å¤šçš„é‡‘èæ ¸å¿ƒä»¥ä¸Šçš„ä¸šåŠ¡ç³»ç»Ÿå¾€å¾€ä¼šé€‰æ‹©è¡¥å¿äº‹åŠ¡ï¼Œè¡¥å¿äº‹åŠ¡å¤„ç†åœ¨ 30 å¤šå¹´å‰å°±æå‡ºäº† Saga ç†è®ºï¼Œéšç€å¾®æœåŠ¡çš„å‘å±•ï¼Œè¿‘äº›å¹´æ‰é€æ­¥å—åˆ°å¤§å®¶çš„å…³æ³¨ã€‚ç›®å‰ä¸šç•Œæ¯”è¾ƒå…¬è®¤çš„æ˜¯é‡‡ç”¨ Saga ä½œä¸ºé•¿äº‹åŠ¡çš„è§£å†³æ–¹æ¡ˆã€‚</p><h4 id="åŸºæœ¬åŸç†"><a href="#åŸºæœ¬åŸç†" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h4><p>ä¸šåŠ¡æµç¨‹ä¸­æ¯ä¸ªå‚ä¸è€…éƒ½æäº¤æœ¬åœ°äº‹åŠ¡ï¼Œè‹¥æŸä¸€ä¸ªå‚ä¸è€…å¤±è´¥ï¼Œåˆ™è¡¥å¿å‰é¢å·²ç»æˆåŠŸçš„å‚ä¸è€…ã€‚ä¸‹å›¾å·¦ä¾§æ˜¯æ­£å¸¸çš„äº‹åŠ¡æµç¨‹ï¼Œå½“æ‰§è¡Œåˆ° T3 æ—¶å‘ç”Ÿäº†é”™è¯¯ï¼Œåˆ™å¼€å§‹æ‰§è¡Œå³è¾¹çš„äº‹åŠ¡è¡¥å¿æµç¨‹ï¼Œåå‘æ‰§è¡Œ T3ã€T2ã€T1 çš„è¡¥å¿æœåŠ¡ C3ã€C2ã€C1ï¼Œå°† T3ã€T2ã€T1 å·²ç»ä¿®æ”¹çš„æ•°æ®è¡¥å¿æ‰ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210221231855.png" alt="distributed-transacion-TCC"></p><h4 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h4><p>å¯¹äºä¸€è‡´æ€§è¦æ±‚é«˜ã€çŸ­æµç¨‹ã€å¹¶å‘é«˜ çš„åœºæ™¯ï¼Œå¦‚ï¼šé‡‘èæ ¸å¿ƒç³»ç»Ÿï¼Œä¼šä¼˜å…ˆè€ƒè™‘ TCC æ–¹æ¡ˆã€‚è€Œåœ¨å¦å¤–ä¸€äº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦è¿™ä¹ˆå¼ºçš„ä¸€è‡´æ€§ï¼Œåªéœ€è¦ä¿è¯æœ€ç»ˆä¸€è‡´æ€§å³å¯ã€‚</p><p>æ¯”å¦‚ å¾ˆå¤šé‡‘èæ ¸å¿ƒä»¥ä¸Šçš„ä¸šåŠ¡ï¼ˆæ¸ é“å±‚ã€äº§å“å±‚ã€ç³»ç»Ÿé›†æˆå±‚ï¼‰ï¼Œè¿™äº›ç³»ç»Ÿçš„ç‰¹ç‚¹æ˜¯æœ€ç»ˆä¸€è‡´å³å¯ã€æµç¨‹å¤šã€æµç¨‹é•¿ã€è¿˜å¯èƒ½è¦è°ƒç”¨å…¶å®ƒå…¬å¸çš„æœåŠ¡ã€‚è¿™ç§æƒ…å†µå¦‚æœé€‰æ‹© TCC æ–¹æ¡ˆå¼€å‘çš„è¯ï¼Œä¸€æ¥æˆæœ¬é«˜ï¼ŒäºŒæ¥æ— æ³•è¦æ±‚å…¶å®ƒå…¬å¸çš„æœåŠ¡ä¹Ÿéµå¾ª TCC æ¨¡å¼ã€‚åŒæ—¶æµç¨‹é•¿ï¼Œäº‹åŠ¡è¾¹ç•Œå¤ªé•¿ï¼ŒåŠ é”æ—¶é—´é•¿ï¼Œä¹Ÿä¼šå½±å“å¹¶å‘æ€§èƒ½ã€‚</p><p>æ‰€ä»¥ Saga æ¨¡å¼çš„é€‚ç”¨åœºæ™¯æ˜¯ï¼š</p><ul><li>ä¸šåŠ¡æµç¨‹é•¿ã€ä¸šåŠ¡æµç¨‹å¤šï¼›</li><li>å‚ä¸è€…åŒ…å«å…¶å®ƒå…¬å¸æˆ–é—ç•™ç³»ç»ŸæœåŠ¡ï¼Œæ— æ³•æä¾› TCC æ¨¡å¼è¦æ±‚çš„ä¸‰ä¸ªæ¥å£ã€‚</li></ul><h4 id="ä¼˜åŠ¿"><a href="#ä¼˜åŠ¿" class="headerlink" title="ä¼˜åŠ¿"></a>ä¼˜åŠ¿</h4><ul><li>ä¸€é˜¶æ®µæäº¤æœ¬åœ°äº‹åŠ¡ï¼Œæ— é”ï¼Œé«˜æ€§èƒ½ï¼›</li><li>å‚ä¸è€…å¯å¼‚æ­¥æ‰§è¡Œï¼Œé«˜ååï¼›</li><li>è¡¥å¿æœåŠ¡æ˜“äºå®ç°ï¼Œå› ä¸ºä¸€ä¸ªæ›´æ–°æ“ä½œçš„åå‘æ“ä½œæ˜¯æ¯”è¾ƒå®¹æ˜“ç†è§£çš„ã€‚</li></ul><h4 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h4><ul><li>ä¸ä¿è¯äº‹åŠ¡çš„éš”ç¦»æ€§ã€‚</li></ul><h3 id="æœ¬åœ°æ¶ˆæ¯è¡¨"><a href="#æœ¬åœ°æ¶ˆæ¯è¡¨" class="headerlink" title="æœ¬åœ°æ¶ˆæ¯è¡¨"></a>æœ¬åœ°æ¶ˆæ¯è¡¨</h3><p>æœ¬åœ°æ¶ˆæ¯è¡¨å…¶å®æ˜¯å›½å¤–çš„ ebay æå‡ºæ¥çš„è¿™ä¹ˆä¸€å¥—æ€æƒ³ã€‚</p><p>è¿™ä¸ªå¤§æ¦‚æ„æ€æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>A ç³»ç»Ÿåœ¨è‡ªå·±æœ¬åœ°ä¸€ä¸ªäº‹åŠ¡é‡Œæ“ä½œåŒæ—¶ï¼Œæ’å…¥ä¸€æ¡æ•°æ®åˆ°æ¶ˆæ¯è¡¨ï¼›</li><li>æ¥ç€ A ç³»ç»Ÿå°†è¿™ä¸ªæ¶ˆæ¯å‘é€åˆ° MQ ä¸­å»ï¼›</li><li>B ç³»ç»Ÿæ¥æ”¶åˆ°æ¶ˆæ¯ä¹‹åï¼Œåœ¨ä¸€ä¸ªäº‹åŠ¡é‡Œï¼Œå¾€è‡ªå·±æœ¬åœ°æ¶ˆæ¯è¡¨é‡Œæ’å…¥ä¸€æ¡æ•°æ®ï¼ŒåŒæ—¶æ‰§è¡Œå…¶ä»–çš„ä¸šåŠ¡æ“ä½œï¼Œå¦‚æœè¿™ä¸ªæ¶ˆæ¯å·²ç»è¢«å¤„ç†è¿‡äº†ï¼Œé‚£ä¹ˆæ­¤æ—¶è¿™ä¸ªäº‹åŠ¡ä¼šå›æ»šï¼Œè¿™æ ·<strong>ä¿è¯ä¸ä¼šé‡å¤å¤„ç†æ¶ˆæ¯</strong>ï¼›</li><li>B ç³»ç»Ÿæ‰§è¡ŒæˆåŠŸä¹‹åï¼Œå°±ä¼šæ›´æ–°è‡ªå·±æœ¬åœ°æ¶ˆæ¯è¡¨çš„çŠ¶æ€ä»¥åŠ A ç³»ç»Ÿæ¶ˆæ¯è¡¨çš„çŠ¶æ€ï¼›</li><li>å¦‚æœ B ç³»ç»Ÿå¤„ç†å¤±è´¥äº†ï¼Œé‚£ä¹ˆå°±ä¸ä¼šæ›´æ–°æ¶ˆæ¯è¡¨çŠ¶æ€ï¼Œé‚£ä¹ˆæ­¤æ—¶ A ç³»ç»Ÿä¼šå®šæ—¶æ‰«æè‡ªå·±çš„æ¶ˆæ¯è¡¨ï¼Œå¦‚æœæœ‰æœªå¤„ç†çš„æ¶ˆæ¯ï¼Œä¼šå†æ¬¡å‘é€åˆ° MQ ä¸­å»ï¼Œè®© B å†æ¬¡å¤„ç†ï¼›</li><li>è¿™ä¸ªæ–¹æ¡ˆä¿è¯äº†æœ€ç»ˆä¸€è‡´æ€§ï¼Œå“ªæ€• B äº‹åŠ¡å¤±è´¥äº†ï¼Œä½†æ˜¯ A ä¼šä¸æ–­é‡å‘æ¶ˆæ¯ï¼Œç›´åˆ° B é‚£è¾¹æˆåŠŸä¸ºæ­¢ã€‚</li></ol><p>è¿™ä¸ªæ–¹æ¡ˆè¯´å®è¯æœ€å¤§çš„é—®é¢˜å°±åœ¨äº<strong>ä¸¥é‡ä¾èµ–äºæ•°æ®åº“çš„æ¶ˆæ¯è¡¨æ¥ç®¡ç†äº‹åŠ¡</strong>å•¥çš„ï¼Œå¦‚æœæ˜¯é«˜å¹¶å‘åœºæ™¯å’‹åŠå‘¢ï¼Ÿå’‹æ‰©å±•å‘¢ï¼Ÿæ‰€ä»¥ä¸€èˆ¬ç¡®å®å¾ˆå°‘ç”¨ã€‚</p><p><img src="https://doocs.github.io/advanced-java/docs/distributed-system/images/distributed-transaction-local-message-table.png" alt="distributed-transaction-local-message-table"></p><h3 id="å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆ"><a href="#å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆ" class="headerlink" title="å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆ"></a>å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆ</h3><p>è¿™ä¸ªçš„æ„æ€ï¼Œå°±æ˜¯å¹²è„†ä¸è¦ç”¨æœ¬åœ°çš„æ¶ˆæ¯è¡¨äº†ï¼Œç›´æ¥åŸºäº MQ æ¥å®ç°äº‹åŠ¡ã€‚æ¯”å¦‚é˜¿é‡Œçš„ RocketMQ å°±æ”¯æŒæ¶ˆæ¯äº‹åŠ¡ã€‚</p><p>å¤§æ¦‚çš„æ„æ€å°±æ˜¯ï¼š</p><ol><li>A ç³»ç»Ÿå…ˆå‘é€ä¸€ä¸ª prepared æ¶ˆæ¯åˆ° mqï¼Œå¦‚æœè¿™ä¸ª prepared æ¶ˆæ¯å‘é€å¤±è´¥é‚£ä¹ˆå°±ç›´æ¥å–æ¶ˆæ“ä½œåˆ«æ‰§è¡Œäº†ï¼›</li><li>å¦‚æœè¿™ä¸ªæ¶ˆæ¯å‘é€æˆåŠŸè¿‡äº†ï¼Œé‚£ä¹ˆæ¥ç€æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼Œå¦‚æœæˆåŠŸå°±å‘Šè¯‰ mq å‘é€ç¡®è®¤æ¶ˆæ¯ï¼Œå¦‚æœå¤±è´¥å°±å‘Šè¯‰ mq å›æ»šæ¶ˆæ¯ï¼›</li><li>å¦‚æœå‘é€äº†ç¡®è®¤æ¶ˆæ¯ï¼Œé‚£ä¹ˆæ­¤æ—¶ B ç³»ç»Ÿä¼šæ¥æ”¶åˆ°ç¡®è®¤æ¶ˆæ¯ï¼Œç„¶åæ‰§è¡Œæœ¬åœ°çš„äº‹åŠ¡ï¼›</li><li>mq ä¼šè‡ªåŠ¨<strong>å®šæ—¶è½®è¯¢</strong>æ‰€æœ‰ prepared æ¶ˆæ¯å›è°ƒä½ çš„æ¥å£ï¼Œé—®ä½ ï¼Œè¿™ä¸ªæ¶ˆæ¯æ˜¯ä¸æ˜¯æœ¬åœ°äº‹åŠ¡å¤„ç†å¤±è´¥äº†ï¼Œæ‰€æœ‰æ²¡å‘é€ç¡®è®¤çš„æ¶ˆæ¯ï¼Œæ˜¯ç»§ç»­é‡è¯•è¿˜æ˜¯å›æ»šï¼Ÿä¸€èˆ¬æ¥è¯´è¿™é‡Œä½ å°±å¯ä»¥æŸ¥ä¸‹æ•°æ®åº“çœ‹ä¹‹å‰æœ¬åœ°äº‹åŠ¡æ˜¯å¦æ‰§è¡Œï¼Œå¦‚æœå›æ»šäº†ï¼Œé‚£ä¹ˆè¿™é‡Œä¹Ÿå›æ»šå§ã€‚è¿™ä¸ªå°±æ˜¯é¿å…å¯èƒ½æœ¬åœ°äº‹åŠ¡æ‰§è¡ŒæˆåŠŸäº†ï¼Œè€Œç¡®è®¤æ¶ˆæ¯å´å‘é€å¤±è´¥äº†ã€‚</li><li>è¿™ä¸ªæ–¹æ¡ˆé‡Œï¼Œè¦æ˜¯ç³»ç»Ÿ B çš„äº‹åŠ¡å¤±è´¥äº†å’‹åŠï¼Ÿé‡è¯•å’¯ï¼Œè‡ªåŠ¨ä¸æ–­é‡è¯•ç›´åˆ°æˆåŠŸï¼Œå¦‚æœå®åœ¨æ˜¯ä¸è¡Œï¼Œè¦ä¹ˆå°±æ˜¯é’ˆå¯¹é‡è¦çš„èµ„é‡‘ç±»ä¸šåŠ¡è¿›è¡Œå›æ»šï¼Œæ¯”å¦‚ B ç³»ç»Ÿæœ¬åœ°å›æ»šåï¼Œæƒ³åŠæ³•é€šçŸ¥ç³»ç»Ÿ A ä¹Ÿå›æ»šï¼›æˆ–è€…æ˜¯å‘é€æŠ¥è­¦ç”±äººå·¥æ¥æ‰‹å·¥å›æ»šå’Œè¡¥å¿ã€‚</li><li>è¿™ä¸ªè¿˜æ˜¯æ¯”è¾ƒåˆé€‚çš„ï¼Œç›®å‰å›½å†…äº’è”ç½‘å…¬å¸å¤§éƒ½æ˜¯è¿™ä¹ˆç©å„¿çš„ï¼Œè¦ä¸ä½ å°±ç”¨ RocketMQ æ”¯æŒçš„ï¼Œè¦ä¸ä½ å°±è‡ªå·±åŸºäºç±»ä¼¼ ActiveMQï¼ŸRabbitMQï¼Ÿè‡ªå·±å°è£…ä¸€å¥—ç±»ä¼¼çš„é€»è¾‘å‡ºæ¥ï¼Œæ€»ä¹‹æ€è·¯å°±æ˜¯è¿™æ ·å­çš„ã€‚</li></ol><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210221234417.png" alt="distributed-transaction-reliable-message"></p><h3 id="æœ€å¤§åŠªåŠ›é€šçŸ¥æ–¹æ¡ˆ"><a href="#æœ€å¤§åŠªåŠ›é€šçŸ¥æ–¹æ¡ˆ" class="headerlink" title="æœ€å¤§åŠªåŠ›é€šçŸ¥æ–¹æ¡ˆ"></a>æœ€å¤§åŠªåŠ›é€šçŸ¥æ–¹æ¡ˆ</h3><p>è¿™ä¸ªæ–¹æ¡ˆçš„å¤§è‡´æ„æ€å°±æ˜¯ï¼š</p><ol><li>ç³»ç»Ÿ A æœ¬åœ°äº‹åŠ¡æ‰§è¡Œå®Œä¹‹åï¼Œå‘é€ä¸ªæ¶ˆæ¯åˆ° MQï¼›</li><li>è¿™é‡Œä¼šæœ‰ä¸ªä¸“é—¨æ¶ˆè´¹ MQ çš„<strong>æœ€å¤§åŠªåŠ›é€šçŸ¥æœåŠ¡</strong>ï¼Œè¿™ä¸ªæœåŠ¡ä¼šæ¶ˆè´¹ MQ ç„¶åå†™å…¥æ•°æ®åº“ä¸­è®°å½•ä¸‹æ¥ï¼Œæˆ–è€…æ˜¯æ”¾å…¥ä¸ªå†…å­˜é˜Ÿåˆ—ä¹Ÿå¯ä»¥ï¼Œæ¥ç€è°ƒç”¨ç³»ç»Ÿ B çš„æ¥å£ï¼›</li><li>è¦æ˜¯ç³»ç»Ÿ B æ‰§è¡ŒæˆåŠŸå°± ok äº†ï¼›è¦æ˜¯ç³»ç»Ÿ B æ‰§è¡Œå¤±è´¥äº†ï¼Œé‚£ä¹ˆæœ€å¤§åŠªåŠ›é€šçŸ¥æœåŠ¡å°±å®šæ—¶å°è¯•é‡æ–°è°ƒç”¨ç³»ç»Ÿ Bï¼Œåå¤ N æ¬¡ï¼Œæœ€åè¿˜æ˜¯ä¸è¡Œå°±æ”¾å¼ƒã€‚</li></ol><h3 id="ä½ ä»¬å…¬å¸æ˜¯å¦‚ä½•å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡çš„ï¼Ÿ"><a href="#ä½ ä»¬å…¬å¸æ˜¯å¦‚ä½•å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡çš„ï¼Ÿ" class="headerlink" title="ä½ ä»¬å…¬å¸æ˜¯å¦‚ä½•å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡çš„ï¼Ÿ"></a>ä½ ä»¬å…¬å¸æ˜¯å¦‚ä½•å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡çš„ï¼Ÿ</h3><p>å¦‚æœä½ çœŸçš„è¢«é—®åˆ°ï¼Œå¯ä»¥è¿™ä¹ˆè¯´ï¼Œæˆ‘ä»¬æŸæŸç‰¹åˆ«ä¸¥æ ¼çš„åœºæ™¯ï¼Œç”¨çš„æ˜¯ TCC æ¥ä¿è¯å¼ºä¸€è‡´æ€§ï¼›ç„¶åå…¶ä»–çš„ä¸€äº›åœºæ™¯åŸºäºé˜¿é‡Œçš„ RocketMQ æ¥å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p><p>ä½ æ‰¾ä¸€ä¸ªä¸¥æ ¼èµ„é‡‘è¦æ±‚ç»å¯¹ä¸èƒ½é”™çš„åœºæ™¯ï¼Œä½ å¯ä»¥è¯´ä½ æ˜¯ç”¨çš„ TCC æ–¹æ¡ˆï¼›å¦‚æœæ˜¯ä¸€èˆ¬çš„åˆ†å¸ƒå¼äº‹åŠ¡åœºæ™¯ï¼Œè®¢å•æ’å…¥ä¹‹åè¦è°ƒç”¨åº“å­˜æœåŠ¡æ›´æ–°åº“å­˜ï¼Œåº“å­˜æ•°æ®æ²¡æœ‰èµ„é‡‘é‚£ä¹ˆçš„æ•æ„Ÿï¼Œå¯ä»¥ç”¨å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆã€‚</p><p>å‹æƒ…æç¤ºä¸€ä¸‹ï¼ŒRocketMQ 3.2.6 ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œæ˜¯å¯ä»¥æŒ‰ç…§ä¸Šé¢çš„æ€è·¯æ¥çš„ï¼Œä½†æ˜¯ä¹‹åæ¥å£åšäº†ä¸€äº›æ”¹å˜ï¼Œæˆ‘è¿™é‡Œä¸å†èµ˜è¿°äº†ã€‚</p><p>å½“ç„¶å¦‚æœä½ æ„¿æ„ï¼Œä½ å¯ä»¥å‚è€ƒå¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆæ¥è‡ªå·±å®ç°ä¸€å¥—åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œæ¯”å¦‚åŸºäº RocketMQ æ¥ç©å„¿ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> é¢ç» </tag>
            
            <tag> åˆ†å¸ƒå¼äº‹åŠ¡ </tag>
            
            <tag> TCC </tag>
            
            <tag> æ¶ˆæ¯ä¸€è‡´æ€§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¡ç®—æœºç½‘ç»œ</title>
      <link href="/posts/e255a10a.html"/>
      <url>/posts/e255a10a.html</url>
      
        <content type="html"><![CDATA[<hr><h2 id="TCP-UDP"><a href="#TCP-UDP" class="headerlink" title="TCP&#x2F;UDP"></a>TCP&#x2F;UDP</h2><h3 id="ä»€ä¹ˆæ˜¯TCP"><a href="#ä»€ä¹ˆæ˜¯TCP" class="headerlink" title="ä»€ä¹ˆæ˜¯TCP"></a>ä»€ä¹ˆæ˜¯TCP</h3><h3 id="TCPä¸‰æ¬¡æ¡æ‰‹"><a href="#TCPä¸‰æ¬¡æ¡æ‰‹" class="headerlink" title="TCPä¸‰æ¬¡æ¡æ‰‹"></a>TCPä¸‰æ¬¡æ¡æ‰‹</h3><h4 id="ä¸‰æ¬¡æ¡æ‰‹çš„æµç¨‹"><a href="#ä¸‰æ¬¡æ¡æ‰‹çš„æµç¨‹" class="headerlink" title="ä¸‰æ¬¡æ¡æ‰‹çš„æµç¨‹"></a>ä¸‰æ¬¡æ¡æ‰‹çš„æµç¨‹</h4><h4 id="ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡ï¼Œä¸¤æ¬¡è¡Œä¸è¡Œï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡ï¼Œä¸¤æ¬¡è¡Œä¸è¡Œï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡ï¼Œä¸¤æ¬¡è¡Œä¸è¡Œï¼Ÿ"></a>ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡ï¼Œä¸¤æ¬¡è¡Œä¸è¡Œï¼Ÿ</h4><h3 id="TCPå››æ¬¡æŒ¥æ‰‹"><a href="#TCPå››æ¬¡æŒ¥æ‰‹" class="headerlink" title="TCPå››æ¬¡æŒ¥æ‰‹"></a>TCPå››æ¬¡æŒ¥æ‰‹</h3><h4 id="å››æ¬¡æŒ¥æ‰‹çš„æµç¨‹ï¼Ÿ"><a href="#å››æ¬¡æŒ¥æ‰‹çš„æµç¨‹ï¼Ÿ" class="headerlink" title="å››æ¬¡æŒ¥æ‰‹çš„æµç¨‹ï¼Ÿ"></a>å››æ¬¡æŒ¥æ‰‹çš„æµç¨‹ï¼Ÿ</h4><h4 id="ä¸ºä»€ä¹ˆæ˜¯å››æ¬¡æŒ¥æ‰‹ä¸æ˜¯ä¸‰æ¬¡ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆæ˜¯å››æ¬¡æŒ¥æ‰‹ä¸æ˜¯ä¸‰æ¬¡ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆæ˜¯å››æ¬¡æŒ¥æ‰‹ä¸æ˜¯ä¸‰æ¬¡ï¼Ÿ"></a>ä¸ºä»€ä¹ˆæ˜¯å››æ¬¡æŒ¥æ‰‹ä¸æ˜¯ä¸‰æ¬¡ï¼Ÿ</h4><h3 id="TCPå¦‚ä½•ä¿è¯å¯é æ€§ä¼ è¾“"><a href="#TCPå¦‚ä½•ä¿è¯å¯é æ€§ä¼ è¾“" class="headerlink" title="TCPå¦‚ä½•ä¿è¯å¯é æ€§ä¼ è¾“"></a>TCPå¦‚ä½•ä¿è¯å¯é æ€§ä¼ è¾“</h3><h3 id="TCPç²˜åŒ…å’Œæ‹†åŒ…"><a href="#TCPç²˜åŒ…å’Œæ‹†åŒ…" class="headerlink" title="TCPç²˜åŒ…å’Œæ‹†åŒ…"></a>TCPç²˜åŒ…å’Œæ‹†åŒ…</h3><p>TCPæ˜¯ä¸ªâ€œæµâ€åè®®ï¼Œæ‰€è°“æµï¼Œå°±æ˜¯æ²¡æœ‰ç•Œé™çš„ä¸€ä¸²æ•°æ®ã€‚å¤§å®¶å¯ä»¥æƒ³æƒ³æ²³é‡Œçš„æµæ°´ï¼Œæ˜¯è¿æˆä¸€ç‰‡çš„ï¼Œå…¶é—´å¹¶æ²¡æœ‰åˆ†ç•Œçº¿ã€‚TCPåº•å±‚å¹¶ä¸äº†è§£ä¸Šå±‚ä¸šåŠ¡æ•°æ®çš„å…·ä½“å«ä¹‰ï¼Œå®ƒä¼šæ ¹æ®TCPç¼“å†²åŒºçš„å®é™…æƒ…å†µè¿›è¡ŒåŒ…çš„åˆ’åˆ†ï¼Œæ‰€ä»¥åœ¨ä¸šåŠ¡ä¸Šè®¤ä¸ºï¼Œä¸€ä¸ªå®Œæ•´çš„åŒ…å¯èƒ½ä¼šè¢«TCPæ‹†åˆ†æˆå¤šä¸ªåŒ…è¿›è¡Œå‘é€ï¼Œä¹Ÿæœ‰å¯èƒ½æŠŠå¤šä¸ªå°çš„åŒ…å°è£…æˆä¸€ä¸ªå¤§çš„æ•°æ®åŒ…å‘é€ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„TCPç²˜åŒ…å’Œæ‹†åŒ…é—®é¢˜ã€‚</p><h4 id="TCPç²˜åŒ…-æ‹†åŒ…é—®é¢˜è¯´æ˜"><a href="#TCPç²˜åŒ…-æ‹†åŒ…é—®é¢˜è¯´æ˜" class="headerlink" title="TCPç²˜åŒ…&#x2F;æ‹†åŒ…é—®é¢˜è¯´æ˜"></a>TCPç²˜åŒ…&#x2F;æ‹†åŒ…é—®é¢˜è¯´æ˜</h4><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210212215650.png" alt="img"></p><p>å‡è®¾å®¢æˆ·ç«¯åˆ†åˆ«å‘é€äº†ä¸¤ä¸ªæ•°æ®åŒ…D1å’ŒD2ç»™æœåŠ¡ç«¯ï¼Œç”±äºæœåŠ¡ç«¯ä¸€æ¬¡è¯»å–åˆ°çš„å­—èŠ‚æ•°æ˜¯ä¸ç¡®å®šçš„ï¼Œæ•…å¯èƒ½å­˜åœ¨ä»¥ä¸‹4ç§æƒ…å†µã€‚</p><ol><li>æœåŠ¡ç«¯åˆ†ä¸¤æ¬¡è¯»å–åˆ°äº†ä¸¤ä¸ªç‹¬ç«‹çš„æ•°æ®åŒ…ï¼Œåˆ†åˆ«æ˜¯D1å’ŒD2ï¼Œæ²¡æœ‰ç²˜åŒ…å’Œæ‹†åŒ…ï¼›</li><li>æœåŠ¡ç«¯ä¸€æ¬¡æ¥æ”¶åˆ°äº†ä¸¤ä¸ªæ•°æ®åŒ…ï¼ŒD1å’ŒD2ç²˜åˆåœ¨ä¸€èµ·ï¼Œè¢«ç§°ä¸ºTCPç²˜åŒ…ï¼›</li><li>æœåŠ¡ç«¯åˆ†ä¸¤æ¬¡è¯»å–åˆ°äº†ä¸¤ä¸ªæ•°æ®åŒ…ï¼Œç¬¬ä¸€æ¬¡è¯»å–åˆ°äº†å®Œæ•´çš„D1åŒ…å’ŒD2åŒ…çš„éƒ¨åˆ†å†…å®¹ï¼Œç¬¬äºŒæ¬¡è¯»å–åˆ°äº†D2åŒ…çš„å‰©ä½™å†…å®¹ï¼Œè¿™è¢«ç§°ä¸ºTCPæ‹†åŒ…ï¼›</li><li>æœåŠ¡ç«¯åˆ†ä¸¤æ¬¡è¯»å–åˆ°äº†ä¸¤ä¸ªæ•°æ®åŒ…ï¼Œç¬¬ä¸€æ¬¡è¯»å–åˆ°äº†D1åŒ…çš„éƒ¨åˆ†å†…å®¹D1_1ï¼Œç¬¬äºŒæ¬¡è¯»å–åˆ°äº†D1åŒ…çš„å‰©ä½™å†…å®¹D1_2å’ŒD2åŒ…çš„æ•´åŒ…ã€‚</li></ol><p>å¦‚æœæ­¤æ—¶æœåŠ¡ç«¯TCPæ¥æ”¶æ»‘çª—éå¸¸å°ï¼Œè€Œæ•°æ®åŒ…D1å’ŒD2æ¯”è¾ƒå¤§ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šå‘ç”Ÿç¬¬äº”ç§å¯èƒ½ï¼Œå³æœåŠ¡ç«¯åˆ†å¤šæ¬¡æ‰èƒ½å°†D1å’ŒD2åŒ…æ¥æ”¶å®Œå…¨ï¼ŒæœŸé—´å‘ç”Ÿå¤šæ¬¡æ‹†åŒ…ã€‚</p><h4 id="TCPç²˜åŒ…-æ‹†åŒ…å‘ç”Ÿçš„åŸå› "><a href="#TCPç²˜åŒ…-æ‹†åŒ…å‘ç”Ÿçš„åŸå› " class="headerlink" title="TCPç²˜åŒ…&#x2F;æ‹†åŒ…å‘ç”Ÿçš„åŸå› "></a>TCPç²˜åŒ…&#x2F;æ‹†åŒ…å‘ç”Ÿçš„åŸå› </h4><ol><li>åº”ç”¨ç¨‹åºwriteå†™å…¥çš„å­—èŠ‚å¤§å°å¤§äºå¥—æ¥å£å‘é€ç¼“å†²åŒºå¤§å°ï¼›</li><li>è¿›è¡ŒMSSå¤§å°çš„TCPåˆ†æ®µï¼›</li><li>ä»¥å¤ªç½‘å¸§çš„payloadå¤§äºMTUè¿›è¡ŒIPåˆ†ç‰‡ã€‚</li></ol><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210212215514.png" alt="img"></p><h4 id="ç²˜åŒ…é—®é¢˜çš„è§£å†³ç­–ç•¥"><a href="#ç²˜åŒ…é—®é¢˜çš„è§£å†³ç­–ç•¥" class="headerlink" title="ç²˜åŒ…é—®é¢˜çš„è§£å†³ç­–ç•¥"></a>ç²˜åŒ…é—®é¢˜çš„è§£å†³ç­–ç•¥</h4><p>ç”±äºåº•å±‚çš„TCPæ— æ³•ç†è§£ä¸Šå±‚çš„ä¸šåŠ¡æ•°æ®ï¼Œæ‰€ä»¥åœ¨åº•å±‚æ˜¯æ— æ³•ä¿è¯æ•°æ®åŒ…ä¸è¢«æ‹†åˆ†å’Œé‡ç»„çš„ï¼Œè¿™ä¸ªé—®é¢˜åªèƒ½é€šè¿‡ä¸Šå±‚çš„åº”ç”¨åè®®æ ˆè®¾è®¡æ¥è§£å†³ï¼Œæ ¹æ®ä¸šç•Œçš„ä¸»æµåè®®çš„è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥å½’çº³å¦‚ä¸‹ï¼š</p><ol><li>æ¶ˆæ¯å®šé•¿ï¼Œä¾‹å¦‚æ¯ä¸ªæŠ¥æ–‡çš„å¤§å°ä¸ºå›ºå®šé•¿åº¦200å­—èŠ‚ï¼Œå¦‚æœä¸å¤Ÿï¼Œç©ºä½è¡¥ç©ºæ ¼ï¼›</li><li>åœ¨åŒ…å°¾å¢åŠ å›è½¦æ¢è¡Œç¬¦è¿›è¡Œåˆ†å‰²ï¼Œä¾‹å¦‚FTPåè®®ï¼›</li><li>å°†æ¶ˆæ¯åˆ†ä¸ºæ¶ˆæ¯å¤´å’Œæ¶ˆæ¯ä½“ï¼Œæ¶ˆæ¯å¤´ä¸­åŒ…å«è¡¨ç¤ºæ¶ˆæ¯æ€»é•¿åº¦ï¼ˆæˆ–è€…æ¶ˆæ¯ä½“é•¿åº¦ï¼‰çš„å­—æ®µï¼Œé€šå¸¸è®¾è®¡æ€è·¯ä¸ºæ¶ˆæ¯å¤´çš„ç¬¬ä¸€ä¸ªå­—æ®µä½¿ç”¨int32æ¥è¡¨ç¤ºæ¶ˆæ¯çš„æ€»é•¿åº¦ï¼›</li><li>æ›´å¤æ‚çš„åº”ç”¨å±‚åè®®ã€‚</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> é¢ç» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç³»ç»Ÿæ¶æ„è®¾è®¡</title>
      <link href="/posts/75203a6f.html"/>
      <url>/posts/75203a6f.html</url>
      
        <content type="html"><![CDATA[<hr><h1 id="å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¹¶å‘ç³»ç»Ÿï¼Ÿ"><a href="#å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¹¶å‘ç³»ç»Ÿï¼Ÿ" class="headerlink" title="å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¹¶å‘ç³»ç»Ÿï¼Ÿ"></a>å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¹¶å‘ç³»ç»Ÿï¼Ÿ</h1><p>å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ 6 ç‚¹ï¼š</p><ul><li>ç³»ç»Ÿæ‹†åˆ†</li><li>ç¼“å­˜</li><li>MQ</li><li>åˆ†åº“åˆ†è¡¨</li><li>è¯»å†™åˆ†ç¦»</li><li>ElasticSearch</li></ul><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210126145855.png" alt="high-concurrency-system-design"></p><h1 id="å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¯ç”¨ç³»ç»Ÿ"><a href="#å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¯ç”¨ç³»ç»Ÿ" class="headerlink" title="å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¯ç”¨ç³»ç»Ÿ"></a>å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¯ç”¨ç³»ç»Ÿ</h1><h2 id="ä»€ä¹ˆæ˜¯é«˜å¯ç”¨ï¼Ÿå¯ç”¨æ€§çš„åˆ¤æ–­æ ‡å‡†æ˜¯å•¥ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯é«˜å¯ç”¨ï¼Ÿå¯ç”¨æ€§çš„åˆ¤æ–­æ ‡å‡†æ˜¯å•¥ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯é«˜å¯ç”¨ï¼Ÿå¯ç”¨æ€§çš„åˆ¤æ–­æ ‡å‡†æ˜¯å•¥ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯é«˜å¯ç”¨ï¼Ÿå¯ç”¨æ€§çš„åˆ¤æ–­æ ‡å‡†æ˜¯å•¥ï¼Ÿ</h2><p><strong>é«˜å¯ç”¨æè¿°çš„æ˜¯ä¸€ä¸ªç³»ç»Ÿåœ¨å¤§éƒ¨åˆ†æ—¶é—´éƒ½æ˜¯å¯ç”¨çš„ï¼Œå¯ä»¥ä¸ºæˆ‘ä»¬æä¾›æœåŠ¡çš„ã€‚é«˜å¯ç”¨ä»£è¡¨ç³»ç»Ÿå³ä½¿åœ¨å‘ç”Ÿç¡¬ä»¶æ•…éšœæˆ–è€…ç³»ç»Ÿå‡çº§çš„æ—¶å€™ï¼ŒæœåŠ¡ä»ç„¶æ˜¯å¯ç”¨çš„ã€‚</strong></p><p><strong>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨å¤šå°‘ä¸ª 9 æ¥è¯„åˆ¤ä¸€ä¸ªç³»ç»Ÿçš„å¯ç”¨æ€§ï¼Œæ¯”å¦‚ 99.9999% å°±æ˜¯ä»£è¡¨è¯¥ç³»ç»Ÿåœ¨æ‰€æœ‰çš„è¿è¡Œæ—¶é—´ä¸­åªæœ‰ 0.0001% çš„æ—¶é—´æ˜¯ä¸å¯ç”¨çš„ï¼Œè¿™æ ·çš„ç³»ç»Ÿå°±æ˜¯éå¸¸éå¸¸é«˜å¯ç”¨çš„äº†ï¼å½“ç„¶ï¼Œä¹Ÿä¼šæœ‰ç³»ç»Ÿå¦‚æœå¯ç”¨æ€§ä¸å¤ªå¥½çš„è¯ï¼Œå¯èƒ½è¿ 9 éƒ½ä¸Šä¸äº†ã€‚</strong></p><p>é™¤æ­¤ä¹‹å¤–ï¼Œç³»ç»Ÿçš„å¯ç”¨æ€§è¿˜å¯ä»¥ç”¨æŸåŠŸèƒ½çš„å¤±è´¥æ¬¡æ•°ä¸æ€»çš„è¯·æ±‚æ¬¡æ•°ä¹‹æ¯”æ¥è¡¡é‡ï¼Œæ¯”å¦‚å¯¹ç½‘ç«™è¯·æ±‚ 1000 æ¬¡ï¼Œå…¶ä¸­æœ‰ 10 æ¬¡è¯·æ±‚å¤±è´¥ï¼Œé‚£ä¹ˆå¯ç”¨æ€§å°±æ˜¯ 99%ã€‚</p><h2 id="å“ªäº›æƒ…å†µä¼šå¯¼è‡´ç³»ç»Ÿä¸å¯ç”¨ï¼Ÿ"><a href="#å“ªäº›æƒ…å†µä¼šå¯¼è‡´ç³»ç»Ÿä¸å¯ç”¨ï¼Ÿ" class="headerlink" title="å“ªäº›æƒ…å†µä¼šå¯¼è‡´ç³»ç»Ÿä¸å¯ç”¨ï¼Ÿ"></a>å“ªäº›æƒ…å†µä¼šå¯¼è‡´ç³»ç»Ÿä¸å¯ç”¨ï¼Ÿ</h2><ol><li>é»‘å®¢æ”»å‡»ï¼›</li><li>ç¡¬ä»¶æ•…éšœï¼Œæ¯”å¦‚æœåŠ¡å™¨åæ‰ã€‚</li><li>å¹¶å‘é‡&#x2F;ç”¨æˆ·è¯·æ±‚é‡æ¿€å¢å¯¼è‡´æ•´ä¸ªæœåŠ¡å®•æ‰æˆ–è€…éƒ¨åˆ†æœåŠ¡ä¸å¯ç”¨ã€‚</li><li>ä»£ç ä¸­çš„åå‘³é“å¯¼è‡´å†…å­˜æ³„æ¼æˆ–è€…å…¶ä»–é—®é¢˜å¯¼è‡´ç¨‹åºæŒ‚æ‰ã€‚</li><li>ç½‘ç«™æ¶æ„æŸä¸ªé‡è¦çš„è§’è‰²æ¯”å¦‚ Nginx æˆ–è€…æ•°æ®åº“çªç„¶ä¸å¯ç”¨ã€‚</li><li>è‡ªç„¶ç¾å®³æˆ–è€…äººä¸ºç ´åã€‚</li><li>â€¦â€¦</li></ol><h2 id="æœ‰å“ªäº›æé«˜ç³»ç»Ÿå¯ç”¨æ€§çš„æ–¹æ³•ï¼Ÿ"><a href="#æœ‰å“ªäº›æé«˜ç³»ç»Ÿå¯ç”¨æ€§çš„æ–¹æ³•ï¼Ÿ" class="headerlink" title="æœ‰å“ªäº›æé«˜ç³»ç»Ÿå¯ç”¨æ€§çš„æ–¹æ³•ï¼Ÿ"></a>æœ‰å“ªäº›æé«˜ç³»ç»Ÿå¯ç”¨æ€§çš„æ–¹æ³•ï¼Ÿ</h2><h3 id="1-æ³¨é‡ä»£ç è´¨é‡ï¼Œæµ‹è¯•ä¸¥æ ¼æŠŠå…³"><a href="#1-æ³¨é‡ä»£ç è´¨é‡ï¼Œæµ‹è¯•ä¸¥æ ¼æŠŠå…³" class="headerlink" title="1. æ³¨é‡ä»£ç è´¨é‡ï¼Œæµ‹è¯•ä¸¥æ ¼æŠŠå…³"></a>1. æ³¨é‡ä»£ç è´¨é‡ï¼Œæµ‹è¯•ä¸¥æ ¼æŠŠå…³</h3><p>æˆ‘è§‰å¾—è¿™ä¸ªæ˜¯æœ€æœ€æœ€é‡è¦çš„ï¼Œä»£ç è´¨é‡æœ‰é—®é¢˜æ¯”å¦‚æ¯”è¾ƒå¸¸è§çš„å†…å­˜æ³„æ¼ã€å¾ªç¯ä¾èµ–éƒ½æ˜¯å¯¹ç³»ç»Ÿå¯ç”¨æ€§æå¤§çš„æŸå®³ã€‚å¤§å®¶éƒ½å–œæ¬¢è°ˆé™æµã€é™çº§ã€ç†”æ–­ï¼Œä½†æ˜¯æˆ‘è§‰å¾—ä»ä»£ç è´¨é‡è¿™ä¸ªæºå¤´æŠŠå…³æ˜¯é¦–å…ˆè¦åšå¥½çš„ä¸€ä»¶å¾ˆé‡è¦çš„äº‹æƒ…ã€‚å¦‚ä½•æé«˜ä»£ç è´¨é‡ï¼Ÿæ¯”è¾ƒå®é™…å¯ç”¨çš„å°±æ˜¯ CodeReviewï¼Œä¸è¦åœ¨ä¹æ¯å¤©å¤šèŠ±çš„é‚£ 1 ä¸ªå°æ—¶å·¦å³çš„æ—¶é—´ï¼Œä½œç”¨å¯å¤§ç€å‘¢ï¼</p><p>å¦å¤–ï¼Œå®‰åˆ©è¿™ä¸ªå¯¹æé«˜ä»£ç è´¨é‡æœ‰å®é™…æ•ˆæœçš„å®è´ï¼š</p><ol><li>sonarqube ï¼šä¿è¯ä½ å†™å‡ºæ›´å®‰å…¨æ›´å¹²å‡€çš„ä»£ç ï¼ï¼ˆps: ç›®å‰æ‰€åœ¨çš„é¡¹ç›®åŸºæœ¬éƒ½ä¼šç”¨åˆ°è¿™ä¸ªæ’ä»¶ï¼‰ã€‚</li><li>Alibaba å¼€æºçš„ Java è¯Šæ–­å·¥å…· Arthas ä¹Ÿæ˜¯å¾ˆä¸é”™çš„é€‰æ‹©ã€‚</li><li>IDEA è‡ªå¸¦çš„ä»£ç åˆ†æç­‰å·¥å…·è¿›è¡Œä»£ç æ‰«æä¹Ÿæ˜¯éå¸¸éå¸¸æ£’çš„ã€‚</li></ol><h3 id="2-ä½¿ç”¨é›†ç¾¤ï¼Œå‡å°‘å•ç‚¹æ•…éšœ"><a href="#2-ä½¿ç”¨é›†ç¾¤ï¼Œå‡å°‘å•ç‚¹æ•…éšœ" class="headerlink" title="2.ä½¿ç”¨é›†ç¾¤ï¼Œå‡å°‘å•ç‚¹æ•…éšœ"></a>2.ä½¿ç”¨é›†ç¾¤ï¼Œå‡å°‘å•ç‚¹æ•…éšœ</h3><p>å…ˆæ‹¿å¸¸ç”¨çš„ Redis ä¸¾ä¸ªä¾‹å­ï¼æˆ‘ä»¬å¦‚ä½•ä¿è¯æˆ‘ä»¬çš„ Redis ç¼“å­˜é«˜å¯ç”¨å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ä½¿ç”¨é›†ç¾¤ï¼Œé¿å…å•ç‚¹æ•…éšœã€‚å½“æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ª Redis å®ä¾‹ä½œä¸ºç¼“å­˜çš„æ—¶å€™ï¼Œè¿™ä¸ª Redis å®ä¾‹æŒ‚äº†ä¹‹åï¼Œæ•´ä¸ªç¼“å­˜æœåŠ¡å¯èƒ½å°±æŒ‚äº†ã€‚ä½¿ç”¨äº†é›†ç¾¤ä¹‹åï¼Œå³ä½¿ä¸€å° Redis å®ä¾‹ï¼Œä¸åˆ°ä¸€ç§’å°±ä¼šæœ‰å¦å¤–ä¸€å° Redis å®ä¾‹é¡¶ä¸Šã€‚</p><h3 id="3-é™æµ"><a href="#3-é™æµ" class="headerlink" title="3.é™æµ"></a>3.é™æµ</h3><p>æµé‡æ§åˆ¶ï¼ˆflow controlï¼‰ï¼Œå…¶åŸç†æ˜¯ç›‘æ§åº”ç”¨æµé‡çš„ QPS æˆ–å¹¶å‘çº¿ç¨‹æ•°ç­‰æŒ‡æ ‡ï¼Œå½“è¾¾åˆ°æŒ‡å®šçš„é˜ˆå€¼æ—¶å¯¹æµé‡è¿›è¡Œæ§åˆ¶ï¼Œä»¥é¿å…è¢«ç¬æ—¶çš„æµé‡é«˜å³°å†²å®ï¼Œä»è€Œä¿éšœåº”ç”¨çš„é«˜å¯ç”¨æ€§ã€‚â€”â€”æ¥è‡ª alibaba-<a href="https://github.com/alibaba/Sentinel">Sentinel</a> çš„ wikiã€‚</p><h3 id="4-è¶…æ—¶å’Œé‡è¯•æœºåˆ¶è®¾ç½®"><a href="#4-è¶…æ—¶å’Œé‡è¯•æœºåˆ¶è®¾ç½®" class="headerlink" title="4.è¶…æ—¶å’Œé‡è¯•æœºåˆ¶è®¾ç½®"></a>4.è¶…æ—¶å’Œé‡è¯•æœºåˆ¶è®¾ç½®</h3><p>ä¸€æ—¦ç”¨æˆ·è¯·æ±‚è¶…è¿‡æŸä¸ªæ—¶é—´çš„å¾—ä¸åˆ°å“åº”ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ã€‚è¿™ä¸ªæ˜¯éå¸¸é‡è¦çš„ï¼Œå¾ˆå¤šçº¿ä¸Šç³»ç»Ÿæ•…éšœéƒ½æ˜¯å› ä¸ºæ²¡æœ‰è¿›è¡Œè¶…æ—¶è®¾ç½®æˆ–è€…è¶…æ—¶è®¾ç½®çš„æ–¹å¼ä¸å¯¹å¯¼è‡´çš„ã€‚æˆ‘ä»¬åœ¨è¯»å–ç¬¬ä¸‰æ–¹æœåŠ¡çš„æ—¶å€™ï¼Œå°¤å…¶é€‚åˆè®¾ç½®è¶…æ—¶å’Œé‡è¯•æœºåˆ¶ã€‚ä¸€èˆ¬æˆ‘ä»¬ä½¿ç”¨ä¸€äº› RPC æ¡†æ¶çš„æ—¶å€™ï¼Œè¿™äº›æ¡†æ¶éƒ½è‡ªå¸¦çš„è¶…æ—¶é‡è¯•çš„é…ç½®ã€‚å¦‚æœä¸è¿›è¡Œè¶…æ—¶è®¾ç½®å¯èƒ½ä¼šå¯¼è‡´è¯·æ±‚å“åº”é€Ÿåº¦æ…¢ï¼Œç”šè‡³å¯¼è‡´è¯·æ±‚å †ç§¯è¿›è€Œè®©ç³»ç»Ÿæ— æ³•åœ¨å¤„ç†è¯·æ±‚ã€‚é‡è¯•çš„æ¬¡æ•°ä¸€èˆ¬è®¾ä¸º 3 æ¬¡ï¼Œå†å¤šæ¬¡çš„é‡è¯•æ²¡æœ‰å¥½å¤„ï¼Œåè€Œä¼šåŠ é‡æœåŠ¡å™¨å‹åŠ›ï¼ˆéƒ¨åˆ†åœºæ™¯ä½¿ç”¨å¤±è´¥é‡è¯•æœºåˆ¶ä¼šä¸å¤ªé€‚åˆï¼‰ã€‚</p><h3 id="5-ç†”æ–­æœºåˆ¶"><a href="#5-ç†”æ–­æœºåˆ¶" class="headerlink" title="5.ç†”æ–­æœºåˆ¶"></a>5.ç†”æ–­æœºåˆ¶</h3><p>è¶…æ—¶å’Œé‡è¯•æœºåˆ¶è®¾ç½®ä¹‹å¤–ï¼Œç†”æ–­æœºåˆ¶ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ã€‚ ç†”æ–­æœºåˆ¶è¯´çš„æ˜¯ç³»ç»Ÿè‡ªåŠ¨æ”¶é›†æ‰€ä¾èµ–æœåŠ¡çš„èµ„æºä½¿ç”¨æƒ…å†µå’Œæ€§èƒ½æŒ‡æ ‡ï¼Œå½“æ‰€ä¾èµ–çš„æœåŠ¡æ¶åŒ–æˆ–è€…è°ƒç”¨å¤±è´¥æ¬¡æ•°è¾¾åˆ°æŸä¸ªé˜ˆå€¼çš„æ—¶å€™å°±è¿…é€Ÿå¤±è´¥ï¼Œè®©å½“å‰ç³»ç»Ÿç«‹å³åˆ‡æ¢ä¾èµ–å…¶ä»–å¤‡ç”¨æœåŠ¡ã€‚ æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯æµé‡æ§åˆ¶å’Œç†”æ–­é™çº§æ¡†æ¶æ˜¯ Netflix çš„ Hystrix å’Œ alibaba çš„ Sentinelã€‚</p><h3 id="6-å¼‚æ­¥è°ƒç”¨"><a href="#6-å¼‚æ­¥è°ƒç”¨" class="headerlink" title="6.å¼‚æ­¥è°ƒç”¨"></a>6.å¼‚æ­¥è°ƒç”¨</h3><p>å¼‚æ­¥è°ƒç”¨çš„è¯æˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒæœ€åçš„ç»“æœï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç”¨æˆ·è¯·æ±‚å®Œæˆä¹‹åå°±ç«‹å³è¿”å›ç»“æœï¼Œå…·ä½“å¤„ç†æˆ‘ä»¬å¯ä»¥åç»­å†åšï¼Œç§’æ€åœºæ™¯ç”¨è¿™ä¸ªè¿˜æ˜¯è›®å¤šçš„ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨å¼‚æ­¥ä¹‹åæˆ‘ä»¬å¯èƒ½éœ€è¦ <strong>é€‚å½“ä¿®æ”¹ä¸šåŠ¡æµç¨‹è¿›è¡Œé…åˆ</strong>ï¼Œæ¯”å¦‚<strong>ç”¨æˆ·åœ¨æäº¤è®¢å•ä¹‹åï¼Œä¸èƒ½ç«‹å³è¿”å›ç”¨æˆ·è®¢å•æäº¤æˆåŠŸï¼Œéœ€è¦åœ¨æ¶ˆæ¯é˜Ÿåˆ—çš„è®¢å•æ¶ˆè´¹è€…è¿›ç¨‹çœŸæ­£å¤„ç†å®Œè¯¥è®¢å•ä¹‹åï¼Œç”šè‡³å‡ºåº“åï¼Œå†é€šè¿‡ç”µå­é‚®ä»¶æˆ–çŸ­ä¿¡é€šçŸ¥ç”¨æˆ·è®¢å•æˆåŠŸ</strong>ã€‚é™¤äº†å¯ä»¥åœ¨ç¨‹åºä¸­å®ç°å¼‚æ­¥ä¹‹å¤–ï¼Œæˆ‘ä»¬å¸¸å¸¸è¿˜ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥é€šè¿‡å¼‚æ­¥å¤„ç†æé«˜ç³»ç»Ÿæ€§èƒ½ï¼ˆå‰Šå³°ã€å‡å°‘å“åº”æ‰€éœ€æ—¶é—´ï¼‰å¹¶ä¸”å¯ä»¥é™ä½ç³»ç»Ÿè€¦åˆæ€§ã€‚</p><h3 id="7-ä½¿ç”¨ç¼“å­˜"><a href="#7-ä½¿ç”¨ç¼“å­˜" class="headerlink" title="7.ä½¿ç”¨ç¼“å­˜"></a>7.ä½¿ç”¨ç¼“å­˜</h3><p>å¦‚æœæˆ‘ä»¬çš„ç³»ç»Ÿå±äºå¹¶å‘é‡æ¯”è¾ƒé«˜çš„è¯ï¼Œå¦‚æœæˆ‘ä»¬å•çº¯ä½¿ç”¨æ•°æ®åº“çš„è¯ï¼Œå½“å¤§é‡è¯·æ±‚ç›´æ¥è½åˆ°æ•°æ®åº“å¯èƒ½æ•°æ®åº“å°±ä¼šç›´æ¥æŒ‚æ‰ã€‚ä½¿ç”¨ç¼“å­˜ç¼“å­˜çƒ­ç‚¹æ•°æ®ï¼Œå› ä¸ºç¼“å­˜å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥é€Ÿåº¦ç›¸å½“åœ°å¿«ï¼</p><h3 id="8-å…¶ä»–"><a href="#8-å…¶ä»–" class="headerlink" title="8.å…¶ä»–"></a>8.å…¶ä»–</h3><ol><li><strong>æ ¸å¿ƒåº”ç”¨å’ŒæœåŠ¡ä¼˜å…ˆä½¿ç”¨æ›´å¥½çš„ç¡¬ä»¶</strong></li><li><strong>ç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µå¢åŠ æŠ¥è­¦è®¾ç½®ã€‚</strong></li><li><strong>æ³¨æ„å¤‡ä»½ï¼Œå¿…è¦æ—¶å€™å›æ»šã€‚</strong></li><li><strong>ç°åº¦å‘å¸ƒï¼š</strong> å°†æœåŠ¡å™¨é›†ç¾¤åˆ†æˆè‹¥å¹²éƒ¨åˆ†ï¼Œæ¯å¤©åªå‘å¸ƒä¸€éƒ¨åˆ†æœºå™¨ï¼Œè§‚å¯Ÿè¿è¡Œç¨³å®šæ²¡æœ‰æ•…éšœï¼Œç¬¬äºŒå¤©ç»§ç»­å‘å¸ƒä¸€éƒ¨åˆ†æœºå™¨ï¼ŒæŒç»­å‡ å¤©æ‰æŠŠæ•´ä¸ªé›†ç¾¤å…¨éƒ¨å‘å¸ƒå®Œæ¯•ï¼ŒæœŸé—´å¦‚æœå‘ç°é—®é¢˜ï¼Œåªéœ€è¦å›æ»šå·²å‘å¸ƒçš„ä¸€éƒ¨åˆ†æœåŠ¡å™¨å³å¯</li><li><strong>å®šæœŸæ£€æŸ¥&#x2F;æ›´æ¢ç¡¬ä»¶ï¼š</strong> å¦‚æœä¸æ˜¯è´­ä¹°çš„äº‘æœåŠ¡çš„è¯ï¼Œå®šæœŸè¿˜æ˜¯éœ€è¦å¯¹ç¡¬ä»¶è¿›è¡Œä¸€æ³¢æ£€æŸ¥çš„ï¼Œå¯¹äºä¸€äº›éœ€è¦æ›´æ¢æˆ–è€…å‡çº§çš„ç¡¬ä»¶ï¼Œè¦åŠæ—¶æ›´æ¢æˆ–è€…å‡çº§ã€‚</li><li>â€¦..(æƒ³èµ·æ¥å†è¡¥å……ï¼ä¹Ÿæ¬¢è¿å„ä½æ¬¢è¿è¡¥å……ï¼)</li></ol><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210213235715.png" alt="å¦‚ä½•è®¾è®¡é«˜å¯ç”¨ç³»ç»Ÿï¼Ÿ"></p>]]></content>
      
      
      
        <tags>
            
            <tag> é¢ç» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¡ç®—æœºåŸºç¡€</title>
      <link href="/posts/c783f2ce.html"/>
      <url>/posts/c783f2ce.html</url>
      
        <content type="html"><![CDATA[<hr><h1 id="æ“ä½œç³»ç»Ÿ"><a href="#æ“ä½œç³»ç»Ÿ" class="headerlink" title="æ“ä½œç³»ç»Ÿ"></a>æ“ä½œç³»ç»Ÿ</h1><h2 id="ä»‹ç»ä¸‹Linuxï¼ˆUnixï¼‰æ“ä½œç³»ç»Ÿçš„äº”ç§IOæ¨¡å‹"><a href="#ä»‹ç»ä¸‹Linuxï¼ˆUnixï¼‰æ“ä½œç³»ç»Ÿçš„äº”ç§IOæ¨¡å‹" class="headerlink" title="ä»‹ç»ä¸‹Linuxï¼ˆUnixï¼‰æ“ä½œç³»ç»Ÿçš„äº”ç§IOæ¨¡å‹"></a>ä»‹ç»ä¸‹Linuxï¼ˆUnixï¼‰æ“ä½œç³»ç»Ÿçš„äº”ç§IOæ¨¡å‹</h2><p>åœ¨Linux(UNIX)æ“ä½œç³»ç»Ÿä¸­ï¼Œå…±æœ‰äº”ç§IOæ¨¡å‹ï¼Œåˆ†åˆ«æ˜¯ï¼š<strong>é˜»å¡IOæ¨¡å‹</strong>ã€<strong>éé˜»å¡IOæ¨¡å‹</strong>ã€<strong>IOå¤ç”¨æ¨¡å‹</strong>ã€<strong>ä¿¡å·é©±åŠ¨IOæ¨¡å‹</strong>ä»¥åŠ<strong>å¼‚æ­¥IOæ¨¡å‹</strong>ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210126103811.jpeg" alt="å›¾ç‰‡"></p><p>æˆ‘ä»¬è¯´é˜»å¡IOæ¨¡å‹ã€éé˜»å¡IOæ¨¡å‹ã€IOå¤ç”¨æ¨¡å‹å’Œä¿¡å·é©±åŠ¨IOæ¨¡å‹éƒ½æ˜¯åŒæ­¥çš„IOæ¨¡å‹ã€‚åŸå› æ˜¯å› ä¸ºï¼Œæ— è®ºä»¥ä¸Šé‚£ç§æ¨¡å‹ï¼ŒçœŸæ­£çš„æ•°æ®æ‹·è´è¿‡ç¨‹ï¼Œéƒ½æ˜¯åŒæ­¥è¿›è¡Œçš„ã€‚</p><p><strong>åŒæ­¥å’Œå¼‚æ­¥ï¼š</strong></p><p>ä»æ“ä½œç³»ç»Ÿè§’åº¦æ¥è¯´ï¼Œ<strong>ç½‘ç»œIOçš„æ•°æ®æ‹·è´ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œä¸€æ˜¯æ•°æ®å‡†å¤‡é˜¶æ®µï¼ŒäºŒæ˜¯æ•°æ®ä»å†…æ ¸æ‹·è´åˆ°ç”¨æˆ·ä¸­ã€‚</strong></p><p>åŒæ­¥IOæŒ‡çš„æ˜¯æ•°æ®ä»å†…æ ¸æ‹·è´åˆ°ç”¨æˆ·æ—¶ã€‚å‘èµ·è¯¥è¯·æ±‚çš„çº¿ç¨‹ä¼šè‡ªå·±æ¥æ‹·è´æ•°æ®ï¼ˆè¡¨ç°ä¸ºçº¿ç¨‹é˜»å¡æ‹·è´ï¼‰ã€‚</p><p>PSï¼šä¸€æ—¦æ¶‰åŠåˆ°ç½‘ç»œ IOå¿…å®šä¼šå‘ç”Ÿæ•°æ®æ‹·è´çš„é˜»å¡ï¼ˆæ­¤é˜»å¡éå½¼é˜»å¡ï¼Œè¿™é‡Œçš„é˜»å¡å½¢å®¹çš„æ˜¯æ‹·è´æ•°æ®ç›¸å¯¹äºCPUçš„é€Ÿåº¦æ¥è¯´æ˜¯éå¸¸è€—æ—¶çš„ï¼Œçœ‹èµ·æ¥åƒçº¿ç¨‹é˜»å¡äº†ä¸€æ ·ã€‚æˆ‘ä»¬å¸¸è¯´çš„é˜»å¡æ˜¯çº¿ç¨‹æŒ‚èµ·å¹¶è®©å‡ºCPUï¼‰ï¼Œåªä¸è¿‡é˜»å¡å‘ç”Ÿåœ¨å…¶ä»–çš„åœ°æ–¹ï¼ˆè‡ªå·±æ¥æ‹·è´å°±æ˜¯åŒæ­¥çš„ï¼Œåˆ«äººå¸®æˆ‘æ‹·è´å°±æ˜¯å¼‚æ­¥çš„ï¼‰ï¼Œå› ä¸ºIOå¿…å®šä¼šç”¨åˆ°CPUï¼Œå³ä½¿æ˜¯é›¶æ‹·è´ã€‚</p><p><strong>é˜»å¡å’Œéé˜»å¡ï¼š</strong></p><p>é˜»å¡å’Œéé˜»å¡ä¸»è¦æè¿°çš„æ˜¯ç½‘ç»œIOæ•°æ®æ‹·è´çš„ç¬¬ä¸€ä¸ªé˜¶æ®µã€‚</p><p>é˜»å¡æŒ‡çš„æ˜¯çº¿ç¨‹ä¸€ç›´ç­‰å¾…æ•°æ®å‡†å¤‡å¥½ï¼ŒæœŸé—´ä»€ä¹ˆéƒ½ä¸å¹²ï¼Œä½†æ˜¯ä¼šè®©å‡ºCPUï¼Œè¿™æ ·å…¶ä»–çº¿ç¨‹å¯ä»¥æ‰§è¡Œï¼ˆCPUçš„åˆ©ç”¨ç‡æ¯”è¾ƒé«˜ï¼‰ï¼Œæ•°æ®å‡†å¤‡å¥½ä¹‹åè‡ªå·±æ¥æ‹·è´æ•°æ®ã€‚</p><p>éé˜»å¡æŒ‡çš„æ˜¯åœ¨ç¬¬ä¸€é˜¶æ®µï¼Œå‘èµ·ç½‘ç»œIOè¯·æ±‚çš„æ—¶å€™ä¼šç«‹å³è¿”å›å»å¹²åˆ«çš„äº‹æƒ…ï¼Œä½†æ˜¯ä¼šä¸æ–­åœ°è¿›è¡Œè¯¢é—®æ•°æ®æ˜¯å¦å‡†å¤‡å¥½ï¼Œè¿™ç§æ–¹å¼ç§°ä¹‹ä¸ºè½®è¯¢ã€‚ç”±äºCPUè¦å¤„ç†æ›´å¤šçš„ç³»ç»Ÿè°ƒç”¨ï¼ˆæ¯æ¬¡è¯¢é—®éƒ½æ˜¯ç³»ç»Ÿè°ƒç”¨ï¼‰ï¼Œè¿™ç§æ¨¡å‹çš„CPUåˆ©ç”¨ç‡ä½ã€‚</p><h2 id="NIOæ˜¯å¦‚ä½•å®ç°åŒæ­¥éé˜»å¡çš„å‘¢ï¼Ÿ"><a href="#NIOæ˜¯å¦‚ä½•å®ç°åŒæ­¥éé˜»å¡çš„å‘¢ï¼Ÿ" class="headerlink" title="NIOæ˜¯å¦‚ä½•å®ç°åŒæ­¥éé˜»å¡çš„å‘¢ï¼Ÿ"></a>NIOæ˜¯å¦‚ä½•å®ç°åŒæ­¥éé˜»å¡çš„å‘¢ï¼Ÿ</h2><p>Javaçš„NIOå®ç°é‡‡ç”¨äº†åŒæ­¥éé˜»å¡IOå’ŒIOå¤šè·¯å¤ç”¨ï¼Œå…¶æ ¸å¿ƒç»„ä»¶æ˜¯Selectorã€‚Selectorä¼šä¸æ–­çš„ä¸»åŠ¨çš„è¯¢é—®Channelæ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿï¼Œæœ‰äº‹ä»¶å‘ç”Ÿï¼Œä¼šè¿›è¡Œäº‹ä»¶å¤„ç†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//java nio</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">  ......</span><br><span class="line">  selector.select(<span class="number">1</span>); <span class="comment">//ä¸é˜»å¡</span></span><br><span class="line">  Set&lt;SelectionKey&gt; selectionKeySet= selector.selectedKeys();</span><br><span class="line">  ......</span><br><span class="line">  <span class="comment">//å¤„ç†selectionKeySetä¸­äº‹ä»¶,çº¿ç¨‹æ²¡æœ‰é˜»å¡</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//java socketå¤„ç†è¿æ¥ï¼Œçº¿ç¨‹ä¼šé˜»å¡</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">  ......</span><br><span class="line">  <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> serverSocket.accept(); <span class="comment">//é˜»å¡</span></span><br><span class="line">  <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> socket.getInputStream(); </span><br><span class="line">  ......</span><br><span class="line">  <span class="comment">//å¤„ç†inä¸­å†…å®¹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Nettyé‡‡ç”¨çš„æ˜¯NIOå…¶å¯¹Javaçš„NIOè¿›è¡Œäº†æ”¹è¿›ï¼Œå…¶å†…éƒ¨ä¹Ÿå°è£…äº†Selectorå’ŒChannelï¼Œé‡‡ç”¨ä¸²è¡Œå¹¶å‘æ¥æé«˜æ•ˆç‡ã€‚</p><p>Javaçš„NIOé‡‡ç”¨çš„æ˜¯Reactorçº¿ç¨‹æ¨¡å‹ä¸­çš„å•Reactorå•çº¿ç¨‹æ¨¡å‹ï¼ˆå‰å°å’ŒæœåŠ¡å‘˜æ˜¯ä¸€ä¸ªäººï¼Œå…¨ç¨‹ä¸ºé¡¾å®¢æœåŠ¡ï¼Œå¯ä»¥æœåŠ¡å¤šä¸ªäººï¼‰ï¼ŒNettyçš„NIOé‡‡ç”¨çš„æ˜¯ä¸»ä»Reactoræ¨¡å‹ï¼Œæ˜¯å¤šReactorå¤šçº¿ç¨‹æ¨¡å‹ã€‚</p><h2 id="I-O-å¤šè·¯å¤ç”¨"><a href="#I-O-å¤šè·¯å¤ç”¨" class="headerlink" title="I&#x2F;O å¤šè·¯å¤ç”¨"></a>I&#x2F;O å¤šè·¯å¤ç”¨</h2><p><a href="https://imageslr.com/2020/02/27/select-poll-epoll.html#%E4%BB%8E%E9%98%BB%E5%A1%9E-io-%E5%88%B0-io-%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8">å‚è€ƒï¼šä»é˜»å¡-io-åˆ°-io-å¤šè·¯å¤ç”¨</a></p><h3 id="select-çš„ç¼ºç‚¹"><a href="#select-çš„ç¼ºç‚¹" class="headerlink" title="select çš„ç¼ºç‚¹"></a>select çš„ç¼ºç‚¹</h3><ol><li>æ€§èƒ½å¼€é”€å¤§<ol><li>è°ƒç”¨ <code>select</code> æ—¶ä¼šé™·å…¥å†…æ ¸ï¼Œè¿™æ—¶éœ€è¦å°†å‚æ•°ä¸­çš„ <code>fd_set</code> ä»ç”¨æˆ·ç©ºé—´æ‹·è´åˆ°å†…æ ¸ç©ºé—´</li><li>å†…æ ¸éœ€è¦éå†ä¼ é€’è¿›æ¥çš„æ‰€æœ‰ <code>fd_set</code> çš„æ¯ä¸€ä½ï¼Œä¸ç®¡å®ƒä»¬æ˜¯å¦å°±ç»ª</li></ol></li><li>åŒæ—¶èƒ½å¤Ÿç›‘å¬çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡å¤ªå°‘ã€‚å—é™äº <code>sizeof(fd_set)</code> çš„å¤§å°ï¼Œåœ¨ç¼–è¯‘å†…æ ¸æ—¶å°±ç¡®å®šäº†ä¸”æ— æ³•æ›´æ”¹ã€‚ä¸€èˆ¬æ˜¯ 1024ï¼Œä¸åŒçš„æ“ä½œç³»ç»Ÿä¸ç›¸åŒ</li></ol><h3 id="poll"><a href="#poll" class="headerlink" title="poll"></a>poll</h3><p>poll å’Œ select å‡ ä¹æ²¡æœ‰åŒºåˆ«ã€‚poll é‡‡ç”¨é“¾è¡¨çš„æ–¹å¼å­˜å‚¨æ–‡ä»¶æè¿°ç¬¦ï¼Œæ²¡æœ‰æœ€å¤§å­˜å‚¨æ•°é‡çš„é™åˆ¶ã€‚</p><p>ä»æ€§èƒ½å¼€é”€ä¸Šçœ‹ï¼Œpoll å’Œ select çš„å·®åˆ«ä¸å¤§ã€‚</p><h3 id="epoll"><a href="#epoll" class="headerlink" title="epoll"></a>epoll</h3><p>epoll æ˜¯å¯¹ select å’Œ poll çš„æ”¹è¿›ï¼Œé¿å…äº†â€œæ€§èƒ½å¼€é”€å¤§â€å’Œâ€œæ–‡ä»¶æè¿°ç¬¦æ•°é‡å°‘â€ä¸¤ä¸ªç¼ºç‚¹ã€‚</p><p>ç®€è€Œè¨€ä¹‹ï¼Œepoll æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š</p><ul><li>ä½¿ç”¨<strong>çº¢é»‘æ ‘</strong>å­˜å‚¨æ–‡ä»¶æè¿°ç¬¦é›†åˆ</li><li>ä½¿ç”¨<strong>é˜Ÿåˆ—</strong>å­˜å‚¨å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦</li><li>æ¯ä¸ªæ–‡ä»¶æè¿°ç¬¦åªéœ€åœ¨æ·»åŠ æ—¶ä¼ å…¥ä¸€æ¬¡ï¼›é€šè¿‡äº‹ä»¶æ›´æ”¹æ–‡ä»¶æè¿°ç¬¦çŠ¶æ€</li></ul><p>selectã€poll æ¨¡å‹éƒ½åªä½¿ç”¨ä¸€ä¸ªå‡½æ•°ï¼Œè€Œ epoll æ¨¡å‹ä½¿ç”¨ä¸‰ä¸ªå‡½æ•°ï¼š<code>epoll_create</code>ã€<code>epoll_ctl</code> å’Œ <code>epoll_wait</code>ã€‚</p><h3 id="epoll-çš„ä¼˜ç‚¹"><a href="#epoll-çš„ä¼˜ç‚¹" class="headerlink" title="epoll çš„ä¼˜ç‚¹"></a>epoll çš„ä¼˜ç‚¹</h3><p>ä¸€å¼€å§‹è¯´ï¼Œepoll æ˜¯å¯¹ select å’Œ poll çš„æ”¹è¿›ï¼Œé¿å…äº†â€œæ€§èƒ½å¼€é”€å¤§â€å’Œâ€œæ–‡ä»¶æè¿°ç¬¦æ•°é‡å°‘â€ä¸¤ä¸ªç¼ºç‚¹ã€‚</p><p>å¯¹äºâ€œæ–‡ä»¶æè¿°ç¬¦æ•°é‡å°‘â€ï¼Œselect ä½¿ç”¨æ•´å‹æ•°ç»„å­˜å‚¨æ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œè€Œ epoll ä½¿ç”¨çº¢é»‘æ ‘å­˜å‚¨ï¼Œæ•°é‡è¾ƒå¤§ã€‚</p><p>å¯¹äºâ€œæ€§èƒ½å¼€é”€å¤§â€ï¼Œ<code>epoll_ctl</code> ä¸­ä¸ºæ¯ä¸ªæ–‡ä»¶æè¿°ç¬¦æŒ‡å®šäº†å›è°ƒå‡½æ•°ï¼Œå¹¶åœ¨å°±ç»ªæ—¶å°†å…¶åŠ å…¥åˆ°å°±ç»ªåˆ—è¡¨ï¼Œå› æ­¤ epoll ä¸éœ€è¦åƒ <code>select</code> é‚£æ ·éå†æ£€æµ‹æ¯ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œåªéœ€è¦åˆ¤æ–­å°±ç»ªåˆ—è¡¨æ˜¯å¦ä¸ºç©ºå³å¯ã€‚è¿™æ ·ï¼Œåœ¨æ²¡æœ‰æè¿°ç¬¦å°±ç»ªæ—¶ï¼Œepoll èƒ½æ›´æ—©åœ°è®©å‡ºç³»ç»Ÿèµ„æºã€‚</p><blockquote><p>ç›¸å½“äºæ—¶é—´å¤æ‚åº¦ä» O(n) é™ä¸º O(1)</p></blockquote><p>æ­¤å¤–ï¼Œæ¯æ¬¡è°ƒç”¨ <code>select</code> æ—¶éƒ½éœ€è¦å‘å†…æ ¸æ‹·è´æ‰€æœ‰è¦ç›‘å¬çš„æè¿°ç¬¦é›†åˆï¼Œè€Œ epoll å¯¹äºæ¯ä¸ªæè¿°ç¬¦ï¼Œåªéœ€è¦åœ¨ <code>epoll_ctl</code> ä¼ é€’ä¸€æ¬¡ï¼Œä¹‹å <code>epoll_wait</code> ä¸éœ€è¦å†æ¬¡ä¼ é€’ã€‚è¿™ä¹Ÿå¤§å¤§æé«˜äº†æ•ˆç‡ã€‚</p><h3 id="æ°´å¹³è§¦å‘ã€è¾¹ç¼˜è§¦å‘"><a href="#æ°´å¹³è§¦å‘ã€è¾¹ç¼˜è§¦å‘" class="headerlink" title="æ°´å¹³è§¦å‘ã€è¾¹ç¼˜è§¦å‘"></a>æ°´å¹³è§¦å‘ã€è¾¹ç¼˜è§¦å‘</h3><p><code>select</code> åªæ”¯æŒæ°´å¹³è§¦å‘ï¼Œ<code>epoll</code> æ”¯æŒæ°´å¹³è§¦å‘å’Œè¾¹ç¼˜è§¦å‘ã€‚</p><p>æ°´å¹³è§¦å‘ï¼ˆLTï¼ŒLevel Triggerï¼‰ï¼šå½“æ–‡ä»¶æè¿°ç¬¦å°±ç»ªæ—¶ï¼Œä¼šè§¦å‘é€šçŸ¥ï¼Œå¦‚æœç”¨æˆ·ç¨‹åºæ²¡æœ‰ä¸€æ¬¡æ€§æŠŠæ•°æ®è¯»&#x2F;å†™å®Œï¼Œä¸‹æ¬¡è¿˜ä¼šå‘å‡ºå¯è¯»&#x2F;å¯å†™ä¿¡å·è¿›è¡Œé€šçŸ¥ã€‚</p><p>è¾¹ç¼˜è§¦å‘ï¼ˆETï¼ŒEdge Triggerï¼‰ï¼šä»…å½“æè¿°ç¬¦ä»æœªå°±ç»ªå˜ä¸ºå°±ç»ªæ—¶ï¼Œé€šçŸ¥ä¸€æ¬¡ï¼Œä¹‹åä¸ä¼šå†é€šçŸ¥ã€‚</p><p>åŒºåˆ«ï¼šè¾¹ç¼˜è§¦å‘æ•ˆç‡æ›´é«˜ï¼Œ<strong>å‡å°‘äº†äº‹ä»¶è¢«é‡å¤è§¦å‘çš„æ¬¡æ•°</strong>ï¼Œå‡½æ•°ä¸ä¼šè¿”å›å¤§é‡ç”¨æˆ·ç¨‹åºå¯èƒ½ä¸éœ€è¦çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</p><blockquote><p>æ°´å¹³è§¦å‘ã€è¾¹ç¼˜è§¦å‘çš„åç§°æ¥æºï¼šæ•°å­—ç”µè·¯å½“ä¸­çš„ç”µä½æ°´å¹³ï¼Œé«˜ä½ç”µå¹³åˆ‡æ¢ç¬é—´çš„è§¦å‘åŠ¨ä½œå«è¾¹ç¼˜è§¦å‘ï¼Œè€Œå¤„äºé«˜ç”µå¹³çš„è§¦å‘åŠ¨ä½œå«åšæ°´å¹³è§¦å‘ã€‚</p></blockquote><h3 id="ä¸ºä»€ä¹ˆè¾¹ç¼˜è§¦å‘å¿…é¡»ä½¿ç”¨éé˜»å¡-I-Oï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¾¹ç¼˜è§¦å‘å¿…é¡»ä½¿ç”¨éé˜»å¡-I-Oï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¾¹ç¼˜è§¦å‘å¿…é¡»ä½¿ç”¨éé˜»å¡ I&#x2F;Oï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¾¹ç¼˜è§¦å‘å¿…é¡»ä½¿ç”¨éé˜»å¡ I&#x2F;Oï¼Ÿ</h3><p>å…³äºè¿™ä¸ªé—®é¢˜çš„è§£ç­”ï¼Œå¼ºçƒˆå»ºè®®é˜…è¯»<a href="https://eklitzke.org/blocking-io-nonblocking-io-and-epoll">è¿™ç¯‡æ–‡ç« </a>ã€‚ä¸‹é¢æ˜¯ä¸€äº›å…³é”®æ‘˜è¦ï¼š</p><ul><li>æ¯æ¬¡é€šè¿‡ <code>read</code> ç³»ç»Ÿè°ƒç”¨è¯»å–æ•°æ®æ—¶ï¼Œæœ€å¤šåªèƒ½è¯»å–ç¼“å†²åŒºå¤§å°çš„å­—èŠ‚æ•°ï¼›å¦‚æœæŸä¸ªæ–‡ä»¶æè¿°ç¬¦ä¸€æ¬¡æ€§æ”¶åˆ°çš„æ•°æ®è¶…è¿‡äº†ç¼“å†²åŒºçš„å¤§å°ï¼Œé‚£ä¹ˆéœ€è¦å¯¹å…¶ <code>read</code> å¤šæ¬¡æ‰èƒ½å…¨éƒ¨è¯»å–å®Œæ¯•</li><li><strong><code>select</code> å¯ä»¥ä½¿ç”¨é˜»å¡ I&#x2F;O</strong>ã€‚é€šè¿‡ <code>select</code> è·å–åˆ°æ‰€æœ‰å¯è¯»çš„æ–‡ä»¶æè¿°ç¬¦åï¼Œéå†æ¯ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œ<code>read</code> <strong>ä¸€æ¬¡</strong>æ•°æ®ï¼ˆè§ä¸Šæ–‡ <a href="https://imageslr.com/2020/02/27/select-poll-epoll.html#selectdemo">select ç¤ºä¾‹</a>ï¼‰<ul><li>è¿™äº›æ–‡ä»¶æè¿°ç¬¦éƒ½æ˜¯å¯è¯»çš„ï¼Œå› æ­¤å³ä½¿ <code>read</code> æ˜¯é˜»å¡ I&#x2F;Oï¼Œä¹Ÿä¸€å®šå¯ä»¥è¯»åˆ°æ•°æ®ï¼Œä¸ä¼šä¸€ç›´é˜»å¡ä¸‹å»</li><li><code>select</code> é‡‡ç”¨æ°´å¹³è§¦å‘æ¨¡å¼ï¼Œå› æ­¤å¦‚æœç¬¬ä¸€æ¬¡ <code>read</code> æ²¡æœ‰è¯»å–å®Œå…¨éƒ¨æ•°æ®ï¼Œé‚£ä¹ˆä¸‹æ¬¡è°ƒç”¨ <code>select</code> æ—¶ä¾ç„¶ä¼šè¿”å›è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå¯ä»¥å†æ¬¡ <code>read</code></li><li><strong><code>select</code> ä¹Ÿå¯ä»¥ä½¿ç”¨éé˜»å¡ I&#x2F;O</strong>ã€‚å½“éå†æŸä¸ªå¯è¯»æ–‡ä»¶æè¿°ç¬¦æ—¶ï¼Œä½¿ç”¨ <code>for</code> å¾ªç¯è°ƒç”¨ <code>read</code> <strong>å¤šæ¬¡</strong>ï¼Œç›´åˆ°è¯»å–å®Œæ‰€æœ‰æ•°æ®ä¸ºæ­¢ï¼ˆè¿”å› <code>EWOULDBLOCK</code>ï¼‰ã€‚è¿™æ ·åšä¼šå¤šä¸€æ¬¡ <code>read</code> è°ƒç”¨ï¼Œä½†å¯ä»¥å‡å°‘è°ƒç”¨ <code>select</code> çš„æ¬¡æ•°</li></ul></li><li>åœ¨ <code>epoll</code> çš„è¾¹ç¼˜è§¦å‘æ¨¡å¼ä¸‹ï¼Œåªä¼šåœ¨æ–‡ä»¶æè¿°ç¬¦çš„å¯è¯»&#x2F;å¯å†™çŠ¶æ€å‘ç”Ÿåˆ‡æ¢æ—¶ï¼Œæ‰ä¼šæ”¶åˆ°æ“ä½œç³»ç»Ÿçš„é€šçŸ¥<ul><li>å› æ­¤ï¼Œå¦‚æœä½¿ç”¨ <code>epoll</code> çš„<strong>è¾¹ç¼˜è§¦å‘æ¨¡å¼</strong>ï¼Œåœ¨æ”¶åˆ°é€šçŸ¥æ—¶ï¼Œ<strong>å¿…é¡»ä½¿ç”¨éé˜»å¡ I&#x2F;Oï¼Œå¹¶ä¸”å¿…é¡»å¾ªç¯è°ƒç”¨ <code>read</code> æˆ– <code>write</code> å¤šæ¬¡ï¼Œç›´åˆ°è¿”å› <code>EWOULDBLOCK</code> ä¸ºæ­¢</strong>ï¼Œç„¶åå†è°ƒç”¨ <code>epoll_wait</code> ç­‰å¾…æ“ä½œç³»ç»Ÿçš„ä¸‹ä¸€æ¬¡é€šçŸ¥</li><li>å¦‚æœæ²¡æœ‰ä¸€æ¬¡æ€§è¯»&#x2F;å†™å®Œæ‰€æœ‰æ•°æ®ï¼Œé‚£ä¹ˆåœ¨æ“ä½œç³»ç»Ÿçœ‹æ¥è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦çš„çŠ¶æ€æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œå°†ä¸ä¼šå†å‘èµ·é€šçŸ¥ï¼Œè°ƒç”¨ <code>epoll_wait</code> ä¼šä½¿å¾—è¯¥æ–‡ä»¶æè¿°ç¬¦ä¸€ç›´ç­‰å¾…ä¸‹å»ï¼ŒæœåŠ¡ç«¯ä¹Ÿä¼šä¸€ç›´ç­‰å¾…å®¢æˆ·ç«¯çš„å“åº”ï¼Œä¸šåŠ¡æµç¨‹æ— æ³•èµ°å®Œ</li><li>è¿™æ ·åšçš„å¥½å¤„æ˜¯æ¯æ¬¡è°ƒç”¨ <code>epoll_wait</code> éƒ½æ˜¯<strong>æœ‰æ•ˆ</strong>çš„â€”â€”ä¿è¯æ•°æ®å…¨éƒ¨è¯»å†™å®Œæ¯•äº†ï¼Œç­‰å¾…ä¸‹æ¬¡é€šçŸ¥ã€‚åœ¨æ°´å¹³è§¦å‘æ¨¡å¼ä¸‹ï¼Œå¦‚æœè°ƒç”¨ <code>epoll_wait</code> æ—¶æ•°æ®æ²¡æœ‰è¯»&#x2F;å†™å®Œæ¯•ï¼Œä¼šç›´æ¥è¿”å›ï¼Œå†æ¬¡é€šçŸ¥ã€‚å› æ­¤è¾¹ç¼˜è§¦å‘èƒ½æ˜¾è‘—å‡å°‘äº‹ä»¶è¢«è§¦å‘çš„æ¬¡æ•°</li><li>ä¸ºä»€ä¹ˆ <code>epoll</code> çš„<strong>è¾¹ç¼˜è§¦å‘æ¨¡å¼ä¸èƒ½ä½¿ç”¨é˜»å¡ I&#x2F;O</strong>ï¼Ÿå¾ˆæ˜¾ç„¶ï¼Œè¾¹ç¼˜è§¦å‘æ¨¡å¼éœ€è¦å¾ªç¯è¯»&#x2F;å†™ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦çš„æ‰€æœ‰æ•°æ®ã€‚å¦‚æœä½¿ç”¨é˜»å¡ I&#x2F;Oï¼Œé‚£ä¹ˆä¸€å®šä¼šåœ¨æœ€åä¸€æ¬¡è°ƒç”¨ï¼ˆæ²¡æœ‰æ•°æ®å¯è¯»&#x2F;å†™ï¼‰æ—¶é˜»å¡ï¼Œå¯¼è‡´æ— æ³•æ­£å¸¸ç»“æŸ</li></ul></li></ul><h3 id="ä¸‰è€…å¯¹æ¯”"><a href="#ä¸‰è€…å¯¹æ¯”" class="headerlink" title="ä¸‰è€…å¯¹æ¯”"></a>ä¸‰è€…å¯¹æ¯”</h3><ul><li><code>select</code>ï¼šè°ƒç”¨å¼€é”€å¤§ï¼ˆéœ€è¦å¤åˆ¶é›†åˆï¼‰ï¼›é›†åˆå¤§å°æœ‰é™åˆ¶ï¼›éœ€è¦éå†æ•´ä¸ªé›†åˆæ‰¾åˆ°å°±ç»ªçš„æè¿°ç¬¦</li><li><code>poll</code>ï¼špoll é‡‡ç”¨é“¾è¡¨çš„æ–¹å¼å­˜å‚¨æ–‡ä»¶æè¿°ç¬¦ï¼Œæ²¡æœ‰æœ€å¤§å­˜å‚¨æ•°é‡çš„é™åˆ¶ï¼Œå…¶ä»–æ–¹é¢å’Œ select æ²¡æœ‰åŒºåˆ«</li><li><code>epoll</code>ï¼šè°ƒç”¨å¼€é”€å°ï¼ˆä¸éœ€è¦å¤åˆ¶ï¼‰ï¼›é›†åˆå¤§å°æ— é™åˆ¶ï¼›é‡‡ç”¨å›è°ƒæœºåˆ¶ï¼Œä¸éœ€è¦éå†æ•´ä¸ªé›†åˆ</li></ul><p><code>select</code>ã€<code>poll</code> éƒ½æ˜¯åœ¨ç”¨æˆ·æ€ç»´æŠ¤æ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œå› æ­¤æ¯æ¬¡éœ€è¦å°†å®Œæ•´é›†åˆä¼ ç»™å†…æ ¸ï¼›<code>epoll</code> ç”±æ“ä½œç³»ç»Ÿåœ¨å†…æ ¸ä¸­ç»´æŠ¤æ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œå› æ­¤åªéœ€è¦åœ¨åˆ›å»ºçš„æ—¶å€™ä¼ å…¥æ–‡ä»¶æè¿°ç¬¦ã€‚</p><p>æ­¤å¤– <code>select</code> åªæ”¯æŒæ°´å¹³è§¦å‘ï¼Œ<code>epoll</code> æ”¯æŒè¾¹ç¼˜è§¦å‘ã€‚</p><h3 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h3><p>å½“è¿æ¥æ•°è¾ƒå¤šå¹¶ä¸”æœ‰å¾ˆå¤šçš„ä¸æ´»è·ƒè¿æ¥æ—¶ï¼Œepoll çš„æ•ˆç‡æ¯”å…¶å®ƒä¸¤è€…é«˜å¾ˆå¤šã€‚å½“è¿æ¥æ•°è¾ƒå°‘å¹¶ä¸”éƒ½ååˆ†æ´»è·ƒçš„æƒ…å†µä¸‹ï¼Œç”±äº epoll éœ€è¦å¾ˆå¤šå›è°ƒï¼Œå› æ­¤æ€§èƒ½å¯èƒ½ä½äºå…¶å®ƒä¸¤è€…ã€‚</p><h3 id="Redis-çš„çº¿ç¨‹æ¨¡å‹"><a href="#Redis-çš„çº¿ç¨‹æ¨¡å‹" class="headerlink" title="Redis çš„çº¿ç¨‹æ¨¡å‹"></a>Redis çš„çº¿ç¨‹æ¨¡å‹</h3><p>Redis æ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„å·¥ä½œæ¨¡å‹ï¼Œä½¿ç”¨ I&#x2F;O å¤šè·¯å¤ç”¨æ¥å¤„ç†å®¢æˆ·ç«¯çš„å¤šä¸ªè¿æ¥ã€‚ä¸ºä»€ä¹ˆ Redis é€‰æ‹©å•çº¿ç¨‹ä¹Ÿèƒ½æ•ˆç‡è¿™ä¹ˆé«˜ï¼Ÿ</p><p>I&#x2F;O è®¾å¤‡ï¼ˆå¦‚ç£ç›˜ã€ç½‘ç»œï¼‰ç­‰é€Ÿåº¦è¿œè¿œæ…¢äº CPUï¼Œå› æ­¤å¼•å…¥äº†å¤šçº¿ç¨‹æŠ€æœ¯ã€‚å½“ä¸€ä¸ªçº¿ç¨‹å‘èµ· I&#x2F;O è¯·æ±‚æ—¶ï¼Œå…ˆå°†å®ƒæŒ‚èµ·ï¼Œåˆ‡æ¢åˆ°åˆ«çš„çº¿ç¨‹ï¼›å½“ I&#x2F;O è®¾å¤‡å°±ç»ªæ—¶ï¼Œå†åˆ‡æ¢å›è¯¥çº¿ç¨‹ã€‚æ€»ä¹‹ï¼Œ<strong>å¤šçº¿ç¨‹æŠ€æœ¯æ˜¯ä¸ºäº†å……åˆ†åˆ©ç”¨ CPU çš„è®¡ç®—èµ„æºï¼Œé€‚ç”¨äºä¸‹å±‚å­˜å‚¨æ…¢é€Ÿçš„åœºæ™¯</strong>ã€‚</p><p>è€Œ redis æ˜¯çº¯å†…å­˜æ“ä½œï¼Œè¯»å†™é€Ÿåº¦éå¸¸å¿«ã€‚æ‰€æœ‰çš„æ“ä½œéƒ½ä¼šåœ¨å†…å­˜ä¸­å®Œæˆï¼Œä¸æ¶‰åŠä»»ä½• I&#x2F;O æ“ä½œï¼Œå› æ­¤<strong>å¤šçº¿ç¨‹é¢‘ç¹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢åè€Œæ˜¯ä¸€ç§è´Ÿä¼˜åŒ–</strong>ã€‚Redis é€‰æ‹©åŸºäºéé˜»å¡ I&#x2F;O çš„ <strong>I&#x2F;O å¤šè·¯å¤ç”¨æœºåˆ¶</strong>ï¼Œåœ¨å•çº¿ç¨‹é‡Œ<strong>å¹¶å‘</strong>å¤„ç†å®¢æˆ·ç«¯çš„å¤šä¸ªè¿æ¥ï¼Œå‡å°‘å¤šçº¿ç¨‹å¸¦æ¥çš„ç³»ç»Ÿå¼€é”€ï¼ŒåŒæ—¶ä¹Ÿæœ‰æ›´å¥½çš„å¯ç»´æŠ¤æ€§ï¼Œæ–¹ä¾¿å¼€å‘å’Œè°ƒè¯•ã€‚</p><p>ä¸è¿‡ redis åœ¨æœ€æ–°çš„å‡ ä¸ªç‰ˆæœ¬ä¸­ä¹Ÿå¼•å…¥äº†å¤šçº¿ç¨‹ï¼Œç›®çš„æ˜¯ï¼š</p><ol><li>å¼‚æ­¥å¤„ç†åˆ é™¤æ“ä½œã€‚å½“åˆ é™¤è¶…å¤§é”®å€¼å¯¹çš„æ—¶å€™ï¼Œå•çº¿ç¨‹å†…åŒæ­¥åœ°åˆ é™¤å¯èƒ½ä¼šé˜»å¡å¾…å¤„ç†çš„ä»»åŠ¡</li><li>åº”å¯¹ç½‘ç»œ I&#x2F;O çš„åœºæ™¯ï¼Œç½‘ç»œ I&#x2F;O æ˜¯æ…¢é€Ÿ I&#x2F;Oã€‚redis6 ååé‡æé«˜äº† 1 å€</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> é¢ç» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rediså¸¸è§é¢è¯•é¢˜</title>
      <link href="/posts/bf7bdd05.html"/>
      <url>/posts/bf7bdd05.html</url>
      
        <content type="html"><![CDATA[<hr><h2 id="Redisçº¿ç¨‹æ¨¡å‹"><a href="#Redisçº¿ç¨‹æ¨¡å‹" class="headerlink" title="Redisçº¿ç¨‹æ¨¡å‹"></a>Redisçº¿ç¨‹æ¨¡å‹</h2><h3 id="Rediså•çº¿ç¨‹çš„ç†è§£ï¼ŒRedis-ä¸ºä»€ä¹ˆæ—©æœŸç‰ˆæœ¬é€‰æ‹©å•çº¿ç¨‹ï¼Ÿ"><a href="#Rediså•çº¿ç¨‹çš„ç†è§£ï¼ŒRedis-ä¸ºä»€ä¹ˆæ—©æœŸç‰ˆæœ¬é€‰æ‹©å•çº¿ç¨‹ï¼Ÿ" class="headerlink" title="Rediså•çº¿ç¨‹çš„ç†è§£ï¼ŒRedis ä¸ºä»€ä¹ˆæ—©æœŸç‰ˆæœ¬é€‰æ‹©å•çº¿ç¨‹ï¼Ÿ"></a>Rediså•çº¿ç¨‹çš„ç†è§£ï¼ŒRedis ä¸ºä»€ä¹ˆæ—©æœŸç‰ˆæœ¬é€‰æ‹©å•çº¿ç¨‹ï¼Ÿ</h3><h4 id="å®˜æ–¹è§£é‡Š"><a href="#å®˜æ–¹è§£é‡Š" class="headerlink" title="å®˜æ–¹è§£é‡Š"></a>å®˜æ–¹è§£é‡Š</h4><p>å› ä¸º Redis æ˜¯åŸºäºå†…å­˜çš„æ“ä½œï¼Œ<strong>CPU ä¸æ˜¯ Redis çš„ç“¶é¢ˆ</strong>ï¼ŒRedis çš„ç“¶é¢ˆæœ€æœ‰å¯èƒ½æ˜¯ <strong>æœºå™¨å†…å­˜çš„å¤§å°</strong> æˆ–è€… <strong>ç½‘ç»œå¸¦å®½</strong>ã€‚æ—¢ç„¶å•çº¿ç¨‹å®¹æ˜“å®ç°ï¼Œè€Œä¸” CPU ä¸ä¼šæˆä¸ºç“¶é¢ˆï¼Œé‚£å°±é¡ºç†æˆç« åœ°é‡‡ç”¨å•çº¿ç¨‹çš„æ–¹æ¡ˆäº†ã€‚</p><blockquote><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ˜ç™½ï¼Œå¤šçº¿ç¨‹è§£å†³çš„é—®é¢˜ã€‚å½“ä¸€ä¸ªçº¿ç¨‹å¤„ç†çš„ä»»åŠ¡æ˜¯I&#x2F;Oå¯†é›†å‹çš„ï¼Œè€ŒI&#x2F;Oä¼ è¾“æ•°æ®å¾ˆæ…¢ï¼Œå› æ­¤çº¿ç¨‹æ€»æ˜¯å¤„äºç­‰å¾…æ•°æ®ä¼ è¾“ï¼Œä»è€Œé€ æˆCPUèµ„æºçš„æµªè´¹ã€‚è¿™æ—¶æˆ‘ä»¬å¯ä»¥å¼€è¾Ÿå¤šä¸ªçº¿ç¨‹ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹åœ¨ç­‰å¾…I&#x2F;Oä¼ è¾“æ—¶ï¼Œè°ƒåº¦å…¶ä»–çº¿ç¨‹è¿›è¡Œä»»åŠ¡å¤„ç†ã€‚<br>ç„¶è€Œï¼Œredisæ‰€æœ‰çš„æ•°æ®éƒ½å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæ­¤æ—¶å¹¶ä¸éœ€è¦I&#x2F;Oæ“ä½œã€‚è€Œå¤šçº¿ç¨‹è°ƒåº¦è¿˜ä¼šé€ æˆé¢å¤–çš„å¼€é”€ä¸”å®ç°å¤æ‚ã€‚<br>æœ€ç»ˆï¼Œé€‰ç”¨å•çº¿ç¨‹å³å¯ã€‚</p></blockquote><p>ä¸€ç§è§£é‡Šï¼š</p><p>å› ä¸ºRedisæ˜¯åŸºäºå†…å­˜çš„æ“ä½œï¼ŒCPUä¸æ˜¯Redisçš„ç“¶é¢ˆï¼ŒRedisçš„ç“¶é¢ˆæœ€æœ‰å¯èƒ½æ˜¯æœºå™¨å†…å­˜çš„å¤§å°æˆ–è€…ç½‘ç»œå¸¦å®½ã€‚æ—¢ç„¶å•çº¿ç¨‹å®¹æ˜“å®ç°ï¼Œè€Œä¸”CPUä¸ä¼šæˆä¸ºç“¶é¢ˆï¼Œé‚£å°±é¡ºç†æˆç« åœ°é‡‡ç”¨å•çº¿ç¨‹çš„æ–¹æ¡ˆäº†ã€‚</p><h4 id="ç®€å•æ€»ç»“ä¸€ä¸‹"><a href="#ç®€å•æ€»ç»“ä¸€ä¸‹" class="headerlink" title="ç®€å•æ€»ç»“ä¸€ä¸‹"></a>ç®€å•æ€»ç»“ä¸€ä¸‹</h4><ol><li>ä½¿ç”¨å•çº¿ç¨‹æ¨¡å‹èƒ½å¸¦æ¥æ›´å¥½çš„ <strong>å¯ç»´æŠ¤æ€§</strong>ï¼Œæ–¹ä¾¿å¼€å‘å’Œè°ƒè¯•ï¼›</li><li>ä½¿ç”¨å•çº¿ç¨‹æ¨¡å‹ä¹Ÿèƒ½ <strong>å¹¶å‘</strong> çš„å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚(I&#x2F;O å¤šè·¯å¤ç”¨æœºåˆ¶epoll)ï¼›</li><li>Redis æœåŠ¡ä¸­è¿è¡Œçš„ç»å¤§å¤šæ•°æ“ä½œçš„ <strong>æ€§èƒ½ç“¶é¢ˆéƒ½ä¸æ˜¯ CPU</strong>ï¼›</li></ol><h3 id="Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ"><a href="#Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ" class="headerlink" title="Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ"></a>Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ</h3><p>ç®€å•æ€»ç»“ï¼š</p><ol><li><strong>çº¯å†…å­˜æ“ä½œ</strong>ï¼šè¯»å–ä¸éœ€è¦è¿›è¡Œç£ç›˜ I&#x2F;Oï¼Œæ‰€ä»¥æ¯”ä¼ ç»Ÿæ•°æ®åº“è¦å¿«ä¸Šä¸å°‘ï¼›*(ä½†ä¸è¦æœ‰è¯¯åŒºè¯´ç£ç›˜å°±ä¸€å®šæ…¢ï¼Œä¾‹å¦‚ Kafka å°±æ˜¯ä½¿ç”¨ç£ç›˜é¡ºåºè¯»å–ä½†ä»ç„¶è¾ƒå¿«)*</li><li><strong>å•çº¿ç¨‹ï¼Œæ— é”ç«äº‰</strong>ï¼šè¿™ä¿è¯äº†æ²¡æœ‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä¸ä¼šå› ä¸ºå¤šçº¿ç¨‹çš„ä¸€äº›æ“ä½œè€Œé™ä½æ€§èƒ½ï¼›</li><li><strong>å¤šè·¯ I&#x2F;O å¤ç”¨æ¨¡å‹ï¼Œéé˜»å¡ I&#x2F;O</strong>ï¼šé‡‡ç”¨å¤šè·¯ I&#x2F;O å¤ç”¨æŠ€æœ¯å¯ä»¥è®©å•ä¸ªçº¿ç¨‹é«˜æ•ˆçš„å¤„ç†å¤šä¸ªç½‘ç»œè¿æ¥è¯·æ±‚ï¼ˆå°½é‡å‡å°‘ç½‘ç»œ IO çš„æ—¶é—´æ¶ˆè€—ï¼‰ï¼›</li><li><strong>é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼ŒåŠ ä¸Šåº•å±‚åšäº†å¤§é‡ä¼˜åŒ–</strong>ï¼šRedis å¯¹äºåº•å±‚çš„æ•°æ®ç»“æ„å’Œå†…å­˜å ç”¨åšäº†å¤§é‡çš„ä¼˜åŒ–ï¼Œä¾‹å¦‚ä¸åŒé•¿åº¦çš„å­—ç¬¦ä¸²ä½¿ç”¨ä¸åŒçš„ç»“æ„ä½“è¡¨ç¤ºï¼ŒHyperLogLog çš„å¯†é›†å‹å­˜å‚¨ç»“æ„ç­‰ç­‰..</li></ol><h2 id="Redisæ•°æ®ç»“æ„"><a href="#Redisæ•°æ®ç»“æ„" class="headerlink" title="Redisæ•°æ®ç»“æ„"></a>Redisæ•°æ®ç»“æ„</h2><h3 id="Redis-çš„-SDS-å’Œ-C-ä¸­å­—ç¬¦ä¸²ç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ"><a href="#Redis-çš„-SDS-å’Œ-C-ä¸­å­—ç¬¦ä¸²ç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ" class="headerlink" title="Redis çš„ SDS å’Œ C ä¸­å­—ç¬¦ä¸²ç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ"></a>Redis çš„ SDS å’Œ C ä¸­å­—ç¬¦ä¸²ç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ</h3><h4 id="å…ˆç®€å•æ€»ç»“ä¸€ä¸‹"><a href="#å…ˆç®€å•æ€»ç»“ä¸€ä¸‹" class="headerlink" title="å…ˆç®€å•æ€»ç»“ä¸€ä¸‹"></a>å…ˆç®€å•æ€»ç»“ä¸€ä¸‹</h4><p>C è¯­è¨€ä½¿ç”¨äº†ä¸€ä¸ªé•¿åº¦ä¸º <code>N+1</code> çš„å­—ç¬¦æ•°ç»„æ¥è¡¨ç¤ºé•¿åº¦ä¸º <code>N</code> çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”å­—ç¬¦æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ æ€»æ˜¯ <code>\0</code>ï¼Œè¿™ç§ç®€å•çš„å­—ç¬¦ä¸²è¡¨ç¤ºæ–¹å¼ <strong>ä¸ç¬¦åˆ Redis å¯¹å­—ç¬¦ä¸²åœ¨å®‰å…¨æ€§ã€æ•ˆç‡ä»¥åŠåŠŸèƒ½æ–¹é¢çš„è¦æ±‚</strong>ã€‚</p><h4 id="å†æ¥è¯´-C-è¯­è¨€å­—ç¬¦ä¸²çš„é—®é¢˜"><a href="#å†æ¥è¯´-C-è¯­è¨€å­—ç¬¦ä¸²çš„é—®é¢˜" class="headerlink" title="å†æ¥è¯´ C è¯­è¨€å­—ç¬¦ä¸²çš„é—®é¢˜"></a>å†æ¥è¯´ C è¯­è¨€å­—ç¬¦ä¸²çš„é—®é¢˜</h4><p>è¿™æ ·ç®€å•çš„æ•°æ®ç»“æ„å¯èƒ½ä¼šé€ æˆä»¥ä¸‹ä¸€äº›é—®é¢˜ï¼š</p><ul><li><strong>è·å–å­—ç¬¦ä¸²é•¿åº¦ä¸º O(N) çº§åˆ«çš„æ“ä½œ</strong> â†’ å› ä¸º C ä¸ä¿å­˜æ•°ç»„çš„é•¿åº¦ï¼Œæ¯æ¬¡éƒ½éœ€è¦éå†ä¸€éæ•´ä¸ªæ•°ç»„ï¼›</li><li>ä¸èƒ½å¾ˆå¥½çš„æœç» <strong>ç¼“å†²åŒºæº¢å‡º&#x2F;å†…å­˜æ³„æ¼</strong> çš„é—®é¢˜ â†’ è·Ÿä¸Šè¿°é—®é¢˜åŸå› ä¸€æ ·ï¼Œå¦‚æœæ‰§è¡Œæ‹¼æ¥ or ç¼©çŸ­å­—ç¬¦ä¸²çš„æ“ä½œï¼Œå¦‚æœæ“ä½œä¸å½“å°±å¾ˆå®¹æ˜“é€ æˆä¸Šè¿°é—®é¢˜ï¼›</li><li>C å­—ç¬¦ä¸² <strong>åªèƒ½ä¿å­˜æ–‡æœ¬æ•°æ®</strong> â†’ å› ä¸º C è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²å¿…é¡»ç¬¦åˆæŸç§ç¼–ç ï¼ˆæ¯”å¦‚ ASCIIï¼‰ï¼Œä¾‹å¦‚ä¸­é—´å‡ºç°çš„ <code>&#39;\0&#39;</code> å¯èƒ½ä¼šè¢«åˆ¤å®šä¸ºæå‰ç»“æŸçš„å­—ç¬¦ä¸²è€Œè¯†åˆ«ä¸äº†ï¼›</li></ul><h4 id="Redis-å¦‚ä½•è§£å†³çš„-SDS-çš„ä¼˜åŠ¿"><a href="#Redis-å¦‚ä½•è§£å†³çš„-SDS-çš„ä¼˜åŠ¿" class="headerlink" title="Redis å¦‚ä½•è§£å†³çš„ | SDS çš„ä¼˜åŠ¿"></a>Redis å¦‚ä½•è§£å†³çš„ | SDS çš„ä¼˜åŠ¿</h4><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210228212624.webp" alt="å›¾ç‰‡"></p><p>å¦‚æœå»çœ‹ Redis çš„æºç  <code>sds.h/sdshdr</code> æ–‡ä»¶ï¼Œä½ ä¼šçœ‹åˆ° SDS å®Œæ•´çš„å®ç°ç»†èŠ‚ï¼Œè¿™é‡Œç®€å•æ¥è¯´ä¸€ä¸‹ Redis å¦‚ä½•è§£å†³çš„ï¼š</p><ol><li><strong>å¤šå¢åŠ  len è¡¨ç¤ºå½“å‰å­—ç¬¦ä¸²çš„é•¿åº¦</strong>ï¼šè¿™æ ·å°±å¯ä»¥ç›´æ¥è·å–é•¿åº¦äº†ï¼Œå¤æ‚åº¦ O(1)ï¼›</li><li><strong>è‡ªåŠ¨æ‰©å±•ç©ºé—´</strong>ï¼šå½“ SDS éœ€è¦å¯¹å­—ç¬¦ä¸²è¿›è¡Œä¿®æ”¹æ—¶ï¼Œé¦–å…ˆå€ŸåŠ©äº <code>len</code> å’Œ <code>alloc</code> æ£€æŸ¥ç©ºé—´æ˜¯å¦æ»¡è¶³ä¿®æ”¹æ‰€éœ€çš„è¦æ±‚ï¼Œå¦‚æœç©ºé—´ä¸å¤Ÿçš„è¯ï¼ŒSDS ä¼šè‡ªåŠ¨æ‰©å±•ç©ºé—´ï¼Œé¿å…äº†åƒ C å­—ç¬¦ä¸²æ“ä½œä¸­çš„è¦†ç›–æƒ…å†µï¼›</li><li><strong>æœ‰æ•ˆé™ä½å†…å­˜åˆ†é…æ¬¡æ•°</strong>ï¼šC å­—ç¬¦ä¸²åœ¨æ¶‰åŠå¢åŠ æˆ–è€…æ¸…é™¤æ“ä½œæ—¶ä¼šæ”¹å˜åº•å±‚æ•°ç»„çš„å¤§å°é€ æˆé‡æ–°åˆ†é…ï¼ŒSDS ä½¿ç”¨äº† <strong>ç©ºé—´é¢„åˆ†é…</strong> å’Œ <strong>æƒ°æ€§ç©ºé—´é‡Šæ”¾</strong> æœºåˆ¶ï¼Œç®€å•ç†è§£å°±æ˜¯æ¯æ¬¡åœ¨æ‰©å±•æ—¶æ˜¯æˆå€çš„å¤šåˆ†é…çš„ï¼Œåœ¨ç¼©å®¹æ˜¯ä¹Ÿæ˜¯å…ˆç•™ç€å¹¶ä¸æ­£å¼å½’è¿˜ç»™ OSï¼›</li><li><strong>äºŒè¿›åˆ¶å®‰å…¨</strong>ï¼šC è¯­è¨€å­—ç¬¦ä¸²åªèƒ½ä¿å­˜ <code>ascii</code> ç ï¼Œå¯¹äºå›¾ç‰‡ã€éŸ³é¢‘ç­‰ä¿¡æ¯æ— æ³•ä¿å­˜ï¼ŒSDS æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ï¼Œå†™å…¥ä»€ä¹ˆè¯»å–å°±æ˜¯ä»€ä¹ˆï¼Œä¸åšä»»ä½•è¿‡æ»¤å’Œé™åˆ¶ï¼›</li></ol><h3 id="å­—å…¸æ˜¯å¦‚ä½•å®ç°çš„ï¼ŸRehash-äº†è§£å—ï¼Ÿ"><a href="#å­—å…¸æ˜¯å¦‚ä½•å®ç°çš„ï¼ŸRehash-äº†è§£å—ï¼Ÿ" class="headerlink" title="å­—å…¸æ˜¯å¦‚ä½•å®ç°çš„ï¼ŸRehash äº†è§£å—ï¼Ÿ"></a>å­—å…¸æ˜¯å¦‚ä½•å®ç°çš„ï¼ŸRehash äº†è§£å—ï¼Ÿ</h3><h4 id="å…ˆæ€»ä½“èŠä¸€ä¸‹-Redis-ä¸­çš„å­—å…¸"><a href="#å…ˆæ€»ä½“èŠä¸€ä¸‹-Redis-ä¸­çš„å­—å…¸" class="headerlink" title="å…ˆæ€»ä½“èŠä¸€ä¸‹ Redis ä¸­çš„å­—å…¸"></a>å…ˆæ€»ä½“èŠä¸€ä¸‹ Redis ä¸­çš„å­—å…¸</h4><p>å­—å…¸æ˜¯ Redis æœåŠ¡å™¨ä¸­å‡ºç°æœ€ä¸ºé¢‘ç¹çš„å¤åˆå‹æ•°æ®ç»“æ„ã€‚é™¤äº† <strong>hash</strong> ç»“æ„çš„æ•°æ®ä¼šç”¨åˆ°å­—å…¸å¤–ï¼Œæ•´ä¸ª Redis æ•°æ®åº“çš„æ‰€æœ‰ <code>key</code> å’Œ <code>value</code> ä¹Ÿç»„æˆäº†ä¸€ä¸ª <strong>å…¨å±€å­—å…¸</strong>ï¼Œè¿˜æœ‰å¸¦è¿‡æœŸæ—¶é—´çš„ <code>key</code> ä¹Ÿæ˜¯ä¸€ä¸ªå­—å…¸ã€‚*(å­˜å‚¨åœ¨ RedisDb æ•°æ®ç»“æ„ä¸­)*</p><h4 id="è¯´æ˜å­—å…¸å†…éƒ¨ç»“æ„å’Œ-rehash"><a href="#è¯´æ˜å­—å…¸å†…éƒ¨ç»“æ„å’Œ-rehash" class="headerlink" title="è¯´æ˜å­—å…¸å†…éƒ¨ç»“æ„å’Œ rehash"></a>è¯´æ˜å­—å…¸å†…éƒ¨ç»“æ„å’Œ rehash</h4><p><strong>Redis</strong> ä¸­çš„å­—å…¸ç›¸å½“äº Java ä¸­çš„ <strong>HashMap</strong>ï¼Œå†…éƒ¨å®ç°ä¹Ÿå·®ä¸å¤šç±»ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡ <strong>â€œæ•°ç»„ + é“¾è¡¨â€</strong> çš„ <strong>é“¾åœ°å€æ³•</strong> æ¥è§£å†³éƒ¨åˆ† å“ˆå¸Œå†²çªï¼ŒåŒæ—¶è¿™æ ·çš„ç»“æ„ä¹Ÿå¸æ”¶äº†ä¸¤ç§ä¸åŒæ•°æ®ç»“æ„çš„ä¼˜ç‚¹ã€‚</p><p>å­—å…¸ç»“æ„å†…éƒ¨åŒ…å« <strong>ä¸¤ä¸ª hashtable</strong>ï¼Œé€šå¸¸æƒ…å†µä¸‹åªæœ‰ä¸€ä¸ª <code>hashtable</code> æœ‰å€¼ï¼Œä½†æ˜¯åœ¨å­—å…¸æ‰©å®¹ç¼©å®¹æ—¶ï¼Œéœ€è¦åˆ†é…æ–°çš„ <code>hashtable</code>ï¼Œç„¶åè¿›è¡Œ <strong>æ¸è¿›å¼æ¬è¿</strong> *(rehash)*ï¼Œè¿™æ—¶å€™ä¸¤ä¸ª <code>hashtable</code> åˆ†åˆ«å­˜å‚¨æ—§çš„å’Œæ–°çš„ <code>hashtable</code>ï¼Œå¾…æ¬è¿ç»“æŸåï¼Œæ—§çš„å°†è¢«åˆ é™¤ï¼Œæ–°çš„ <code>hashtable</code> å–è€Œä»£ä¹‹ã€‚</p><h4 id="æ‰©ç¼©å®¹çš„æ¡ä»¶"><a href="#æ‰©ç¼©å®¹çš„æ¡ä»¶" class="headerlink" title="æ‰©ç¼©å®¹çš„æ¡ä»¶"></a>æ‰©ç¼©å®¹çš„æ¡ä»¶</h4><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œå½“ hash è¡¨ä¸­ <strong>å…ƒç´ çš„ä¸ªæ•°ç­‰äºç¬¬ä¸€ç»´æ•°ç»„çš„é•¿åº¦æ—¶</strong>ï¼Œå°±ä¼šå¼€å§‹æ‰©å®¹ï¼Œæ‰©å®¹çš„æ–°æ•°ç»„æ˜¯ <strong>åŸæ•°ç»„å¤§å°çš„ 2 å€</strong>ã€‚ä¸è¿‡å¦‚æœ Redis æ­£åœ¨åš <code>bgsave(æŒä¹…åŒ–å‘½ä»¤)</code>ï¼Œä¸ºäº†å‡å°‘å†…å­˜ä¹Ÿå¾—è¿‡å¤šåˆ†ç¦»ï¼ŒRedis å°½é‡ä¸å»æ‰©å®¹ï¼Œä½†æ˜¯å¦‚æœ hash è¡¨éå¸¸æ»¡äº†ï¼Œ<strong>è¾¾åˆ°äº†ç¬¬ä¸€ç»´æ•°ç»„é•¿åº¦çš„ 5 å€äº†</strong>ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼š <strong>å¼ºåˆ¶æ‰©å®¹</strong>ã€‚</p><p>å½“ hash è¡¨å› ä¸ºå…ƒç´ é€æ¸è¢«åˆ é™¤å˜å¾—è¶Šæ¥è¶Šç¨€ç–æ—¶ï¼ŒRedis ä¼šå¯¹ hash è¡¨è¿›è¡Œç¼©å®¹æ¥å‡å°‘ hash è¡¨çš„ç¬¬ä¸€ç»´æ•°ç»„ç©ºé—´å ç”¨ã€‚æ‰€ç”¨çš„æ¡ä»¶æ˜¯ **å…ƒç´ ä¸ªæ•°ä½äºæ•°ç»„é•¿åº¦çš„ 10%**ï¼Œç¼©å®¹ä¸ä¼šè€ƒè™‘ Redis æ˜¯å¦åœ¨åš <code>bgsave</code>ã€‚</p><h4 id="æ¸è¿›å¼rehash"><a href="#æ¸è¿›å¼rehash" class="headerlink" title="æ¸è¿›å¼rehash"></a>æ¸è¿›å¼rehash</h4><h6 id="ä¸ºä»€ä¹ˆéœ€è¦æ¸è¿›å¼rehashå‘¢ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦æ¸è¿›å¼rehashå‘¢ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦æ¸è¿›å¼rehashå‘¢ï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦æ¸è¿›å¼rehashå‘¢ï¼Ÿ</h6><p>åœ¨å…ƒç´ æ•°é‡è¾ƒå°‘æ—¶ï¼Œrehashä¼šéå¸¸å¿«çš„è¿›è¡Œï¼Œä½†æ˜¯å½“å…ƒç´ æ•°é‡è¾¾åˆ°å‡ ç™¾ã€ç”šè‡³å‡ ä¸ªäº¿æ—¶è¿›è¡Œrehashå°†ä¼šæ˜¯ä¸€ä¸ªéå¸¸è€—æ—¶çš„æ“ä½œã€‚å¦‚æœä¸€æ¬¡æ€§å°†æˆä¸‡ä¸Šäº¿çš„å…ƒç´ çš„é”®å€¼å¯¹rehashåˆ°ht[1]ï¼Œåºå¤§çš„è®¡ç®—é‡å¯èƒ½ä¼šå¯¼è‡´æœåŠ¡å™¨åœ¨ä¸€æ®µæ—¶é—´å†…åœæ­¢æœåŠ¡ï¼Œè¿™æ˜¯éå¸¸å±é™©çš„ï¼æ‰€ä»¥ï¼Œrehashè¿™ä¸ªåŠ¨ä½œä¸èƒ½ä¸€æ¬¡æ€§ã€é›†ä¸­å¼çš„å®Œæˆï¼Œè€Œæ˜¯åˆ†å¤šæ¬¡ã€æ¸è¿›å¼åœ°å®Œæˆã€‚</p><h6 id="æ¸è¿›å¼rehashæ­¥éª¤ï¼š"><a href="#æ¸è¿›å¼rehashæ­¥éª¤ï¼š" class="headerlink" title="æ¸è¿›å¼rehashæ­¥éª¤ï¼š"></a><strong>æ¸è¿›å¼rehashæ­¥éª¤ï¼š</strong></h6><ol><li>ä¸º<code>ht[1]</code>åˆ†é…ç©ºé—´ï¼Œè®©å­—å…¸åŒæ—¶æŒæœ‰<code>ht[0]</code>å’Œ<code>ht[1]</code>ä¸¤ä¸ªå“ˆå¸Œè¡¨ã€‚</li><li>åœ¨å­—å…¸ä¸­ç»´æŒä¸€ä¸ªç´¢å¼•è®¡æ•°å™¨å˜é‡rehashidxï¼Œå¹¶å°†å®ƒçš„å€¼è®¾ç½®ä¸º0ï¼Œè¡¨ç¤ºrehashå·¥ä½œæ­£å¼å¼€å§‹ã€‚</li><li>åœ¨rehashè¿›è¡ŒæœŸé—´ï¼Œæ¯æ¬¡å¯¹å­—å…¸æ‰§è¡ŒCRUDï¼šæ·»åŠ ã€åˆ é™¤ã€æŸ¥æ‰¾æˆ–è€…æ›´æ–°æ“ä½œæ—¶ï¼Œç¨‹åºé™¤äº†æ‰§è¡ŒæŒ‡å®šçš„æ“ä½œä»¥å¤–ï¼Œè¿˜ä¼šé¡ºå¸¦å°†<code>ht[0]</code>å“ˆå¸Œè¡¨åœ¨rehashidxç´¢å¼•ä¸Šçš„æ‰€æœ‰é”®å€¼å¯¹rehashåˆ°<code>ht[1]</code>ï¼Œå½“rehashå·¥ä½œå®Œæˆä¹‹åï¼Œç¨‹åºå°†rehashidx+1(è¡¨ç¤ºä¸‹æ¬¡å°†rehashä¸‹ä¸€ä¸ªæ¡¶)ã€‚</li><li>éšç€å­—å…¸æ“ä½œçš„ä¸æ–­æ‰§è¡Œï¼Œæœ€ç»ˆåœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šï¼Œ<code>ht[0]</code>çš„æ‰€æœ‰é”®å€¼å¯¹éƒ½ä¼šè¢«rehashè‡³<code>ht[1]</code>ï¼Œè¿™æ—¶ç¨‹åºå°†rehashidxå±æ€§çš„å€¼è®¾ä¸º-1ï¼Œè¡¨ç¤ºrehashå®Œæˆã€‚</li></ol><p><strong>æ¸è¿›å¼rehashçš„å¥½å¤„åœ¨äºå®ƒé‡‡å–åˆ†è€Œæ²»ä¹‹çš„æ–¹å¼ï¼Œå°†rehashé”®å€¼å¯¹æ‰€éœ€çš„è®¡ç®—å·¥ä½œå‡æ‘Šåˆ°å¯¹å­—å…¸çš„æ¯ä¸ªæ·»åŠ ã€åˆ é™¤ã€æŸ¥æ‰¾å’Œæ›´æ–°æ“ä½œä¸Šï¼Œä»è€Œé¿å…äº†é›†ä¸­å¼rehash è€Œå¸¦æ¥çš„åºå¤§è®¡ç®—é‡ã€‚</strong></p><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯åœ¨æ¸è¿›å¼rehashçš„è¿‡ç¨‹ï¼Œå¦‚æœæœ‰å¢åˆ æ”¹æŸ¥æ“ä½œæ—¶ï¼Œå¦‚æœ<code>index</code>å¤§äº<code>rehashindex</code>ï¼Œè®¿é—®<code>ht[0]</code>ï¼Œå¦åˆ™è®¿é—®<code>ht[1]ã€‚</code></strong></p><h6 id="æ¬è¿æ˜¯åŸ‹ä¼åœ¨å®¢æˆ·ç«¯è¯·æ±‚æŒ‡ä»¤å½“ä¸­ï¼Œå¦‚æœå®¢æˆ·ç«¯é—²ç½®ä¸‹æ¥ï¼Œæ²¡æœ‰åç»­æŒ‡ä»¤è§¦å‘è¿™ä¸ªæ¬è¿ï¼Œæœªæ¬è¿å®Œçš„çš„æ•°æ®æ€ä¹ˆåŠï¼Ÿ"><a href="#æ¬è¿æ˜¯åŸ‹ä¼åœ¨å®¢æˆ·ç«¯è¯·æ±‚æŒ‡ä»¤å½“ä¸­ï¼Œå¦‚æœå®¢æˆ·ç«¯é—²ç½®ä¸‹æ¥ï¼Œæ²¡æœ‰åç»­æŒ‡ä»¤è§¦å‘è¿™ä¸ªæ¬è¿ï¼Œæœªæ¬è¿å®Œçš„çš„æ•°æ®æ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="æ¬è¿æ˜¯åŸ‹ä¼åœ¨å®¢æˆ·ç«¯è¯·æ±‚æŒ‡ä»¤å½“ä¸­ï¼Œå¦‚æœå®¢æˆ·ç«¯é—²ç½®ä¸‹æ¥ï¼Œæ²¡æœ‰åç»­æŒ‡ä»¤è§¦å‘è¿™ä¸ªæ¬è¿ï¼Œæœªæ¬è¿å®Œçš„çš„æ•°æ®æ€ä¹ˆåŠï¼Ÿ"></a><strong>æ¬è¿æ˜¯åŸ‹ä¼åœ¨å®¢æˆ·ç«¯è¯·æ±‚æŒ‡ä»¤å½“ä¸­ï¼Œå¦‚æœå®¢æˆ·ç«¯é—²ç½®ä¸‹æ¥ï¼Œæ²¡æœ‰åç»­æŒ‡ä»¤è§¦å‘è¿™ä¸ªæ¬è¿ï¼Œæœªæ¬è¿å®Œçš„çš„æ•°æ®æ€ä¹ˆåŠï¼Ÿ</strong></h6><p>Redis è¿˜ä¼šåœ¨å®šæ—¶ä»»åŠ¡ä¸­å¯¹å­—å…¸è¿›è¡Œä¸»åŠ¨æ¬è¿ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœåŠ¡å™¨å®šæ—¶ä»»åŠ¡</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">databaseCron</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> ...</span><br><span class="line"> <span class="keyword">if</span> (server.activerehashing) &#123;</span><br><span class="line"> <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; dbs_per_call; j++) &#123;</span><br><span class="line"> <span class="type">int</span> work_done = <span class="built_in">incrementallyRehash</span>(rehash_db);</span><br><span class="line"> <span class="keyword">if</span> (work_done) &#123;</span><br><span class="line"> <span class="comment">/* If the function did some work, stop here, we&#x27;ll do</span></span><br><span class="line"><span class="comment"> * more at the next cron loop. */</span></span><br><span class="line"> <span class="keyword">break</span>;</span><br><span class="line"> &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"> <span class="comment">/* If this db didn&#x27;t need rehash, we&#x27;ll try the next one. */</span></span><br><span class="line"> rehash_db++;</span><br><span class="line"> rehash_db %= server.dbnum;</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="æ¸è¿›å¼rehashçš„ç–‘é—®"><a href="#æ¸è¿›å¼rehashçš„ç–‘é—®" class="headerlink" title="æ¸è¿›å¼rehashçš„ç–‘é—®"></a><strong>æ¸è¿›å¼rehashçš„ç–‘é—®</strong></h6><ol><li><p>åœ¨è¿ç§»çš„è¿‡ç¨‹ä¸­ï¼Œä¼šä¸ä¼šé€ æˆè¯»å°‘æ•°æ®?</p><blockquote><p>ä¸ä¼šï¼Œå› ä¸ºåœ¨è¿ç§»æ—¶ï¼Œé¦–å…ˆä¼šä»ht[0]è¯»å–æ•°æ®ï¼Œå¦‚æœht[0]è¯»ä¸åˆ°ï¼Œåˆ™ä¼šå»ht[1]è¯»ã€‚</p></blockquote></li><li><p>åœ¨è¿ç§»è¿‡ç¨‹ä¸­ï¼Œæ–°å¢åŠ çš„æ•°æ®ä¼šå­˜æ”¾åœ¨å“ªä¸ªht?</p><blockquote><p>è¿ç§»è¿‡ç¨‹ä¸­ï¼Œæ–°å¢çš„æ•°æ®åªä¼šå­˜åœ¨ht[1]ä¸­ï¼Œè€Œä¸ä¼šå­˜æ”¾åˆ°ht[0]ï¼Œht[0]åªä¼šå‡å°‘ä¸ä¼šæ–°å¢ã€‚</p></blockquote></li></ol><h3 id="è·³è·ƒè¡¨"><a href="#è·³è·ƒè¡¨" class="headerlink" title="è·³è·ƒè¡¨"></a>è·³è·ƒè¡¨</h3><ul><li><a href="http://mp.weixin.qq.com/s?__biz=MzUyMTg0NDA2Ng==&mid=2247484000&idx=1&sn=a7e02adebea31535c3870cc514719493&chksm=f9d5a66dcea22f7b7cdf210993cbe6c057c0456967ac106d76c89fdd76ed5cb271c879a83f3e&scene=21#wechat_redirect">Redis(2)â€”â€”è·³è·ƒè¡¨</a></li></ul><h2 id="Redisé«˜å¯ç”¨"><a href="#Redisé«˜å¯ç”¨" class="headerlink" title="Redisé«˜å¯ç”¨"></a>Redisé«˜å¯ç”¨</h2><h3 id="æŒä¹…åŒ–"><a href="#æŒä¹…åŒ–" class="headerlink" title="æŒä¹…åŒ–"></a>æŒä¹…åŒ–</h3><h4 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h4><p><strong>Redis å¿«ç…§</strong> æ˜¯æœ€ç®€å•çš„ Redis æŒä¹…æ€§æ¨¡å¼ã€‚å½“æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶ï¼Œå®ƒå°†ç”Ÿæˆæ•°æ®é›†çš„æ—¶é—´ç‚¹å¿«ç…§ï¼Œä¾‹å¦‚ï¼Œå¦‚æœå…ˆå‰çš„å¿«ç…§æ˜¯åœ¨ 2 åˆ†é’Ÿå‰åˆ›å»ºçš„ï¼Œå¹¶ä¸”ç°åœ¨å·²ç»è‡³å°‘æœ‰ <code>100</code> æ¬¡æ–°å†™å…¥ï¼Œåˆ™å°†åˆ›å»ºä¸€ä¸ªæ–°çš„å¿«ç…§ã€‚æ­¤æ¡ä»¶å¯ä»¥ç”±ç”¨æˆ·é…ç½® Redis å®ä¾‹æ¥æ§åˆ¶ï¼Œä¹Ÿå¯ä»¥åœ¨è¿è¡Œæ—¶ä¿®æ”¹è€Œæ— éœ€é‡æ–°å¯åŠ¨æœåŠ¡å™¨ã€‚å¿«ç…§ä½œä¸ºåŒ…å«æ•´ä¸ªæ•°æ®é›†çš„å•ä¸ª <code>.rdb</code> æ–‡ä»¶ç”Ÿæˆã€‚</p><h4 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h4><p><strong>å¿«ç…§ä¸æ˜¯å¾ˆæŒä¹…</strong>ã€‚å¦‚æœè¿è¡Œ Redis çš„è®¡ç®—æœºåœæ­¢è¿è¡Œï¼Œç”µæºçº¿å‡ºç°æ•…éšœæˆ–è€…æ‚¨ <code>kill -9</code> çš„å®ä¾‹æ„å¤–å‘ç”Ÿï¼Œåˆ™å†™å…¥ Redis çš„æœ€æ–°æ•°æ®å°†ä¸¢å¤±ã€‚å°½ç®¡è¿™å¯¹äºæŸäº›åº”ç”¨ç¨‹åºå¯èƒ½ä¸æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ï¼Œä½†æœ‰äº›ä½¿ç”¨æ¡ˆä¾‹å…·æœ‰å……åˆ†çš„è€ç”¨æ€§ï¼Œåœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå¿«ç…§å¹¶ä¸æ˜¯å¯è¡Œçš„é€‰æ‹©ã€‚</p><p><strong>AOF(Append Only File - ä»…è¿½åŠ æ–‡ä»¶)</strong> å®ƒçš„å·¥ä½œæ–¹å¼éå¸¸ç®€å•ï¼šæ¯æ¬¡æ‰§è¡Œ <strong>ä¿®æ”¹å†…å­˜</strong> ä¸­æ•°æ®é›†çš„å†™æ“ä½œæ—¶ï¼Œéƒ½ä¼š <strong>è®°å½•</strong> è¯¥æ“ä½œã€‚å‡è®¾ AOF æ—¥å¿—è®°å½•äº†è‡ª Redis å®ä¾‹åˆ›å»ºä»¥æ¥ <strong>æ‰€æœ‰çš„ä¿®æ”¹æ€§æŒ‡ä»¤åºåˆ—</strong>ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡å¯¹ä¸€ä¸ªç©ºçš„ Redis å®ä¾‹ <strong>é¡ºåºæ‰§è¡Œæ‰€æœ‰çš„æŒ‡ä»¤</strong>ï¼Œä¹Ÿå°±æ˜¯ <strong>ã€Œé‡æ”¾ã€</strong>ï¼Œæ¥æ¢å¤ Redis å½“å‰å®ä¾‹çš„å†…å­˜æ•°æ®ç»“æ„çš„çŠ¶æ€ã€‚</p><h4 id="Redis-4-0-çš„æ··åˆæŒä¹…åŒ–"><a href="#Redis-4-0-çš„æ··åˆæŒä¹…åŒ–" class="headerlink" title="Redis 4.0 çš„æ··åˆæŒä¹…åŒ–"></a>Redis 4.0 çš„æ··åˆæŒä¹…åŒ–</h4><p>é‡å¯ Redis æ—¶ï¼Œæˆ‘ä»¬å¾ˆå°‘ä½¿ç”¨ <code>rdb</code> æ¥æ¢å¤å†…å­˜çŠ¶æ€ï¼Œå› ä¸ºä¼šä¸¢å¤±å¤§é‡æ•°æ®ã€‚æˆ‘ä»¬é€šå¸¸ä½¿ç”¨ AOF æ—¥å¿—é‡æ”¾ï¼Œä½†æ˜¯é‡æ”¾ AOF æ—¥å¿—æ€§èƒ½ç›¸å¯¹ <code>rdb</code> æ¥è¯´è¦æ…¢å¾ˆå¤šï¼Œè¿™æ ·åœ¨ Redis å®ä¾‹å¾ˆå¤§çš„æƒ…å†µä¸‹ï¼Œå¯åŠ¨éœ€è¦èŠ±è´¹å¾ˆé•¿çš„æ—¶é—´ã€‚</p><p><strong>Redis 4.0</strong> ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¸¦æ¥äº†ä¸€ä¸ªæ–°çš„æŒä¹…åŒ–é€‰é¡¹â€”â€”<strong>æ··åˆæŒä¹…åŒ–</strong>ã€‚å°† <code>rdb</code> æ–‡ä»¶çš„å†…å®¹å’Œå¢é‡çš„ AOF æ—¥å¿—æ–‡ä»¶å­˜åœ¨ä¸€èµ·ã€‚è¿™é‡Œçš„ AOF æ—¥å¿—ä¸å†æ˜¯å…¨é‡çš„æ—¥å¿—ï¼Œè€Œæ˜¯ <strong>è‡ªæŒä¹…åŒ–å¼€å§‹åˆ°æŒä¹…åŒ–ç»“æŸ</strong> çš„è¿™æ®µæ—¶é—´å‘ç”Ÿçš„å¢é‡ AOF æ—¥å¿—ï¼Œé€šå¸¸è¿™éƒ¨åˆ† AOF æ—¥å¿—å¾ˆå°ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210509211524.webp" alt="å›¾ç‰‡"></p><p>äºæ˜¯åœ¨ Redis é‡å¯çš„æ—¶å€™ï¼Œå¯ä»¥å…ˆåŠ è½½ <code>rdb</code> çš„å†…å®¹ï¼Œç„¶åå†é‡æ”¾å¢é‡ AOF æ—¥å¿—å°±å¯ä»¥å®Œå…¨æ›¿ä»£ä¹‹å‰çš„ AOF å…¨é‡æ–‡ä»¶é‡æ”¾ï¼Œé‡å¯æ•ˆç‡å› æ­¤å¤§å¹…å¾—åˆ°æå‡ã€‚</p><h4 id="RDB-å’Œ-AOF-å„è‡ªæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ"><a href="#RDB-å’Œ-AOF-å„è‡ªæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ" class="headerlink" title="RDB å’Œ AOF å„è‡ªæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ"></a>RDB å’Œ AOF å„è‡ªæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ</h4><h5 id="RDB-ä¼˜ç‚¹"><a href="#RDB-ä¼˜ç‚¹" class="headerlink" title="RDB | ä¼˜ç‚¹"></a>RDB | ä¼˜ç‚¹</h5><ol><li>åªæœ‰ä¸€ä¸ªæ–‡ä»¶ <code>dump.rdb</code>ï¼Œ<strong>æ–¹ä¾¿æŒä¹…åŒ–</strong>ã€‚</li><li><strong>å®¹ç¾æ€§å¥½</strong>ï¼Œä¸€ä¸ªæ–‡ä»¶å¯ä»¥ä¿å­˜åˆ°å®‰å…¨çš„ç£ç›˜ã€‚</li><li><strong>æ€§èƒ½æœ€å¤§åŒ–</strong>ï¼Œ<code>fork</code> å­è¿›ç¨‹æ¥å®Œæˆå†™æ“ä½œï¼Œè®©ä¸»è¿›ç¨‹ç»§ç»­å¤„ç†å‘½ä»¤ï¼Œæ‰€ä»¥ä½¿ IO æœ€å¤§åŒ–ã€‚ä½¿ç”¨å•ç‹¬å­è¿›ç¨‹æ¥è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¸»è¿›ç¨‹ä¸ä¼šè¿›è¡Œä»»ä½• IO æ“ä½œï¼Œä¿è¯äº† Redis çš„é«˜æ€§èƒ½</li><li>ç›¸å¯¹äºæ•°æ®é›†å¤§æ—¶ï¼Œæ¯” AOF çš„ <strong>å¯åŠ¨æ•ˆç‡</strong> æ›´é«˜ã€‚</li></ol><h5 id="RDB-ç¼ºç‚¹"><a href="#RDB-ç¼ºç‚¹" class="headerlink" title="RDB | ç¼ºç‚¹"></a>RDB | ç¼ºç‚¹</h5><ol><li><strong>æ•°æ®å®‰å…¨æ€§ä½</strong>ã€‚RDB æ˜¯é—´éš”ä¸€æ®µæ—¶é—´è¿›è¡ŒæŒä¹…åŒ–ï¼Œå¦‚æœæŒä¹…åŒ–ä¹‹é—´ Redis å‘ç”Ÿæ•…éšœï¼Œä¼šå‘ç”Ÿæ•°æ®ä¸¢å¤±ã€‚æ‰€ä»¥è¿™ç§æ–¹å¼æ›´é€‚åˆæ•°æ®è¦æ±‚ä¸ä¸¥è°¨çš„æ—¶å€™ï¼›</li></ol><h5 id="AOF-ä¼˜ç‚¹"><a href="#AOF-ä¼˜ç‚¹" class="headerlink" title="AOF | ä¼˜ç‚¹"></a>AOF | ä¼˜ç‚¹</h5><ol><li><strong>æ•°æ®å®‰å…¨</strong>ï¼Œaof æŒä¹…åŒ–å¯ä»¥é…ç½® <code>appendfsync</code> å±æ€§ï¼Œæœ‰ <code>always</code>ï¼Œæ¯è¿›è¡Œä¸€æ¬¡å‘½ä»¤æ“ä½œå°±è®°å½•åˆ° aof æ–‡ä»¶ä¸­ä¸€æ¬¡ã€‚</li><li>é€šè¿‡ append æ¨¡å¼å†™æ–‡ä»¶ï¼Œå³ä½¿ä¸­é€”æœåŠ¡å™¨å®•æœºï¼Œå¯ä»¥é€šè¿‡ redis-check-aof å·¥å…·è§£å†³æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚</li><li>AOF æœºåˆ¶çš„ rewrite æ¨¡å¼ã€‚AOF æ–‡ä»¶æ²¡è¢« rewrite ä¹‹å‰ï¼ˆæ–‡ä»¶è¿‡å¤§æ—¶ä¼šå¯¹å‘½ä»¤ è¿›è¡Œåˆå¹¶é‡å†™ï¼‰ï¼Œå¯ä»¥åˆ é™¤å…¶ä¸­çš„æŸäº›å‘½ä»¤ï¼ˆæ¯”å¦‚è¯¯æ“ä½œçš„ flushallï¼‰</li></ol><h5 id="AOF-ç¼ºç‚¹"><a href="#AOF-ç¼ºç‚¹" class="headerlink" title="AOF | ç¼ºç‚¹"></a>AOF | ç¼ºç‚¹</h5><ol><li>AOF æ–‡ä»¶æ¯” RDB <strong>æ–‡ä»¶å¤§</strong>ï¼Œä¸” <strong>æ¢å¤é€Ÿåº¦æ…¢</strong>ã€‚</li><li><strong>æ•°æ®é›†å¤§</strong> çš„æ—¶å€™ï¼Œæ¯” rdb <strong>å¯åŠ¨æ•ˆç‡ä½</strong>ã€‚</li></ol><h4 id="ä¸¤ç§æ–¹å¼å¦‚ä½•é€‰æ‹©ï¼Ÿ"><a href="#ä¸¤ç§æ–¹å¼å¦‚ä½•é€‰æ‹©ï¼Ÿ" class="headerlink" title="ä¸¤ç§æ–¹å¼å¦‚ä½•é€‰æ‹©ï¼Ÿ"></a>ä¸¤ç§æ–¹å¼å¦‚ä½•é€‰æ‹©ï¼Ÿ</h4><ul><li>ä¸€èˆ¬æ¥è¯´ï¼Œ å¦‚æœæƒ³è¾¾åˆ°è¶³ä»¥åª²ç¾ PostgreSQL çš„ <strong>æ•°æ®å®‰å…¨æ€§</strong>ï¼Œä½ åº”è¯¥ <strong>åŒæ—¶ä½¿ç”¨ä¸¤ç§æŒä¹…åŒ–åŠŸèƒ½</strong>ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“ Redis é‡å¯çš„æ—¶å€™ä¼šä¼˜å…ˆè½½å…¥ AOF æ–‡ä»¶æ¥æ¢å¤åŸå§‹çš„æ•°æ®ï¼Œå› ä¸ºåœ¨é€šå¸¸æƒ…å†µä¸‹ AOF æ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦æ¯” RDB æ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦å®Œæ•´ã€‚</li><li>å¦‚æœä½ éå¸¸å…³å¿ƒä½ çš„æ•°æ®ï¼Œ ä½†ä»ç„¶ <strong>å¯ä»¥æ‰¿å—æ•°åˆ†é’Ÿä»¥å†…çš„æ•°æ®ä¸¢å¤±</strong>ï¼Œé‚£ä¹ˆä½ å¯ä»¥ <strong>åªä½¿ç”¨ RDB æŒä¹…åŒ–</strong>ã€‚</li><li>æœ‰å¾ˆå¤šç”¨æˆ·éƒ½åªä½¿ç”¨ AOF æŒä¹…åŒ–ï¼Œä½†å¹¶ä¸æ¨èè¿™ç§æ–¹å¼ï¼Œå› ä¸ºå®šæ—¶ç”Ÿæˆ RDB å¿«ç…§ï¼ˆsnapshotï¼‰éå¸¸ä¾¿äºè¿›è¡Œæ•°æ®åº“å¤‡ä»½ï¼Œ å¹¶ä¸” RDB æ¢å¤æ•°æ®é›†çš„é€Ÿåº¦ä¹Ÿè¦æ¯” AOF æ¢å¤çš„é€Ÿåº¦è¦å¿«ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œä½¿ç”¨ RDB è¿˜å¯ä»¥é¿å… AOF ç¨‹åºçš„ bugã€‚</li><li>å¦‚æœä½ åªå¸Œæœ›ä½ çš„æ•°æ®åœ¨æœåŠ¡å™¨è¿è¡Œçš„æ—¶å€™å­˜åœ¨ï¼Œä½ ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ä»»ä½•æŒä¹…åŒ–æ–¹å¼ã€‚</li></ul><h4 id="Redis-çš„æ•°æ®æ¢å¤"><a href="#Redis-çš„æ•°æ®æ¢å¤" class="headerlink" title="Redis çš„æ•°æ®æ¢å¤"></a>Redis çš„æ•°æ®æ¢å¤</h4><p><strong>Redis</strong> çš„æ•°æ®æ¢å¤æœ‰ç€å¦‚ä¸‹çš„ä¼˜å…ˆçº§ï¼š</p><ol><li>å¦‚æœåªé…ç½® AOF ï¼Œé‡å¯æ—¶åŠ è½½ AOF æ–‡ä»¶æ¢å¤æ•°æ®ï¼›</li><li>å¦‚æœåŒæ—¶é…ç½®äº† RDB å’Œ AOF ï¼Œå¯åŠ¨åªåŠ è½½ AOF æ–‡ä»¶æ¢å¤æ•°æ®ï¼›</li><li>å¦‚æœåªé…ç½® RDBï¼Œå¯åŠ¨å°†åŠ è½½ dump æ–‡ä»¶æ¢å¤æ•°æ®ã€‚</li></ol><p>æ‹·è´ <strong>AOF</strong> æ–‡ä»¶åˆ° Redis çš„æ•°æ®ç›®å½•ï¼Œå¯åŠ¨ redis-server AOF çš„æ•°æ®æ¢å¤è¿‡ç¨‹ï¼šRedis è™šæ‹Ÿä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œè¯»å– AOF æ–‡ä»¶æ¢å¤ Redis å‘½ä»¤å’Œå‚æ•°ï¼Œç„¶åæ‰§è¡Œå‘½ä»¤ä»è€Œæ¢å¤æ•°æ®ï¼Œè¿™äº›è¿‡ç¨‹ä¸»è¦åœ¨ <code>loadAppendOnlyFile()</code> ä¸­å®ç°ã€‚</p><p>æ‹·è´ <strong>RDB</strong> æ–‡ä»¶åˆ° Redis çš„æ•°æ®ç›®å½•ï¼Œå¯åŠ¨ redis-server å³å¯ï¼Œå› ä¸º RDB æ–‡ä»¶å’Œé‡å¯å‰ä¿å­˜çš„æ˜¯çœŸå®æ•°æ®è€Œä¸æ˜¯å‘½ä»¤çŠ¶æ€å’Œå‚æ•°ã€‚</p><h3 id="ä¸»ä»å¤åˆ¶"><a href="#ä¸»ä»å¤åˆ¶" class="headerlink" title="ä¸»ä»å¤åˆ¶"></a>ä¸»ä»å¤åˆ¶</h3><h4 id="Redisä¸»ä»å¤åˆ¶æ ¸å¿ƒåŸç†"><a href="#Redisä¸»ä»å¤åˆ¶æ ¸å¿ƒåŸç†" class="headerlink" title="Redisä¸»ä»å¤åˆ¶æ ¸å¿ƒåŸç†"></a>Redisä¸»ä»å¤åˆ¶æ ¸å¿ƒåŸç†</h4><ol><li>salve nodeå¯åŠ¨ï¼Œä¼šå‘é€ä¸€ä¸ª<code>PSYNC</code>å‘½ä»¤ç»™master node</li><li>å¦‚æœæ˜¯slave nodeåˆæ¬¡è¿æ¥åˆ°master nodeï¼Œä¼šè§¦å‘ä¸€æ¬¡<code>full resynchronization</code> å…¨é‡å¤åˆ¶ã€‚æ­¤æ—¶masterå›å¯åŠ¨ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œç”Ÿæˆ<code>RDB</code>å¿«ç…§æ–‡ä»¶ï¼ŒåŒæ—¶å°†ä»å®¢æˆ·ç«¯æ–°æ”¶åˆ°çš„æ‰€æœ‰å†™å‘½ä»¤ç¼“å­˜åˆ°å†…å­˜ä¸­ã€‚<code>RDB</code> æ–‡ä»¶ç”Ÿæˆå®Œæ¯•åï¼Œ master ä¼šå°†è¿™ä¸ª <code>RDB</code> å‘é€ç»™ slaveï¼Œslave ä¼šå…ˆ<strong>å†™å…¥æœ¬åœ°ç£ç›˜ï¼Œç„¶åå†ä»æœ¬åœ°ç£ç›˜åŠ è½½åˆ°å†…å­˜</strong>ä¸­ï¼Œæ¥ç€ master ä¼šå°†å†…å­˜ä¸­ç¼“å­˜çš„å†™å‘½ä»¤å‘é€åˆ° slaveï¼Œslave ä¹Ÿä¼šåŒæ­¥è¿™äº›æ•°æ®ã€‚</li><li>slave nodeå¦‚æœè·Ÿmaster nodeæœ‰ç½‘ç»œæ•…éšœï¼Œæ–­å¼€äº†é“¾æ¥ï¼Œä¼šè‡ªåŠ¨é‡è¿ï¼Œè¿æ¥ä¹‹åmaster nodeä»…ä¼šå¤åˆ¶ç»™salveéƒ¨åˆ†ç¼ºå°‘çš„æ•°æ®ã€‚<br><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210119165016.png" alt="Redis-master-slave-replication"></li></ol><h4 id="ä¸»ä»å¤åˆ¶æ˜¯å¦‚ä½•æ–­ç‚¹ç»­ä¼ çš„ï¼Ÿ"><a href="#ä¸»ä»å¤åˆ¶æ˜¯å¦‚ä½•æ–­ç‚¹ç»­ä¼ çš„ï¼Ÿ" class="headerlink" title="ä¸»ä»å¤åˆ¶æ˜¯å¦‚ä½•æ–­ç‚¹ç»­ä¼ çš„ï¼Ÿ"></a>ä¸»ä»å¤åˆ¶æ˜¯å¦‚ä½•æ–­ç‚¹ç»­ä¼ çš„ï¼Ÿ</h4><p>ä» Redis2.8 å¼€å§‹ï¼Œå°±æ”¯æŒä¸»ä»å¤åˆ¶çš„æ–­ç‚¹ç»­ä¼ ï¼Œå¦‚æœä¸»ä»å¤åˆ¶è¿‡ç¨‹ä¸­ï¼Œç½‘ç»œè¿æ¥æ–­æ‰äº†ï¼Œé‚£ä¹ˆå¯ä»¥æ¥ç€ä¸Šæ¬¡å¤åˆ¶çš„åœ°æ–¹ï¼Œç»§ç»­å¤åˆ¶ä¸‹å»ï¼Œè€Œä¸æ˜¯ä»å¤´å¼€å§‹å¤åˆ¶ä¸€ä»½ã€‚</p><p>master nodeä¼šåœ¨å†…å­˜ä¸­ç»´æŠ¤ä¸€ä¸ªbacklogï¼Œmasterå’Œslaveéƒ½ä¼šä¿å­˜ä¸€ä¸ªreplica offsetè¿˜æœ‰ä¸€ä¸ªmaster run idï¼Œoffsetå°±æ˜¯ä¿å­˜åœ¨backlogä¸­çš„ã€‚å¦‚æœmasterå’Œslaveç½‘ç»œè¿æ¥æ–­æ‰äº†ï¼Œslaveä¼šè®©masterä»ä¸Šæ¬¡replica offsetå¼€å§‹å¤åˆ¶ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„offsetï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œä¸€æ¬¡<code>resynchronization</code> ã€‚</p><blockquote><p> å¦‚æœæ ¹æ® host+ip å®šä½ master nodeï¼Œæ˜¯ä¸é è°±çš„ï¼Œå¦‚æœ master node é‡å¯æˆ–è€…æ•°æ®å‡ºç°äº†å˜åŒ–ï¼Œé‚£ä¹ˆ slave node åº”è¯¥æ ¹æ®ä¸åŒçš„ run id åŒºåˆ†ã€‚</p></blockquote><h3 id="æ·˜æ±°ç­–ç•¥"><a href="#æ·˜æ±°ç­–ç•¥" class="headerlink" title="æ·˜æ±°ç­–ç•¥"></a>æ·˜æ±°ç­–ç•¥</h3><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://mp.weixin.qq.com/s?__biz=Mzg5MzU2NDgyNw==&mid=2247487138&idx=1&sn=0e580a60cf28707b012f7c2068ca2bbc&source=41#wechat_redirect">å¦ˆå¦ˆå†ä¹Ÿä¸æ‹…å¿ƒæˆ‘é¢è¯•è¢«Redisé—®å¾—è„¸éƒ½ç»¿äº†</a></li><li><a href="https://www.51cto.com/article/668394.html">redisæ¸è¿›å¼rehash</a></li><li><a href="https://www.51cto.com/article/668394.html">Redisä¸­çš„hashæ‰©å®¹æ¸è¿›å¼rehashè¿‡ç¨‹</a></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> é¢ç» </tag>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVMé¢è¯•é¢˜</title>
      <link href="/posts/eec2f852.html"/>
      <url>/posts/eec2f852.html</url>
      
        <content type="html"><![CDATA[<hr><h2 id="å¯¹è±¡å·²ç»æ­»äº¡ï¼Ÿ"><a href="#å¯¹è±¡å·²ç»æ­»äº¡ï¼Ÿ" class="headerlink" title="å¯¹è±¡å·²ç»æ­»äº¡ï¼Ÿ"></a>å¯¹è±¡å·²ç»æ­»äº¡ï¼Ÿ</h2><h3 id="å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯æ— ç”¨çš„ç±»"><a href="#å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯æ— ç”¨çš„ç±»" class="headerlink" title="å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯æ— ç”¨çš„ç±»"></a>å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯æ— ç”¨çš„ç±»</h3><p>æ–¹æ³•åŒºä¸»è¦å›æ”¶çš„æ˜¯æ— ç”¨çš„ç±»ï¼Œé‚£ä¹ˆå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯æ— ç”¨çš„ç±»çš„å‘¢ï¼Ÿ</p><p>åˆ¤å®šä¸€ä¸ªå¸¸é‡æ˜¯å¦æ˜¯â€œåºŸå¼ƒå¸¸é‡â€æ¯”è¾ƒç®€å•ï¼Œè€Œè¦åˆ¤å®šä¸€ä¸ªç±»æ˜¯å¦æ˜¯â€œæ— ç”¨çš„ç±»â€çš„æ¡ä»¶åˆ™ç›¸å¯¹è‹›åˆ»è®¸å¤šã€‚ç±»éœ€è¦åŒæ—¶æ»¡è¶³ä¸‹é¢ 3 ä¸ªæ¡ä»¶æ‰èƒ½ç®—æ˜¯ <strong>â€œæ— ç”¨çš„ç±»â€</strong> ï¼š</p><ul><li>è¯¥ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶ï¼Œä¹Ÿå°±æ˜¯ Java å †ä¸­ä¸å­˜åœ¨è¯¥ç±»çš„ä»»ä½•å®ä¾‹ã€‚</li><li>åŠ è½½è¯¥ç±»çš„ <code>ClassLoader</code> å·²ç»è¢«å›æ”¶ã€‚</li><li>è¯¥ç±»å¯¹åº”çš„ <code>java.lang.Class</code> å¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œæ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»çš„æ–¹æ³•ã€‚</li></ul><p>è™šæ‹Ÿæœºå¯ä»¥å¯¹æ»¡è¶³ä¸Šè¿° 3 ä¸ªæ¡ä»¶çš„æ— ç”¨ç±»è¿›è¡Œå›æ”¶ï¼Œè¿™é‡Œè¯´çš„ä»…ä»…æ˜¯â€œå¯ä»¥â€ï¼Œè€Œå¹¶ä¸æ˜¯å’Œå¯¹è±¡ä¸€æ ·ä¸ä½¿ç”¨äº†å°±ä¼šå¿…ç„¶è¢«å›æ”¶ã€‚</p><h2 id="JVMå†…å­˜åˆ’åˆ†"><a href="#JVMå†…å­˜åˆ’åˆ†" class="headerlink" title="JVMå†…å­˜åˆ’åˆ†"></a>JVMå†…å­˜åˆ’åˆ†</h2><h2 id="ç±»åŠ è½½è¿‡ç¨‹"><a href="#ç±»åŠ è½½è¿‡ç¨‹" class="headerlink" title="ç±»åŠ è½½è¿‡ç¨‹"></a>ç±»åŠ è½½è¿‡ç¨‹</h2><p><strong>è¿‡ç¨‹ï¼šåŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æã€åˆå§‹åŒ–</strong></p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210610235314.jpeg" alt="img"></p><p>ç±»åŠ è½½è¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼šLoadã€Linkå’ŒInitï¼Œå³<strong>åŠ è½½</strong>ã€<strong>é“¾æ¥</strong>ã€<strong>åˆå§‹åŒ–</strong></p><ol><li>ç¬¬ä¸€æ­¥ï¼ŒLoadé˜¶æ®µè¯»å–ç±»æ–‡ä»¶äº§ç”ŸäºŒè¿›åˆ¶æµï¼Œå¹¶è½¬åŒ–ä¸ºç‰¹å®šçš„æ•°æ®ç»“æ„ï¼Œåˆæ­¥æ ¡éªŒcafe babeé­”æ³•æ•°ã€å¸¸é‡æ± ã€æ–‡ä»¶é•¿åº¦ã€æ˜¯å¦æœ‰çˆ¶ç±»ç­‰ï¼Œç„¶ååˆ›å»ºå¯¹åº”ç±»çš„<code>java.lang.Class</code>å®ä¾‹</li><li>ç¬¬äºŒæ­¥ï¼ŒLinké˜¶æ®µåŒ…æ‹¬<strong>éªŒè¯</strong>ã€<strong>å‡†å¤‡</strong>ã€<strong>è§£æ</strong>ä¸‰ä¸ªæ­¥éª¤ã€‚éªŒè¯æ˜¯æ›´è¯¦ç»†çš„æ ¡éªŒï¼Œæ¯”å¦‚finalæ˜¯å¦åˆè§„ã€ç±»å‹æ˜¯å¦æ­£ç¡®ã€é™æ€å˜é‡æ˜¯å¦åˆç†ç­‰ï¼›å‡†å¤‡é˜¶æ®µæ˜¯ä¸ºé™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶è®¾å®šé»˜è®¤å€¼ï¼Œè§£æç±»å’Œæ–¹æ³•ç¡®ä¿ç±»ä¸ç±»ä¹‹é—´çš„ç›¸äº’å¼•ç”¨æ­£ç¡®æ€§ï¼Œå®Œæˆå†…å­˜ç»“æ„å¸ƒå±€ã€‚</li><li>ç¬¬ä¸‰æ­¥ï¼ŒInité˜¶æ®µæ‰§è¡Œé›·æ„é€ å™¨&lt;clinit&gt;æ–¹æ³•ï¼Œå¦‚æœèµ‹å€¼è¿ç®—æ˜¯é€šè¿‡å…¶ä»–ç±»çš„é™æ€æ–¹æ³•æ¥å®Œæˆçš„ï¼Œé‚£ä¹ˆä¼šé©¬ä¸Šè§£æå¦å¤–ä¸€ä¸ªç±»ï¼Œåœ¨è™šæ‹Ÿæœºæ ˆä¸­æ‰§è¡Œå®Œæ¯•åé€šè¿‡è¿”å›å€¼è¿›è¡Œèµ‹å€¼ã€‚</li></ol><h2 id="åŒäº²å§”æ´¾æœºåˆ¶"><a href="#åŒäº²å§”æ´¾æœºåˆ¶" class="headerlink" title="åŒäº²å§”æ´¾æœºåˆ¶"></a>åŒäº²å§”æ´¾æœºåˆ¶</h2><h3 id="ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æœºåˆ¶"><a href="#ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æœºåˆ¶" class="headerlink" title="ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æœºåˆ¶"></a>ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æœºåˆ¶</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œè™šæ‹Ÿæœºåœ¨åŠ è½½ç±»çš„è¿‡ç¨‹ä¸­éœ€è¦ä½¿ç”¨ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ï¼Œè€Œåœ¨Javaä¸­ï¼Œç±»åŠ è½½å™¨æœ‰å¾ˆå¤šï¼Œé‚£ä¹ˆå½“JVMæƒ³è¦åŠ è½½ä¸€ä¸ª.classæ–‡ä»¶çš„æ—¶å€™ï¼Œåˆ°åº•åº”è¯¥ç”±å“ªä¸ªç±»åŠ è½½å™¨åŠ è½½å‘¢ï¼Ÿ</p><p>è¿™å°±ä¸å¾—ä¸æåˆ°â€åŒäº²å§”æ´¾æœºåˆ¶â€ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“çš„æ˜¯ï¼ŒJavaè¯­è¨€ç³»ç»Ÿä¸­æ”¯æŒä»¥ä¸‹4ç§ç±»åŠ è½½å™¨ï¼š</p><ul><li>Bootstrap ClassLoader å¯åŠ¨ç±»åŠ è½½å™¨</li><li>Extention ClassLoader æ ‡å‡†æ‰©å±•ç±»åŠ è½½å™¨</li><li>Application ClassLoader åº”ç”¨ç±»åŠ è½½å™¨</li><li>User ClassLoader ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨</li></ul><p>è¿™å››ç§ç±»åŠ è½½å™¨ä¹‹é—´ï¼Œæ˜¯å­˜åœ¨ç€ä¸€ç§å±‚æ¬¡å…³ç³»çš„ï¼Œå¦‚ä¸‹å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021202205232103648.jpeg" alt="-w704"></p><p>ä¸€èˆ¬è®¤ä¸ºä¸Šä¸€å±‚åŠ è½½å™¨æ˜¯ä¸‹ä¸€å±‚åŠ è½½å™¨çš„çˆ¶åŠ è½½å™¨ï¼Œé‚£ä¹ˆï¼Œé™¤äº†BootstrapClassLoaderä¹‹å¤–ï¼Œæ‰€æœ‰çš„åŠ è½½å™¨éƒ½æ˜¯æœ‰çˆ¶åŠ è½½å™¨çš„ã€‚</p><p>é‚£ä¹ˆï¼Œæ‰€è°“çš„åŒäº²å§”æ´¾æœºåˆ¶ï¼ŒæŒ‡çš„å°±æ˜¯ï¼š<strong>å½“ä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½çš„è¯·æ±‚çš„æ—¶å€™ï¼Œä»–ä¸ä¼šç›´æ¥å»åŠ è½½æŒ‡å®šçš„ç±»ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ‰˜ç»™è‡ªå·±çš„çˆ¶åŠ è½½å™¨å»åŠ è½½ã€‚åªæœ‰çˆ¶åŠ è½½å™¨æ— æ³•åŠ è½½è¿™ä¸ªç±»çš„æ—¶å€™ï¼Œæ‰ä¼šç”±å½“å‰è¿™ä¸ªåŠ è½½å™¨æ¥è´Ÿè´£ç±»çš„åŠ è½½ã€‚</strong></p><p>é‚£ä¹ˆï¼Œä»€ä¹ˆæƒ…å†µä¸‹çˆ¶åŠ è½½å™¨ä¼šæ— æ³•åŠ è½½æŸä¸€ä¸ªç±»å‘¢ï¼Ÿ</p><p>å…¶å®ï¼ŒJavaä¸­æä¾›çš„è¿™å››ç§ç±»å‹çš„åŠ è½½å™¨ï¼Œæ˜¯æœ‰å„è‡ªçš„èŒè´£çš„ï¼š</p><ul><li>Bootstrap ClassLoader ï¼Œä¸»è¦è´Ÿè´£åŠ è½½Javaæ ¸å¿ƒç±»åº“ï¼Œ%JRE_HOME%\libä¸‹çš„rt.jarã€resources.jarã€charsets.jarå’Œclassç­‰ã€‚</li><li>Extention ClassLoaderï¼Œä¸»è¦è´Ÿè´£åŠ è½½ç›®å½•%JRE_HOME%\lib\extç›®å½•ä¸‹çš„jaråŒ…å’Œclassæ–‡ä»¶ã€‚</li><li>Application ClassLoader ï¼Œä¸»è¦è´Ÿè´£åŠ è½½å½“å‰åº”ç”¨çš„classpathä¸‹çš„æ‰€æœ‰ç±»</li><li>User ClassLoader ï¼Œ ç”¨æˆ·è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨,å¯åŠ è½½æŒ‡å®šè·¯å¾„çš„classæ–‡ä»¶</li></ul><p>é‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„ç±»ï¼Œå¦‚com.hollis.ClassHollis æ˜¯æ— è®ºå¦‚ä½•ä¹Ÿä¸ä¼šè¢«Bootstrapå’ŒExtentionåŠ è½½å™¨åŠ è½½çš„ï¼ˆ<code>-Xbootclasspath</code>å‚æ•°æ˜¯å¦å¯ä»¥ä½¿å¾—è‡ªå®šä¹‰ç±»è¢«bootstrapåŠ è½½ï¼Ÿï¼‰ã€‚</p><h2 id="JVMåƒåœ¾å›æ”¶"><a href="#JVMåƒåœ¾å›æ”¶" class="headerlink" title="JVMåƒåœ¾å›æ”¶"></a>JVMåƒåœ¾å›æ”¶</h2><h3 id="åƒåœ¾å›æ”¶å™¨"><a href="#åƒåœ¾å›æ”¶å™¨" class="headerlink" title="åƒåœ¾å›æ”¶å™¨"></a>åƒåœ¾å›æ”¶å™¨</h3><h4 id="JDK8-CMSï¼šï¼ˆå…³æ³¨æœ€çŸ­åƒåœ¾å›æ”¶åœé¡¿æ—¶é—´ï¼‰"><a href="#JDK8-CMSï¼šï¼ˆå…³æ³¨æœ€çŸ­åƒåœ¾å›æ”¶åœé¡¿æ—¶é—´ï¼‰" class="headerlink" title="JDK8-CMSï¼šï¼ˆå…³æ³¨æœ€çŸ­åƒåœ¾å›æ”¶åœé¡¿æ—¶é—´ï¼‰"></a>JDK8-CMSï¼šï¼ˆå…³æ³¨æœ€çŸ­åƒåœ¾å›æ”¶åœé¡¿æ—¶é—´ï¼‰</h4><p><strong>CMSå›æ”¶å™¨</strong>ï¼ˆConcurrent Mark Sweep Collectorï¼‰æ˜¯å›æ”¶åœé¡¿æ—¶é—´æ¯”è¾ƒçŸ­ï¼Œç›®å‰æ¯”è¾ƒå¸¸ç”¨çš„åƒåœ¾å›æ”¶å™¨ã€‚å®ƒé€šè¿‡åˆå§‹æ ‡è®°ï¼ˆInitial Markï¼‰ã€å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markï¼‰ã€é‡æ–°æ ‡è®°ï¼ˆRemark)ã€å¹¶å‘æ¸…é™¤ï¼ˆConcurrent Sweepï¼‰å››ä¸ªæ­¥éª¤å®Œæˆåƒåœ¾å›æ”¶å·¥ä½œã€‚ç¬¬1ã€3æ­¥çš„åˆå§‹æ ‡è®°å’Œé‡æ–°æ ‡è®°é˜¶æ®µä¾ç„¶ä¼šå¼•å‘STWã€‚2ã€4æ­¥å¯ä»¥å’Œåº”ç”¨ç¨‹åºå¹¶å‘æ‰§è¡Œã€‚CMSé‡‡ç”¨â€œæ ‡è®° - æ¸…é™¤ç®—æ³•â€ï¼Œå› æ­¤äº§ç”Ÿå¤§é‡çš„ç©ºé—´ç¢ç‰‡ã€‚å¯ä»¥é€šè¿‡<code>-XX:+UseCMSCompactAtFullCollection</code>å‚æ•°ï¼Œå¼ºåˆ¶JVMåœ¨FGCå®Œæˆåå¯¹è€å¹´ä»£è¿›è¡Œå‹ç¼©ï¼Œæ‰§è¡Œä¸€æ¬¡ç©ºé—´ç¢ç‰‡æ•´ç†ï¼Œä½†æ˜¯ä¼šå¼•å‘STWã€‚ä¸ºäº†å‡å°‘STWæ¬¡æ•°ï¼ŒCMSè¿˜å¯ä»¥é€šè¿‡é…ç½®<code>-XX:+CMSFullGCsBeforeCompaction=n</code>å‚æ•°ï¼Œåœ¨æ‰§è¡Œäº†næ¬¡FGCåï¼ŒJVMå†åœ¨è€å¹´ä»£æ‰§è¡Œç©ºé—´ç¢ç‰‡æ•´ç†ã€‚</p><h4 id="JDK9-G1ï¼šï¼ˆç²¾å‡†æ§åˆ¶åœé¡¿æ—¶é—´ï¼Œé¿å…åƒåœ¾ç¢ç‰‡ï¼‰"><a href="#JDK9-G1ï¼šï¼ˆç²¾å‡†æ§åˆ¶åœé¡¿æ—¶é—´ï¼Œé¿å…åƒåœ¾ç¢ç‰‡ï¼‰" class="headerlink" title="JDK9-G1ï¼šï¼ˆç²¾å‡†æ§åˆ¶åœé¡¿æ—¶é—´ï¼Œé¿å…åƒåœ¾ç¢ç‰‡ï¼‰"></a>JDK9-G1ï¼šï¼ˆç²¾å‡†æ§åˆ¶åœé¡¿æ—¶é—´ï¼Œé¿å…åƒåœ¾ç¢ç‰‡ï¼‰</h4><p>G1ï¼ˆGarbage-First Garbage Collectorï¼‰åƒåœ¾å›æ”¶å™¨ã€‚</p><p>æ˜¯â¼€æ¬¾â¾¯å‘æœåŠ¡å™¨çš„åƒåœ¾æ”¶é›†å™¨,ä¸»è¦é’ˆå¯¹é…å¤‡å¤šé¢—å¤„ç†å™¨åŠâ¼¤å®¹é‡å†…å­˜çš„æœºå™¨.ä»¥æâ¾¼æ¦‚ç‡æ»¡â¾œGCåœé¡¿æ—¶<br>é—´è¦æ±‚çš„åŒæ—¶,è¿˜å…·å¤‡â¾¼ååé‡æ€§èƒ½ç‰¹å¾ï¼›ç›¸æ¯”ä¸ CMS æ”¶é›†å™¨ï¼ŒG1 æ”¶é›†å™¨ä¸¤ä¸ªæœ€çªå‡ºçš„æ”¹è¿›æ˜¯ï¼š</p><p>ã€1ã€‘åŸºäºæ ‡è®°-æ•´ç†ç®—æ³•ï¼Œä¸äº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚</p><p>ã€2ã€‘å¯ä»¥éå¸¸ç²¾ç¡®æ§åˆ¶åœé¡¿æ—¶é—´ï¼Œåœ¨ä¸ç‰ºç‰²ååé‡å‰æä¸‹ï¼Œå®ç°ä½åœé¡¿åƒåœ¾å›æ”¶ã€‚</p><p>G1 æ”¶é›†å™¨é¿å…å…¨åŒºåŸŸåƒåœ¾æ”¶é›†ï¼Œå®ƒæŠŠå †å†…å­˜åˆ’åˆ†ä¸ºå¤§å°å›ºå®šçš„å‡ ä¸ªç‹¬ç«‹åŒºåŸŸï¼Œå¹¶ä¸”è·Ÿè¸ªè¿™äº›åŒºåŸŸçš„åƒåœ¾<br>æ”¶é›†è¿›åº¦ï¼ŒåŒæ—¶åœ¨åå°ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆçº§åˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®æ‰€å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆå›æ”¶åƒåœ¾æœ€å¤šçš„åŒºåŸŸã€‚<strong>åŒºåŸŸåˆ’</strong><br><strong>åˆ†</strong>å’Œ<strong>ä¼˜å…ˆçº§åŒºåŸŸ</strong>å›æ”¶æœºåˆ¶ï¼Œç¡®ä¿ G1 æ”¶é›†å™¨å¯ä»¥åœ¨æœ‰é™æ—¶é—´è·å¾—æœ€é«˜çš„åƒåœ¾æ”¶é›†æ•ˆç‡ã€‚</p><ul><li><p><strong>åˆå§‹æ ‡è®°</strong>ï¼š<strong>Stop The Worldï¼Œ</strong>ä»…ä½¿ç”¨ä¸€æ¡åˆå§‹æ ‡è®°çº¿ç¨‹å¯¹GC Rootså…³è”çš„å¯¹è±¡è¿›è¡Œæ ‡è®°</p></li><li><p><strong>å¹¶å‘æ ‡è®°</strong>ï¼šä½¿ç”¨ä¸€æ¡æ ‡è®°çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚æ­¤è¿‡ç¨‹è¿›è¡Œ<strong>å¯è¾¾æ€§åˆ†æï¼Œé€Ÿåº¦å¾ˆæ…¢</strong></p></li><li><p><strong>æœ€ç»ˆæ ‡è®°</strong>ï¼š<strong>Stop The World</strong>ï¼Œä½¿ç”¨å¤šæ¡æ ‡è®°çº¿ç¨‹å¹¶å‘æ‰§è¡Œ</p></li><li><p><strong>ç­›é€‰å›æ”¶</strong>ï¼šå›æ”¶åºŸå¼ƒå¯¹è±¡ï¼Œæ­¤æ—¶ä¹Ÿè¦ <strong>Stop The World</strong>ï¼Œå¹¶ä½¿ç”¨å¤šæ¡ç­›é€‰å›æ”¶çº¿ç¨‹å¹¶å‘æ‰§è¡Œ</p></li></ul><h5 id="G1åƒåœ¾å›æ”¶æœŸåŸç†"><a href="#G1åƒåœ¾å›æ”¶æœŸåŸç†" class="headerlink" title="G1åƒåœ¾å›æ”¶æœŸåŸç†"></a>G1åƒåœ¾å›æ”¶æœŸåŸç†</h5><p>TODO</p><h4 id="ZGC"><a href="#ZGC" class="headerlink" title="ZGC"></a>ZGC</h4><p>2022å¹´6æœˆ5æ—¥TODOï¼ˆä½œä¸ºäº®ç‚¹ï¼‰</p><h4 id="å¦‚ä½•é…ç½®åƒåœ¾æ”¶é›†å™¨"><a href="#å¦‚ä½•é…ç½®åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="å¦‚ä½•é…ç½®åƒåœ¾æ”¶é›†å™¨"></a><strong>å¦‚ä½•é…ç½®åƒåœ¾æ”¶é›†å™¨</strong></h4><ul><li>é¦–å…ˆæ˜¯å†…å­˜å¤§å°é—®é¢˜ï¼ŒåŸºæœ¬ä¸Šæ¯ä¸€ä¸ªå†…å­˜åŒºåŸŸæˆ‘éƒ½ä¼šè®¾ç½®ä¸€ä¸ªä¸Šé™ï¼Œæ¥é¿å…æº¢å‡ºé—®é¢˜ï¼Œæ¯”å¦‚å…ƒç©ºé—´ã€‚</li><li>é€šå¸¸ï¼Œå †ç©ºé—´æˆ‘ä¼šè®¾ç½®æˆæ“ä½œç³»ç»Ÿçš„ 2&#x2F;3ï¼Œè¶…è¿‡ 8GB çš„å †ï¼Œä¼˜å…ˆé€‰ç”¨ G1</li><li>ç„¶åæˆ‘ä¼šå¯¹ JVM è¿›è¡Œåˆæ­¥ä¼˜åŒ–ï¼Œæ¯”å¦‚æ ¹æ®è€å¹´ä»£çš„å¯¹è±¡æå‡é€Ÿåº¦ï¼Œæ¥è°ƒæ•´å¹´è½»ä»£å’Œè€å¹´ä»£ä¹‹é—´çš„æ¯”ä¾‹</li><li>ä¾æ®ç³»ç»Ÿå®¹é‡ã€è®¿é—®å»¶è¿Ÿã€ååé‡ç­‰è¿›è¡Œä¸“é¡¹ä¼˜åŒ–ï¼Œæˆ‘ä»¬çš„æœåŠ¡æ˜¯é«˜å¹¶å‘çš„ï¼Œå¯¹ STW çš„æ—¶é—´æ•æ„Ÿ</li><li>æˆ‘ä¼šé€šè¿‡è®°å½•è¯¦ç»†çš„ GC æ—¥å¿—ï¼Œæ¥æ‰¾åˆ°è¿™ä¸ªç“¶é¢ˆç‚¹ï¼Œå€Ÿç”¨ GCeasy è¿™æ ·çš„æ—¥å¿—åˆ†æå·¥å…·ï¼Œå®šä½é—®é¢˜</li></ul><h3 id="GCè§¦å‘æ¡ä»¶"><a href="#GCè§¦å‘æ¡ä»¶" class="headerlink" title="GCè§¦å‘æ¡ä»¶"></a>GCè§¦å‘æ¡ä»¶</h3><h4 id="MinorGCè§¦å‘æ¡ä»¶"><a href="#MinorGCè§¦å‘æ¡ä»¶" class="headerlink" title="MinorGCè§¦å‘æ¡ä»¶"></a>MinorGCè§¦å‘æ¡ä»¶</h4><p>å½“EdenåŒºæ»¡æ—¶è§¦å‘MinorGC</p><h4 id="FullGCè§¦å‘æ¡ä»¶"><a href="#FullGCè§¦å‘æ¡ä»¶" class="headerlink" title="FullGCè§¦å‘æ¡ä»¶"></a>FullGCè§¦å‘æ¡ä»¶</h4><ol><li>è°ƒç”¨System.gcæ—¶ï¼Œç³»ç»Ÿå»ºè®®æ‰§è¡ŒFullGCï¼Œä½†æ˜¯ä¸å¿…ç„¶æ‰§è¡Œ</li><li>è€å¹´ä»£ç©ºé—´ä¸è¶³</li><li>æ–¹æ³•åŒºç©ºé—´ä¸è¶³ï¼ˆjdk8ä¹‹å‰ï¼‰</li><li>é€šè¿‡MinorGCåè¿›å…¥è€å¹´ä»£çš„å¹³å‡å¤§å°å¤§äºè€å¹´ä»£çš„å¯ç”¨å†…å­˜</li><li>ç”±EdenåŒºã€FromSpaceå‘ToSpaceåŒºå¤åˆ¶æ—¶ï¼Œå¯¹è±¡å¤§å°å¤§äºToSpaceå¯ç”¨å†…å­˜ï¼Œåˆ™æŠŠè¯¥å¯¹è±¡è½¬å­˜åˆ°è€å¹´ä»£ï¼Œä¸”è€å¹´ä»£çš„å¯ç”¨å†…å­˜å°äºè¯¥å¯¹è±¡å¤§å°</li></ol><h2 id="JVMè°ƒä¼˜"><a href="#JVMè°ƒä¼˜" class="headerlink" title="JVMè°ƒä¼˜"></a>JVMè°ƒä¼˜</h2><h3 id="JVMä¼˜åŒ–çš„æ€è·¯"><a href="#JVMä¼˜åŒ–çš„æ€è·¯" class="headerlink" title="JVMä¼˜åŒ–çš„æ€è·¯"></a>JVMä¼˜åŒ–çš„æ€è·¯</h3><p>1ã€ä¸€èˆ¬æ¥è¯´ï¼Œå½“survivoråŒºä¸å¤Ÿå¤§æˆ–è€…å ç”¨é‡è¾¾åˆ°50%ï¼Œå°±ä¼šæŠŠä¸€äº›å¯¹è±¡æ”¾åˆ°è€å¹´åŒºã€‚é€šè¿‡è®¾ç½®åˆç†çš„edenåŒºï¼ŒsurvivoråŒºåŠä½¿ç”¨ç‡ï¼Œå¯ä»¥å°†å¹´è½»å¯¹è±¡ä¿å­˜åœ¨å¹´è½»ä»£ï¼Œä»è€Œé¿å…full GCï¼Œä½¿ç”¨<code>-Xmn</code>è®¾ç½®å¹´è½»ä»£çš„å¤§å°</p><p>2ã€å¯¹äºå ç”¨å†…å­˜æ¯”è¾ƒå¤šçš„å¤§å¯¹è±¡ï¼Œä¸€èˆ¬ä¼šé€‰æ‹©åœ¨è€å¹´ä»£åˆ†é…å†…å­˜ã€‚å¦‚æœåœ¨å¹´è½»ä»£ç»™å¤§å¯¹è±¡åˆ†é…å†…å­˜ï¼Œå¹´è½»ä»£å†…å­˜ä¸å¤Ÿäº†ï¼Œå°±è¦åœ¨edenåŒºç§»åŠ¨å¤§é‡å¯¹è±¡åˆ°è€å¹´ä»£ï¼Œç„¶åè¿™äº›ç§»åŠ¨çš„å¯¹è±¡å¯èƒ½å¾ˆå¿«æ¶ˆäº¡ï¼Œå› æ­¤å¯¼è‡´full GCã€‚é€šè¿‡è®¾ç½®å‚æ•°ï¼š<code>-XX:PetenureSizeThreshold=1000000</code>ï¼Œå•ä½ä¸ºBï¼Œæ ‡æ˜å¯¹è±¡å¤§å°è¶…è¿‡1Mæ—¶ï¼Œåœ¨è€å¹´ä»£(tenured)åˆ†é…å†…å­˜ç©ºé—´ã€‚</p><p>3ã€ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¹´è½»å¯¹è±¡æ”¾åœ¨edenåŒºï¼Œå½“ç¬¬ä¸€æ¬¡GCåï¼Œå¦‚æœå¯¹è±¡è¿˜å­˜æ´»ï¼Œæ”¾åˆ°survivoråŒºï¼Œæ­¤åï¼Œæ¯GCä¸€æ¬¡ï¼Œå¹´é¾„å¢åŠ 1ï¼Œå½“å¯¹è±¡çš„å¹´é¾„è¾¾åˆ°é˜ˆå€¼ï¼Œå°±è¢«æ”¾åˆ°tenuredè€å¹´åŒºã€‚è¿™ä¸ªé˜ˆå€¼å¯ä»¥åŒæ„<code>-XX:MaxTenuringThreshold</code>è®¾ç½®ã€‚å¦‚æœæƒ³è®©å¯¹è±¡ç•™åœ¨å¹´è½»ä»£ï¼Œå¯ä»¥è®¾ç½®æ¯”è¾ƒå¤§çš„é˜ˆå€¼ã€‚</p><p>4ã€è®¾ç½®æœ€å°å †å’Œæœ€å¤§å †ï¼š<code>-Xmx</code>å’Œ<code>-Xms</code>ç¨³å®šçš„å †å¤§å°å †åƒåœ¾å›æ”¶æ˜¯æœ‰åˆ©çš„ï¼Œè·å¾—ä¸€ä¸ªç¨³å®šçš„å †å¤§å°çš„æ–¹æ³•æ˜¯è®¾ç½®-Xmså’Œ-Xmxçš„å€¼ä¸€æ ·ï¼Œå³æœ€å¤§å †å’Œæœ€å°å †ä¸€æ ·ï¼Œå¦‚æœè¿™æ ·å­è®¾ç½®ï¼Œç³»ç»Ÿåœ¨è¿è¡Œæ—¶å †å¤§å°ç†è®ºä¸Šæ˜¯æ’å®šçš„ï¼Œç¨³å®šçš„å †ç©ºé—´å¯ä»¥å‡å°‘GCæ¬¡æ•°ï¼Œå› æ­¤ï¼Œå¾ˆå¤šæœåŠ¡ç«¯éƒ½ä¼šå°†è¿™ä¸¤ä¸ªå‚æ•°è®¾ç½®ä¸ºä¸€æ ·çš„æ•°å€¼ã€‚ç¨³å®šçš„å †å¤§å°è™½ç„¶å‡å°‘GCæ¬¡æ•°ï¼Œä½†æ˜¯å¢åŠ æ¯æ¬¡GCçš„æ—¶é—´ï¼Œå› ä¸ºæ¯æ¬¡GCè¦æŠŠå †çš„å¤§å°ç»´æŒåœ¨ä¸€ä¸ªåŒºé—´å†…ã€‚</p><p>5ã€ä¸€ä¸ªä¸ç¨³å®šçš„å †å¹¶éæ¯«æ— ç”¨å¤„ã€‚åœ¨ç³»ç»Ÿä¸éœ€è¦ä½¿ç”¨å¤§å†…å­˜çš„æ—¶å€™ï¼Œå‹ç¼©å †ç©ºé—´ï¼Œä½¿å¾—GCæ¯æ¬¡åº”å¯¹ä¸€ä¸ªè¾ƒå°çš„å †ç©ºé—´ï¼ŒåŠ å¿«å•æ¬¡GCæ¬¡æ•°ã€‚åŸºäºè¿™ç§è€ƒè™‘ï¼ŒJVMæä¾›ä¸¤ä¸ªå‚æ•°ï¼Œç”¨äºå‹ç¼©å’Œæ‰©å±•å †ç©ºé—´ã€‚<br>ï¼ˆ1ï¼‰<code>-XX:MinHeapFreeRatio</code> å‚æ•°ç”¨äºè®¾ç½®å †ç©ºé—´çš„æœ€å°ç©ºé—²æ¯”ç‡ã€‚é»˜è®¤å€¼æ˜¯40ï¼Œå½“å †ç©ºé—´çš„ç©ºé—²å†…å­˜æ¯”ç‡å°äº40ï¼ŒJVMä¾¿ä¼šæ‰©å±•å †ç©ºé—´<br>ï¼ˆ2ï¼‰<code>-XX:MaxHeapFreeRatio</code> å‚æ•°ç”¨äºè®¾ç½®å †ç©ºé—´çš„æœ€å¤§ç©ºé—²æ¯”ç‡ã€‚é»˜è®¤å€¼æ˜¯70ï¼Œ å½“å †ç©ºé—´çš„ç©ºé—²å†…å­˜æ¯”ç‡å¤§äº70ï¼ŒJVMä¾¿ä¼šå‹ç¼©å †ç©ºé—´ã€‚<br>ï¼ˆ3ï¼‰å½“-Xmxå’Œ-Xmxç›¸ç­‰æ—¶ï¼Œä¸Šé¢ä¸¤ä¸ªå‚æ•°æ— æ•ˆ</p><p>6ã€é€šè¿‡å¢å¤§ååé‡æé«˜ç³»ç»Ÿæ€§èƒ½ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®å¹¶è¡Œåƒåœ¾å›æ”¶æ”¶é›†å™¨ã€‚<br>ï¼ˆ1ï¼‰<code>-XX:+UseParallelGC</code>:å¹´è½»ä»£ä½¿ç”¨å¹¶è¡Œåƒåœ¾å›æ”¶æ”¶é›†å™¨ã€‚è¿™æ˜¯ä¸€ä¸ªå…³æ³¨ååé‡çš„æ”¶é›†å™¨ï¼Œå¯ä»¥å°½å¯èƒ½çš„å‡å°‘åƒåœ¾å›æ”¶æ—¶é—´ã€‚<br>ï¼ˆ2ï¼‰<code>-XX:+UseParallelOldGC</code>:è®¾ç½®è€å¹´ä»£ä½¿ç”¨å¹¶è¡Œåƒåœ¾å›æ”¶æ”¶é›†å™¨ã€‚</p><p>7ã€å°è¯•ä½¿ç”¨å¤§çš„å†…å­˜åˆ†é¡µï¼šä½¿ç”¨å¤§çš„å†…å­˜åˆ†é¡µå¢åŠ CPUçš„å†…å­˜å¯»å€èƒ½åŠ›ï¼Œä»è€Œç³»ç»Ÿçš„æ€§èƒ½ã€‚<code>-XX:+LargePageSizeInBytes</code> è®¾ç½®å†…å­˜é¡µçš„å¤§å°</p><p>8ã€ä½¿ç”¨éå ç”¨çš„åƒåœ¾æ”¶é›†å™¨ã€‚<code>-XX:+UseConcMarkSweepGC</code>è€å¹´ä»£ä½¿ç”¨CMSæ”¶é›†å™¨é™ä½åœé¡¿ã€‚</p><p>9ã€<code>-XXSurvivorRatio=3</code>ï¼Œè¡¨ç¤ºå¹´è½»ä»£ä¸­çš„åˆ†é…æ¯”ç‡ï¼šsurvivor:eden &#x3D; 2:3</p><p>10ã€JVMæ€§èƒ½è°ƒä¼˜çš„å·¥å…·ï¼š<br>ï¼ˆ1ï¼‰jpsï¼ˆJava Process Statusï¼‰ï¼šè¾“å‡ºJVMä¸­è¿è¡Œçš„è¿›ç¨‹çŠ¶æ€ä¿¡æ¯(ç°åœ¨ä¸€èˆ¬ä½¿ç”¨jconsole)<br>ï¼ˆ2ï¼‰jstackï¼šæŸ¥çœ‹javaè¿›ç¨‹å†…çº¿ç¨‹çš„å †æ ˆä¿¡æ¯ã€‚<br>ï¼ˆ3ï¼‰jmapï¼šç”¨äºç”Ÿæˆå †è½¬å­˜å¿«ç…§<br>ï¼ˆ4ï¼‰jhatï¼šç”¨äºåˆ†æjmapç”Ÿæˆçš„å †è½¬å­˜å¿«ç…§ï¼ˆä¸€èˆ¬ä¸æ¨èä½¿ç”¨ï¼Œè€Œæ˜¯ä½¿ç”¨Ecplise Memory Analyzerï¼‰<br>ï¼ˆ3ï¼‰jstatæ˜¯JVMç»Ÿè®¡ç›‘æµ‹å·¥å…·ã€‚å¯ä»¥ç”¨æ¥æ˜¾ç¤ºåƒåœ¾å›æ”¶ä¿¡æ¯ã€ç±»åŠ è½½ä¿¡æ¯ã€æ–°ç”Ÿä»£ç»Ÿè®¡ä¿¡æ¯ç­‰ã€‚<br>ï¼ˆ4ï¼‰VisualVMï¼šæ•…éšœå¤„ç†å·¥å…·</p><h3 id="ç”Ÿäº§ç¯å¢ƒJVMè°ƒä¼˜å…·ä½“æ­¥éª¤"><a href="#ç”Ÿäº§ç¯å¢ƒJVMè°ƒä¼˜å…·ä½“æ­¥éª¤" class="headerlink" title="ç”Ÿäº§ç¯å¢ƒJVMè°ƒä¼˜å…·ä½“æ­¥éª¤"></a>ç”Ÿäº§ç¯å¢ƒJVMè°ƒä¼˜å…·ä½“æ­¥éª¤</h3><h5 id="1-ç›‘æ§GCçš„çŠ¶æ€"><a href="#1-ç›‘æ§GCçš„çŠ¶æ€" class="headerlink" title="1.ç›‘æ§GCçš„çŠ¶æ€"></a>1.ç›‘æ§GCçš„çŠ¶æ€</h5><p>ä½¿ç”¨å„ç§JVMå·¥å…·ï¼ŒæŸ¥çœ‹å½“å‰æ—¥å¿—ï¼Œåˆ†æå½“å‰JVMå‚æ•°è®¾ç½®ï¼Œå¹¶ä¸”åˆ†æå½“å‰å †å†…å­˜å¿«ç…§å’Œgcæ—¥å¿—ï¼Œæ ¹æ®å®é™…çš„å„åŒºåŸŸå†…å­˜åˆ’åˆ†å’ŒGCæ‰§è¡Œæ—¶é—´ï¼Œè§‰å¾—æ˜¯å¦è¿›è¡Œä¼˜åŒ–ã€‚ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œç³»ç»Ÿå´©æºƒå‰çš„ä¸€äº›ç°è±¡ï¼šæ¯æ¬¡åƒåœ¾å›æ”¶çš„æ—¶é—´è¶Šæ¥è¶Šé•¿ï¼Œç”±ä¹‹å‰çš„10mså»¶é•¿åˆ°50mså·¦å³ï¼ŒFullGCçš„æ—¶é—´ä¹Ÿç”±ä¹‹å‰çš„0.5så»¶é•¿åˆ°4ã€5sï¼ŒFullGCçš„æ¬¡æ•°è¶Šæ¥è¶Šå¤šï¼Œæœ€é¢‘ç¹æ—¶éš”ä¸åˆ°1åˆ†é’Ÿå°±è¿›è¡Œä¸€æ¬¡FullGCï¼Œè€å¹´ä»£çš„å†…å­˜è¶Šæ¥è¶Šå¤§å¹¶ä¸”æ¯æ¬¡FGCåè€å¹´ä»£æ²¡æœ‰å†…å­˜é‡Šæ”¾ï¼Œä¹‹åç³»ç»Ÿä¼šæ— æ³•å“åº”æ–°çš„æ•°æ®ï¼Œé€æ¸åˆ°è¾¾OutMemoryErrorçš„ä¸´ç•Œå€¼ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦åˆ†æJVMå†…å­˜å¿«ç…§dumpã€‚</p><h5 id="2-ç”Ÿæˆå †çš„dumpæ–‡ä»¶"><a href="#2-ç”Ÿæˆå †çš„dumpæ–‡ä»¶" class="headerlink" title="2.ç”Ÿæˆå †çš„dumpæ–‡ä»¶"></a>2.ç”Ÿæˆå †çš„dumpæ–‡ä»¶</h5><p>é€šè¿‡JMXçš„MBeanç”Ÿæˆå½“å‰çš„Heapä¿¡æ¯ï¼Œå¤§å°ä¸ºä¸€ä¸ª3Gï¼ˆæ•´ä¸ªå †å¾—å¤§å°ï¼‰çš„hprofæ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰å¯åŠ¨JMXå¯ä»¥é€šè¿‡Javaçš„jmapå‘½ä»¤æ¥ç”Ÿæˆæ”¹æ–‡ä»¶ã€‚</p><h5 id="3-åˆ†ædumpæ–‡ä»¶"><a href="#3-åˆ†ædumpæ–‡ä»¶" class="headerlink" title="3.åˆ†ædumpæ–‡ä»¶"></a>3.åˆ†ædumpæ–‡ä»¶</h5><p>æ‰“å¼€è¿™ä¸ª3Gçš„å †ä¿¡æ¯æ–‡ä»¶ï¼Œæ˜¾ç„¶ä¸€èˆ¬çš„Windowsç³»ç»Ÿæ²¡æœ‰è¿™ä¹ˆå¤§çš„å†…å­˜ï¼Œå¿…é¡»å€ŸåŠ©é«˜é…ç½®çš„Linuxï¼Œå‡ ç§å·¥å…·æ‰“å¼€è¯¥æ–‡ä»¶ï¼šVisual VMã€IBM HeadpAnalyzerã€JDKè‡ªå¸¦çš„Hprofå·¥å…·ã€Matï¼ˆEclipseä¸“é—¨çš„é™æ€å†…å­˜åˆ†æå·¥å…·ï¼‰æ¨èä½¿ç”¨ã€‚Tipsï¼šæ–‡ä»¶å¤ªå¤§ï¼Œå»ºè®®ä½¿ç”¨Eclipseä¸“é—¨çš„é™æ€å†…å­˜å·¥å…·Matæ‰“å¼€åˆ†æã€‚</p><h5 id="4-åˆ†æç»“æœï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦ä¼˜åŒ–"><a href="#4-åˆ†æç»“æœï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦ä¼˜åŒ–" class="headerlink" title="4.åˆ†æç»“æœï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦ä¼˜åŒ–"></a>4.åˆ†æç»“æœï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦ä¼˜åŒ–</h5><p>å¦‚æœå„é¡¹å‚æ•°è®¾ç½®åˆç†ï¼Œç³»ç»Ÿæ²¡æœ‰è¶…æ—¶æ—¥å¿—å‡ºç°ï¼ŒGCé¢‘ç‡ä¸é«˜ï¼ŒGCè€—æ—¶ä¸é«˜ï¼Œé‚£ä¹ˆæ²¡æœ‰å¿…è¦è¿›è¡ŒGCä¼˜åŒ–ï¼Œå¦‚æœGCæ—¶é—´è¶…è¿‡1-3sï¼Œæˆ–è€…é¢‘ç¹GCï¼Œåˆ™å¿…é¡»ä¼˜åŒ–ã€‚æ³¨æ„ï¼š å¦‚æœæ»¡è¶³ä¸‹é¢çš„æŒ‡æ ‡ï¼Œ<strong>åˆ™ä¸€èˆ¬ä¸éœ€è¦è¿›è¡Œ GC ä¼˜åŒ–ï¼š</strong></p><blockquote><ul><li>MinorGC æ‰§è¡Œæ—¶é—´ä¸åˆ°50msï¼›</li><li>Minor GC æ‰§è¡Œä¸é¢‘ç¹ï¼Œçº¦10ç§’ä¸€æ¬¡ï¼›</li><li>Full GC æ‰§è¡Œæ—¶é—´ä¸åˆ°1sï¼›</li><li>Full GC æ‰§è¡Œé¢‘ç‡ä¸ç®—é¢‘ç¹ï¼Œä¸ä½äº10åˆ†é’Ÿ1æ¬¡ã€‚</li></ul></blockquote><h5 id="5-è°ƒæ•´GCç±»å‹å’Œå†…å­˜åˆ†é…"><a href="#5-è°ƒæ•´GCç±»å‹å’Œå†…å­˜åˆ†é…" class="headerlink" title="5.è°ƒæ•´GCç±»å‹å’Œå†…å­˜åˆ†é…"></a>5.è°ƒæ•´GCç±»å‹å’Œå†…å­˜åˆ†é…</h5><p>å¦‚æœå†…å­˜åˆ†é… è¿‡å¤§æˆ–è¿‡å°ï¼Œæˆ–è€…é‡‡ç”¨çš„GCæ”¶é›†å™¨æ¯”è¾ƒæ…¢ï¼Œåˆ™åº”è¯¥ä¼˜å…ˆè°ƒæ•´è¿™äº›å‚æ•°ï¼Œå¹¶ä¸”å…ˆæ‰¾1å°æˆ–å‡ å°æœºå™¨è¿›è¡Œbetaï¼Œç„¶åæ¯”è¾ƒä¼˜åŒ–è¿‡çš„æœºå™¨å’Œæ²¡æœ‰ä¼˜åŒ–çš„æœºå™¨çš„æ€§èƒ½å¯¹æ¯”ï¼Œå¹¶æœ‰é’ˆå¯¹æ€§çš„åšå‡ºæœ€åé€‰æ‹©ã€‚</p><h5 id="6-ä¸æ–­çš„åˆ†æå’Œè°ƒæ•´"><a href="#6-ä¸æ–­çš„åˆ†æå’Œè°ƒæ•´" class="headerlink" title="6.ä¸æ–­çš„åˆ†æå’Œè°ƒæ•´"></a>6.ä¸æ–­çš„åˆ†æå’Œè°ƒæ•´</h5><p>é€šè¿‡ä¸æ–­çš„è¯•éªŒå’Œè¯•é”™ï¼Œåˆ†æå¹¶æ‰¾å‡ºæœ€åˆé€‚çš„å‚æ•°ï¼Œå¦‚æœæ‰¾åˆ°äº†æœ€åˆé€‚çš„å‚æ•°ï¼Œåˆ™å°†è¿™äº›å‚æ•°åº”ç”¨åˆ°æ‰€æœ‰æœåŠ¡å™¨ã€‚</p><p>ä¸€èˆ¬é‡åˆ°é—®é¢˜å°±æ˜¯æ‰“å‡ºå½“æ—¶çš„çº¿ç¨‹ä¿¡æ¯ç”Ÿæˆdumpç„¶åæŸ¥å¼‚å¸¸ä»£ç ã€‚</p><p><a href="https://mp.weixin.qq.com/s?__biz=MjM5NzMyMjAwMA==&mid=2651485913&idx=1&sn=c40e03e94a7eb1f62baaa09173afc860&chksm=bd251aa68a5293b00dd0228451e19eef1e98684e5d596bbed2d647b8530e02eac2042580870e&scene=21#wechat_redirect">é™„ï¼šJVM æ€§èƒ½è°ƒä¼˜ç›‘æ§å·¥å…· jpsã€jstackã€jmapã€jhatã€jstatã€hprof ä½¿ç”¨è¯¦è§£</a></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://www.hollischuang.com/archives/6055">æˆ‘ç«Ÿç„¶è¢«â€åŒäº²å§”æ´¾â€ç»™è™äº†ï¼</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> é¢ç» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¤šçº¿ç¨‹é¢è¯•é¢˜</title>
      <link href="/posts/531c5825.html"/>
      <url>/posts/531c5825.html</url>
      
        <content type="html"><![CDATA[<hr><h2 id="è¿›ç¨‹ä¸çº¿ç¨‹"><a href="#è¿›ç¨‹ä¸çº¿ç¨‹" class="headerlink" title="è¿›ç¨‹ä¸çº¿ç¨‹"></a>è¿›ç¨‹ä¸çº¿ç¨‹</h2><h3 id="è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼Ÿ"><a href="#è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼Ÿ"></a>è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼Ÿ</h3><h3 id="è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€éƒ½æœ‰å“ªäº›ï¼Ÿ"><a href="#è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€éƒ½æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€éƒ½æœ‰å“ªäº›ï¼Ÿ"></a>è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€éƒ½æœ‰å“ªäº›ï¼Ÿ</h3><p>é‚£ä¹ˆä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ—¶å€™ï¼ŒCPUçš„å¼€é”€éƒ½å…·ä½“æœ‰å“ªäº›å‘¢ï¼Ÿå¼€é”€åˆ†æˆä¸¤ç§ï¼Œä¸€ç§æ˜¯ç›´æ¥å¼€é”€ã€ä¸€ç§æ˜¯é—´æ¥å¼€é”€ã€‚</p><p>ç›´æ¥å¼€é”€å°±æ˜¯åœ¨åˆ‡æ¢æ—¶ï¼Œcpuå¿…é¡»åšçš„äº‹æƒ…ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li><p>1ã€åˆ‡æ¢é¡µè¡¨å…¨å±€ç›®å½•</p></li><li><p>2ã€åˆ‡æ¢å†…æ ¸æ€å †æ ˆ</p></li><li><p>3ã€åˆ‡æ¢ç¡¬ä»¶ä¸Šä¸‹æ–‡ï¼ˆè¿›ç¨‹æ¢å¤å‰ï¼Œå¿…é¡»è£…å…¥å¯„å­˜å™¨çš„æ•°æ®ç»Ÿç§°ä¸ºç¡¬ä»¶ä¸Šä¸‹æ–‡ï¼‰</p></li><li><ul><li>ip(instruction pointer)ï¼šæŒ‡å‘å½“å‰æ‰§è¡ŒæŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤</li><li>bp(base pointer): ç”¨äºå­˜æ”¾æ‰§è¡Œä¸­çš„å‡½æ•°å¯¹åº”çš„æ ˆå¸§çš„æ ˆåº•åœ°å€</li><li>sp(stack poinger): ç”¨äºå­˜æ”¾æ‰§è¡Œä¸­çš„å‡½æ•°å¯¹åº”çš„æ ˆå¸§çš„æ ˆé¡¶åœ°å€</li><li>cr3:é¡µç›®å½•åŸºå€å¯„å­˜å™¨ï¼Œä¿å­˜é¡µç›®å½•è¡¨çš„ç‰©ç†åœ°å€</li><li>â€¦â€¦</li></ul></li><li><p>4ã€åˆ·æ–°TLB</p></li><li><p>5ã€ç³»ç»Ÿè°ƒåº¦å™¨çš„ä»£ç æ‰§è¡Œ</p></li></ul><p>é—´æ¥å¼€é”€ä¸»è¦æŒ‡çš„æ˜¯è™½ç„¶åˆ‡æ¢åˆ°ä¸€ä¸ªæ–°è¿›ç¨‹åï¼Œç”±äºå„ç§ç¼“å­˜å¹¶ä¸çƒ­ï¼Œé€Ÿåº¦è¿è¡Œä¼šæ…¢ä¸€äº›ã€‚å¦‚æœè¿›ç¨‹å§‹ç»ˆéƒ½åœ¨ä¸€ä¸ªCPUä¸Šè°ƒåº¦è¿˜å¥½ä¸€äº›ï¼Œå¦‚æœè·¨CPUçš„è¯ï¼Œä¹‹å‰çƒ­èµ·æ¥çš„TLBã€L1ã€L2ã€L3å› ä¸ºè¿è¡Œçš„è¿›ç¨‹å·²ç»å˜äº†ï¼Œæ‰€ä»¥ä»¥å±€éƒ¨æ€§åŸç†cacheèµ·æ¥çš„ä»£ç ã€æ•°æ®ä¹Ÿéƒ½æ²¡æœ‰ç”¨äº†ï¼Œå¯¼è‡´æ–°è¿›ç¨‹ç©¿é€åˆ°å†…å­˜çš„IOä¼šå˜å¤šã€‚å…¶å®æˆ‘ä»¬ä¸Šé¢çš„å®éªŒå¹¶æ²¡æœ‰å¾ˆå¥½åœ°æµ‹é‡åˆ°è¿™ç§æƒ…å†µï¼Œæ‰€ä»¥å®é™…çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€å¯èƒ½æ¯”3.5usè¦å¤§ã€‚</p><p>æƒ³äº†è§£æ›´è¯¦ç»†æ“ä½œè¿‡ç¨‹çš„åŒå­¦è¯·å‚è€ƒã€Šæ·±å…¥ç†è§£Linuxå†…æ ¸ã€‹ä¸­çš„ç¬¬ä¸‰ç« å’Œç¬¬ä¹ç« ã€‚</p><h3 id="çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢"><a href="#çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢" class="headerlink" title="çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢"></a>çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢</h3><p>ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼š</p><p>å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ä¸€èˆ¬çº¿ç¨‹çš„ä¸ªæ•°éƒ½å¤§äº CPU æ ¸å¿ƒçš„ä¸ªæ•°ï¼Œè€Œä¸€ä¸ª CPU æ ¸å¿ƒåœ¨ä»»æ„æ—¶åˆ»åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œä¸ºäº†è®©è¿™äº›çº¿ç¨‹éƒ½èƒ½å¾—åˆ°æœ‰æ•ˆæ‰§è¡Œï¼ŒCPU é‡‡å–çš„ç­–ç•¥æ˜¯ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…æ—¶é—´ç‰‡å¹¶è½®è½¬çš„å½¢å¼ã€‚å½“ä¸€ä¸ªçº¿ç¨‹çš„æ—¶é—´ç‰‡ç”¨å®Œçš„æ—¶å€™å°±ä¼šé‡æ–°å¤„äºå°±ç»ªçŠ¶æ€è®©ç»™å…¶ä»–çº¿ç¨‹ä½¿ç”¨ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å±äºä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚æ¦‚æ‹¬æ¥è¯´å°±æ˜¯ï¼šå½“å‰ä»»åŠ¡åœ¨æ‰§è¡Œå®Œ CPU æ—¶é—´ç‰‡åˆ‡æ¢åˆ°å¦ä¸€ä¸ªä»»åŠ¡ä¹‹å‰ä¼šå…ˆä¿å­˜è‡ªå·±çš„çŠ¶æ€ï¼Œä»¥ä¾¿ä¸‹æ¬¡å†åˆ‡æ¢å›è¿™ä¸ªä»»åŠ¡æ—¶ï¼Œå¯ä»¥å†åŠ è½½è¿™ä¸ªä»»åŠ¡çš„çŠ¶æ€ã€‚<strong>ä»»åŠ¡ä»ä¿å­˜åˆ°å†åŠ è½½çš„è¿‡ç¨‹å°±æ˜¯ä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢</strong>ã€‚</p><p>ä¸Šä¸‹æ–‡åˆ‡æ¢é€šå¸¸æ˜¯è®¡ç®—å¯†é›†å‹çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒéœ€è¦ç›¸å½“å¯è§‚çš„å¤„ç†å™¨æ—¶é—´ï¼Œåœ¨æ¯ç§’å‡ åä¸Šç™¾æ¬¡çš„åˆ‡æ¢ä¸­ï¼Œæ¯æ¬¡åˆ‡æ¢éƒ½éœ€è¦çº³ç§’é‡çº§çš„æ—¶é—´ã€‚æ‰€ä»¥ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢å¯¹ç³»ç»Ÿæ¥è¯´æ„å‘³ç€æ¶ˆè€—å¤§é‡çš„ CPU æ—¶é—´ï¼Œäº‹å®ä¸Šï¼Œå¯èƒ½æ˜¯æ“ä½œç³»ç»Ÿä¸­æ—¶é—´æ¶ˆè€—æœ€å¤§çš„æ“ä½œã€‚</p><p>Linux ç›¸æ¯”ä¸å…¶ä»–æ“ä½œç³»ç»Ÿï¼ˆåŒ…æ‹¬å…¶ä»–ç±» Unix ç³»ç»Ÿï¼‰æœ‰å¾ˆå¤šçš„ä¼˜ç‚¹ï¼Œå…¶ä¸­æœ‰ä¸€é¡¹å°±æ˜¯ï¼Œå…¶ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œæ¨¡å¼åˆ‡æ¢çš„æ—¶é—´æ¶ˆè€—éå¸¸å°‘ã€‚</p><h2 id="åŸå­æ€§ã€æœ‰åºæ€§å’Œå¯è§æ€§"><a href="#åŸå­æ€§ã€æœ‰åºæ€§å’Œå¯è§æ€§" class="headerlink" title="åŸå­æ€§ã€æœ‰åºæ€§å’Œå¯è§æ€§"></a>åŸå­æ€§ã€æœ‰åºæ€§å’Œå¯è§æ€§</h2><h3 id="finalå…³é”®å­—çš„å¯è§æ€§"><a href="#finalå…³é”®å­—çš„å¯è§æ€§" class="headerlink" title="finalå…³é”®å­—çš„å¯è§æ€§"></a>finalå…³é”®å­—çš„å¯è§æ€§</h3><h2 id="æ‚²è§‚é”å’Œä¹è§‚é”"><a href="#æ‚²è§‚é”å’Œä¹è§‚é”" class="headerlink" title="æ‚²è§‚é”å’Œä¹è§‚é”"></a>æ‚²è§‚é”å’Œä¹è§‚é”</h2><h3 id="CASæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#CASæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="CASæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a>CASæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h3><p>CASçš„ç¼ºç‚¹æœ‰å¦‚ABAé—®é¢˜ï¼Œè‡ªæ—‹é”æ¶ˆè€—é—®é¢˜ã€å¤šå˜é‡å…±äº«ä¸€è‡´æ€§é—®é¢˜ï¼š</p><p>1.<strong>ABA</strong>ï¼š<br>é—®é¢˜æè¿°ï¼šçº¿ç¨‹t1å°†å®ƒçš„å€¼ä»Aå˜ä¸ºBï¼Œå†ä»Bå˜ä¸ºAã€‚åŒæ—¶æœ‰çº¿ç¨‹t2è¦å°†å€¼ä»Aå˜ä¸ºCã€‚ä½†CASæ£€æŸ¥çš„æ—¶å€™ä¼šå‘ç°æ²¡æœ‰æ”¹å˜ï¼Œä½†æ˜¯å®è´¨ä¸Šå®ƒå·²ç»å‘ç”Ÿäº†æ”¹å˜ ã€‚å¯èƒ½ä¼šé€ æˆæ•°æ®çš„ç¼ºå¤±ã€‚</p><p>è§£å†³æ–¹æ³•ï¼šCASè¿˜æ˜¯ç±»ä¼¼äºä¹è§‚é”ï¼ŒåŒæ•°æ®ä¹è§‚é”çš„æ–¹å¼ç»™å®ƒåŠ ä¸€ä¸ªç‰ˆæœ¬å·æˆ–è€…æ—¶é—´æˆ³ï¼Œå¦‚AtomicStampedReference</p><p>2.<strong>è‡ªæ—‹æ¶ˆè€—èµ„æº</strong>ï¼š<br>é—®é¢˜æè¿°ï¼šå¤šä¸ªçº¿ç¨‹äº‰å¤ºåŒä¸€ä¸ªèµ„æºæ—¶ï¼Œå¦‚æœè‡ªæ—‹ä¸€ç›´ä¸æˆåŠŸï¼Œå°†ä¼šä¸€ç›´å ç”¨CPUã€‚</p><p>è§£å†³æ–¹æ³•ï¼šç ´åæ‰foræ­»å¾ªç¯ï¼Œå½“è¶…è¿‡ä¸€å®šæ—¶é—´æˆ–è€…ä¸€å®šæ¬¡æ•°æ—¶ï¼Œreturné€€å‡ºã€‚</p><p>JDK8æ–°å¢çš„LongAddrå’ŒConcurrentHashMapç±»ä¼¼çš„æ–¹æ³•ã€‚å½“å¤šä¸ªçº¿ç¨‹ç«äº‰æ—¶ï¼Œå°†ç²’åº¦å˜å°ï¼Œå°†ä¸€ä¸ªå˜é‡æ‹†åˆ†ä¸ºå¤šä¸ªå˜é‡ï¼Œè¾¾åˆ°å¤šä¸ªçº¿ç¨‹è®¿é—®å¤šä¸ªèµ„æºçš„æ•ˆæœï¼Œæœ€åå†è°ƒç”¨sumæŠŠå®ƒåˆèµ·æ¥ã€‚è™½ç„¶baseå’Œcellséƒ½æ˜¯volatileä¿®é¥°çš„ï¼Œä½†æ„Ÿè§‰è¿™ä¸ªsumæ“ä½œæ²¡æœ‰åŠ é”ï¼Œå¯èƒ½sumçš„ç»“æœä¸æ˜¯é‚£ä¹ˆç²¾ç¡®ã€‚</p><p>3.<strong>å¤šå˜é‡å…±äº«ä¸€è‡´æ€§é—®é¢˜</strong>ï¼š<br>è§£å†³æ–¹æ³•ï¼š CASæ“ä½œæ˜¯é’ˆå¯¹ä¸€ä¸ªå˜é‡çš„ï¼Œå¦‚æœå¯¹å¤šä¸ªå˜é‡æ“ä½œï¼Œè§£å†³æ–¹æ¡ˆå¦‚ä¸‹</p><ol><li>å¯ä»¥åŠ é”æ¥è§£å†³</li><li>å°è£…æˆå¯¹è±¡ç±»è§£å†³</li></ol><h2 id="Javaå†…å­˜æ¨¡å‹"><a href="#Javaå†…å­˜æ¨¡å‹" class="headerlink" title="Javaå†…å­˜æ¨¡å‹"></a>Javaå†…å­˜æ¨¡å‹</h2><h3 id="happens-beforeç®€ä»‹"><a href="#happens-beforeç®€ä»‹" class="headerlink" title="happens-beforeç®€ä»‹"></a>happens-beforeç®€ä»‹</h3><p>åœ¨JMMä¸­ï¼Œå¦‚æœä¸€ä¸ªæ“ä½œæ‰§è¡Œçš„ç»“æœéœ€è¦å¯¹å¦ä¸€ä¸ªæ“ä½œå¯è§ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´å¿…é¡»è¦å­˜åœ¨happens-beforeå…³ç³»ã€‚è¿™é‡Œæåˆ°çš„ä¸¤ä¸ªæ“ä½œæ—¢å¯ä»¥æ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹é‡Œï¼Œä¹Ÿå¯ä»¥æ˜¯åœ¨ä¸åŒçš„çº¿ç¨‹é‡Œã€‚</p><p>ä¸ç¨‹åºå‘˜å¯†åˆ‡ç›¸å…³çš„happens-beforeè§„åˆ™å¦‚ä¸‹ï¼š</p><ul><li>ç¨‹åºé¡ºåºè§„åˆ™ï¼šä¸€ä¸ªçº¿ç¨‹ä¸­çš„æ¯ä¸ªæ“ä½œï¼Œhappens-beforeäºè¯¥çº¿ç¨‹ä¸­çš„ä»»æ„åç»­æ“ä½œã€‚</li><li>ç›‘è§†å™¨é”è§„åˆ™ï¼šå¯¹ä¸€ä¸ªé”çš„è§£é”ï¼Œhappens-beforeäºéšåå¯¹è¿™ä¸ªé”çš„åŠ é”ã€‚</li><li>volatileå˜é‡è§„åˆ™ï¼šå¯¹ä¸€ä¸ªvolatileåŸŸçš„å†™ï¼Œhappens-beforeäºä»»æ„åç»­å¯¹è¿™ä¸ªvolatileåŸŸçš„è¯»ã€‚</li><li>ä¼ é€’æ€§ï¼šå¦‚æœA happens-before Bï¼Œä¸”B happens-before Cï¼Œé‚£ä¹ˆA happens-before Cã€‚</li></ul><blockquote><p><strong>æ³¨æ„ï¼š</strong>ä¸¤ä¸ªæ“ä½œä¹‹é—´å…·æœ‰happens-beforeå…³ç³»ï¼Œå¹¶ä¸æ„å‘³ç€å‰ä¸€ä¸ªæ“ä½œå¿…é¡»è¦åœ¨åä¸€ä¸ªæ“ä½œä¹‹å‰æ‰§è¡Œï¼happens-beforeä»…ä»…è¦æ±‚å‰ä¸€ä¸ªæ“ä½œï¼ˆæ‰§è¡Œçš„ç»“æœï¼‰å¯¹åä¸€ä¸ªæ“ä½œå¯è§ï¼Œä¸”å‰ä¸€ä¸ªæ“ä½œæŒ‰é¡ºåºæ’åœ¨ç¬¬äºŒä¸ªæ“ä½œä¹‹å‰ï¼ˆthe first is visible to and ordered before the secondï¼‰ã€‚</p></blockquote><h3 id="å•çº¿ç¨‹ã€å¤šçº¿ç¨‹åœ¨å•æ ¸CPUã€å¤šæ ¸CPUä¸­çš„å½±å“"><a href="#å•çº¿ç¨‹ã€å¤šçº¿ç¨‹åœ¨å•æ ¸CPUã€å¤šæ ¸CPUä¸­çš„å½±å“" class="headerlink" title="å•çº¿ç¨‹ã€å¤šçº¿ç¨‹åœ¨å•æ ¸CPUã€å¤šæ ¸CPUä¸­çš„å½±å“"></a>å•çº¿ç¨‹ã€å¤šçº¿ç¨‹åœ¨å•æ ¸CPUã€å¤šæ ¸CPUä¸­çš„å½±å“</h3><p>æˆ‘ä»¬åˆ†åˆ«æ¥åˆ†æä¸‹å•çº¿ç¨‹ã€å¤šçº¿ç¨‹åœ¨å•æ ¸CPUã€å¤šæ ¸CPUä¸­çš„å½±å“ã€‚</p><p><strong>å•çº¿ç¨‹ã€‚</strong>cpuæ ¸å¿ƒçš„ç¼“å­˜åªè¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®ã€‚ç¼“å­˜ç‹¬å ï¼Œä¸ä¼šå‡ºç°è®¿é—®å†²çªç­‰é—®é¢˜ã€‚</p><p><strong>å•æ ¸CPUï¼Œå¤šçº¿ç¨‹ã€‚</strong>è¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹ä¼šåŒæ—¶è®¿é—®è¿›ç¨‹ä¸­çš„å…±äº«æ•°æ®ï¼ŒCPUå°†æŸå—å†…å­˜åŠ è½½åˆ°ç¼“å­˜åï¼Œä¸åŒçº¿ç¨‹åœ¨è®¿é—®ç›¸åŒçš„ç‰©ç†åœ°å€çš„æ—¶å€™ï¼Œéƒ½ä¼šæ˜ å°„åˆ°ç›¸åŒçš„ç¼“å­˜ä½ç½®ï¼Œè¿™æ ·å³ä½¿å‘ç”Ÿçº¿ç¨‹çš„åˆ‡æ¢ï¼Œç¼“å­˜ä»ç„¶ä¸ä¼šå¤±æ•ˆã€‚ä½†ç”±äºä»»ä½•æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œï¼Œå› æ­¤ä¸ä¼šå‡ºç°ç¼“å­˜è®¿é—®å†²çªã€‚</p><p><strong>å¤šæ ¸CPUï¼Œå¤šçº¿ç¨‹ã€‚</strong>æ¯ä¸ªæ ¸éƒ½è‡³å°‘æœ‰ä¸€ä¸ªL1 ç¼“å­˜ã€‚å¤šä¸ªçº¿ç¨‹è®¿é—®è¿›ç¨‹ä¸­çš„æŸä¸ªå…±äº«å†…å­˜ï¼Œä¸”è¿™å¤šä¸ªçº¿ç¨‹åˆ†åˆ«åœ¨ä¸åŒçš„æ ¸å¿ƒä¸Šæ‰§è¡Œï¼Œåˆ™æ¯ä¸ªæ ¸å¿ƒéƒ½ä¼šåœ¨å„è‡ªçš„caeheä¸­ä¿ç•™ä¸€ä»½å…±äº«å†…å­˜çš„ç¼“å†²ã€‚ç”±äºå¤šæ ¸æ˜¯å¯ä»¥å¹¶è¡Œçš„ï¼Œå¯èƒ½ä¼šå‡ºç°å¤šä¸ªçº¿ç¨‹åŒæ—¶å†™å„è‡ªçš„ç¼“å­˜çš„æƒ…å†µï¼Œè€Œå„è‡ªçš„cacheä¹‹é—´çš„æ•°æ®å°±æœ‰å¯èƒ½ä¸åŒã€‚</p><p>åœ¨CPUå’Œä¸»å­˜ä¹‹é—´å¢åŠ ç¼“å­˜ï¼Œåœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸‹å°±å¯èƒ½å­˜åœ¨<strong>ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å¤šæ ¸CPUä¸­ï¼Œæ¯ä¸ªæ ¸çš„è‡ªå·±çš„ç¼“å­˜ä¸­ï¼Œå…³äºåŒä¸€ä¸ªæ•°æ®çš„ç¼“å­˜å†…å®¹å¯èƒ½ä¸ä¸€è‡´ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> é¢ç» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2021é¢ç»</title>
      <link href="/posts/416557c5.html"/>
      <url>/posts/416557c5.html</url>
      
        <content type="html"><![CDATA[<hr><h3 id="å®å’šä¹°èœ"><a href="#å®å’šä¹°èœ" class="headerlink" title="å®å’šä¹°èœ"></a>å®å’šä¹°èœ</h3><ul><li><p>hashmapçš„æ‰©å®¹è¿‡ç¨‹</p></li><li><p>å•å‘é“¾è¡¨å¦‚ä½•åˆ¤æ–­æœ‰ç¯</p><blockquote><p>HashSetéå†å’Œå¿«æ…¢æŒ‡é’ˆ</p></blockquote></li><li><p>å¦‚ä½•æ‰¾å‡ºä¸€ä¸ªæ•°ç»„é‡å¤å…ƒç´ æœ€å¤šçš„å‰Kä¸ªå…ƒç´ </p><blockquote><p>TopKé—®é¢˜ï¼Œå †æ’åºï¼Œæ—¶é—´å¤æ‚åº¦nLogK</p></blockquote></li><li><p>MySQLä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‘ç”Ÿæ­»é”ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ</p><blockquote><p>ä¸¾ä¸ªä¾‹å­ï¼šäº‹åŠ¡AæŒ‰ç…§å…ˆåé¡ºåºå»æ›´æ–°id&#x3D;1å’Œid&#x3D;2çš„è®°å½•ï¼Œäº‹åŠ¡BåŒä¸€æ—¶é—´æŒ‰ç…§å…ˆåé¡ºåºå»æ›´æ–°id&#x3D;2å’Œid&#x3D;1çš„è®°å½•ï¼Œå› ä¸ºè¡Œé”æ˜¯ä¸¤é˜¶æ®µåè®®ï¼ŒAè·å¾—id&#x3D;1çš„è¡Œé”ä¸ä¼šé©¬ä¸Šé‡Šæ”¾ï¼Œæ­¤æ—¶Bä¼šç­‰å¾…Aé‡Šæ”¾id&#x3D;1çš„è¡Œé”ï¼Œè€ŒAä¼šç­‰å¾…Bé‡Šæ”¾id&#x3D;2çš„è¡Œé”ï¼Œè¿™æ ·å°±å½¢æˆäº†æ­»é”ã€‚<br><strong>å¦‚ä½•è§£å†³ï¼š</strong></p><ul><li>ä¸€ç§ç­–ç•¥æ˜¯ï¼Œç›´æ¥è¿›å…¥ç­‰å¾…ï¼Œç›´åˆ°è¶…æ—¶ã€‚è¿™ä¸ªè¶…æ—¶æ—¶é—´å¯ä»¥é€šè¿‡å‚æ•°innodb_lock_wait_timeoutæ¥è®¾ç½®ã€‚</li><li>å¦ä¸€ç§ç­–ç•¥æ˜¯ï¼Œå‘èµ·æ­»é”æ£€æµ‹ï¼Œå‘ç°æ­»é”åï¼Œä¸»åŠ¨å›æ»šæ­»é”é“¾æ¡ä¸­çš„æŸä¸€ä¸ªäº‹åŠ¡ï¼Œè®©å…¶ä»–äº‹åŠ¡å¾—ä»¥ç»§ç»­æ‰§è¡Œã€‚å°†å‚æ•°innodb_deadlock_detectè®¾ç½®ä¸ºonï¼Œè¡¨ç¤ºå¼€å¯è¿™ä¸ªé€»è¾‘ã€‚</li></ul></blockquote></li><li><p>ArrayListçš„containsæ–¹æ³•å’ŒHashSetçš„containsæ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦å„æ˜¯å¤šå°‘</p><blockquote><p>O(n)å’ŒO(1ï¼‰</p></blockquote></li><li><p>2ä¸ªçº¿ç¨‹ï¼ŒAç”Ÿäº§æ•°æ®ï¼ŒBæ¶ˆè´¹æ•°æ®ï¼Œæœ‰å“ªå‡ ç§å®ç°å½¢å¼ï¼ˆä½¿ç”¨LinkedListå®ç°æœ‰å“ªäº›éœ€è¦æ³¨æ„çš„ï¼Œçº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¦‚ä½•è§£å†³ï¼šåŠ é”ï¼‰</p></li><li><p>ä¸€ä¸ªæŠ½å¥–ç³»ç»Ÿï¼Œå¥–å“1çš„æ¦‚ç‡æ˜¯10%ï¼Œå¥–å“2çš„æ¦‚ç‡æ˜¯20%ï¼Œä¸ä¸­å¥–çš„æ¦‚ç‡æ˜¯70%ï¼Œç®—æ³•å¦‚ä½•å®ç°ï¼Ÿ</p><blockquote><p>éšæœºæ•°å’ŒåŒºé—´</p></blockquote></li><li><p>ç¼“å­˜ä¸€è‡´æ€§å¦‚ä½•ä¿è¯ï¼Ÿ</p><blockquote><p>æœ€å¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯å…ˆæ›´æ–°æ•°æ®åº“å†åˆ é™¤ç¼“å­˜ï¼ˆåœ¨æç«¯æƒ…å†µä¸‹ä¹Ÿä¼šæœ‰é—®é¢˜ï¼Œæ¯”å¦‚è¯´Bçº¿ç¨‹æ›´æ–°æ•°æ®çš„èŠ‚ç‚¹ï¼Œç¼“å­˜æ­£å¥½å¤±æ•ˆï¼Œæ­¤æ—¶çº¿ç¨‹Aè¯»å–åˆ°äº†æ—§å€¼ï¼ŒéšåBæ“ä½œæ•°æ®åº“å®Œæˆæ›´æ–°å¹¶ä¸”åˆ é™¤ç¼“å­˜ä¹‹åï¼ŒAå†æŠŠæ—§å€¼å†™å…¥ç¼“å­˜ï¼Œæ­¤æ—¶å†å»è¯·æ±‚æ‹¿åˆ°çš„ä¼šæ˜¯è„æ•°æ®ï¼Œè¿™ç§æ¦‚ç‡éå¸¸ä½ï¼ŒåŸºæœ¬å¯ä»¥å¿½ç•¥ï¼‰</p></blockquote></li><li><p>Dubbo IOçº¿ç¨‹æ± å’Œä¸šåŠ¡çº¿ç¨‹æ± æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿé»˜è®¤æ˜¯å“ªç§çº¿ç¨‹æ± ï¼ˆFixedï¼‰</p></li><li><p>ä½¿ç”¨Dubboæœ‰æ²¡æœ‰é‡åˆ°ä»€ä¹ˆå‘ï¼Ÿ</p><blockquote><ul><li>çˆ¶å­ç±»æœ‰ç›¸åŒå±æ€§æ—¶å€¼ä¸¢å¤±ï¼šhessianåºåˆ—åŒ–é—®é¢˜</li><li>è‡ªå®šä¹‰å¼‚å¸¸è¢«åŒ…è£…æˆRuntimeException</li><li>Data length too large</li><li>çº¿ç¨‹è€—å°½ï¼šProvideré»˜è®¤æ˜¯fixedçº¿ç¨‹æ± ï¼Œä¸”çº¿ç¨‹æ•°ä¸º200</li></ul><p><a href="https://blog.csdn.net/u013256816/article/details/102674846"><strong>å…·ä½“å‚è€ƒé“¾æ¥</strong></a></p></blockquote></li><li><p>ç½‘å…³æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ï¼Ÿä¸ºä»€ä¹ˆè¦ç”¨ç½‘å…³ï¼Ÿ</p></li><li><p>ä¹è§‚é”å’Œæ‚²è§‚é”æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä¹è§‚é”æœ‰å“ªäº›å®ç°æ–¹å¼ï¼Ÿï¼ˆç‰ˆæœ¬å·æœºåˆ¶å’ŒCASç®—æ³•ï¼‰</p><blockquote><p>ç‰ˆæœ¬å·æœºåˆ¶å’ŒCASç®—æ³•</p></blockquote></li><li><p>çº¿ç¨‹æ± ä¸»è¦æœ‰å“ªäº›ä¸œè¥¿ï¼Ÿçº¿ç¨‹æ± ä¸­å¦‚æœæ²¡æœ‰ä»»åŠ¡ï¼Œä¼šæ˜¯ä»€ä¹ˆçŠ¶æ€ï¼Ÿ</p></li><li><p>é¡¹ç›®ä¸­é‡åˆ°çš„æŠ€æœ¯éš¾é¢˜ï¼Œæ˜¯å¦‚ä½•è§£å†³çš„ï¼Ÿ</p></li><li><p>åˆ†åº“åˆ†è¡¨ä¸€äº›è¿è¡¨é—®é¢˜å’Œæ¡ä»¶æŸ¥è¯¢æ˜¯å¦‚ä½•è§£å†³çš„ï¼Ÿ</p><blockquote><p>åˆ†ä¸¤æ¬¡æŸ¥è¯¢ï¼Œç¬¬ä¸€æ¬¡æŠŠè”è¡¨çš„idæŸ¥å‡ºæ¥ï¼Œé€šè¿‡è¿™äº›idå†åšä¸€æ¬¡æŸ¥è¯¢</p></blockquote></li></ul><span id="more"></span><h3 id="ä¸œæ–¹å¤´æ¡"><a href="#ä¸œæ–¹å¤´æ¡" class="headerlink" title="ä¸œæ–¹å¤´æ¡"></a>ä¸œæ–¹å¤´æ¡</h3><ul><li><p>æ‚²è§‚é”å’Œä¹è§‚é”çš„ä½¿ç”¨åœºæ™¯</p><blockquote><p>è¯»å¤šå†™å°‘çš„åœºæ™¯ç”¨ä¹è§‚é”ï¼Œè¯»å°‘å†™å¤šçš„åœºæ™¯ç”¨æ‚²è§‚é”</p></blockquote></li><li><p>redisçº¿ä¸Šä½¿ç”¨åº”è¯¥æ³¨æ„ä»€ä¹ˆï¼Ÿå“ªäº›å‘½ä»¤ä¼šå¯¼è‡´å µå¡</p><blockquote><p>keysï¼Œé¿å…ä½¿ç”¨keysï¼Œç”¨scanæ›¿ä»£ï¼Œscanæœ‰ä¸ªé—®é¢˜å°±æ˜¯å¯èƒ½ä¼šæŸ¥åˆ°é‡å¤çš„keyï¼Œæˆ‘ä»¬åœ¨å†…å­˜é‡Œå»é‡å°±å¥½äº†</p></blockquote></li><li><p>è®¾è®¡ä¸€ä¸ªç¨‹åºï¼Œå°†1så†…è®¿é—®è¶…è¿‡ä¸‰æ¬¡çš„IPç¦æ‰</p></li></ul><h3 id="ç›’é©¬"><a href="#ç›’é©¬" class="headerlink" title="ç›’é©¬"></a>ç›’é©¬</h3><ul><li><p>å¦‚ä½•é¿å…æ­»é”</p><blockquote><ul><li>é¿å…ä¸€ä¸ªçº¿ç¨‹åŒæ—¶è·å–å¤šä¸ªé”ã€‚</li><li>é¿å…ä¸€ä¸ªçº¿ç¨‹åœ¨é”å†…åŒæ—¶å ç”¨å¤šä¸ªèµ„æºï¼Œå°½é‡ä¿è¯æ¯ä¸ªé”åªå ç”¨ä¸€ä¸ªèµ„æºã€‚</li><li>å°è¯•ä½¿ç”¨å®šæ—¶é”ï¼Œä½¿ç”¨lock.tryLock(timeout) æ¥æ›¿ä»£ä½¿ç”¨å†…éƒ¨é”æœºåˆ¶ã€‚</li><li>å¯¹äºæ•°æ®åº“é”ï¼ŒåŠ é”å’Œè§£é”å¿…é¡»åœ¨ä¸€ä¸ªæ•°æ®åº“é“¾æ¥é‡Œï¼Œå¦åˆ™ä¼šå‡ºç°è§£é”å¤±è´¥çš„æƒ…å†µã€‚</li></ul></blockquote></li><li><p>CHMï¼ˆConcurrentHashMapï¼‰1.7ç‰ˆæœ¬segmentæ•°ç»„é•¿åº¦æ˜¯å¤šå°‘ï¼ˆæœ€å°16ï¼Œæ ¹æ®ä¸åŒå‹å·CPUå¯èƒ½æœ‰æ‰€ä¸åŒï¼‰</p></li><li><p>åºåˆ—åŒ–åŸç†æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦åºåˆ—åŒ–</p></li><li><p>JVMå¦‚ä½•ç»™å¯¹è±¡åˆ†é…å†…å­˜</p><blockquote><p>å½“åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œéœ€è¦ç»™æ–°ç”Ÿå¯¹è±¡åˆ†é…å†…å­˜ï¼Œè€Œåˆ†é…å†…å­˜ å°±æ˜¯åœ¨å †ä¸Šè¿›è¡Œåˆ†é…ã€‚åœ¨å †ä¸Šè¿›è¡Œåˆ†é…çš„æ—¶å€™ï¼Œå¯èƒ½åœ¨æ–°ç”Ÿä»£çš„EdenåŒºä¸Šï¼Œä¹Ÿå¯èƒ½åœ¨è€å¹´ä»£ä¸­åˆ†é…ï¼Œå…·ä½“çš„åˆ†é…ç­–ç•¥éœ€è¦å‚è€ƒä¸€äº›å†…å­˜åˆ†é…çš„è§„åˆ™ï¼š</p><ol><li>ä¼˜å…ˆåœ¨edenåŒºåˆ†é…ï¼šå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ–°ç”Ÿå¯¹è±¡éƒ½åœ¨æ–°ç”Ÿä»£çš„EdenåŒºè¿›è¡Œå†…å­˜åˆ†é…ï¼Œå½“æ–°ç”Ÿä»£EdenåŒºæ²¡è¶³å¤Ÿç©ºé—´çš„æ—¶å€™ï¼Œä¼šè§¦å‘ä¸€æ¬¡Minor GC</li><li>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼šå½“ä¸€ä¸ªæ–°ç”Ÿå¯¹è±¡éœ€è¦å¤§é‡è¿ç»­ç©ºé—´å¹¶ä¸”å¯¹è±¡æ‰€éœ€ç©ºé—´å¤§äº-XX:PretenureSizeThresholdå‚æ•°å€¼çš„æ—¶å€™ï¼Œè¿™ä¸ªå¯¹è±¡å°†åœ¨è€å¹´ä»£åˆ†é…å†…å­˜ç©ºé—´ï¼Œè¿™æ ·å¯ä»¥é¿å…æ–°ç”Ÿä»£å‘ç”Ÿå¤§é‡çš„å†…å­˜å¤åˆ¶ã€‚</li><li>å¹´é¾„å¤§çš„å­˜æ´»å¯¹è±¡è¿›å…¥è€å¹´ä»£ï¼šåœ¨æ–°ç”Ÿä»£æ¯ç»è¿‡ä¸€æ¬¡Minor GCï¼Œå­˜æ´»å¯¹è±¡çš„å¹´é¾„éƒ½ä¼šå¢åŠ ä¸€å²ï¼Œå½“å¹´é¾„è¶…è¿‡-XX:MaxTenuringThresholdå‚æ•°å€¼çš„æ—¶å€™ï¼Œè¿™ä¸ªå¯¹è±¡å°†è¿›å…¥è€å¹´ä»£</li></ol><p><strong>åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤æ–­</strong>ï¼šå¦‚æœæ–°ç”Ÿä»£Survivorç©ºé—´ä¸­ç›¸åŒå¹´é¾„æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œå¤§äºSurvivorç©ºé—´çš„ä¸€åŠï¼Œå¹´é¾„ç­‰äºæˆ–è¶…è¿‡è¯¥å¹´é¾„çš„å¯¹è±¡å°†ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œä¸å†ç­‰å¾…å¹´é¾„è¶…è¿‡-XX:MaxTenuringThresholdå‚æ•°å€¼çš„æ¡ä»¶è¿›å…¥è€å¹´ä»£ã€‚</p></blockquote></li><li><p>å¦‚ä½•è§£å†³è¶…å–é—®é¢˜</p></li></ul><h3 id="å¹³å®‰é‡‘æœ"><a href="#å¹³å®‰é‡‘æœ" class="headerlink" title="å¹³å®‰é‡‘æœ"></a>å¹³å®‰é‡‘æœ</h3><ul><li><p>SQLè¯­å¥çš„æ‰§è¡Œé¡ºåº</p><blockquote><p>SQLçš„æ‰§è¡Œé¡ºåºï¼šfromâ€”whereâ€“group byâ€”havingâ€”selectâ€”order by</p></blockquote></li></ul><h3 id="æŒé—¨ä¸€å¯¹ä¸€"><a href="#æŒé—¨ä¸€å¯¹ä¸€" class="headerlink" title="æŒé—¨ä¸€å¯¹ä¸€"></a>æŒé—¨ä¸€å¯¹ä¸€</h3><ul><li><p>è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«</p><blockquote><ol><li>è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿèµ„æºåˆ†é…çš„æœ€å°å•ä½ï¼Œçº¿ç¨‹æ˜¯CPUä»»åŠ¡è°ƒåº¦çš„æœ€å°å•ä½ã€‚ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥è¿›ç¨‹å’Œçº¿ç¨‹éƒ½æ˜¯ä¸€ä¸ªæ—¶é—´æ®µçš„æè¿°ï¼Œæ˜¯CPUå·¥ä½œæ—¶é—´æ®µçš„æè¿°ï¼Œä¸è¿‡æ˜¯é¢—ç²’å¤§å°ä¸åŒã€‚</li><li>ä¸åŒè¿›ç¨‹é—´æ•°æ®å¾ˆéš¾å…±äº«ï¼ŒåŒä¸€è¿›ç¨‹ä¸‹ä¸åŒçº¿ç¨‹é—´æ•°æ®å¾ˆæ˜“å…±äº«ã€‚</li><li>æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„ä»£ç å’Œæ•°æ®ç©ºé—´ï¼Œè¿›ç¨‹è¦æ¯”çº¿ç¨‹æ¶ˆè€—æ›´å¤šçš„è®¡ç®—æœºèµ„æºã€‚çº¿ç¨‹å¯ä»¥çœ‹åšè½»é‡çº§çš„è¿›ç¨‹ï¼ŒåŒä¸€ç±»çº¿ç¨‹å…±äº«ä»£ç å’Œæ•°æ®ç©ºé—´ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„è¿è¡Œæ ˆå’Œç¨‹åºè®¡æ•°å™¨ï¼Œçº¿ç¨‹ä¹‹é—´åˆ‡æ¢çš„å¼€é”€å°ã€‚</li><li>è¿›ç¨‹é—´ä¸ä¼šç›¸äº’å½±å“ï¼Œä¸€ä¸ªçº¿ç¨‹æŒ‚æ‰å°†å¯¼è‡´æ•´ä¸ªè¿›ç¨‹æŒ‚æ‰ã€‚</li><li>ç³»ç»Ÿåœ¨è¿è¡Œçš„æ—¶å€™ä¼šä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…ä¸åŒçš„å†…å­˜ç©ºé—´ï¼›è€Œå¯¹çº¿ç¨‹è€Œè¨€ï¼Œé™¤äº†CPUå¤–ï¼Œç³»ç»Ÿä¸ä¼šä¸ºçº¿ç¨‹åˆ†é…å†…å­˜ï¼ˆçº¿ç¨‹æ‰€ä½¿ç”¨çš„èµ„æºæ¥è‡ªå…¶æ‰€å±è¿›ç¨‹çš„èµ„æºï¼‰ï¼Œçº¿ç¨‹ç»„ä¹‹é—´åªèƒ½å…±äº«èµ„æºã€‚</li></ol></blockquote></li><li><p>SpringBeançš„ç”Ÿå‘½å‘¨æœŸ</p><blockquote><p>SpringBean ç”Ÿå‘½å‘¨æœŸç®€å•æ¦‚æ‹¬ä¸º4ä¸ªé˜¶æ®µï¼š</p><ol><li>å®ä¾‹åŒ–ï¼Œåˆ›å»ºä¸€ä¸ªBeanå¯¹è±¡</li><li>å¡«å……å±æ€§ï¼Œä¸ºå±æ€§èµ‹å€¼</li><li>åˆå§‹åŒ–<ul><li>å¦‚æœå®ç°äº†<code>xxxAware</code>æ¥å£ï¼Œé€šè¿‡ä¸åŒç±»å‹çš„Awareæ¥å£æ‹¿åˆ°Springå®¹å™¨çš„èµ„æº</li><li>å¦‚æœå®ç°äº†BeanPostProcessoræ¥å£ï¼Œåˆ™ä¼šå›è°ƒè¯¥æ¥å£çš„<code>postProcessBeforeInitialzation</code>å’Œ<code>postProcessAfterInitialization</code>æ–¹æ³•</li><li>å¦‚æœé…ç½®äº†<code>init-method</code>æ–¹æ³•ï¼Œåˆ™ä¼šæ‰§è¡Œ<code>init-method</code>é…ç½®çš„æ–¹æ³•</li></ul></li><li>é”€æ¯<ul><li>å®¹å™¨å…³é—­åï¼Œå¦‚æœBeanå®ç°äº†<code>DisposableBean</code>æ¥å£ï¼Œåˆ™ä¼šå›è°ƒè¯¥æ¥å£çš„<code>destroy</code>æ–¹æ³•</li><li>å¦‚æœé…ç½®äº†<code>destroy-method</code>æ–¹æ³•ï¼Œåˆ™ä¼šæ‰§è¡Œ<code>destroy-method</code>é…ç½®çš„æ–¹æ³•</li></ul></li></ol><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210113194641.jpeg" alt="ç”Ÿå‘½å‘¨æœŸ"></p></blockquote></li></ul><h3 id="å¾®ç›Ÿ"><a href="#å¾®ç›Ÿ" class="headerlink" title="å¾®ç›Ÿ"></a>å¾®ç›Ÿ</h3><ul><li><p>rediså“¨å…µæ¨¡å¼å’Œclusteræ¨¡å¼çš„åŒºåˆ«ä»¥åŠåŸç†ï¼Ÿ</p></li><li><p>Redisé›†ç¾¤ä¸€èˆ¬ä½¿ç”¨å“ªä¸€ç§æ–¹æ¡ˆï¼ˆcluserï¼‰ï¼Œcluserå¦‚ä½•åšåˆ°æ°´å¹³æ‹“å±•çš„ï¼Ÿ</p></li><li><p>redisåˆ†å¸ƒå¼é”å¦‚æœåŠ é”å¤±è´¥æˆ–è€…é‡Šæ”¾é”å¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿï¼ˆå¦‚ä½•ä¿è¯åŠ é”çš„å®‰å…¨æ€§ï¼‰</p></li><li><p>ä¸€è‡´æ€§å“ˆå¸ŒåŸç†</p></li><li><p>rediså•çº¿ç¨‹çš„ç†è§£ï¼Œä¸ºä»€ä¹ˆé€‰ç”¨å•çº¿ç¨‹</p><blockquote><ol><li>ä½¿ç”¨å•çº¿ç¨‹æ¨¡å‹èƒ½å¸¦æ¥æ›´å¥½çš„å¯ç»´æŠ¤æ€§ï¼Œæ–¹ä¾¿å¼€å‘å’Œè°ƒè¯•ï¼›</li><li>ä½¿ç”¨å•çº¿ç¨‹æ¨¡å‹ä¹Ÿèƒ½å¹¶å‘çš„å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼ˆI&#x2F;Oå¤šè·¯å¤ç”¨ï¼‰ï¼›</li><li>Redis æœåŠ¡ä¸­è¿è¡Œçš„ç»å¤§å¤šæ•°æ“ä½œçš„æ€§èƒ½ç“¶é¢ˆéƒ½ä¸æ˜¯ CPUï¼Œä¸»è¦åœ¨å†…å­˜å’Œç½‘ç»œï¼›</li></ol></blockquote></li><li><p>rediså•çº¿ç¨‹ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ</p><blockquote><ol><li><strong>çº¯å†…å­˜æ“ä½œ</strong>ï¼šè¯»å–ä¸éœ€è¦è¿›è¡Œç£ç›˜ I&#x2F;Oï¼Œæ‰€ä»¥æ¯”ä¼ ç»Ÿæ•°æ®åº“è¦å¿«ä¸Šä¸å°‘ï¼›*(ä½†ä¸è¦æœ‰è¯¯åŒºè¯´ç£ç›˜å°±ä¸€å®šæ…¢ï¼Œä¾‹å¦‚ Kafka å°±æ˜¯ä½¿ç”¨ç£ç›˜é¡ºåºè¯»å–ä½†ä»ç„¶è¾ƒå¿«)*</li><li><strong>å•çº¿ç¨‹ï¼Œæ— é”ç«äº‰</strong>ï¼šè¿™ä¿è¯äº†æ²¡æœ‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä¸ä¼šå› ä¸ºå¤šçº¿ç¨‹çš„ä¸€äº›æ“ä½œè€Œé™ä½æ€§èƒ½ï¼›</li><li><strong>å¤šè·¯ I&#x2F;O å¤ç”¨æ¨¡å‹ï¼Œéé˜»å¡ I&#x2F;O</strong>ï¼šé‡‡ç”¨å¤šè·¯ I&#x2F;O å¤ç”¨æŠ€æœ¯å¯ä»¥è®©å•ä¸ªçº¿ç¨‹é«˜æ•ˆçš„å¤„ç†å¤šä¸ªç½‘ç»œè¿æ¥è¯·æ±‚ï¼ˆå°½é‡å‡å°‘ç½‘ç»œ IO çš„æ—¶é—´æ¶ˆè€—ï¼‰ï¼›</li><li><strong>é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼ŒåŠ ä¸Šåº•å±‚åšäº†å¤§é‡ä¼˜åŒ–</strong>ï¼šRedis å¯¹äºåº•å±‚çš„æ•°æ®ç»“æ„å’Œå†…å­˜å ç”¨åšäº†å¤§é‡çš„ä¼˜åŒ–ï¼Œä¾‹å¦‚ä¸åŒé•¿åº¦çš„å­—ç¬¦ä¸²ä½¿ç”¨ä¸åŒçš„ç»“æ„ä½“è¡¨ç¤ºï¼ŒHyperLogLog çš„å¯†é›†å‹å­˜å‚¨ç»“æ„ç­‰ç­‰..</li></ol></blockquote></li><li><p>èŠèŠå¯¹Redis I&#x2F;Oå¤šè·¯å¤ç”¨çš„ç†è§£</p><blockquote><p>Redis åŸºäº Reactor æ¨¡å¼å¼€å‘äº†è‡ªå·±çš„ç½‘ç»œäº‹ä»¶å¤„ç†å™¨ï¼šè¿™ä¸ªå¤„ç†å™¨è¢«ç§°ä¸ºæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ï¼ˆfile event handlerï¼‰ã€‚æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ä½¿ç”¨ I&#x2F;O å¤šè·¯å¤ç”¨ï¼ˆmultiplexingï¼‰ç¨‹åºæ¥åŒæ—¶ç›‘å¬å¤šä¸ªå¥—æ¥å­—ï¼Œå¹¶æ ¹æ® å¥—æ¥å­—ç›®å‰æ‰§è¡Œçš„ä»»åŠ¡æ¥ä¸ºå¥—æ¥å­—å…³è”ä¸åŒçš„äº‹ä»¶å¤„ç†å™¨ã€‚</p><p>å½“è¢«ç›‘å¬çš„å¥—æ¥å­—å‡†å¤‡å¥½æ‰§è¡Œè¿æ¥åº”ç­”ï¼ˆacceptï¼‰ã€è¯»å–ï¼ˆreadï¼‰ã€å†™å…¥ï¼ˆwriteï¼‰ã€å…³ é—­ï¼ˆcloseï¼‰ç­‰æ“ä½œæ—¶ï¼Œä¸æ“ä½œç›¸å¯¹åº”çš„æ–‡ä»¶äº‹ä»¶å°±ä¼šäº§ç”Ÿï¼Œè¿™æ—¶æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨å°±ä¼šè°ƒç”¨å¥—æ¥å­—ä¹‹å‰å…³è”å¥½çš„äº‹ä»¶å¤„ç†å™¨æ¥å¤„ç†è¿™äº›äº‹ä»¶ã€‚</p><p><strong>è™½ç„¶æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ä»¥å•çº¿ç¨‹æ–¹å¼è¿è¡Œï¼Œä½†é€šè¿‡ä½¿ç”¨ I&#x2F;O å¤šè·¯å¤ç”¨ç¨‹åºæ¥ç›‘å¬å¤šä¸ªå¥—æ¥å­—</strong>ï¼Œæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨æ—¢å®ç°äº†é«˜æ€§èƒ½çš„ç½‘ç»œé€šä¿¡æ¨¡å‹ï¼Œåˆå¯ä»¥å¾ˆå¥½åœ°ä¸ Redis æœåŠ¡å™¨ä¸­å…¶ä»–åŒæ ·ä»¥å•çº¿ç¨‹æ–¹å¼è¿è¡Œçš„æ¨¡å—è¿›è¡Œå¯¹æ¥ï¼Œè¿™ä¿æŒäº† Redis å†…éƒ¨å•çº¿ç¨‹è®¾è®¡çš„ç®€å•æ€§ã€‚</p></blockquote></li><li><p>ç¼“å­˜ç©¿é€æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ</p><blockquote><p>æ‹¿ä¸€äº›ç¼“å­˜å’Œæ•°æ®åº“ä¸­éƒ½æ²¡æœ‰çš„éæ³•å‚æ•°è¿›è¡Œè¯·æ±‚ï¼›è®¾ç½®nullå€¼æˆ–è€…å¸ƒéš†è¿‡æ»¤å™¨ã€‚</p></blockquote></li><li><p>å¸ƒéš†è¿‡æ»¤å™¨ä½¿ç”¨åœºæ™¯å’ŒåŸç†æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆä¼šå­˜åœ¨ä¸€å®šçš„è¯¯å·®ï¼Ÿ</p><blockquote><p><strong>åº”ç”¨åœºæ™¯</strong>ä¸»è¦æœ‰ï¼š</p><ol><li>åˆ¤æ–­ç»™å®šæ•°æ®æ˜¯å¦å­˜åœ¨ï¼šæ¯”å¦‚åˆ¤æ–­ä¸€ä¸ªæ•°å­—æ˜¯å¦å­˜åœ¨äºåŒ…å«å¤§é‡æ•°å­—çš„æ•°å­—é›†ä¸­ï¼ˆæ•°å­—é›†å¾ˆå¤§ï¼Œ5äº¿ä»¥ä¸Šï¼ï¼‰ã€ é˜²æ­¢ç¼“å­˜ç©¿é€ï¼ˆåˆ¤æ–­è¯·æ±‚çš„æ•°æ®æ˜¯å¦æœ‰æ•ˆé¿å…ç›´æ¥ç»•è¿‡ç¼“å­˜è¯·æ±‚æ•°æ®åº“ï¼‰ç­‰ç­‰ã€é‚®ç®±çš„åƒåœ¾é‚®ä»¶è¿‡æ»¤ã€é»‘åå•åŠŸèƒ½ç­‰ç­‰ã€‚</li><li>å»é‡ï¼šæ¯”å¦‚çˆ¬ç»™å®šç½‘å€çš„æ—¶å€™å¯¹å·²ç»çˆ¬å–è¿‡çš„ URL å»é‡ã€‚</li></ol><p><strong>å¸ƒéš†è¿‡æ»¤å™¨çš„åŸç†</strong>æ˜¯åˆ›å»ºä¸€ä¸ªä½æ•°ç»„ï¼Œä½æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½åªå ç”¨ 1 bit ï¼Œå¹¶ä¸”æ¯ä¸ªå…ƒç´ åªèƒ½æ˜¯ 0 æˆ–è€… 1ã€‚è¿™æ ·ç”³è¯·ä¸€ä¸ª 100w ä¸ªå…ƒç´ çš„ä½æ•°ç»„åªå ç”¨ 1000000Bit &#x2F; 8 &#x3D; 125000 Byte &#x3D; 125000&#x2F;1024 kb â‰ˆ 122kb çš„ç©ºé—´ã€‚<strong>å½“ä¸€ä¸ªå…ƒç´ åŠ å…¥å¸ƒéš†è¿‡æ»¤å™¨ä¸­çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</strong></p><ol><li>ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­çš„å“ˆå¸Œå‡½æ•°å¯¹å…ƒç´ å€¼è¿›è¡Œè®¡ç®—ï¼Œå¾—åˆ°å“ˆå¸Œå€¼ï¼ˆæœ‰å‡ ä¸ªå“ˆå¸Œå‡½æ•°å¾—åˆ°å‡ ä¸ªå“ˆå¸Œå€¼ï¼‰ã€‚</li><li>æ ¹æ®å¾—åˆ°çš„å“ˆå¸Œå€¼ï¼Œåœ¨ä½æ•°ç»„ä¸­æŠŠå¯¹åº”ä¸‹æ ‡çš„å€¼ç½®ä¸º 1ã€‚</li></ol><p><strong>ä¸åŒçš„å­—ç¬¦ä¸²å¯èƒ½å“ˆå¸Œå‡ºæ¥çš„ä½ç½®ç›¸åŒï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬å¯ä»¥é€‚å½“å¢åŠ ä½æ•°ç»„å¤§å°æˆ–è€…è°ƒæ•´æˆ‘ä»¬çš„å“ˆå¸Œå‡½æ•°ã€‚</strong></p><p>ç»¼ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼š<strong>å¸ƒéš†è¿‡æ»¤å™¨è¯´æŸä¸ªå…ƒç´ å­˜åœ¨ï¼Œå°æ¦‚ç‡ä¼šè¯¯åˆ¤ã€‚å¸ƒéš†è¿‡æ»¤å™¨è¯´æŸä¸ªå…ƒç´ ä¸åœ¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå…ƒç´ ä¸€å®šä¸åœ¨ã€‚</strong></p><p><a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/dataStructures-algorithms/data-structure/bloom-filter.md"><strong>å…·ä½“å‚è€ƒè¿™é‡Œ</strong></a></p></blockquote></li><li><p>Rediså¸ƒéš†è¿‡æ»¤å™¨å‘½ä»¤æ˜¯ä»€ä¹ˆï¼Ÿ</p><blockquote><p><strong><code>BF.ADD </code>ã€<code>BF.MADD</code>ã€<code>BF.EXISTS</code> ã€<code>BF.MEXISTS</code>ã€<code>BF.RESERVE</code></strong></p></blockquote></li><li><p>MySQLè¡Œé”çš„åŸç†ï¼Œé”çš„åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆç´¢å¼•ï¼‰</p></li><li><p>å¯¹MVCCçš„ç†è§£ï¼ŒMVCCåˆ°åº•è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿï¼ˆä¹è§‚é”å®ç°ï¼Œæé«˜æ€§èƒ½è¯»å†™å†²çªä¸åŠ é”ï¼‰</p><blockquote><p>MVCCæ˜¯ä¹è§‚é”çš„ä¸€ç§å®ç°ï¼Œè¯»å†™å†²çªä¸åŠ é”ï¼Œæé«˜äº†æ€§èƒ½</p></blockquote></li><li><p>MVCCèƒ½è§£å†³å¹»è¯»å—ï¼Ÿ</p><blockquote><p>MVCCä¸èƒ½å½»åº•è§£å†³å¹»è¯»ï¼Œåªèƒ½è§£å†³è¯»æƒ…å†µä¸‹çš„å¹»è¯»ï¼Œå†™çš„å¹»è¯»æ˜¯é€šè¿‡åŠ é”æ¥è§£å†³ã€‚</p></blockquote></li><li><p>åˆ†å¸ƒå¼äº‹åŠ¡å¦‚ä½•è§£å†³ï¼ŸåŸºäºCAPç†è®ºå’Œ2PCï¼ŒTCCæ˜¯ä»€ä¹ˆ</p></li><li><p>MySQLæ·±åˆ†é¡µä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿï¼ˆæ¯”å¦‚LIMIT 1000,100ï¼‰å¦‚ä½•è§£å†³ï¼Ÿ</p><blockquote><p><strong>æ·±åˆ†é¡µä¸ºä»€ä¹ˆä¼šæ…¢</strong>ï¼šä¸¾ä¸ªä¾‹å­ï¼Œselect * from where status &#x3D; 1 limit 10000,20ï¼Œå³ä½¿çŸ¥é“å‰10000ä¸ªä¼šä¸¢æ‰ï¼Œmysqlä¹Ÿä¼šå»èšé›†ç´¢å¼•ä¸ŠæŸ¥ä¸€éæ•°æ®ï¼ˆå›è¡¨ï¼‰ï¼Œè‡ªç„¶é€Ÿåº¦å°±éå¸¸æ…¢ï¼Œè¿™é‡Œæ˜¯å› ä¸ºlimit offsetåªèƒ½ä½œç”¨äºå¼•æ“å±‚è¿”å›çš„ç»“æœé›†ã€‚æ¢å¥è¯è¯´ï¼Œå¼•æ“å±‚ä¹Ÿå¾ˆæ— è¾œï¼Œä»–å¹¶ä¸çŸ¥é“è¿™10000ä¸ªæ˜¯è¦æ‰”æ‰çš„ã€‚<a href="https://blog.csdn.net/fengzongfu/article/details/103191867"><strong>å…·ä½“å‚è€ƒç‚¹å‡»è¿™é‡Œ</strong></a></p><p><strong>å¦‚ä½•è§£å†³</strong>ï¼š</p><ol><li>æ ¹æ®å®é™…ä¸šåŠ¡éœ€æ±‚ï¼Œçœ‹æ˜¯å¦èƒ½æ›¿æ¢æˆä¸‹ä¸€é¡µï¼Œä¸Šä¸€é¡µè¿™ç§ï¼Œè¿™é‡Œæ˜¯è¯´ï¼ŒæŠŠlimit,offsetæ›¿æ¢ä¸º&gt;è¾…åŠ©ç´¢å¼•ï¼ˆå³æœç´¢æ¡ä»¶ï¼‰idçš„æ–¹å¼ã€‚è¯¥idå†è°ƒç”¨æ—¶ï¼Œéœ€è¦è¿”å›ç»™å‰ç«¯ã€‚</li><li>è¦†ç›–ç´¢å¼•ï¼šå½“è¾…åŠ©ç´¢å¼•æŸ¥è¯¢çš„æ•°æ®ï¼Œåªæœ‰idå’Œè¾…åŠ©ç´¢å¼•æœ¬èº«ï¼Œé‚£ä¹ˆå°±ä¸å¿…å†å»å›è¡¨æŸ¥è¯¢ã€‚æ€è·¯å¦‚ä¸‹ï¼šselect * from t wherer id in (select id from t where second_index &#x3D; xxx limit 10000,20)ï¼Œè¿™å¥è¯æ˜¯è¯´ï¼Œå…ˆä»æ¡ä»¶æŸ¥è¯¢ä¸­ï¼ŒæŸ¥æ‰¾æ•°æ®å¯¹åº”çš„idï¼Œå› ä¸ºä¸»é”®åœ¨è¾…åŠ©ç´¢å¼•ä¸Šå°±æœ‰ï¼Œæ‰€ä»¥ä¸ç”¨ä¼šå›è¡¨æŸ¥è¯¢ã€‚å†é€šè¿‡è¿™äº›å·²ç»è¢«limitå‡ºæ¥çš„idï¼Œå»æŸ¥èšé›†ç´¢å¼•ï¼Œè¿™æ ·åªä¼š20æ¬¡éšæœºIOã€‚ï¼ˆæˆ–è€…ç”¨JOINå»ä¼˜åŒ–ï¼ŒåŸç†ç±»ä¼¼select * from t a join (select id from t where second_index &#x3D; xxx limit 10000,20) b on a.id&#x3D;b.idï¼‰</li></ol></blockquote></li><li><p>kafkaå†…éƒ¨æ˜¯å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¹‚ç­‰æ€§ï¼Ÿ</p><blockquote><p>æ¶ˆæ¯è¯­ä¹‰ï¼Œç²¾å‡†ä¸€æ¬¡æ€§ï¼Œæ¶ˆæ¯é«˜æ°´ä½å¾…è¡¥å……</p></blockquote></li><li><p>å¦‚ä½•ä¿è¯kafkaæ¶ˆæ¯çš„å…¨å±€çš„é¡ºåºæ€§ï¼ˆè®¾ç½®keyå¯ä»¥ä¿è¯åˆ†åŒºé¡ºåºæ€§ï¼‰</p><blockquote><p>è®¾ç½®ç›¸åŒçš„keyå¯ä»¥ä¿è¯åˆ†åŒºçš„é¡ºåºæ€§ï¼Œå…¨å±€é¡ºåºæ€§å¯ä»¥è®¾ç½®ä¸€ä¸ª topicï¼Œä¸€ä¸ª partitionï¼Œä¸€ä¸ª consumer</p></blockquote></li><li><p>kakfa ISRæœºåˆ¶çš„åŸç†</p></li><li><p>å“²å­¦å®¶è¿›é¤é—®é¢˜</p></li></ul><h3 id="å¾®ç›ŸäºŒé¢"><a href="#å¾®ç›ŸäºŒé¢" class="headerlink" title="å¾®ç›ŸäºŒé¢"></a>å¾®ç›ŸäºŒé¢</h3><ul><li><p>dubboæœ‰å“ªäº›ç»„ä»¶ï¼ˆåˆ†å±‚ï¼‰ï¼Ÿ</p><blockquote><p>ä»å¤§çš„èŒƒå›´æ¥è¯´ï¼Œdubboåˆ†ä¸ºä¸‰å±‚ï¼Œbusinessä¸šåŠ¡é€»è¾‘å±‚ç”±æˆ‘ä»¬è‡ªå·±æ¥æä¾›æ¥å£å’Œå®ç°è¿˜æœ‰ä¸€äº›é…ç½®ä¿¡æ¯ï¼ŒRPCå±‚å°±æ˜¯çœŸæ­£çš„RPCè°ƒç”¨çš„æ ¸å¿ƒå±‚ï¼Œå°è£…æ•´ä¸ªRPCçš„è°ƒç”¨è¿‡ç¨‹ã€è´Ÿè½½å‡è¡¡ã€é›†ç¾¤å®¹é”™ã€ä»£ç†ï¼Œremotingåˆ™æ˜¯å¯¹ç½‘ç»œä¼ è¾“åè®®å’Œæ•°æ®è½¬æ¢çš„å°è£…ã€‚</p><p>åˆ’åˆ†åˆ°æ›´ç»†çš„å±‚é¢ï¼Œå°±æ˜¯å›¾ä¸­çš„10å±‚æ¨¡å¼ï¼Œæ•´ä¸ªåˆ†å±‚ä¾èµ–ç”±ä¸Šè‡³ä¸‹ï¼Œé™¤å¼€businessä¸šåŠ¡é€»è¾‘ä¹‹å¤–ï¼Œå…¶ä»–çš„å‡ å±‚éƒ½æ˜¯SPIæœºåˆ¶ã€‚<br><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210118154630.webp" alt="å›¾ç‰‡"></p></blockquote></li><li><p>ç®€å•è®²è®²dubboæœåŠ¡æ³¨å†Œä¸å‘ç°ï¼ˆæœåŠ¡æš´éœ²ï¼‰çš„è¿‡ç¨‹</p><blockquote><ol><li><p>åœ¨å®¹å™¨å¯åŠ¨çš„æ—¶å€™ï¼Œé€šè¿‡ServiceConfigè§£ææ ‡ç­¾ï¼Œåˆ›å»ºdubboæ ‡ç­¾è§£æå™¨æ¥è§£ædubboçš„æ ‡ç­¾ï¼Œå®¹å™¨åˆ›å»ºå®Œæˆä¹‹åï¼Œè§¦å‘ContextRefreshEventäº‹ä»¶å›è°ƒå¼€å§‹æš´éœ²æœåŠ¡</p></li><li><p>é€šè¿‡ProxyFactoryè·å–åˆ°invokerï¼ŒinvokeråŒ…å«äº†éœ€è¦æ‰§è¡Œçš„æ–¹æ³•çš„å¯¹è±¡ä¿¡æ¯å’Œå…·ä½“çš„URLåœ°å€</p></li><li><p>å†é€šè¿‡DubboProtocolçš„å®ç°æŠŠåŒ…è£…åçš„invokerè½¬æ¢æˆexporterï¼Œç„¶åå¯åŠ¨æœåŠ¡å™¨serverï¼Œç›‘å¬ç«¯å£</p></li><li><p>æœ€åRegistryProtocolä¿å­˜URLåœ°å€å’Œinvokerçš„æ˜ å°„å…³ç³»ï¼ŒåŒæ—¶æ³¨å†Œåˆ°æœåŠ¡ä¸­å¿ƒ</p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210118154814.webp" alt="å›¾ç‰‡"></p></li></ol></blockquote></li><li><p>è®²è®²ç¼“å­˜ç©¿é€ï¼ˆå¸ƒéš†è¿‡æ»¤å™¨çš„åŸç†ï¼‰</p></li><li><p>JVMå†…å­˜åŒºåŸŸ</p><blockquote><ol><li>ç¨‹åºè®¡æ•°å™¨ï¼ˆçº¿ç¨‹ç§æœ‰ï¼‰ï¼šæŒ‡å‘å½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤</li><li>è™šæ‹Ÿæœºæ ˆï¼ˆçº¿ç¨‹ç§æœ‰ï¼‰ï¼šè™šæ‹Ÿæœºæ ˆæè¿°çš„æ˜¯Javaæ–¹æ³•æ‰§è¡Œçš„çº¿ç¨‹å†…å­˜æ¨¡å‹ï¼šæ¯ä¸ªæ–¹æ³•æ‰§è¡Œçš„æ—¶å€™ï¼ŒJavaè™šæ‹Ÿæœºéƒ½ä¼šåŒæ­¥åˆ›å»ºä¸€ä¸ªæ ˆå¸§ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€è¿æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ã€‚</li><li>æœ¬åœ°æ–¹æ³•æ ˆï¼ˆçº¿ç¨‹ç§æœ‰ï¼‰ï¼šè°ƒç”¨æœ¬åœ°nativeçš„å†…å­˜æ¨¡å‹</li><li>å †ï¼ˆçº¿ç¨‹å…±äº«ï¼‰ï¼šJavaå¯¹è±¡å­˜å‚¨çš„åœ°æ–¹<br>ï¼ˆ1ï¼‰Javaå †æ˜¯è™šæ‹Ÿæœºç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—<br>ï¼ˆ2ï¼‰Javaå †æ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„åŒºåŸŸ<br>ï¼ˆ3ï¼‰åœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»º<br>ï¼ˆ4ï¼‰æ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œå‡ ä¹æ‰€æœ‰å¯¹è±¡å®ä¾‹éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ã€‚å­˜æ”¾newç”Ÿæˆçš„å¯¹è±¡å’Œæ•°ç»„<br>ï¼ˆ5ï¼‰Javaå †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„å†…å­˜åŒºåŸŸï¼Œå› æ­¤å¾ˆå¤šæ—¶å€™ç§°ä¸ºâ€œGCå †â€</li><li>æ–¹æ³•åŒºï¼ˆçº¿ç¨‹å…±äº«ï¼‰ï¼šç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®<br><strong>è¿è¡Œæ—¶å¸¸é‡æ± ï¼š</strong><br>Aã€æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†<br>Bã€å­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨<br>Cã€Classæ–‡ä»¶ä¸­é™¤äº†å­˜æœ‰ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰æè¿°ä¿¡æ¯ï¼Œè¿˜æœ‰ä¸€é¡¹æ˜¯å¸¸é‡æ± ï¼Œå­˜æœ‰è¿™ä¸ªç±»çš„ ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼Œè¿™éƒ¨åˆ†å†…å®¹å°†åœ¨ç±»åŠ è½½åï¼Œå­˜æ”¾åˆ°æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ã€‚</li></ol><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/202120210125231657.png" alt="å›¾ç‰‡"></p></blockquote></li><li><p>åˆ†åº“åˆ†è¡¨ä¹‹åå¤šæ¡ä»¶æŸ¥è¯¢å¦‚ä½•å¤„ç†ï¼Ÿï¼ˆå®½è¡¨æˆ–è€…ESï¼‰</p></li><li><p>MySQLæœ€å·¦åŒ¹é…åŸåˆ™çš„åŸç†</p></li><li><p>ä»‹ç»ä¸‹AQS</p></li><li><p>ç”¨è¿‡å“ªäº›JUCåŒ…ä¸‹çš„ç±»ï¼Œåœºæ™¯å„æ˜¯ä»€ä¹ˆï¼Ÿ</p></li><li><p>dockerä¹‹é—´æ˜¯å¦‚ä½•é€šä¿¡çš„</p></li></ul><h3 id="æºç¨‹"><a href="#æºç¨‹" class="headerlink" title="æºç¨‹"></a>æºç¨‹</h3><ul><li><p>excelå¤§æ–‡ä»¶ä¸Šä¼ OOMçš„é—®é¢˜å¦‚ä½•è§£å†³</p></li><li><p>åˆ†åº“åˆ†è¡¨ä¹‹åçš„JOINå¦‚ä½•å¤„ç†ï¼Œåˆ†é¡µå¦‚ä½•å¤„ç†</p><blockquote><p>TODOå¾…è¡¥å……</p></blockquote></li><li><p>MySQLæ˜¯å¦‚ä½•ä¿è¯ACIDçš„</p><blockquote><p>Aï¼ˆåŸå­æ€§ï¼‰ï¼š<code>undo log</code>è®°å½•äº†è¿™äº›å›æ»šéœ€è¦çš„ä¿¡æ¯ï¼Œå½“äº‹åŠ¡æ‰§è¡Œå¤±è´¥æˆ–è°ƒç”¨äº†rollbackï¼Œå¯¼è‡´äº‹åŠ¡éœ€è¦å›æ»šï¼Œä¾¿å¯ä»¥åˆ©ç”¨undo logä¸­çš„ä¿¡æ¯å°†æ•°æ®å›æ»šåˆ°ä¿®æ”¹ä¹‹å‰çš„æ ·å­ã€‚</p><p>Cï¼ˆä¸€è‡´æ€§ï¼‰ï¼šä»æ•°æ®åº“å±‚é¢ï¼Œæ•°æ®åº“é€šè¿‡åŸå­æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§æ¥ä¿è¯ä¸€è‡´æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´ACIDå››å¤§ç‰¹æ€§ä¹‹ä¸­ï¼ŒC(ä¸€è‡´æ€§)æ˜¯ç›®çš„ï¼ŒA(åŸå­æ€§)ã€I(éš”ç¦»æ€§)ã€D(æŒä¹…æ€§)æ˜¯æ‰‹æ®µï¼Œæ˜¯ä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼Œæ•°æ®åº“æä¾›çš„æ‰‹æ®µã€‚æ•°æ®åº“å¿…é¡»è¦å®ç°AIDä¸‰å¤§ç‰¹æ€§ï¼Œæ‰æœ‰å¯èƒ½å®ç°ä¸€è‡´æ€§ã€‚</p><p>Iï¼ˆéš”ç¦»æ€§ï¼‰ï¼šMVCCä¿è¯äº†è¯»çš„éš”ç¦»æ€§ï¼›æ’å®ƒé”ä¿è¯å†™çš„éš”ç¦»æ€§ã€‚</p><p>Dï¼ˆæŒä¹…æ€§ï¼‰ï¼šä½¿ç”¨äº†WAL(Write-Ahead Loggingï¼Œå…ˆå†™æ—¥å¿—å†å†™ç£ç›˜)ã€‚Redo logå°±æ˜¯ä¸€ç§WALçš„åº”ç”¨ã€‚å½“æ•°æ®åº“å¿½ç„¶æ‰ç”µï¼Œå†é‡æ–°å¯åŠ¨æ—¶ï¼ŒMySQLå¯ä»¥é€šè¿‡Redo logè¿˜åŸæ•°æ®ã€‚</p></blockquote></li></ul><h3 id="æ€ªå…½å……ç”µ"><a href="#æ€ªå…½å……ç”µ" class="headerlink" title="æ€ªå…½å……ç”µ"></a>æ€ªå…½å……ç”µ</h3><ul><li><p>å‡ ç§åˆ†å¸ƒå¼idç”Ÿæˆæ–¹æ¡ˆï¼Œå„æœ‰ä»€ä¹ˆé—®é¢˜</p><blockquote><ol><li>UUIDï¼Œæ€§èƒ½è¾ƒå·®ï¼ŒMySQLå®˜æ–¹ä¸æ¨èï¼Œä¼šå¼•èµ·ç£ç›˜æ•°æ®ä½ç½®é¢‘ç¹å˜åŠ¨</li><li><code>SNOWFLAKE</code>ï¼ˆé›ªèŠ±ç®—æ³•ï¼‰æ˜¯é»˜è®¤ä½¿ç”¨çš„ä¸»é”®ç”Ÿæˆæ–¹æ¡ˆï¼Œç”Ÿæˆä¸€ä¸ª 64bitçš„é•¿æ•´å‹ï¼ˆ<code>Long</code>ï¼‰æ•°æ®ã€‚<code>sharding-jdbc</code> ä¸­é›ªèŠ±ç®—æ³•ç”Ÿæˆçš„ä¸»é”®ä¸»è¦ç”± 4éƒ¨åˆ†ç»„æˆï¼Œ<code>1bit</code>ç¬¦å·ä½ã€<code>41bit</code>æ—¶é—´æˆ³ä½ã€<code>10bit</code>å·¥ä½œè¿›ç¨‹ä½ä»¥åŠ <code>12bit</code> åºåˆ—å·ä½ã€‚</li><li>Tinyid</li></ol><p><a href="https://juejin.cn/post/6892959738670743565">å…·ä½“å‚è€ƒé“¾æ¥</a></p></blockquote></li></ul><h3 id="å¿«è´§è¿"><a href="#å¿«è´§è¿" class="headerlink" title="å¿«è´§è¿"></a>å¿«è´§è¿</h3><ul><li><p>åˆ†å¸ƒå¼é”ï¼ˆæˆ–å…¶ä»–äº’æ–¥é”ï¼‰å¦‚ä½•ä¿è¯å®‰å…¨çš„å‰æä¸‹åŒæ—¶æé«˜æ€§èƒ½</p><blockquote><p>ä½¿ç”¨åˆ†æ®µé”ï¼šæ¯”å¦‚1000ä¸ªåº“å­˜åˆ†æˆ10ä»½ï¼Œæ¯ä¸ªè¯·æ±‚hashåˆ°ä¸åŒçš„keyä¸Šï¼Œæœ€åå†æ±‡æ€»</p></blockquote></li></ul><h3 id="ä¸€è¯ç½‘"><a href="#ä¸€è¯ç½‘" class="headerlink" title="ä¸€è¯ç½‘"></a>ä¸€è¯ç½‘</h3><ul><li><p>dubboçš„çº¿ç¨‹æ¨¡å‹</p></li><li><p>springäº‹åŠ¡å¤±æ•ˆçš„åœºæ™¯</p></li><li><p>ç±»åŠ è½½è¿‡ç¨‹</p><blockquote><p>ç±»åŠ è½½è¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼šLoadã€Linkå’ŒInitï¼Œå³<strong>åŠ è½½</strong>ã€<strong>é“¾æ¥</strong>ã€<strong>åˆå§‹åŒ–</strong></p><ol><li>ç¬¬ä¸€æ­¥ï¼ŒLoadé˜¶æ®µè¯»å–ç±»æ–‡ä»¶äº§ç”ŸäºŒè¿›åˆ¶æµï¼Œå¹¶è½¬åŒ–ä¸ºç‰¹å®šçš„æ•°æ®ç»“æ„ï¼Œåˆæ­¥æ ¡éªŒcafe babeé­”æ³•æ•°ã€å¸¸é‡æ± ã€æ–‡ä»¶é•¿åº¦ã€æ˜¯å¦æœ‰çˆ¶ç±»ç­‰ï¼Œç„¶ååˆ›å»ºå¯¹åº”çš„java.lang.Classå®ä¾‹</li><li>ç¬¬äºŒæ­¥ï¼ŒLinké˜¶æ®µåŒ…æ‹¬<strong>éªŒè¯</strong>ã€<strong>å‡†å¤‡</strong>ã€<strong>è§£æ</strong>ä¸‰ä¸ªæ­¥éª¤ã€‚éªŒè¯æ˜¯æ›´è¯¦ç»†çš„æ ¡éªŒï¼Œæ¯”å¦‚finalæ˜¯å¦åˆè§„ã€ç±»å‹æ˜¯å¦æ­£ç¡®ã€é™æ€å˜é‡æ˜¯å¦åˆç†ç­‰ï¼›å‡†å¤‡é˜¶æ®µæ˜¯ä¸ºé™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶è®¾å®šé»˜è®¤å€¼ï¼Œè§£æç±»å’Œæ–¹æ³•ç¡®ä¿ç±»ä¸ç±»ä¹‹é—´çš„ç›¸äº’å¼•ç”¨æ­£ç¡®æ€§ï¼Œå®Œæˆå†…å­˜ç»“æ„å¸ƒå±€ã€‚</li><li>ç¬¬ä¸‰æ­¥ï¼ŒInité˜¶æ®µæ‰§è¡Œé›·æ„é€ å™¨&lt;clint&gt;æ–¹æ³•ï¼Œå¦‚æœèµ‹å€¼è¿ç®—æ˜¯é€šè¿‡å…¶ä»–ç±»çš„é™æ€æ–¹æ³•æ¥å®Œæˆçš„ï¼Œé‚£ä¹ˆä¼šé©¬ä¸Šè§£æå¦å¤–ä¸€ä¸ªç±»ï¼Œåœ¨è™šæ‹Ÿæœºæ ˆä¸­æ‰§è¡Œå®Œæ¯•åé€šè¿‡è¿”å›å€¼è¿›è¡Œèµ‹å€¼ã€‚</li></ol></blockquote></li><li><p>åŒ…åå’Œç±»åä¸€æ ·çš„ä¸¤ä¸ªç±»å†²çªå¦‚ä½•è§£å†³</p></li></ul><h3 id="å–œé©¬æ‹‰é›…"><a href="#å–œé©¬æ‹‰é›…" class="headerlink" title="å–œé©¬æ‹‰é›…"></a>å–œé©¬æ‹‰é›…</h3><ul><li><p>JVMæ˜¯åŸºäºæ ˆè¿˜æ˜¯å¯„å­˜å™¨è¿›è¡Œè§£é‡Šçš„ï¼ˆæ ˆï¼‰</p></li><li><p>newä¸€ä¸ªå¯¹è±¡ï¼Œå®é™…å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿï¼ˆæ“ä½œç³»ç»Ÿå±‚é¢å’ŒJVMå±‚é¢ï¼‰</p></li><li><p>åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå¯¹äºæ“ä½œç³»ç»Ÿæ¥è¯´åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼ˆCPUå’Œå†…å­˜æ–¹é¢ï¼‰</p></li><li><p>çº¿ç¨‹åˆ‡æ¢æœ‰ä»€ä¹ˆæŸè€—ï¼Ÿ</p><blockquote><p>çº¿ç¨‹åˆ‡æ¢çš„æ—¶å€™è¿˜è¦æ‰§è¡Œå†…å­˜æ¢é¡µï¼ŒCPU çš„ç¼“å­˜è¢«æ¸…ç©º,åˆ‡æ¢å›æ¥çš„æ—¶å€™è¿˜è¦é‡æ–°ä»å†…å­˜ä¸­è¯»å–ä¿¡æ¯,ç ´åäº†æ•°æ®çš„å±€éƒ¨æ€§</p></blockquote></li><li><p>volatileä¿è¯çš„å†…å­˜å¯è§æ€§æ˜¯æŒ‡ä»€ä¹ˆï¼Ÿç¦æ­¢é‡æ’åºçš„åŸç†</p></li><li><p>JMMçš„å·¥ä½œå†…å­˜æ˜¯åœ¨å“ªé‡Œï¼Ÿï¼ˆCPUé«˜é€Ÿç¼“å­˜ï¼Œé€»è¾‘ä¸Šéƒ¨åˆ†å±äºæ ˆï¼‰</p></li><li><p>æ“ä½œç³»ç»Ÿçº¿ç¨‹å’ŒJVMçº¿ç¨‹çš„åŒºåˆ«</p></li><li><p>leetcode98</p></li></ul><h3 id="è´§æ‹‰æ‹‰"><a href="#è´§æ‹‰æ‹‰" class="headerlink" title="è´§æ‹‰æ‹‰"></a>è´§æ‹‰æ‹‰</h3><ul><li>ç±»çš„åŠ è½½è¿‡ç¨‹</li><li>ç±»çš„å¸è½½</li><li>JVMå†…å­˜åŒºåŸŸ</li><li>å¸¸ç”¨åƒåœ¾å›æ”¶å™¨å’ŒGCç®—æ³•ï¼Œä¸‰è‰²æ ‡è®°</li><li>åƒåœ¾å›æ”¶çš„è¿‡ç¨‹</li><li>è®¾è®¡ä¸€ä¸ªé«˜å¹¶å‘ç³»ç»Ÿï¼Œä¾‹å¦‚ç§’æ€ç³»ç»Ÿ</li></ul><h3 id="è´§æ‹‰æ‹‰äºŒé¢"><a href="#è´§æ‹‰æ‹‰äºŒé¢" class="headerlink" title="è´§æ‹‰æ‹‰äºŒé¢"></a>è´§æ‹‰æ‹‰äºŒé¢</h3><ul><li><p>å¼ºå¼•ç”¨ã€è½¯åº”ç”¨ã€å¼±å¼•ç”¨ã€è™šåº”ç”¨çš„åŒºåˆ«ä»¥åŠä½¿ç”¨åœºæ™¯</p><blockquote><p><strong>å¼ºå¼•ç”¨ï¼Œå³Strong Referenceï¼Œ</strong>æœ€ä¸ºå¸¸è§ã€‚å¦‚Object &#x3D; new Object()ï¼›è¿™æ ·çš„å˜é‡å£°æ˜å’Œå®šä¹‰å°±ä¼šäº§ç”Ÿå¯¹è¯¥å¯¹è±¡çš„å¼ºå¼•ç”¨ã€‚åªè¦å¯¹è±¡æœ‰å¼ºå¼•ç”¨æŒ‡å‘ï¼Œå¹¶ä¸”GC Rootså¯è¾¾ï¼Œé‚£ä¹ˆJavaå†…å­˜å›æ”¶æ—¶ï¼Œä¹Ÿä¸ä¼šå›æ”¶è¯¥å¯¹è±¡ã€‚</p><p><strong>è½¯å¼•ç”¨ï¼Œå³Soft Referenceï¼Œ</strong>å¼•ç”¨åŠ›åº¦å¼±äºâ€å¼ºå¼•ç”¨â€œï¼Œæ˜¯ç”¨åœ¨éå¿…éœ€å¯¹è±¡çš„åœºæ™¯ã€‚åœ¨å³å°†OOMä¹‹å‰ï¼Œåƒåœ¾å›æ”¶å™¨ä¼šæŠŠè¿™äº›è½¯å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡åŠ å…¥å›æ”¶èŒƒå›´ï¼Œä»¥è·å¾—æ›´å¤šçš„å†…å­˜ç©ºé—´ï¼Œè®©ç¨‹åºèƒ½å¤Ÿç»§ç»­å¥åº·è¿è¡Œã€‚ä¸»è¦ç”¨æ¥ç¼“å­˜æœåŠ¡å™¨ä¸­é—´è®¡ç®—ç»“æœåŠä¸éœ€è¦å®æ—¶ä¿å­˜çš„ç”¨æˆ·è¡Œä¸ºç­‰ã€‚</p><p><strong>å¼±å¼•ç”¨ï¼Œå³Weak Referenceï¼Œ</strong>å¼•ç”¨å¼ºåº¦è¾ƒå‰ä¸¤è€…æ›´å¼±ï¼Œä¹Ÿæ˜¯ç”¨æ¥æè¿°éå¿…éœ€å¯¹è±¡çš„ã€‚å¦‚æœå¼±å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡åªå­˜åœ¨å¼±å¼•ç”¨è¿™ä¸€æ¡çº¿è·¯ï¼Œåˆ™åœ¨ä¸‹ä¸€æ¬¡YGCæ—¶ä¼šè¢«å›æ”¶ã€‚ç”±äºYGCæ—¶é—´çš„ä¸ç¡®å®šæ€§ï¼Œå¼±å¼•ç”¨ä½•æ—¶è¢«å›æ”¶ä¹Ÿå…·æœ‰ä¸ç¡®å®šæ€§ã€‚å¼±å¼•ç”¨ä¸»è¦ç”¨äºæŒ‡å‘æŸä¸ªæ˜“æ¶ˆå¤±çš„å¯¹è±¡ï¼Œåœ¨å¼ºå¼•ç”¨æ–­å¼€åï¼Œæ­¤å¼•ç”¨ä¸ä¼šåŠ«æŒå¯¹è±¡ã€‚è°ƒç”¨WeakReference.get()å¯èƒ½ä¼šè¿”å›nullï¼Œè¦æ³¨æ„ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</p><p><strong>è™šå¼•ç”¨ï¼Œå³Phantom Referenceï¼Œ</strong>æ˜¯æå¼±çš„ä¸€ç§å¼•ç”¨å…³ç³»ï¼Œå®šä¹‰å®Œæˆåï¼Œå°±æ— æ³•é€šè¿‡è¯¥å¼•ç”¨è·å–æŒ‡å‘çš„å¯¹è±¡ã€‚ä¸ºä¸€ä¸ªå¯¹è±¡è®¾ç½®è™šå¼•ç”¨çš„å”¯ä¸€ç›®çš„å°±æ˜¯å¸Œæœ›èƒ½åœ¨è¿™ä¸ªå¯¹è±¡è¢«å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ã€‚è™šå¼•ç”¨å¿…é¡»ä¸å¼•ç”¨é˜Ÿåˆ—è”åˆä½¿ç”¨ï¼Œå½“åƒåœ¾å›æ”¶æ—¶ï¼Œå¦‚æœå‘ç°å­˜åœ¨è™šå¼•ç”¨ï¼Œå°±ä¼šåœ¨å›æ”¶å¯¹è±¡å†…å­˜å‰ï¼ŒæŠŠè¿™ä¸ªè™šå¼•ç”¨åŠ å…¥ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚</p></blockquote></li><li><p>caffeineå’ŒguavaåŒºåˆ«ï¼Œä¸ºä»€ä¹ˆé€‰caffeineï¼Œcaffeineçš„ä¼˜åŠ¿</p></li></ul><h3 id="æ¶‚é¸¦æ™ºèƒ½"><a href="#æ¶‚é¸¦æ™ºèƒ½" class="headerlink" title="æ¶‚é¸¦æ™ºèƒ½"></a>æ¶‚é¸¦æ™ºèƒ½</h3><ul><li><p>springæ‹“å±•ç‚¹ç”¨è¿‡å—ï¼Ÿï¼ˆå‰ç½®åç½®å¤„ç†å™¨ï¼Œbeanç”Ÿå‘½å‘¨æœŸç›¸å…³ï¼‰</p></li><li><p>MySQLäº‹åŠ¡çš„åŸå­æ€§æ˜¯å¦‚ä½•ä¿è¯çš„ï¼Ÿ</p><blockquote><p>é€šè¿‡undologæ¥ä¿è¯åŸå­æ€§</p></blockquote></li><li><p>Kafkaæ¶æ„è®¾è®¡</p></li><li><p>Rediså•çº¿ç¨‹ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«</p></li><li><p>Rediså•çº¿ç¨‹çš„ç†è§£</p></li><li><p>dubboæ¥å£å¦‚æœè¶…æ—¶äº†ï¼Œé—®é¢˜æ’æŸ¥çš„æ€è·¯</p></li></ul><h3 id="è”šæ¥"><a href="#è”šæ¥" class="headerlink" title="è”šæ¥"></a>è”šæ¥</h3><ul><li>ä»‹ç»ä¸‹casç®—æ³•</li><li>redisç¼“å­˜é›ªå´©å¦‚ä½•è§£å†³</li><li>rediså“¨å…µæ¨¡å¼å¦‚ä½•ä¿è¯é«˜å¯ç”¨</li><li>åˆ†åº“åˆ†è¡¨ä¹‹åè”è¡¨å¦‚æœæ˜¯ä¸¤æ¬¡æŸ¥è¯¢çš„è¯æ€§èƒ½ä¼šå¾ˆå·®å—</li></ul><h3 id="é˜¿é‡Œï¼ˆä¼ä¸šæ™ºèƒ½ï¼‰"><a href="#é˜¿é‡Œï¼ˆä¼ä¸šæ™ºèƒ½ï¼‰" class="headerlink" title="é˜¿é‡Œï¼ˆä¼ä¸šæ™ºèƒ½ï¼‰"></a>é˜¿é‡Œï¼ˆä¼ä¸šæ™ºèƒ½ï¼‰</h3><ul><li><p>dubboçš„åŸç†æ˜¯ä»€ä¹ˆï¼ˆå·¥ä½œåŸç†ï¼‰</p><blockquote><ol><li>æœåŠ¡å¯åŠ¨çš„æ—¶å€™ï¼Œproviderå’Œconsumeræ ¹æ®é…ç½®ä¿¡æ¯ï¼Œè¿æ¥åˆ°æ³¨å†Œä¸­å¿ƒregisterï¼Œåˆ†åˆ«å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œå’Œè®¢é˜…æœåŠ¡</li><li>registeræ ¹æ®æœåŠ¡è®¢é˜…å…³ç³»ï¼Œè¿”å›providerä¿¡æ¯åˆ°consumerï¼ŒåŒæ—¶consumerä¼šæŠŠproviderä¿¡æ¯ç¼“å­˜åˆ°æœ¬åœ°ã€‚å¦‚æœä¿¡æ¯æœ‰å˜æ›´ï¼Œconsumerä¼šæ”¶åˆ°æ¥è‡ªregisterçš„æ¨é€</li><li>consumerç”Ÿæˆä»£ç†å¯¹è±¡ï¼ŒåŒæ—¶æ ¹æ®è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œé€‰æ‹©ä¸€å°providerï¼ŒåŒæ—¶å®šæ—¶å‘monitorè®°å½•æ¥å£çš„è°ƒç”¨æ¬¡æ•°å’Œæ—¶é—´ä¿¡æ¯</li><li>æ‹¿åˆ°ä»£ç†å¯¹è±¡ä¹‹åï¼Œconsumeré€šè¿‡ä»£ç†å¯¹è±¡å‘èµ·æ¥å£è°ƒç”¨</li><li>provideræ”¶åˆ°è¯·æ±‚åå¯¹æ•°æ®è¿›è¡Œååºåˆ—åŒ–ï¼Œç„¶åé€šè¿‡ä»£ç†è°ƒç”¨å…·ä½“çš„æ¥å£å®ç°</li></ol><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210118160303.webp" alt="å›¾ç‰‡"></p></blockquote></li><li><p>zookeeperçš„é€‰ä¸¾æœºåˆ¶ä»¥åŠå¦‚ä½•ä¿è¯æ•´ä¸ªæ³¨å†Œä¸­å¿ƒçš„ç¨³å®šæ€§</p><blockquote><p><strong>é€‰ä¸¾ç®—æ³•å’Œæµç¨‹ï¼šFastLeaderElection(é»˜è®¤æä¾›çš„é€‰ä¸¾ç®—æ³•)ï¼š</strong></p><p>ç›®å‰æœ‰5å°æœåŠ¡å™¨ï¼Œæ¯å°æœåŠ¡å™¨å‡æ²¡æœ‰æ•°æ®ï¼Œå®ƒä»¬çš„ç¼–å·åˆ†åˆ«æ˜¯1,2,3,4,5,æŒ‰ç¼–å·ä¾æ¬¡å¯åŠ¨ï¼Œå®ƒä»¬çš„é€‰æ‹©ä¸¾è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li>æœåŠ¡å™¨1å¯åŠ¨ï¼Œç»™è‡ªå·±æŠ•ç¥¨ï¼Œç„¶åå‘æŠ•ç¥¨ä¿¡æ¯ï¼Œç”±äºå…¶å®ƒæœºå™¨è¿˜æ²¡æœ‰å¯åŠ¨æ‰€ä»¥å®ƒæ”¶ä¸åˆ°åé¦ˆä¿¡æ¯ï¼ŒæœåŠ¡å™¨1çš„çŠ¶æ€ä¸€ç›´å±äºLookingã€‚</li><li>æœåŠ¡å™¨2å¯åŠ¨ï¼Œç»™è‡ªå·±æŠ•ç¥¨ï¼ŒåŒæ—¶ä¸ä¹‹å‰å¯åŠ¨çš„æœåŠ¡å™¨1äº¤æ¢ç»“æœï¼Œç”±äºæœåŠ¡å™¨2çš„ç¼–å·å¤§æ‰€ä»¥æœåŠ¡å™¨2èƒœå‡ºï¼Œä½†æ­¤æ—¶æŠ•ç¥¨æ•°æ²¡æœ‰å¤§äºåŠæ•°ï¼Œæ‰€ä»¥ä¸¤ä¸ªæœåŠ¡å™¨çš„çŠ¶æ€ä¾ç„¶æ˜¯LOOKINGã€‚</li><li>æœåŠ¡å™¨3å¯åŠ¨ï¼Œç»™è‡ªå·±æŠ•ç¥¨ï¼ŒåŒæ—¶ä¸ä¹‹å‰å¯åŠ¨çš„æœåŠ¡å™¨1,2äº¤æ¢ä¿¡æ¯ï¼Œç”±äºæœåŠ¡å™¨3çš„ç¼–å·æœ€å¤§æ‰€ä»¥æœåŠ¡å™¨3èƒœå‡ºï¼Œæ­¤æ—¶æŠ•ç¥¨æ•°æ­£å¥½å¤§äºåŠæ•°ï¼Œæ‰€ä»¥æœåŠ¡å™¨3æˆä¸ºleaderï¼ŒæœåŠ¡å™¨1,2æˆä¸ºfollowerã€‚</li><li>æœåŠ¡å™¨4å¯åŠ¨ï¼Œç»™è‡ªå·±æŠ•ç¥¨ï¼ŒåŒæ—¶ä¸ä¹‹å‰å¯åŠ¨çš„æœåŠ¡å™¨1,2,3äº¤æ¢ä¿¡æ¯ï¼Œå°½ç®¡æœåŠ¡å™¨4çš„ç¼–å·å¤§ï¼Œä½†ä¹‹å‰æœåŠ¡å™¨3å·²ç»èƒœå‡ºï¼Œæ‰€ä»¥æœåŠ¡å™¨4åªèƒ½æˆä¸ºfollowerã€‚</li><li>æœåŠ¡å™¨5å¯åŠ¨ï¼Œåé¢çš„é€»è¾‘åŒæœåŠ¡å™¨4æˆä¸ºfollowerã€‚</li></ol></blockquote></li><li><p>åŠ¨æ€ä»£ç†çš„å®ç°æ–¹å¼ï¼ŒAOPçš„å®ç°æ–¹å¼ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p><blockquote><ol><li>JDKåŠ¨æ€ä»£ç†ï¼šåˆ©ç”¨åå°„æœºåˆ¶ç”Ÿæˆä¸€ä¸ªå®ç°ä»£ç†æ¥å£çš„åŒ¿åç±»ï¼Œåœ¨è°ƒç”¨å…·ä½“æ–¹æ³•å‰è°ƒç”¨InvokeHandleræ¥å¤„ç†ã€‚</li><li>CGlibåŠ¨æ€ä»£ç†ï¼šåˆ©ç”¨ASMï¼ˆå¼€æºçš„Javaå­—èŠ‚ç ç¼–è¾‘åº“ï¼Œæ“ä½œå­—èŠ‚ç ï¼‰å¼€æºåŒ…ï¼Œå°†ä»£ç†å¯¹è±¡ç±»çš„classæ–‡ä»¶åŠ è½½è¿›æ¥ï¼Œé€šè¿‡ä¿®æ”¹å…¶å­—èŠ‚ç ç”Ÿæˆå­ç±»æ¥å¤„ç†ã€‚</li><li>åŒºåˆ«ï¼šJDKä»£ç†åªèƒ½å¯¹å®ç°æ¥å£çš„ç±»ç”Ÿæˆä»£ç†ï¼›CGlibæ˜¯é’ˆå¯¹ç±»å®ç°ä»£ç†ï¼Œå¯¹æŒ‡å®šçš„ç±»ç”Ÿæˆä¸€ä¸ªå­ç±»ï¼Œå¹¶è¦†ç›–å…¶ä¸­çš„æ–¹æ³•ï¼Œè¿™ç§é€šè¿‡ç»§æ‰¿ç±»çš„å®ç°æ–¹å¼ï¼Œä¸èƒ½ä»£ç†finalä¿®é¥°çš„ç±»ã€‚</li></ol></blockquote></li><li><p>ThreadLocalçš„åŸç†</p></li><li><p>RedisæŒä¹…åŒ–æœºåˆ¶</p></li><li><p>ä¸€è‡´æ€§å“ˆå¸ŒåŸç†</p></li><li><p>ç¼“å­˜å‡»ç©¿å’Œç¼“å­˜é›ªå´©æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•è§£å†³</p><blockquote><p><strong>å‡»ç©¿ï¼š</strong>1.çƒ­ç‚¹æ•°æ®æ°¸ä¸å¤±æ•ˆï¼›2.ä»æ•°æ®åº“åŠ è½½ç¼“å­˜æ•°æ®çš„æ—¶å€™åŠ äº’æ–¥é”</p><p><strong>é›ªå´©ï¼š</strong><br><strong>é’ˆå¯¹ Redis æœåŠ¡ä¸å¯ç”¨çš„æƒ…å†µï¼š</strong></p><ol><li>é‡‡ç”¨ Redis é›†ç¾¤ï¼Œé¿å…å•æœºå‡ºç°é—®é¢˜æ•´ä¸ªç¼“å­˜æœåŠ¡éƒ½æ²¡åŠæ³•ä½¿ç”¨ã€‚</li><li>é™æµï¼Œé¿å…åŒæ—¶å¤„ç†å¤§é‡çš„è¯·æ±‚ã€‚</li></ol><p><strong>é’ˆå¯¹çƒ­ç‚¹ç¼“å­˜å¤±æ•ˆçš„æƒ…å†µï¼š</strong></p><ol><li>è®¾ç½®ä¸åŒçš„å¤±æ•ˆæ—¶é—´æ¯”å¦‚éšæœºè®¾ç½®ç¼“å­˜çš„å¤±æ•ˆæ—¶é—´ã€‚</li><li>ç¼“å­˜æ°¸ä¸å¤±æ•ˆã€‚</li></ol></blockquote></li><li><p>Java CPUè´Ÿè½½100%æ’æŸ¥æŠ€å·§</p><blockquote><ol><li>topå‘½ä»¤æŒ‰ç…§CPUæ’åºæ‰¾åˆ°å ç”¨é«˜çš„javaè¿›ç¨‹pidæ¯”å¦‚<code>9702 </code></li><li>top -H -p pidæŸ¥çœ‹è¿™ä¸ªè¿›ç¨‹ä¸­ï¼Œæ¶ˆè€—CPUæœ€å¤šçš„çº¿ç¨‹æ¯”å¦‚<code>10007</code>ï¼ˆ<code>top -Hbp 9702 | awk &#39;/java/ &amp;&amp; $9&gt;50&#39;</code>è¿™ä¸ªå‘½ä»¤è¡¨ç¤ºæŸ¥å‡ºCPUå ç”¨ç‡è¶…è¿‡æŸä¸ªå€¼çš„æ‰€æœ‰çº¿ç¨‹ï¼Œä¾‹å¦‚è¶…è¿‡50%ï¼‰</li><li>çº¿ç¨‹idè½¬æ¢ä¸ºåå…­è¿›åˆ¶<code>printf &quot;%x\n&quot; 10007</code> 16è¿›åˆ¶idä¸º<code>2717</code></li><li>ä½¿ç”¨jstackå§çº¿ç¨‹ä¿¡æ¯æ‰“å°å‡ºæ¥ï¼š<code>jstack $pid | grep 2717</code></li></ol></blockquote></li><li><p>æ­»é”å¦‚ä½•æ£€æµ‹</p><blockquote><p>jsp -l å¾—åˆ°è¿›ç¨‹pidï¼Œç„¶åjstack -l pid</p></blockquote></li></ul><h3 id="æœ‰èµ"><a href="#æœ‰èµ" class="headerlink" title="æœ‰èµ"></a>æœ‰èµ</h3><ul><li><p>å¼‚æ­¥æ›´æ–°ç¼“å­˜ï¼Œå¦‚æœè¯¥ç¼“å­˜æ˜¯åŸºäºå¤šå¼ è¡¨ç®—å‡ºæ¥çš„è¯ï¼Œåº”è¯¥å¦‚ä½•æ›´æ–°</p></li><li><p>Kafkaå’ŒRocketMQçš„åŒºåˆ«ï¼ˆåˆ†å±‚è®¾è®¡å’Œå­˜å‚¨çš„åŒºåˆ«ï¼‰</p></li><li><p>MQçš„é¡ºåºæ¶ˆæ¯ã€äº‹åŠ¡æ¶ˆæ¯ã€å»¶è¿Ÿæ¶ˆæ¯æ˜¯ä»€ä¹ˆ</p></li><li><p>Dubbo SPIæœºåˆ¶å’ŒJava SPIæœºåˆ¶çš„åŒºåˆ«</p></li><li><p>Redisè·³è¡¨çš„åŸç†</p></li><li><p>Redisç¼“å­˜ç©¿é€å’Œç¼“å­˜å‡»ç©¿ä»¥åŠå¦‚ä½•è§£å†³</p></li><li><p>MySQL MVCCåŸç†ä»‹ç»ä¸€ä¸‹</p></li><li><p>ThreadLocalçš„åŸç†ï¼ŒThreadLocalMapçš„keyæ˜¯ä»€ä¹ˆï¼Ÿ</p><blockquote><p>ThreadLocalMapçš„keyæ˜¯ThreadLocalçš„å®ä¾‹ï¼Œå› ä¸ºä¸€ä¸ªçº¿ç¨‹å¯ä»¥æœ‰å¤šä¸ªThreadLocalå˜é‡</p></blockquote></li><li><p>synchronizedå’ŒLockçš„åŒºåˆ«</p></li><li><p>FutureåŸç†</p></li><li><p>nettyåŸç†</p></li></ul><h3 id="äº¬ä¸œ"><a href="#äº¬ä¸œ" class="headerlink" title="äº¬ä¸œ"></a>äº¬ä¸œ</h3><ul><li><p>DDDçš„ç†è§£</p></li><li><p>å¦‚ä½•ä¿è¯ç³»ç»Ÿçš„é«˜å¯ç”¨</p></li><li><p>ç³»ç»Ÿä¸Šæ¸¸æŒ‚äº†æ€ä¹ˆåŠï¼Œé™çº§çš„è¯å¦‚ä½•é™çº§</p></li><li><p>æµé‡çªå¢çš„æƒ…å†µä¸‹ï¼Œåœ¨ä¸ä¿®æ”¹ä»£ç çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•åº”å¯¹è¿™ç§åœºæ™¯</p></li><li><p>RedisæŒä¹…åŒ–é…ç½®</p><blockquote><ul><li>ä¸è¦ä»…ä»…ä½¿ç”¨ RDBï¼Œå› ä¸ºé‚£æ ·ä¼šå¯¼è‡´ä½ ä¸¢å¤±å¾ˆå¤šæ•°æ®ï¼›</li><li>ä¹Ÿä¸è¦ä»…ä»…ä½¿ç”¨ AOFï¼Œå› ä¸ºé‚£æ ·æœ‰ä¸¤ä¸ªé—®é¢˜ï¼šç¬¬ä¸€ï¼Œä½ é€šè¿‡ AOF åšå†·å¤‡ï¼Œæ²¡æœ‰ RDB åšå†·å¤‡æ¥çš„æ¢å¤é€Ÿåº¦æ›´å¿«ï¼›ç¬¬äºŒï¼ŒRDB æ¯æ¬¡ç®€å•ç²—æš´ç”Ÿæˆæ•°æ®å¿«ç…§ï¼Œæ›´åŠ å¥å£®ï¼Œå¯ä»¥é¿å… AOF è¿™ç§å¤æ‚çš„å¤‡ä»½å’Œæ¢å¤æœºåˆ¶çš„ bugï¼›</li><li>Redis æ”¯æŒåŒæ—¶å¼€å¯å¼€å¯ä¸¤ç§æŒä¹…åŒ–æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç»¼åˆä½¿ç”¨ AOF å’Œ RDB ä¸¤ç§æŒä¹…åŒ–æœºåˆ¶ï¼Œç”¨ AOF æ¥ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œä½œä¸ºæ•°æ®æ¢å¤çš„ç¬¬ä¸€é€‰æ‹©; ç”¨ RDB æ¥åšä¸åŒç¨‹åº¦çš„å†·å¤‡ï¼Œåœ¨ AOF æ–‡ä»¶éƒ½ä¸¢å¤±æˆ–æŸåä¸å¯ç”¨çš„æ—¶å€™ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ RDB æ¥è¿›è¡Œå¿«é€Ÿçš„æ•°æ®æ¢å¤ã€‚</li></ul></blockquote></li><li><p>Redisåˆ é™¤ç­–ç•¥</p></li><li><p>ç¼“å­˜ç©¿é€ã€ç¼“å­˜é›ªå´©ï¼ˆé›ªå´©çš„è¯å¯ä»¥å¼‚æ­¥å»åˆ·æ–°ç¼“å­˜æ—¶é—´ï¼‰</p></li><li><p>Rediså¤§keyä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿå¤§keyå¦‚ä½•ä¼˜åŒ–</p><blockquote><p><strong>å¤§keyçš„é£é™©ï¼š</strong><br>1.è¯»å†™å¤§keyä¼šå¯¼è‡´è¶…æ—¶ä¸¥é‡ï¼Œç”šè‡³é˜»å¡æœåŠ¡ã€‚</p><p>2.å¦‚æœåˆ é™¤å¤§keyï¼ŒDELå‘½ä»¤å¯èƒ½é˜»å¡Redisè¿›ç¨‹æ•°åç§’ï¼Œä½¿å¾—å…¶ä»–è¯·æ±‚é˜»å¡ï¼Œå¯¹åº”ç”¨ç¨‹åºå’ŒRedisé›†ç¾¤å¯ç”¨æ€§é€ æˆä¸¥é‡çš„å½±å“ã€‚</p><p><strong>redisä½¿ç”¨ä¼šå‡ºç°å¤§keyçš„åœºæ™¯ï¼š</strong></p><p>1.å•ä¸ªç®€å•keyçš„å­˜å‚¨çš„valueè¿‡å¤§ï¼›</p><p>2.hashã€setã€zsetã€listä¸­å­˜å‚¨è¿‡å¤šçš„å…ƒç´ ã€‚</p><p><strong>è§£å†³é—®é¢˜ï¼š</strong></p><p>å•ä¸ªç®€å•keyçš„å­˜å‚¨çš„valueè¿‡å¤§çš„è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>å°†å¤§keyæ‹†åˆ†æˆå¯¹ä¸ªkey-valueï¼Œä½¿ç”¨multiGetæ–¹æ³•è·å¾—å€¼ï¼Œè¿™æ ·çš„æ‹†åˆ†ä¸»è¦æ˜¯ä¸ºäº†å‡å°‘å•å°æ“ä½œçš„å‹åŠ›ï¼Œè€Œæ˜¯å°†å‹åŠ›å¹³æ‘Šåˆ°é›†ç¾¤å„ä¸ªå®ä¾‹ä¸­ï¼Œé™ä½å•å°æœºå™¨çš„IOæ“ä½œã€‚</li></ul><p>hashã€setã€zsetã€listä¸­å­˜å‚¨è¿‡å¤šçš„å…ƒç´ çš„è§£å†³æ–¹æ¡ˆï¼š</p><ul><li><p>ç±»ä¼¼äºç¬¬ä¸€ç§åœºæ™¯ï¼Œä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ¡ˆæ‹†åˆ†;</p></li><li><p>ä»¥hashä¸ºä¾‹ï¼Œå°†åŸå…ˆçš„hgetã€hsetæ–¹æ³•æ”¹æˆï¼ˆåŠ å…¥å›ºå®šä¸€ä¸ªhashæ¡¶çš„æ•°é‡ä¸º10000ï¼‰ï¼Œå…ˆè®¡ç®—field- çš„hashå€¼æ¨¡å–10000ï¼Œç¡®å®šè¯¥fieldåœ¨å“ªä¸€ä¸ªkeyä¸Šã€‚</p></li></ul></blockquote></li><li><p>RedisåŸºç¡€æ•°æ®ç»“æ„</p></li><li><p>MySQL INNODBå¼•æ“æ²¡æœ‰è®¾ç½®ä¸»é”®ä¼šæœ‰ä»€ä¹ˆé—®é¢˜</p><blockquote><ul><li>ä½¿ç”¨ä¸äº†ä¸»é”®ç´¢å¼•ï¼ŒæŸ¥è¯¢ä¼šè¿›è¡Œå…¨è¡¨æ‰«æ</li><li>å½±å“æ•°æ®æ’å…¥æ€§èƒ½ï¼Œæ’å…¥æ•°æ®éœ€è¦ç”ŸæˆROW_IDï¼Œè€Œç”Ÿæˆçš„ROW_IDæ˜¯å…¨å±€å…±äº«çš„ï¼Œå¹¶å‘ä¼šå¯¼è‡´é”ç«äº‰ï¼Œå½±å“æ€§èƒ½</li></ul></blockquote></li><li><p>B+Treeç´¢å¼•å’ŒHashç´¢å¼•çš„ä¼˜åŠ£</p></li><li><p>MySQLå¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹è¯»å’Œå†™æ˜¯å¦‚ä½•åŠ é”çš„ï¼Ÿ</p></li><li><p>è¡Œé”æ˜¯åŠ åœ¨ä»€ä¹ˆä¸Šé¢ï¼Ÿï¼ˆç´¢å¼•ï¼‰</p></li><li><p>JVMä¼˜åŒ–çš„æ€è·¯ï¼ˆä¿æŒjvmçš„ç¨³å®šï¼Œé¿å…é¢‘ç¹gcï¼‰</p><blockquote><p><strong>ç­–ç•¥ 1ï¼š</strong>å°†æ–°å¯¹è±¡é¢„ç•™åœ¨æ–°ç”Ÿä»£ï¼Œç”±äº Full GC çš„æˆæœ¬è¿œé«˜äº Minor GCï¼Œå› æ­¤å°½å¯èƒ½å°†å¯¹è±¡åˆ†é…åœ¨æ–°ç”Ÿä»£æ˜¯æ˜æ™ºçš„åšæ³•ï¼Œå®é™…é¡¹ç›®ä¸­æ ¹æ® GC æ—¥å¿—åˆ†ææ–°ç”Ÿä»£ç©ºé—´å¤§å°åˆ†é…æ˜¯å¦åˆç†ï¼Œé€‚å½“é€šè¿‡â€œ-Xmnâ€å‘½ä»¤è°ƒèŠ‚æ–°ç”Ÿä»£å¤§å°ï¼Œæœ€å¤§é™åº¦é™ä½æ–°å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£çš„æƒ…å†µã€‚</p><p><strong>ç­–ç•¥ 2ï¼š</strong>å¤§å¯¹è±¡è¿›å…¥è€å¹´ä»£ï¼Œè™½ç„¶å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå°†å¯¹è±¡åˆ†é…åœ¨æ–°ç”Ÿä»£æ˜¯åˆç†çš„ã€‚ä½†æ˜¯å¯¹äºå¤§å¯¹è±¡è¿™ç§åšæ³•å´å€¼å¾—å•†æ¦·ï¼Œå¤§å¯¹è±¡å¦‚æœé¦–æ¬¡åœ¨æ–°ç”Ÿä»£åˆ†é…å¯èƒ½ä¼šå‡ºç°ç©ºé—´ä¸è¶³å¯¼è‡´å¾ˆå¤šå¹´é¾„ä¸å¤Ÿçš„å°å¯¹è±¡è¢«åˆ†é…çš„è€å¹´ä»£ï¼Œç ´åæ–°ç”Ÿä»£çš„å¯¹è±¡ç»“æ„ï¼Œå¯èƒ½ä¼šå‡ºç°é¢‘ç¹çš„ full gcã€‚å› æ­¤ï¼Œå¯¹äºå¤§å¯¹è±¡ï¼Œå¯ä»¥è®¾ç½®ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼ˆå½“ç„¶çŸ­å‘½çš„å¤§å¯¹è±¡å¯¹äºåƒåœ¾å›æ”¶æ¥è¯´ç®€ç›´å°±æ˜¯å™©æ¢¦ï¼‰ã€‚<code>-XX:PretenureSizeThreshold</code> å¯ä»¥è®¾ç½®ç›´æ¥è¿›å…¥è€å¹´ä»£çš„å¯¹è±¡å¤§å°ã€‚</p><p><strong>ç­–ç•¥ 3ï¼š</strong>åˆç†è®¾ç½®è¿›å…¥è€å¹´ä»£å¯¹è±¡çš„å¹´é¾„ï¼Œ<code>-XX:MaxTenuringThreshold</code> è®¾ç½®å¯¹è±¡è¿›å…¥è€å¹´ä»£çš„å¹´é¾„å¤§å°ï¼Œå‡å°‘è€å¹´ä»£çš„å†…å­˜å ç”¨ï¼Œé™ä½ full gc å‘ç”Ÿçš„é¢‘ç‡ã€‚</p><p><strong>ç­–ç•¥ 4ï¼š</strong>è®¾ç½®ç¨³å®šçš„å †å¤§å°ï¼Œå †å¤§å°è®¾ç½®æœ‰ä¸¤ä¸ªå‚æ•°ï¼š<code>-Xms</code> åˆå§‹åŒ–å †å¤§å°ï¼Œ<code>-Xmx</code> æœ€å¤§å †å¤§å°ã€‚</p><p><strong>ç­–ç•¥5ï¼š</strong>æ³¨æ„ï¼š å¦‚æœæ»¡è¶³ä¸‹é¢çš„æŒ‡æ ‡ï¼Œ<strong>åˆ™ä¸€èˆ¬ä¸éœ€è¦è¿›è¡Œ GC ä¼˜åŒ–ï¼š</strong></p><blockquote><p>MinorGC æ‰§è¡Œæ—¶é—´ä¸åˆ°50msï¼› Minor GC æ‰§è¡Œä¸é¢‘ç¹ï¼Œçº¦10ç§’ä¸€æ¬¡ï¼› Full GC æ‰§è¡Œæ—¶é—´ä¸åˆ°1sï¼› Full GC æ‰§è¡Œé¢‘ç‡ä¸ç®—é¢‘ç¹ï¼Œä¸ä½äº10åˆ†é’Ÿ1æ¬¡ã€‚</p></blockquote></blockquote></li><li><p>å‘ç°è™šæ‹Ÿæœºé¢‘ç¹full GCæ—¶åº”è¯¥æ€ä¹ˆåŠï¼ˆfull GCæŒ‡çš„æ˜¯æ¸…ç†æ•´ä¸ªå †ç©ºé—´ï¼ŒåŒ…æ‹¬å¹´è½»ä»£å’Œæ°¸ä¹…ä»£ï¼‰</p><blockquote><ol><li>é¦–å…ˆç”¨å‘½ä»¤æŸ¥çœ‹è§¦å‘GCçš„åŸå› æ˜¯ä»€ä¹ˆ jstat â€“gccause è¿›ç¨‹id</li><li>å¦‚æœæ˜¯System.gc()ï¼Œåˆ™çœ‹ä¸‹ä»£ç å“ªé‡Œè°ƒç”¨äº†è¿™ä¸ªæ–¹æ³•ï¼ˆå¯ä»¥é€šè¿‡-XX:+ DisableExplicitGCæ¥ç¦æ­¢RMIè°ƒç”¨System.gcï¼‰</li><li>å¦‚æœæœ‰perm gençš„è¯ï¼ˆjdk1.8å°±æ²¡äº†ï¼‰ï¼Œ<strong>è¦ç»™perm genåˆ†é…ç©ºé—´ï¼Œä½†æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´æ—¶</strong>ï¼Œä¼šè§¦å‘full gcã€‚æ‰€ä»¥çœ‹çœ‹æ˜¯ä¸æ˜¯perm genåŒºçš„å€¼è®¾ç½®å¾—å¤ªå°äº†ã€‚</li><li>å¦‚æœæ˜¯ä¸€æ¬¡fullgcä¹‹åï¼Œå‰©ä½™å¯¹è±¡ä¸å¤šã€‚é‚£ä¹ˆè¯´æ˜ä½ çš„edenåŒºè®¾ç½®å¤ªå°ï¼Œå¯¼è‡´ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡è¿›å…¥äº†è€å¹´ä»£ã€‚</li><li>å¦‚æœä¸€æ¬¡fullgcä¹‹åï¼Œè€å¹´ä»£å›æ”¶ç‡ä¸å¤§ï¼Œé‚£ä¹ˆè¯´æ˜è€å¹´ä»£å¤ªå°ã€‚</li><li>å¦‚æœæ˜¯heap inspection(å†…å­˜æ£€æŸ¥)ï¼Œå¯èƒ½æ˜¯å“ªé‡Œæ‰§è¡Œjmap â€“histo[:live]å‘½ä»¤</li><li>å¦‚æœæ˜¯GC lockerï¼Œå¯èƒ½æ˜¯ç¨‹åºä¾èµ–çš„JNIåº“çš„åŸå› </li></ol></blockquote></li><li><p>åƒåœ¾å›æ”¶ç®—æ³•</p><blockquote><p><strong>Mark-Sweepï¼ˆæ ‡è®°-æ¸…é™¤ç®—æ³•ï¼‰ï¼š</strong></p><p>ï¼ˆ1ï¼‰æ€æƒ³ï¼šæ ‡è®°æ¸…é™¤ç®—æ³•åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œæ ‡è®°é˜¶æ®µå’Œæ¸…é™¤é˜¶æ®µã€‚æ ‡è®°é˜¶æ®µä»»åŠ¡æ˜¯æ ‡è®°å‡ºæ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œæ¸…é™¤é˜¶æ®µå°±æ˜¯æ¸…é™¤è¢«æ ‡è®°å¯¹è±¡çš„ç©ºé—´ã€‚<br>ï¼ˆ2ï¼‰ä¼˜ç¼ºç‚¹ï¼šå®ç°ç®€å•ï¼Œå®¹æ˜“äº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œå¯¼è‡´éœ€è¦åˆ†é…ä¸€ä¸ªè¾ƒå¤§è¿ç»­ç©ºé—´æ—¶å®¹æ˜“è§¦å‘FGCã€‚</p><p><strong>Copyingï¼ˆå¤åˆ¶æ¸…é™¤ç®—æ³•ï¼‰ï¼š</strong></p><p>ï¼ˆ1ï¼‰æ€æƒ³ï¼šå°†å¯ç”¨å†…å­˜åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­çš„ä¸€å—ã€‚å½“è¿›è¡Œåƒåœ¾å›æ”¶çš„æ—¶å€™äº†ï¼ŒæŠŠå…¶ä¸­å­˜æ´»å¯¹è±¡å…¨éƒ¨å¤åˆ¶åˆ°å¦å¤–ä¸€å—ä¸­ï¼Œç„¶åæŠŠå·²ä½¿ç”¨çš„å†…å­˜ç©ºé—´ä¸€æ¬¡æ¸…ç©ºæ‰ã€‚<br>ï¼ˆ2ï¼‰ä¼˜ç¼ºç‚¹ï¼šä¸å®¹æ˜“äº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼›å¯ç”¨å†…å­˜ç©ºé—´å°‘ï¼›å­˜æ´»å¯¹è±¡å¤šçš„è¯ï¼Œæ•ˆç‡ä½ä¸‹ã€‚</p><p><strong>Mark-Compactï¼ˆæ ‡è®°-æ•´ç†ç®—æ³•ï¼‰ï¼š</strong></p><p>ï¼ˆ1ï¼‰æ€æƒ³ï¼šå…ˆæ ‡è®°å­˜æ´»å¯¹è±¡ï¼Œç„¶åæŠŠå­˜æ´»å¯¹è±¡å‘ä¸€è¾¹ç§»åŠ¨ï¼Œç„¶åæ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚<br>ï¼ˆ2ï¼‰ä¼˜ç¼ºç‚¹ï¼šä¸å®¹æ˜“äº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼›å†…å­˜åˆ©ç”¨ç‡é«˜ï¼›å­˜æ´»å¯¹è±¡å¤šå¹¶ä¸”åˆ†æ•£çš„æ—¶å€™ï¼Œç§»åŠ¨æ¬¡æ•°å¤šï¼Œæ•ˆç‡ä½ä¸‹</p><p><strong>åˆ†ä»£æ”¶é›†ç®—æ³•ï¼š</strong>ï¼ˆç›®å‰å¤§éƒ¨åˆ†JVMçš„åƒåœ¾æ”¶é›†å™¨æ‰€é‡‡ç”¨çš„ç®—æ³•ï¼Œæ€æƒ³ï¼šæŠŠå †åˆ†æˆæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œæ°¸ä¹…ä»£æŒ‡çš„æ˜¯æ–¹æ³•åŒºï¼‰ï¼š</p><p>ï¼ˆ1ï¼‰ å› ä¸ºæ–°ç”Ÿä»£æ¯æ¬¡åƒåœ¾å›æ”¶éƒ½è¦å›æ”¶å¤§éƒ¨åˆ†å¯¹è±¡ï¼Œæ‰€ä»¥æ–°ç”Ÿä»£é‡‡ç”¨<strong>Copying</strong>ç®—æ³•ã€‚æ–°ç”Ÿä»£é‡Œé¢åˆ†æˆä¸€ä»½è¾ƒå¤§çš„Edenç©ºé—´å’Œä¸¤ä»½è¾ƒå°çš„Survivorç©ºé—´ã€‚æ¯æ¬¡åªä½¿ç”¨Edenå’Œå…¶ä¸­ä¸€å—Survivorç©ºé—´ï¼Œç„¶ååƒåœ¾å›æ”¶çš„æ—¶å€™ï¼ŒæŠŠå­˜æ´»å¯¹è±¡æ”¾åˆ°æœªä½¿ç”¨çš„Survivorï¼ˆåˆ’åˆ†å‡ºfromã€toï¼‰ç©ºé—´ä¸­ï¼Œæ¸…ç©ºEdenå’Œåˆšæ‰ä½¿ç”¨è¿‡çš„Survivorç©ºé—´ã€‚<br>ï¼ˆ2ï¼‰ ç”±äºè€å¹´ä»£æ¯æ¬¡åªå›æ”¶å°‘é‡çš„å¯¹è±¡ï¼Œå› æ­¤é‡‡ç”¨<strong>mark-compact</strong>ç®—æ³•ã€‚<br>ï¼ˆ3ï¼‰ åœ¨å †åŒºå¤–æœ‰ä¸€ä¸ªæ°¸ä¹…ä»£ã€‚å¯¹æ°¸ä¹…ä»£çš„å›æ”¶ä¸»è¦æ˜¯æ— æ•ˆçš„ç±»å’Œå¸¸é‡</p></blockquote></li><li><p>CMSæ˜¯æ€ä¹ˆè¿›è¡Œåƒåœ¾å›æ”¶çš„ï¼Ÿï¼ˆç›¸å…³ï¼šG1åƒåœ¾å›æ”¶è¿‡ç¨‹ï¼‰</p><blockquote><p><strong>CMSæ”¶é›†å™¨</strong>åŸºäºâ€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ï¼š</p><p>ä¼˜ç‚¹æœ‰ï¼šå¹¶å‘æ”¶é›†ã€ä½åœé¡¿</p><p>ç¼ºç‚¹ï¼šå¯¹CPUèµ„æºéå¸¸æ•æ„Ÿï¼Œå¯¼è‡´ç¨‹åºå˜æ…¢ï¼ŒCMSæ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ï¼Œå®¹æ˜“ äº§ç”Ÿå¤§é‡ç©ºé—´ç¢ç‰‡ã€‚</p><p>åƒåœ¾å›æ”¶è¿‡ç¨‹åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼š<strong>åˆå§‹æ ‡è®°</strong>ã€<strong>å¹¶å‘æ ‡è®°</strong> ã€<strong>é‡æ–°æ ‡è®°</strong> ã€<strong>å¹¶å‘æ¸…é™¤ï¼š</strong></p><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210121172804.png" alt="CMS åƒåœ¾æ”¶é›†å™¨ "></p><p><strong>G1 æ”¶é›†å™¨</strong>åŸºäºâ€œæ ‡è®°-æ•´ç†â€ç®—æ³•ï¼š</p><p>ä¼˜ç‚¹æœ‰ï¼š</p><ol><li>ä¸äº§ç”Ÿå†…å­˜ç¢ç‰‡</li><li>å¯ä»¥éå¸¸ç²¾ç¡®çš„æ§åˆ¶åœé¡¿æ—¶é—´ï¼Œåœ¨ä¸ç‰ºç‰²ååé‡å‰æä¸‹ï¼Œå®ç°ä½åœé¡¿åƒåœ¾å›æ”¶</li></ol><p>G1å·¥ä½œè¿‡ç¨‹åˆ†ä¸ºå‡ ä¸ªæ­¥éª¤ï¼š<strong>åˆå§‹æ ‡è®°</strong>ã€<strong>å¹¶å‘æ ‡è®°</strong>ã€<strong>æœ€ç»ˆæ ‡è®°</strong>ã€<strong>ç­›é€‰å›æ”¶</strong>ã€‚</p></blockquote></li><li><p>ç”Ÿäº§ç¯å¢ƒé‡åˆ°JVMé—®é¢˜å¦‚ä½•å»è§£å†³ï¼Ÿè§£å†³çš„æ­¥éª¤æœ‰å“ªäº›</p></li><li><p>å¹¶å‘ç¼–ç¨‹çº¿ç¨‹å®‰å…¨ä¸‰å¤§é—®é¢˜ï¼šå¯è§æ€§ã€æœ‰åºæ€§ã€åŸå­æ€§åˆ†åˆ«å¦‚ä½•å»ä¿è¯ï¼Ÿ</p><blockquote><p>å†…å­˜æ¨¡å‹è§£å†³å¹¶å‘é—®é¢˜ä¸»è¦é‡‡ç”¨ä¸¤ç§æ–¹å¼ï¼š<strong>é™åˆ¶å¤„ç†å™¨ä¼˜åŒ–</strong>å’Œ<strong>ä½¿ç”¨å†…å­˜å±éšœ</strong>ã€‚</p><ul><li><p><strong>å¯è§æ€§</strong>ï¼šé™¤äº†<code>volatile</code>ä¹‹å¤–ï¼ŒJavaä¸­çš„<code>synchronized</code>å’Œ<code>final</code>ä¸¤ä¸ªå…³é”®å­—ä¹Ÿå¯ä»¥å®ç°å¯è§æ€§</p></li><li><p><strong>æœ‰åºæ€§</strong>ï¼šåœ¨Javaä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>synchronized</code>å’Œ<code>volatile</code>æ¥ä¿è¯å¤šçº¿ç¨‹ä¹‹é—´æ“ä½œçš„æœ‰åºæ€§ã€‚å®ç°æ–¹å¼æœ‰æ‰€åŒºåˆ«ï¼š</p><p><code>volatile</code>å…³é”®å­—ä¼šç¦æ­¢æŒ‡ä»¤é‡æ’ã€‚<code>synchronized</code>å…³é”®å­—ä¿è¯åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€æ¡çº¿ç¨‹æ“ä½œã€‚</p></li><li><p><strong>åŸå­æ€§</strong>ï¼šåœ¨Javaä¸­ï¼Œä¸ºäº†ä¿è¯åŸå­æ€§ï¼Œæä¾›äº†ä¸¤ä¸ªé«˜çº§çš„å­—èŠ‚ç æŒ‡ä»¤<code>monitorenter</code>å’Œ<code>monitorexit</code>ã€‚è¿™ä¸¤ä¸ªå­—èŠ‚ç ï¼Œåœ¨Javaä¸­å¯¹åº”çš„å…³é”®å­—å°±æ˜¯<code>synchronized</code>ã€‚</p><p>å› æ­¤ï¼Œåœ¨Javaä¸­å¯ä»¥ä½¿ç”¨<code>synchronized</code>æ¥ä¿è¯æ–¹æ³•å’Œä»£ç å—å†…çš„æ“ä½œæ˜¯åŸå­æ€§çš„ã€‚</p></li></ul></blockquote></li><li><p>volatileå¦‚ä½•ä¿è¯å¯è§æ€§</p><blockquote><p>å¦‚æœå¯¹å£°æ˜äº†volatileçš„å˜é‡è¿›è¡Œå†™æ“ä½œï¼ŒJVMå°±ä¼šå‘å¤„ç†å™¨å‘é€ä¸€æ¡<strong>Lock</strong>å‰ç¼€çš„æŒ‡ä»¤ï¼Œå°†è¿™ä¸ªå˜é‡æ‰€åœ¨ç¼“å­˜è¡Œçš„æ•°æ®å†™å›åˆ°ç³»ç»Ÿå†…å­˜ã€‚åœ¨å¤šå¤„ç†å™¨ä¸‹ï¼Œä¸ºäº†ä¿è¯å„ä¸ªå¤„ç†å™¨çš„ç¼“å­˜æ˜¯ä¸€è‡´çš„ï¼Œå°±ä¼šå®ç°ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼Œæ¯ä¸ªå¤„ç†å™¨é€šè¿‡å—…æ¢åœ¨æ€»çº¿ä¸Šä¼ æ’­çš„æ•°æ®æ¥æ£€æŸ¥è‡ªå·±ç¼“å­˜çš„å€¼æ˜¯ä¸æ˜¯è¿‡æœŸäº†ï¼Œå½“å¤„ç†å™¨å‘ç°è‡ªå·±ç¼“å­˜è¡Œå¯¹åº”çš„å†…å­˜åœ°å€è¢«ä¿®æ”¹ï¼Œå°±ä¼šå°†å½“å‰å¤„ç†å™¨çš„ç¼“å­˜è¡Œè®¾ç½®ä¸ºæ— æ•ˆçŠ¶æ€ï¼Œå½“å¤„ç†å™¨å¯¹è¿™ä¸ªæ•°æ®è¿›è¡Œä¿®æ”¹æ“ä½œçš„æ—¶å€™ï¼Œä¼šé‡æ–°ä»ç³»ç»Ÿå†…å­˜ä¸­æŠŠæ•°æ®è¯»åˆ°å¤„ç†å™¨ç¼“å­˜é‡Œã€‚</p><p>volatileä¸¤æ¡å®ç°åŸåˆ™ï¼š</p><ol><li><strong>Lockå‰ç¼€æŒ‡ä»¤ä¼šå¼•èµ·å¤„ç†å™¨ç¼“å­˜å›å†™åˆ°å†…å­˜</strong>ã€‚LOCK#ä¿¡å·ç¡®ä¿åœ¨å£°è¨€è¯¥ä¿¡å·æœŸé—´ï¼Œå¤„ç†å™¨å¯ä»¥ç‹¬å å…±äº«å†…å­˜ï¼ˆé€šè¿‡é”ä½æ€»çº¿ï¼Œå¯¼è‡´å…¶ä»–CPUä¸èƒ½è®¿é—®æ€»çº¿ï¼Œä¸èƒ½è®¿é—®æ€»çº¿å°±æ„å‘³ç€ä¸èƒ½è®¿é—®ç³»ç»Ÿå†…å­˜ï¼‰ã€‚ä½†åœ¨æœ€è¿‘çš„å¤„ç†å™¨é‡Œï¼ŒLOCK#ä¿¡å·ä¸€èˆ¬ä¸é”æ€»çº¿ï¼Œè€Œæ˜¯é”ç¼“å­˜ï¼Œé”æ€»çº¿å¼€é”€æ¯”è¾ƒå¤§ã€‚åœ¨P6å’Œç›®å‰çš„å¤„ç†å™¨ä¸­ï¼Œå¦‚æœè®¿é—®çš„å†…å­˜åŒºåŸŸå·²ç»ç¼“å­˜åœ¨å¤„ç†å™¨å†…éƒ¨ï¼Œåˆ™ä¸ä¼šå£°è¨€LOCK#ä¿¡å·ã€‚ç›¸åï¼Œå®ƒä¼šé”å®šè¿™å—å†…å­˜åŒºåŸŸçš„ç¼“å­˜å¹¶å›å†™åˆ°å†…å­˜ï¼Œå¹¶ä½¿ç”¨ç¼“å­˜ä¸€è‡´æ€§æœºåˆ¶æ¥ç¡®å®šä¿®æ”¹çš„åŸå­æ€§ï¼Œæ­¤æ“ä½œè¢«ç§°ä¸ºâ€œç¼“å­˜é”å®šâ€ï¼Œ<strong>ç¼“å­˜ä¸€è‡´æ€§ä¼šé˜»æ­¢åŒæ—¶ä¿®æ”¹ç”±ä¸¤ä¸ªä»¥ä¸Šå¤„ç†å™¨ç¼“å­˜çš„å†…å­˜åŒºåŸŸæ•°æ®</strong>ã€‚</li><li><strong>ä¸€ä¸ªå¤„ç†å™¨çš„ç¼“å­˜ä¼šå†™åˆ°å†…å­˜ä¼šå¯¼è‡´å…¶ä»–å¤„ç†å™¨çš„ç¼“å­˜æ— æ•ˆ</strong>ã€‚éƒ¨åˆ†å¤„ç†å™¨ä½¿ç”¨MESIï¼ˆä¿®æ”¹ã€ç‹¬å ã€å…±äº«ã€æ— æ•ˆï¼‰æ§åˆ¶åè®®å»ç»´æŠ¤å†…éƒ¨ç¼“å­˜å’Œå…¶ä»–å¤„ç†å™¨ç¼“å­˜çš„ä¸€è‡´æ€§ã€‚å¤„ç†å™¨ä½¿ç”¨<strong>å—…æ¢æŠ€æœ¯</strong>ä¿è¯å®ƒçš„å†…éƒ¨ç¼“å­˜ã€ç³»ç»Ÿå†…å­˜å’Œå…¶ä»–å¤„ç†å™¨çš„ç¼“å­˜çš„æ•°æ®åœ¨æ€»çº¿ä¸Šä¿æŒä¸€è‡´ã€‚</li></ol></blockquote></li><li><p>volatileå¦‚ä½•ä¿è¯æœ‰åºæ€§</p><blockquote><p>å®ƒæ˜¯é€šè¿‡<strong>å†…å­˜å±éšœ</strong>æ¥å®ç°çš„ã€‚</p><p>ä»€ä¹ˆæ˜¯å†…å­˜å±éšœï¼Ÿç¡¬ä»¶å±‚é¢ï¼Œå†…å­˜å±éšœåˆ†ä¸¤ç§ï¼šè¯»å±éšœï¼ˆLoad Barrierï¼‰å’Œå†™å±éšœï¼ˆStore Barrierï¼‰ã€‚å†…å­˜å±éšœæœ‰ä¸¤ä¸ªä½œç”¨ï¼š</p><ol><li>é˜»æ­¢å±éšœä¸¤ä¾§çš„æŒ‡ä»¤é‡æ’åºï¼›</li><li>å¼ºåˆ¶æŠŠå†™ç¼“å†²åŒº&#x2F;é«˜é€Ÿç¼“å­˜ä¸­çš„è„æ•°æ®ç­‰å†™å›ä¸»å†…å­˜ï¼Œæˆ–è€…è®©ç¼“å­˜ä¸­ç›¸åº”çš„æ•°æ®å¤±æ•ˆã€‚</li></ol></blockquote></li><li><p>volatileèƒ½å¦ä¿è¯åŸå­æ€§ï¼Ÿ</p><blockquote><p>ä¸èƒ½ã€‚Num++è¿™ç§æ“ä½œæ— æ³•ä¿è¯åŸå­æ€§ï¼ŒNum++å¯ä»¥åˆ†ä¸ºä¸‰æ­¥ï¼šè¯»å–içš„å€¼ï¼Œå°†içš„å€¼+1ï¼Œå†™å…¥æœ€æ–°çš„iå€¼ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼šå½“çº¿ç¨‹1æ‰§è¡ŒNum++è¯­å¥æ—¶ï¼Œå…ˆæ˜¯è¯»å…¥Numçš„å€¼ä¸º0ï¼Œå€˜è‹¥æ­¤æ—¶è®©å‡ºCPUæ‰§è¡Œæƒï¼Œçº¿ç¨‹2è·å¾—æ‰§è¡Œï¼Œçº¿ç¨‹2ä¼šé‡æ–°ä»ä¸»å†…å­˜ä¸­ï¼Œè¯»å…¥Numçš„å€¼è¿˜æ˜¯0ï¼Œç„¶åçº¿ç¨‹2æ‰§è¡Œ+1æ“ä½œï¼Œæœ€åæŠŠNum&#x3D;1åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼› çº¿ç¨‹2æ‰§è¡Œå®Œåï¼Œçº¿ç¨‹1ç”±å¼€å§‹æ‰§è¡Œï¼Œä½†ä¹‹å‰å·²ç»è¯»å–çš„Numçš„å€¼0ï¼Œæ‰€ä»¥å®ƒè¿˜æ˜¯åœ¨0çš„åŸºç¡€ä¸Šæ‰§è¡Œ+1æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¿˜æ˜¯ç­‰äº1ï¼Œå¹¶åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ã€‚ æ‰€ä»¥æœ€åè¾“å‡ºç»“æœå¯èƒ½æ˜¯1ä¹Ÿå¯èƒ½æ˜¯2ã€‚</p></blockquote></li><li><p>synchronizedå¦‚ä½•ä¿è¯å¯è§æ€§</p><blockquote><p>Synchronizedèƒ½å¤Ÿå®ç°åŸå­æ€§å’Œå¯è§æ€§ï¼›åœ¨Javaå†…å­˜æ¨¡å‹ä¸­ï¼Œsynchronizedè§„å®šï¼Œçº¿ç¨‹åœ¨åŠ é”æ—¶ï¼Œå…ˆæ¸…ç©ºå·¥ä½œå†…å­˜â†’åœ¨ä¸»å†…å­˜ä¸­æ‹·è´æœ€æ–°å˜é‡çš„å‰¯æœ¬åˆ°å·¥ä½œå†…å­˜â†’æ‰§è¡Œå®Œä»£ç â†’å°†æ›´æ”¹åçš„å…±äº«å˜é‡çš„å€¼åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­â†’é‡Šæ”¾äº’æ–¥é”ã€‚</p></blockquote></li><li><p>synchronizedå¦‚ä½•ä¿è¯æœ‰åºæ€§</p><blockquote><p>synchronizedçš„æœ‰åºæ€§ç”±â€ä¸€ä¸ªå˜é‡åœ¨åŒä¸€ä¸ªæ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹å¯¹å…¶è¿›è¡Œlockæ“ä½œâ€œè¿™æ¡è§„åˆ™è·å¾—çš„ï¼Œè¿™ä¸ªè§„åˆ™å†³å®šäº†ä¸€ä¸ªé”çš„ä¸¤ä¸ªåŒæ­¥ä»£ç å—åªèƒ½ä¸²è¡Œåœ°è¿›å…¥ã€‚</p></blockquote></li><li><p>synchronizedé”å‡çº§çš„è¿‡ç¨‹</p><blockquote><p>æ— é”â†’åå‘é”â†’è½»é‡çº§é”â†’é‡é‡çº§é”</p></blockquote></li><li><p>ä½¿ç”¨çº¿ç¨‹æ± æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ</p><blockquote><p>åˆç†çš„ä½¿ç”¨çº¿ç¨‹æ± èƒ½å¤Ÿå¸¦æ¥ä¸‰ä¸ªå¥½å¤„ï¼š</p><ol><li><strong>é™ä½èµ„æºæ¶ˆè€—</strong>ã€‚é€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„æ¶ˆè€—ã€‚</li><li><strong>æé«˜å“åº”é€Ÿåº¦</strong>ã€‚å½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦ç­‰åˆ°çº¿ç¨‹åˆ›å»ºå°±èƒ½ç«‹å³æ‰§è¡Œã€‚</li><li><strong>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§</strong>ã€‚çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœæ— é™åˆ¶çš„åˆ›å»ºï¼Œä¸ä»…ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥è¿›è¡Œç»Ÿä¸€åˆ†é…ã€è°ƒä¼˜å’Œç›‘æ§ã€‚</li></ol></blockquote></li><li><p>çº¿ç¨‹åˆ›å»ºçš„åŸºæœ¬å¼€é”€å’Œçº¿ç¨‹åˆ‡æ¢å¼€é”€</p><blockquote><p>çº¿ç¨‹åˆ›å»ºå¼€é”€ï¼š</p><ul><li>ä¸ºçº¿ç¨‹å †æ ˆåˆ†é…å¹¶åˆå§‹åŒ–ä¸€å¤§å—å†…å­˜</li><li>éœ€è¦è¿›è¡Œç³»ç»Ÿè°ƒç”¨ä»¥åœ¨ä¸»æœºOSä¸­åˆ›å»º&#x2F;æ³¨å†Œæœ¬æœºçº¿ç¨‹</li><li>åˆ›å»ºåˆå§‹åŒ–æè¿°ç¬¦å¹¶å°†å…¶æ·»åŠ åˆ°JVMå†…éƒ¨æ•°æ®ç»“æ„ä¸­</li></ul><p>çº¿ç¨‹åˆ‡æ¢å¼€é”€ï¼š</p><p>çº¿ç¨‹åˆ‡æ¢çš„æ—¶å€™è¿˜è¦æ‰§è¡Œå†…å­˜æ¢é¡µï¼ŒCPU çš„ç¼“å­˜è¢«æ¸…ç©ºï¼Œåˆ‡æ¢å›æ¥çš„æ—¶å€™è¿˜è¦é‡æ–°ä»å†…å­˜ä¸­è¯»å–ä¿¡æ¯ï¼Œç ´åäº†æ•°æ®çš„å±€éƒ¨æ€§ã€‚ã€åˆ†é…å†…å­˜ã€åˆ—å…¥è°ƒåº¦ã€å†…å­˜æ¢é¡µã€æ¸…ç©ºç¼“å­˜å’Œé‡æ–°è¯»å–ã€‘</p></blockquote></li><li><p>åˆ›å»ºçº¿ç¨‹çš„å¼€é”€</p><blockquote><p><a href="https://qastack.cn/programming/5483047/why-is-creating-a-thread-said-to-be-expensive">https://qastack.cn/programming/5483047/why-is-creating-a-thread-said-to-be-expensive</a></p><p>Javaçº¿ç¨‹çš„åˆ›å»ºéå¸¸æ˜‚è´µï¼Œå› ä¸ºå…¶ä¸­æ¶‰åŠå¤§é‡å·¥ä½œï¼š</p><ul><li>å¿…é¡»ä¸ºçº¿ç¨‹å †æ ˆåˆ†é…å¹¶åˆå§‹åŒ–ä¸€å¤§å—å†…å­˜ã€‚</li><li>éœ€è¦è¿›è¡Œç³»ç»Ÿè°ƒç”¨ä»¥åœ¨ä¸»æœºOSä¸­åˆ›å»º&#x2F;æ³¨å†Œæœ¬æœºçº¿ç¨‹ã€‚</li><li>éœ€è¦åˆ›å»ºï¼Œåˆå§‹åŒ–æè¿°ç¬¦å¹¶å°†å…¶æ·»åŠ åˆ°JVMå†…éƒ¨æ•°æ®ç»“æ„ä¸­ã€‚</li></ul><p><a href="https://zhuanlan.zhihu.com/p/161628226">https://zhuanlan.zhihu.com/p/161628226</a></p><p>TODOå¾…è¡¥å……</p><p>å¯¹æ“ä½œç³»ç»Ÿæ¥è¯´,åˆ›å»ºä¸€ä¸ªçº¿ç¨‹çš„ä»£ä»·æ˜¯ååˆ†æ˜‚è´µçš„, éœ€è¦ç»™å®ƒåˆ†é…å†…å­˜ã€åˆ—å…¥è°ƒåº¦ï¼ŒåŒæ—¶åœ¨çº¿ç¨‹åˆ‡æ¢çš„æ—¶å€™è¿˜è¦æ‰§è¡Œå†…å­˜æ¢é¡µï¼ŒCPU çš„ç¼“å­˜è¢«æ¸…ç©º,åˆ‡æ¢å›æ¥çš„æ—¶å€™è¿˜è¦é‡æ–°ä»å†…å­˜ä¸­è¯»å–ä¿¡æ¯,ç ´åäº†æ•°æ®çš„å±€éƒ¨æ€§ã€‚ã€åˆ†é…å†…å­˜ã€åˆ—å…¥è°ƒåº¦ã€å†…å­˜æ¢é¡µã€æ¸…ç©ºç¼“å­˜å’Œé‡æ–°è¯»å–ã€‘</p><p><strong>å…³äºå†…å­˜å¼€é”€</strong></p><p>Javaçº¿ç¨‹çš„çº¿ç¨‹æ ˆåŒºåˆ«äºå †ï¼Œå®ƒæ˜¯ä¸å—Javaç¨‹åºæ§åˆ¶çš„ï¼Œåªå—ç³»ç»Ÿèµ„æºé™åˆ¶ã€‚é»˜è®¤ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ ˆå¤§å°æ˜¯1Mï¼Œåˆ«å°çœ‹è¿™1Mçš„ç©ºé—´ï¼Œå¦‚æœæ¯ä¸ªç”¨æˆ·è¯·æ±‚éƒ½æ–°å»ºçº¿ç¨‹çš„è¯ï¼Œ1024ä¸ªç”¨æˆ·å…‰çº¿ç¨‹å°±å ç”¨äº†1ä¸ªGçš„å†…å­˜ï¼Œå¦‚æœç³»ç»Ÿæ¯”è¾ƒå¤§çš„è¯ï¼Œä¸€ä¸‹å­ç³»ç»Ÿèµ„æºå°±ä¸å¤Ÿç”¨äº†ï¼Œæœ€åç¨‹åºå°±å´©æºƒäº†ã€‚</p><p>ã€åˆ›å»ºä¸€ä¸ªçº¿ç¨‹é»˜è®¤éœ€è¦æ¶ˆè€—1Mçš„å†…å­˜ï¼Œå¦‚æœæ¯ä¸ªç”¨æˆ·è¯·æ±‚éƒ½åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆ1024ä¸ªç”¨æˆ·å°±æ˜¯1Gäº†ï¼Œå¹¶å‘é‡ä¸€å¤§å°±æ‰›ä¸ä½äº†ã€‘</p></blockquote></li><li><p>çº¿ç¨‹æ˜¯JVMåˆ›å»ºè¿˜æ˜¯æ“ä½œç³»ç»Ÿå»åˆ›å»ºçš„ï¼Ÿ</p></li><li><p>Redisåˆ†å¸ƒå¼é”è·å–é”æˆåŠŸï¼Œé‡Šæ”¾é”ä¹‹å‰å®•æœºï¼Œå¦‚ä½•ä¼˜é›…çš„è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ</p></li></ul><h3 id="äº¬ä¸œäºŒé¢"><a href="#äº¬ä¸œäºŒé¢" class="headerlink" title="äº¬ä¸œäºŒé¢"></a>äº¬ä¸œäºŒé¢</h3><ul><li><p>HashMapæ‰©å®¹ã€ç¼©å®¹è¿‡ç¨‹ç»†èŠ‚ï¼ˆHashMapæ²¡æœ‰ç¼©å®¹æ“ä½œï¼Œå› ä¸ºåå¤æ¨ªè·³æ²¡å¤ªå¤§æ„ä¹‰ï¼‰</p></li><li><p>ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ï¼Ÿ</p><blockquote><p>å¼•ç”¨ã€Šå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹ï¼š<br>å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœä¸ç”¨è€ƒè™‘è¿™äº›çº¿ç¨‹åœ¨è¿è¡Œæ—¶ç¯å¢ƒä¸‹çš„è°ƒåº¦å’Œäº¤æ›¿æ‰§è¡Œï¼Œä¹Ÿä¸éœ€è¦è¿›è¡Œé¢å¤–çš„åŒæ­¥ï¼Œæˆ–è€…åœ¨è°ƒç”¨æ–¹è¿›è¡Œä»»ä½•å…¶ä»–çš„åè°ƒæ“ä½œï¼Œè°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„è¡Œä¸ºéƒ½å¯ä»¥è·å¾—æ­£ç¡®çš„ç»“æœï¼Œé‚£ä¹ˆå°±ç§°è¿™ä¸ªå¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p></blockquote></li><li><p>HashMapä¸CHMåŒºåˆ«åœ¨å“ªé‡Œï¼ŸCHMä¸ºäº†ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œåœ¨æ€§èƒ½ä¸Šåšäº†å“ªäº›ç‰ºç‰²</p></li><li><p>Javaå†…å­˜åŒºåŸŸæœ‰å“ªäº›ï¼Ÿ</p></li><li><p>HashMapä¸CHMåŒºåˆ«åœ¨å“ªé‡Œï¼ŸCHMä¸ºäº†ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œåœ¨æ€§èƒ½ä¸Šåšäº†å“ªäº›ç‰ºç‰²</p></li><li><p>GCRootsæœ‰å“ªäº›ï¼Ÿä¸ºä»€ä¹ˆé€‰æ‹©è¿™äº›å¯¹è±¡ä½œä¸ºGCRootsï¼Ÿ</p><blockquote><p>å‚è€ƒã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆã€‹ç¬¬ä¸‰ç« ï¼Œå›ºå®šå¯ä½œä¸ºGC Rootsçš„å¯¹è±¡åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼š</p><ul><li>åœ¨è™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡ï¼Œè­¬å¦‚å„ä¸ªçº¿ç¨‹è¢«è°ƒç”¨çš„æ–¹æ³•å †æ ˆä¸­ä½¿ç”¨åˆ°çš„å‚æ•°ã€å±€éƒ¨å˜é‡ã€ä¸´æ—¶å˜é‡ç­‰ã€‚</li><li>åœ¨æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ï¼Œè­¬å¦‚Javaç±»çš„å¼•ç”¨ç±»å‹é™æ€å˜é‡ã€‚</li><li>åœ¨æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ï¼Œè­¬å¦‚å­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆString Tableï¼‰é‡Œçš„å¼•ç”¨ã€‚</li><li>åœ¨æœ¬åœ°æ–¹æ³•æ ˆä¸­JNIï¼ˆå³é€šå¸¸æ‰€è¯´çš„Nativeæ–¹æ³•ï¼‰å¼•ç”¨çš„å¯¹è±¡ã€‚</li><li>Javaè™šæ‹Ÿæœºå†…éƒ¨çš„å¼•ç”¨ï¼Œå¦‚åŸºæœ¬æ•°æ®ç±»å‹æ‰€å¯¹åº”çš„Classå¯¹è±¡ï¼Œä¸€äº›å¸¸é©»çš„å¼‚å¸¸å¯¹è±¡ï¼ˆæ¯”å¦‚NullPointExceptionã€OutOfMemoryErrorï¼‰ç­‰ï¼Œè¿˜æœ‰ç³»ç»Ÿç±»åŠ è½½å™¨ã€‚</li><li>æ‰€æœ‰è¢«åŒæ­¥é”ï¼ˆsynchronizeå…³é”®å­—ï¼‰æŒæœ‰çš„å¯¹è±¡ã€‚</li><li>åæ˜ Javaè™šæ‹Ÿæœºå†…éƒ¨æƒ…å†µçš„JMXBeanã€JVMTIä¸­æ³¨å†Œçš„å›è°ƒã€æœ¬åœ°ä»£ç ç¼“å­˜ç­‰ã€‚</li></ul></blockquote></li></ul><h3 id="æ»´æ»´"><a href="#æ»´æ»´" class="headerlink" title="æ»´æ»´"></a>æ»´æ»´</h3><ul><li><p>ç¼–ç¨‹é¢˜ï¼šæ‰¾å‡ºä¸€ä¸ªæ•°ç»„ä¸­å‡ºç°æ¬¡æ•°ä¸ºå¥‡æ•°çš„å…ƒç´ ï¼Œå¹¶è¾“å‡ºè¿™äº›å…ƒç´ </p></li><li><p>å¿«æ’æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Œå¿«æ’æ˜¯å¦ç¨³å®šï¼Ÿç¨³å®šæŒ‡çš„æ˜¯ä»€ä¹ˆï¼Ÿ</p><blockquote><p>å¿«æ’æ—¶é—´å¤æ‚åº¦ï¼šæœ€å·®n^2ï¼Œå¹³å‡nLogn</p><p>å¿«æ’æ˜¯ä¸ç¨³å®šçš„ï¼Œå› ä¸ºæ˜¯åŸåœ°æ’åº</p><p>ç¨³å®šï¼šå¦‚æœ a åŸæœ¬åœ¨ b å‰é¢ï¼Œè€Œ a&#x3D;bï¼Œæ’åºä¹‹å a ä»ç„¶åœ¨ b çš„å‰é¢ã€‚<br>ä¸ç¨³å®šï¼šå¦‚æœ a åŸæœ¬åœ¨ b çš„å‰é¢ï¼Œè€Œ a&#x3D;bï¼Œæ’åºä¹‹å a å¯èƒ½ä¼šå‡ºç°åœ¨ b çš„åé¢ã€‚</p></blockquote></li><li><p>kafkaä¸ºä»€ä¹ˆæ”¯æŒé«˜åå</p></li><li><p>kafkaå¦‚ä½•åšåˆ°æ°´å¹³æ‹“å±•</p></li><li><p>ä¸€ä¸ªhttpè¯·æ±‚è¿‡æ¥ï¼ŒSpringMVCçš„å·¥ä½œæµç¨‹</p></li><li><p>Springæ‹¦æˆªå™¨å’Œfilterçš„åŒºåˆ«</p></li><li><p>çº¿ç¨‹æ± å·¥ä½œåŸç†ï¼Œçº¿ç¨‹å¤šäº†ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p></li><li><p>å¦‚ä½•è®¾ç½®æ ¸å¿ƒçº¿ç¨‹æ•°ä»¥åŠå…¶ä»–å‚æ•°ï¼Ÿ</p></li><li><p>JUCåº•ä¸‹ç”¨è¿‡å“ªäº›åŒ…ï¼Œå¯é‡å…¥é”çš„åº•å±‚å®ç°ï¼ˆAQSï¼‰</p></li><li><p>åˆ†åº“åˆ†è¡¨é™¤äº†sharding jdbcè¿˜æœ‰å“ªäº›ä¸éœ€è¦å¼•å…¥ä¸‰æ–¹jaråŒ…çš„</p></li><li><p>INNODBå¼•æ“æœ‰å“ªäº›é”ï¼Œè¿™äº›é”åŸºäºä»€ä¹ˆåŠ çš„ï¼Ÿ</p><blockquote><p>è¡¨é”ã€è¡Œé”ã€ä¹è§‚é”ï¼ˆMVCCï¼‰ï¼›è¡Œé”åŸºäºç´¢å¼•åŠ é”ã€‚</p></blockquote></li><li><p>ç´¢å¼•çš„æ•°æ®ç»“æ„</p></li><li><p>ç´¢å¼•çš„ç§ç±»</p></li><li><p>èšé›†ç´¢å¼•å’Œéèšé›†ç´¢å¼•çš„åŒºåˆ«</p></li></ul><h3 id="å­—èŠ‚è·³åŠ¨"><a href="#å­—èŠ‚è·³åŠ¨" class="headerlink" title="å­—èŠ‚è·³åŠ¨"></a>å­—èŠ‚è·³åŠ¨</h3><ul><li>HashMapçš„åº•å±‚æ•°æ®ç»“æ„</li><li>HashMap rehashæ˜¯å•¥ï¼Œä¸ºä»€ä¹ˆè¦rehash</li><li>redisçƒ­ç‚¹keyæ˜¯å•¥ï¼Ÿå¦‚ä½•å»å‘ç°çƒ­ç‚¹keyï¼ˆproxyï¼‰</li><li>ä»€ä¹ˆæ˜¯å¯é‡å¤è¯»ï¼Ÿä»€ä¹ˆæ˜¯è”åˆç´¢å¼•</li><li>MySQLå¦‚ä½•ä¿è¯æ•°æ®çš„å¼ºä¸€è‡´æ€§</li><li>MQå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±</li><li>tcpä¸udpçš„åŒºåˆ«ï¼Œtcpå¦‚ä½•ä¿è¯å¯é æ€§</li><li>å†…å­˜æ³„éœ²æœ€ç»ˆä¼šå¯¼è‡´ä»€ä¹ˆ</li><li>LinuxæŸ¥çœ‹ä¸€ä¸ªç›®å½•æœ€å¤§çš„æ–‡ä»¶ï¼ˆdu -sh *ï¼‰</li></ul><h3 id="Bç«™"><a href="#Bç«™" class="headerlink" title="Bç«™"></a>Bç«™</h3><ul><li>SpringBootçš„å¯åŠ¨æµç¨‹</li><li>kafka rebalanceæœºåˆ¶</li><li>kafkaæ¶æ„è®¾è®¡ï¼Œå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±</li><li>æŠ½å¥–åœºæ™¯ï¼šå¥–å“æ‰£åº“å­˜å¦‚ä½•ä¿è¯é«˜å¹¶å‘</li><li>ä¼˜æƒ åˆ¸å‘æ”¾åœºæ™¯ï¼šå‡è®¾ä¸Šæ¸¸æ¥å£å…¨éƒ¨å¯é ï¼Œå¦‚ä½•ä¿è¯å‘æ”¾ä¼˜æƒ åˆ¸çš„å¯é æ€§ï¼ˆå»¶è¿Ÿæ¶ˆæ¯ï¼‰</li><li>å¦‚ä½•ä¿è¯redisåŠ é”å’Œé‡Šæ”¾é”çš„å®‰å…¨æ€§ï¼ˆä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºç°é‡Šæ”¾é”ä¸å®‰å…¨çš„é—®é¢˜ï¼‰</li><li>åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ</li><li>ShardingJDBCåŸç†ï¼Œæ€ä¹ˆåšçš„ï¼Œä¼šæœ‰ä»€ä¹ˆé—®é¢˜</li><li>æ•°æ®åˆ†åº“åˆ†è¡¨ä¹‹åæ•°æ®å¦‚ä½•ä¸åœæœºè¿ç§»</li></ul><h3 id="ç™¾åº¦"><a href="#ç™¾åº¦" class="headerlink" title="ç™¾åº¦"></a>ç™¾åº¦</h3><ul><li>å¯¹DDDçš„ç†è§£</li><li>DDDä¸­ä¸šåŠ¡åŸŸå¦‚ä½•åˆ’åˆ†</li><li>èšåˆæ ¹ã€å®ä½“å’Œå€¼å¯¹è±¡çš„åŒºåˆ«</li><li>å·¥å‚æ¨¡å¼åœ¨å®é™…ä¸­çš„ä½¿ç”¨</li><li>æ‰‹å†™ä¸€ä¸ªç­–ç•¥æ¨¡å¼</li></ul><h3 id="æ»´æ»´-1"><a href="#æ»´æ»´-1" class="headerlink" title="æ»´æ»´"></a>æ»´æ»´</h3><ul><li>JVMè°ƒä¼˜</li><li>Dubboå’ŒSpringCloudçš„åŒºåˆ«</li><li>åˆ†å¸ƒå¼äº‹åŠ¡å¦‚ä½•å¤„ç†</li></ul><h3 id="58å®‰å±…å®¢"><a href="#58å®‰å±…å®¢" class="headerlink" title="58å®‰å±…å®¢"></a>58å®‰å±…å®¢</h3><ul><li><p>åˆ†åº“åˆ†è¡¨å¦‚æœç”¨éåˆ†è¡¨çš„å­—æ®µå»æŸ¥è¯¢ï¼Œæ€ä¹ˆåŠï¼ˆæ¯”å¦‚nameå­—æ®µï¼Œå¯ä»¥ç”¨nameå»ºç´¢å¼•ï¼Œnameå’Œsharding-keyå»ºç«‹kvï¼‰</p><blockquote><p>åšmappingè¡¨ï¼Œnameå’Œåˆ†ç‰‡keyåšæ˜ å°„</p></blockquote></li><li><p>åˆ†åº“åˆ†è¡¨æ‰¹é‡æ“ä½œæç«¯æƒ…å†µï¼Œå¦‚æœä¸‰æ¬¡æ“ä½œåœ¨ä¸‰ä¸ªä¸åŒçš„åº“ï¼Œå¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼ˆåœ¨ç›¸åŒçš„æœ¬åœ°åº“ï¼Œç”Ÿæˆä¸€æ¡prepareè®°å½•ï¼Œä½¿å…¶æˆä¸ºæœ¬åœ°äº‹åŠ¡ï¼Œä¿è¯å•åº“äº‹åŠ¡æˆåŠŸï¼Œå•åº“æ˜¯æ²¡æœ‰æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œæœ€åå†ä¸€ä¸ªä¸ªcommitï¼Œå¦‚æœä¸€ä¸ªå¤±è´¥ï¼Œåˆ™ä¾æ¬¡å›æ»šï¼‰</p></li><li><p>dddç›¸å…³ï¼šå……è¡€æ¨¡å‹å’Œè´«è¡€æ¨¡å‹çš„åŒºåˆ«ï¼›dddåœ¨é¡¹ç›®ä¸­æ˜¯å¦‚ä½•å®æ–½çš„ï¼Ÿ</p></li><li><p>Zookeeperå¦‚ä½•ä¿è¯CPï¼ŸEurekaå¦‚ä½•ä¿è¯APï¼Ÿ</p><blockquote><p><strong>Zookeeperä¿è¯CP</strong></p><p>å½“å‘æ³¨å†Œä¸­å¿ƒæŸ¥è¯¢æœåŠ¡åˆ—è¡¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å®¹å¿æ³¨å†Œä¸­å¿ƒè¿”å›çš„æ˜¯å‡ åˆ†é’Ÿä»¥å‰çš„æ³¨å†Œä¿¡æ¯ï¼Œä½†ä¸èƒ½æ¥å—æœåŠ¡ç›´æ¥downæ‰ä¸å¯ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒæœåŠ¡æ³¨å†ŒåŠŸèƒ½å¯¹å¯ç”¨æ€§çš„è¦æ±‚è¦é«˜äºä¸€è‡´æ€§ã€‚ä½†æ˜¯zkä¼šå‡ºç°è¿™æ ·ä¸€ç§æƒ…å†µï¼Œå½“masterèŠ‚ç‚¹å› ä¸ºç½‘ç»œæ•…éšœä¸å…¶ä»–èŠ‚ç‚¹å¤±å»è”ç³»æ—¶ï¼Œå‰©ä½™èŠ‚ç‚¹ä¼šé‡æ–°è¿›è¡Œleaderé€‰ä¸¾ã€‚é—®é¢˜åœ¨äºï¼Œé€‰ä¸¾leaderçš„æ—¶é—´å¤ªé•¿ï¼Œ30 ~ 120s, ä¸”é€‰ä¸¾æœŸé—´æ•´ä¸ªzké›†ç¾¤éƒ½æ˜¯ä¸å¯ç”¨çš„ï¼Œè¿™å°±å¯¼è‡´åœ¨é€‰ä¸¾æœŸé—´æ³¨å†ŒæœåŠ¡ç˜«ç—ªã€‚åœ¨äº‘éƒ¨ç½²çš„ç¯å¢ƒä¸‹ï¼Œå› ç½‘ç»œé—®é¢˜ä½¿å¾—zké›†ç¾¤å¤±å»masterèŠ‚ç‚¹æ˜¯è¾ƒå¤§æ¦‚ç‡ä¼šå‘ç”Ÿçš„äº‹ï¼Œè™½ç„¶æœåŠ¡èƒ½å¤Ÿæœ€ç»ˆæ¢å¤ï¼Œä½†æ˜¯æ¼«é•¿çš„é€‰ä¸¾æ—¶é—´å¯¼è‡´çš„æ³¨å†Œé•¿æœŸä¸å¯ç”¨æ˜¯ä¸èƒ½å®¹å¿çš„ã€‚</p><p><strong>Eurekaä¿è¯AP</strong></p><p>Eurekaçœ‹æ˜ç™½äº†è¿™ä¸€ç‚¹ï¼Œå› æ­¤åœ¨è®¾è®¡æ—¶å°±ä¼˜å…ˆä¿è¯å¯ç”¨æ€§ã€‚Eurekaå„ä¸ªèŠ‚ç‚¹éƒ½æ˜¯å¹³ç­‰çš„ï¼Œå‡ ä¸ªèŠ‚ç‚¹æŒ‚æ‰ä¸ä¼šå½±å“æ­£å¸¸èŠ‚ç‚¹çš„å·¥ä½œï¼Œå‰©ä½™çš„èŠ‚ç‚¹ä¾ç„¶å¯ä»¥æä¾›æ³¨å†Œå’ŒæŸ¥è¯¢æœåŠ¡ã€‚è€ŒEurekaçš„å®¢æˆ·ç«¯åœ¨å‘æŸä¸ªEurekaæ³¨å†Œæˆ–æ—¶å¦‚æœå‘ç°è¿æ¥å¤±è´¥ï¼Œåˆ™ä¼šè‡ªåŠ¨åˆ‡æ¢è‡³å…¶å®ƒèŠ‚ç‚¹ï¼Œåªè¦æœ‰ä¸€å°Eurekaè¿˜åœ¨ï¼Œå°±èƒ½ä¿è¯æ³¨å†ŒæœåŠ¡å¯ç”¨(ä¿è¯å¯ç”¨æ€§)ï¼Œåªä¸è¿‡æŸ¥åˆ°çš„ä¿¡æ¯å¯èƒ½ä¸æ˜¯æœ€æ–°çš„(ä¸ä¿è¯å¼ºä¸€è‡´æ€§)ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒEurekaè¿˜æœ‰ä¸€ç§è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Œå¦‚æœåœ¨15åˆ†é’Ÿå†…è¶…è¿‡85%çš„èŠ‚ç‚¹éƒ½æ²¡æœ‰æ­£å¸¸çš„å¿ƒè·³ï¼Œé‚£ä¹ˆEurekaå°±è®¤ä¸ºå®¢æˆ·ç«¯ä¸æ³¨å†Œä¸­å¿ƒå‡ºç°äº†ç½‘ç»œæ•…éšœï¼Œæ­¤æ—¶ä¼šå‡ºç°ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</p><ol><li>Eurekaä¸å†ä»æ³¨å†Œåˆ—è¡¨ä¸­ç§»é™¤å› ä¸ºé•¿æ—¶é—´æ²¡æ”¶åˆ°å¿ƒè·³è€Œåº”è¯¥è¿‡æœŸçš„æœåŠ¡</li><li>Eurekaä»ç„¶èƒ½å¤Ÿæ¥å—æ–°æœåŠ¡çš„æ³¨å†Œå’ŒæŸ¥è¯¢è¯·æ±‚ï¼Œä½†æ˜¯ä¸ä¼šè¢«åŒæ­¥åˆ°å…¶å®ƒèŠ‚ç‚¹ä¸Š(å³ä¿è¯å½“å‰èŠ‚ç‚¹ä¾ç„¶å¯ç”¨)</li><li>å½“ç½‘ç»œç¨³å®šæ—¶ï¼Œå½“å‰å®ä¾‹æ–°çš„æ³¨å†Œä¿¡æ¯ä¼šè¢«åŒæ­¥åˆ°å…¶å®ƒèŠ‚ç‚¹ä¸­</li></ol><p>å› æ­¤ï¼Œ Eurekaå¯ä»¥å¾ˆå¥½çš„åº”å¯¹å› ç½‘ç»œæ•…éšœå¯¼è‡´éƒ¨åˆ†èŠ‚ç‚¹å¤±å»è”ç³»çš„æƒ…å†µï¼Œè€Œä¸ä¼šåƒzookeeperé‚£æ ·ä½¿æ•´ä¸ªæ³¨å†ŒæœåŠ¡ç˜«ç—ªã€‚</p></blockquote></li><li><p>hasmapå…·ä½“ä¸ºä»€ä¹ˆä¸å®‰å…¨ï¼Ÿï¼ˆä¸å®‰å…¨çš„è¡¨ç°æ˜¯å¯¹è±¡ä¸¢å¤±ï¼Œä¾‹å¦‚ä¸¤ä¸ªçº¿ç¨‹éƒ½æ‰§è¡Œåˆ°åŒä¸€ä¸ªhashæ¡¶ç›®å‰ä¸ºç©ºï¼Œéƒ½åˆ›å»ºä¸€ä¸ªentryï¼Œä¼šæœ‰ä¸€ä¸ªentryè¢«è¦†ç›–æ‰ï¼›ä¸å®‰å…¨æ˜¯å› ä¸ºä¸å¯è§ï¼Œä¸ºä»€ä¹ˆä¸å¯è§ï¼Ÿï¼‰</p></li><li><p>æ•°æ®åº“ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜</p></li><li><p>redis SDSä¼˜åŒ–ç‚¹</p></li><li><p>redisè·³è¡¨ç›¸å¯¹äºå¹³è¡¡æ ‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p></li><li><p>redis IOå¤šè·¯å¤ç”¨åŸç†</p></li><li><p>JMMå·¥ä½œå†…å­˜å¯¹åº”åˆ°è®¡ç®—æœºç¡¬ä»¶å±‚é¢æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆé«˜é€Ÿç¼“å­˜ï¼Ÿæˆ–è€…å†…å­˜ï¼Ÿï¼‰</p></li><li><p>å¼‚æ­¥äº‹ä»¶é©±åŠ¨çš„å¥½å¤„å’Œåå¤„ï¼ˆåå¤„å°±æ˜¯ä»£ç ä¸ç›´è§‚ï¼Œæ— æ³•ç›´æ¥æ‰¾åˆ°æ¶ˆè´¹è€…ï¼›è¿™ç§æƒ…å†µåˆå¦‚ä½•ä¼˜åŒ–ï¼‰</p></li><li><p>åˆ†åº“åˆ†è¡¨åœºæ™¯ï¼šå¦‚ä½•åŒæ—¶é€šè¿‡ä¹°å®¶å’Œå–å®¶idå»æŸ¥è¯¢è®¢å•</p><blockquote><p>è®¢å•è¡¨ï¼Œæ¯”å¦‚ä»¥ä¹°å®¶idåˆ†ç‰‡ï¼Œåšå–å®¶idå’Œä¹°å®¶idçš„æ˜ å°„è¡¨ï¼Œåšä¸¤æ¬¡æŸ¥è¯¢</p></blockquote></li><li><p>æœ¬åœ°äº‹åŠ¡æ‰§è¡ŒæˆåŠŸï¼ŒMQå‘é€å¤±è´¥ï¼Œæœ¬åœ°äº‹åŠ¡å¦‚ä½•å›æ»šï¼ˆå‘é€å›è°ƒï¼Ÿï¼‰</p></li><li><p>ESå’ŒMySQLçš„åŒºåˆ«ï¼ŒESè¿™ä¹ˆå¼ºå¤§ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦æœ‰MySQLï¼ˆMySQLä¸ºä»€ä¹ˆä¸èƒ½è¢«æ›¿ä»£ï¼‰</p></li><li><p>å¯é‡å…¥é”åŸç†</p></li><li><p>è¯»å†™é”AQSç”¨æ³•çš„åŒºåˆ«ï¼ˆæ˜¯å¦å…±äº«æ¨¡å¼ï¼‰</p></li><li><p>ä¸ºä»€ä¹ˆè¦åŠ é”ï¼ˆå› ä¸ºå†…å­˜ä¸å¯è§ï¼‰ï¼Œä¸ºä»€ä¹ˆå†…å­˜ä¸å¯è§</p></li><li><p>CMSåƒåœ¾å›æ”¶å™¨æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ</p><blockquote><p><strong>é—®é¢˜</strong>ï¼šCMSåœ¨é‡æ–°æ ‡è®°ï¼ˆRemarkï¼‰çš„è¿‡ç¨‹ä¸­ä¼šæµ®åŠ¨åƒåœ¾ï¼Œå®¹æ˜“äº§ç”Ÿå¤§é‡ç©ºé—´ç¢ç‰‡ã€‚</p><p><strong>åŸå› </strong>ï¼šCMSåƒåœ¾å›æ”¶å™¨æ˜¯åŸºäºâ€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ï¼›Remarkè¿‡ç¨‹æ ‡è®°æ´»ç€çš„å¯¹è±¡ï¼Œä»GCRootçš„å¯è¾¾æ€§åˆ¤æ–­å¯¹è±¡æ´»ç€ï¼Œä½†æ— æ³•æ ‡è®°â€œæ­»äº¡â€çš„å¯¹è±¡ã€‚</p><p>å¦‚æœåœ¨åˆå§‹é˜¶æ®µè¢«æ ‡è®°ä¸ºæ´»ç€ï¼Œå¹¶å‘è¿è¡Œè¿‡ç¨‹ä¸­â€œæ­»äº¡â€ï¼Œremarkè¿‡ç¨‹ä¸­æ— æ³•çº æ­£ï¼Œå› æ­¤å˜ä¸ºæµ®åŠ¨åƒåœ¾ï¼Œéœ€ç­‰å¾…ä¸‹æ¬¡GCçš„åˆ°æ¥ã€‚</p><p><strong>å¦‚ä½•è§£å†³</strong>ï¼šå¯ä»¥é€šè¿‡<code>-XX:+UseCMSCompactAtFullCollection</code>å‚æ•°ï¼Œå¼ºåˆ¶JVMåœ¨FGCå®Œæˆåå¯¹è€å¹´ä»£è¿›è¡Œå‹ç¼©ï¼Œæ‰§è¡Œä¸€æ¬¡ç©ºé—´ç¢ç‰‡æ•´ç†ï¼Œä½†æ˜¯ä¼šå¼•å‘STWã€‚ä¸ºäº†å‡å°‘STWæ¬¡æ•°ï¼ŒCMSè¿˜å¯ä»¥é€šè¿‡é…ç½®<code>-XX:+CMSFullGCsBeforeCompaction=n</code>å‚æ•°ï¼Œåœ¨æ‰§è¡Œäº†næ¬¡FGCåï¼ŒJVMå†åœ¨è€å¹´ä»£æ‰§è¡Œç©ºé—´ç¢ç‰‡æ•´ç†ã€‚</p></blockquote></li></ul><h3 id="ç™¾åº¦ï¼ˆACGäº’è”ç½‘ï¼‰ä¸€é¢"><a href="#ç™¾åº¦ï¼ˆACGäº’è”ç½‘ï¼‰ä¸€é¢" class="headerlink" title="ç™¾åº¦ï¼ˆACGäº’è”ç½‘ï¼‰ä¸€é¢"></a>ç™¾åº¦ï¼ˆACGäº’è”ç½‘ï¼‰ä¸€é¢</h3><ul><li>ä»€ä¹ˆæ˜¯DDDï¼Ÿå’Œä¼ ç»Ÿå¼€å‘æ¨¡å¼çš„åŒºåˆ«</li><li>åŒä¸€ä¸ªtopicåªæœ‰å››ä¸ªåˆ†åŒºçš„æƒ…å†µä¸‹å¦‚ä½•æé«˜æ¶ˆè´¹ååï¼Œå‡è®¾æœ‰åŒæ ·åˆ†åŒºæ•°é‡çš„æ¶ˆè´¹è€…ï¼ˆä¸è€ƒè™‘æ¶ˆè´¹è€…æœ¬åœ°å¤šçº¿ç¨‹æ¶ˆè´¹ï¼‰ï¼ˆå°†åŸtopicæŒ‰ç…§ä¸€å®šè§„åˆ™åˆ†ç‰‡ï¼Œè½¬å‘åˆ°å…¶ä»–topicï¼Œå†è¿›è¡Œæ¶ˆè´¹ï¼‰</li><li><a href="https://leetcode-cn.com/problems/3sum/">Leetcode15. ä¸‰æ•°ä¹‹å’Œ</a></li></ul><h3 id="ç™¾åº¦ï¼ˆACGäº’è”ç½‘ï¼‰äºŒé¢"><a href="#ç™¾åº¦ï¼ˆACGäº’è”ç½‘ï¼‰äºŒé¢" class="headerlink" title="ç™¾åº¦ï¼ˆACGäº’è”ç½‘ï¼‰äºŒé¢"></a>ç™¾åº¦ï¼ˆACGäº’è”ç½‘ï¼‰äºŒé¢</h3><ul><li><p>doceråŸç†ï¼Œå¦‚ä½•åšéš”ç¦»</p></li><li><p>è´Ÿè½½å‡è¡¡æœºåˆ¶æœ‰å“ªå‡ ç§ï¼š4å±‚å’Œ7å±‚çš„æœ‰ä»€ä¹ˆåŒºåˆ«</p></li><li><p>å„ç§é”æœºåˆ¶ï¼ˆå†…ç½®é”ã€åˆ†å¸ƒå¼é”ï¼‰</p></li><li><p><a href="https://leetcode-cn.com/problems/lru-cache/">146. LRU ç¼“å­˜æœºåˆ¶</a></p></li></ul><h3 id="å•†æ±¤ç§‘æŠ€"><a href="#å•†æ±¤ç§‘æŠ€" class="headerlink" title="å•†æ±¤ç§‘æŠ€"></a>å•†æ±¤ç§‘æŠ€</h3><ul><li>ä¸€è‡´æ€§å“ˆå¸Œåˆ†åº“åˆ†è¡¨æ–¹æ¡ˆå¦‚ä½•åŠ¨æ€æ„ŸçŸ¥èŠ‚ç‚¹çš„å¢å‡ï¼Œè¿™ç§åˆ†åº“åˆ†è¡¨å¦‚ä½•æ‰©å®¹</li><li>ç±»åŠ è½½æœºè¿‡ç¨‹ï¼ˆä»classæ–‡ä»¶åˆ°å°±ç»ªï¼‰</li><li>SpringBootå¯åŠ¨æµç¨‹</li><li>dubboæœåŠ¡æ³¨å†Œæµç¨‹</li><li>å¾®æœåŠ¡é“¾è·¯è¿½è¸ªæ˜¯æ€ä¹ˆåšçš„</li><li>Redisä¸»ä»å¤åˆ¶è¿‡ç¨‹</li><li>AQSåŸç†ï¼Œå¯é‡å…¥é”æ˜¯å¦‚ä½•åšåˆ°å¯é‡å…¥çš„ï¼›è¯»å†™é”çš„åŸç†</li><li>Kafkaå¦‚ä½•åšåˆ°é«˜å¯ç”¨çš„</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒ</li><li>kafka partitionä¸consumerå·¥ä½œæœºåˆ¶</li><li>è´Ÿè½½å‡è¡¡æœºåˆ¶</li><li>redisæ’å®ƒé”ï¼ˆåˆ†å¸ƒå¼é”ï¼‰</li><li>è§‚å¯Ÿè€…æ¨¡å¼</li></ul><h3 id="æ»´æ»´-2"><a href="#æ»´æ»´-2" class="headerlink" title="æ»´æ»´"></a>æ»´æ»´</h3><ul><li><p>åˆ†å¸ƒå¼äº‹åŠ¡æ˜¯å¦‚ä½•åšçš„</p></li><li><p>kafkaå¦‚ä½•ä¿è¯æ¶ˆæ¯é¡ºåºæ€§</p></li><li><p>kafkaæ¶ˆæ¯æ˜¯å¦‚ä½•å­˜å‚¨çš„</p></li><li><p>MySQLç´¢å¼•åŸç†ï¼šBæ ‘å’ŒB+æ ‘çš„åŒºåˆ«ä»¥åŠå„è‡ªçš„ä¼˜ç¼ºç‚¹</p></li><li><p>Rpc(dubbo)å’ŒHttpè°ƒç”¨çš„åŒºåˆ«ï¼ˆhttpåŸç”Ÿè°ƒç”¨æ˜¯åè¿›åˆ¶ã€dubboæ˜¯äºŒè¿›åˆ¶ï¼Œdubboæ€§èƒ½å¥½ä¸€ç‚¹ï¼‰</p></li><li><p>æ•°æ®åº“ç¼“å­˜ä¸€è‡´æ€§æ€§</p></li><li><p>Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«</p></li><li><p>è·³è¡¨å’Œçº¢é»‘æ ‘çš„åŒºåˆ«</p><blockquote><p><del>è·³è¡¨æœ€å·®æ˜¯O(N)ï¼Œå¹³å‡O(LogN)ï¼›çº¢é»‘æ ‘ç›¸å¯¹è·³è¡¨æ¯”è¾ƒç¨³å®šï¼Œæ˜¯O(LogN)ï¼Œè·³è¡¨æœ‰ä¸€å®šçš„è¿æ°”æˆåˆ†</del></p></blockquote></li></ul><h3 id="å°çº¢ä¹¦ï¼ˆ2021-4-23ï¼‰"><a href="#å°çº¢ä¹¦ï¼ˆ2021-4-23ï¼‰" class="headerlink" title="å°çº¢ä¹¦ï¼ˆ2021&#x2F;4&#x2F;23ï¼‰"></a>å°çº¢ä¹¦ï¼ˆ2021&#x2F;4&#x2F;23ï¼‰</h3><ul><li>åˆ†å¸ƒå¼äº‹åŠ¡å¦‚ä½•å¤„ç†</li><li>MySQLäº‹åŠ¡åŸç†ä»¥åŠMVCCåŸç†</li><li>MySQLèšé›†ç´¢å¼•å’Œéèšé›†ç´¢å¼•åŒºåˆ«</li><li>Redisçƒ­ç‚¹keyé—®é¢˜</li><li>Redisé›†ç¾¤åŸç†</li><li>Springç”Ÿå‘½å‘¨æœŸ</li><li>Springå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–ï¼ˆä¸‰çº§ç¼“å­˜ï¼‰</li></ul><h3 id="æ»´æ»´-3"><a href="#æ»´æ»´-3" class="headerlink" title="æ»´æ»´"></a>æ»´æ»´</h3><ul><li><p>MySQL B+æ ‘ 500ä¸‡èŠ‚ç‚¹ï¼Œæ ‘é«˜æ˜¯å¤šå°‘ï¼Ÿå¦‚ä½•é…ç½®</p><blockquote><p>ä¸ºäº†è®©ä¸€ä¸ªæŸ¥è¯¢å°½é‡å°‘åœ°è¯»ç£ç›˜ï¼Œå°±å¿…é¡»è®©æŸ¥è¯¢è¿‡ç¨‹è®¿é—®å°½é‡å°‘çš„æ•°æ®å—ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±ä¸åº”è¯¥ä½¿ç”¨äºŒå‰æ ‘ï¼Œè€Œæ˜¯è¦ä½¿ç”¨â€œNå‰â€æ ‘ã€‚è¿™é‡Œï¼Œâ€œNå‰â€æ ‘ä¸­çš„â€œNâ€å–å†³äºæ•°æ®å—çš„å¤§å°ã€‚</p><p>ä»¥InnoDBçš„ä¸€ä¸ªæ•´æ•°å­—æ®µç´¢å¼•ä¸ºä¾‹ï¼Œè¿™ä¸ªNå·®ä¸å¤šæ˜¯1200ã€‚è¿™æ£µæ ‘é«˜æ˜¯4çš„æ—¶å€™ï¼Œå°±å¯ä»¥å­˜1200çš„3æ¬¡æ–¹ä¸ªå€¼ï¼Œè¿™å·²ç»17äº¿äº†ã€‚è€ƒè™‘åˆ°æ ‘æ ¹çš„æ•°æ®å—æ€»æ˜¯åœ¨å†…å­˜ä¸­çš„ï¼Œä¸€ä¸ª10äº¿è¡Œçš„è¡¨ä¸Šä¸€ä¸ªæ•´æ•°å­—æ®µçš„ç´¢å¼•ï¼ŒæŸ¥æ‰¾ä¸€ä¸ªå€¼æœ€å¤šåªéœ€è¦è®¿é—®3æ¬¡ç£ç›˜ã€‚å…¶å®ï¼Œæ ‘çš„ç¬¬äºŒå±‚ä¹Ÿæœ‰å¾ˆå¤§æ¦‚ç‡åœ¨å†…å­˜ä¸­ï¼Œé‚£ä¹ˆè®¿é—®ç£ç›˜çš„å¹³å‡æ¬¡æ•°å°±æ›´å°‘äº†ã€‚</p></blockquote></li><li><p>https</p></li><li><p>å †æ’åºæ˜¯å¦ç¨³å®šï¼Œä»¥åŠåŸç†</p><blockquote><p>ä¸ç¨³å®šï¼Œæ„å»ºå¤§æ ¹å †æˆ–è€…å°æ ¹å †</p></blockquote></li><li><p>ç§¯åˆ†è½¬è´¦åˆ°ä¸€ä¸ªç¬¬ä¸‰æ–¹æœåŠ¡å¦‚ä½•è®¾è®¡</p><blockquote><p>åˆ†ä¸ºè½¬å‡º-è½¬è´¦ä¸­-è½¬è´¦æˆåŠŸä¸‰æ­¥ï¼š</p><p>è½¬å‡ºï¼šæœ¬åœ°æ‰£å‡ï¼Œæ’å…¥æœ¬åœ°æ¶ˆæ¯è¡¨ï¼ŒåŒ…å«æœ¬åœ°äº‹åŠ¡idï¼Œæ”¯ä»˜è´¦æˆ·ã€æ¥æ”¶äººã€ç§¯åˆ†æ•°é‡ã€çŠ¶æ€ç­‰</p><p>è½¬è´¦ä¸­ï¼šè½®è¯¢æœ¬åœ°æ¶ˆæ¯è¡¨ï¼Œè°ƒç”¨ç¬¬ä¸‰æ–¹RPCï¼ˆå¦‚æœå¤±è´¥ï¼Œä¸€ç›´é‡è¯•ï¼Œæœ‰ä¸ªé‡è¯•ä¸Šé™ï¼‰</p><p>è½¬è´¦æˆåŠŸï¼šè°ƒç”¨æˆåŠŸä¹‹åï¼Œæ›´æ–°æœ¬åœ°æ¶ˆæ¯è¡¨çŠ¶æ€ä¸ºæˆåŠŸ</p><p>å…³é”®ç‚¹ï¼šå¹‚ç­‰å’Œé‡è¯•ï¼Œå¦‚æœé‡è¯•ä¸€å®šæ¬¡æ•°åï¼Œå›æ»šæ‰£å‡çš„ç§¯åˆ†ï¼Œå°†æœ¬åœ°äº‹åŠ¡è¡¨çŠ¶æ€è®¾ç½®ä¸ºå¤±è´¥</p></blockquote></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> é¢ç» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dubboé¢è¯•é¢˜</title>
      <link href="/posts/7644b6f2.html"/>
      <url>/posts/7644b6f2.html</url>
      
        <content type="html"><![CDATA[<hr><h3 id="dubboåˆ†å±‚"><a href="#dubboåˆ†å±‚" class="headerlink" title="dubboåˆ†å±‚"></a>dubboåˆ†å±‚</h3><p>ä»å¤§çš„èŒƒå›´æ¥è¯´ï¼Œdubboåˆ†ä¸ºä¸‰å±‚ï¼Œbusinessä¸šåŠ¡é€»è¾‘å±‚ç”±æˆ‘ä»¬è‡ªå·±æ¥æä¾›æ¥å£å’Œå®ç°è¿˜æœ‰ä¸€äº›é…ç½®ä¿¡æ¯ï¼ŒRPCå±‚å°±æ˜¯çœŸæ­£çš„RPCè°ƒç”¨çš„æ ¸å¿ƒå±‚ï¼Œå°è£…æ•´ä¸ªRPCçš„è°ƒç”¨è¿‡ç¨‹ã€è´Ÿè½½å‡è¡¡ã€é›†ç¾¤å®¹é”™ã€ä»£ç†ï¼Œremotingåˆ™æ˜¯å¯¹ç½‘ç»œä¼ è¾“åè®®å’Œæ•°æ®è½¬æ¢çš„å°è£…ã€‚</p><p>åˆ’åˆ†åˆ°æ›´ç»†çš„å±‚é¢ï¼Œå°±æ˜¯å›¾ä¸­çš„10å±‚æ¨¡å¼ï¼Œæ•´ä¸ªåˆ†å±‚ä¾èµ–ç”±ä¸Šè‡³ä¸‹ï¼Œé™¤å¼€businessä¸šåŠ¡é€»è¾‘ä¹‹å¤–ï¼Œå…¶ä»–çš„å‡ å±‚éƒ½æ˜¯SPIæœºåˆ¶ã€‚<br><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210118155842.webp" alt="å›¾ç‰‡"></p><h3 id="èƒ½è¯´ä¸‹Dubboçš„å·¥ä½œåŸç†å—ï¼Ÿ"><a href="#èƒ½è¯´ä¸‹Dubboçš„å·¥ä½œåŸç†å—ï¼Ÿ" class="headerlink" title="èƒ½è¯´ä¸‹Dubboçš„å·¥ä½œåŸç†å—ï¼Ÿ"></a>èƒ½è¯´ä¸‹Dubboçš„å·¥ä½œåŸç†å—ï¼Ÿ</h3><ol><li>æœåŠ¡å¯åŠ¨çš„æ—¶å€™ï¼Œproviderå’Œconsumeræ ¹æ®é…ç½®ä¿¡æ¯ï¼Œè¿æ¥åˆ°æ³¨å†Œä¸­å¿ƒregisterï¼Œåˆ†åˆ«å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œå’Œè®¢é˜…æœåŠ¡</li><li>registeræ ¹æ®æœåŠ¡è®¢é˜…å…³ç³»ï¼Œè¿”å›providerä¿¡æ¯åˆ°consumerï¼ŒåŒæ—¶consumerä¼šæŠŠproviderä¿¡æ¯ç¼“å­˜åˆ°æœ¬åœ°ã€‚å¦‚æœä¿¡æ¯æœ‰å˜æ›´ï¼Œconsumerä¼šæ”¶åˆ°æ¥è‡ªregisterçš„æ¨é€</li><li>consumerç”Ÿæˆä»£ç†å¯¹è±¡ï¼ŒåŒæ—¶æ ¹æ®è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œé€‰æ‹©ä¸€å°providerï¼ŒåŒæ—¶å®šæ—¶å‘monitorè®°å½•æ¥å£çš„è°ƒç”¨æ¬¡æ•°å’Œæ—¶é—´ä¿¡æ¯</li><li>æ‹¿åˆ°ä»£ç†å¯¹è±¡ä¹‹åï¼Œconsumeré€šè¿‡ä»£ç†å¯¹è±¡å‘èµ·æ¥å£è°ƒç”¨</li><li>provideræ”¶åˆ°è¯·æ±‚åå¯¹æ•°æ®è¿›è¡Œååºåˆ—åŒ–ï¼Œç„¶åé€šè¿‡ä»£ç†è°ƒç”¨å…·ä½“çš„æ¥å£å®ç°</li></ol><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210118155952.webp" alt="å›¾ç‰‡"></p><h3 id="dubboæœåŠ¡æš´éœ²çš„è¿‡ç¨‹"><a href="#dubboæœåŠ¡æš´éœ²çš„è¿‡ç¨‹" class="headerlink" title="dubboæœåŠ¡æš´éœ²çš„è¿‡ç¨‹"></a>dubboæœåŠ¡æš´éœ²çš„è¿‡ç¨‹</h3><ol><li>åœ¨å®¹å™¨å¯åŠ¨çš„æ—¶å€™ï¼Œé€šè¿‡ServiceConfigè§£ææ ‡ç­¾ï¼Œåˆ›å»ºdubboæ ‡ç­¾è§£æå™¨æ¥è§£ædubboçš„æ ‡ç­¾ï¼Œå®¹å™¨åˆ›å»ºå®Œæˆä¹‹åï¼Œè§¦å‘ContextRefreshEventäº‹ä»¶å›è°ƒå¼€å§‹æš´éœ²æœåŠ¡</li><li>é€šè¿‡ProxyFactoryè·å–åˆ°invokerï¼ŒinvokeråŒ…å«äº†éœ€è¦æ‰§è¡Œçš„æ–¹æ³•çš„å¯¹è±¡ä¿¡æ¯å’Œå…·ä½“çš„URLåœ°å€</li><li>å†é€šè¿‡DubboProtocolçš„å®ç°æŠŠåŒ…è£…åçš„invokerè½¬æ¢æˆexporterï¼Œç„¶åå¯åŠ¨æœåŠ¡å™¨serverï¼Œç›‘å¬ç«¯å£</li><li>æœ€åRegistryProtocolä¿å­˜URLåœ°å€å’Œinvokerçš„æ˜ å°„å…³ç³»ï¼ŒåŒæ—¶æ³¨å†Œåˆ°æœåŠ¡ä¸­å¿ƒ</li></ol><p><img src="https://cdn.jsdelivr.net/gh/kuqi007/picGo/2021/20210118160055.webp" alt="å›¾ç‰‡"></p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://mp.weixin.qq.com/s/TOcBA5AFDsMNCCosI5tZZA">https://mp.weixin.qq.com/s/TOcBA5AFDsMNCCosI5tZZA</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•é‡åˆ°çš„ç®€å•å¤šçº¿ç¨‹ç¼–ç¨‹é¢˜ï¼šçº¿ç¨‹äº¤æ›¿æ‰“å°çš„å‡çº§ç‰ˆ</title>
      <link href="/posts/575b225b.html"/>
      <url>/posts/575b225b.html</url>
      
        <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>æœ€è¿‘é¢è¯•é‡åˆ°ä¸€é“ç®€å•çš„å¤šçº¿ç¨‹ç¼–ç é¢˜ï¼Œçº¿ç¨‹äº¤æ›¿æ‰“å°çš„å‡çº§ç‰ˆï¼Œæˆ‘ä»¬æ¥ç ”ç©¶ä¸‹è¿™é“é¢˜æ€ä¹ˆè§£å†³ã€‚  </p><h3 id="é¢˜ç›®ä»‹ç»ï¼š"><a href="#é¢˜ç›®ä»‹ç»ï¼š" class="headerlink" title="é¢˜ç›®ä»‹ç»ï¼š"></a>é¢˜ç›®ä»‹ç»ï¼š</h3><blockquote><p>çº¿ç¨‹Aæ¯æ¬¡å¤„ç†åªèƒ½è¾“å‡ºä¸€ä¸ªA<br>çº¿ç¨‹Bæ¯æ¬¡è¾“å‡ºåªèƒ½è¾“å‡ºä¸€ä¸ªB<br>ä¸»çº¿ç¨‹ä¸èƒ½è¾“å‡ºAæˆ–B<br>è¯·å°½å¯èƒ½ä¸ä½¿ç”¨å°è£…å¥½çš„å·¥å…·æ–¹æ³•æˆ–ç±»æ¥è°ƒåº¦çº¿ç¨‹ï¼Œç„¶åè¾“å‡ºä»¥ä¸‹å†…å®¹ï¼š<br>ABBBBABBBBABBBBABBBBâ€¦.<br>åŠ åˆ†é¡¹ï¼šå¢åŠ çº¿ç¨‹B1ï¼Œè¡Œä¸ºå’ŒBä¸€æ ·ï¼Œè¦æ±‚Bå’ŒB1è´Ÿè½½å‡è¡¡</p></blockquote><span id="more"></span><h3 id="é¢˜ç›®è§£æ"><a href="#é¢˜ç›®è§£æ" class="headerlink" title="é¢˜ç›®è§£æ"></a>é¢˜ç›®è§£æ</h3><p>è¾“å‡ºä¸€ä¸ªAç„¶åè¾“å‡º4ä¸ªBï¼Œä»¥æ­¤ç±»æ¨ï¼Œæœ€ç®€å•çš„åº”è¯¥æ˜¯ä½¿ç”¨synchronizedï¼Œwaitä»¥åŠnotifyæ–¹æ³•æ¥å®ç°ï¼Œè¿™é‡Œå¯ä»¥æŒ‡å®šä¸€ä¸ªè‡ªå¢çš„æ•´æ•°ï¼Œèƒ½è¢«5æ•´é™¤æ—¶æ‰“å°Aï¼Œä¸èƒ½è¢«5æ•´é™¤æ—¶æ‰“å°Bï¼Œè¯ä¸å¤šè¯´æˆ‘ä»¬æ¥çœ‹ä»£ç ã€‚</p><h3 id="ä½¿ç”¨synchronizedã€waitã€notifyæ–¹æ³•"><a href="#ä½¿ç”¨synchronizedã€waitã€notifyæ–¹æ³•" class="headerlink" title="ä½¿ç”¨synchronizedã€waitã€notifyæ–¹æ³•"></a>ä½¿ç”¨synchronizedã€waitã€notifyæ–¹æ³•</h3><h4 id="éè´Ÿè½½å‡è¡¡"><a href="#éè´Ÿè½½å‡è¡¡" class="headerlink" title="éè´Ÿè½½å‡è¡¡"></a>éè´Ÿè½½å‡è¡¡</h4><p>è¿™é‡Œæˆ‘ä»¬å…ˆä¸è€ƒè™‘B1çš„è´Ÿè½½å‡è¡¡ï¼Œç®€å•å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadTest</span> &#123;</span><br><span class="line">    <span class="comment">// é€’å¢çš„æ•´æ•°ç”¨æ¥åˆ¤æ–­æ‰“å°Aè¿˜æ˜¯B</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// è®¾ç½®ä¸€ä¸ªæ‰“å°ä¸Šé™ï¼Œæœ€å¤šæ‰“å°200ä¸ªå­—ç¬¦</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> <span class="number">200</span>;</span><br><span class="line">    <span class="comment">// å¯¹è±¡é”ï¼ˆå·¥å…·äººï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">tA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="comment">// å½“indexå°äºæœ€å¤§å€¼maxæ—¶ä¸€ç›´å¾ªç¯</span></span><br><span class="line">            <span class="keyword">while</span> (index &lt;= max) &#123;</span><br><span class="line">                <span class="comment">// äº‰å¤ºé”</span></span><br><span class="line">                <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">                    <span class="comment">// è¢«5æ•´é™¤è¾“å‡ºA</span></span><br><span class="line">                    <span class="keyword">if</span> (index % <span class="number">5</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                        System.out.print(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">                        <span class="comment">// indexåŠ ä¸€</span></span><br><span class="line">                        index++;</span><br><span class="line">                        <span class="comment">// å”¤é†’å…¶ä»–çº¿ç¨‹</span></span><br><span class="line">                        lock.notifyAll();</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// å› ä¸ºä¸èƒ½è¢«5æ•´é™¤åˆ™é‡Šæ”¾é”ï¼Œç­‰å¾…å…¶ä»–çº¿ç¨‹å”¤é†’</span></span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            lock.wait();</span><br><span class="line">                            <span class="comment">// å¦‚æœè¢«å”¤é†’çš„è¯ç»§ç»­ä¸‹æ¬¡å¾ªç¯ï¼Œæ­¤æ—¶è·å¾—é”</span></span><br><span class="line">                        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">tB</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span> (index &lt;= max) &#123;</span><br><span class="line">                <span class="comment">// äº‰å¤ºé”</span></span><br><span class="line">                <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">                    <span class="comment">// ä¸èƒ½è¢«5æ•´é™¤è¾“å‡ºB</span></span><br><span class="line">                    <span class="keyword">if</span> (index % <span class="number">5</span> != <span class="number">0</span>) &#123;</span><br><span class="line">                        System.out.print(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">                        index++;</span><br><span class="line">                        lock.notifyAll();</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// é‡Šæ”¾é”ï¼Œç­‰å¾…å…¶ä»–çº¿ç¨‹å”¤é†’</span></span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            lock.wait();</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        tA.start();</span><br><span class="line">        tB.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥çœ‹ä¸‹è¾“å‡ºç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBABBBBA</span><br></pre></td></tr></table></figure><h4 id="è´Ÿè½½å‡è¡¡å¦‚ä½•å®ç°ï¼Ÿ"><a href="#è´Ÿè½½å‡è¡¡å¦‚ä½•å®ç°ï¼Ÿ" class="headerlink" title="è´Ÿè½½å‡è¡¡å¦‚ä½•å®ç°ï¼Ÿ"></a>è´Ÿè½½å‡è¡¡å¦‚ä½•å®ç°ï¼Ÿ</h4><p>å¦‚æœè€ƒè™‘é¢˜ç›®é‡Œçš„è´Ÿè½½å‡è¡¡åº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿå…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œå¢åŠ å¦ä¸€ä¸ªæ ‡å¿—ä½å°±å¯ä»¥äº†ï¼Œåˆ¤æ–­indexèƒ½å¦è¢«5æ•´é™¤çš„æ—¶å€™é¡ºä¾¿åˆ¤æ–­ä¸‹æ ‡å¿—ä½æ˜¯å¦æ˜¯å½“å‰çº¿ç¨‹çš„æ ‡å¿—ä½å³å¯ï¼ˆä¸ªäººç†è§£ï¼Œå¦‚æœ‰é”™è¯¯è¿˜è¯·æŒ‡æ­£ï¼‰ï¼Œä¸Šä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadTest</span> &#123;</span><br><span class="line">    <span class="comment">// ä»0é€’å¢çš„æ•´æ•°ç”¨æ¥åˆ¤æ–­æ‰“å°Aè¿˜æ˜¯B</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// è®¾ç½®ä¸€ä¸ªæ‰“å°ä¸Šé™ï¼Œæœ€å¤šæ‰“å°200ä¸ªå­—ç¬¦ï¼Œé˜²æ­¢æ‰“å°è¿‡å¤šCPUæ‰›ä¸ä½</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> <span class="number">200</span>;</span><br><span class="line">    <span class="comment">// å¯¹è±¡é”ï¼ˆå·¥å…·äººï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="comment">// è´Ÿè½½æ ‡å¿—ä½ï¼Œ0çš„æ—¶å€™Bçº¿ç¨‹æ‰§è¡Œï¼Œ1çš„æ—¶å€™B1æ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">loadFlag</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">tA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="comment">// å½“indexå°äºæœ€å¤§å€¼maxæ—¶ä¸€ç›´å¾ªç¯</span></span><br><span class="line">            <span class="keyword">while</span> (index &lt;= max) &#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">                    <span class="comment">// è¢«5æ•´é™¤è¾“å‡ºA</span></span><br><span class="line">                    <span class="keyword">if</span> (index % <span class="number">5</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                        System.out.print(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">                        <span class="comment">// indexåŠ ä¸€</span></span><br><span class="line">                        index++;</span><br><span class="line">                        <span class="comment">// å”¤é†’å…¶ä»–çº¿ç¨‹</span></span><br><span class="line">                        lock.notifyAll();</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// å› ä¸ºä¸èƒ½è¢«5æ•´é™¤åˆ™é‡Šæ”¾é”ï¼Œç­‰å¾…å…¶ä»–çº¿ç¨‹å”¤é†’</span></span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            lock.wait();</span><br><span class="line">                            <span class="comment">// å¦‚æœè¢«å”¤é†’çš„è¯ç»§ç»­ä¸‹æ¬¡å¾ªç¯ï¼Œæ­¤æ—¶è·å¾—é”</span></span><br><span class="line">                        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">tB</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span> (index &lt;= max) &#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">                    <span class="comment">// ä¸èƒ½è¢«5æ•´é™¤è¾“å‡ºB</span></span><br><span class="line">                    <span class="keyword">if</span> (index % <span class="number">5</span> != <span class="number">0</span> &amp;&amp; loadFlag == <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="comment">// ä¸ºäº†çœ‹å‡ºè´Ÿè½½å‡è¡¡æ•ˆæœï¼Œè¿™é‡Œæ‰“å°B0</span></span><br><span class="line">                        System.out.print(<span class="string">&quot;B0&quot;</span>);</span><br><span class="line">                        index++;</span><br><span class="line">                        <span class="comment">// æ ‡å¿—ä½è®¾ç½®ä¸º1ï¼Œä¸‹æ¬¡B1çº¿ç¨‹æ‰§è¡Œ</span></span><br><span class="line">                        loadFlag = <span class="number">1</span>;</span><br><span class="line">                        lock.notifyAll();</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// é‡Šæ”¾é”ï¼Œç­‰å¾…å…¶ä»–çº¿ç¨‹å”¤é†’</span></span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            lock.wait();</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// æ–°å»ºçº¿ç¨‹B1</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">tB1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span> (index &lt;= max) &#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">                    <span class="comment">// å¦‚æœä¸èƒ½è¢«5æ•´é™¤ä¸”æ ‡å¿—ä½æ˜¯1åˆ™æ‰§è¡Œ</span></span><br><span class="line">                    <span class="keyword">if</span> (index % <span class="number">5</span> != <span class="number">0</span> &amp;&amp; loadFlag == <span class="number">1</span>) &#123;</span><br><span class="line">                        <span class="comment">// ä¸ºäº†çœ‹å‡ºè´Ÿè½½å‡è¡¡æ•ˆæœï¼Œè¿™é‡Œæ‰“å°B1</span></span><br><span class="line">                        System.out.print(<span class="string">&quot;B1&quot;</span>);</span><br><span class="line">                        index++;</span><br><span class="line">                        <span class="comment">// æ ‡å¿—ä½è®¾ç½®ä¸º0ï¼Œä¸‹æ¬¡Bçº¿ç¨‹æ‰§è¡Œ</span></span><br><span class="line">                        loadFlag = <span class="number">0</span>;</span><br><span class="line">                        lock.notifyAll();</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// é‡Šæ”¾é”ï¼Œç­‰å¾…å…¶ä»–çº¿ç¨‹å”¤é†’</span></span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            lock.wait();</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        tA.start();</span><br><span class="line">        tB.start();</span><br><span class="line">        tB1.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹ä¸‹æ•ˆæœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1AB0B1B0B1A</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> å¤šçº¿ç¨‹ </tag>
            
            <tag> é¢è¯•é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springã€SpringMvcã€SpringBootå’ŒSpringCloudçš„è”ç³»ä¸åŒºåˆ«</title>
      <link href="/posts/7e8f7b41.html"/>
      <url>/posts/7e8f7b41.html</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘é¢è¯•è¢«é—®åˆ°äº†Springã€SpringMvcã€SpringBootå’ŒSpringCloudçš„å…³ç³»å’ŒåŒºåˆ«ï¼Œä»¥åŠå„è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Œç®€å•æ•´ç†äº†ä¸‹å››è€…ä¹‹é—´çš„åŒºåˆ«å’Œè”ç³»ä»¥åŠè§£å†³çš„é—®é¢˜ï¼š</p><span id="more"></span><h5 id="Springå’ŒSpringMvcï¼š"><a href="#Springå’ŒSpringMvcï¼š" class="headerlink" title="Springå’ŒSpringMvcï¼š"></a>Springå’ŒSpringMvcï¼š</h5><ol><li>Springæ˜¯ä¸€ä¸ªä¸€ç«™å¼çš„è½»é‡çº§çš„javaå¼€å‘æ¡†æ¶ï¼Œæ ¸å¿ƒæ˜¯æ§åˆ¶åè½¬ï¼ˆIOCï¼‰å’Œé¢å‘åˆ‡é¢ï¼ˆAOPï¼‰ï¼Œé’ˆå¯¹äºå¼€å‘çš„WEBå±‚(SpringMvc)ã€ä¸šåŠ¡å±‚(Ioc)ã€æŒä¹…å±‚(jdbcTemplate)ç­‰éƒ½æä¾›äº†å¤šç§é…ç½®è§£å†³æ–¹æ¡ˆï¼›</li><li>SpringMvcæ˜¯SpringåŸºç¡€ä¹‹ä¸Šçš„ä¸€ä¸ªMVCæ¡†æ¶ï¼Œä¸»è¦å¤„ç†webå¼€å‘çš„è·¯å¾„æ˜ å°„å’Œè§†å›¾æ¸²æŸ“ï¼Œå±äºSpringæ¡†æ¶ä¸­WEBå±‚å¼€å‘çš„ä¸€éƒ¨åˆ†ï¼›</li></ol><h5 id="SpringMvcå’ŒSpringBootï¼š"><a href="#SpringMvcå’ŒSpringBootï¼š" class="headerlink" title="SpringMvcå’ŒSpringBootï¼š"></a>SpringMvcå’ŒSpringBootï¼š</h5><ol><li>SpringMvcå±äºä¸€ä¸ªä¼ä¸šWEBå¼€å‘çš„MVCæ¡†æ¶ï¼Œæ¶µç›–é¢åŒ…æ‹¬å‰ç«¯è§†å›¾å¼€å‘ã€æ–‡ä»¶é…ç½®ã€åå°æ¥å£é€»è¾‘å¼€å‘ç­‰ï¼ŒXMLã€configç­‰é…ç½®ç›¸å¯¹æ¯”è¾ƒç¹çå¤æ‚ï¼›</li><li>SpringBootæ¡†æ¶ç›¸å¯¹äºSpringMvcæ¡†æ¶æ¥è¯´ï¼Œæ›´ä¸“æ³¨äºå¼€å‘å¾®æœåŠ¡åå°æ¥å£ï¼Œä¸å¼€å‘å‰ç«¯è§†å›¾ï¼ŒåŒæ—¶éµå¾ªé»˜è®¤ä¼˜äºé…ç½®ï¼Œç®€åŒ–äº†æ’ä»¶é…ç½®æµç¨‹ï¼Œä¸éœ€è¦é…ç½®xmlï¼Œç›¸å¯¹Springmvcï¼Œå¤§å¤§ç®€åŒ–äº†é…ç½®æµç¨‹ï¼›</li></ol><h5 id="SpringBootå’ŒSpringCloudï¼š"><a href="#SpringBootå’ŒSpringCloudï¼š" class="headerlink" title="SpringBootå’ŒSpringCloudï¼š"></a>SpringBootå’ŒSpringCloudï¼š</h5><ol><li>Spring bootä½¿ç”¨äº†é»˜è®¤å¤§äºé…ç½®çš„ç†å¿µï¼Œé›†æˆäº†å¿«é€Ÿå¼€å‘çš„Springå¤šä¸ªæ’ä»¶ï¼ŒåŒæ—¶è‡ªåŠ¨è¿‡æ»¤ä¸éœ€è¦é…ç½®çš„å¤šä½™çš„æ’ä»¶ï¼Œç®€åŒ–äº†é¡¹ç›®çš„å¼€å‘é…ç½®æµç¨‹ï¼Œä¸€å®šç¨‹åº¦ä¸Šå–æ¶ˆxmlé…ç½®ï¼Œæ˜¯ä¸€å¥—å¿«é€Ÿé…ç½®å¼€å‘çš„è„šæ‰‹æ¶ï¼Œèƒ½å¿«é€Ÿå¼€å‘å•ä¸ªå¾®æœåŠ¡ï¼›</li><li>Spring cloudå¤§éƒ¨åˆ†çš„åŠŸèƒ½æ’ä»¶éƒ½æ˜¯åŸºäºSpringBootå»å®ç°çš„ï¼ŒSpringCloudå…³æ³¨äºå…¨å±€çš„å¾®æœåŠ¡æ•´åˆå’Œç®¡ç†ï¼Œå°†å¤šä¸ªSpringBootå•ä½“å¾®æœåŠ¡è¿›è¡Œæ•´åˆä»¥åŠç®¡ç†ï¼›  SpringCloudä¾èµ–äºSpringBootå¼€å‘ï¼Œè€ŒSpringBootå¯ä»¥ç‹¬ç«‹å¼€å‘ï¼›</li></ol><h4 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h4><ol><li>Spring æ¡†æ¶å°±åƒä¸€ä¸ªå®¶æ—ï¼Œæœ‰ä¼—å¤šè¡ç”Ÿäº§å“ä¾‹å¦‚ bootã€securityã€jpaç­‰ç­‰ã€‚ä½†ä»–ä»¬çš„åŸºç¡€éƒ½æ˜¯Springçš„iocã€aopç­‰ã€‚ ioc æä¾›äº†ä¾èµ–æ³¨å…¥çš„å®¹å™¨ï¼Œ aopè§£å†³äº†é¢å‘æ¨ªåˆ‡é¢ç¼–ç¨‹ï¼Œç„¶ååœ¨æ­¤ä¸¤è€…çš„åŸºç¡€ä¸Šå®ç°äº†å…¶ä»–å»¶ä¼¸äº§å“çš„é«˜çº§åŠŸèƒ½ï¼›</li><li>SpringMvcæ˜¯åŸºäºServlet çš„ä¸€ä¸ªMVCæ¡†æ¶ä¸»è¦è§£å†³WEBå¼€å‘çš„é—®é¢˜ï¼Œå› ä¸ºSpringçš„é…ç½®éå¸¸å¤æ‚ï¼Œå„ç§XMLã€JavaConfigã€servletå¤„ç†èµ·æ¥æ¯”è¾ƒç¹çï¼›</li><li>ä¸ºäº†ç®€åŒ–å¼€å‘è€…çš„ä½¿ç”¨ï¼Œä»è€Œåˆ›é€ æ€§åœ°æ¨å‡ºäº†SpringBootæ¡†æ¶ï¼Œé»˜è®¤ä¼˜äºé…ç½®ï¼Œç®€åŒ–äº†SpringMvcçš„é…ç½®æµç¨‹ï¼›<br>ä½†åŒºåˆ«äºSpringMvcçš„æ˜¯ï¼ŒSpringBootä¸“æ³¨äºå¾®æœåŠ¡æ–¹é¢çš„æ¥å£å¼€å‘ï¼Œå’Œå‰ç«¯è§£è€¦ï¼Œè™½ç„¶SpringBootä¹Ÿå¯ä»¥åšæˆSpringMvcå‰åå°ä¸€èµ·å¼€å‘ï¼Œä½†æ˜¯è¿™å°±æœ‰ç‚¹ä¸ç¬¦åˆSpringBootæ¡†æ¶çš„åˆè¡·äº†ï¼›</li><li>å¯¹äºSpringCloudæ¡†æ¶æ¥è¯´ï¼Œå®ƒå’ŒSpringBootä¸€æ ·ï¼Œæ³¨é‡çš„æ˜¯å¾®æœåŠ¡çš„å¼€å‘ï¼Œä½†æ˜¯SpringCloudæ›´å…³æ³¨çš„æ˜¯å…¨å±€å¾®æœåŠ¡çš„æ•´åˆå’Œç®¡ç†ï¼Œç›¸å½“äºç®¡ç†å¤šä¸ªSpringBootæ¡†æ¶çš„å•ä½“å¾®æœåŠ¡ï¼›</li></ol><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/alan_liuyue/article/details/80656687">https://blog.csdn.net/alan_liuyue/article/details/80656687</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootæ‰“åŒ…æ—¶å¤åˆ¶æŒ‡å®šé…ç½®æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•ï¼Œå¹¶å‰”é™¤jaråŒ…å†…æ‰€æœ‰é…ç½®æ–‡ä»¶</title>
      <link href="/posts/9ca55b1a.html"/>
      <url>/posts/9ca55b1a.html</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘é‡åˆ°ä¸€ä¸ªéœ€æ±‚ï¼ŒæŠŠSpringBooté¡¹ç›®çš„é…ç½®æ–‡ä»¶æ”¾åˆ°JaråŒ…å¤–é¢ï¼ŒJaråŒ…å†…ä¸åŒ…å«å¤šä½™é…ç½®æ–‡ä»¶ï¼ŒJaråŒ…è¿è¡Œæ—¶æŒ‡å®šå¤–éƒ¨é…ç½®æ–‡ä»¶å¯åŠ¨ã€‚æˆ‘çš„é…ç½®æ–‡ä»¶æ”¾åœ¨src&#x2F;main&#x2F;resources&#x2F;configä¸‹ï¼Œæ‰“åŒ…æ—¶æ‹·è´åˆ°JaråŒ…åŒçº§configç›®å½•ä¸‹ï¼ˆSpringBooté»˜è®¤æ”¯æŒè¯»å–JaråŒ…åŒçº§configæ–‡ä»¶å¤¹ä¸­çš„é…ç½®ï¼‰ï¼Œå…·ä½“è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p><ul><li><p>ä½¿ç”¨maven-jar-pluginæ’ä»¶ç§»é™¤é…ç½®æ–‡ä»¶å°†å…¶ä¸æ‰“åŒ…è¿›jaråŒ…ä¸­</p></li><li><p>ä½¿ç”¨maven-resources-pluginæ’ä»¶å°†éœ€è¦å¤åˆ¶çš„æ–‡ä»¶å¤åˆ¶åˆ°æŒ‡å®šè·¯å¾„ï¼ˆä¾‹ï¼šå°†é…ç½®æ–‡ä»¶æå–åˆ°æŒ‡å®šè·¯å¾„ï¼‰</p><p>Mavené…ç½®å¦‚ä¸‹ï¼š</p><span id="more"></span></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--å£°æ˜å¤šç¯å¢ƒ--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æœ¬åœ°å¼€å‘ç¯å¢ƒ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">profiles.active</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">profiles.active</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">modifier</span>&gt;</span><span class="tag">&lt;/<span class="name">modifier</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- é»˜è®¤çš„ï¼Œä¸åŠ å‚æ•°æ—¶æ‰§è¡Œè¿™ä¸ªprofile --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span>      </span><br><span class="line">        <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æµ‹è¯•ç¯å¢ƒ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>test<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">profiles.active</span>&gt;</span>test<span class="tag">&lt;/<span class="name">profiles.active</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">modifier</span>&gt;</span>-test<span class="tag">&lt;/<span class="name">modifier</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- ç”Ÿäº§ç¯å¢ƒ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>prod<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">profiles.active</span>&gt;</span>prod<span class="tag">&lt;/<span class="name">profiles.active</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">modifier</span>&gt;</span>-prod<span class="tag">&lt;/<span class="name">modifier</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å¤åˆ¶æŒ‡å®šç¯å¢ƒé…ç½®æ–‡ä»¶åˆ°æŒ‡å®šç›®å½• --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-resources-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>copy-resources<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>copy-resources<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources/config<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>application.yml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>application-$&#123;profiles.active&#125;.yml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;project.build.directory&#125;/config<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- jaråŒ…å†…å‰”é™¤æ‰€æœ‰é…ç½®æ–‡ä»¶ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-jar-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--ä¸æ‰“å…¥jaråŒ…çš„æ–‡ä»¶ç±»å‹æˆ–è€…è·¯å¾„--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>config/**<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æœ€åæ‰§è¡Œ<code>mvn clean package -P prod</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨gitlab-ciå’Œdockerè‡ªåŠ¨åŒ–éƒ¨ç½²vueé¡¹ç›®</title>
      <link href="/posts/1b05c064.html"/>
      <url>/posts/1b05c064.html</url>
      
        <content type="html"><![CDATA[<h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p>ä¹‹å‰ç”¨dockerçš„æ—¶å€™æƒ³åˆ°gitlabå¯ä»¥ç›´æ¥æäº¤ä»£ç è§¦å‘dockerç¼–è¯‘éƒ¨ç½²ï¼Œéå¸¸æ–¹ä¾¿ï¼Œäºæ˜¯è¯•éªŒäº†ä¸€ä¸ªå•ä½“vueé¡¹ç›®å¦‚ä½•ä½¿ç”¨gitlabå’Œdockerçš„å¼ºå¤§åŠŸèƒ½è¿›è¡Œç¼–è¯‘å‘å¸ƒï¼Œæ­¤æ•™ç¨‹ä»…ä¾›å‚è€ƒï¼Œé€‚ç”¨äºå…¬å¸æˆ–è€…ä¸ªäººæµ‹è¯•ã€‚</p><span id="more"></span><h3 id="ä¸€ã€å®‰è£…gitlab-runnerï¼Œåœ¨runneræœºå™¨ä¸Šå®‰è£…gitç­‰"><a href="#ä¸€ã€å®‰è£…gitlab-runnerï¼Œåœ¨runneræœºå™¨ä¸Šå®‰è£…gitç­‰" class="headerlink" title="ä¸€ã€å®‰è£…gitlab-runnerï¼Œåœ¨runneræœºå™¨ä¸Šå®‰è£…gitç­‰"></a>ä¸€ã€å®‰è£…gitlab-runnerï¼Œåœ¨runneræœºå™¨ä¸Šå®‰è£…gitç­‰</h3><p>ç”±äºå…¬å¸gitlabç‰ˆæœ¬æ˜¯8.xï¼Œæ¯”è¾ƒè€ï¼Œåªèƒ½å®‰è£…1.xç‰ˆæœ¬çš„gialab-runnerï¼Œè¿™é‡Œæ¯”è¾ƒæ³¨æ„çš„æ˜¯ï¼Œä¸€èˆ¬runnerå’Œgitlabä¼šåˆ†åˆ«å®‰è£…åˆ°ä¸¤å°æœåŠ¡å™¨ä¸Šï¼Œå…·ä½“å®‰è£…æ­¥éª¤å¯ä»¥<a href="http://muchstudy.com/2018/07/13/Gitlab-8-x-runner%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/">å‚è€ƒè¿™ç¯‡æ–‡ç« </a>ã€‚å®‰è£…å¥½ä¹‹ååˆ›å»ºä¸¤ä¸ªrunnerï¼šä¸€ä¸ª<code>docker</code>ç±»å‹runnerï¼Œæ‰“ä¸ŠCIæ ‡ç­¾ï¼›ä¸€ä¸ª<code>shell</code>ç±»å‹runnerï¼Œæ‰“ä¸ŠCDæ ‡ç­¾ã€‚å› ä¸ºä¼šä½¿ç”¨åˆ°shellçš„runnerï¼Œæ‰€ä»¥éœ€è¦å®‰è£…gitï¼Œå®‰è£…è¿‡ç¨‹ä¸å†èµ˜è¿°ï¼Œå½“ç„¶å¦‚æœä½ runnerä¸æ˜¯è¿™æ ·ç”¨ï¼Œå¯èƒ½è¿˜éœ€è¦å®‰è£…nodejsç­‰ç¯å¢ƒã€‚</p><h3 id="äºŒã€ç¼–å†™Dockerfile"><a href="#äºŒã€ç¼–å†™Dockerfile" class="headerlink" title="äºŒã€ç¼–å†™Dockerfile"></a>äºŒã€ç¼–å†™Dockerfile</h3><p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ–°å»ºdockerç›®å½•ï¼Œç¼–å†™Dockerfileï¼Œæ³¨æ„ç›¸å¯¹è·¯å¾„é—®é¢˜ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># è®¾ç½®åŸºç¡€é•œåƒ</span><br><span class="line">FROM nginx</span><br><span class="line">#è®¾ç½®CTSæ—¶åŒº</span><br><span class="line">RUN cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; echo &#x27;Asia/Shanghai&#x27; &gt;/etc/timezone</span><br><span class="line"># å°†distæ–‡ä»¶ä¸­çš„å†…å®¹å¤åˆ¶åˆ° /usr/share/nginx/html/ è¿™ä¸ªç›®å½•ä¸‹é¢</span><br><span class="line">COPY ./dist /usr/share/nginx/html/</span><br><span class="line">#ç”¨æœ¬åœ°çš„ default.conf é…ç½®æ¥æ›¿æ¢nginxé•œåƒé‡Œçš„é»˜è®¤é…ç½®</span><br><span class="line">COPY docker/default.conf /etc/nginx/conf.d/default.conf</span><br><span class="line">EXPOSE 80</span><br><span class="line">CMD [&quot;nginx&quot;,&quot;-g&quot;,&quot;daemon off;&quot;]</span><br></pre></td></tr></table></figure><p>åŒæ ·åœ¨dockerç›®å½•ä¸‹æ–°å¢Nginxé…ç½®æ–‡ä»¶default.confï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    #charset koi8-r;</span><br><span class="line">    access_log  /var/log/nginx/host.access.log  main;</span><br><span class="line">    error_log  /var/log/nginx/error.log  error;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        root   /usr/share/nginx/html;</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">        try_files $uri $uri/ /index.html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #error_page  404              /404.html;</span><br><span class="line"></span><br><span class="line">    # redirect server error pages to the static page /50x.html</span><br><span class="line">    #</span><br><span class="line">    error_page   500 502 503 504  /50x.html;</span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">        root   /usr/share/nginx/html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸‰ã€åœ¨gitlabä¸Šæ·»åŠ å·²æœ‰runnerï¼Œåˆ›å»º-gitlab-ci-ymlæ–‡ä»¶"><a href="#ä¸‰ã€åœ¨gitlabä¸Šæ·»åŠ å·²æœ‰runnerï¼Œåˆ›å»º-gitlab-ci-ymlæ–‡ä»¶" class="headerlink" title="ä¸‰ã€åœ¨gitlabä¸Šæ·»åŠ å·²æœ‰runnerï¼Œåˆ›å»º.gitlab-ci.ymlæ–‡ä»¶"></a>ä¸‰ã€åœ¨gitlabä¸Šæ·»åŠ å·²æœ‰runnerï¼Œåˆ›å»º.gitlab-ci.ymlæ–‡ä»¶</h3><p>ä»¥ä¸Šå·¥ä½œå‡†å¤‡å°±ç»ªä¹‹ååœ¨gitlabä¸Šæ·»åŠ ä¸¤ä¸ªrunnerï¼Œåˆ†åˆ«å¯¹åº”ç¬¬ä¸€æ­¥CIå’ŒCDæ ‡ç­¾çš„runnerï¼Œé¡¾åæ€ä¹‰ï¼ŒCIç”¨äºç¼–è¯‘æ‰“åŒ…ï¼ŒCDç”¨äºéƒ¨ç½²è¿è¡Œã€‚æ²¡æœ‰.gitlab-ci.ymlæ–‡ä»¶çš„åœ¨é¡¹ç›®æ ¹ç›®å½•æ–°å»ºè¯¥æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">job-build:</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">node:alpine</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="comment"># ciæ˜¯dockerç±»å‹çš„runner</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ci</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">npm</span> <span class="string">install</span> <span class="string">-g</span> <span class="string">cnpm</span> <span class="string">--registry=https://registry.npm.taobao.org</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">cnpm</span> <span class="string">install</span> <span class="string">--progress=false</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">cnpm</span> <span class="string">run</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">artifacts:</span></span><br><span class="line">    <span class="attr">expire_in:</span> <span class="number">1</span> <span class="string">week</span></span><br><span class="line">    <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">dist</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">docker</span></span><br><span class="line"></span><br><span class="line"><span class="attr">job-release:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">deploy</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line">  <span class="attr">dependencies:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">job-build</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="comment"># cdæ˜¯shellç±»å‹çš„runner</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">cd</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">build</span> <span class="string">-f</span> <span class="string">docker/Dockerfile</span> <span class="string">-t</span> <span class="string">ngnix/app:v1.0.0</span> <span class="string">.</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">if</span> [ <span class="string">$(docker</span> <span class="string">ps</span> <span class="string">-aq</span> <span class="string">--filter</span> <span class="string">name=app-test)</span> ]<span class="string">;</span> <span class="string">then</span> <span class="string">docker</span> <span class="string">rm</span> <span class="string">-f</span> <span class="string">rhea-cms;fi</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">run</span> <span class="string">-p</span> <span class="number">80</span><span class="string">:80</span> <span class="string">--name</span> <span class="string">app-test</span> <span class="string">-d</span> <span class="string">ngnix/app:v1.0.0</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨åˆ°äº†gitlabçš„artifactsåŠŸèƒ½ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å»çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œç±»ä¼¼ç¼“å­˜çš„ä½œç”¨ï¼Œç¬¬äºŒæ­¥å‘å¸ƒçš„æ—¶å€™å°±æ— éœ€æ‹‰å–ä»£ç ç¼–è¯‘ç›´æ¥ä½¿ç”¨ä¸Šä¸€æ­¥å½’æ¡£çš„distå’Œdockeræ–‡ä»¶å¤¹ã€‚æäº¤æ‰€æœ‰æ›´æ”¹ä¹‹åæ‰€æœ‰masteråˆ†æ”¯çš„æäº¤å°±ä¼šè§¦å‘ä¸€ç³»åˆ—ç¼–è¯‘éƒ¨ç½²æ“ä½œäº†ã€‚</p><h4 id="é‡åˆ°çš„é—®é¢˜ï¼š"><a href="#é‡åˆ°çš„é—®é¢˜ï¼š" class="headerlink" title="é‡åˆ°çš„é—®é¢˜ï¼š"></a>é‡åˆ°çš„é—®é¢˜ï¼š</h4><p>1.gitlab-runneræ‰§è¡Œdockerå‘½ä»¤çš„æ—¶å€™é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯gitlab-runnerç”¨æˆ·æƒé™ä¸å¤Ÿï¼Œç»“æœæŒ‰ç…§ç½‘ä¸Šæ•™ç¨‹å’Œæ›´æ”¹ç”¨æˆ·åˆ†ç»„éƒ½æ²¡ç”¨ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock</span><br></pre></td></tr></table></figure><p>åæ¥æ‰¾åˆ°ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">usermod -aG docker gitlab-runner</span><br><span class="line">sudo service docker restart</span><br></pre></td></tr></table></figure><p>å®Œç¾è§£å†³ã€‚</p><p>2.ä½¿ç”¨gitlab-ci runneræ‹‰å–gitä»£ç é‡åˆ°è¿™ä¸ªé—®é¢˜ï¼Œé‡æ–°ç¼–è¯‘å®‰è£…gitéƒ½æ²¡ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fatal: unable to find remote helper for &#x27;http&#x27;</span><br></pre></td></tr></table></figure><p>åæ¥å‘ç°æ˜¯ç¼–è¯‘å®‰è£…gitçš„æ—¶å€™ç¼ºå°‘äº†curl-develçš„libä¾èµ–ï¼Œyumå®‰è£…ä¾èµ–å†é‡æ–°ç¼–è¯‘å®‰è£…gitå°±å¯ä»¥äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ yum install curl-devel</span><br><span class="line">$ # cd to wherever the source for git is</span><br><span class="line">$ cd /usr/local/src/git-1.7.9  </span><br><span class="line">$ ./configure</span><br><span class="line">$ make</span><br><span class="line">$ make install</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€è½¬ã€‘CoreOSé…ç½®Docker API TLSè®¤è¯</title>
      <link href="/posts/a623d7c5.html"/>
      <url>/posts/a623d7c5.html</url>
      
        <content type="html"><![CDATA[<p>æˆ‘ä»¬ç»å¸¸ä¼šåˆ©ç”¨Portaineræ¥ç®¡ç†dockerç¯å¢ƒï¼Œä¹Ÿç»å¸¸ä¼šç”¨Jenkinsæ¥è‡ªåŠ¨æ„å»ºå’Œéƒ¨ç½²dockerï¼Œè¿œç¨‹ç®¡ç†éƒ½ä¼šä½¿ç”¨åˆ°Docker APIï¼Œé€šå¸¸æˆ‘ä»¬åªæ˜¯å¼€å¯äº†æ²¡æœ‰å®‰å…¨ä¿æŠ¤çš„2375ï¼ˆé€šå¸¸ï¼‰ç«¯å£ï¼Œè¿™ä¸ªæ¯”è¾ƒå±é™©ï¼Œä¼šå¯¼è‡´è¿œç¨‹åŠ«æŒæ”»å‡»ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦é…ç½®TLSè®¤è¯çš„2376ï¼ˆé€šå¸¸ï¼‰ç«¯å£ã€‚</p><span id="more"></span><p>ä¸‹é¢æˆ‘ä»¬é’ˆå¯¹CoreOSç³»ç»Ÿè¿›è¡Œé…ç½®ï¼š</p><h3 id="ä¸€ã€åˆ©ç”¨ç³»ç»Ÿè‡ªå¸¦çš„opensslç”Ÿæˆç›¸åº”çš„æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯è¯ä¹¦"><a href="#ä¸€ã€åˆ©ç”¨ç³»ç»Ÿè‡ªå¸¦çš„opensslç”Ÿæˆç›¸åº”çš„æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯è¯ä¹¦" class="headerlink" title="ä¸€ã€åˆ©ç”¨ç³»ç»Ÿè‡ªå¸¦çš„opensslç”Ÿæˆç›¸åº”çš„æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯è¯ä¹¦"></a>ä¸€ã€åˆ©ç”¨ç³»ç»Ÿè‡ªå¸¦çš„opensslç”Ÿæˆç›¸åº”çš„æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯è¯ä¹¦</h3><p>æˆ‘ä»¬åˆ©ç”¨è„šæœ¬è‡ªåŠ¨ç”Ÿæˆï¼Œè¿™æ ·éå¸¸ä¾¿æ·ï¼Œè„šæœ¬ï¼ˆauto-tls-certs.shï¼‰å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># -------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># è‡ªåŠ¨åˆ›å»º Docker TLS è¯ä¹¦</span></span><br><span class="line"><span class="comment"># -------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»¥ä¸‹æ˜¯é…ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="comment"># --[BEGIN]------------------------------</span></span><br><span class="line"></span><br><span class="line">CODE=<span class="string">&quot;dp&quot;</span></span><br><span class="line">IP=<span class="string">&quot;dockeræœåŠ¡å™¨ip&quot;</span></span><br><span class="line">PASSWORD=<span class="string">&quot;è¯ä¹¦å¯†ç &quot;</span></span><br><span class="line">COUNTRY=<span class="string">&quot;CN&quot;</span></span><br><span class="line">STATE=<span class="string">&quot;BEIJING&quot;</span></span><br><span class="line">CITY=<span class="string">&quot;BEIJING&quot;</span></span><br><span class="line">ORGANIZATION=<span class="string">&quot;å…¬å¸&quot;</span></span><br><span class="line">ORGANIZATIONAL_UNIT=<span class="string">&quot;Dev&quot;</span></span><br><span class="line">COMMON_NAME=<span class="string">&quot;<span class="variable">$IP</span>&quot;</span></span><br><span class="line">EMAIL=<span class="string">&quot;é‚®ç®±&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --[END]--</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Generate CA key</span></span><br><span class="line">openssl genrsa -aes256 -passout <span class="string">&quot;pass:<span class="variable">$PASSWORD</span>&quot;</span> -out <span class="string">&quot;ca-key-<span class="variable">$CODE</span>.pem&quot;</span> 4096</span><br><span class="line"><span class="comment"># Generate CA</span></span><br><span class="line">openssl req -new -x509 -days 365 -key <span class="string">&quot;ca-key-<span class="variable">$CODE</span>.pem&quot;</span> -sha256 -out <span class="string">&quot;ca-<span class="variable">$CODE</span>.pem&quot;</span> -passin <span class="string">&quot;pass:<span class="variable">$PASSWORD</span>&quot;</span> -subj <span class="string">&quot;/C=<span class="variable">$COUNTRY</span>/ST=<span class="variable">$STATE</span>/L=<span class="variable">$CITY</span>/O=<span class="variable">$ORGANIZATION</span>/OU=<span class="variable">$ORGANIZATIONAL_UNIT</span>/CN=<span class="variable">$COMMON_NAME</span>/emailAddress=<span class="variable">$EMAIL</span>&quot;</span></span><br><span class="line"><span class="comment"># Generate Server key</span></span><br><span class="line">openssl genrsa -out <span class="string">&quot;server-key-<span class="variable">$CODE</span>.pem&quot;</span> 4096</span><br><span class="line"></span><br><span class="line"><span class="comment"># Generate Server Certs.</span></span><br><span class="line">openssl req -subj <span class="string">&quot;/CN=<span class="variable">$COMMON_NAME</span>&quot;</span> -sha256 -new -key <span class="string">&quot;server-key-<span class="variable">$CODE</span>.pem&quot;</span> -out server.csr</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;subjectAltName = IP:<span class="variable">$IP</span>,IP:127.0.0.1&quot;</span> &gt;&gt; extfile.cnf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;extendedKeyUsage = serverAuth&quot;</span> &gt;&gt; extfile.cnf</span><br><span class="line"></span><br><span class="line">openssl x509 -req -days 365 -sha256 -<span class="keyword">in</span> server.csr -passin <span class="string">&quot;pass:<span class="variable">$PASSWORD</span>&quot;</span> -CA <span class="string">&quot;ca-<span class="variable">$CODE</span>.pem&quot;</span> -CAkey <span class="string">&quot;ca-key-<span class="variable">$CODE</span>.pem&quot;</span> -CAcreateserial -out <span class="string">&quot;server-cert-<span class="variable">$CODE</span>.pem&quot;</span> -extfile extfile.cnf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Generate Client Certs.</span></span><br><span class="line"><span class="built_in">rm</span> -f extfile.cnf</span><br><span class="line"></span><br><span class="line">openssl genrsa -out <span class="string">&quot;key-<span class="variable">$CODE</span>.pem&quot;</span> 4096</span><br><span class="line">openssl req -subj <span class="string">&#x27;/CN=client&#x27;</span> -new -key <span class="string">&quot;key-<span class="variable">$CODE</span>.pem&quot;</span> -out client.csr</span><br><span class="line"><span class="built_in">echo</span> extendedKeyUsage = clientAuth &gt;&gt; extfile.cnf</span><br><span class="line">openssl x509 -req -days 365 -sha256 -<span class="keyword">in</span> client.csr -passin <span class="string">&quot;pass:<span class="variable">$PASSWORD</span>&quot;</span> -CA <span class="string">&quot;ca-<span class="variable">$CODE</span>.pem&quot;</span> -CAkey <span class="string">&quot;ca-key-<span class="variable">$CODE</span>.pem&quot;</span> -CAcreateserial -out <span class="string">&quot;cert-<span class="variable">$CODE</span>.pem&quot;</span> -extfile extfile.cnf</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -vf client.csr server.csr</span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> -v 0400 <span class="string">&quot;ca-key-<span class="variable">$CODE</span>.pem&quot;</span> <span class="string">&quot;key-<span class="variable">$CODE</span>.pem&quot;</span> <span class="string">&quot;server-key-<span class="variable">$CODE</span>.pem&quot;</span></span><br><span class="line"><span class="built_in">chmod</span> -v 0444 <span class="string">&quot;ca-<span class="variable">$CODE</span>.pem&quot;</span> <span class="string">&quot;server-cert-<span class="variable">$CODE</span>.pem&quot;</span> <span class="string">&quot;cert-<span class="variable">$CODE</span>.pem&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“åŒ…å®¢æˆ·ç«¯è¯ä¹¦</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="string">&quot;tls-client-certs-<span class="variable">$CODE</span>&quot;</span></span><br><span class="line"><span class="built_in">cp</span> -f <span class="string">&quot;ca-<span class="variable">$CODE</span>.pem&quot;</span> <span class="string">&quot;cert-<span class="variable">$CODE</span>.pem&quot;</span> <span class="string">&quot;key-<span class="variable">$CODE</span>.pem&quot;</span> <span class="string">&quot;tls-client-certs-<span class="variable">$CODE</span>/&quot;</span></span><br><span class="line"><span class="built_in">cd</span> <span class="string">&quot;tls-client-certs-<span class="variable">$CODE</span>&quot;</span></span><br><span class="line">tar zcf <span class="string">&quot;tls-client-certs-<span class="variable">$CODE</span>.tar.gz&quot;</span> *</span><br><span class="line"><span class="built_in">mv</span> <span class="string">&quot;tls-client-certs-<span class="variable">$CODE</span>.tar.gz&quot;</span> ../</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"><span class="built_in">rm</span> -rf <span class="string">&quot;tls-client-certs-<span class="variable">$CODE</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹·è´æœåŠ¡ç«¯è¯ä¹¦</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /etc/docker/certs.d</span><br><span class="line"><span class="built_in">cp</span> <span class="string">&quot;ca-<span class="variable">$CODE</span>.pem&quot;</span> <span class="string">&quot;server-cert-<span class="variable">$CODE</span>.pem&quot;</span> <span class="string">&quot;server-key-<span class="variable">$CODE</span>.pem&quot;</span> /etc/docker/certs.d/</span><br></pre></td></tr></table></figure><p>å¯¹è„šæœ¬ä¸­çš„å˜é‡è¿›è¡Œä¿®æ”¹åè¿è¡Œï¼Œè‡ªåŠ¨ä¼šåˆ›å»ºå¥½tlsè¯ä¹¦ï¼ŒæœåŠ¡å™¨çš„è¯ä¹¦åœ¨&#x2F;etc&#x2F;docker&#x2F;certs.d&#x2F;ç›®å½•ä¸‹:<br><img src="https://oscimg.oschina.net/oscnet/cf128d18f1e5494241522354509639ac476.jpg" alt="image"><br>å®¢æˆ·ç«¯çš„è¯ä¹¦åœ¨è¿è¡Œè„šæœ¬çš„ç›®å½•ä¸‹ï¼ŒåŒæ—¶è¿˜è‡ªåŠ¨æ‰“å¥½äº†ä¸€ä¸ª.tar.gzçš„åŒ…ï¼Œå¾ˆæ–¹ä¾¿ã€‚<br><img src="https://oscimg.oschina.net/oscnet/a52727e6614faf2c2985912dd992a699ef8.jpg" alt="image"></p><h3 id="äºŒã€é…ç½®DockeræœåŠ¡ï¼ˆå®˜æ–¹è¯´æ˜ï¼‰"><a href="#äºŒã€é…ç½®DockeræœåŠ¡ï¼ˆå®˜æ–¹è¯´æ˜ï¼‰" class="headerlink" title="äºŒã€é…ç½®DockeræœåŠ¡ï¼ˆå®˜æ–¹è¯´æ˜ï¼‰"></a>äºŒã€é…ç½®DockeræœåŠ¡ï¼ˆå®˜æ–¹è¯´æ˜ï¼‰</h3><p>æ³¨æ„ä¿®æ”¹è¯ä¹¦è·¯å¾„ã€‚</p><p>Enable the secure remote API on a new socket<br>Create a file called ++&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;docker-tls-tcp.socket++ to make Docker available on a secured TCP socket on port 2376.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Docker Secured Socket for the API</span><br><span class="line"></span><br><span class="line">[Socket]</span><br><span class="line">ListenStream=2376</span><br><span class="line">BindIPv6Only=both</span><br><span class="line">Service=docker.service</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=sockets.target</span><br></pre></td></tr></table></figure><p>Then enable this new socket:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable docker-tls-tcp.socket</span><br><span class="line">systemctl stop docker</span><br><span class="line">systemctl start docker-tls-tcp.socket</span><br></pre></td></tr></table></figure><h5 id="Drop-in-configuration"><a href="#Drop-in-configuration" class="headerlink" title="Drop-in configuration"></a>Drop-in configuration</h5><p>Create ++&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;docker.service.d&#x2F;10-tls-verify.conf++ drop-in for systemd Docker service:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[Service]</span><br><span class="line">Environment=&quot;DOCKER_OPTS=--tlsverify --tlscacert=/etc/docker/ca.pem --tlscert=/etc/docker/server.pem --tlskey=/etc/docker/server-key.pem&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Reload systemd config files and restart docker service:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker.service</span><br></pre></td></tr></table></figure><h3 id="ä¸‰ã€é…ç½®Portainerè¿œç¨‹TLSè¿æ¥"><a href="#ä¸‰ã€é…ç½®Portainerè¿œç¨‹TLSè¿æ¥" class="headerlink" title="ä¸‰ã€é…ç½®Portainerè¿œç¨‹TLSè¿æ¥"></a>ä¸‰ã€é…ç½®Portainerè¿œç¨‹TLSè¿æ¥</h3><p><img src="https://oscimg.oschina.net/oscnet/a42a8fc88e593b51007b357d9588cc7e37c.jpg" alt="image"></p><p>è¯ä¹¦å¯¹åº”é€‰æ‹©ï¼š</p><p>ca.pem<br>cert.pem<br>key.pem<br>è¿™æ ·å°±å®Œæˆäº†ã€‚æ³¨æ„å¦‚æœä¹‹å‰å¼€å¯äº†æœªè®¤è¯çš„2375ç«¯å£ï¼Œè¯·å…³é—­å¹¶ç¦ç”¨ï¼Œé‡å¯dockeræœåŠ¡ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># åœæ­¢ä¸å®‰å…¨çš„2375ç«¯å£</span><br><span class="line">systemctl stop docker-tcp.socket</span><br><span class="line"></span><br><span class="line"># ç¦ç”¨è¯¥ç«¯å£</span><br><span class="line">systemctl disable docker-tcp.socket</span><br><span class="line"></span><br><span class="line"># é‡å¯dockeræœåŠ¡</span><br><span class="line">systemctl restart docker.service</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ORMæ¡†æ¶å¯¹æ¯”</title>
      <link href="/posts/9eb10313.html"/>
      <url>/posts/9eb10313.html</url>
      
        <content type="html"><![CDATA[<p>ã€€ã€€å› ä¸ºé¡¹ç›®éœ€è¦é€‰æ‹©æ•°æ®æŒä¹…åŒ–æ¡†æ¶ï¼Œçœ‹äº†ä¸€ä¸‹ä¸»è¦å‡ ä¸ªæµè¡Œçš„å’Œä¸æµè¡Œçš„æ¡†æ¶ï¼Œå¯¹äºå¤æ‚ä¸šåŠ¡ç³»ç»Ÿï¼Œæœ€ç»ˆçš„ç»“è®ºæ˜¯ï¼ŒJOOQæ˜¯æ€»ä½“ä¸Šæœ€å¥½çš„ï¼Œå¯æƒœä¸æ˜¯å®Œå…¨å…è´¹ï¼Œæœ€ç»ˆé€‰æ‹©JDBC Templateã€‚</p><span id="more"></span><p>ã€€ã€€Hibernateå’ŒMybatisæ˜¯ä½¿ç”¨æœ€å¤šçš„ä¸¤ä¸ªä¸»æµæ¡†æ¶ï¼Œè€ŒJOOQã€Ebeanç­‰å°ä¼—æ¡†æ¶åˆ™çŸ¥é“çš„äººä¸å¤šï¼Œä½†ä¹Ÿæœ‰å¾ˆå¤šç‹¬ç‰¹çš„ä¼˜ç‚¹ï¼›è€ŒJPAåˆ™æ˜¯ä¸€ç»„JavaæŒä¹…å±‚Apiçš„è§„èŒƒï¼ŒSpring Data JPAæ˜¯JPA Repositoryçš„å®ç°ï¼Œæœ¬æ¥å’ŒHibernateã€Mybatisã€JOOQä¹‹ç±»çš„æ¡†æ¶ä¸åœ¨åŒä¸€ä¸ªå±‚æ¬¡ä¸Šï¼Œä½†å¼•å…¥Spring Data JPAä¹‹ç±»æ¡†æ¶ä¹‹åï¼Œæˆ‘ä»¬ä¼šç›´æ¥ä½¿ç”¨JPAçš„APIæŸ¥è¯¢æ›´æ–°æ•°æ®åº“ï¼Œå°±åƒæˆ‘ä»¬ä½¿ç”¨Mybatisä¸€æ ·ï¼Œæ‰€ä»¥è¿™é‡Œä¹ŸæŠŠJPAå’Œå…¶ä»–æ¡†æ¶æ”¾åœ¨ä¸€èµ·è¿›è¡Œæ¯”è¾ƒã€‚</p><p>ã€€ã€€åŒæ ·ï¼ŒJDBCå’Œå…¶ä»–æ¡†æ¶ä¹Ÿåœ¨åŒä¸€å±‚æ¬¡ï¼Œä½äºæ‰€æœ‰æŒä¹…æ¡†æ¶çš„åº•å±‚ï¼Œä½†æˆ‘ä»¬æœ‰æ—¶å€™ä¹Ÿä¼šç›´æ¥åœ¨é¡¹ç›®ä¸­ä½¿ç”¨JDBCï¼Œè€ŒSpring JDBC Templateéƒ¨åˆ†æ¶ˆé™¤äº†ä½¿ç”¨JDBCçš„ç¹çç»†èŠ‚ï¼Œé™ä½äº†ä½¿ç”¨æˆæœ¬ï¼Œä½¿å¾—æˆ‘ä»¬æ›´åŠ æ„¿æ„åœ¨é¡¹ç›®ä¸­ç›´æ¥ä½¿ç”¨JDBCã€‚</p><h4 id="ä¸€ã€SQLå°è£…å’Œæ€§èƒ½"><a href="#ä¸€ã€SQLå°è£…å’Œæ€§èƒ½" class="headerlink" title="ä¸€ã€SQLå°è£…å’Œæ€§èƒ½"></a>ä¸€ã€SQLå°è£…å’Œæ€§èƒ½</h4><p>ã€€ã€€åœ¨ä½¿ç”¨Hibernateçš„æ—¶å€™ï¼Œæˆ‘ä»¬æŸ¥è¯¢çš„æ˜¯POJOå®ä½“ç±»ï¼Œè€Œä¸å†æ˜¯æ•°æ®åº“çš„è¡¨ï¼Œä¾‹å¦‚hqlè¯­å¥ select count(*) from Userï¼Œé‡Œé¢çš„Useræ˜¯ä¸€ä¸ªJavaç±»ï¼Œè€Œä¸æ˜¯æ•°æ®åº“è¡¨Userã€‚è¿™ç¬¦åˆORMæœ€åˆçš„ç†æƒ³ï¼ŒORMè®¤ä¸ºJavaç¨‹åºå‘˜ä½¿ç”¨OOçš„æ€ç»´æ–¹å¼ï¼Œå’Œå…³ç³»æ•°æ®åº“çš„æ€ç»´æ–¹å¼å·®è·å·¨å¤§ï¼Œä¸ºäº†å¡«è¡¥å¯¹è±¡å’Œå…³ç³»æ€ç»´æ–¹å¼çš„é¸¿æ²Ÿï¼Œå¿…é¡»åšä¸€ä¸ªå¯¹è±¡åˆ°å…³ç³»çš„æ˜ å°„ï¼Œç„¶ååœ¨Javaçš„å¯¹è±¡ä¸–ç•Œä¸­ï¼Œç¨‹åºå‘˜å¯ä»¥ä½¿ç”¨çº¯çš„å¯¹è±¡çš„æ€ç»´æ–¹å¼ï¼ŒæŸ¥è¯¢POJOå¯¹è±¡ï¼ŒæŸ¥è¯¢æ¡ä»¶æ˜¯å¯¹è±¡å±æ€§ï¼Œä¸å†éœ€è¦æœ‰ä»»ä½•è¡¨ã€å­—æ®µç­‰å…³ç³»çš„æ¦‚å¿µï¼Œè¿™æ ·javaç¨‹åºå‘˜å°±æ›´å®¹æ˜“åšæŒä¹…å±‚çš„æ“ä½œã€‚</p><p>ã€€ã€€JPAå¯ä»¥è§†ä¸ºHibernateçš„å„¿å­ï¼Œä¹Ÿç»§æ‰¿äº†è¿™ä¸ªæ€è·¯ï¼ŒæŠŠSQLå½»åº•å°è£…èµ·æ¥ï¼Œè®©Javaç¨‹åºå‘˜çœ‹ä¸åˆ°å…³ç³»çš„æ¦‚å¿µï¼Œç”¨çº¯çš„é¢å‘å¯¹è±¡æ€æƒ³ï¼Œé‡æ–°åˆ›é€ ä¸€ä¸ªæ–°çš„æŸ¥è¯¢è¯­è¨€ä»£æ›¿sqlï¼Œæ¯”å¦‚hqlï¼Œè¿˜æœ‰JPQLç­‰ã€‚æ”¯æŒJPAçš„æ¡†æ¶ï¼Œä¾‹å¦‚Ebeanéƒ½å±äºè¿™ç§ç±»å‹çš„æ¡†æ¶ã€‚</p><p>ã€€ã€€ä½†å°è£…SQLï¼Œä½¿ç”¨å¦ä¸€ç§çº¯çš„é¢å‘å¯¹è±¡æŸ¥è¯¢è¯­è¨€ä»£æ›¿sqlï¼ŒçœŸçš„èƒ½å¤Ÿè®©ç¨‹åºå‘˜æ›´å®¹æ˜“å®ç°æŒä¹…å±‚æ“ä½œå—ï¼ŸMyBatisçš„æµè¡Œè¯æ˜äº†äº‹å®å¹¶éå¦‚æ­¤ï¼Œè‡³å°‘åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½¿ç”¨hqlå¹¶ä¸æ¯”ä½¿ç”¨sqlç®€å•ã€‚é¦–å…ˆï¼Œä»å¾ˆå¤šè§’åº¦ä¸Šçœ‹ï¼Œhql&#x2F;JPQLç­‰è¯­è¨€æ›´åŠ å¤æ‚å’Œéš¾ä»¥ç†è§£ï¼›å…¶æ¬¡å°±æ˜¯æ€§èƒ½ä¸Šæ˜æ˜¾é™ä½ï¼Œé€Ÿåº¦æ›´æ…¢ï¼Œå†…å­˜å ç”¨å·¨å¤§ï¼Œè€Œä¸”è¿˜ä¸å¥½ä¼˜åŒ–ã€‚æœ€ä¸ºæ¼ç«çš„æ˜¯ï¼Œå½“å…³ç³»çš„æ¦‚å¿µè¢«æ›¿æ¢ä¸ºå¯¹è±¡çš„æ¦‚å¿µä¹‹åï¼ŒæŸ¥è¯¢è¯­è¨€çš„çµæ´»æ€§å˜å¾—å¾ˆå·®ï¼Œè¡¨è¾¾èƒ½åŠ›ä¹Ÿæ¯”sqlå¼±å¾ˆå¤šã€‚å†™æŸ¥è¯¢è¯­å¥çš„æ—¶å€™å—åˆ°å„ç§å„æ ·çš„é™åˆ¶ï¼Œä¸€ä¸ªå…¸å‹çš„ä¾‹å­å°±æ˜¯å¤šè¡¨å…³è”æŸ¥è¯¢ã€‚</p><p>ã€€ã€€ä¸ç®¡æ˜¯hibernateè¿˜æ˜¯jpaï¼Œè¡¨ä¹‹é—´çš„è¿æ¥æŸ¥è¯¢ï¼Œè¢«æ˜ å°„ä¸ºå®ä½“ç±»ä¹‹é—´çš„å…³è”å…³ç³»ï¼Œè¿™æ ·ï¼Œå¦‚æœä¸¤ä¸ªå®ä½“ç±»ä¹‹é—´æ²¡æœ‰ï¼ˆå®ç°ï¼‰å…³è”å…³ç³»ï¼Œä½ å°±ä¸èƒ½æŠŠä¸¤ä¸ªå®ä½“ï¼ˆæˆ–è€…è¡¨ï¼‰joinèµ·æ¥æŸ¥è¯¢ã€‚è¿™æ˜¯å¾ˆæ¼ç«çš„äº‹æƒ…ï¼Œå› ä¸ºæˆ‘ä»¬å¾ˆå¤šæ—¶å€™å¹¶ä¸éœ€è¦æ˜¾å¼å®šä¹‰ä¸¤ä¸ªå®ä½“ç±»ä¹‹é—´çš„å…³è”å…³ç³»å°±å¯ä»¥å®ç°ä¸šåŠ¡é€»è¾‘ï¼Œå¦‚æœä½¿ç”¨hqlï¼Œåªæ˜¯ä¸ºäº†joinæˆ‘ä»¬å°±å¿…é¡»åœ¨ä¸¤ä¸ªå®ä½“ç±»ä¹‹é—´æ·»åŠ ä»£ç ï¼Œè€Œä¸”è¿˜ä¸èƒ½é€†å‘å·¥ç¨‹ï¼Œå¦‚æœè¡¨é‡Œé¢æ²¡æœ‰å®šä¹‰å¤–é”®çº¦æŸçš„è¯ï¼Œé€†å‘å·¥ç¨‹ä¼šæŠŠæˆ‘ä»¬æ·»åŠ çš„å…³è”ä»£ç æŠ¹æ‰ã€‚</p><p>ã€€ã€€MyBatisåˆ™æ˜¯å¦å¤–ä¸€ç§ç±»å‹çš„æŒä¹…åŒ–æ¡†æ¶ï¼Œå®ƒæ²¡æœ‰å°è£…SQLä¹Ÿæ²¡æœ‰åˆ›å»ºä¸€ç§æ–°çš„é¢ç›¸å¯¹è±¡çš„æŸ¥è¯¢è¯­è¨€ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨SQLä½œä¸ºæŸ¥è¯¢è¯­è¨€ï¼Œåªæ˜¯æŠŠç»“æœå¡«å…¥POJOå¯¹è±¡è€Œå·²ã€‚ä½¿ç”¨sqlå¹¶ä¸æ¯”hqlå’ŒJPQLå›°éš¾ï¼ŒæŸ¥è¯¢é€Ÿåº¦å¿«ï¼Œå¯ä»¥çµæ´»ä½¿ç”¨ä»»æ„å¤æ‚çš„æŸ¥è¯¢åªè¦æ•°æ®åº“æ”¯æŒã€‚ä»SQLå°è£…è§’åº¦ä¸Šçœ‹ï¼ŒMyBatisæ¯”Hibernateå’ŒJPAæˆåŠŸï¼ŒSQLæœ¬ä¸è¯¥è¢«å°è£…å’Œéšè—ï¼Œè®©Javaç¨‹åºå‘˜ä½¿ç”¨SQLæ—¢ä¸éº»çƒ¦ä¹Ÿæ›´å®¹æ˜“å­¦ä¹ å’Œä¸Šæ‰‹ï¼Œè¿™åº”è¯¥æ˜¯MyBatisæµè¡Œèµ·æ¥çš„é‡è¦åŸå› ã€‚</p><p>ã€€ã€€è½»é‡çº§æŒä¹…å±‚æ¡†æ¶JOOQä¹Ÿå’ŒMyBatisä¸€æ ·ï¼Œç›´æ¥ä½¿ç”¨SQLä½œä¸ºæŸ¥è¯¢è¯­è¨€ï¼Œæ¯”èµ·MyBatisï¼ŒJOOQè™½ç„¶çŸ¥ååº¦è¦ä½å¾—å¤šï¼Œä½†JOOQä¸ä½†å’ŒMyBatisä¸€æ ·å¯ä»¥åˆ©ç”¨SQLçš„çµæ´»æ€§å’Œé«˜æ•ˆç‡ï¼Œé€šè¿‡é€†å‘å·¥ç¨‹ï¼ŒJOOQè¿˜å¯ä»¥ç”¨Javaä»£ç æ¥ç¼–å†™SQLè¯­å¥ï¼Œåˆ©ç”¨IDEçš„ä»£ç è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ï¼Œè‡ªåŠ¨æç¤ºè¡¨åå’Œå­—æ®µåï¼Œå‡å°‘ç¨‹åºå‘˜è®°å¿†è´Ÿæ‹…ï¼Œè¿˜å¯ä»¥åœ¨å…ƒæ•°æ®å‘ç”Ÿå˜åŒ–æ—¶å‘ç”Ÿç¼–è¯‘é”™è¯¯ï¼Œæç¤ºç¨‹åºå‘˜ä¿®æ”¹ç›¸åº”çš„SQLè¯­å¥ã€‚</p><p>ã€€ã€€Ebeanä½œä¸ºä¸€ç§åŸºäºJPAçš„æ¡†æ¶ï¼Œå®ƒä¹Ÿä½¿ç”¨JPQLè¯­è¨€è¿›è¡ŒæŸ¥è¯¢ï¼Œå¤šæ•°æƒ…å†µä¸‹ä¼šè®©äººå¾ˆæ¼ç«ã€‚ä½†æ®è¯´Ebeanä¸æ’æ–¥SQLï¼Œå¯ä»¥ç›´æ¥ç”¨SQLæŸ¥è¯¢ï¼Œä¹Ÿå¯ä»¥ç”¨ç±»ä¼¼JOOQçš„DSLæ–¹å¼åœ¨ä»£ç ä¸­æ„é€ SQLè¯­å¥ï¼ˆè¿˜æ˜¯JPQLè¯­å¥ï¼Ÿï¼‰ï¼Œä½†æ²¡ç”¨è¿‡Ebeanï¼Œæ‰€ä»¥å…·ä½“ç»†èŠ‚ä¸æ¸…æ¥šã€‚</p><p>ã€€ã€€JDBC Templateå°±ä¸ç”¨è¯´äº†ï¼Œå®ƒæ ¹æœ¬æ²¡åšORMï¼Œå½“ç„¶æ˜¯çº¯SQLæŸ¥è¯¢ã€‚åˆ©ç”¨Springæ¡†æ¶ï¼Œå¯ä»¥æŠŠJDBC Templateå’ŒJPAç»“åˆèµ·æ¥ä½¿ç”¨ï¼Œåœ¨JPAä¸å¥½æŸ¥è¯¢çš„åœ°æ–¹ï¼Œæˆ–è€…æ•ˆç‡ä½ä¸å¥½ä¼˜åŒ–çš„åœ°æ–¹ä½¿ç”¨JDBCï¼Œç¼“è§£äº†Hibernate&#x2F;JPAå°è£…SQLé€ æˆçš„éº»çƒ¦ï¼Œä½†æˆ‘ä»æ²¡çœ‹åˆ°ä»»ä½•å°è£…SQLçš„å¿…è¦æ€§ï¼Œé™¤äº†ç»™ç¨‹åºå‘˜å¸¦æ¥ä¸€å¤§å †éº»çƒ¦å’Œå­¦ä¹ è´Ÿæ‹…ä¹‹å¤–ï¼Œæ²¡æœ‰å¤ªæ˜æ˜¾çš„å¥½å¤„ã€‚</p><h4 id="äºŒã€DSLå’Œå˜åŒ–é€‚åº”æ€§"><a href="#äºŒã€DSLå’Œå˜åŒ–é€‚åº”æ€§" class="headerlink" title="äºŒã€DSLå’Œå˜åŒ–é€‚åº”æ€§"></a>äºŒã€DSLå’Œå˜åŒ–é€‚åº”æ€§</h4><p>ã€€ã€€ä¸ºäº†å®ç°å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œä¸è®ºæ˜¯ç”¨SQLè¿˜æ˜¯hqlæˆ–è€…JPQLï¼Œæˆ‘ä»¬éƒ½ä¸å¾—ä¸å†™å¾ˆå¤šç®€å•çš„æˆ–è€…å¤æ‚çš„æŸ¥è¯¢è¯­å¥ï¼ŒORMæ— æ³•å‡å°‘è¿™éƒ¨åˆ†å·¥ä½œï¼Œæœ€å¤šæ˜¯ç”¨å¦ä¸€ç§é¢å‘å¯¹è±¡é£æ ¼çš„è¯­è¨€å»è¡¨è¾¾æŸ¥è¯¢éœ€æ±‚ï¼Œå¦‚å‰æ‰€è¿°ï¼Œç”¨é¢å‘å¯¹è±¡é£æ ¼çš„è¯­è¨€ä¸è§å¾—æ¯”SQLæ›´å®¹æ˜“ã€‚é€šå¸¸ä¸šåŠ¡ç³»ç»Ÿä¸­ä¼šæœ‰å¾ˆå¤šè¡¨ï¼Œæ¯ä¸ªè¡¨éƒ½æœ‰å¾ˆå¤šå­—æ®µï¼Œå³ä¾¿æ˜¯ç¼–å†™æœ€ç®€å•çš„æŸ¥è¯¢è¯­å¥ä¹Ÿä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ï¼Œéœ€è¦è®°ä½æ•°æ®åº“ä¸­æœ‰å“ªäº›è¡¨ï¼Œæœ‰å“ªäº›å­—æ®µï¼Œè®°ä½æœ‰å“ªäº›å‡½æ•°ç­‰ã€‚å†™æŸ¥è¯¢è¯­å¥å¾ˆå¤šæ—¶å€™æˆä¸ºä¸€ä»¶å¤´ç–¼çš„äº‹æƒ…ã€‚</p><p>ã€€ã€€QueryDSLã€JOOQã€Ebeanç”šè‡³MyBatiså’ŒJPAéƒ½è®¾è®¡ä¸€äº›ç‰¹æ€§ï¼Œå¸®åŠ©å¼€å‘äººå‘˜ç¼–å†™æŸ¥è¯¢è¯­å¥ï¼Œæœ‰äººç§°ä¹‹ä¸ºâ€œDSLé£æ ¼æ•°æ®åº“ç¼–ç¨‹â€ã€‚æœ€æ—©å®ç°è¿™ç±»åŠŸèƒ½çš„å¯èƒ½æ˜¯QueryDSLï¼ŒæŠŠæ•°æ®åº“çš„è¡¨ç»“æ„é€†å‘å·¥ç¨‹ä¸ºjavaçš„ç±»ï¼Œç„¶åå¯ä»¥è®©javaç¨‹åºå‘˜èƒ½å¤Ÿç”¨javaçš„è¯­æ³•æ„é€ å‡ºä¸€ä¸ªå¤æ‚çš„æŸ¥è¯¢è¯­å¥ï¼Œåˆ©ç”¨IDEçš„ä»£ç è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ï¼Œå¯ä»¥è‡ªåŠ¨æç¤ºè¡¨åã€å­—æ®µåã€æŸ¥è¯¢è¯­å¥çš„å…³é”®å­—ç­‰ï¼Œå¾ˆæˆåŠŸçš„ç®€åŒ–äº†æŸ¥è¯¢è¯­å¥çš„ç¼–å†™ï¼Œå…é™¤äº†ç¨‹åºå‘˜è®°å¿†å„ç§åå­—ã€å‡½æ•°å’Œå…³é”®å­—çš„è´Ÿæ‹…ã€‚</p><p>ã€€ã€€QueryDSLæœ‰å¾ˆå¤šç‰ˆæœ¬ï¼Œä½†ç”¨å¾—å¤šçš„æ˜¯QueryDSL JPAï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜ç¼–å†™JPQLè¯­å¥ï¼Œå¦‚å‰æ‰€è¿°ï¼ŒJPQLè¯­å¥æœ‰å¾ˆå¤šå±€é™ä¸å¦‚SQLçµæ´»é«˜æ•ˆã€‚åæ¥çš„JOOQå’ŒEbeanï¼ŒåŸºæœ¬ä¸Šç»§æ‰¿äº†QueryDSLçš„æ€è·¯ï¼ŒEbeanåŸºæœ¬ä¸Šè¿˜æ˜¯JPAé£æ ¼çš„ORMæ¡†æ¶ï¼Œè™½ç„¶ä¹Ÿæ”¯æŒSQLï¼Œä½†ä¸æ¸…æ¥šå…¶DSLç‰¹æ€§æ˜¯å¦æ”¯æŒSQLè¯­å¥ç¼–å†™ï¼Œåœ¨å®˜ç½‘ä¸Šçœ‹åˆ°çš„ä¾‹å­éƒ½æ˜¯ç”¨äºæ„é€ JPQLè¯­å¥ã€‚</p><p>ã€€ã€€è¿™é‡Œé¢æœ€æˆåŠŸçš„åº”è¯¥æ˜¯JOOQï¼Œå’ŒQueryDSLä¸åŒï¼ŒJOOQçš„DSLç¼–ç¨‹æ˜¯å¸®åŠ©å¼€å‘äººå‘˜ç¼–å†™SQLè¯­å¥ï¼ŒæŠ›å¼ƒç´¯èµ˜çš„ORMæ¦‚å¿µï¼ŒJOOQè¿™ä¸ªåŠŸèƒ½éå¸¸è½»å°ï¼Œéå¸¸å®¹æ˜“å­¦ä¹ å’Œä½¿ç”¨ï¼ŒåŒæ—¶æ€§èƒ½ä¹Ÿéå¸¸å¥½ï¼Œä¸åƒQueryDSLå’ŒEbeanï¼Œéœ€è¦äº†è§£å¤æ‚çš„JPAæ¦‚å¿µå’Œå„ç§å¥‡å¼‚çš„é™åˆ¶ï¼ŒJOOQç¼–å†™çš„å°±æ˜¯æ™®é€šçš„SQLè¯­å¥ï¼Œåªæ˜¯æŠŠæŸ¥è¯¢ç»“æœå¡«å……åˆ°å®ä½“ç±»ä¸­ï¼ˆä¸¥æ ¼è¯´JOOQæ²¡æœ‰å®ä½“ç±»ï¼Œåªæ˜¯è‡ªåŠ¨ç”Ÿæˆçš„Recordå¯¹è±¡ï¼‰ï¼ŒJOOQç”šè‡³ä¸ä¸€å®šè¦æŠŠç»“æœè½¬æ¢ä¸ºå®ä½“ç±»ï¼Œå¯ä»¥è®©å¼€å‘äººå‘˜æŒ‰ç…§å­—æ®µå–å¾—ç»“æœçš„å€¼ï¼Œç›¸å¯¹äºJDBCï¼ŒJOOQä¼šæŠŠç»“æœå€¼è½¬æ¢ä¸ºåˆé€‚çš„Javaç±»å‹ï¼Œç”¨èµ·æ¥æ¯”JDBCæ›´ç®€å•ã€‚</p><p>ã€€ã€€ä¼ ç»Ÿä¸»æµçš„æ¡†æ¶å¯¹DSLé£æ ¼æ”¯æŒå¾—å¾ˆå°‘ï¼ŒHibernateé‡Œé¢åŸºæœ¬ä¸Šæ²¡æœ‰çœ‹åˆ°æœ‰è¿™æ–¹é¢çš„ç‰¹æ€§ã€‚MyBatisæä¾›äº†â€SQLè¯­å¥æ„å»ºå™¨â€æ¥å¸®åŠ©å¼€å‘äººå‘˜æ„é€ SQLè¯­å¥ï¼Œä½†å’ŒQueryDSL&#x2F;JOOQ&#x2F;Ebeanå·®å¾ˆå¤šï¼Œä¸èƒ½æç¤ºè¡¨åå’Œå­—æ®µåï¼Œè¯­æ³•ä¹Ÿæ˜¾å¾—ç´¯èµ˜ä¸åƒSQLã€‚</p><p>ã€€ã€€JPAç»™äººçš„å°è±¡æ˜¯å¤æ‚éš¾æ‡‚ï¼Œå®ƒçš„MetaModel Apiç»§æ‰¿äº†ç‰¹ç‚¹ï¼ŒMetaModel API+Criteria APIï¼Œå†é…åˆHibernate JPA 2 Metamodel Generatorï¼Œè®©äººæœ‰ç‚¹QueryDSL JPAçš„æ„Ÿè§‰ï¼Œåªæ˜¯ç»•äº†ä¸€ä¸ªå¤§å¤§çš„å¼¯ï¼Œå åŠ äº†å¥½å‡ å±‚æŠ€æœ¯ï¼Œæœ€åå‹‰å¼ºå®ç°äº†QueryDSL JPAçš„ç®€å•æ˜“æ‡‚çš„åŠŸèƒ½ã€‚å¾ˆå¤šäººä¸æ¨èJPA+QueryDSLçš„ç”¨æ³•ï¼Œè€Œæ˜¯æ¨èJPA MetaModel API+Criteria API+Hibernate JPA 2 Metamodel Generatorçš„ç”¨æ³•ï¼Œè®©äººå¾ˆéš¾ç†è§£ï¼Œä¹Ÿè®¸æ˜¯å› ä¸ºè¿™ä¸ªæ–¹æ¡ˆæ˜¯çº¯çš„æ ‡å‡†çš„JPAæ–¹æ¡ˆã€‚</p><p>ã€€ã€€æ•°æ®åº“DSLç¼–ç¨‹çš„å¦ä¸€ä¸ªä¸»è¦å–ç‚¹æ˜¯å˜åŒ–é€‚åº”æ€§å¼ºï¼Œæ•°æ®åº“è¡¨ç»“æ„åœ¨å¼€å‘è¿‡ç¨‹ä¸­é€šå¸¸ä¼šé¢‘ç¹å‘ç”Ÿå˜åŒ–ï¼Œä¼ ç»Ÿçš„éDSLç¼–ç¨‹ï¼Œå­—æ®µååªæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚æœå­—æ®µåæˆ–è€…ç±»å‹æ”¹å˜ä¹‹åï¼ŒæŸ¥è¯¢è¯­å¥æ²¡æœ‰ç›¸åº”ä¿®æ”¹ï¼Œç¼–è¯‘ä¸ä¼šå‡ºé”™ï¼Œä¹Ÿå®¹æ˜“è¢«å¼€å‘äººå‘˜å¿½ç•¥ï¼Œæ˜¯bugçš„ä¸€ä¸ªä¸»è¦æ¥æºã€‚DSLç¼–ç¨‹é‡Œé¢ï¼Œå­—æ®µè¢«é€†å‘å·¥ç¨‹ä¸ºä¸€ä¸ªjavaç±»çš„å±æ€§ï¼Œæ•°æ®åº“ç»“æ„æ”¹å˜ä¹‹åï¼Œä½œä¸ºjavaä»£ç ä¸€éƒ¨åˆ†çš„æŸ¥è¯¢è¯­å¥ä¼šå‘ç”Ÿç¼–è¯‘é”™è¯¯ï¼Œæç¤ºå¼€å‘äººå‘˜è¿›è¡Œä¿®æ”¹ï¼Œå¯ä»¥å‡å°‘å¤§é‡bugï¼Œå‡è½»æµ‹è¯•çš„è´Ÿæ‹…ï¼Œæé«˜è½¯ä»¶çš„å¯é æ€§å’Œè´¨é‡ã€‚</p><h4 id="ä¸‰ã€è·¨æ•°æ®åº“ç§»æ¤"><a href="#ä¸‰ã€è·¨æ•°æ®åº“ç§»æ¤" class="headerlink" title="ä¸‰ã€è·¨æ•°æ®åº“ç§»æ¤"></a>ä¸‰ã€è·¨æ•°æ®åº“ç§»æ¤</h4><p>ã€€ã€€Hibernateå’ŒJPAä½¿ç”¨hqlå’ŒJPQLè¿™ç±»æ•°æ®åº“æ— å…³çš„ä¸­é—´è¯­è¨€æè¿°æŸ¥è¯¢ï¼Œå¯ä»¥åœ¨ä¸åŒæ•°æ®åº“ä¸­æ— ç¼ç§»æ¤ï¼Œç§»æ¤åˆ°ä¸€ä¸ªSQLæœ‰å·¨å¤§å·®åˆ«çš„æ•°æ®åº“é€šå¸¸ä¸éœ€è¦ä¿®æ”¹ä»£ç æˆ–è€…åªéœ€è¦ä¿®æ”¹å¾ˆå°‘çš„ä»£ç ã€‚Ebeanå¦‚æœä¸ä½¿ç”¨åŸç”ŸSQLï¼Œè€Œæ˜¯ä½¿ç”¨JPAçš„æ–¹å¼å¼€å‘ï¼Œä¹Ÿèƒ½åœ¨ä¸åŒæ•°æ®åº“ä¸­å¹³æ»‘çš„ç§»æ¤ã€‚</p><p>ã€€ã€€MyBatiså’ŒJOOQç›´æ¥ä½¿ç”¨SQLï¼Œè·¨æ•°æ®åº“ç§»æ¤æ—¶éƒ½éš¾å…è¦ä¿®æ”¹SQLè¯­å¥ã€‚è¿™æ–¹é¢MyBatisæ¯”è¾ƒå·®ï¼Œåªæœ‰ä¸€ä¸ªåŠ¨æ€SQLæä¾›çš„ç‰¹æ€§ï¼Œå¯¹äºä¸åŒçš„æ•°æ®åº“ç¼–å†™ä¸åŒçš„sqlè¯­å¥ã€‚</p><p>ã€€ã€€JOOQè™½ç„¶æ— æ³•åƒHibernateå’ŒJPAé‚£æ ·æ— ç¼ç§»æ¤ï¼Œä½†æ¯”MyBatiså¥½å¾ˆå¤šã€‚JOOQçš„DSLå¾ˆå¤§ä¸€éƒ¨åˆ†æ˜¯é€šç”¨çš„ï¼Œä¾‹å¦‚åˆ†é¡µæŸ¥è¯¢ä¸­ï¼ŒMysqlçš„limit&#x2F;offsetå…³é”®å­—æ˜¯å¾ˆæ–¹ä¾¿çš„æè¿°æ–¹å¼ï¼Œä½†Oracleå’ŒSQLServerçš„SQLä¸æ”¯æŒï¼Œå¦‚æœæˆ‘ä»¬ç”¨JOOQçš„DSLçš„limitå’Œoffsetæ–¹æ³•æ„é€ SQLè¯­å¥ï¼Œä¸ä¿®æ”¹ç§»æ¤åˆ°ä¸æ”¯æŒlimit&#x2F;offsetçš„Oracleå’ŒSQLServerä¸Šï¼Œæˆ‘ä»¬ä¼šå‘ç°è¿™äº›è¯­å¥è¿˜èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œå› ä¸ºJOOQä¼šæŠŠlimit&#x2F;offsetè½¬æ¢æˆç­‰ä»·çš„ç›®æ ‡æ•°æ®åº“çš„SQLè¯­å¥ã€‚JOOQæ ¹æ®ç›®æ ‡æ•°æ®åº“è½¬æ¢SQLè¯­å¥çš„ç‰¹æ€§ï¼Œä½¿å¾—åœ¨ä¸åŒæ•°æ®åº“ä¹‹é—´ç§»æ¤çš„æ—¶å€™ï¼Œåªéœ€è¦ä¿®æ”¹å¾ˆå°‘çš„ä»£ç ï¼Œæ˜æ˜¾ä¼˜äºMyBatisã€‚</p><p>ã€€ã€€JDBC Templateåº”è¯¥æœ€å·®ï¼Œåªèƒ½å°½é‡ä½¿ç”¨æ ‡å‡†sqlè¯­å¥æ¥å‡å°‘ç§»æ¤å·¥ä½œé‡ã€‚</p><h4 id="å››ã€å®‰å…¨æ€§"><a href="#å››ã€å®‰å…¨æ€§" class="headerlink" title="å››ã€å®‰å…¨æ€§"></a>å››ã€å®‰å…¨æ€§</h4><p>ã€€ã€€ä¸€èˆ¬æ¥è¯´ï¼Œæ‹¼æ¥æŸ¥è¯¢è¯­å¥éƒ½ä¼šæœ‰å®‰å…¨éšæ‚£ï¼Œå®¹æ˜“è¢«sqlæ³¨å…¥æ”»å‡»ã€‚ä¸è®ºæ˜¯jdbcï¼Œè¿˜æ˜¯hql&#x2F;JPQLï¼Œåªè¦ä½¿ç”¨æ‹¼æ¥çš„æŸ¥è¯¢è¯­å¥éƒ½æ˜¯ä¸å®‰å…¨çš„ã€‚å¯¹äºJDBCæ¥è¯´ï¼Œä½¿ç”¨å‚æ•°åŒ–çš„sqlè¯­å¥ä»£æ›¿æ‹¼æ¥ï¼Œå¯ä»¥è§£å†³é—®é¢˜ã€‚è€ŒJPAåˆ™åº”è¯¥ä½¿ç”¨Criteria APIè§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>ã€€ã€€å¯¹äºJOOQä¹‹ç±»çš„DSLé£æ ¼æ¡†æ¶ï¼Œæœ€ç»ˆä¼šè¢«renderä¸ºå‚æ•°åŒ–çš„sqlï¼Œå¤©ç”Ÿå…ç–«sqlæ³¨å…¥æ”»å‡»ã€‚Ebeanä¹Ÿæ”¯æŒDSLæ–¹å¼ç¼–ç¨‹ï¼Œä¹ŸåŒæ ·å…ç–«sqlæ³¨å…¥æ”»å‡»ã€‚</p><p>ã€€ã€€è¿™æ˜¯å› ä¸ºDSLé£æ ¼ç¼–ç¨‹å‚æ•°åŒ–æŸ¥è¯¢æ¯”æ‹¼æ¥å­—ç¬¦ä¸²æŸ¥è¯¢æ›´ç®€å•ï¼Œæ²¡äººä¼šæ‹¼æ¥å­—ç¬¦ä¸²ã€‚è€Œjdbc&#x2F;hql&#x2F;JPQLæ‹¼æ¥å­—ç¬¦ä¸²æœ‰æ—¶å€™æ¯”å‚æ•°åŒ–æŸ¥è¯¢æ›´ç®€å•ï¼Œç‰¹åˆ«æ˜¯jdbcï¼Œå¾ˆå¤šäººä¼šå·æ‡’ä½¿ç”¨ä¸å®‰å…¨çš„æ–¹å¼ã€‚</p><h4 id="äº”ã€JOOQçš„å¤±è´¥ä¹‹å¤„"><a href="#äº”ã€JOOQçš„å¤±è´¥ä¹‹å¤„" class="headerlink" title="äº”ã€JOOQçš„å¤±è´¥ä¹‹å¤„"></a>äº”ã€JOOQçš„å¤±è´¥ä¹‹å¤„</h4><p>ã€€ã€€å¯èƒ½å¤§éƒ¨åˆ†äººä¼šä¸åŒæ„ï¼Œè™½ç„¶Hibernateã€JPAä»ç„¶å¤§è¡Œå…¶é“ï¼Œæ˜¯æœ€ä¸»æµçš„æŒä¹…åŒ–æ¡†æ¶ï¼Œä½†å…¶å®è¿™ç§å°è£…SQLçš„çº¯æ­£ORMå·²ç»è¿‡æ—¶ï¼Œæ•ˆç›Šä½äºä½¿ç”¨å®ƒä»¬çš„ä»£ä»·ï¼Œåº”è¯¥æ·˜æ±°äº†ã€‚MyBatisè™½ç„¶æœ‰å¾ˆå¤šä¼˜ç‚¹ï¼Œä½†å®ƒçš„ä¼˜ç‚¹JOOQåŸºæœ¬ä¸Šéƒ½æœ‰ï¼Œè€Œä¸”å¤šæ•°è¿˜æ›´å¥½ã€‚MyBatisæœ€å¤§çš„ç¼ºç‚¹æ˜¯éš¾ä»¥é¿å…å†™xmlæ–‡ä»¶ï¼Œxmlæ–‡ä»¶ç¼–å†™å›°éš¾ï¼Œå®¹æ˜“å‡ºé”™ï¼Œè¿˜ä¸å®¹æ˜“æŸ¥æ‰¾é”™è¯¯ã€‚ç›¸å¯¹äºJOOQï¼ŒMyBatisåœ¨å¤šæ•°æƒ…å†µä¸‹æ²¡æœ‰ä»»ä½•ä¼˜åŠ¿ã€‚</p><p>ã€€ã€€EbeanåŒæ—¶å…·æœ‰å¾ˆå¤šä¸åŒæ¡†æ¶çš„ä¼˜ç‚¹ï¼Œä½†å®ƒæ˜¯åŸºäºJPAçš„ï¼Œéš¾å…æœ‰JPAçš„å„ç§é™åˆ¶ï¼Œè¿™æ˜¯è‡´å‘½çš„ç¼ºç‚¹ã€‚</p><p>ã€€ã€€JOOQè¿™ä¸ªæç«¯è½»é‡çº§çš„æ¡†æ¶æŠ€æœ¯ä¸Šæ˜¯æœ€å®Œç¾çš„ï¼Œçªç„¶æœ‰ä¸€å¤©å‡ ä¸ªWebç³»ç»ŸåŒæ—¶å´©äº†ï¼Œæœ€åå‘ç°æ˜¯JOOQè¯•ç”¨æœŸè¿‡æœŸäº†ï¼Œè¿™æ˜¯JOOQçš„å¤±è´¥ä¹‹å¤„ï¼Œå®ƒä¸æ˜¯å®Œå…¨å…è´¹çš„ï¼Œåªæ˜¯å¯¹MySqlä¹‹ç±»çš„å¼€æºæ•°æ®åº“å…è´¹ã€‚</p><p>ã€€ã€€æœ€ç»ˆï¼Œæˆ‘å†³å®šé€‰æ‹©JDBC Templateã€‚</p><p><a href="https://zhuanlan.zhihu.com/p/59220248">è½¬è½½è‡ªçŸ¥ä¹ï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://zhuanlan.zhihu.com/p/59220248</a></p>]]></content>
      
      
      <categories>
          
          <category> JAVAéšç¬” </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¡†æ¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨JPAå®ç°Specificationè§„èŒƒè§„æ ¼æ¨¡å¼</title>
      <link href="/posts/ea992500.html"/>
      <url>/posts/ea992500.html</url>
      
        <content type="html"><![CDATA[<p>ã€€ã€€ç”±DDDä¹‹çˆ¶ Eric Evans å’ŒOOä¹‹çˆ¶ Martin Fowlerå®šä¹‰çš„è§„èŒƒ(Specificationä¹Ÿç§°è§„æ ¼æ¨¡å¼)æ¨¡å¼article è¶Šæ¥è¶Šå—åˆ°å¹¿æ³›åº”ç”¨ï¼Œæœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨JavaEE æŒä¹…å±‚è§„èŒƒJPAå®ç°è§„æ ¼æ¨¡å¼ï¼Œå…¶å®ç°æ€æƒ³ä¹Ÿé€‚åˆå…¶ä»–æŒä¹…å±‚æ¡†æ¶ã€‚æ¡ˆä¾‹æºç è§GitHubã€‚</p><span id="more"></span><p>ã€€ã€€åœ¨è¿™ä¸ªæ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹POLLç±»ä½œä¸ºåˆ›å»ºSpecificationä¸ºä¾‹å®ä½“ã€‚å®ƒä»£è¡¨äº†æ°‘æ„è°ƒæŸ¥ï¼Œæœ‰ä¸€ä¸ªå¼€å§‹å’Œç»“æŸæ—¥æœŸã€‚åœ¨è¿™ä¸¤ä¸ªæ—¥æœŸä¹‹é—´çš„æ—¶é—´å†…ç”¨æˆ·å¯ä»¥åœ¨ä¸åŒçš„é€‰æ‹©ä¹‹é—´æŠ•ç¥¨è¡¨å†³Pollï¼ŒæŠ•ç¥¨Pollå¯ä»¥åœ¨ç®¡ç†å‘˜çš„ç»“æŸæ—¥æœŸå°šæœªåˆ°è¾¾å‰é”å®šã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€ä¸ªé”æ—¥æœŸå°†è¢«è®¾ç½®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Poll</span> &#123;</span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="meta">@GeneratedValue</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">long</span> id;</span><br><span class="line">  <span class="keyword">private</span> DateTime startDate;</span><br><span class="line">  <span class="keyword">private</span> DateTime endDate;</span><br><span class="line">  <span class="keyword">private</span> DateTime lockDate;</span><br><span class="line">  <span class="meta">@OneToMany(cascade = CascadeType.ALL)</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">List</span> <span class="variable">votes</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€ç°åœ¨æˆ‘ä»¬æœ‰ä¸¤ä¸ªçº¦æŸï¼š</p><ul><li>ä¸€ä¸ªæŠ•ç¥¨pollå¦‚æœæ»¡è¶³<em><strong>startDate &lt; now &lt; endDate</strong></em>ï¼Œé‚£è¡¨ç¤ºå®ƒåœ¨è¿›è¡Œä¸­ã€‚  </li><li>ä¸€ä¸ªæŠ•ç¥¨pollå¦‚æœè¶…è¿‡100ä¸ªæŠ•ç¥¨ä½†æ˜¯æ²¡æœ‰é”å®šï¼Œè¡¨ç¤ºå®ƒå¾ˆæµè¡Œã€‚</li></ul><p>ã€€ã€€æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨POLLæŠ•ç¥¨æ·»åŠ é€‚å½“çš„æ–¹æ³•å¦‚ï¼špoll.isCurrentlyRunningï¼ˆï¼‰ï¼Œå¦å¤–ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæœåŠ¡æ–¹æ³•pollService.isCurrentlyRunningï¼ˆè¿›è¡Œè½®è¯¢ï¼‰ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä¹Ÿå¸Œæœ›èƒ½å¤ŸæŸ¥è¯¢æ•°æ®åº“è·å¾—æ‰€æœ‰å½“å‰æ­£åœ¨è¿è¡Œçš„æ°‘æ„è°ƒæŸ¥ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ªDAOæˆ–å‚¨å­˜repositoryåº“çš„æ–¹æ³•ç±»ä¼¼pollRepository.findAllCurrentlyRunningPollsï¼ˆï¼‰ã€‚<br>ã€€ã€€å¦‚æœæˆ‘ä»¬æƒ³ç»“åˆä¸Šè¿°ä¸¤ä¸ªçº¦æŸæŸ¥è¯¢ï¼Œä¾‹å¦‚æˆ‘ä»¬æƒ³åœ¨æ•°æ®åº“ä¸­æŸ¥è¯¢å½“å‰æ­£åœ¨è¿è¡Œçš„æ‰€æœ‰æµè¡Œçš„è°ƒæŸ¥åå•ï¼Ÿè¿™æ—¶Specificationæ¨¡å¼æ´¾ä¸Šç”¨åœºã€‚å½“ä½¿ç”¨Specificationæ¨¡å¼æ—¶ï¼Œæˆ‘ä»¬å°†ä¸šåŠ¡è§„åˆ™è½¬æ¢ä¸ºé¢å¤–çš„ç±»ç§°ä¸ºSpecificationã€‚<br>ã€€ã€€åˆ›å»ºSpecificationæ¥å£å’ŒæŠ½è±¡ç±»å¦‚ä¸‹ï¼šã€€ã€€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Specification</span> &#123; </span><br><span class="line">  <span class="type">boolean</span> <span class="title function_">isSatisfiedBy</span><span class="params">(T t)</span>; </span><br><span class="line">  Predicate <span class="title function_">toPredicate</span><span class="params">(Root root, CriteriaBuilder cb)</span>;</span><br><span class="line">  Class <span class="title function_">getType</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AbstractSpecification</span> <span class="keyword">implements</span> <span class="title class_">Specification</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSatisfiedBy</span><span class="params">(T t)</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NotImplementedException</span>();</span><br><span class="line">  &#125; </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Predicate <span class="title function_">toPredicate</span><span class="params">(Root poll, CriteriaBuilder cb)</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NotImplementedException</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Class <span class="title function_">getType</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ParameterizedType</span> <span class="variable">type</span> <span class="operator">=</span> (ParameterizedType) <span class="built_in">this</span>.getClass().getGenericSuperclass();</span><br><span class="line">    <span class="keyword">return</span> (Class) type.getActualTypeArguments()[<span class="number">0</span>];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>specificationçš„æ ¸å¿ƒæ˜¯isSatisfiedBy()æ–¹æ³•,ç”¨äºæ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ»¡è¶³è§„èŒƒè§„æ ¼è¦æ±‚ã€‚<br>toPredicate()æ˜¯ä¸€ä¸ªé™„åŠ çš„æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨æ¡ˆä¾‹ä¸­ä½¿ç”¨å®ƒè¿”å›ä¸€ä¸ªçº¦æŸã€‚<br>javax.persistence.criteria.Predicate å®ä¾‹ï¼Œå®ƒèƒ½è¢«ç”¨äºæŸ¥è¯¢ä¸€ä¸ªæ•°æ®åº“ã€‚</p><p>ã€€ã€€æ£€æŸ¥ä¸€ä¸ªpollæ˜¯å¦æ­£åœ¨è¿è¡Œçš„è§„èŒƒå®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IsCurrentlyRunning</span> <span class="keyword">extends</span> <span class="title class_">AbstractSpecification</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSatisfiedBy</span><span class="params">(Poll poll)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> poll.getStartDate().isBeforeNow()</span><br><span class="line">        &amp;&amp; poll.getEndDate().isAfterNow()</span><br><span class="line">        &amp;&amp; poll.getLockDate() == <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Predicate <span class="title function_">toPredicate</span><span class="params">(Root poll, CriteriaBuilder cb)</span> &#123;</span><br><span class="line">    <span class="type">DateTime</span> <span class="variable">now</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DateTime</span>();</span><br><span class="line">    <span class="keyword">return</span> cb.and(</span><br><span class="line">      cb.lessThan(poll.get(Poll_.startDate), now),</span><br><span class="line">      cb.greaterThan(poll.get(Poll_.endDate), now),</span><br><span class="line">      cb.isNull(poll.get(Poll_.lockDate))</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ£€æŸ¥ä¸€ä¸ªæŠ•ç¥¨æ˜¯å¦æµè¡Œçš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IsPopular</span> <span class="keyword">extends</span> <span class="title class_">AbstractSpecification</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSatisfiedBy</span><span class="params">(Poll poll)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> poll.getLockDate() == <span class="literal">null</span> &amp;&amp; poll.getVotes().size() &gt; <span class="number">100</span>;</span><br><span class="line">  &#125; </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Predicate <span class="title function_">toPredicate</span><span class="params">(Root poll, CriteriaBuilder cb)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> cb.and(</span><br><span class="line">      cb.isNull(poll.get(Poll_.lockDate)),</span><br><span class="line">      cb.greaterThan(cb.size(poll.get(Poll_.votes)), <span class="number">5</span>)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="variable">isPopular</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IsPopular</span>().isSatisfiedBy(poll);<span class="type">boolean</span> <span class="variable">isCurrentlyRunning</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IsCurrentlyRunning</span>().isSatisfiedBy(poll);</span><br></pre></td></tr></table></figure><p>ä¸ºäº†æŸ¥è¯¢æ•°æ®åº“ï¼Œæˆ‘ä»¬éœ€è¦ç»§æ‰¿æ‰©å±•DAO&#x2F;Repositoryæ¥æ”¯æŒè§„èŒƒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PollRepository</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">EntityManager</span> <span class="variable">entityManager</span> <span class="operator">=</span> ...</span><br><span class="line">  <span class="keyword">public</span> List <span class="title function_">findAllBySpecification</span><span class="params">(Specification specification)</span> &#123;</span><br><span class="line">    <span class="type">CriteriaBuilder</span> <span class="variable">criteriaBuilder</span> <span class="operator">=</span> entityManager.getCriteriaBuilder();</span><br><span class="line">    <span class="comment">// use specification.getType() to create a Root instance</span></span><br><span class="line">    <span class="type">CriteriaQuery</span> <span class="variable">criteriaQuery</span> <span class="operator">=</span> criteriaBuilder.createQuery(specification.getType());</span><br><span class="line">    <span class="type">Root</span> <span class="variable">root</span> <span class="operator">=</span> criteriaQuery.from(specification.getType());</span><br><span class="line">    <span class="comment">// get predicate from specification</span></span><br><span class="line">    <span class="type">Predicate</span> <span class="variable">predicate</span> <span class="operator">=</span> specification.toPredicate(root, criteriaBuilder);</span><br><span class="line">    <span class="comment">// set predicate and execute query</span></span><br><span class="line">    criteriaQuery.where(predicate);</span><br><span class="line">    <span class="keyword">return</span> entityManager.createQuery(criteriaQuery).getResultList();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€æˆ‘ä»¬ä½¿ç”¨ AbstractSpecificationçš„getType() æ–¹æ³• åˆ›å»ºCriteriaQuery å’Œ Root å®ä¾‹. getType()è¿”å›çš„æ˜¯ä¸€ä¸ª AbstractSpecificationæ³›å‹ï¼Œå¯ä»¥ç”±å­ç±»å®šä¹‰. å¯¹äºæµè¡ŒIsPopular ä¸”æ­£åœ¨è¿›è¡ŒIsCurrentlyRunningå®ƒè¿”å›ä¸€ä¸ªPoll classã€‚<br>ã€€ã€€å¦‚æœæ²¡æœ‰ getType()æˆ‘ä»¬å¿…é¡»åœ¨æ¯ä¸ªè§„èŒƒçš„ toPredicate() ä¸­å®ç°åˆ›å»º CriteriaQuery å’Œ Rootå®ä¾‹ã€‚å®ƒåªæ˜¯å‡å°‘çƒ¦äººä»£ç çš„å¸®åŠ©è€…ã€‚ã€€ã€€</p><p>ä½¿ç”¨ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">List</span> <span class="variable">popularPolls</span> <span class="operator">=</span> pollRepository.findAllBySpecification(<span class="keyword">new</span> <span class="title class_">IsPopular</span>());</span><br><span class="line"><span class="type">List</span> <span class="variable">currentlyRunningPolls</span> <span class="operator">=</span> pollRepository.findAllBySpecification(<span class="keyword">new</span> <span class="title class_">IsCurrentlyRunning</span>());</span><br></pre></td></tr></table></figure><p>ä¸‹é¢é—®é¢˜æ˜¯å¦‚ä½•ç»“åˆè¿™ä¸¤ä¸ªè§„èŒƒï¼Œæˆ‘ä»¬å¦‚ä½•æŸ¥è¯¢æ•°æ®åº“æ‰€æœ‰æµè¡Œä¸”è¿˜åœ¨è¿›è¡Œçš„æŠ•ç¥¨å‘¢ï¼Ÿ</p><p>ä½¿ç”¨ç»„åˆæ¨¡å¼å®ç°ç»„åˆè§„èŒƒæ¨¡å¼ã€‚åç§°ä¸ºAndSpecificationï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AndSpecification</span> <span class="keyword">extends</span> <span class="title class_">AbstractSpecification</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> Specification first;</span><br><span class="line">  <span class="keyword">private</span> Specification second;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">AndSpecification</span><span class="params">(Specification first, Specification second)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.first = first;</span><br><span class="line">    <span class="built_in">this</span>.second = second;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSatisfiedBy</span><span class="params">(T t)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> first.isSatisfiedBy(t) &amp;&amp; second.isSatisfiedBy(t);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Predicate <span class="title function_">toPredicate</span><span class="params">(Root root, CriteriaBuilder cb)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> cb.and(</span><br><span class="line">      first.toPredicate(root, cb),</span><br><span class="line">      second.toPredicate(root, cb)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Class <span class="title function_">getType</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> first.getType();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Specification</span> <span class="variable">popularAndRunning</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AndSpecification</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">IsPopular</span>(), <span class="keyword">new</span> <span class="title class_">IsCurrentlyRunning</span>());</span><br><span class="line"><span class="type">List</span> <span class="variable">polls</span> <span class="operator">=</span> myRepository.findAllBySpecification(popularAndRunning);</span><br></pre></td></tr></table></figure><p>ä¸ºäº†æä¾›å¯è¯»æ€§ï¼Œæˆ‘ä»¬å¢åŠ andæ–¹æ³•åˆ°è§„èŒƒæ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Specification</span> &#123;</span><br><span class="line">  Specification <span class="title function_">and</span><span class="params">(Specification other)</span>;</span><br><span class="line">  <span class="comment">// other methods</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AbstractSpecification</span> <span class="keyword">implements</span> <span class="title class_">Specification</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Specification <span class="title function_">and</span><span class="params">(Specification other)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AndSpecification</span>&lt;&gt;(<span class="built_in">this</span>, other);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// other methods</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Specification</span> <span class="variable">popularAndRunning</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IsPopular</span>().and(<span class="keyword">new</span> <span class="title class_">IsCurrentlyRunning</span>());</span><br><span class="line"><span class="type">boolean</span> <span class="variable">isPopularAndRunning</span> <span class="operator">=</span> popularAndRunning.isSatisfiedBy(poll);</span><br><span class="line"><span class="type">List</span> <span class="variable">polls</span> <span class="operator">=</span> myRepository.findAllBySpecification(popularAndRunning);</span><br></pre></td></tr></table></figure><p><a href="https://www.jdon.com/idea/javaee7/specification-pattern-with-jpa.html">è½¬è½½è‡ªhttps://www.jdon.com/idea/javaee7/specification-pattern-with-jpa.html</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>JPA OneToManyç®€å•åº”ç”¨</title>
      <link href="/posts/c51a8252.html"/>
      <url>/posts/c51a8252.html</url>
      
        <content type="html"><![CDATA[<h3 id="1-å•å‘-OneToMany"><a href="#1-å•å‘-OneToMany" class="headerlink" title="1.å•å‘@OneToMany"></a>1.å•å‘@OneToMany</h3><ol><li>Userå®ä½“ç±»<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;username&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OneToMany(cascade = &#123;CascadeType.REMOVE&#125;)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;article_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Set&lt;Article&gt; articles;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>2.Articleå®ä½“ç±»</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;article&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Article</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;article_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long article_id;    </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;title&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;content&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Javaéšç¬” </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> JPA </tag>
            
            <tag> MapStruct </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¸¸ç”¨è®¾è®¡æ¨¡å¼</title>
      <link href="/posts/1e80ad29.html"/>
      <url>/posts/1e80ad29.html</url>
      
        <content type="html"><![CDATA[<hr><h3 id="ç®€å•å·¥å‚"><a href="#ç®€å•å·¥å‚" class="headerlink" title="ç®€å•å·¥å‚"></a>ç®€å•å·¥å‚</h3><h3 id="å·¥å‚æ¨¡å¼ï¼ˆFactory-Methodï¼‰"><a href="#å·¥å‚æ¨¡å¼ï¼ˆFactory-Methodï¼‰" class="headerlink" title="å·¥å‚æ¨¡å¼ï¼ˆFactory Methodï¼‰"></a>å·¥å‚æ¨¡å¼ï¼ˆFactory Methodï¼‰</h3><h3 id="å•ä¾‹ï¼ˆSingletonï¼‰"><a href="#å•ä¾‹ï¼ˆSingletonï¼‰" class="headerlink" title="å•ä¾‹ï¼ˆSingletonï¼‰"></a>å•ä¾‹ï¼ˆSingletonï¼‰</h3><h3 id="é€‚é…å™¨ï¼ˆAdapterï¼‰"><a href="#é€‚é…å™¨ï¼ˆAdapterï¼‰" class="headerlink" title="é€‚é…å™¨ï¼ˆAdapterï¼‰"></a>é€‚é…å™¨ï¼ˆAdapterï¼‰</h3><h3 id="åŒ…è£…å™¨ï¼ˆDecoratorè£…é¥°æ¨¡å¼ï¼‰"><a href="#åŒ…è£…å™¨ï¼ˆDecoratorè£…é¥°æ¨¡å¼ï¼‰" class="headerlink" title="åŒ…è£…å™¨ï¼ˆDecoratorè£…é¥°æ¨¡å¼ï¼‰"></a>åŒ…è£…å™¨ï¼ˆDecoratorè£…é¥°æ¨¡å¼ï¼‰</h3><h3 id="ä»£ç†ï¼ˆProxyï¼‰"><a href="#ä»£ç†ï¼ˆProxyï¼‰" class="headerlink" title="ä»£ç†ï¼ˆProxyï¼‰"></a>ä»£ç†ï¼ˆProxyï¼‰</h3><h3 id="è§‚å¯Ÿè€…ï¼ˆObserverï¼‰"><a href="#è§‚å¯Ÿè€…ï¼ˆObserverï¼‰" class="headerlink" title="è§‚å¯Ÿè€…ï¼ˆObserverï¼‰"></a>è§‚å¯Ÿè€…ï¼ˆObserverï¼‰</h3><h3 id="ç­–ç•¥ï¼ˆStrategyï¼‰"><a href="#ç­–ç•¥ï¼ˆStrategyï¼‰" class="headerlink" title="ç­–ç•¥ï¼ˆStrategyï¼‰"></a>ç­–ç•¥ï¼ˆStrategyï¼‰</h3><h3 id="æ¨¡æ¿æ–¹æ³•ï¼ˆTemplate-Methodï¼‰"><a href="#æ¨¡æ¿æ–¹æ³•ï¼ˆTemplate-Methodï¼‰" class="headerlink" title="æ¨¡æ¿æ–¹æ³•ï¼ˆTemplate Methodï¼‰"></a>æ¨¡æ¿æ–¹æ³•ï¼ˆTemplate Methodï¼‰</h3>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Jhipsterå­¦ä¹ ç¬”è®°</title>
      <link href="/posts/abc029f4.html"/>
      <url>/posts/abc029f4.html</url>
      
        <content type="html"><![CDATA[<h4 id="é¡¹ç›®ç”Ÿæˆ"><a href="#é¡¹ç›®ç”Ÿæˆ" class="headerlink" title="é¡¹ç›®ç”Ÿæˆ"></a>é¡¹ç›®ç”Ÿæˆ</h4><h5 id="1-ä½¿ç”¨Jhipsterç”Ÿæˆä¸€ä¸ªçº¯å‰ç«¯é¡¹ç›®"><a href="#1-ä½¿ç”¨Jhipsterç”Ÿæˆä¸€ä¸ªçº¯å‰ç«¯é¡¹ç›®" class="headerlink" title="1. ä½¿ç”¨Jhipsterç”Ÿæˆä¸€ä¸ªçº¯å‰ç«¯é¡¹ç›®"></a>1. ä½¿ç”¨Jhipsterç”Ÿæˆä¸€ä¸ªçº¯å‰ç«¯é¡¹ç›®</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å°†JH-Vuejs æ¨¡å—ç¬¦å·é“¾æ¥è‡³å½“å‰é¡¹ç›®çš„ä¾èµ–ä¸­ (ps:ç”¨ç®¡ç†å‘˜æƒé™cmdè¿è¡Œ)ï¼Œè¿™ä¸€æ­¥å¾ˆé‡è¦ï¼Œå¦‚æœä¸è¿™æ ·åšåé¢ç”Ÿæˆçš„ä»£ç éƒ½æ˜¯NGæ¡†æ¶</span></span><br><span class="line">npm <span class="built_in">link</span> generator-jhipster-vuejs</span><br><span class="line"></span><br><span class="line"><span class="comment">#bash</span></span><br><span class="line">jhipster --skip-server --blueprints vuejs --db mysql --auth jwt</span><br><span class="line"><span class="comment">#æˆ–è€…</span></span><br><span class="line">jhipster --skip-server --blueprints vuejs -d --db mysql --auth jwt</span><br><span class="line"></span><br><span class="line"><span class="comment">#å‰ç«¯é¡¹ç›®ç”Ÿæˆå®ä½“å‘½ä»¤ï¼Œå¿…é¡»åŠ --dbï¼ˆ???ï¼‰</span></span><br><span class="line">jhipster entity article --db mysql</span><br></pre></td></tr></table></figure><h5 id="2-ä½¿ç”¨Jhipsterç”Ÿæˆä¸€ä¸ªçº¯åç«¯é¡¹ç›®"><a href="#2-ä½¿ç”¨Jhipsterç”Ÿæˆä¸€ä¸ªçº¯åç«¯é¡¹ç›®" class="headerlink" title="2. ä½¿ç”¨Jhipsterç”Ÿæˆä¸€ä¸ªçº¯åç«¯é¡¹ç›®"></a>2. ä½¿ç”¨Jhipsterç”Ÿæˆä¸€ä¸ªçº¯åç«¯é¡¹ç›®</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jhipster --skip-client</span><br></pre></td></tr></table></figure><h5 id="3-ä½¿ç”¨Jhipsterç”Ÿæˆä¸€ä¸ªéå‰åç«¯åˆ†ç¦»é¡¹ç›®"><a href="#3-ä½¿ç”¨Jhipsterç”Ÿæˆä¸€ä¸ªéå‰åç«¯åˆ†ç¦»é¡¹ç›®" class="headerlink" title="3. ä½¿ç”¨Jhipsterç”Ÿæˆä¸€ä¸ªéå‰åç«¯åˆ†ç¦»é¡¹ç›®"></a>3. ä½¿ç”¨Jhipsterç”Ÿæˆä¸€ä¸ªéå‰åç«¯åˆ†ç¦»é¡¹ç›®</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä½¿ç”¨vueä½œä¸ºå‰ç«¯æ¡†æ¶ç”Ÿæˆä¸€ä¸ªå‰åç«¯ä¸åˆ†ç¦»çš„é¡¹ç›®</span></span><br><span class="line">jhipster --blueprint vuejs</span><br></pre></td></tr></table></figure><h5 id="4-å¸¸ç”¨å‘½ä»¤"><a href="#4-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="4. å¸¸ç”¨å‘½ä»¤"></a>4. å¸¸ç”¨å‘½ä»¤</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¯¼å‡ºjdlæ–‡ä»¶</span></span><br><span class="line">jhipster export-jdl &lt;FILE_NAME&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Jhipster </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Jhipster </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ºä»€ä¹ˆè¦ç”¨Spring</title>
      <link href="/posts/cf4d9cf.html"/>
      <url>/posts/cf4d9cf.html</url>
      
        <content type="html"><![CDATA[<h3 id="Spring-IOC"><a href="#Spring-IOC" class="headerlink" title="Spring IOC"></a>Spring IOC</h3><h4 id="ä¾èµ–æ³¨å…¥èƒ½åšä»€ä¹ˆ"><a href="#ä¾èµ–æ³¨å…¥èƒ½åšä»€ä¹ˆ" class="headerlink" title="ä¾èµ–æ³¨å…¥èƒ½åšä»€ä¹ˆ"></a>ä¾èµ–æ³¨å…¥èƒ½åšä»€ä¹ˆ</h4><ul><li>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¾èµ–æ³¨å…¥<ul><li>ä¼ ç»Ÿçš„ä»£ç ï¼Œæ¯ä¸ªå¯¹è±¡è´Ÿè´£ç®¡ç†ä¸è‡ªå·±éœ€è¦ä¾èµ–çš„å¯¹è±¡ï¼Œå¯¼è‡´å¦‚æœéœ€è¦åˆ‡æ¢ä¾èµ–å¯¹è±¡çš„å®ç°ç±»æ—¶ï¼Œéœ€è¦ä¿®æ”¹å¤šå¤„åœ°æ–¹ã€‚åŒæ—¶ï¼Œè¿‡åº¦è€¦åˆä¹Ÿä½¿å¾—å¯¹è±¡éš¾ä»¥è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚</li><li>ä¾èµ–æ³¨å…¥æŠŠå¯¹è±¡çš„åˆ›é€ äº¤ç»™å¤–éƒ¨å»ç®¡ç†,å¾ˆå¥½çš„è§£å†³äº†ä»£ç ç´§è€¦åˆï¼ˆtight coupleï¼‰çš„é—®é¢˜ï¼Œæ˜¯ä¸€ç§è®©ä»£ç å®ç°æ¾è€¦åˆï¼ˆloose coupleï¼‰çš„æœºåˆ¶ã€‚</li><li>æ¾è€¦åˆè®©ä»£ç æ›´å…·çµæ´»æ€§ï¼Œèƒ½æ›´å¥½åœ°åº”å¯¹éœ€æ±‚å˜åŠ¨ï¼Œä»¥åŠæ–¹ä¾¿å•å…ƒæµ‹è¯•ã€‚</li></ul></li></ul><h4 id="ä»€ä¹ˆæ˜¯IOCå®¹å™¨"><a href="#ä»€ä¹ˆæ˜¯IOCå®¹å™¨" class="headerlink" title="ä»€ä¹ˆæ˜¯IOCå®¹å™¨"></a>ä»€ä¹ˆæ˜¯IOCå®¹å™¨</h4><h4 id="COCæ˜¯ä»€ä¹ˆ"><a href="#COCæ˜¯ä»€ä¹ˆ" class="headerlink" title="COCæ˜¯ä»€ä¹ˆ"></a>COCæ˜¯ä»€ä¹ˆ</h4><p>Convention over Configuration çº¦å®šä¼˜äºé…ç½®</p><h4 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h4><h3 id="Springç‰¹ç‚¹"><a href="#Springç‰¹ç‚¹" class="headerlink" title="Springç‰¹ç‚¹"></a>Springç‰¹ç‚¹</h3><h5 id="1-æ–¹ä¾¿è§£è€¦ï¼Œç®€åŒ–å¼€å‘"><a href="#1-æ–¹ä¾¿è§£è€¦ï¼Œç®€åŒ–å¼€å‘" class="headerlink" title="1. æ–¹ä¾¿è§£è€¦ï¼Œç®€åŒ–å¼€å‘"></a>1. æ–¹ä¾¿è§£è€¦ï¼Œç®€åŒ–å¼€å‘</h5><p>ã€€ã€€é€šè¿‡Springæä¾›çš„IoCå®¹å™¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»äº¤ç”±Springè¿›è¡Œæ§åˆ¶ï¼Œé¿å…ç¡¬ç¼–ç æ‰€é€ æˆçš„è¿‡åº¦ç¨‹åºè€¦åˆã€‚æœ‰äº†Springï¼Œç”¨æˆ·ä¸å¿…å†ä¸ºå•å®ä¾‹æ¨¡å¼ç±»ã€å±æ€§æ–‡ä»¶è§£æç­‰è¿™äº›å¾ˆåº•å±‚çš„éœ€æ±‚ç¼–å†™ä»£ç ï¼Œå¯ä»¥æ›´ä¸“æ³¨äºä¸Šå±‚çš„åº”ç”¨ã€‚</p><h5 id="2-AOPç¼–ç¨‹çš„æ”¯æŒ"><a href="#2-AOPç¼–ç¨‹çš„æ”¯æŒ" class="headerlink" title="2. AOPç¼–ç¨‹çš„æ”¯æŒ"></a>2. AOPç¼–ç¨‹çš„æ”¯æŒ</h5><p>é€šè¿‡Springæä¾›çš„AOPåŠŸèƒ½ï¼Œæ–¹ä¾¿è¿›è¡Œé¢å‘åˆ‡é¢çš„ç¼–ç¨‹ï¼Œè®¸å¤šä¸å®¹æ˜“ç”¨ä¼ ç»ŸOOPå®ç°çš„åŠŸèƒ½å¯ä»¥é€šè¿‡AOPè½»æ¾åº”ä»˜ã€‚</p><h5 id="3-å£°æ˜å¼äº‹åŠ¡çš„æ”¯æŒ"><a href="#3-å£°æ˜å¼äº‹åŠ¡çš„æ”¯æŒ" class="headerlink" title="3. å£°æ˜å¼äº‹åŠ¡çš„æ”¯æŒ"></a>3. å£°æ˜å¼äº‹åŠ¡çš„æ”¯æŒ</h5><p>ã€€ã€€åœ¨Springä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä»å•è°ƒçƒ¦é—·çš„äº‹åŠ¡ç®¡ç†ä»£ç ä¸­è§£è„±å‡ºæ¥ï¼Œé€šè¿‡å£°æ˜å¼æ–¹å¼çµæ´»åœ°è¿›è¡Œäº‹åŠ¡çš„ç®¡ç†ï¼Œæé«˜å¼€å‘æ•ˆç‡å’Œè´¨é‡ã€‚</p><h5 id="4-æ–¹ä¾¿ç¨‹åºçš„æµ‹è¯•"><a href="#4-æ–¹ä¾¿ç¨‹åºçš„æµ‹è¯•" class="headerlink" title="4. æ–¹ä¾¿ç¨‹åºçš„æµ‹è¯•"></a>4. æ–¹ä¾¿ç¨‹åºçš„æµ‹è¯•</h5><p>ã€€ã€€å¯ä»¥ç”¨éå®¹å™¨ä¾èµ–çš„ç¼–ç¨‹æ–¹å¼è¿›è¡Œå‡ ä¹æ‰€æœ‰çš„æµ‹è¯•å·¥ä½œï¼Œåœ¨Springé‡Œï¼Œæµ‹è¯•ä¸å†æ˜¯æ˜‚è´µçš„æ“ä½œï¼Œè€Œæ˜¯éšæ‰‹å¯åšçš„äº‹æƒ…ã€‚ä¾‹å¦‚ï¼šSpringå¯¹Junit4æ”¯æŒï¼Œå¯ä»¥é€šè¿‡æ³¨è§£æ–¹ä¾¿çš„æµ‹è¯•Springç¨‹åºã€‚</p><h5 id="5-æ–¹ä¾¿é›†æˆå„ç§ä¼˜ç§€æ¡†æ¶"><a href="#5-æ–¹ä¾¿é›†æˆå„ç§ä¼˜ç§€æ¡†æ¶" class="headerlink" title="5. æ–¹ä¾¿é›†æˆå„ç§ä¼˜ç§€æ¡†æ¶"></a>5. æ–¹ä¾¿é›†æˆå„ç§ä¼˜ç§€æ¡†æ¶</h5><p>ã€€ã€€Springä¸æ’æ–¥å„ç§ä¼˜ç§€çš„å¼€æºæ¡†æ¶ï¼Œç›¸åï¼ŒSpringå¯ä»¥é™ä½å„ç§æ¡†æ¶çš„ä½¿ç”¨éš¾åº¦ï¼ŒSpringæä¾›äº†å¯¹å„ç§ä¼˜ç§€æ¡†æ¶ï¼ˆå¦‚Struts,Hibernateã€Hessianã€Quartzï¼‰ç­‰çš„ç›´æ¥æ”¯æŒã€‚</p><h5 id="6-é™ä½Java-EE-APIçš„ä½¿ç”¨éš¾åº¦"><a href="#6-é™ä½Java-EE-APIçš„ä½¿ç”¨éš¾åº¦" class="headerlink" title="6. é™ä½Java EE APIçš„ä½¿ç”¨éš¾åº¦"></a>6. é™ä½Java EE APIçš„ä½¿ç”¨éš¾åº¦</h5><p>ã€€ã€€Springå¯¹å¾ˆå¤šéš¾ç”¨çš„Java EE APIï¼ˆå¦‚JDBCï¼ŒJavaMailï¼Œè¿œç¨‹è°ƒç”¨ç­‰ï¼‰æä¾›äº†ä¸€ä¸ªè–„è–„çš„å°è£…å±‚ï¼Œé€šè¿‡Springçš„ç®€æ˜“å°è£…ï¼Œè¿™äº›Java EE APIçš„ä½¿ç”¨éš¾åº¦å¤§ä¸ºé™ä½ã€‚</p><h5 id="7-Java-æºç æ˜¯ç»å…¸å­¦ä¹ èŒƒä¾‹"><a href="#7-Java-æºç æ˜¯ç»å…¸å­¦ä¹ èŒƒä¾‹" class="headerlink" title="7. Java æºç æ˜¯ç»å…¸å­¦ä¹ èŒƒä¾‹"></a>7. Java æºç æ˜¯ç»å…¸å­¦ä¹ èŒƒä¾‹</h5><p>ã€€ã€€Springçš„æºç è®¾è®¡ç²¾å¦™ã€ç»“æ„æ¸…æ™°ã€åŒ å¿ƒç‹¬è¿ï¼Œå¤„å¤„ä½“ç°ç€å¤§å¸ˆå¯¹Javaè®¾è®¡æ¨¡å¼çµæ´»è¿ç”¨ä»¥åŠå¯¹JavaæŠ€æœ¯çš„é«˜æ·±é€ è¯£ã€‚Springæ¡†æ¶æºç æ— ç–‘æ˜¯JavaæŠ€æœ¯çš„æœ€ä½³å®è·µèŒƒä¾‹ã€‚å¦‚æœæƒ³åœ¨çŸ­æ—¶é—´å†…è¿…é€Ÿæé«˜è‡ªå·±çš„JavaæŠ€æœ¯æ°´å¹³å’Œåº”ç”¨å¼€å‘æ°´å¹³ï¼Œå­¦ä¹ å’Œç ”ç©¶Springæºç å°†ä¼šä½¿ä½ æ”¶åˆ°æ„æƒ³ä¸åˆ°çš„æ•ˆæœã€‚ã€€ã€€</p><h3 id="å¥½å¤„"><a href="#å¥½å¤„" class="headerlink" title="å¥½å¤„"></a>å¥½å¤„</h3><h4 id="æ€»ç»“èµ·æ¥ï¼Œä½¿ç”¨Springæœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š"><a href="#æ€»ç»“èµ·æ¥ï¼Œä½¿ç”¨Springæœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š" class="headerlink" title="æ€»ç»“èµ·æ¥ï¼Œä½¿ç”¨Springæœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š"></a>æ€»ç»“èµ·æ¥ï¼Œä½¿ç”¨Springæœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š</h4><ol><li>ä½ä¾µå…¥å¼è®¾è®¡ï¼Œä»£ç æ±¡æŸ“æä½</li><li>ç‹¬ç«‹äºå„ç§åº”ç”¨æœåŠ¡å™¨ï¼ŒåŸºäºSpringæ¡†æ¶çš„åº”ç”¨ï¼Œå¯ä»¥çœŸæ­£å®ç°Write Once,Run Anywhereçš„æ‰¿è¯º</li><li>Springçš„DIæœºåˆ¶é™ä½äº†ä¸šåŠ¡å¯¹è±¡æ›¿æ¢çš„å¤æ‚æ€§ï¼Œæé«˜äº†ç»„ä»¶ä¹‹é—´çš„è§£è€¦</li><li>Springçš„AOPæ”¯æŒå…è®¸å°†ä¸€äº›é€šç”¨ä»»åŠ¡å¦‚å®‰å…¨ã€äº‹åŠ¡ã€æ—¥å¿—ç­‰è¿›è¡Œé›†ä¸­å¼ç®¡ç†ï¼Œä»è€Œæä¾›äº†æ›´å¥½çš„å¤ç”¨</li><li>Springçš„ORMå’ŒDAOæä¾›äº†ä¸ç¬¬ä¸‰æ–¹æŒä¹…å±‚æ¡†æ¶çš„è‰¯å¥½æ•´åˆï¼Œå¹¶ç®€åŒ–äº†åº•å±‚çš„æ•°æ®åº“è®¿é—®</li><li>Springå¹¶ä¸å¼ºåˆ¶åº”ç”¨å®Œå…¨ä¾èµ–äºSpringï¼Œå¼€å‘è€…å¯è‡ªç”±é€‰ç”¨Springæ¡†æ¶çš„éƒ¨åˆ†æˆ–å…¨éƒ¨</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/posts/4a17b156.html"/>
      <url>/posts/4a17b156.html</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
